{"version":3,"file":"linker.v3.js","mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,UAAU;AACrB,YAAY,SAAS;AACrB;AACA,+CAA+C;AAC/C;AACA;AACA;AACA,gBAAgB;AAChB;;AAEA,yBAAyB;AACzB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA,IAAI,IAA0B;AAC9B;AACA;AACA;;;;;;;;;;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,cAAc;AACzB,WAAW,cAAc;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,kBAAkB,eAAe,IAAI,iBAAiB;AACtD;AACA;AACA,kBAAkB,UAAU,IAAI,WAAW;AAC3C,OAAO;AACP,iBAAiB,gBAAgB,EAAE,UAAU;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,mBAAmB,GAAG;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,QAAQ;AACxC;AACA;AACA,GAAG;;AAEH;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,QAAQ;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA,MAAM;AACN;AACA;;AAEA,wCAAwC,MAAM;AAC9C;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA,0BAA0B,4BAA4B;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,MAAM,WAAW;;AAEjB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,MAAM;AACN;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB,4BAA4B;AAChD;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,OAAO;AACP,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB;;AAExB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;;AAEP;AACA;AACA;AACA,8CAA8C,QAAQ;AACtD;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,wBAAwB,2BAA2B;AACnD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,QAAQ;AACR;AACA;AACA;AACA,wBAAwB,0BAA0B;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,6GAA6G;AACrJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,4CAA4C,QAAQ;AACpD;AACA;;AAEA;AACA;;AAEA;AACA;AACA,UAAU;AACV;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+BAA+B,uDAAuD;AACtF,UAAU;AACV;AACA,+BAA+B,uDAAuD;AACtF,UAAU;AACV;AACA,+BAA+B,uDAAuD;AACtF,UAAU;AACV,+BAA+B,uDAAuD;AACtF;AACA;AACA;AACA,WAAW;;AAEX;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,4BAA4B,QAAQ;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,iBAAiB,QAAQ;AACzB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,+CAA+C;AAC/C;AACA,KAAK,2BAA2B,IAAI,SAAS,IAAI,GAAG;AACpD;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,cAAc;AACd;AACA;AACA,YAAY;AACZ;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,KAAK;AACL;AACA,GAAG;;AAEH;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,2BAA2B;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,wBAAwB,+BAA+B;AACvD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,oBAAoB,2CAA2C;AAC/D;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,wBAAwB,+BAA+B;AACvD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,gBAAgB;AACpC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAsB,kBAAkB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,mBAAmB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,wBAAwB,4BAA4B;AACpD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,sBAAsB,4BAA4B;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,wBAAwB,mBAAmB;AAC3C;AACA,0BAA0B,iCAAiC;AAC3D;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,0BAA0B;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD;AACpD;AACA;;AAEA;AACA;;AAEA;AACA,0CAA0C;;AAE1C;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAI,IAA0B;AAC9B;AACA;AACA;;;;;;;;;;;AC5vEA;AACA,kBAAkB,mBAAO,CAAC,6EAAe;AACzC,2BAA2B,mBAAO,CAAC,mGAA0B;;AAE7D;AACA;AACA;AACA;;;;;;;;;;;ACPA;;AAEA;AACA,EAAE,KAA4D;AAC9D,EAAE,CACwG;AAC1G,CAAC,uBAAuB;;AAExB;AACA;;AAEA;AACA;AACA,MAAM;AACN;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,kFAAkF;AAClF;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,2CAA2C,SAAS;;AAEpD;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;;AAE9B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6FAA6F,aAAa;AAC1G;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,6EAA6E,eAAe;AAC5F;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,k/BAAk/B;;AAEl/B;AACA,wYAAwY;AACxY;AACA;AACA;;AAEA;AACA,gTAAgT;AAChT;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,8BAA8B,EAAE,iBAAiB,EAAE,MAAM;;AAEzD;AACA,6BAA6B,QAAQ;AACrC,sDAAsD;;AAEtD,0CAA0C;;AAE1C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,2BAA2B;AACxC,aAAa,UAAU;AACvB,cAAc,oBAAoB;AAClC;AACA;;;AAGA;AACA;AACA;AACA,MAAM;AACN;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sEAAsE;AACtE;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,MAAM;;AAEN;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,0CAA0C;AAC1C;;AAEA;AACA,0CAA0C;AAC1C;AACA;AACA,kBAAkB,sBAAsB;AACxC,kBAAkB,sBAAsB;AACxC,kBAAkB,SAAS;AAC3B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,6CAA6C;AAC7C;;AAEA;AACA,2CAA2C;AAC3C;;AAEA;AACA,iDAAiD;AACjD;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,gDAAgD;AAChD;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,QAAQ;AACxB;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA,sKAAsK;;AAEtK;AACA;;AAEA,wDAAwD;AACxD,wDAAwD;AACxD,oEAAoE;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8DAA8D;AAC9D,sDAAsD;AACtD,sDAAsD;AACtD;AACA,uDAAuD;;AAEvD,uDAAuD;;AAEvD,sEAAsE;;AAEtE,yEAAyE;;AAEzE,4DAA4D;;AAE5D,oDAAoD;;AAEpD,4CAA4C;;AAE5C,8DAA8D;;AAE9D,8DAA8D;;AAE9D,4CAA4C;;AAE5C,iDAAiD;;AAEjD,gEAAgE;;AAEhE,iDAAiD;;AAEjD,wCAAwC;;AAExC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA,kCAAkC;AAClC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,QAAQ;AACR;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA,oDAAoD;AACpD,6CAA6C,yDAAyD;AACtG;AACA;AACA;;AAEA,kDAAkD;AAClD;AACA;AACA;;AAEA,kCAAkC;AAClC;AACA;AACA,qCAAqC;AACrC;AACA;AACA;AACA;AACA,gBAAgB,SAAS;AACzB,iBAAiB,SAAS;AAC1B;AACA;AACA;;AAEA;AACA,2CAA2C;AAC3C;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;;;AAGA;AACA;AACA,UAAU;AACV;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;;;AAGA;AACA;AACA,UAAU;AACV;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAU;AACV;;;AAGA;AACA,QAAQ;;;AAGR;AACA;AACA,QAAQ;AACR;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,gBAAgB,MAAM;AACtB;;;AAGA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,QAAQ;AACxB,gBAAgB,MAAM;AACtB;;;AAGA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,QAAQ;AACR;AACA;AACA;AACA,SAAS;AACT;;AAEA,kCAAkC;;AAElC;AACA;AACA;AACA;AACA,YAAY;AACZ,UAAU;AACV;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,QAAQ;AACxB,gBAAgB,UAAU;AAC1B;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAU;AACV;AACA;;;AAGA;AACA;;AAEA;AACA;AACA,UAAU,WAAW;AACrB;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAgB,UAAU;AAC1B,gBAAgB,UAAU;AAC1B;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,MAAM;AACtB,gBAAgB,SAAS;AACzB;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,MAAM;AACtB,gBAAgB,SAAS;AACzB;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,QAAQ;AACxB,gBAAgB,MAAM;AACtB,gBAAgB,QAAQ;AACxB;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,MAAM;AACvB,iBAAiB,SAAS;AAC1B;;;AAGA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;;;AAGA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA,yCAAyC,QAAQ;AACjD;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAgB,QAAQ;AACxB,gBAAgB,QAAQ;AACxB,gBAAgB,QAAQ;AACxB,gBAAgB,SAAS;AACzB;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C;;;AAG5C,wFAAwF,+DAA+D;AACvJ;AACA;AACA;AACA;AACA;AACA,uTAAuT;AACvT;AACA;AACA;;AAEA,QAAQ,wCAAwC,sFAAsF,oKAAoK,qHAAqH,mBAAmB;AAClb;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,QAAQ;AACvB;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,MAAM;AACtB;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,sCAAsC;;AAEtC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C;;AAE3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,6CAA6C;;AAE7C;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,+CAA+C;;;AAG/C;AACA;AACA;;;AAGA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,gBAAgB,kBAAkB;AAClC;;;AAGA;AACA;;AAEA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,aAAa;AAC5B,eAAe,QAAQ;AACvB;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,UAAU;AACV;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,QAAQ;AACvB;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,QAAQ;AACxB,gBAAgB,QAAQ;AACxB,gBAAgB,QAAQ;AACxB,gBAAgB,SAAS;AACzB;;;AAGA;AACA;AACA;AACA,uBAAuB;AACvB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,QAAQ;AACvB,eAAe,UAAU;AACzB;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,QAAQ;AACvB,gBAAgB,UAAU;AAC1B;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,QAAQ;AACxB;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA,CAAC;AACD;;;;;;;;;;;ACxqDA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO,KAAyB;AAChC;AACA;AACA;AACA,QAAQ,mBAAO,CAAC,yDAAU;AAC1B,QAAQ,mBAAO,CAAC,+DAAY;AAC5B;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC;AACD;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,sBAAsB;AACtB,qBAAqB;;AAErB,yBAAyB;;AAEzB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,QAAQ,SAAS;AACjB;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,eAAe;AAC1B,WAAW,QAAQ;AACnB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,QAAQ,OAAO;AACf,+BAA+B,EAAE;AACjC,8BAA8B,EAAE;AAChC;;AAEA;AACA,QAAQ,OAAO;AACf,gDAAgD,EAAE,MAAM,EAAE;AAC1D;;AAEA;;AAEA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA,EAAE;;;;;;;;;;;AClZF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO,KAAyB;AAChC;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA,CAAC;;AAED;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAE;;;;;;;;;;;ACnGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,KAA0B;AACnC;AACA;AACA,OAAO,SAAS,IAA0C;AAC1D;AACA,SAAS,oCAAO,OAAO;AAAA;AAAA;AAAA;AAAA,kGAAC;AACxB,OAAO,KAAK,EAGN;AACN,EAAE;;AAEF;AACA;;AAEA;AACA,gBAAgB;;AAEhB;AACA,yCAAyC;AACzC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,IAAI;AACJ;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAY,MAAM;AAClB,YAAY,QAAQ;AACpB,YAAY,gBAAgB;AAC5B,YAAY,QAAQ;AACpB,YAAY,iBAAiB;AAC7B,YAAY,UAAU;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA,gDAAgD,OAAO;;AAEvD;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;;AAEN;;AAEA;;AAEA,GAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,aAAa;AACb;;AAEA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,IAAI;AACzC;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,GAAG;;AAEH;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,mDAAmD;AACnD;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA,KAAK;AACL;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,8CAA8C,OAAO;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;;AAEA;;AAEA,CAAC;;;;;;;;;;;AC3nBD;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO,KAAyB;AAChC;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA,EAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA,EAAE;;;;;;;;;;;AC3HF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO,KAAyB;AAChC;AACA;AACA;AACA,QAAQ,mBAAO,CAAC,+DAAY;AAC5B;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC;;AAED;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,eAAe;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;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","sources":["webpack:///../../node_modules/@mozilla/readability/Readability-readerable.js","webpack:///../../node_modules/@mozilla/readability/Readability.js","webpack:///../../node_modules/@mozilla/readability/index.js","webpack:///../../node_modules/dompurify/dist/purify.js","webpack:///../../node_modules/draggabilly/draggabilly.js","webpack:///../../node_modules/ev-emitter/ev-emitter.js","webpack:///../../node_modules/findandreplacedomtext/src/findAndReplaceDOMText.js","webpack:///../../node_modules/get-size/get-size.js","webpack:///../../node_modules/unidragger/unidragger.js","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./linker.v3/popup.js","webpack:///./linker.v3/excluder.js","webpack:///./linker.v3/main.js"],"sourcesContent":["/*\n * Copyright (c) 2010 Arc90 Inc\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/*\n * This code is heavily based on Arc90's readability.js (1.7.1) script\n * available at: http://code.google.com/p/arc90labs-readability\n */\n\nvar REGEXPS = {\n  // NOTE: These two regular expressions are duplicated in\n  // Readability.js. Please keep both copies in sync.\n  unlikelyCandidates: /-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,\n  okMaybeItsACandidate: /and|article|body|column|content|main|shadow/i,\n};\n\nfunction isNodeVisible(node) {\n  // Have to null-check node.style and node.className.indexOf to deal with SVG and MathML nodes.\n  return (!node.style || node.style.display != \"none\")\n    && !node.hasAttribute(\"hidden\")\n    //check for \"fallback-image\" so that wikimedia math images are displayed\n    && (!node.hasAttribute(\"aria-hidden\") || node.getAttribute(\"aria-hidden\") != \"true\" || (node.className && node.className.indexOf && node.className.indexOf(\"fallback-image\") !== -1));\n}\n\n/**\n * Decides whether or not the document is reader-able without parsing the whole thing.\n * @param {Object} options Configuration object.\n * @param {number} [options.minContentLength=140] The minimum node content length used to decide if the document is readerable.\n * @param {number} [options.minScore=20] The minumum cumulated 'score' used to determine if the document is readerable.\n * @param {Function} [options.visibilityChecker=isNodeVisible] The function used to determine if a node is visible.\n * @return {boolean} Whether or not we suspect Readability.parse() will suceeed at returning an article object.\n */\nfunction isProbablyReaderable(doc, options = {}) {\n  // For backward compatibility reasons 'options' can either be a configuration object or the function used\n  // to determine if a node is visible.\n  if (typeof options == \"function\") {\n    options = { visibilityChecker: options };\n  }\n\n  var defaultOptions = { minScore: 20, minContentLength: 140, visibilityChecker: isNodeVisible };\n  options = Object.assign(defaultOptions, options);\n\n  var nodes = doc.querySelectorAll(\"p, pre, article\");\n\n  // Get <div> nodes which have <br> node(s) and append them into the `nodes` variable.\n  // Some articles' DOM structures might look like\n  // <div>\n  //   Sentences<br>\n  //   <br>\n  //   Sentences<br>\n  // </div>\n  var brNodes = doc.querySelectorAll(\"div > br\");\n  if (brNodes.length) {\n    var set = new Set(nodes);\n    [].forEach.call(brNodes, function (node) {\n      set.add(node.parentNode);\n    });\n    nodes = Array.from(set);\n  }\n\n  var score = 0;\n  // This is a little cheeky, we use the accumulator 'score' to decide what to return from\n  // this callback:\n  return [].some.call(nodes, function (node) {\n    if (!options.visibilityChecker(node)) {\n      return false;\n    }\n\n    var matchString = node.className + \" \" + node.id;\n    if (REGEXPS.unlikelyCandidates.test(matchString) &&\n        !REGEXPS.okMaybeItsACandidate.test(matchString)) {\n      return false;\n    }\n\n    if (node.matches(\"li p\")) {\n      return false;\n    }\n\n    var textContentLength = node.textContent.trim().length;\n    if (textContentLength < options.minContentLength) {\n      return false;\n    }\n\n    score += Math.sqrt(textContentLength - options.minContentLength);\n\n    if (score > options.minScore) {\n      return true;\n    }\n    return false;\n  });\n}\n\nif (typeof module === \"object\") {\n  /* global module */\n  module.exports = isProbablyReaderable;\n}\n","/*\n * Copyright (c) 2010 Arc90 Inc\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/*\n * This code is heavily based on Arc90's readability.js (1.7.1) script\n * available at: http://code.google.com/p/arc90labs-readability\n */\n\n/**\n * Public constructor.\n * @param {HTMLDocument} doc     The document to parse.\n * @param {Object}       options The options object.\n */\nfunction Readability(doc, options) {\n  // In some older versions, people passed a URI as the first argument. Cope:\n  if (options && options.documentElement) {\n    doc = options;\n    options = arguments[2];\n  } else if (!doc || !doc.documentElement) {\n    throw new Error(\"First argument to Readability constructor should be a document object.\");\n  }\n  options = options || {};\n\n  this._doc = doc;\n  this._docJSDOMParser = this._doc.firstChild.__JSDOMParser__;\n  this._articleTitle = null;\n  this._articleByline = null;\n  this._articleDir = null;\n  this._articleSiteName = null;\n  this._attempts = [];\n\n  // Configurable options\n  this._debug = !!options.debug;\n  this._maxElemsToParse = options.maxElemsToParse || this.DEFAULT_MAX_ELEMS_TO_PARSE;\n  this._nbTopCandidates = options.nbTopCandidates || this.DEFAULT_N_TOP_CANDIDATES;\n  this._charThreshold = options.charThreshold || this.DEFAULT_CHAR_THRESHOLD;\n  this._classesToPreserve = this.CLASSES_TO_PRESERVE.concat(options.classesToPreserve || []);\n  this._keepClasses = !!options.keepClasses;\n  this._serializer = options.serializer || function(el) {\n    return el.innerHTML;\n  };\n  this._disableJSONLD = !!options.disableJSONLD;\n  this._allowedVideoRegex = options.allowedVideoRegex || this.REGEXPS.videos;\n\n  // Start with all flags set\n  this._flags = this.FLAG_STRIP_UNLIKELYS |\n                this.FLAG_WEIGHT_CLASSES |\n                this.FLAG_CLEAN_CONDITIONALLY;\n\n\n  // Control whether log messages are sent to the console\n  if (this._debug) {\n    let logNode = function(node) {\n      if (node.nodeType == node.TEXT_NODE) {\n        return `${node.nodeName} (\"${node.textContent}\")`;\n      }\n      let attrPairs = Array.from(node.attributes || [], function(attr) {\n        return `${attr.name}=\"${attr.value}\"`;\n      }).join(\" \");\n      return `<${node.localName} ${attrPairs}>`;\n    };\n    this.log = function () {\n      if (typeof console !== \"undefined\") {\n        let args = Array.from(arguments, arg => {\n          if (arg && arg.nodeType == this.ELEMENT_NODE) {\n            return logNode(arg);\n          }\n          return arg;\n        });\n        args.unshift(\"Reader: (Readability)\");\n        console.log.apply(console, args);\n      } else if (typeof dump !== \"undefined\") {\n        /* global dump */\n        var msg = Array.prototype.map.call(arguments, function(x) {\n          return (x && x.nodeName) ? logNode(x) : x;\n        }).join(\" \");\n        dump(\"Reader: (Readability) \" + msg + \"\\n\");\n      }\n    };\n  } else {\n    this.log = function () {};\n  }\n}\n\nReadability.prototype = {\n  FLAG_STRIP_UNLIKELYS: 0x1,\n  FLAG_WEIGHT_CLASSES: 0x2,\n  FLAG_CLEAN_CONDITIONALLY: 0x4,\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\n  ELEMENT_NODE: 1,\n  TEXT_NODE: 3,\n\n  // Max number of nodes supported by this parser. Default: 0 (no limit)\n  DEFAULT_MAX_ELEMS_TO_PARSE: 0,\n\n  // The number of top candidates to consider when analysing how\n  // tight the competition is among candidates.\n  DEFAULT_N_TOP_CANDIDATES: 5,\n\n  // Element tags to score by default.\n  DEFAULT_TAGS_TO_SCORE: \"section,h2,h3,h4,h5,h6,p,td,pre\".toUpperCase().split(\",\"),\n\n  // The default number of chars an article must have in order to return a result\n  DEFAULT_CHAR_THRESHOLD: 500,\n\n  // All of the regular expressions in use within readability.\n  // Defined up here so we don't instantiate them repeatedly in loops.\n  REGEXPS: {\n    // NOTE: These two regular expressions are duplicated in\n    // Readability-readerable.js. Please keep both copies in sync.\n    unlikelyCandidates: /-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,\n    okMaybeItsACandidate: /and|article|body|column|content|main|shadow/i,\n\n    positive: /article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,\n    negative: /-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget/i,\n    extraneous: /print|archive|comment|discuss|e[\\-]?mail|share|reply|all|login|sign|single|utility/i,\n    byline: /byline|author|dateline|writtenby|p-author/i,\n    replaceFonts: /<(\\/?)font[^>]*>/gi,\n    normalize: /\\s{2,}/g,\n    videos: /\\/\\/(www\\.)?((dailymotion|youtube|youtube-nocookie|player\\.vimeo|v\\.qq)\\.com|(archive|upload\\.wikimedia)\\.org|player\\.twitch\\.tv)/i,\n    shareElements: /(\\b|_)(share|sharedaddy)(\\b|_)/i,\n    nextLink: /(next|weiter|continue|>([^\\|]|$)|»([^\\|]|$))/i,\n    prevLink: /(prev|earl|old|new|<|«)/i,\n    tokenize: /\\W+/g,\n    whitespace: /^\\s*$/,\n    hasContent: /\\S$/,\n    hashUrl: /^#.+/,\n    srcsetUrl: /(\\S+)(\\s+[\\d.]+[xw])?(\\s*(?:,|$))/g,\n    b64DataUrl: /^data:\\s*([^\\s;,]+)\\s*;\\s*base64\\s*,/i,\n    // See: https://schema.org/Article\n    jsonLdArticleTypes: /^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/\n  },\n\n  UNLIKELY_ROLES: [ \"menu\", \"menubar\", \"complementary\", \"navigation\", \"alert\", \"alertdialog\", \"dialog\" ],\n\n  DIV_TO_P_ELEMS: new Set([ \"BLOCKQUOTE\", \"DL\", \"DIV\", \"IMG\", \"OL\", \"P\", \"PRE\", \"TABLE\", \"UL\" ]),\n\n  ALTER_TO_DIV_EXCEPTIONS: [\"DIV\", \"ARTICLE\", \"SECTION\", \"P\"],\n\n  PRESENTATIONAL_ATTRIBUTES: [ \"align\", \"background\", \"bgcolor\", \"border\", \"cellpadding\", \"cellspacing\", \"frame\", \"hspace\", \"rules\", \"style\", \"valign\", \"vspace\" ],\n\n  DEPRECATED_SIZE_ATTRIBUTE_ELEMS: [ \"TABLE\", \"TH\", \"TD\", \"HR\", \"PRE\" ],\n\n  // The commented out elements qualify as phrasing content but tend to be\n  // removed by readability when put into paragraphs, so we ignore them here.\n  PHRASING_ELEMS: [\n    // \"CANVAS\", \"IFRAME\", \"SVG\", \"VIDEO\",\n    \"ABBR\", \"AUDIO\", \"B\", \"BDO\", \"BR\", \"BUTTON\", \"CITE\", \"CODE\", \"DATA\",\n    \"DATALIST\", \"DFN\", \"EM\", \"EMBED\", \"I\", \"IMG\", \"INPUT\", \"KBD\", \"LABEL\",\n    \"MARK\", \"MATH\", \"METER\", \"NOSCRIPT\", \"OBJECT\", \"OUTPUT\", \"PROGRESS\", \"Q\",\n    \"RUBY\", \"SAMP\", \"SCRIPT\", \"SELECT\", \"SMALL\", \"SPAN\", \"STRONG\", \"SUB\",\n    \"SUP\", \"TEXTAREA\", \"TIME\", \"VAR\", \"WBR\"\n  ],\n\n  // These are the classes that readability sets itself.\n  CLASSES_TO_PRESERVE: [ \"page\" ],\n\n  // These are the list of HTML entities that need to be escaped.\n  HTML_ESCAPE_MAP: {\n    \"lt\": \"<\",\n    \"gt\": \">\",\n    \"amp\": \"&\",\n    \"quot\": '\"',\n    \"apos\": \"'\",\n  },\n\n  /**\n   * Run any post-process modifications to article content as necessary.\n   *\n   * @param Element\n   * @return void\n  **/\n  _postProcessContent: function(articleContent) {\n    // Readability cannot open relative uris so we convert them to absolute uris.\n    this._fixRelativeUris(articleContent);\n\n    this._simplifyNestedElements(articleContent);\n\n    if (!this._keepClasses) {\n      // Remove classes.\n      this._cleanClasses(articleContent);\n    }\n  },\n\n  /**\n   * Iterates over a NodeList, calls `filterFn` for each node and removes node\n   * if function returned `true`.\n   *\n   * If function is not passed, removes all the nodes in node list.\n   *\n   * @param NodeList nodeList The nodes to operate on\n   * @param Function filterFn the function to use as a filter\n   * @return void\n   */\n  _removeNodes: function(nodeList, filterFn) {\n    // Avoid ever operating on live node lists.\n    if (this._docJSDOMParser && nodeList._isLiveNodeList) {\n      throw new Error(\"Do not pass live node lists to _removeNodes\");\n    }\n    for (var i = nodeList.length - 1; i >= 0; i--) {\n      var node = nodeList[i];\n      var parentNode = node.parentNode;\n      if (parentNode) {\n        if (!filterFn || filterFn.call(this, node, i, nodeList)) {\n          parentNode.removeChild(node);\n        }\n      }\n    }\n  },\n\n  /**\n   * Iterates over a NodeList, and calls _setNodeTag for each node.\n   *\n   * @param NodeList nodeList The nodes to operate on\n   * @param String newTagName the new tag name to use\n   * @return void\n   */\n  _replaceNodeTags: function(nodeList, newTagName) {\n    // Avoid ever operating on live node lists.\n    if (this._docJSDOMParser && nodeList._isLiveNodeList) {\n      throw new Error(\"Do not pass live node lists to _replaceNodeTags\");\n    }\n    for (const node of nodeList) {\n      this._setNodeTag(node, newTagName);\n    }\n  },\n\n  /**\n   * Iterate over a NodeList, which doesn't natively fully implement the Array\n   * interface.\n   *\n   * For convenience, the current object context is applied to the provided\n   * iterate function.\n   *\n   * @param  NodeList nodeList The NodeList.\n   * @param  Function fn       The iterate function.\n   * @return void\n   */\n  _forEachNode: function(nodeList, fn) {\n    Array.prototype.forEach.call(nodeList, fn, this);\n  },\n\n  /**\n   * Iterate over a NodeList, and return the first node that passes\n   * the supplied test function\n   *\n   * For convenience, the current object context is applied to the provided\n   * test function.\n   *\n   * @param  NodeList nodeList The NodeList.\n   * @param  Function fn       The test function.\n   * @return void\n   */\n  _findNode: function(nodeList, fn) {\n    return Array.prototype.find.call(nodeList, fn, this);\n  },\n\n  /**\n   * Iterate over a NodeList, return true if any of the provided iterate\n   * function calls returns true, false otherwise.\n   *\n   * For convenience, the current object context is applied to the\n   * provided iterate function.\n   *\n   * @param  NodeList nodeList The NodeList.\n   * @param  Function fn       The iterate function.\n   * @return Boolean\n   */\n  _someNode: function(nodeList, fn) {\n    return Array.prototype.some.call(nodeList, fn, this);\n  },\n\n  /**\n   * Iterate over a NodeList, return true if all of the provided iterate\n   * function calls return true, false otherwise.\n   *\n   * For convenience, the current object context is applied to the\n   * provided iterate function.\n   *\n   * @param  NodeList nodeList The NodeList.\n   * @param  Function fn       The iterate function.\n   * @return Boolean\n   */\n  _everyNode: function(nodeList, fn) {\n    return Array.prototype.every.call(nodeList, fn, this);\n  },\n\n  /**\n   * Concat all nodelists passed as arguments.\n   *\n   * @return ...NodeList\n   * @return Array\n   */\n  _concatNodeLists: function() {\n    var slice = Array.prototype.slice;\n    var args = slice.call(arguments);\n    var nodeLists = args.map(function(list) {\n      return slice.call(list);\n    });\n    return Array.prototype.concat.apply([], nodeLists);\n  },\n\n  _getAllNodesWithTag: function(node, tagNames) {\n    if (node.querySelectorAll) {\n      return node.querySelectorAll(tagNames.join(\",\"));\n    }\n    return [].concat.apply([], tagNames.map(function(tag) {\n      var collection = node.getElementsByTagName(tag);\n      return Array.isArray(collection) ? collection : Array.from(collection);\n    }));\n  },\n\n  /**\n   * Removes the class=\"\" attribute from every element in the given\n   * subtree, except those that match CLASSES_TO_PRESERVE and\n   * the classesToPreserve array from the options object.\n   *\n   * @param Element\n   * @return void\n   */\n  _cleanClasses: function(node) {\n    var classesToPreserve = this._classesToPreserve;\n    var className = (node.getAttribute(\"class\") || \"\")\n      .split(/\\s+/)\n      .filter(function(cls) {\n        return classesToPreserve.indexOf(cls) != -1;\n      })\n      .join(\" \");\n\n    if (className) {\n      node.setAttribute(\"class\", className);\n    } else {\n      node.removeAttribute(\"class\");\n    }\n\n    for (node = node.firstElementChild; node; node = node.nextElementSibling) {\n      this._cleanClasses(node);\n    }\n  },\n\n  /**\n   * Converts each <a> and <img> uri in the given element to an absolute URI,\n   * ignoring #ref URIs.\n   *\n   * @param Element\n   * @return void\n   */\n  _fixRelativeUris: function(articleContent) {\n    var baseURI = this._doc.baseURI;\n    var documentURI = this._doc.documentURI;\n    function toAbsoluteURI(uri) {\n      // Leave hash links alone if the base URI matches the document URI:\n      if (baseURI == documentURI && uri.charAt(0) == \"#\") {\n        return uri;\n      }\n\n      // Otherwise, resolve against base URI:\n      try {\n        return new URL(uri, baseURI).href;\n      } catch (ex) {\n        // Something went wrong, just return the original:\n      }\n      return uri;\n    }\n\n    var links = this._getAllNodesWithTag(articleContent, [\"a\"]);\n    this._forEachNode(links, function(link) {\n      var href = link.getAttribute(\"href\");\n      if (href) {\n        // Remove links with javascript: URIs, since\n        // they won't work after scripts have been removed from the page.\n        if (href.indexOf(\"javascript:\") === 0) {\n          // if the link only contains simple text content, it can be converted to a text node\n          if (link.childNodes.length === 1 && link.childNodes[0].nodeType === this.TEXT_NODE) {\n            var text = this._doc.createTextNode(link.textContent);\n            link.parentNode.replaceChild(text, link);\n          } else {\n            // if the link has multiple children, they should all be preserved\n            var container = this._doc.createElement(\"span\");\n            while (link.firstChild) {\n              container.appendChild(link.firstChild);\n            }\n            link.parentNode.replaceChild(container, link);\n          }\n        } else {\n          link.setAttribute(\"href\", toAbsoluteURI(href));\n        }\n      }\n    });\n\n    var medias = this._getAllNodesWithTag(articleContent, [\n      \"img\", \"picture\", \"figure\", \"video\", \"audio\", \"source\"\n    ]);\n\n    this._forEachNode(medias, function(media) {\n      var src = media.getAttribute(\"src\");\n      var poster = media.getAttribute(\"poster\");\n      var srcset = media.getAttribute(\"srcset\");\n\n      if (src) {\n        media.setAttribute(\"src\", toAbsoluteURI(src));\n      }\n\n      if (poster) {\n        media.setAttribute(\"poster\", toAbsoluteURI(poster));\n      }\n\n      if (srcset) {\n        var newSrcset = srcset.replace(this.REGEXPS.srcsetUrl, function(_, p1, p2, p3) {\n          return toAbsoluteURI(p1) + (p2 || \"\") + p3;\n        });\n\n        media.setAttribute(\"srcset\", newSrcset);\n      }\n    });\n  },\n\n  _simplifyNestedElements: function(articleContent) {\n    var node = articleContent;\n\n    while (node) {\n      if (node.parentNode && [\"DIV\", \"SECTION\"].includes(node.tagName) && !(node.id && node.id.startsWith(\"readability\"))) {\n        if (this._isElementWithoutContent(node)) {\n          node = this._removeAndGetNext(node);\n          continue;\n        } else if (this._hasSingleTagInsideElement(node, \"DIV\") || this._hasSingleTagInsideElement(node, \"SECTION\")) {\n          var child = node.children[0];\n          for (var i = 0; i < node.attributes.length; i++) {\n            child.setAttribute(node.attributes[i].name, node.attributes[i].value);\n          }\n          node.parentNode.replaceChild(child, node);\n          node = child;\n          continue;\n        }\n      }\n\n      node = this._getNextNode(node);\n    }\n  },\n\n  /**\n   * Get the article title as an H1.\n   *\n   * @return string\n   **/\n  _getArticleTitle: function() {\n    var doc = this._doc;\n    var curTitle = \"\";\n    var origTitle = \"\";\n\n    try {\n      curTitle = origTitle = doc.title.trim();\n\n      // If they had an element with id \"title\" in their HTML\n      if (typeof curTitle !== \"string\")\n        curTitle = origTitle = this._getInnerText(doc.getElementsByTagName(\"title\")[0]);\n    } catch (e) {/* ignore exceptions setting the title. */}\n\n    var titleHadHierarchicalSeparators = false;\n    function wordCount(str) {\n      return str.split(/\\s+/).length;\n    }\n\n    // If there's a separator in the title, first remove the final part\n    if ((/ [\\|\\-\\\\\\/>»] /).test(curTitle)) {\n      titleHadHierarchicalSeparators = / [\\\\\\/>»] /.test(curTitle);\n      curTitle = origTitle.replace(/(.*)[\\|\\-\\\\\\/>»] .*/gi, \"$1\");\n\n      // If the resulting title is too short (3 words or fewer), remove\n      // the first part instead:\n      if (wordCount(curTitle) < 3)\n        curTitle = origTitle.replace(/[^\\|\\-\\\\\\/>»]*[\\|\\-\\\\\\/>»](.*)/gi, \"$1\");\n    } else if (curTitle.indexOf(\": \") !== -1) {\n      // Check if we have an heading containing this exact string, so we\n      // could assume it's the full title.\n      var headings = this._concatNodeLists(\n        doc.getElementsByTagName(\"h1\"),\n        doc.getElementsByTagName(\"h2\")\n      );\n      var trimmedTitle = curTitle.trim();\n      var match = this._someNode(headings, function(heading) {\n        return heading.textContent.trim() === trimmedTitle;\n      });\n\n      // If we don't, let's extract the title out of the original title string.\n      if (!match) {\n        curTitle = origTitle.substring(origTitle.lastIndexOf(\":\") + 1);\n\n        // If the title is now too short, try the first colon instead:\n        if (wordCount(curTitle) < 3) {\n          curTitle = origTitle.substring(origTitle.indexOf(\":\") + 1);\n          // But if we have too many words before the colon there's something weird\n          // with the titles and the H tags so let's just use the original title instead\n        } else if (wordCount(origTitle.substr(0, origTitle.indexOf(\":\"))) > 5) {\n          curTitle = origTitle;\n        }\n      }\n    } else if (curTitle.length > 150 || curTitle.length < 15) {\n      var hOnes = doc.getElementsByTagName(\"h1\");\n\n      if (hOnes.length === 1)\n        curTitle = this._getInnerText(hOnes[0]);\n    }\n\n    curTitle = curTitle.trim().replace(this.REGEXPS.normalize, \" \");\n    // If we now have 4 words or fewer as our title, and either no\n    // 'hierarchical' separators (\\, /, > or ») were found in the original\n    // title or we decreased the number of words by more than 1 word, use\n    // the original title.\n    var curTitleWordCount = wordCount(curTitle);\n    if (curTitleWordCount <= 4 &&\n        (!titleHadHierarchicalSeparators ||\n         curTitleWordCount != wordCount(origTitle.replace(/[\\|\\-\\\\\\/>»]+/g, \"\")) - 1)) {\n      curTitle = origTitle;\n    }\n\n    return curTitle;\n  },\n\n  /**\n   * Prepare the HTML document for readability to scrape it.\n   * This includes things like stripping javascript, CSS, and handling terrible markup.\n   *\n   * @return void\n   **/\n  _prepDocument: function() {\n    var doc = this._doc;\n\n    // Remove all style tags in head\n    this._removeNodes(this._getAllNodesWithTag(doc, [\"style\"]));\n\n    if (doc.body) {\n      this._replaceBrs(doc.body);\n    }\n\n    this._replaceNodeTags(this._getAllNodesWithTag(doc, [\"font\"]), \"SPAN\");\n  },\n\n  /**\n   * Finds the next node, starting from the given node, and ignoring\n   * whitespace in between. If the given node is an element, the same node is\n   * returned.\n   */\n  _nextNode: function (node) {\n    var next = node;\n    while (next\n        && (next.nodeType != this.ELEMENT_NODE)\n        && this.REGEXPS.whitespace.test(next.textContent)) {\n      next = next.nextSibling;\n    }\n    return next;\n  },\n\n  /**\n   * Replaces 2 or more successive <br> elements with a single <p>.\n   * Whitespace between <br> elements are ignored. For example:\n   *   <div>foo<br>bar<br> <br><br>abc</div>\n   * will become:\n   *   <div>foo<br>bar<p>abc</p></div>\n   */\n  _replaceBrs: function (elem) {\n    this._forEachNode(this._getAllNodesWithTag(elem, [\"br\"]), function(br) {\n      var next = br.nextSibling;\n\n      // Whether 2 or more <br> elements have been found and replaced with a\n      // <p> block.\n      var replaced = false;\n\n      // If we find a <br> chain, remove the <br>s until we hit another node\n      // or non-whitespace. This leaves behind the first <br> in the chain\n      // (which will be replaced with a <p> later).\n      while ((next = this._nextNode(next)) && (next.tagName == \"BR\")) {\n        replaced = true;\n        var brSibling = next.nextSibling;\n        next.parentNode.removeChild(next);\n        next = brSibling;\n      }\n\n      // If we removed a <br> chain, replace the remaining <br> with a <p>. Add\n      // all sibling nodes as children of the <p> until we hit another <br>\n      // chain.\n      if (replaced) {\n        var p = this._doc.createElement(\"p\");\n        br.parentNode.replaceChild(p, br);\n\n        next = p.nextSibling;\n        while (next) {\n          // If we've hit another <br><br>, we're done adding children to this <p>.\n          if (next.tagName == \"BR\") {\n            var nextElem = this._nextNode(next.nextSibling);\n            if (nextElem && nextElem.tagName == \"BR\")\n              break;\n          }\n\n          if (!this._isPhrasingContent(next))\n            break;\n\n          // Otherwise, make this node a child of the new <p>.\n          var sibling = next.nextSibling;\n          p.appendChild(next);\n          next = sibling;\n        }\n\n        while (p.lastChild && this._isWhitespace(p.lastChild)) {\n          p.removeChild(p.lastChild);\n        }\n\n        if (p.parentNode.tagName === \"P\")\n          this._setNodeTag(p.parentNode, \"DIV\");\n      }\n    });\n  },\n\n  _setNodeTag: function (node, tag) {\n    this.log(\"_setNodeTag\", node, tag);\n    if (this._docJSDOMParser) {\n      node.localName = tag.toLowerCase();\n      node.tagName = tag.toUpperCase();\n      return node;\n    }\n\n    var replacement = node.ownerDocument.createElement(tag);\n    while (node.firstChild) {\n      replacement.appendChild(node.firstChild);\n    }\n    node.parentNode.replaceChild(replacement, node);\n    if (node.readability)\n      replacement.readability = node.readability;\n\n    for (var i = 0; i < node.attributes.length; i++) {\n      try {\n        replacement.setAttribute(node.attributes[i].name, node.attributes[i].value);\n      } catch (ex) {\n        /* it's possible for setAttribute() to throw if the attribute name\n         * isn't a valid XML Name. Such attributes can however be parsed from\n         * source in HTML docs, see https://github.com/whatwg/html/issues/4275,\n         * so we can hit them here and then throw. We don't care about such\n         * attributes so we ignore them.\n         */\n      }\n    }\n    return replacement;\n  },\n\n  /**\n   * Prepare the article node for display. Clean out any inline styles,\n   * iframes, forms, strip extraneous <p> tags, etc.\n   *\n   * @param Element\n   * @return void\n   **/\n  _prepArticle: function(articleContent) {\n    this._cleanStyles(articleContent);\n\n    // Check for data tables before we continue, to avoid removing items in\n    // those tables, which will often be isolated even though they're\n    // visually linked to other content-ful elements (text, images, etc.).\n    this._markDataTables(articleContent);\n\n    this._fixLazyImages(articleContent);\n\n    // Clean out junk from the article content\n    this._cleanConditionally(articleContent, \"form\");\n    this._cleanConditionally(articleContent, \"fieldset\");\n    this._clean(articleContent, \"object\");\n    this._clean(articleContent, \"embed\");\n    this._clean(articleContent, \"footer\");\n    this._clean(articleContent, \"link\");\n    this._clean(articleContent, \"aside\");\n\n    // Clean out elements with little content that have \"share\" in their id/class combinations from final top candidates,\n    // which means we don't remove the top candidates even they have \"share\".\n\n    var shareElementThreshold = this.DEFAULT_CHAR_THRESHOLD;\n\n    this._forEachNode(articleContent.children, function (topCandidate) {\n      this._cleanMatchedNodes(topCandidate, function (node, matchString) {\n        return this.REGEXPS.shareElements.test(matchString) && node.textContent.length < shareElementThreshold;\n      });\n    });\n\n    this._clean(articleContent, \"iframe\");\n    this._clean(articleContent, \"input\");\n    this._clean(articleContent, \"textarea\");\n    this._clean(articleContent, \"select\");\n    this._clean(articleContent, \"button\");\n    this._cleanHeaders(articleContent);\n\n    // Do these last as the previous stuff may have removed junk\n    // that will affect these\n    this._cleanConditionally(articleContent, \"table\");\n    this._cleanConditionally(articleContent, \"ul\");\n    this._cleanConditionally(articleContent, \"div\");\n\n    // replace H1 with H2 as H1 should be only title that is displayed separately\n    this._replaceNodeTags(this._getAllNodesWithTag(articleContent, [\"h1\"]), \"h2\");\n\n    // Remove extra paragraphs\n    this._removeNodes(this._getAllNodesWithTag(articleContent, [\"p\"]), function (paragraph) {\n      var imgCount = paragraph.getElementsByTagName(\"img\").length;\n      var embedCount = paragraph.getElementsByTagName(\"embed\").length;\n      var objectCount = paragraph.getElementsByTagName(\"object\").length;\n      // At this point, nasty iframes have been removed, only remain embedded video ones.\n      var iframeCount = paragraph.getElementsByTagName(\"iframe\").length;\n      var totalCount = imgCount + embedCount + objectCount + iframeCount;\n\n      return totalCount === 0 && !this._getInnerText(paragraph, false);\n    });\n\n    this._forEachNode(this._getAllNodesWithTag(articleContent, [\"br\"]), function(br) {\n      var next = this._nextNode(br.nextSibling);\n      if (next && next.tagName == \"P\")\n        br.parentNode.removeChild(br);\n    });\n\n    // Remove single-cell tables\n    this._forEachNode(this._getAllNodesWithTag(articleContent, [\"table\"]), function(table) {\n      var tbody = this._hasSingleTagInsideElement(table, \"TBODY\") ? table.firstElementChild : table;\n      if (this._hasSingleTagInsideElement(tbody, \"TR\")) {\n        var row = tbody.firstElementChild;\n        if (this._hasSingleTagInsideElement(row, \"TD\")) {\n          var cell = row.firstElementChild;\n          cell = this._setNodeTag(cell, this._everyNode(cell.childNodes, this._isPhrasingContent) ? \"P\" : \"DIV\");\n          table.parentNode.replaceChild(cell, table);\n        }\n      }\n    });\n  },\n\n  /**\n   * Initialize a node with the readability object. Also checks the\n   * className/id for special names to add to its score.\n   *\n   * @param Element\n   * @return void\n  **/\n  _initializeNode: function(node) {\n    node.readability = {\"contentScore\": 0};\n\n    switch (node.tagName) {\n      case \"DIV\":\n        node.readability.contentScore += 5;\n        break;\n\n      case \"PRE\":\n      case \"TD\":\n      case \"BLOCKQUOTE\":\n        node.readability.contentScore += 3;\n        break;\n\n      case \"ADDRESS\":\n      case \"OL\":\n      case \"UL\":\n      case \"DL\":\n      case \"DD\":\n      case \"DT\":\n      case \"LI\":\n      case \"FORM\":\n        node.readability.contentScore -= 3;\n        break;\n\n      case \"H1\":\n      case \"H2\":\n      case \"H3\":\n      case \"H4\":\n      case \"H5\":\n      case \"H6\":\n      case \"TH\":\n        node.readability.contentScore -= 5;\n        break;\n    }\n\n    node.readability.contentScore += this._getClassWeight(node);\n  },\n\n  _removeAndGetNext: function(node) {\n    var nextNode = this._getNextNode(node, true);\n    node.parentNode.removeChild(node);\n    return nextNode;\n  },\n\n  /**\n   * Traverse the DOM from node to node, starting at the node passed in.\n   * Pass true for the second parameter to indicate this node itself\n   * (and its kids) are going away, and we want the next node over.\n   *\n   * Calling this in a loop will traverse the DOM depth-first.\n   */\n  _getNextNode: function(node, ignoreSelfAndKids) {\n    // First check for kids if those aren't being ignored\n    if (!ignoreSelfAndKids && node.firstElementChild) {\n      return node.firstElementChild;\n    }\n    // Then for siblings...\n    if (node.nextElementSibling) {\n      return node.nextElementSibling;\n    }\n    // And finally, move up the parent chain *and* find a sibling\n    // (because this is depth-first traversal, we will have already\n    // seen the parent nodes themselves).\n    do {\n      node = node.parentNode;\n    } while (node && !node.nextElementSibling);\n    return node && node.nextElementSibling;\n  },\n\n  // compares second text to first one\n  // 1 = same text, 0 = completely different text\n  // works the way that it splits both texts into words and then finds words that are unique in second text\n  // the result is given by the lower length of unique parts\n  _textSimilarity: function(textA, textB) {\n    var tokensA = textA.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);\n    var tokensB = textB.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);\n    if (!tokensA.length || !tokensB.length) {\n      return 0;\n    }\n    var uniqTokensB = tokensB.filter(token => !tokensA.includes(token));\n    var distanceB = uniqTokensB.join(\" \").length / tokensB.join(\" \").length;\n    return 1 - distanceB;\n  },\n\n  _checkByline: function(node, matchString) {\n    if (this._articleByline) {\n      return false;\n    }\n\n    if (node.getAttribute !== undefined) {\n      var rel = node.getAttribute(\"rel\");\n      var itemprop = node.getAttribute(\"itemprop\");\n    }\n\n    if ((rel === \"author\" || (itemprop && itemprop.indexOf(\"author\") !== -1) || this.REGEXPS.byline.test(matchString)) && this._isValidByline(node.textContent)) {\n      this._articleByline = node.textContent.trim();\n      return true;\n    }\n\n    return false;\n  },\n\n  _getNodeAncestors: function(node, maxDepth) {\n    maxDepth = maxDepth || 0;\n    var i = 0, ancestors = [];\n    while (node.parentNode) {\n      ancestors.push(node.parentNode);\n      if (maxDepth && ++i === maxDepth)\n        break;\n      node = node.parentNode;\n    }\n    return ancestors;\n  },\n\n  /***\n   * grabArticle - Using a variety of metrics (content score, classname, element types), find the content that is\n   *         most likely to be the stuff a user wants to read. Then return it wrapped up in a div.\n   *\n   * @param page a document to run upon. Needs to be a full document, complete with body.\n   * @return Element\n  **/\n  _grabArticle: function (page) {\n    this.log(\"**** grabArticle ****\");\n    var doc = this._doc;\n    var isPaging = page !== null;\n    page = page ? page : this._doc.body;\n\n    // We can't grab an article if we don't have a page!\n    if (!page) {\n      this.log(\"No body found in document. Abort.\");\n      return null;\n    }\n\n    var pageCacheHtml = page.innerHTML;\n\n    while (true) {\n      this.log(\"Starting grabArticle loop\");\n      var stripUnlikelyCandidates = this._flagIsActive(this.FLAG_STRIP_UNLIKELYS);\n\n      // First, node prepping. Trash nodes that look cruddy (like ones with the\n      // class name \"comment\", etc), and turn divs into P tags where they have been\n      // used inappropriately (as in, where they contain no other block level elements.)\n      var elementsToScore = [];\n      var node = this._doc.documentElement;\n\n      let shouldRemoveTitleHeader = true;\n\n      while (node) {\n\n        if (node.tagName === \"HTML\") {\n          this._articleLang = node.getAttribute(\"lang\");\n        }\n\n        var matchString = node.className + \" \" + node.id;\n\n        if (!this._isProbablyVisible(node)) {\n          this.log(\"Removing hidden node - \" + matchString);\n          node = this._removeAndGetNext(node);\n          continue;\n        }\n\n        // User is not able to see elements applied with both \"aria-modal = true\" and \"role = dialog\"\n        if (node.getAttribute(\"aria-modal\") == \"true\" && node.getAttribute(\"role\") == \"dialog\") {\n          node = this._removeAndGetNext(node);\n          continue;\n        }\n\n        // Check to see if this node is a byline, and remove it if it is.\n        if (this._checkByline(node, matchString)) {\n          node = this._removeAndGetNext(node);\n          continue;\n        }\n\n        if (shouldRemoveTitleHeader && this._headerDuplicatesTitle(node)) {\n          this.log(\"Removing header: \", node.textContent.trim(), this._articleTitle.trim());\n          shouldRemoveTitleHeader = false;\n          node = this._removeAndGetNext(node);\n          continue;\n        }\n\n        // Remove unlikely candidates\n        if (stripUnlikelyCandidates) {\n          if (this.REGEXPS.unlikelyCandidates.test(matchString) &&\n              !this.REGEXPS.okMaybeItsACandidate.test(matchString) &&\n              !this._hasAncestorTag(node, \"table\") &&\n              !this._hasAncestorTag(node, \"code\") &&\n              node.tagName !== \"BODY\" &&\n              node.tagName !== \"A\") {\n            this.log(\"Removing unlikely candidate - \" + matchString);\n            node = this._removeAndGetNext(node);\n            continue;\n          }\n\n          if (this.UNLIKELY_ROLES.includes(node.getAttribute(\"role\"))) {\n            this.log(\"Removing content with role \" + node.getAttribute(\"role\") + \" - \" + matchString);\n            node = this._removeAndGetNext(node);\n            continue;\n          }\n        }\n\n        // Remove DIV, SECTION, and HEADER nodes without any content(e.g. text, image, video, or iframe).\n        if ((node.tagName === \"DIV\" || node.tagName === \"SECTION\" || node.tagName === \"HEADER\" ||\n             node.tagName === \"H1\" || node.tagName === \"H2\" || node.tagName === \"H3\" ||\n             node.tagName === \"H4\" || node.tagName === \"H5\" || node.tagName === \"H6\") &&\n            this._isElementWithoutContent(node)) {\n          node = this._removeAndGetNext(node);\n          continue;\n        }\n\n        if (this.DEFAULT_TAGS_TO_SCORE.indexOf(node.tagName) !== -1) {\n          elementsToScore.push(node);\n        }\n\n        // Turn all divs that don't have children block level elements into p's\n        if (node.tagName === \"DIV\") {\n          // Put phrasing content into paragraphs.\n          var p = null;\n          var childNode = node.firstChild;\n          while (childNode) {\n            var nextSibling = childNode.nextSibling;\n            if (this._isPhrasingContent(childNode)) {\n              if (p !== null) {\n                p.appendChild(childNode);\n              } else if (!this._isWhitespace(childNode)) {\n                p = doc.createElement(\"p\");\n                node.replaceChild(p, childNode);\n                p.appendChild(childNode);\n              }\n            } else if (p !== null) {\n              while (p.lastChild && this._isWhitespace(p.lastChild)) {\n                p.removeChild(p.lastChild);\n              }\n              p = null;\n            }\n            childNode = nextSibling;\n          }\n\n          // Sites like http://mobile.slate.com encloses each paragraph with a DIV\n          // element. DIVs with only a P element inside and no text content can be\n          // safely converted into plain P elements to avoid confusing the scoring\n          // algorithm with DIVs with are, in practice, paragraphs.\n          if (this._hasSingleTagInsideElement(node, \"P\") && this._getLinkDensity(node) < 0.25) {\n            var newNode = node.children[0];\n            node.parentNode.replaceChild(newNode, node);\n            node = newNode;\n            elementsToScore.push(node);\n          } else if (!this._hasChildBlockElement(node)) {\n            node = this._setNodeTag(node, \"P\");\n            elementsToScore.push(node);\n          }\n        }\n        node = this._getNextNode(node);\n      }\n\n      /**\n       * Loop through all paragraphs, and assign a score to them based on how content-y they look.\n       * Then add their score to their parent node.\n       *\n       * A score is determined by things like number of commas, class names, etc. Maybe eventually link density.\n      **/\n      var candidates = [];\n      this._forEachNode(elementsToScore, function(elementToScore) {\n        if (!elementToScore.parentNode || typeof(elementToScore.parentNode.tagName) === \"undefined\")\n          return;\n\n        // If this paragraph is less than 25 characters, don't even count it.\n        var innerText = this._getInnerText(elementToScore);\n        if (innerText.length < 25)\n          return;\n\n        // Exclude nodes with no ancestor.\n        var ancestors = this._getNodeAncestors(elementToScore, 5);\n        if (ancestors.length === 0)\n          return;\n\n        var contentScore = 0;\n\n        // Add a point for the paragraph itself as a base.\n        contentScore += 1;\n\n        // Add points for any commas within this paragraph.\n        contentScore += innerText.split(\",\").length;\n\n        // For every 100 characters in this paragraph, add another point. Up to 3 points.\n        contentScore += Math.min(Math.floor(innerText.length / 100), 3);\n\n        // Initialize and score ancestors.\n        this._forEachNode(ancestors, function(ancestor, level) {\n          if (!ancestor.tagName || !ancestor.parentNode || typeof(ancestor.parentNode.tagName) === \"undefined\")\n            return;\n\n          if (typeof(ancestor.readability) === \"undefined\") {\n            this._initializeNode(ancestor);\n            candidates.push(ancestor);\n          }\n\n          // Node score divider:\n          // - parent:             1 (no division)\n          // - grandparent:        2\n          // - great grandparent+: ancestor level * 3\n          if (level === 0)\n            var scoreDivider = 1;\n          else if (level === 1)\n            scoreDivider = 2;\n          else\n            scoreDivider = level * 3;\n          ancestor.readability.contentScore += contentScore / scoreDivider;\n        });\n      });\n\n      // After we've calculated scores, loop through all of the possible\n      // candidate nodes we found and find the one with the highest score.\n      var topCandidates = [];\n      for (var c = 0, cl = candidates.length; c < cl; c += 1) {\n        var candidate = candidates[c];\n\n        // Scale the final candidates score based on link density. Good content\n        // should have a relatively small link density (5% or less) and be mostly\n        // unaffected by this operation.\n        var candidateScore = candidate.readability.contentScore * (1 - this._getLinkDensity(candidate));\n        candidate.readability.contentScore = candidateScore;\n\n        this.log(\"Candidate:\", candidate, \"with score \" + candidateScore);\n\n        for (var t = 0; t < this._nbTopCandidates; t++) {\n          var aTopCandidate = topCandidates[t];\n\n          if (!aTopCandidate || candidateScore > aTopCandidate.readability.contentScore) {\n            topCandidates.splice(t, 0, candidate);\n            if (topCandidates.length > this._nbTopCandidates)\n              topCandidates.pop();\n            break;\n          }\n        }\n      }\n\n      var topCandidate = topCandidates[0] || null;\n      var neededToCreateTopCandidate = false;\n      var parentOfTopCandidate;\n\n      // If we still have no top candidate, just use the body as a last resort.\n      // We also have to copy the body node so it is something we can modify.\n      if (topCandidate === null || topCandidate.tagName === \"BODY\") {\n        // Move all of the page's children into topCandidate\n        topCandidate = doc.createElement(\"DIV\");\n        neededToCreateTopCandidate = true;\n        // Move everything (not just elements, also text nodes etc.) into the container\n        // so we even include text directly in the body:\n        while (page.firstChild) {\n          this.log(\"Moving child out:\", page.firstChild);\n          topCandidate.appendChild(page.firstChild);\n        }\n\n        page.appendChild(topCandidate);\n\n        this._initializeNode(topCandidate);\n      } else if (topCandidate) {\n        // Find a better top candidate node if it contains (at least three) nodes which belong to `topCandidates` array\n        // and whose scores are quite closed with current `topCandidate` node.\n        var alternativeCandidateAncestors = [];\n        for (var i = 1; i < topCandidates.length; i++) {\n          if (topCandidates[i].readability.contentScore / topCandidate.readability.contentScore >= 0.75) {\n            alternativeCandidateAncestors.push(this._getNodeAncestors(topCandidates[i]));\n          }\n        }\n        var MINIMUM_TOPCANDIDATES = 3;\n        if (alternativeCandidateAncestors.length >= MINIMUM_TOPCANDIDATES) {\n          parentOfTopCandidate = topCandidate.parentNode;\n          while (parentOfTopCandidate.tagName !== \"BODY\") {\n            var listsContainingThisAncestor = 0;\n            for (var ancestorIndex = 0; ancestorIndex < alternativeCandidateAncestors.length && listsContainingThisAncestor < MINIMUM_TOPCANDIDATES; ancestorIndex++) {\n              listsContainingThisAncestor += Number(alternativeCandidateAncestors[ancestorIndex].includes(parentOfTopCandidate));\n            }\n            if (listsContainingThisAncestor >= MINIMUM_TOPCANDIDATES) {\n              topCandidate = parentOfTopCandidate;\n              break;\n            }\n            parentOfTopCandidate = parentOfTopCandidate.parentNode;\n          }\n        }\n        if (!topCandidate.readability) {\n          this._initializeNode(topCandidate);\n        }\n\n        // Because of our bonus system, parents of candidates might have scores\n        // themselves. They get half of the node. There won't be nodes with higher\n        // scores than our topCandidate, but if we see the score going *up* in the first\n        // few steps up the tree, that's a decent sign that there might be more content\n        // lurking in other places that we want to unify in. The sibling stuff\n        // below does some of that - but only if we've looked high enough up the DOM\n        // tree.\n        parentOfTopCandidate = topCandidate.parentNode;\n        var lastScore = topCandidate.readability.contentScore;\n        // The scores shouldn't get too low.\n        var scoreThreshold = lastScore / 3;\n        while (parentOfTopCandidate.tagName !== \"BODY\") {\n          if (!parentOfTopCandidate.readability) {\n            parentOfTopCandidate = parentOfTopCandidate.parentNode;\n            continue;\n          }\n          var parentScore = parentOfTopCandidate.readability.contentScore;\n          if (parentScore < scoreThreshold)\n            break;\n          if (parentScore > lastScore) {\n            // Alright! We found a better parent to use.\n            topCandidate = parentOfTopCandidate;\n            break;\n          }\n          lastScore = parentOfTopCandidate.readability.contentScore;\n          parentOfTopCandidate = parentOfTopCandidate.parentNode;\n        }\n\n        // If the top candidate is the only child, use parent instead. This will help sibling\n        // joining logic when adjacent content is actually located in parent's sibling node.\n        parentOfTopCandidate = topCandidate.parentNode;\n        while (parentOfTopCandidate.tagName != \"BODY\" && parentOfTopCandidate.children.length == 1) {\n          topCandidate = parentOfTopCandidate;\n          parentOfTopCandidate = topCandidate.parentNode;\n        }\n        if (!topCandidate.readability) {\n          this._initializeNode(topCandidate);\n        }\n      }\n\n      // Now that we have the top candidate, look through its siblings for content\n      // that might also be related. Things like preambles, content split by ads\n      // that we removed, etc.\n      var articleContent = doc.createElement(\"DIV\");\n      if (isPaging)\n        articleContent.id = \"readability-content\";\n\n      var siblingScoreThreshold = Math.max(10, topCandidate.readability.contentScore * 0.2);\n      // Keep potential top candidate's parent node to try to get text direction of it later.\n      parentOfTopCandidate = topCandidate.parentNode;\n      var siblings = parentOfTopCandidate.children;\n\n      for (var s = 0, sl = siblings.length; s < sl; s++) {\n        var sibling = siblings[s];\n        var append = false;\n\n        this.log(\"Looking at sibling node:\", sibling, sibling.readability ? (\"with score \" + sibling.readability.contentScore) : \"\");\n        this.log(\"Sibling has score\", sibling.readability ? sibling.readability.contentScore : \"Unknown\");\n\n        if (sibling === topCandidate) {\n          append = true;\n        } else {\n          var contentBonus = 0;\n\n          // Give a bonus if sibling nodes and top candidates have the example same classname\n          if (sibling.className === topCandidate.className && topCandidate.className !== \"\")\n            contentBonus += topCandidate.readability.contentScore * 0.2;\n\n          if (sibling.readability &&\n              ((sibling.readability.contentScore + contentBonus) >= siblingScoreThreshold)) {\n            append = true;\n          } else if (sibling.nodeName === \"P\") {\n            var linkDensity = this._getLinkDensity(sibling);\n            var nodeContent = this._getInnerText(sibling);\n            var nodeLength = nodeContent.length;\n\n            if (nodeLength > 80 && linkDensity < 0.25) {\n              append = true;\n            } else if (nodeLength < 80 && nodeLength > 0 && linkDensity === 0 &&\n                       nodeContent.search(/\\.( |$)/) !== -1) {\n              append = true;\n            }\n          }\n        }\n\n        if (append) {\n          this.log(\"Appending node:\", sibling);\n\n          if (this.ALTER_TO_DIV_EXCEPTIONS.indexOf(sibling.nodeName) === -1) {\n            // We have a node that isn't a common block level element, like a form or td tag.\n            // Turn it into a div so it doesn't get filtered out later by accident.\n            this.log(\"Altering sibling:\", sibling, \"to div.\");\n\n            sibling = this._setNodeTag(sibling, \"DIV\");\n          }\n\n          articleContent.appendChild(sibling);\n          // Fetch children again to make it compatible\n          // with DOM parsers without live collection support.\n          siblings = parentOfTopCandidate.children;\n          // siblings is a reference to the children array, and\n          // sibling is removed from the array when we call appendChild().\n          // As a result, we must revisit this index since the nodes\n          // have been shifted.\n          s -= 1;\n          sl -= 1;\n        }\n      }\n\n      if (this._debug)\n        this.log(\"Article content pre-prep: \" + articleContent.innerHTML);\n      // So we have all of the content that we need. Now we clean it up for presentation.\n      this._prepArticle(articleContent);\n      if (this._debug)\n        this.log(\"Article content post-prep: \" + articleContent.innerHTML);\n\n      if (neededToCreateTopCandidate) {\n        // We already created a fake div thing, and there wouldn't have been any siblings left\n        // for the previous loop, so there's no point trying to create a new div, and then\n        // move all the children over. Just assign IDs and class names here. No need to append\n        // because that already happened anyway.\n        topCandidate.id = \"readability-page-1\";\n        topCandidate.className = \"page\";\n      } else {\n        var div = doc.createElement(\"DIV\");\n        div.id = \"readability-page-1\";\n        div.className = \"page\";\n        while (articleContent.firstChild) {\n          div.appendChild(articleContent.firstChild);\n        }\n        articleContent.appendChild(div);\n      }\n\n      if (this._debug)\n        this.log(\"Article content after paging: \" + articleContent.innerHTML);\n\n      var parseSuccessful = true;\n\n      // Now that we've gone through the full algorithm, check to see if\n      // we got any meaningful content. If we didn't, we may need to re-run\n      // grabArticle with different flags set. This gives us a higher likelihood of\n      // finding the content, and the sieve approach gives us a higher likelihood of\n      // finding the -right- content.\n      var textLength = this._getInnerText(articleContent, true).length;\n      if (textLength < this._charThreshold) {\n        parseSuccessful = false;\n        page.innerHTML = pageCacheHtml;\n\n        if (this._flagIsActive(this.FLAG_STRIP_UNLIKELYS)) {\n          this._removeFlag(this.FLAG_STRIP_UNLIKELYS);\n          this._attempts.push({articleContent: articleContent, textLength: textLength});\n        } else if (this._flagIsActive(this.FLAG_WEIGHT_CLASSES)) {\n          this._removeFlag(this.FLAG_WEIGHT_CLASSES);\n          this._attempts.push({articleContent: articleContent, textLength: textLength});\n        } else if (this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)) {\n          this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY);\n          this._attempts.push({articleContent: articleContent, textLength: textLength});\n        } else {\n          this._attempts.push({articleContent: articleContent, textLength: textLength});\n          // No luck after removing flags, just return the longest text we found during the different loops\n          this._attempts.sort(function (a, b) {\n            return b.textLength - a.textLength;\n          });\n\n          // But first check if we actually have something\n          if (!this._attempts[0].textLength) {\n            return null;\n          }\n\n          articleContent = this._attempts[0].articleContent;\n          parseSuccessful = true;\n        }\n      }\n\n      if (parseSuccessful) {\n        // Find out text direction from ancestors of final top candidate.\n        var ancestors = [parentOfTopCandidate, topCandidate].concat(this._getNodeAncestors(parentOfTopCandidate));\n        this._someNode(ancestors, function(ancestor) {\n          if (!ancestor.tagName)\n            return false;\n          var articleDir = ancestor.getAttribute(\"dir\");\n          if (articleDir) {\n            this._articleDir = articleDir;\n            return true;\n          }\n          return false;\n        });\n        return articleContent;\n      }\n    }\n  },\n\n  /**\n   * Check whether the input string could be a byline.\n   * This verifies that the input is a string, and that the length\n   * is less than 100 chars.\n   *\n   * @param possibleByline {string} - a string to check whether its a byline.\n   * @return Boolean - whether the input string is a byline.\n   */\n  _isValidByline: function(byline) {\n    if (typeof byline == \"string\" || byline instanceof String) {\n      byline = byline.trim();\n      return (byline.length > 0) && (byline.length < 100);\n    }\n    return false;\n  },\n\n  /**\n   * Converts some of the common HTML entities in string to their corresponding characters.\n   *\n   * @param str {string} - a string to unescape.\n   * @return string without HTML entity.\n   */\n  _unescapeHtmlEntities: function(str) {\n    if (!str) {\n      return str;\n    }\n\n    var htmlEscapeMap = this.HTML_ESCAPE_MAP;\n    return str.replace(/&(quot|amp|apos|lt|gt);/g, function(_, tag) {\n      return htmlEscapeMap[tag];\n    }).replace(/&#(?:x([0-9a-z]{1,4})|([0-9]{1,4}));/gi, function(_, hex, numStr) {\n      var num = parseInt(hex || numStr, hex ? 16 : 10);\n      return String.fromCharCode(num);\n    });\n  },\n\n  /**\n   * Try to extract metadata from JSON-LD object.\n   * For now, only Schema.org objects of type Article or its subtypes are supported.\n   * @return Object with any metadata that could be extracted (possibly none)\n   */\n  _getJSONLD: function (doc) {\n    var scripts = this._getAllNodesWithTag(doc, [\"script\"]);\n\n    var metadata;\n\n    this._forEachNode(scripts, function(jsonLdElement) {\n      if (!metadata && jsonLdElement.getAttribute(\"type\") === \"application/ld+json\") {\n        try {\n          // Strip CDATA markers if present\n          var content = jsonLdElement.textContent.replace(/^\\s*<!\\[CDATA\\[|\\]\\]>\\s*$/g, \"\");\n          var parsed = JSON.parse(content);\n          if (\n            !parsed[\"@context\"] ||\n            !parsed[\"@context\"].match(/^https?\\:\\/\\/schema\\.org$/)\n          ) {\n            return;\n          }\n\n          if (!parsed[\"@type\"] && Array.isArray(parsed[\"@graph\"])) {\n            parsed = parsed[\"@graph\"].find(function(it) {\n              return (it[\"@type\"] || \"\").match(\n                this.REGEXPS.jsonLdArticleTypes\n              );\n            });\n          }\n\n          if (\n            !parsed ||\n            !parsed[\"@type\"] ||\n            !parsed[\"@type\"].match(this.REGEXPS.jsonLdArticleTypes)\n          ) {\n            return;\n          }\n\n          metadata = {};\n\n          if (typeof parsed.name === \"string\" && typeof parsed.headline === \"string\" && parsed.name !== parsed.headline) {\n            // we have both name and headline element in the JSON-LD. They should both be the same but some websites like aktualne.cz\n            // put their own name into \"name\" and the article title to \"headline\" which confuses Readability. So we try to check if either\n            // \"name\" or \"headline\" closely matches the html title, and if so, use that one. If not, then we use \"name\" by default.\n\n            var title = this._getArticleTitle();\n            var nameMatches = this._textSimilarity(parsed.name, title) > 0.75;\n            var headlineMatches = this._textSimilarity(parsed.headline, title) > 0.75;\n\n            if (headlineMatches && !nameMatches) {\n              metadata.title = parsed.headline;\n            } else {\n              metadata.title = parsed.name;\n            }\n          } else if (typeof parsed.name === \"string\") {\n            metadata.title = parsed.name.trim();\n          } else if (typeof parsed.headline === \"string\") {\n            metadata.title = parsed.headline.trim();\n          }\n          if (parsed.author) {\n            if (typeof parsed.author.name === \"string\") {\n              metadata.byline = parsed.author.name.trim();\n            } else if (Array.isArray(parsed.author) && parsed.author[0] && typeof parsed.author[0].name === \"string\") {\n              metadata.byline = parsed.author\n                .filter(function(author) {\n                  return author && typeof author.name === \"string\";\n                })\n                .map(function(author) {\n                  return author.name.trim();\n                })\n                .join(\", \");\n            }\n          }\n          if (typeof parsed.description === \"string\") {\n            metadata.excerpt = parsed.description.trim();\n          }\n          if (\n            parsed.publisher &&\n            typeof parsed.publisher.name === \"string\"\n          ) {\n            metadata.siteName = parsed.publisher.name.trim();\n          }\n          return;\n        } catch (err) {\n          this.log(err.message);\n        }\n      }\n    });\n    return metadata ? metadata : {};\n  },\n\n  /**\n   * Attempts to get excerpt and byline metadata for the article.\n   *\n   * @param {Object} jsonld — object containing any metadata that\n   * could be extracted from JSON-LD object.\n   *\n   * @return Object with optional \"excerpt\" and \"byline\" properties\n   */\n  _getArticleMetadata: function(jsonld) {\n    var metadata = {};\n    var values = {};\n    var metaElements = this._doc.getElementsByTagName(\"meta\");\n\n    // property is a space-separated list of values\n    var propertyPattern = /\\s*(dc|dcterm|og|twitter)\\s*:\\s*(author|creator|description|title|site_name)\\s*/gi;\n\n    // name is a single value\n    var namePattern = /^\\s*(?:(dc|dcterm|og|twitter|weibo:(article|webpage))\\s*[\\.:]\\s*)?(author|creator|description|title|site_name)\\s*$/i;\n\n    // Find description tags.\n    this._forEachNode(metaElements, function(element) {\n      var elementName = element.getAttribute(\"name\");\n      var elementProperty = element.getAttribute(\"property\");\n      var content = element.getAttribute(\"content\");\n      if (!content) {\n        return;\n      }\n      var matches = null;\n      var name = null;\n\n      if (elementProperty) {\n        matches = elementProperty.match(propertyPattern);\n        if (matches) {\n          // Convert to lowercase, and remove any whitespace\n          // so we can match below.\n          name = matches[0].toLowerCase().replace(/\\s/g, \"\");\n          // multiple authors\n          values[name] = content.trim();\n        }\n      }\n      if (!matches && elementName && namePattern.test(elementName)) {\n        name = elementName;\n        if (content) {\n          // Convert to lowercase, remove any whitespace, and convert dots\n          // to colons so we can match below.\n          name = name.toLowerCase().replace(/\\s/g, \"\").replace(/\\./g, \":\");\n          values[name] = content.trim();\n        }\n      }\n    });\n\n    // get title\n    metadata.title = jsonld.title ||\n                     values[\"dc:title\"] ||\n                     values[\"dcterm:title\"] ||\n                     values[\"og:title\"] ||\n                     values[\"weibo:article:title\"] ||\n                     values[\"weibo:webpage:title\"] ||\n                     values[\"title\"] ||\n                     values[\"twitter:title\"];\n\n    if (!metadata.title) {\n      metadata.title = this._getArticleTitle();\n    }\n\n    // get author\n    metadata.byline = jsonld.byline ||\n                      values[\"dc:creator\"] ||\n                      values[\"dcterm:creator\"] ||\n                      values[\"author\"];\n\n    // get description\n    metadata.excerpt = jsonld.excerpt ||\n                       values[\"dc:description\"] ||\n                       values[\"dcterm:description\"] ||\n                       values[\"og:description\"] ||\n                       values[\"weibo:article:description\"] ||\n                       values[\"weibo:webpage:description\"] ||\n                       values[\"description\"] ||\n                       values[\"twitter:description\"];\n\n    // get site name\n    metadata.siteName = jsonld.siteName ||\n                        values[\"og:site_name\"];\n\n    // in many sites the meta value is escaped with HTML entities,\n    // so here we need to unescape it\n    metadata.title = this._unescapeHtmlEntities(metadata.title);\n    metadata.byline = this._unescapeHtmlEntities(metadata.byline);\n    metadata.excerpt = this._unescapeHtmlEntities(metadata.excerpt);\n    metadata.siteName = this._unescapeHtmlEntities(metadata.siteName);\n\n    return metadata;\n  },\n\n  /**\n   * Check if node is image, or if node contains exactly only one image\n   * whether as a direct child or as its descendants.\n   *\n   * @param Element\n  **/\n  _isSingleImage: function(node) {\n    if (node.tagName === \"IMG\") {\n      return true;\n    }\n\n    if (node.children.length !== 1 || node.textContent.trim() !== \"\") {\n      return false;\n    }\n\n    return this._isSingleImage(node.children[0]);\n  },\n\n  /**\n   * Find all <noscript> that are located after <img> nodes, and which contain only one\n   * <img> element. Replace the first image with the image from inside the <noscript> tag,\n   * and remove the <noscript> tag. This improves the quality of the images we use on\n   * some sites (e.g. Medium).\n   *\n   * @param Element\n  **/\n  _unwrapNoscriptImages: function(doc) {\n    // Find img without source or attributes that might contains image, and remove it.\n    // This is done to prevent a placeholder img is replaced by img from noscript in next step.\n    var imgs = Array.from(doc.getElementsByTagName(\"img\"));\n    this._forEachNode(imgs, function(img) {\n      for (var i = 0; i < img.attributes.length; i++) {\n        var attr = img.attributes[i];\n        switch (attr.name) {\n          case \"src\":\n          case \"srcset\":\n          case \"data-src\":\n          case \"data-srcset\":\n            return;\n        }\n\n        if (/\\.(jpg|jpeg|png|webp)/i.test(attr.value)) {\n          return;\n        }\n      }\n\n      img.parentNode.removeChild(img);\n    });\n\n    // Next find noscript and try to extract its image\n    var noscripts = Array.from(doc.getElementsByTagName(\"noscript\"));\n    this._forEachNode(noscripts, function(noscript) {\n      // Parse content of noscript and make sure it only contains image\n      var tmp = doc.createElement(\"div\");\n      tmp.innerHTML = noscript.innerHTML;\n      if (!this._isSingleImage(tmp)) {\n        return;\n      }\n\n      // If noscript has previous sibling and it only contains image,\n      // replace it with noscript content. However we also keep old\n      // attributes that might contains image.\n      var prevElement = noscript.previousElementSibling;\n      if (prevElement && this._isSingleImage(prevElement)) {\n        var prevImg = prevElement;\n        if (prevImg.tagName !== \"IMG\") {\n          prevImg = prevElement.getElementsByTagName(\"img\")[0];\n        }\n\n        var newImg = tmp.getElementsByTagName(\"img\")[0];\n        for (var i = 0; i < prevImg.attributes.length; i++) {\n          var attr = prevImg.attributes[i];\n          if (attr.value === \"\") {\n            continue;\n          }\n\n          if (attr.name === \"src\" || attr.name === \"srcset\" || /\\.(jpg|jpeg|png|webp)/i.test(attr.value)) {\n            if (newImg.getAttribute(attr.name) === attr.value) {\n              continue;\n            }\n\n            var attrName = attr.name;\n            if (newImg.hasAttribute(attrName)) {\n              attrName = \"data-old-\" + attrName;\n            }\n\n            newImg.setAttribute(attrName, attr.value);\n          }\n        }\n\n        noscript.parentNode.replaceChild(tmp.firstElementChild, prevElement);\n      }\n    });\n  },\n\n  /**\n   * Removes script tags from the document.\n   *\n   * @param Element\n  **/\n  _removeScripts: function(doc) {\n    this._removeNodes(this._getAllNodesWithTag(doc, [\"script\", \"noscript\"]));\n  },\n\n  /**\n   * Check if this node has only whitespace and a single element with given tag\n   * Returns false if the DIV node contains non-empty text nodes\n   * or if it contains no element with given tag or more than 1 element.\n   *\n   * @param Element\n   * @param string tag of child element\n  **/\n  _hasSingleTagInsideElement: function(element, tag) {\n    // There should be exactly 1 element child with given tag\n    if (element.children.length != 1 || element.children[0].tagName !== tag) {\n      return false;\n    }\n\n    // And there should be no text nodes with real content\n    return !this._someNode(element.childNodes, function(node) {\n      return node.nodeType === this.TEXT_NODE &&\n             this.REGEXPS.hasContent.test(node.textContent);\n    });\n  },\n\n  _isElementWithoutContent: function(node) {\n    return node.nodeType === this.ELEMENT_NODE &&\n      node.textContent.trim().length == 0 &&\n      (node.children.length == 0 ||\n       node.children.length == node.getElementsByTagName(\"br\").length + node.getElementsByTagName(\"hr\").length);\n  },\n\n  /**\n   * Determine whether element has any children block level elements.\n   *\n   * @param Element\n   */\n  _hasChildBlockElement: function (element) {\n    return this._someNode(element.childNodes, function(node) {\n      return this.DIV_TO_P_ELEMS.has(node.tagName) ||\n             this._hasChildBlockElement(node);\n    });\n  },\n\n  /***\n   * Determine if a node qualifies as phrasing content.\n   * https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Content_categories#Phrasing_content\n  **/\n  _isPhrasingContent: function(node) {\n    return node.nodeType === this.TEXT_NODE || this.PHRASING_ELEMS.indexOf(node.tagName) !== -1 ||\n      ((node.tagName === \"A\" || node.tagName === \"DEL\" || node.tagName === \"INS\") &&\n        this._everyNode(node.childNodes, this._isPhrasingContent));\n  },\n\n  _isWhitespace: function(node) {\n    return (node.nodeType === this.TEXT_NODE && node.textContent.trim().length === 0) ||\n           (node.nodeType === this.ELEMENT_NODE && node.tagName === \"BR\");\n  },\n\n  /**\n   * Get the inner text of a node - cross browser compatibly.\n   * This also strips out any excess whitespace to be found.\n   *\n   * @param Element\n   * @param Boolean normalizeSpaces (default: true)\n   * @return string\n  **/\n  _getInnerText: function(e, normalizeSpaces) {\n    normalizeSpaces = (typeof normalizeSpaces === \"undefined\") ? true : normalizeSpaces;\n    var textContent = e.textContent.trim();\n\n    if (normalizeSpaces) {\n      return textContent.replace(this.REGEXPS.normalize, \" \");\n    }\n    return textContent;\n  },\n\n  /**\n   * Get the number of times a string s appears in the node e.\n   *\n   * @param Element\n   * @param string - what to split on. Default is \",\"\n   * @return number (integer)\n  **/\n  _getCharCount: function(e, s) {\n    s = s || \",\";\n    return this._getInnerText(e).split(s).length - 1;\n  },\n\n  /**\n   * Remove the style attribute on every e and under.\n   * TODO: Test if getElementsByTagName(*) is faster.\n   *\n   * @param Element\n   * @return void\n  **/\n  _cleanStyles: function(e) {\n    if (!e || e.tagName.toLowerCase() === \"svg\")\n      return;\n\n    // Remove `style` and deprecated presentational attributes\n    for (var i = 0; i < this.PRESENTATIONAL_ATTRIBUTES.length; i++) {\n      e.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[i]);\n    }\n\n    if (this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.indexOf(e.tagName) !== -1) {\n      e.removeAttribute(\"width\");\n      e.removeAttribute(\"height\");\n    }\n\n    var cur = e.firstElementChild;\n    while (cur !== null) {\n      this._cleanStyles(cur);\n      cur = cur.nextElementSibling;\n    }\n  },\n\n  /**\n   * Get the density of links as a percentage of the content\n   * This is the amount of text that is inside a link divided by the total text in the node.\n   *\n   * @param Element\n   * @return number (float)\n  **/\n  _getLinkDensity: function(element) {\n    var textLength = this._getInnerText(element).length;\n    if (textLength === 0)\n      return 0;\n\n    var linkLength = 0;\n\n    // XXX implement _reduceNodeList?\n    this._forEachNode(element.getElementsByTagName(\"a\"), function(linkNode) {\n      var href = linkNode.getAttribute(\"href\");\n      var coefficient = href && this.REGEXPS.hashUrl.test(href) ? 0.3 : 1;\n      linkLength += this._getInnerText(linkNode).length * coefficient;\n    });\n\n    return linkLength / textLength;\n  },\n\n  /**\n   * Get an elements class/id weight. Uses regular expressions to tell if this\n   * element looks good or bad.\n   *\n   * @param Element\n   * @return number (Integer)\n  **/\n  _getClassWeight: function(e) {\n    if (!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))\n      return 0;\n\n    var weight = 0;\n\n    // Look for a special classname\n    if (typeof(e.className) === \"string\" && e.className !== \"\") {\n      if (this.REGEXPS.negative.test(e.className))\n        weight -= 25;\n\n      if (this.REGEXPS.positive.test(e.className))\n        weight += 25;\n    }\n\n    // Look for a special ID\n    if (typeof(e.id) === \"string\" && e.id !== \"\") {\n      if (this.REGEXPS.negative.test(e.id))\n        weight -= 25;\n\n      if (this.REGEXPS.positive.test(e.id))\n        weight += 25;\n    }\n\n    return weight;\n  },\n\n  /**\n   * Clean a node of all elements of type \"tag\".\n   * (Unless it's a youtube/vimeo video. People love movies.)\n   *\n   * @param Element\n   * @param string tag to clean\n   * @return void\n   **/\n  _clean: function(e, tag) {\n    var isEmbed = [\"object\", \"embed\", \"iframe\"].indexOf(tag) !== -1;\n\n    this._removeNodes(this._getAllNodesWithTag(e, [tag]), function(element) {\n      // Allow youtube and vimeo videos through as people usually want to see those.\n      if (isEmbed) {\n        // First, check the elements attributes to see if any of them contain youtube or vimeo\n        for (var i = 0; i < element.attributes.length; i++) {\n          if (this._allowedVideoRegex.test(element.attributes[i].value)) {\n            return false;\n          }\n        }\n\n        // For embed with <object> tag, check inner HTML as well.\n        if (element.tagName === \"object\" && this._allowedVideoRegex.test(element.innerHTML)) {\n          return false;\n        }\n      }\n\n      return true;\n    });\n  },\n\n  /**\n   * Check if a given node has one of its ancestor tag name matching the\n   * provided one.\n   * @param  HTMLElement node\n   * @param  String      tagName\n   * @param  Number      maxDepth\n   * @param  Function    filterFn a filter to invoke to determine whether this node 'counts'\n   * @return Boolean\n   */\n  _hasAncestorTag: function(node, tagName, maxDepth, filterFn) {\n    maxDepth = maxDepth || 3;\n    tagName = tagName.toUpperCase();\n    var depth = 0;\n    while (node.parentNode) {\n      if (maxDepth > 0 && depth > maxDepth)\n        return false;\n      if (node.parentNode.tagName === tagName && (!filterFn || filterFn(node.parentNode)))\n        return true;\n      node = node.parentNode;\n      depth++;\n    }\n    return false;\n  },\n\n  /**\n   * Return an object indicating how many rows and columns this table has.\n   */\n  _getRowAndColumnCount: function(table) {\n    var rows = 0;\n    var columns = 0;\n    var trs = table.getElementsByTagName(\"tr\");\n    for (var i = 0; i < trs.length; i++) {\n      var rowspan = trs[i].getAttribute(\"rowspan\") || 0;\n      if (rowspan) {\n        rowspan = parseInt(rowspan, 10);\n      }\n      rows += (rowspan || 1);\n\n      // Now look for column-related info\n      var columnsInThisRow = 0;\n      var cells = trs[i].getElementsByTagName(\"td\");\n      for (var j = 0; j < cells.length; j++) {\n        var colspan = cells[j].getAttribute(\"colspan\") || 0;\n        if (colspan) {\n          colspan = parseInt(colspan, 10);\n        }\n        columnsInThisRow += (colspan || 1);\n      }\n      columns = Math.max(columns, columnsInThisRow);\n    }\n    return {rows: rows, columns: columns};\n  },\n\n  /**\n   * Look for 'data' (as opposed to 'layout') tables, for which we use\n   * similar checks as\n   * https://searchfox.org/mozilla-central/rev/f82d5c549f046cb64ce5602bfd894b7ae807c8f8/accessible/generic/TableAccessible.cpp#19\n   */\n  _markDataTables: function(root) {\n    var tables = root.getElementsByTagName(\"table\");\n    for (var i = 0; i < tables.length; i++) {\n      var table = tables[i];\n      var role = table.getAttribute(\"role\");\n      if (role == \"presentation\") {\n        table._readabilityDataTable = false;\n        continue;\n      }\n      var datatable = table.getAttribute(\"datatable\");\n      if (datatable == \"0\") {\n        table._readabilityDataTable = false;\n        continue;\n      }\n      var summary = table.getAttribute(\"summary\");\n      if (summary) {\n        table._readabilityDataTable = true;\n        continue;\n      }\n\n      var caption = table.getElementsByTagName(\"caption\")[0];\n      if (caption && caption.childNodes.length > 0) {\n        table._readabilityDataTable = true;\n        continue;\n      }\n\n      // If the table has a descendant with any of these tags, consider a data table:\n      var dataTableDescendants = [\"col\", \"colgroup\", \"tfoot\", \"thead\", \"th\"];\n      var descendantExists = function(tag) {\n        return !!table.getElementsByTagName(tag)[0];\n      };\n      if (dataTableDescendants.some(descendantExists)) {\n        this.log(\"Data table because found data-y descendant\");\n        table._readabilityDataTable = true;\n        continue;\n      }\n\n      // Nested tables indicate a layout table:\n      if (table.getElementsByTagName(\"table\")[0]) {\n        table._readabilityDataTable = false;\n        continue;\n      }\n\n      var sizeInfo = this._getRowAndColumnCount(table);\n      if (sizeInfo.rows >= 10 || sizeInfo.columns > 4) {\n        table._readabilityDataTable = true;\n        continue;\n      }\n      // Now just go by size entirely:\n      table._readabilityDataTable = sizeInfo.rows * sizeInfo.columns > 10;\n    }\n  },\n\n  /* convert images and figures that have properties like data-src into images that can be loaded without JS */\n  _fixLazyImages: function (root) {\n    this._forEachNode(this._getAllNodesWithTag(root, [\"img\", \"picture\", \"figure\"]), function (elem) {\n      // In some sites (e.g. Kotaku), they put 1px square image as base64 data uri in the src attribute.\n      // So, here we check if the data uri is too short, just might as well remove it.\n      if (elem.src && this.REGEXPS.b64DataUrl.test(elem.src)) {\n        // Make sure it's not SVG, because SVG can have a meaningful image in under 133 bytes.\n        var parts = this.REGEXPS.b64DataUrl.exec(elem.src);\n        if (parts[1] === \"image/svg+xml\") {\n          return;\n        }\n\n        // Make sure this element has other attributes which contains image.\n        // If it doesn't, then this src is important and shouldn't be removed.\n        var srcCouldBeRemoved = false;\n        for (var i = 0; i < elem.attributes.length; i++) {\n          var attr = elem.attributes[i];\n          if (attr.name === \"src\") {\n            continue;\n          }\n\n          if (/\\.(jpg|jpeg|png|webp)/i.test(attr.value)) {\n            srcCouldBeRemoved = true;\n            break;\n          }\n        }\n\n        // Here we assume if image is less than 100 bytes (or 133B after encoded to base64)\n        // it will be too small, therefore it might be placeholder image.\n        if (srcCouldBeRemoved) {\n          var b64starts = elem.src.search(/base64\\s*/i) + 7;\n          var b64length = elem.src.length - b64starts;\n          if (b64length < 133) {\n            elem.removeAttribute(\"src\");\n          }\n        }\n      }\n\n      // also check for \"null\" to work around https://github.com/jsdom/jsdom/issues/2580\n      if ((elem.src || (elem.srcset && elem.srcset != \"null\")) && elem.className.toLowerCase().indexOf(\"lazy\") === -1) {\n        return;\n      }\n\n      for (var j = 0; j < elem.attributes.length; j++) {\n        attr = elem.attributes[j];\n        if (attr.name === \"src\" || attr.name === \"srcset\" || attr.name === \"alt\") {\n          continue;\n        }\n        var copyTo = null;\n        if (/\\.(jpg|jpeg|png|webp)\\s+\\d/.test(attr.value)) {\n          copyTo = \"srcset\";\n        } else if (/^\\s*\\S+\\.(jpg|jpeg|png|webp)\\S*\\s*$/.test(attr.value)) {\n          copyTo = \"src\";\n        }\n        if (copyTo) {\n          //if this is an img or picture, set the attribute directly\n          if (elem.tagName === \"IMG\" || elem.tagName === \"PICTURE\") {\n            elem.setAttribute(copyTo, attr.value);\n          } else if (elem.tagName === \"FIGURE\" && !this._getAllNodesWithTag(elem, [\"img\", \"picture\"]).length) {\n            //if the item is a <figure> that does not contain an image or picture, create one and place it inside the figure\n            //see the nytimes-3 testcase for an example\n            var img = this._doc.createElement(\"img\");\n            img.setAttribute(copyTo, attr.value);\n            elem.appendChild(img);\n          }\n        }\n      }\n    });\n  },\n\n  _getTextDensity: function(e, tags) {\n    var textLength = this._getInnerText(e, true).length;\n    if (textLength === 0) {\n      return 0;\n    }\n    var childrenLength = 0;\n    var children = this._getAllNodesWithTag(e, tags);\n    this._forEachNode(children, (child) => childrenLength += this._getInnerText(child, true).length);\n    return childrenLength / textLength;\n  },\n\n  /**\n   * Clean an element of all tags of type \"tag\" if they look fishy.\n   * \"Fishy\" is an algorithm based on content length, classnames, link density, number of images & embeds, etc.\n   *\n   * @return void\n   **/\n  _cleanConditionally: function(e, tag) {\n    if (!this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))\n      return;\n\n    // Gather counts for other typical elements embedded within.\n    // Traverse backwards so we can remove nodes at the same time\n    // without effecting the traversal.\n    //\n    // TODO: Consider taking into account original contentScore here.\n    this._removeNodes(this._getAllNodesWithTag(e, [tag]), function(node) {\n      // First check if this node IS data table, in which case don't remove it.\n      var isDataTable = function(t) {\n        return t._readabilityDataTable;\n      };\n\n      var isList = tag === \"ul\" || tag === \"ol\";\n      if (!isList) {\n        var listLength = 0;\n        var listNodes = this._getAllNodesWithTag(node, [\"ul\", \"ol\"]);\n        this._forEachNode(listNodes, (list) => listLength += this._getInnerText(list).length);\n        isList = listLength / this._getInnerText(node).length > 0.9;\n      }\n\n      if (tag === \"table\" && isDataTable(node)) {\n        return false;\n      }\n\n      // Next check if we're inside a data table, in which case don't remove it as well.\n      if (this._hasAncestorTag(node, \"table\", -1, isDataTable)) {\n        return false;\n      }\n\n      if (this._hasAncestorTag(node, \"code\")) {\n        return false;\n      }\n\n      var weight = this._getClassWeight(node);\n\n      this.log(\"Cleaning Conditionally\", node);\n\n      var contentScore = 0;\n\n      if (weight + contentScore < 0) {\n        return true;\n      }\n\n      if (this._getCharCount(node, \",\") < 10) {\n        // If there are not very many commas, and the number of\n        // non-paragraph elements is more than paragraphs or other\n        // ominous signs, remove the element.\n        var p = node.getElementsByTagName(\"p\").length;\n        var img = node.getElementsByTagName(\"img\").length;\n        var li = node.getElementsByTagName(\"li\").length - 100;\n        var input = node.getElementsByTagName(\"input\").length;\n        var headingDensity = this._getTextDensity(node, [\"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\"]);\n\n        var embedCount = 0;\n        var embeds = this._getAllNodesWithTag(node, [\"object\", \"embed\", \"iframe\"]);\n\n        for (var i = 0; i < embeds.length; i++) {\n          // If this embed has attribute that matches video regex, don't delete it.\n          for (var j = 0; j < embeds[i].attributes.length; j++) {\n            if (this._allowedVideoRegex.test(embeds[i].attributes[j].value)) {\n              return false;\n            }\n          }\n\n          // For embed with <object> tag, check inner HTML as well.\n          if (embeds[i].tagName === \"object\" && this._allowedVideoRegex.test(embeds[i].innerHTML)) {\n            return false;\n          }\n\n          embedCount++;\n        }\n\n        var linkDensity = this._getLinkDensity(node);\n        var contentLength = this._getInnerText(node).length;\n\n        var haveToRemove =\n          (img > 1 && p / img < 0.5 && !this._hasAncestorTag(node, \"figure\")) ||\n          (!isList && li > p) ||\n          (input > Math.floor(p/3)) ||\n          (!isList && headingDensity < 0.9 && contentLength < 25 && (img === 0 || img > 2) && !this._hasAncestorTag(node, \"figure\")) ||\n          (!isList && weight < 25 && linkDensity > 0.2) ||\n          (weight >= 25 && linkDensity > 0.5) ||\n          ((embedCount === 1 && contentLength < 75) || embedCount > 1);\n        // Allow simple lists of images to remain in pages\n        if (isList && haveToRemove) {\n          for (var x = 0; x < node.children.length; x++) {\n            let child = node.children[x];\n            // Don't filter in lists with li's that contain more than one child\n            if (child.children.length > 1) {\n              return haveToRemove;\n            }\n          }\n          let li_count = node.getElementsByTagName(\"li\").length;\n          // Only allow the list to remain if every li contains an image\n          if (img == li_count) {\n            return false;\n          }\n        }\n        return haveToRemove;\n      }\n      return false;\n    });\n  },\n\n  /**\n   * Clean out elements that match the specified conditions\n   *\n   * @param Element\n   * @param Function determines whether a node should be removed\n   * @return void\n   **/\n  _cleanMatchedNodes: function(e, filter) {\n    var endOfSearchMarkerNode = this._getNextNode(e, true);\n    var next = this._getNextNode(e);\n    while (next && next != endOfSearchMarkerNode) {\n      if (filter.call(this, next, next.className + \" \" + next.id)) {\n        next = this._removeAndGetNext(next);\n      } else {\n        next = this._getNextNode(next);\n      }\n    }\n  },\n\n  /**\n   * Clean out spurious headers from an Element.\n   *\n   * @param Element\n   * @return void\n  **/\n  _cleanHeaders: function(e) {\n    let headingNodes = this._getAllNodesWithTag(e, [\"h1\", \"h2\"]);\n    this._removeNodes(headingNodes, function(node) {\n      let shouldRemove = this._getClassWeight(node) < 0;\n      if (shouldRemove) {\n        this.log(\"Removing header with low class weight:\", node);\n      }\n      return shouldRemove;\n    });\n  },\n\n  /**\n   * Check if this node is an H1 or H2 element whose content is mostly\n   * the same as the article title.\n   *\n   * @param Element  the node to check.\n   * @return boolean indicating whether this is a title-like header.\n   */\n  _headerDuplicatesTitle: function(node) {\n    if (node.tagName != \"H1\" && node.tagName != \"H2\") {\n      return false;\n    }\n    var heading = this._getInnerText(node, false);\n    this.log(\"Evaluating similarity of header:\", heading, this._articleTitle);\n    return this._textSimilarity(this._articleTitle, heading) > 0.75;\n  },\n\n  _flagIsActive: function(flag) {\n    return (this._flags & flag) > 0;\n  },\n\n  _removeFlag: function(flag) {\n    this._flags = this._flags & ~flag;\n  },\n\n  _isProbablyVisible: function(node) {\n    // Have to null-check node.style and node.className.indexOf to deal with SVG and MathML nodes.\n    return (!node.style || node.style.display != \"none\")\n      && !node.hasAttribute(\"hidden\")\n      //check for \"fallback-image\" so that wikimedia math images are displayed\n      && (!node.hasAttribute(\"aria-hidden\") || node.getAttribute(\"aria-hidden\") != \"true\" || (node.className && node.className.indexOf && node.className.indexOf(\"fallback-image\") !== -1));\n  },\n\n  /**\n   * Runs readability.\n   *\n   * Workflow:\n   *  1. Prep the document by removing script tags, css, etc.\n   *  2. Build readability's DOM tree.\n   *  3. Grab the article content from the current dom tree.\n   *  4. Replace the current DOM tree with the new one.\n   *  5. Read peacefully.\n   *\n   * @return void\n   **/\n  parse: function () {\n    // Avoid parsing too large documents, as per configuration option\n    if (this._maxElemsToParse > 0) {\n      var numTags = this._doc.getElementsByTagName(\"*\").length;\n      if (numTags > this._maxElemsToParse) {\n        throw new Error(\"Aborting parsing document; \" + numTags + \" elements found\");\n      }\n    }\n\n    // Unwrap image from noscript\n    this._unwrapNoscriptImages(this._doc);\n\n    // Extract JSON-LD metadata before removing scripts\n    var jsonLd = this._disableJSONLD ? {} : this._getJSONLD(this._doc);\n\n    // Remove script tags from the document.\n    this._removeScripts(this._doc);\n\n    this._prepDocument();\n\n    var metadata = this._getArticleMetadata(jsonLd);\n    this._articleTitle = metadata.title;\n\n    var articleContent = this._grabArticle();\n    if (!articleContent)\n      return null;\n\n    this.log(\"Grabbed: \" + articleContent.innerHTML);\n\n    this._postProcessContent(articleContent);\n\n    // If we haven't found an excerpt in the article's metadata, use the article's\n    // first paragraph as the excerpt. This is used for displaying a preview of\n    // the article's content.\n    if (!metadata.excerpt) {\n      var paragraphs = articleContent.getElementsByTagName(\"p\");\n      if (paragraphs.length > 0) {\n        metadata.excerpt = paragraphs[0].textContent.trim();\n      }\n    }\n\n    var textContent = articleContent.textContent;\n    return {\n      title: this._articleTitle,\n      byline: metadata.byline || this._articleByline,\n      dir: this._articleDir,\n      lang: this._articleLang,\n      content: this._serializer(articleContent),\n      textContent: textContent,\n      length: textContent.length,\n      excerpt: metadata.excerpt,\n      siteName: metadata.siteName || this._articleSiteName\n    };\n  }\n};\n\nif (typeof module === \"object\") {\n  /* global module */\n  module.exports = Readability;\n}\n","/* eslint-env node */\nvar Readability = require(\"./Readability\");\nvar isProbablyReaderable = require(\"./Readability-readerable\");\n\nmodule.exports = {\n  Readability: Readability,\n  isProbablyReaderable: isProbablyReaderable\n};\n","/*! @license DOMPurify 2.4.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.4.5/LICENSE */\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.DOMPurify = factory());\n})(this, (function () { 'use strict';\n\n  function _typeof(obj) {\n    \"@babel/helpers - typeof\";\n\n    return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n      return typeof obj;\n    } : function (obj) {\n      return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    }, _typeof(obj);\n  }\n\n  function _setPrototypeOf(o, p) {\n    _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n      o.__proto__ = p;\n      return o;\n    };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  function _isNativeReflectConstruct() {\n    if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === \"function\") return true;\n\n    try {\n      Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (_isNativeReflectConstruct()) {\n      _construct = Reflect.construct;\n    } else {\n      _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) _setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  function _toConsumableArray(arr) {\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n  }\n\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n  }\n\n  function _iterableToArray(iter) {\n    if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n  }\n\n  function _unsupportedIterableToArray(o, minLen) {\n    if (!o) return;\n    if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n    var n = Object.prototype.toString.call(o).slice(8, -1);\n    if (n === \"Object\" && o.constructor) n = o.constructor.name;\n    if (n === \"Map\" || n === \"Set\") return Array.from(o);\n    if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n  }\n\n  function _arrayLikeToArray(arr, len) {\n    if (len == null || len > arr.length) len = arr.length;\n\n    for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n\n  function _nonIterableSpread() {\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var hasOwnProperty = Object.hasOwnProperty,\n      setPrototypeOf = Object.setPrototypeOf,\n      isFrozen = Object.isFrozen,\n      getPrototypeOf = Object.getPrototypeOf,\n      getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n  var freeze = Object.freeze,\n      seal = Object.seal,\n      create = Object.create; // eslint-disable-line import/no-mutable-exports\n\n  var _ref = typeof Reflect !== 'undefined' && Reflect,\n      apply = _ref.apply,\n      construct = _ref.construct;\n\n  if (!apply) {\n    apply = function apply(fun, thisValue, args) {\n      return fun.apply(thisValue, args);\n    };\n  }\n\n  if (!freeze) {\n    freeze = function freeze(x) {\n      return x;\n    };\n  }\n\n  if (!seal) {\n    seal = function seal(x) {\n      return x;\n    };\n  }\n\n  if (!construct) {\n    construct = function construct(Func, args) {\n      return _construct(Func, _toConsumableArray(args));\n    };\n  }\n\n  var arrayForEach = unapply(Array.prototype.forEach);\n  var arrayPop = unapply(Array.prototype.pop);\n  var arrayPush = unapply(Array.prototype.push);\n  var stringToLowerCase = unapply(String.prototype.toLowerCase);\n  var stringToString = unapply(String.prototype.toString);\n  var stringMatch = unapply(String.prototype.match);\n  var stringReplace = unapply(String.prototype.replace);\n  var stringIndexOf = unapply(String.prototype.indexOf);\n  var stringTrim = unapply(String.prototype.trim);\n  var regExpTest = unapply(RegExp.prototype.test);\n  var typeErrorCreate = unconstruct(TypeError);\n  function unapply(func) {\n    return function (thisArg) {\n      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n\n      return apply(func, thisArg, args);\n    };\n  }\n  function unconstruct(func) {\n    return function () {\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n\n      return construct(func, args);\n    };\n  }\n  /* Add properties to a lookup table */\n\n  function addToSet(set, array, transformCaseFunc) {\n    transformCaseFunc = transformCaseFunc ? transformCaseFunc : stringToLowerCase;\n\n    if (setPrototypeOf) {\n      // Make 'in' and truthy checks like Boolean(set.constructor)\n      // independent of any properties defined on Object.prototype.\n      // Prevent prototype setters from intercepting set as a this value.\n      setPrototypeOf(set, null);\n    }\n\n    var l = array.length;\n\n    while (l--) {\n      var element = array[l];\n\n      if (typeof element === 'string') {\n        var lcElement = transformCaseFunc(element);\n\n        if (lcElement !== element) {\n          // Config presets (e.g. tags.js, attrs.js) are immutable.\n          if (!isFrozen(array)) {\n            array[l] = lcElement;\n          }\n\n          element = lcElement;\n        }\n      }\n\n      set[element] = true;\n    }\n\n    return set;\n  }\n  /* Shallow clone an object */\n\n  function clone(object) {\n    var newObject = create(null);\n    var property;\n\n    for (property in object) {\n      if (apply(hasOwnProperty, object, [property]) === true) {\n        newObject[property] = object[property];\n      }\n    }\n\n    return newObject;\n  }\n  /* IE10 doesn't support __lookupGetter__ so lets'\n   * simulate it. It also automatically checks\n   * if the prop is function or getter and behaves\n   * accordingly. */\n\n  function lookupGetter(object, prop) {\n    while (object !== null) {\n      var desc = getOwnPropertyDescriptor(object, prop);\n\n      if (desc) {\n        if (desc.get) {\n          return unapply(desc.get);\n        }\n\n        if (typeof desc.value === 'function') {\n          return unapply(desc.value);\n        }\n      }\n\n      object = getPrototypeOf(object);\n    }\n\n    function fallbackValue(element) {\n      console.warn('fallback value for', element);\n      return null;\n    }\n\n    return fallbackValue;\n  }\n\n  var html$1 = freeze(['a', 'abbr', 'acronym', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'big', 'blink', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption', 'center', 'cite', 'code', 'col', 'colgroup', 'content', 'data', 'datalist', 'dd', 'decorator', 'del', 'details', 'dfn', 'dialog', 'dir', 'div', 'dl', 'dt', 'element', 'em', 'fieldset', 'figcaption', 'figure', 'font', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'img', 'input', 'ins', 'kbd', 'label', 'legend', 'li', 'main', 'map', 'mark', 'marquee', 'menu', 'menuitem', 'meter', 'nav', 'nobr', 'ol', 'optgroup', 'option', 'output', 'p', 'picture', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's', 'samp', 'section', 'select', 'shadow', 'small', 'source', 'spacer', 'span', 'strike', 'strong', 'style', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'template', 'textarea', 'tfoot', 'th', 'thead', 'time', 'tr', 'track', 'tt', 'u', 'ul', 'var', 'video', 'wbr']); // SVG\n\n  var svg$1 = freeze(['svg', 'a', 'altglyph', 'altglyphdef', 'altglyphitem', 'animatecolor', 'animatemotion', 'animatetransform', 'circle', 'clippath', 'defs', 'desc', 'ellipse', 'filter', 'font', 'g', 'glyph', 'glyphref', 'hkern', 'image', 'line', 'lineargradient', 'marker', 'mask', 'metadata', 'mpath', 'path', 'pattern', 'polygon', 'polyline', 'radialgradient', 'rect', 'stop', 'style', 'switch', 'symbol', 'text', 'textpath', 'title', 'tref', 'tspan', 'view', 'vkern']);\n  var svgFilters = freeze(['feBlend', 'feColorMatrix', 'feComponentTransfer', 'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence']); // List of SVG elements that are disallowed by default.\n  // We still need to know them so that we can do namespace\n  // checks properly in case one wants to add them to\n  // allow-list.\n\n  var svgDisallowed = freeze(['animate', 'color-profile', 'cursor', 'discard', 'fedropshadow', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src', 'font-face-uri', 'foreignobject', 'hatch', 'hatchpath', 'mesh', 'meshgradient', 'meshpatch', 'meshrow', 'missing-glyph', 'script', 'set', 'solidcolor', 'unknown', 'use']);\n  var mathMl$1 = freeze(['math', 'menclose', 'merror', 'mfenced', 'mfrac', 'mglyph', 'mi', 'mlabeledtr', 'mmultiscripts', 'mn', 'mo', 'mover', 'mpadded', 'mphantom', 'mroot', 'mrow', 'ms', 'mspace', 'msqrt', 'mstyle', 'msub', 'msup', 'msubsup', 'mtable', 'mtd', 'mtext', 'mtr', 'munder', 'munderover']); // Similarly to SVG, we want to know all MathML elements,\n  // even those that we disallow by default.\n\n  var mathMlDisallowed = freeze(['maction', 'maligngroup', 'malignmark', 'mlongdiv', 'mscarries', 'mscarry', 'msgroup', 'mstack', 'msline', 'msrow', 'semantics', 'annotation', 'annotation-xml', 'mprescripts', 'none']);\n  var text = freeze(['#text']);\n\n  var html = freeze(['accept', 'action', 'align', 'alt', 'autocapitalize', 'autocomplete', 'autopictureinpicture', 'autoplay', 'background', 'bgcolor', 'border', 'capture', 'cellpadding', 'cellspacing', 'checked', 'cite', 'class', 'clear', 'color', 'cols', 'colspan', 'controls', 'controlslist', 'coords', 'crossorigin', 'datetime', 'decoding', 'default', 'dir', 'disabled', 'disablepictureinpicture', 'disableremoteplayback', 'download', 'draggable', 'enctype', 'enterkeyhint', 'face', 'for', 'headers', 'height', 'hidden', 'high', 'href', 'hreflang', 'id', 'inputmode', 'integrity', 'ismap', 'kind', 'label', 'lang', 'list', 'loading', 'loop', 'low', 'max', 'maxlength', 'media', 'method', 'min', 'minlength', 'multiple', 'muted', 'name', 'nonce', 'noshade', 'novalidate', 'nowrap', 'open', 'optimum', 'pattern', 'placeholder', 'playsinline', 'poster', 'preload', 'pubdate', 'radiogroup', 'readonly', 'rel', 'required', 'rev', 'reversed', 'role', 'rows', 'rowspan', 'spellcheck', 'scope', 'selected', 'shape', 'size', 'sizes', 'span', 'srclang', 'start', 'src', 'srcset', 'step', 'style', 'summary', 'tabindex', 'title', 'translate', 'type', 'usemap', 'valign', 'value', 'width', 'xmlns', 'slot']);\n  var svg = freeze(['accent-height', 'accumulate', 'additive', 'alignment-baseline', 'ascent', 'attributename', 'attributetype', 'azimuth', 'basefrequency', 'baseline-shift', 'begin', 'bias', 'by', 'class', 'clip', 'clippathunits', 'clip-path', 'clip-rule', 'color', 'color-interpolation', 'color-interpolation-filters', 'color-profile', 'color-rendering', 'cx', 'cy', 'd', 'dx', 'dy', 'diffuseconstant', 'direction', 'display', 'divisor', 'dur', 'edgemode', 'elevation', 'end', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterunits', 'flood-color', 'flood-opacity', 'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyphref', 'gradientunits', 'gradienttransform', 'height', 'href', 'id', 'image-rendering', 'in', 'in2', 'k', 'k1', 'k2', 'k3', 'k4', 'kerning', 'keypoints', 'keysplines', 'keytimes', 'lang', 'lengthadjust', 'letter-spacing', 'kernelmatrix', 'kernelunitlength', 'lighting-color', 'local', 'marker-end', 'marker-mid', 'marker-start', 'markerheight', 'markerunits', 'markerwidth', 'maskcontentunits', 'maskunits', 'max', 'mask', 'media', 'method', 'mode', 'min', 'name', 'numoctaves', 'offset', 'operator', 'opacity', 'order', 'orient', 'orientation', 'origin', 'overflow', 'paint-order', 'path', 'pathlength', 'patterncontentunits', 'patterntransform', 'patternunits', 'points', 'preservealpha', 'preserveaspectratio', 'primitiveunits', 'r', 'rx', 'ry', 'radius', 'refx', 'refy', 'repeatcount', 'repeatdur', 'restart', 'result', 'rotate', 'scale', 'seed', 'shape-rendering', 'specularconstant', 'specularexponent', 'spreadmethod', 'startoffset', 'stddeviation', 'stitchtiles', 'stop-color', 'stop-opacity', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke', 'stroke-width', 'style', 'surfacescale', 'systemlanguage', 'tabindex', 'targetx', 'targety', 'transform', 'transform-origin', 'text-anchor', 'text-decoration', 'text-rendering', 'textlength', 'type', 'u1', 'u2', 'unicode', 'values', 'viewbox', 'visibility', 'version', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'width', 'word-spacing', 'wrap', 'writing-mode', 'xchannelselector', 'ychannelselector', 'x', 'x1', 'x2', 'xmlns', 'y', 'y1', 'y2', 'z', 'zoomandpan']);\n  var mathMl = freeze(['accent', 'accentunder', 'align', 'bevelled', 'close', 'columnsalign', 'columnlines', 'columnspan', 'denomalign', 'depth', 'dir', 'display', 'displaystyle', 'encoding', 'fence', 'frame', 'height', 'href', 'id', 'largeop', 'length', 'linethickness', 'lspace', 'lquote', 'mathbackground', 'mathcolor', 'mathsize', 'mathvariant', 'maxsize', 'minsize', 'movablelimits', 'notation', 'numalign', 'open', 'rowalign', 'rowlines', 'rowspacing', 'rowspan', 'rspace', 'rquote', 'scriptlevel', 'scriptminsize', 'scriptsizemultiplier', 'selection', 'separator', 'separators', 'stretchy', 'subscriptshift', 'supscriptshift', 'symmetric', 'voffset', 'width', 'xmlns']);\n  var xml = freeze(['xlink:href', 'xml:id', 'xlink:title', 'xml:space', 'xmlns:xlink']);\n\n  var MUSTACHE_EXPR = seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode\n\n  var ERB_EXPR = seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);\n  var TMPLIT_EXPR = seal(/\\${[\\w\\W]*}/gm);\n  var DATA_ATTR = seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]/); // eslint-disable-line no-useless-escape\n\n  var ARIA_ATTR = seal(/^aria-[\\-\\w]+$/); // eslint-disable-line no-useless-escape\n\n  var IS_ALLOWED_URI = seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i // eslint-disable-line no-useless-escape\n  );\n  var IS_SCRIPT_OR_DATA = seal(/^(?:\\w+script|data):/i);\n  var ATTR_WHITESPACE = seal(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g // eslint-disable-line no-control-regex\n  );\n  var DOCTYPE_NAME = seal(/^html$/i);\n\n  var getGlobal = function getGlobal() {\n    return typeof window === 'undefined' ? null : window;\n  };\n  /**\n   * Creates a no-op policy for internal use only.\n   * Don't export this function outside this module!\n   * @param {?TrustedTypePolicyFactory} trustedTypes The policy factory.\n   * @param {Document} document The document object (to determine policy name suffix)\n   * @return {?TrustedTypePolicy} The policy created (or null, if Trusted Types\n   * are not supported).\n   */\n\n\n  var _createTrustedTypesPolicy = function _createTrustedTypesPolicy(trustedTypes, document) {\n    if (_typeof(trustedTypes) !== 'object' || typeof trustedTypes.createPolicy !== 'function') {\n      return null;\n    } // Allow the callers to control the unique policy name\n    // by adding a data-tt-policy-suffix to the script element with the DOMPurify.\n    // Policy creation with duplicate names throws in Trusted Types.\n\n\n    var suffix = null;\n    var ATTR_NAME = 'data-tt-policy-suffix';\n\n    if (document.currentScript && document.currentScript.hasAttribute(ATTR_NAME)) {\n      suffix = document.currentScript.getAttribute(ATTR_NAME);\n    }\n\n    var policyName = 'dompurify' + (suffix ? '#' + suffix : '');\n\n    try {\n      return trustedTypes.createPolicy(policyName, {\n        createHTML: function createHTML(html) {\n          return html;\n        },\n        createScriptURL: function createScriptURL(scriptUrl) {\n          return scriptUrl;\n        }\n      });\n    } catch (_) {\n      // Policy creation failed (most likely another DOMPurify script has\n      // already run). Skip creating the policy, as this will only cause errors\n      // if TT are enforced.\n      console.warn('TrustedTypes policy ' + policyName + ' could not be created.');\n      return null;\n    }\n  };\n\n  function createDOMPurify() {\n    var window = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getGlobal();\n\n    var DOMPurify = function DOMPurify(root) {\n      return createDOMPurify(root);\n    };\n    /**\n     * Version label, exposed for easier checks\n     * if DOMPurify is up to date or not\n     */\n\n\n    DOMPurify.version = '2.4.5';\n    /**\n     * Array of elements that DOMPurify removed during sanitation.\n     * Empty if nothing was removed.\n     */\n\n    DOMPurify.removed = [];\n\n    if (!window || !window.document || window.document.nodeType !== 9) {\n      // Not running in a browser, provide a factory function\n      // so that you can pass your own Window\n      DOMPurify.isSupported = false;\n      return DOMPurify;\n    }\n\n    var originalDocument = window.document;\n    var document = window.document;\n    var DocumentFragment = window.DocumentFragment,\n        HTMLTemplateElement = window.HTMLTemplateElement,\n        Node = window.Node,\n        Element = window.Element,\n        NodeFilter = window.NodeFilter,\n        _window$NamedNodeMap = window.NamedNodeMap,\n        NamedNodeMap = _window$NamedNodeMap === void 0 ? window.NamedNodeMap || window.MozNamedAttrMap : _window$NamedNodeMap,\n        HTMLFormElement = window.HTMLFormElement,\n        DOMParser = window.DOMParser,\n        trustedTypes = window.trustedTypes;\n    var ElementPrototype = Element.prototype;\n    var cloneNode = lookupGetter(ElementPrototype, 'cloneNode');\n    var getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');\n    var getChildNodes = lookupGetter(ElementPrototype, 'childNodes');\n    var getParentNode = lookupGetter(ElementPrototype, 'parentNode'); // As per issue #47, the web-components registry is inherited by a\n    // new document created via createHTMLDocument. As per the spec\n    // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)\n    // a new empty registry is used when creating a template contents owner\n    // document, so we use that as our parent document to ensure nothing\n    // is inherited.\n\n    if (typeof HTMLTemplateElement === 'function') {\n      var template = document.createElement('template');\n\n      if (template.content && template.content.ownerDocument) {\n        document = template.content.ownerDocument;\n      }\n    }\n\n    var trustedTypesPolicy = _createTrustedTypesPolicy(trustedTypes, originalDocument);\n\n    var emptyHTML = trustedTypesPolicy ? trustedTypesPolicy.createHTML('') : '';\n    var _document = document,\n        implementation = _document.implementation,\n        createNodeIterator = _document.createNodeIterator,\n        createDocumentFragment = _document.createDocumentFragment,\n        getElementsByTagName = _document.getElementsByTagName;\n    var importNode = originalDocument.importNode;\n    var documentMode = {};\n\n    try {\n      documentMode = clone(document).documentMode ? document.documentMode : {};\n    } catch (_) {}\n\n    var hooks = {};\n    /**\n     * Expose whether this browser supports running the full DOMPurify.\n     */\n\n    DOMPurify.isSupported = typeof getParentNode === 'function' && implementation && typeof implementation.createHTMLDocument !== 'undefined' && documentMode !== 9;\n    var MUSTACHE_EXPR$1 = MUSTACHE_EXPR,\n        ERB_EXPR$1 = ERB_EXPR,\n        TMPLIT_EXPR$1 = TMPLIT_EXPR,\n        DATA_ATTR$1 = DATA_ATTR,\n        ARIA_ATTR$1 = ARIA_ATTR,\n        IS_SCRIPT_OR_DATA$1 = IS_SCRIPT_OR_DATA,\n        ATTR_WHITESPACE$1 = ATTR_WHITESPACE;\n    var IS_ALLOWED_URI$1 = IS_ALLOWED_URI;\n    /**\n     * We consider the elements and attributes below to be safe. Ideally\n     * don't add any new ones but feel free to remove unwanted ones.\n     */\n\n    /* allowed element names */\n\n    var ALLOWED_TAGS = null;\n    var DEFAULT_ALLOWED_TAGS = addToSet({}, [].concat(_toConsumableArray(html$1), _toConsumableArray(svg$1), _toConsumableArray(svgFilters), _toConsumableArray(mathMl$1), _toConsumableArray(text)));\n    /* Allowed attribute names */\n\n    var ALLOWED_ATTR = null;\n    var DEFAULT_ALLOWED_ATTR = addToSet({}, [].concat(_toConsumableArray(html), _toConsumableArray(svg), _toConsumableArray(mathMl), _toConsumableArray(xml)));\n    /*\n     * Configure how DOMPUrify should handle custom elements and their attributes as well as customized built-in elements.\n     * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)\n     * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)\n     * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.\n     */\n\n    var CUSTOM_ELEMENT_HANDLING = Object.seal(Object.create(null, {\n      tagNameCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null\n      },\n      attributeNameCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null\n      },\n      allowCustomizedBuiltInElements: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: false\n      }\n    }));\n    /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */\n\n    var FORBID_TAGS = null;\n    /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */\n\n    var FORBID_ATTR = null;\n    /* Decide if ARIA attributes are okay */\n\n    var ALLOW_ARIA_ATTR = true;\n    /* Decide if custom data attributes are okay */\n\n    var ALLOW_DATA_ATTR = true;\n    /* Decide if unknown protocols are okay */\n\n    var ALLOW_UNKNOWN_PROTOCOLS = false;\n    /* Decide if self-closing tags in attributes are allowed.\n     * Usually removed due to a mXSS issue in jQuery 3.0 */\n\n    var ALLOW_SELF_CLOSE_IN_ATTR = true;\n    /* Output should be safe for common template engines.\n     * This means, DOMPurify removes data attributes, mustaches and ERB\n     */\n\n    var SAFE_FOR_TEMPLATES = false;\n    /* Decide if document with <html>... should be returned */\n\n    var WHOLE_DOCUMENT = false;\n    /* Track whether config is already set on this instance of DOMPurify. */\n\n    var SET_CONFIG = false;\n    /* Decide if all elements (e.g. style, script) must be children of\n     * document.body. By default, browsers might move them to document.head */\n\n    var FORCE_BODY = false;\n    /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html\n     * string (or a TrustedHTML object if Trusted Types are supported).\n     * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead\n     */\n\n    var RETURN_DOM = false;\n    /* Decide if a DOM `DocumentFragment` should be returned, instead of a html\n     * string  (or a TrustedHTML object if Trusted Types are supported) */\n\n    var RETURN_DOM_FRAGMENT = false;\n    /* Try to return a Trusted Type object instead of a string, return a string in\n     * case Trusted Types are not supported  */\n\n    var RETURN_TRUSTED_TYPE = false;\n    /* Output should be free from DOM clobbering attacks?\n     * This sanitizes markups named with colliding, clobberable built-in DOM APIs.\n     */\n\n    var SANITIZE_DOM = true;\n    /* Achieve full DOM Clobbering protection by isolating the namespace of named\n     * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.\n     *\n     * HTML/DOM spec rules that enable DOM Clobbering:\n     *   - Named Access on Window (§7.3.3)\n     *   - DOM Tree Accessors (§3.1.5)\n     *   - Form Element Parent-Child Relations (§4.10.3)\n     *   - Iframe srcdoc / Nested WindowProxies (§4.8.5)\n     *   - HTMLCollection (§4.2.10.2)\n     *\n     * Namespace isolation is implemented by prefixing `id` and `name` attributes\n     * with a constant string, i.e., `user-content-`\n     */\n\n    var SANITIZE_NAMED_PROPS = false;\n    var SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';\n    /* Keep element content when removing element? */\n\n    var KEEP_CONTENT = true;\n    /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead\n     * of importing it into a new Document and returning a sanitized copy */\n\n    var IN_PLACE = false;\n    /* Allow usage of profiles like html, svg and mathMl */\n\n    var USE_PROFILES = {};\n    /* Tags to ignore content of when KEEP_CONTENT is true */\n\n    var FORBID_CONTENTS = null;\n    var DEFAULT_FORBID_CONTENTS = addToSet({}, ['annotation-xml', 'audio', 'colgroup', 'desc', 'foreignobject', 'head', 'iframe', 'math', 'mi', 'mn', 'mo', 'ms', 'mtext', 'noembed', 'noframes', 'noscript', 'plaintext', 'script', 'style', 'svg', 'template', 'thead', 'title', 'video', 'xmp']);\n    /* Tags that are safe for data: URIs */\n\n    var DATA_URI_TAGS = null;\n    var DEFAULT_DATA_URI_TAGS = addToSet({}, ['audio', 'video', 'img', 'source', 'image', 'track']);\n    /* Attributes safe for values like \"javascript:\" */\n\n    var URI_SAFE_ATTRIBUTES = null;\n    var DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, ['alt', 'class', 'for', 'id', 'label', 'name', 'pattern', 'placeholder', 'role', 'summary', 'title', 'value', 'style', 'xmlns']);\n    var MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';\n    var SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n    var HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n    /* Document namespace */\n\n    var NAMESPACE = HTML_NAMESPACE;\n    var IS_EMPTY_INPUT = false;\n    /* Allowed XHTML+XML namespaces */\n\n    var ALLOWED_NAMESPACES = null;\n    var DEFAULT_ALLOWED_NAMESPACES = addToSet({}, [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE], stringToString);\n    /* Parsing of strict XHTML documents */\n\n    var PARSER_MEDIA_TYPE;\n    var SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];\n    var DEFAULT_PARSER_MEDIA_TYPE = 'text/html';\n    var transformCaseFunc;\n    /* Keep a reference to config to pass to hooks */\n\n    var CONFIG = null;\n    /* Ideally, do not touch anything below this line */\n\n    /* ______________________________________________ */\n\n    var formElement = document.createElement('form');\n\n    var isRegexOrFunction = function isRegexOrFunction(testValue) {\n      return testValue instanceof RegExp || testValue instanceof Function;\n    };\n    /**\n     * _parseConfig\n     *\n     * @param  {Object} cfg optional config literal\n     */\n    // eslint-disable-next-line complexity\n\n\n    var _parseConfig = function _parseConfig(cfg) {\n      if (CONFIG && CONFIG === cfg) {\n        return;\n      }\n      /* Shield configuration object from tampering */\n\n\n      if (!cfg || _typeof(cfg) !== 'object') {\n        cfg = {};\n      }\n      /* Shield configuration object from prototype pollution */\n\n\n      cfg = clone(cfg);\n      PARSER_MEDIA_TYPE = // eslint-disable-next-line unicorn/prefer-includes\n      SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1 ? PARSER_MEDIA_TYPE = DEFAULT_PARSER_MEDIA_TYPE : PARSER_MEDIA_TYPE = cfg.PARSER_MEDIA_TYPE; // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.\n\n      transformCaseFunc = PARSER_MEDIA_TYPE === 'application/xhtml+xml' ? stringToString : stringToLowerCase;\n      /* Set configuration parameters */\n\n      ALLOWED_TAGS = 'ALLOWED_TAGS' in cfg ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc) : DEFAULT_ALLOWED_TAGS;\n      ALLOWED_ATTR = 'ALLOWED_ATTR' in cfg ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc) : DEFAULT_ALLOWED_ATTR;\n      ALLOWED_NAMESPACES = 'ALLOWED_NAMESPACES' in cfg ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString) : DEFAULT_ALLOWED_NAMESPACES;\n      URI_SAFE_ATTRIBUTES = 'ADD_URI_SAFE_ATTR' in cfg ? addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES), // eslint-disable-line indent\n      cfg.ADD_URI_SAFE_ATTR, // eslint-disable-line indent\n      transformCaseFunc // eslint-disable-line indent\n      ) // eslint-disable-line indent\n      : DEFAULT_URI_SAFE_ATTRIBUTES;\n      DATA_URI_TAGS = 'ADD_DATA_URI_TAGS' in cfg ? addToSet(clone(DEFAULT_DATA_URI_TAGS), // eslint-disable-line indent\n      cfg.ADD_DATA_URI_TAGS, // eslint-disable-line indent\n      transformCaseFunc // eslint-disable-line indent\n      ) // eslint-disable-line indent\n      : DEFAULT_DATA_URI_TAGS;\n      FORBID_CONTENTS = 'FORBID_CONTENTS' in cfg ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc) : DEFAULT_FORBID_CONTENTS;\n      FORBID_TAGS = 'FORBID_TAGS' in cfg ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc) : {};\n      FORBID_ATTR = 'FORBID_ATTR' in cfg ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc) : {};\n      USE_PROFILES = 'USE_PROFILES' in cfg ? cfg.USE_PROFILES : false;\n      ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true\n\n      ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true\n\n      ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false\n\n      ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true\n\n      SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false\n\n      WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false\n\n      RETURN_DOM = cfg.RETURN_DOM || false; // Default false\n\n      RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false\n\n      RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false\n\n      FORCE_BODY = cfg.FORCE_BODY || false; // Default false\n\n      SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true\n\n      SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false\n\n      KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true\n\n      IN_PLACE = cfg.IN_PLACE || false; // Default false\n\n      IS_ALLOWED_URI$1 = cfg.ALLOWED_URI_REGEXP || IS_ALLOWED_URI$1;\n      NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;\n      CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};\n\n      if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)) {\n        CUSTOM_ELEMENT_HANDLING.tagNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;\n      }\n\n      if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)) {\n        CUSTOM_ELEMENT_HANDLING.attributeNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;\n      }\n\n      if (cfg.CUSTOM_ELEMENT_HANDLING && typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements === 'boolean') {\n        CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements = cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;\n      }\n\n      if (SAFE_FOR_TEMPLATES) {\n        ALLOW_DATA_ATTR = false;\n      }\n\n      if (RETURN_DOM_FRAGMENT) {\n        RETURN_DOM = true;\n      }\n      /* Parse profile info */\n\n\n      if (USE_PROFILES) {\n        ALLOWED_TAGS = addToSet({}, _toConsumableArray(text));\n        ALLOWED_ATTR = [];\n\n        if (USE_PROFILES.html === true) {\n          addToSet(ALLOWED_TAGS, html$1);\n          addToSet(ALLOWED_ATTR, html);\n        }\n\n        if (USE_PROFILES.svg === true) {\n          addToSet(ALLOWED_TAGS, svg$1);\n          addToSet(ALLOWED_ATTR, svg);\n          addToSet(ALLOWED_ATTR, xml);\n        }\n\n        if (USE_PROFILES.svgFilters === true) {\n          addToSet(ALLOWED_TAGS, svgFilters);\n          addToSet(ALLOWED_ATTR, svg);\n          addToSet(ALLOWED_ATTR, xml);\n        }\n\n        if (USE_PROFILES.mathMl === true) {\n          addToSet(ALLOWED_TAGS, mathMl$1);\n          addToSet(ALLOWED_ATTR, mathMl);\n          addToSet(ALLOWED_ATTR, xml);\n        }\n      }\n      /* Merge configuration parameters */\n\n\n      if (cfg.ADD_TAGS) {\n        if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {\n          ALLOWED_TAGS = clone(ALLOWED_TAGS);\n        }\n\n        addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);\n      }\n\n      if (cfg.ADD_ATTR) {\n        if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {\n          ALLOWED_ATTR = clone(ALLOWED_ATTR);\n        }\n\n        addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);\n      }\n\n      if (cfg.ADD_URI_SAFE_ATTR) {\n        addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);\n      }\n\n      if (cfg.FORBID_CONTENTS) {\n        if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n          FORBID_CONTENTS = clone(FORBID_CONTENTS);\n        }\n\n        addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);\n      }\n      /* Add #text in case KEEP_CONTENT is set to true */\n\n\n      if (KEEP_CONTENT) {\n        ALLOWED_TAGS['#text'] = true;\n      }\n      /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */\n\n\n      if (WHOLE_DOCUMENT) {\n        addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);\n      }\n      /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */\n\n\n      if (ALLOWED_TAGS.table) {\n        addToSet(ALLOWED_TAGS, ['tbody']);\n        delete FORBID_TAGS.tbody;\n      } // Prevent further manipulation of configuration.\n      // Not available in IE8, Safari 5, etc.\n\n\n      if (freeze) {\n        freeze(cfg);\n      }\n\n      CONFIG = cfg;\n    };\n\n    var MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, ['mi', 'mo', 'mn', 'ms', 'mtext']);\n    var HTML_INTEGRATION_POINTS = addToSet({}, ['foreignobject', 'desc', 'title', 'annotation-xml']); // Certain elements are allowed in both SVG and HTML\n    // namespace. We need to specify them explicitly\n    // so that they don't get erroneously deleted from\n    // HTML namespace.\n\n    var COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, ['title', 'style', 'font', 'a', 'script']);\n    /* Keep track of all possible SVG and MathML tags\n     * so that we can perform the namespace checks\n     * correctly. */\n\n    var ALL_SVG_TAGS = addToSet({}, svg$1);\n    addToSet(ALL_SVG_TAGS, svgFilters);\n    addToSet(ALL_SVG_TAGS, svgDisallowed);\n    var ALL_MATHML_TAGS = addToSet({}, mathMl$1);\n    addToSet(ALL_MATHML_TAGS, mathMlDisallowed);\n    /**\n     *\n     *\n     * @param  {Element} element a DOM element whose namespace is being checked\n     * @returns {boolean} Return false if the element has a\n     *  namespace that a spec-compliant parser would never\n     *  return. Return true otherwise.\n     */\n\n    var _checkValidNamespace = function _checkValidNamespace(element) {\n      var parent = getParentNode(element); // In JSDOM, if we're inside shadow DOM, then parentNode\n      // can be null. We just simulate parent in this case.\n\n      if (!parent || !parent.tagName) {\n        parent = {\n          namespaceURI: NAMESPACE,\n          tagName: 'template'\n        };\n      }\n\n      var tagName = stringToLowerCase(element.tagName);\n      var parentTagName = stringToLowerCase(parent.tagName);\n\n      if (!ALLOWED_NAMESPACES[element.namespaceURI]) {\n        return false;\n      }\n\n      if (element.namespaceURI === SVG_NAMESPACE) {\n        // The only way to switch from HTML namespace to SVG\n        // is via <svg>. If it happens via any other tag, then\n        // it should be killed.\n        if (parent.namespaceURI === HTML_NAMESPACE) {\n          return tagName === 'svg';\n        } // The only way to switch from MathML to SVG is via`\n        // svg if parent is either <annotation-xml> or MathML\n        // text integration points.\n\n\n        if (parent.namespaceURI === MATHML_NAMESPACE) {\n          return tagName === 'svg' && (parentTagName === 'annotation-xml' || MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);\n        } // We only allow elements that are defined in SVG\n        // spec. All others are disallowed in SVG namespace.\n\n\n        return Boolean(ALL_SVG_TAGS[tagName]);\n      }\n\n      if (element.namespaceURI === MATHML_NAMESPACE) {\n        // The only way to switch from HTML namespace to MathML\n        // is via <math>. If it happens via any other tag, then\n        // it should be killed.\n        if (parent.namespaceURI === HTML_NAMESPACE) {\n          return tagName === 'math';\n        } // The only way to switch from SVG to MathML is via\n        // <math> and HTML integration points\n\n\n        if (parent.namespaceURI === SVG_NAMESPACE) {\n          return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];\n        } // We only allow elements that are defined in MathML\n        // spec. All others are disallowed in MathML namespace.\n\n\n        return Boolean(ALL_MATHML_TAGS[tagName]);\n      }\n\n      if (element.namespaceURI === HTML_NAMESPACE) {\n        // The only way to switch from SVG to HTML is via\n        // HTML integration points, and from MathML to HTML\n        // is via MathML text integration points\n        if (parent.namespaceURI === SVG_NAMESPACE && !HTML_INTEGRATION_POINTS[parentTagName]) {\n          return false;\n        }\n\n        if (parent.namespaceURI === MATHML_NAMESPACE && !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]) {\n          return false;\n        } // We disallow tags that are specific for MathML\n        // or SVG and should never appear in HTML namespace\n\n\n        return !ALL_MATHML_TAGS[tagName] && (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName]);\n      } // For XHTML and XML documents that support custom namespaces\n\n\n      if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && ALLOWED_NAMESPACES[element.namespaceURI]) {\n        return true;\n      } // The code should never reach this place (this means\n      // that the element somehow got namespace that is not\n      // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).\n      // Return false just in case.\n\n\n      return false;\n    };\n    /**\n     * _forceRemove\n     *\n     * @param  {Node} node a DOM node\n     */\n\n\n    var _forceRemove = function _forceRemove(node) {\n      arrayPush(DOMPurify.removed, {\n        element: node\n      });\n\n      try {\n        // eslint-disable-next-line unicorn/prefer-dom-node-remove\n        node.parentNode.removeChild(node);\n      } catch (_) {\n        try {\n          node.outerHTML = emptyHTML;\n        } catch (_) {\n          node.remove();\n        }\n      }\n    };\n    /**\n     * _removeAttribute\n     *\n     * @param  {String} name an Attribute name\n     * @param  {Node} node a DOM node\n     */\n\n\n    var _removeAttribute = function _removeAttribute(name, node) {\n      try {\n        arrayPush(DOMPurify.removed, {\n          attribute: node.getAttributeNode(name),\n          from: node\n        });\n      } catch (_) {\n        arrayPush(DOMPurify.removed, {\n          attribute: null,\n          from: node\n        });\n      }\n\n      node.removeAttribute(name); // We void attribute values for unremovable \"is\"\" attributes\n\n      if (name === 'is' && !ALLOWED_ATTR[name]) {\n        if (RETURN_DOM || RETURN_DOM_FRAGMENT) {\n          try {\n            _forceRemove(node);\n          } catch (_) {}\n        } else {\n          try {\n            node.setAttribute(name, '');\n          } catch (_) {}\n        }\n      }\n    };\n    /**\n     * _initDocument\n     *\n     * @param  {String} dirty a string of dirty markup\n     * @return {Document} a DOM, filled with the dirty markup\n     */\n\n\n    var _initDocument = function _initDocument(dirty) {\n      /* Create a HTML document */\n      var doc;\n      var leadingWhitespace;\n\n      if (FORCE_BODY) {\n        dirty = '<remove></remove>' + dirty;\n      } else {\n        /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */\n        var matches = stringMatch(dirty, /^[\\r\\n\\t ]+/);\n        leadingWhitespace = matches && matches[0];\n      }\n\n      if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && NAMESPACE === HTML_NAMESPACE) {\n        // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)\n        dirty = '<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>' + dirty + '</body></html>';\n      }\n\n      var dirtyPayload = trustedTypesPolicy ? trustedTypesPolicy.createHTML(dirty) : dirty;\n      /*\n       * Use the DOMParser API by default, fallback later if needs be\n       * DOMParser not work for svg when has multiple root element.\n       */\n\n      if (NAMESPACE === HTML_NAMESPACE) {\n        try {\n          doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);\n        } catch (_) {}\n      }\n      /* Use createHTMLDocument in case DOMParser is not available */\n\n\n      if (!doc || !doc.documentElement) {\n        doc = implementation.createDocument(NAMESPACE, 'template', null);\n\n        try {\n          doc.documentElement.innerHTML = IS_EMPTY_INPUT ? emptyHTML : dirtyPayload;\n        } catch (_) {// Syntax error if dirtyPayload is invalid xml\n        }\n      }\n\n      var body = doc.body || doc.documentElement;\n\n      if (dirty && leadingWhitespace) {\n        body.insertBefore(document.createTextNode(leadingWhitespace), body.childNodes[0] || null);\n      }\n      /* Work on whole document or just its body */\n\n\n      if (NAMESPACE === HTML_NAMESPACE) {\n        return getElementsByTagName.call(doc, WHOLE_DOCUMENT ? 'html' : 'body')[0];\n      }\n\n      return WHOLE_DOCUMENT ? doc.documentElement : body;\n    };\n    /**\n     * _createIterator\n     *\n     * @param  {Document} root document/fragment to create iterator for\n     * @return {Iterator} iterator instance\n     */\n\n\n    var _createIterator = function _createIterator(root) {\n      return createNodeIterator.call(root.ownerDocument || root, root, // eslint-disable-next-line no-bitwise\n      NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT, null, false);\n    };\n    /**\n     * _isClobbered\n     *\n     * @param  {Node} elm element to check for clobbering attacks\n     * @return {Boolean} true if clobbered, false if safe\n     */\n\n\n    var _isClobbered = function _isClobbered(elm) {\n      return elm instanceof HTMLFormElement && (typeof elm.nodeName !== 'string' || typeof elm.textContent !== 'string' || typeof elm.removeChild !== 'function' || !(elm.attributes instanceof NamedNodeMap) || typeof elm.removeAttribute !== 'function' || typeof elm.setAttribute !== 'function' || typeof elm.namespaceURI !== 'string' || typeof elm.insertBefore !== 'function' || typeof elm.hasChildNodes !== 'function');\n    };\n    /**\n     * _isNode\n     *\n     * @param  {Node} obj object to check whether it's a DOM node\n     * @return {Boolean} true is object is a DOM node\n     */\n\n\n    var _isNode = function _isNode(object) {\n      return _typeof(Node) === 'object' ? object instanceof Node : object && _typeof(object) === 'object' && typeof object.nodeType === 'number' && typeof object.nodeName === 'string';\n    };\n    /**\n     * _executeHook\n     * Execute user configurable hooks\n     *\n     * @param  {String} entryPoint  Name of the hook's entry point\n     * @param  {Node} currentNode node to work on with the hook\n     * @param  {Object} data additional hook parameters\n     */\n\n\n    var _executeHook = function _executeHook(entryPoint, currentNode, data) {\n      if (!hooks[entryPoint]) {\n        return;\n      }\n\n      arrayForEach(hooks[entryPoint], function (hook) {\n        hook.call(DOMPurify, currentNode, data, CONFIG);\n      });\n    };\n    /**\n     * _sanitizeElements\n     *\n     * @protect nodeName\n     * @protect textContent\n     * @protect removeChild\n     *\n     * @param   {Node} currentNode to check for permission to exist\n     * @return  {Boolean} true if node was killed, false if left alive\n     */\n\n\n    var _sanitizeElements = function _sanitizeElements(currentNode) {\n      var content;\n      /* Execute a hook if present */\n\n      _executeHook('beforeSanitizeElements', currentNode, null);\n      /* Check if element is clobbered or can clobber */\n\n\n      if (_isClobbered(currentNode)) {\n        _forceRemove(currentNode);\n\n        return true;\n      }\n      /* Check if tagname contains Unicode */\n\n\n      if (regExpTest(/[\\u0080-\\uFFFF]/, currentNode.nodeName)) {\n        _forceRemove(currentNode);\n\n        return true;\n      }\n      /* Now let's check the element's type and name */\n\n\n      var tagName = transformCaseFunc(currentNode.nodeName);\n      /* Execute a hook if present */\n\n      _executeHook('uponSanitizeElement', currentNode, {\n        tagName: tagName,\n        allowedTags: ALLOWED_TAGS\n      });\n      /* Detect mXSS attempts abusing namespace confusion */\n\n\n      if (currentNode.hasChildNodes() && !_isNode(currentNode.firstElementChild) && (!_isNode(currentNode.content) || !_isNode(currentNode.content.firstElementChild)) && regExpTest(/<[/\\w]/g, currentNode.innerHTML) && regExpTest(/<[/\\w]/g, currentNode.textContent)) {\n        _forceRemove(currentNode);\n\n        return true;\n      }\n      /* Mitigate a problem with templates inside select */\n\n\n      if (tagName === 'select' && regExpTest(/<template/i, currentNode.innerHTML)) {\n        _forceRemove(currentNode);\n\n        return true;\n      }\n      /* Remove element if anything forbids its presence */\n\n\n      if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n        /* Check if we have a custom element to handle */\n        if (!FORBID_TAGS[tagName] && _basicCustomElementTest(tagName)) {\n          if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)) return false;\n          if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)) return false;\n        }\n        /* Keep content except for bad-listed elements */\n\n\n        if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {\n          var parentNode = getParentNode(currentNode) || currentNode.parentNode;\n          var childNodes = getChildNodes(currentNode) || currentNode.childNodes;\n\n          if (childNodes && parentNode) {\n            var childCount = childNodes.length;\n\n            for (var i = childCount - 1; i >= 0; --i) {\n              parentNode.insertBefore(cloneNode(childNodes[i], true), getNextSibling(currentNode));\n            }\n          }\n        }\n\n        _forceRemove(currentNode);\n\n        return true;\n      }\n      /* Check whether element has a valid namespace */\n\n\n      if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {\n        _forceRemove(currentNode);\n\n        return true;\n      }\n\n      if ((tagName === 'noscript' || tagName === 'noembed') && regExpTest(/<\\/no(script|embed)/i, currentNode.innerHTML)) {\n        _forceRemove(currentNode);\n\n        return true;\n      }\n      /* Sanitize element content to be template-safe */\n\n\n      if (SAFE_FOR_TEMPLATES && currentNode.nodeType === 3) {\n        /* Get the element's text content */\n        content = currentNode.textContent;\n        content = stringReplace(content, MUSTACHE_EXPR$1, ' ');\n        content = stringReplace(content, ERB_EXPR$1, ' ');\n        content = stringReplace(content, TMPLIT_EXPR$1, ' ');\n\n        if (currentNode.textContent !== content) {\n          arrayPush(DOMPurify.removed, {\n            element: currentNode.cloneNode()\n          });\n          currentNode.textContent = content;\n        }\n      }\n      /* Execute a hook if present */\n\n\n      _executeHook('afterSanitizeElements', currentNode, null);\n\n      return false;\n    };\n    /**\n     * _isValidAttribute\n     *\n     * @param  {string} lcTag Lowercase tag name of containing element.\n     * @param  {string} lcName Lowercase attribute name.\n     * @param  {string} value Attribute value.\n     * @return {Boolean} Returns true if `value` is valid, otherwise false.\n     */\n    // eslint-disable-next-line complexity\n\n\n    var _isValidAttribute = function _isValidAttribute(lcTag, lcName, value) {\n      /* Make sure attribute cannot clobber */\n      if (SANITIZE_DOM && (lcName === 'id' || lcName === 'name') && (value in document || value in formElement)) {\n        return false;\n      }\n      /* Allow valid data-* attributes: At least one character after \"-\"\n          (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)\n          XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)\n          We don't need to check the value; it's always URI safe. */\n\n\n      if (ALLOW_DATA_ATTR && !FORBID_ATTR[lcName] && regExpTest(DATA_ATTR$1, lcName)) ; else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR$1, lcName)) ; else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {\n        if ( // First condition does a very basic check if a) it's basically a valid custom element tagname AND\n        // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n        // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck\n        _basicCustomElementTest(lcTag) && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag)) && (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName) || CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName)) || // Alternative, second condition checks if it's an `is`-attribute, AND\n        // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n        lcName === 'is' && CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))) ; else {\n          return false;\n        }\n        /* Check value is safe. First, is attr inert? If so, is safe */\n\n      } else if (URI_SAFE_ATTRIBUTES[lcName]) ; else if (regExpTest(IS_ALLOWED_URI$1, stringReplace(value, ATTR_WHITESPACE$1, ''))) ; else if ((lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') && lcTag !== 'script' && stringIndexOf(value, 'data:') === 0 && DATA_URI_TAGS[lcTag]) ; else if (ALLOW_UNKNOWN_PROTOCOLS && !regExpTest(IS_SCRIPT_OR_DATA$1, stringReplace(value, ATTR_WHITESPACE$1, ''))) ; else if (!value) ; else {\n        return false;\n      }\n\n      return true;\n    };\n    /**\n     * _basicCustomElementCheck\n     * checks if at least one dash is included in tagName, and it's not the first char\n     * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name\n     * @param {string} tagName name of the tag of the node to sanitize\n     */\n\n\n    var _basicCustomElementTest = function _basicCustomElementTest(tagName) {\n      return tagName.indexOf('-') > 0;\n    };\n    /**\n     * _sanitizeAttributes\n     *\n     * @protect attributes\n     * @protect nodeName\n     * @protect removeAttribute\n     * @protect setAttribute\n     *\n     * @param  {Node} currentNode to sanitize\n     */\n\n\n    var _sanitizeAttributes = function _sanitizeAttributes(currentNode) {\n      var attr;\n      var value;\n      var lcName;\n      var l;\n      /* Execute a hook if present */\n\n      _executeHook('beforeSanitizeAttributes', currentNode, null);\n\n      var attributes = currentNode.attributes;\n      /* Check if we have attributes; if not we might have a text node */\n\n      if (!attributes) {\n        return;\n      }\n\n      var hookEvent = {\n        attrName: '',\n        attrValue: '',\n        keepAttr: true,\n        allowedAttributes: ALLOWED_ATTR\n      };\n      l = attributes.length;\n      /* Go backwards over all attributes; safely remove bad ones */\n\n      while (l--) {\n        attr = attributes[l];\n        var _attr = attr,\n            name = _attr.name,\n            namespaceURI = _attr.namespaceURI;\n        value = name === 'value' ? attr.value : stringTrim(attr.value);\n        lcName = transformCaseFunc(name);\n        /* Execute a hook if present */\n\n        hookEvent.attrName = lcName;\n        hookEvent.attrValue = value;\n        hookEvent.keepAttr = true;\n        hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set\n\n        _executeHook('uponSanitizeAttribute', currentNode, hookEvent);\n\n        value = hookEvent.attrValue;\n        /* Did the hooks approve of the attribute? */\n\n        if (hookEvent.forceKeepAttr) {\n          continue;\n        }\n        /* Remove attribute */\n\n\n        _removeAttribute(name, currentNode);\n        /* Did the hooks approve of the attribute? */\n\n\n        if (!hookEvent.keepAttr) {\n          continue;\n        }\n        /* Work around a security issue in jQuery 3.0 */\n\n\n        if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\\/>/i, value)) {\n          _removeAttribute(name, currentNode);\n\n          continue;\n        }\n        /* Sanitize attribute content to be template-safe */\n\n\n        if (SAFE_FOR_TEMPLATES) {\n          value = stringReplace(value, MUSTACHE_EXPR$1, ' ');\n          value = stringReplace(value, ERB_EXPR$1, ' ');\n          value = stringReplace(value, TMPLIT_EXPR$1, ' ');\n        }\n        /* Is `value` valid for this attribute? */\n\n\n        var lcTag = transformCaseFunc(currentNode.nodeName);\n\n        if (!_isValidAttribute(lcTag, lcName, value)) {\n          continue;\n        }\n        /* Full DOM Clobbering protection via namespace isolation,\n         * Prefix id and name attributes with `user-content-`\n         */\n\n\n        if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {\n          // Remove the attribute with this value\n          _removeAttribute(name, currentNode); // Prefix the value and later re-create the attribute with the sanitized value\n\n\n          value = SANITIZE_NAMED_PROPS_PREFIX + value;\n        }\n        /* Handle attributes that require Trusted Types */\n\n\n        if (trustedTypesPolicy && _typeof(trustedTypes) === 'object' && typeof trustedTypes.getAttributeType === 'function') {\n          if (namespaceURI) ; else {\n            switch (trustedTypes.getAttributeType(lcTag, lcName)) {\n              case 'TrustedHTML':\n                value = trustedTypesPolicy.createHTML(value);\n                break;\n\n              case 'TrustedScriptURL':\n                value = trustedTypesPolicy.createScriptURL(value);\n                break;\n            }\n          }\n        }\n        /* Handle invalid data-* attribute set by try-catching it */\n\n\n        try {\n          if (namespaceURI) {\n            currentNode.setAttributeNS(namespaceURI, name, value);\n          } else {\n            /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. \"x-schema\". */\n            currentNode.setAttribute(name, value);\n          }\n\n          arrayPop(DOMPurify.removed);\n        } catch (_) {}\n      }\n      /* Execute a hook if present */\n\n\n      _executeHook('afterSanitizeAttributes', currentNode, null);\n    };\n    /**\n     * _sanitizeShadowDOM\n     *\n     * @param  {DocumentFragment} fragment to iterate over recursively\n     */\n\n\n    var _sanitizeShadowDOM = function _sanitizeShadowDOM(fragment) {\n      var shadowNode;\n\n      var shadowIterator = _createIterator(fragment);\n      /* Execute a hook if present */\n\n\n      _executeHook('beforeSanitizeShadowDOM', fragment, null);\n\n      while (shadowNode = shadowIterator.nextNode()) {\n        /* Execute a hook if present */\n        _executeHook('uponSanitizeShadowNode', shadowNode, null);\n        /* Sanitize tags and elements */\n\n\n        if (_sanitizeElements(shadowNode)) {\n          continue;\n        }\n        /* Deep shadow DOM detected */\n\n\n        if (shadowNode.content instanceof DocumentFragment) {\n          _sanitizeShadowDOM(shadowNode.content);\n        }\n        /* Check attributes, sanitize if necessary */\n\n\n        _sanitizeAttributes(shadowNode);\n      }\n      /* Execute a hook if present */\n\n\n      _executeHook('afterSanitizeShadowDOM', fragment, null);\n    };\n    /**\n     * Sanitize\n     * Public method providing core sanitation functionality\n     *\n     * @param {String|Node} dirty string or DOM node\n     * @param {Object} configuration object\n     */\n    // eslint-disable-next-line complexity\n\n\n    DOMPurify.sanitize = function (dirty) {\n      var cfg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var body;\n      var importedNode;\n      var currentNode;\n      var oldNode;\n      var returnNode;\n      /* Make sure we have a string to sanitize.\n        DO NOT return early, as this will return the wrong type if\n        the user has requested a DOM object rather than a string */\n\n      IS_EMPTY_INPUT = !dirty;\n\n      if (IS_EMPTY_INPUT) {\n        dirty = '<!-->';\n      }\n      /* Stringify, in case dirty is an object */\n\n\n      if (typeof dirty !== 'string' && !_isNode(dirty)) {\n        // eslint-disable-next-line no-negated-condition\n        if (typeof dirty.toString !== 'function') {\n          throw typeErrorCreate('toString is not a function');\n        } else {\n          dirty = dirty.toString();\n\n          if (typeof dirty !== 'string') {\n            throw typeErrorCreate('dirty is not a string, aborting');\n          }\n        }\n      }\n      /* Check we can run. Otherwise fall back or ignore */\n\n\n      if (!DOMPurify.isSupported) {\n        if (_typeof(window.toStaticHTML) === 'object' || typeof window.toStaticHTML === 'function') {\n          if (typeof dirty === 'string') {\n            return window.toStaticHTML(dirty);\n          }\n\n          if (_isNode(dirty)) {\n            return window.toStaticHTML(dirty.outerHTML);\n          }\n        }\n\n        return dirty;\n      }\n      /* Assign config vars */\n\n\n      if (!SET_CONFIG) {\n        _parseConfig(cfg);\n      }\n      /* Clean up removed elements */\n\n\n      DOMPurify.removed = [];\n      /* Check if dirty is correctly typed for IN_PLACE */\n\n      if (typeof dirty === 'string') {\n        IN_PLACE = false;\n      }\n\n      if (IN_PLACE) {\n        /* Do some early pre-sanitization to avoid unsafe root nodes */\n        if (dirty.nodeName) {\n          var tagName = transformCaseFunc(dirty.nodeName);\n\n          if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n            throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');\n          }\n        }\n      } else if (dirty instanceof Node) {\n        /* If dirty is a DOM element, append to an empty document to avoid\n           elements being stripped by the parser */\n        body = _initDocument('<!---->');\n        importedNode = body.ownerDocument.importNode(dirty, true);\n\n        if (importedNode.nodeType === 1 && importedNode.nodeName === 'BODY') {\n          /* Node is already a body, use as is */\n          body = importedNode;\n        } else if (importedNode.nodeName === 'HTML') {\n          body = importedNode;\n        } else {\n          // eslint-disable-next-line unicorn/prefer-dom-node-append\n          body.appendChild(importedNode);\n        }\n      } else {\n        /* Exit directly if we have nothing to do */\n        if (!RETURN_DOM && !SAFE_FOR_TEMPLATES && !WHOLE_DOCUMENT && // eslint-disable-next-line unicorn/prefer-includes\n        dirty.indexOf('<') === -1) {\n          return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(dirty) : dirty;\n        }\n        /* Initialize the document to work on */\n\n\n        body = _initDocument(dirty);\n        /* Check we have a DOM node from the data */\n\n        if (!body) {\n          return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';\n        }\n      }\n      /* Remove first element node (ours) if FORCE_BODY is set */\n\n\n      if (body && FORCE_BODY) {\n        _forceRemove(body.firstChild);\n      }\n      /* Get node iterator */\n\n\n      var nodeIterator = _createIterator(IN_PLACE ? dirty : body);\n      /* Now start iterating over the created document */\n\n\n      while (currentNode = nodeIterator.nextNode()) {\n        /* Fix IE's strange behavior with manipulated textNodes #89 */\n        if (currentNode.nodeType === 3 && currentNode === oldNode) {\n          continue;\n        }\n        /* Sanitize tags and elements */\n\n\n        if (_sanitizeElements(currentNode)) {\n          continue;\n        }\n        /* Shadow DOM detected, sanitize it */\n\n\n        if (currentNode.content instanceof DocumentFragment) {\n          _sanitizeShadowDOM(currentNode.content);\n        }\n        /* Check attributes, sanitize if necessary */\n\n\n        _sanitizeAttributes(currentNode);\n\n        oldNode = currentNode;\n      }\n\n      oldNode = null;\n      /* If we sanitized `dirty` in-place, return it. */\n\n      if (IN_PLACE) {\n        return dirty;\n      }\n      /* Return sanitized string or DOM */\n\n\n      if (RETURN_DOM) {\n        if (RETURN_DOM_FRAGMENT) {\n          returnNode = createDocumentFragment.call(body.ownerDocument);\n\n          while (body.firstChild) {\n            // eslint-disable-next-line unicorn/prefer-dom-node-append\n            returnNode.appendChild(body.firstChild);\n          }\n        } else {\n          returnNode = body;\n        }\n\n        if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmod) {\n          /*\n            AdoptNode() is not used because internal state is not reset\n            (e.g. the past names map of a HTMLFormElement), this is safe\n            in theory but we would rather not risk another attack vector.\n            The state that is cloned by importNode() is explicitly defined\n            by the specs.\n          */\n          returnNode = importNode.call(originalDocument, returnNode, true);\n        }\n\n        return returnNode;\n      }\n\n      var serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;\n      /* Serialize doctype if allowed */\n\n      if (WHOLE_DOCUMENT && ALLOWED_TAGS['!doctype'] && body.ownerDocument && body.ownerDocument.doctype && body.ownerDocument.doctype.name && regExpTest(DOCTYPE_NAME, body.ownerDocument.doctype.name)) {\n        serializedHTML = '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\\n' + serializedHTML;\n      }\n      /* Sanitize final string template-safe */\n\n\n      if (SAFE_FOR_TEMPLATES) {\n        serializedHTML = stringReplace(serializedHTML, MUSTACHE_EXPR$1, ' ');\n        serializedHTML = stringReplace(serializedHTML, ERB_EXPR$1, ' ');\n        serializedHTML = stringReplace(serializedHTML, TMPLIT_EXPR$1, ' ');\n      }\n\n      return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(serializedHTML) : serializedHTML;\n    };\n    /**\n     * Public method to set the configuration once\n     * setConfig\n     *\n     * @param {Object} cfg configuration object\n     */\n\n\n    DOMPurify.setConfig = function (cfg) {\n      _parseConfig(cfg);\n\n      SET_CONFIG = true;\n    };\n    /**\n     * Public method to remove the configuration\n     * clearConfig\n     *\n     */\n\n\n    DOMPurify.clearConfig = function () {\n      CONFIG = null;\n      SET_CONFIG = false;\n    };\n    /**\n     * Public method to check if an attribute value is valid.\n     * Uses last set config, if any. Otherwise, uses config defaults.\n     * isValidAttribute\n     *\n     * @param  {string} tag Tag name of containing element.\n     * @param  {string} attr Attribute name.\n     * @param  {string} value Attribute value.\n     * @return {Boolean} Returns true if `value` is valid. Otherwise, returns false.\n     */\n\n\n    DOMPurify.isValidAttribute = function (tag, attr, value) {\n      /* Initialize shared config vars if necessary. */\n      if (!CONFIG) {\n        _parseConfig({});\n      }\n\n      var lcTag = transformCaseFunc(tag);\n      var lcName = transformCaseFunc(attr);\n      return _isValidAttribute(lcTag, lcName, value);\n    };\n    /**\n     * AddHook\n     * Public method to add DOMPurify hooks\n     *\n     * @param {String} entryPoint entry point for the hook to add\n     * @param {Function} hookFunction function to execute\n     */\n\n\n    DOMPurify.addHook = function (entryPoint, hookFunction) {\n      if (typeof hookFunction !== 'function') {\n        return;\n      }\n\n      hooks[entryPoint] = hooks[entryPoint] || [];\n      arrayPush(hooks[entryPoint], hookFunction);\n    };\n    /**\n     * RemoveHook\n     * Public method to remove a DOMPurify hook at a given entryPoint\n     * (pops it from the stack of hooks if more are present)\n     *\n     * @param {String} entryPoint entry point for the hook to remove\n     * @return {Function} removed(popped) hook\n     */\n\n\n    DOMPurify.removeHook = function (entryPoint) {\n      if (hooks[entryPoint]) {\n        return arrayPop(hooks[entryPoint]);\n      }\n    };\n    /**\n     * RemoveHooks\n     * Public method to remove all DOMPurify hooks at a given entryPoint\n     *\n     * @param  {String} entryPoint entry point for the hooks to remove\n     */\n\n\n    DOMPurify.removeHooks = function (entryPoint) {\n      if (hooks[entryPoint]) {\n        hooks[entryPoint] = [];\n      }\n    };\n    /**\n     * RemoveAllHooks\n     * Public method to remove all DOMPurify hooks\n     *\n     */\n\n\n    DOMPurify.removeAllHooks = function () {\n      hooks = {};\n    };\n\n    return DOMPurify;\n  }\n\n  var purify = createDOMPurify();\n\n  return purify;\n\n}));\n//# sourceMappingURL=purify.js.map\n","/*!\n * Draggabilly v3.0.0\n * Make that shiz draggable\n * https://draggabilly.desandro.com\n * MIT license\n */\n\n( function( window, factory ) {\n  // universal module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory(\n        window,\n        require('get-size'),\n        require('unidragger'),\n    );\n  } else {\n    // browser global\n    window.Draggabilly = factory(\n        window,\n        window.getSize,\n        window.Unidragger,\n    );\n  }\n\n}( typeof window != 'undefined' ? window : this,\n    function factory( window, getSize, Unidragger ) {\n\n// -------------------------- helpers & variables -------------------------- //\n\nfunction noop() {}\n\nlet jQuery = window.jQuery;\n\n// -------------------------- Draggabilly -------------------------- //\n\nfunction Draggabilly( element, options ) {\n  // querySelector if string\n  this.element = typeof element == 'string' ?\n    document.querySelector( element ) : element;\n\n  if ( jQuery ) {\n    this.$element = jQuery( this.element );\n  }\n\n  // options\n  this.options = {};\n  this.option( options );\n\n  this._create();\n}\n\n// inherit Unidragger methods\nlet proto = Draggabilly.prototype = Object.create( Unidragger.prototype );\n\n/**\n * set options\n * @param {Object} opts\n */\nproto.option = function( opts ) {\n  this.options = {\n    ...this.options,\n    ...opts,\n  };\n};\n\n// css position values that don't need to be set\nconst positionValues = [ 'relative', 'absolute', 'fixed' ];\n\nproto._create = function() {\n  // properties\n  this.position = {};\n  this._getPosition();\n\n  this.startPoint = { x: 0, y: 0 };\n  this.dragPoint = { x: 0, y: 0 };\n\n  this.startPosition = { ...this.position };\n\n  // set relative positioning\n  let style = getComputedStyle( this.element );\n  if ( !positionValues.includes( style.position ) ) {\n    this.element.style.position = 'relative';\n  }\n\n  // events\n  this.on( 'pointerDown', this.handlePointerDown );\n  this.on( 'pointerUp', this.handlePointerUp );\n  this.on( 'dragStart', this.handleDragStart );\n  this.on( 'dragMove', this.handleDragMove );\n  this.on( 'dragEnd', this.handleDragEnd );\n\n  this.setHandles();\n  this.enable();\n};\n\n// set this.handles  and bind start events to 'em\nproto.setHandles = function() {\n  let { handle } = this.options;\n  if ( typeof handle == 'string' ) {\n    this.handles = this.element.querySelectorAll( handle );\n  } else if ( typeof handle == 'object' && handle.length ) {\n    this.handles = handle;\n  } else if ( handle instanceof HTMLElement ) {\n    this.handles = [ handle ];\n  } else {\n    this.handles = [ this.element ];\n  }\n};\n\nconst cancelableEvents = [ 'dragStart', 'dragMove', 'dragEnd' ];\n\n// duck-punch emitEvent to dispatch jQuery events as well\nlet emitEvent = proto.emitEvent;\nproto.emitEvent = function( eventName, args ) {\n  // do not emit cancelable events if dragging is disabled\n  let isCanceled = !this.isEnabled && cancelableEvents.includes( eventName );\n  if ( isCanceled ) return;\n\n  emitEvent.call( this, eventName, args );\n\n  // trigger jQuery event\n  let jquery = window.jQuery;\n  if ( !jquery || !this.$element ) return;\n  // create jQuery event\n  let event;\n  let jqArgs = args;\n  let isFirstArgEvent = args && args[0] instanceof Event;\n  if ( isFirstArgEvent ) [ event, ...jqArgs ] = args;\n  /* eslint-disable-next-line new-cap */\n  let $event = jquery.Event( event );\n  $event.type = eventName;\n  this.$element.trigger( $event, jqArgs );\n};\n\n// -------------------------- position -------------------------- //\n\n// get x/y position from style\nproto._getPosition = function() {\n  let style = getComputedStyle( this.element );\n  let x = this._getPositionCoord( style.left, 'width' );\n  let y = this._getPositionCoord( style.top, 'height' );\n  // clean up 'auto' or other non-integer values\n  this.position.x = isNaN( x ) ? 0 : x;\n  this.position.y = isNaN( y ) ? 0 : y;\n\n  this._addTransformPosition( style );\n};\n\nproto._getPositionCoord = function( styleSide, measure ) {\n  if ( styleSide.includes('%') ) {\n    // convert percent into pixel for Safari, #75\n    let parentSize = getSize( this.element.parentNode );\n    // prevent not-in-DOM element throwing bug, #131\n    return !parentSize ? 0 :\n      ( parseFloat( styleSide ) / 100 ) * parentSize[ measure ];\n  }\n  return parseInt( styleSide, 10 );\n};\n\n// add transform: translate( x, y ) to position\nproto._addTransformPosition = function( style ) {\n  let transform = style.transform;\n  // bail out if value is 'none'\n  if ( !transform.startsWith('matrix') ) return;\n\n  // split matrix(1, 0, 0, 1, x, y)\n  let matrixValues = transform.split(',');\n  // translate X value is in 12th or 4th position\n  let xIndex = transform.startsWith('matrix3d') ? 12 : 4;\n  let translateX = parseInt( matrixValues[ xIndex ], 10 );\n  // translate Y value is in 13th or 5th position\n  let translateY = parseInt( matrixValues[ xIndex + 1 ], 10 );\n  this.position.x += translateX;\n  this.position.y += translateY;\n};\n\n// -------------------------- events -------------------------- //\n\nproto.handlePointerDown = function( event, pointer ) {\n  if ( !this.isEnabled ) return;\n  // track start event position\n  // Safari 9 overrides pageX and pageY. These values needs to be copied. flickity#842\n  this.pointerDownPointer = {\n    pageX: pointer.pageX,\n    pageY: pointer.pageY,\n  };\n\n  event.preventDefault();\n  document.activeElement.blur();\n  // bind move and end events\n  this.bindActivePointerEvents( event );\n  this.element.classList.add('is-pointer-down');\n};\n\nproto.handleDragStart = function() {\n  if ( !this.isEnabled ) return;\n\n  this._getPosition();\n  this.measureContainment();\n  // position _when_ drag began\n  this.startPosition.x = this.position.x;\n  this.startPosition.y = this.position.y;\n  // reset left/top style\n  this.setLeftTop();\n\n  this.dragPoint.x = 0;\n  this.dragPoint.y = 0;\n\n  this.element.classList.add('is-dragging');\n  // start animation\n  this.animate();\n};\n\nproto.measureContainment = function() {\n  let container = this.getContainer();\n  if ( !container ) return;\n\n  let elemSize = getSize( this.element );\n  let containerSize = getSize( container );\n  let {\n    borderLeftWidth,\n    borderRightWidth,\n    borderTopWidth,\n    borderBottomWidth,\n  } = containerSize;\n  let elemRect = this.element.getBoundingClientRect();\n  let containerRect = container.getBoundingClientRect();\n\n  let borderSizeX = borderLeftWidth + borderRightWidth;\n  let borderSizeY = borderTopWidth + borderBottomWidth;\n\n  let position = this.relativeStartPosition = {\n    x: elemRect.left - ( containerRect.left + borderLeftWidth ),\n    y: elemRect.top - ( containerRect.top + borderTopWidth ),\n  };\n\n  this.containSize = {\n    width: ( containerSize.width - borderSizeX ) - position.x - elemSize.width,\n    height: ( containerSize.height - borderSizeY ) - position.y - elemSize.height,\n  };\n};\n\nproto.getContainer = function() {\n  let containment = this.options.containment;\n  if ( !containment ) return;\n\n  let isElement = containment instanceof HTMLElement;\n  // use as element\n  if ( isElement ) return containment;\n\n  // querySelector if string\n  if ( typeof containment == 'string' ) {\n    return document.querySelector( containment );\n  }\n  // fallback to parent element\n  return this.element.parentNode;\n};\n\n// ----- move event ----- //\n\n/**\n * drag move\n * @param {Event} event\n * @param {Event | Touch} pointer\n * @param {Object} moveVector - x and y coordinates\n */\nproto.handleDragMove = function( event, pointer, moveVector ) {\n  if ( !this.isEnabled ) return;\n\n  let dragX = moveVector.x;\n  let dragY = moveVector.y;\n\n  let grid = this.options.grid;\n  let gridX = grid && grid[0];\n  let gridY = grid && grid[1];\n\n  dragX = applyGrid( dragX, gridX );\n  dragY = applyGrid( dragY, gridY );\n\n  dragX = this.containDrag( 'x', dragX, gridX );\n  dragY = this.containDrag( 'y', dragY, gridY );\n\n  // constrain to axis\n  dragX = this.options.axis == 'y' ? 0 : dragX;\n  dragY = this.options.axis == 'x' ? 0 : dragY;\n\n  this.position.x = this.startPosition.x + dragX;\n  this.position.y = this.startPosition.y + dragY;\n  // set dragPoint properties\n  this.dragPoint.x = dragX;\n  this.dragPoint.y = dragY;\n};\n\nfunction applyGrid( value, grid, method ) {\n  if ( !grid ) return value;\n\n  method = method || 'round';\n  return Math[ method ]( value/grid ) * grid;\n}\n\nproto.containDrag = function( axis, drag, grid ) {\n  if ( !this.options.containment ) return drag;\n\n  let measure = axis == 'x' ? 'width' : 'height';\n\n  let rel = this.relativeStartPosition[ axis ];\n  let min = applyGrid( -rel, grid, 'ceil' );\n  let max = this.containSize[ measure ];\n  max = applyGrid( max, grid, 'floor' );\n  return Math.max( min, Math.min( max, drag ) );\n};\n\n// ----- end event ----- //\n\nproto.handlePointerUp = function() {\n  this.element.classList.remove('is-pointer-down');\n};\n\nproto.handleDragEnd = function() {\n  if ( !this.isEnabled ) return;\n\n  // use top left position when complete\n  this.element.style.transform = '';\n  this.setLeftTop();\n  this.element.classList.remove('is-dragging');\n};\n\n// -------------------------- animation -------------------------- //\n\nproto.animate = function() {\n  // only render and animate if dragging\n  if ( !this.isDragging ) return;\n\n  this.positionDrag();\n  requestAnimationFrame( () => this.animate() );\n};\n\n// left/top positioning\nproto.setLeftTop = function() {\n  let { x, y } = this.position;\n  this.element.style.left = `${x}px`;\n  this.element.style.top = `${y}px`;\n};\n\nproto.positionDrag = function() {\n  let { x, y } = this.dragPoint;\n  this.element.style.transform = `translate3d(${x}px, ${y}px, 0)`;\n};\n\n// ----- methods ----- //\n\n/**\n * @param {Number} x\n * @param {Number} y\n */\nproto.setPosition = function( x, y ) {\n  this.position.x = x;\n  this.position.y = y;\n  this.setLeftTop();\n};\n\nproto.enable = function() {\n  if ( this.isEnabled ) return;\n  this.isEnabled = true;\n  this.bindHandles();\n};\n\nproto.disable = function() {\n  if ( !this.isEnabled ) return;\n  this.isEnabled = false;\n  if ( this.isDragging ) this.dragEnd();\n  this.unbindHandles();\n};\n\nconst resetCssProperties = [ 'transform', 'left', 'top', 'position' ];\n\nproto.destroy = function() {\n  this.disable();\n  // reset styles\n  resetCssProperties.forEach( ( prop ) => {\n    this.element.style[ prop ] = '';\n  } );\n  // unbind handles\n  this.unbindHandles();\n  // remove jQuery data\n  if ( this.$element ) this.$element.removeData('draggabilly');\n};\n\n// ----- jQuery bridget ----- //\n\n// required for jQuery bridget\nproto._init = noop;\n\nif ( jQuery && jQuery.bridget ) {\n  jQuery.bridget( 'draggabilly', Draggabilly );\n}\n\n// -----  ----- //\n\nreturn Draggabilly;\n\n} ) );\n","/**\n * EvEmitter v2.1.1\n * Lil' event emitter\n * MIT License\n */\n\n( function( global, factory ) {\n  // universal module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS - Browserify, Webpack\n    module.exports = factory();\n  } else {\n    // Browser globals\n    global.EvEmitter = factory();\n  }\n\n}( typeof window != 'undefined' ? window : this, function() {\n\nfunction EvEmitter() {}\n\nlet proto = EvEmitter.prototype;\n\nproto.on = function( eventName, listener ) {\n  if ( !eventName || !listener ) return this;\n\n  // set events hash\n  let events = this._events = this._events || {};\n  // set listeners array\n  let listeners = events[ eventName ] = events[ eventName ] || [];\n  // only add once\n  if ( !listeners.includes( listener ) ) {\n    listeners.push( listener );\n  }\n\n  return this;\n};\n\nproto.once = function( eventName, listener ) {\n  if ( !eventName || !listener ) return this;\n\n  // add event\n  this.on( eventName, listener );\n  // set once flag\n  // set onceEvents hash\n  let onceEvents = this._onceEvents = this._onceEvents || {};\n  // set onceListeners object\n  let onceListeners = onceEvents[ eventName ] = onceEvents[ eventName ] || {};\n  // set flag\n  onceListeners[ listener ] = true;\n\n  return this;\n};\n\nproto.off = function( eventName, listener ) {\n  let listeners = this._events && this._events[ eventName ];\n  if ( !listeners || !listeners.length ) return this;\n\n  let index = listeners.indexOf( listener );\n  if ( index != -1 ) {\n    listeners.splice( index, 1 );\n  }\n\n  return this;\n};\n\nproto.emitEvent = function( eventName, args ) {\n  let listeners = this._events && this._events[ eventName ];\n  if ( !listeners || !listeners.length ) return this;\n\n  // copy over to avoid interference if .off() in listener\n  listeners = listeners.slice( 0 );\n  args = args || [];\n  // once stuff\n  let onceListeners = this._onceEvents && this._onceEvents[ eventName ];\n\n  for ( let listener of listeners ) {\n    let isOnce = onceListeners && onceListeners[ listener ];\n    if ( isOnce ) {\n      // remove listener\n      // remove before trigger to prevent recursion\n      this.off( eventName, listener );\n      // unset once flag\n      delete onceListeners[ listener ];\n    }\n    // trigger listener\n    listener.apply( this, args );\n  }\n\n  return this;\n};\n\nproto.allOff = function() {\n  delete this._events;\n  delete this._onceEvents;\n  return this;\n};\n\nreturn EvEmitter;\n\n} ) );\n","/**\n * findAndReplaceDOMText v 0.4.6\n * @author James Padolsey http://james.padolsey.com\n * @license http://unlicense.org/UNLICENSE\n *\n * Matches the text of a DOM node against a regular expression\n * and replaces each match (or node-separated portions of the match)\n * in the specified element.\n */\n (function (root, factory) {\n     if (typeof module === 'object' && module.exports) {\n         // Node/CommonJS\n         module.exports = factory();\n     } else if (typeof define === 'function' && define.amd) {\n         // AMD. Register as an anonymous module.\n         define(factory);\n     } else {\n         // Browser globals\n         root.findAndReplaceDOMText = factory();\n     }\n }(this, function factory() {\n\n\tvar PORTION_MODE_RETAIN = 'retain';\n\tvar PORTION_MODE_FIRST = 'first';\n\n\tvar doc = document;\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction escapeRegExp(s) {\n\t\treturn String(s).replace(/([.*+?^=!:${}()|[\\]\\/\\\\])/g, '\\\\$1');\n\t}\n\n\tfunction exposed() {\n\t\t// Try deprecated arg signature first:\n\t\treturn deprecated.apply(null, arguments) || findAndReplaceDOMText.apply(null, arguments);\n\t}\n\n\tfunction deprecated(regex, node, replacement, captureGroup, elFilter) {\n\t\tif ((node && !node.nodeType) && arguments.length <= 2) {\n\t\t\treturn false;\n\t\t}\n\t\tvar isReplacementFunction = typeof replacement == 'function';\n\n\t\tif (isReplacementFunction) {\n\t\t\treplacement = (function(original) {\n\t\t\t\treturn function(portion, match) {\n\t\t\t\t\treturn original(portion.text, match.startIndex);\n\t\t\t\t};\n\t\t\t}(replacement));\n\t\t}\n\n\t\t// Awkward support for deprecated argument signature (<0.4.0)\n\t\tvar instance = findAndReplaceDOMText(node, {\n\n\t\t\tfind: regex,\n\n\t\t\twrap: isReplacementFunction ? null : replacement,\n\t\t\treplace: isReplacementFunction ? replacement : '$' + (captureGroup || '&'),\n\n\t\t\tprepMatch: function(m, mi) {\n\n\t\t\t\t// Support captureGroup (a deprecated feature)\n\n\t\t\t\tif (!m[0]) throw 'findAndReplaceDOMText cannot handle zero-length matches';\n\n\t\t\t\tif (captureGroup > 0) {\n\t\t\t\t\tvar cg = m[captureGroup];\n\t\t\t\t\tm.index += m[0].indexOf(cg);\n\t\t\t\t\tm[0] = cg;\n\t\t\t\t}\n\n\t\t\t\tm.endIndex = m.index + m[0].length;\n\t\t\t\tm.startIndex = m.index;\n\t\t\t\tm.index = mi;\n\n\t\t\t\treturn m;\n\t\t\t},\n\t\t\tfilterElements: elFilter\n\t\t});\n\n\t\texposed.revert = function() {\n\t\t\treturn instance.revert();\n\t\t};\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * findAndReplaceDOMText\n\t *\n\t * Locates matches and replaces with replacementNode\n\t *\n\t * @param {Node} node Element or Text node to search within\n\t * @param {RegExp} options.find The regular expression to match\n\t * @param {String|Element} [options.wrap] A NodeName, or a Node to clone\n\t * @param {String} [options.wrapClass] A classname to append to the wrapping element\n\t * @param {String|Function} [options.replace='$&'] What to replace each match with\n\t * @param {Function} [options.filterElements] A Function to be called to check whether to\n\t *\tprocess an element. (returning true = process element,\n\t *\treturning false = avoid element)\n\t */\n\tfunction findAndReplaceDOMText(node, options) {\n\t\treturn new Finder(node, options);\n\t}\n\n\texposed.NON_PROSE_ELEMENTS = {\n\t\tbr:1, hr:1,\n\t\t// Media / Source elements:\n\t\tscript:1, style:1, img:1, video:1, audio:1, canvas:1, svg:1, map:1, object:1,\n\t\t// Input elements\n\t\tinput:1, textarea:1, select:1, option:1, optgroup: 1, button:1\n\t};\n\n\texposed.NON_CONTIGUOUS_PROSE_ELEMENTS = {\n\n\t\t// Elements that will not contain prose or block elements where we don't\n\t\t// want prose to be matches across element borders:\n\n\t\t// Block Elements\n\t\taddress:1, article:1, aside:1, blockquote:1, dd:1, div:1,\n\t\tdl:1, fieldset:1, figcaption:1, figure:1, footer:1, form:1, h1:1, h2:1, h3:1,\n\t\th4:1, h5:1, h6:1, header:1, hgroup:1, hr:1, main:1, nav:1, noscript:1, ol:1,\n\t\toutput:1, p:1, pre:1, section:1, ul:1,\n\t\t// Other misc. elements that are not part of continuous inline prose:\n\t\tbr:1, li: 1, summary: 1, dt:1, details:1, rp:1, rt:1, rtc:1,\n\t\t// Media / Source elements:\n\t\tscript:1, style:1, img:1, video:1, audio:1, canvas:1, svg:1, map:1, object:1,\n\t\t// Input elements\n\t\tinput:1, textarea:1, select:1, option:1, optgroup:1, button:1,\n\t\t// Table related elements:\n\t\ttable:1, tbody:1, thead:1, th:1, tr:1, td:1, caption:1, col:1, tfoot:1, colgroup:1\n\n\t};\n\n\texposed.NON_INLINE_PROSE = function(el) {\n\t\treturn hasOwn.call(exposed.NON_CONTIGUOUS_PROSE_ELEMENTS, el.nodeName.toLowerCase());\n\t};\n\n\t// Presets accessed via `options.preset` when calling findAndReplaceDOMText():\n\texposed.PRESETS = {\n\t\tprose: {\n\t\t\tforceContext: exposed.NON_INLINE_PROSE,\n\t\t\tfilterElements: function(el) {\n\t\t\t\treturn !hasOwn.call(exposed.NON_PROSE_ELEMENTS, el.nodeName.toLowerCase());\n\t\t\t}\n\t\t}\n\t};\n\n\texposed.Finder = Finder;\n\n\t/**\n\t * Finder -- encapsulates logic to find and replace.\n\t */\n\tfunction Finder(node, options) {\n\n\t\tvar preset = options.preset && exposed.PRESETS[options.preset];\n\n\t\toptions.portionMode = options.portionMode || PORTION_MODE_RETAIN;\n\n\t\tif (preset) {\n\t\t\tfor (var i in preset) {\n\t\t\t\tif (hasOwn.call(preset, i) && !hasOwn.call(options, i)) {\n\t\t\t\t\toptions[i] = preset[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.node = node;\n\t\tthis.options = options;\n\n\t\t// Enable match-preparation method to be passed as option:\n\t\tthis.prepMatch = options.prepMatch || this.prepMatch;\n\n\t\tthis.reverts = [];\n\n\t\tthis.matches = this.search();\n\n\t\tif (this.matches.length) {\n\t\t\tthis.processMatches();\n\t\t}\n\n\t}\n\n\tFinder.prototype = {\n\n\t\t/**\n\t\t * Searches for all matches that comply with the instance's 'match' option\n\t\t */\n\t\tsearch: function() {\n\n\t\t\tvar match;\n\t\t\tvar matchIndex = 0;\n\t\t\tvar offset = 0;\n\t\t\tvar regex = this.options.find;\n\t\t\tvar textAggregation = this.getAggregateText();\n\t\t\tvar matches = [];\n\t\t\tvar self = this;\n\n\t\t\tregex = typeof regex === 'string' ? RegExp(escapeRegExp(regex), 'g') : regex;\n\n\t\t\tmatchAggregation(textAggregation);\n\n\t\t\tfunction matchAggregation(textAggregation) {\n\t\t\t\tfor (var i = 0, l = textAggregation.length; i < l; ++i) {\n\n\t\t\t\t\tvar text = textAggregation[i];\n\n\t\t\t\t\tif (typeof text !== 'string') {\n\t\t\t\t\t\t// Deal with nested contexts: (recursive)\n\t\t\t\t\t\tmatchAggregation(text);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (regex.global) {\n\t\t\t\t\t\twhile (match = regex.exec(text)) {\n\t\t\t\t\t\t\tmatches.push(self.prepMatch(match, matchIndex++, offset));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (match = text.match(regex)) {\n\t\t\t\t\t\t\tmatches.push(self.prepMatch(match, 0, offset));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\toffset += text.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn matches;\n\n\t\t},\n\n\t\t/**\n\t\t * Prepares a single match with useful meta info:\n\t\t */\n\t\tprepMatch: function(match, matchIndex, characterOffset) {\n\n\t\t\tif (!match[0]) {\n\t\t\t\tthrow new Error('findAndReplaceDOMText cannot handle zero-length matches');\n\t\t\t}\n\n\t\t\tmatch.endIndex = characterOffset + match.index + match[0].length;\n\t\t\tmatch.startIndex = characterOffset + match.index;\n\t\t\tmatch.index = matchIndex;\n\n\t\t\treturn match;\n\t\t},\n\n\t\t/**\n\t\t * Gets aggregate text within subject node\n\t\t */\n\t\tgetAggregateText: function() {\n\n\t\t\tvar elementFilter = this.options.filterElements;\n\t\t\tvar forceContext = this.options.forceContext;\n\n\t\t\treturn getText(this.node);\n\n\t\t\t/**\n\t\t\t * Gets aggregate text of a node without resorting\n\t\t\t * to broken innerText/textContent\n\t\t\t */\n\t\t\tfunction getText(node) {\n\n\t\t\t\tif (node.nodeType === Node.TEXT_NODE) {\n\t\t\t\t\treturn [node.data];\n\t\t\t\t}\n\n\t\t\t\tif (elementFilter && !elementFilter(node)) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\tvar txt = [''];\n\t\t\t\tvar i = 0;\n\n\t\t\t\tif (node = node.firstChild) do {\n\n\t\t\t\t\tif (node.nodeType === Node.TEXT_NODE) {\n\t\t\t\t\t\ttxt[i] += node.data;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar innerText = getText(node);\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tforceContext &&\n\t\t\t\t\t\tnode.nodeType === Node.ELEMENT_NODE &&\n\t\t\t\t\t\t(forceContext === true || forceContext(node))\n\t\t\t\t\t) {\n\t\t\t\t\t\ttxt[++i] = innerText;\n\t\t\t\t\t\ttxt[++i] = '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (typeof innerText[0] === 'string') {\n\t\t\t\t\t\t\t// Bridge nested text-node data so that they're\n\t\t\t\t\t\t\t// not considered their own contexts:\n\t\t\t\t\t\t\t// I.e. ['some', ['thing']] -> ['something']\n\t\t\t\t\t\t\ttxt[i] += innerText.shift();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (innerText.length) {\n\t\t\t\t\t\t\ttxt[++i] = innerText;\n\t\t\t\t\t\t\ttxt[++i] = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} while (node = node.nextSibling);\n\n\t\t\t\treturn txt;\n\n\t\t\t}\n\n\t\t},\n\n\t\t/**\n\t\t * Steps through the target node, looking for matches, and\n\t\t * calling replaceFn when a match is found.\n\t\t */\n\t\tprocessMatches: function() {\n\n\t\t\tvar matches = this.matches;\n\t\t\tvar node = this.node;\n\t\t\tvar elementFilter = this.options.filterElements;\n\n\t\t\tvar startPortion,\n\t\t\t\tendPortion,\n\t\t\t\tinnerPortions = [],\n\t\t\t\tcurNode = node,\n\t\t\t\tmatch = matches.shift(),\n\t\t\t\tatIndex = 0, // i.e. nodeAtIndex\n\t\t\t\tmatchIndex = 0,\n\t\t\t\tportionIndex = 0,\n\t\t\t\tdoAvoidNode,\n\t\t\t\tnodeStack = [node];\n\n\t\t\tout: while (true) {\n\n\t\t\t\tif (curNode.nodeType === Node.TEXT_NODE) {\n\n\t\t\t\t\tif (!endPortion && curNode.length + atIndex >= match.endIndex) {\n\t\t\t\t\t\t// We've found the ending\n\t\t\t\t\t\t// (Note that, in the case of a single portion, it'll be an\n\t\t\t\t\t\t// endPortion, not a startPortion.)\n\t\t\t\t\t\tendPortion = {\n\t\t\t\t\t\t\tnode: curNode,\n\t\t\t\t\t\t\tindex: portionIndex++,\n\t\t\t\t\t\t\ttext: curNode.data.substring(match.startIndex - atIndex, match.endIndex - atIndex),\n\n\t\t\t\t\t\t\t// If it's the first match (atIndex==0) we should just return 0\n\t\t\t\t\t\t\tindexInMatch: atIndex === 0 ? 0 : atIndex - match.startIndex,\n\n\t\t\t\t\t\t\tindexInNode: match.startIndex - atIndex,\n\t\t\t\t\t\t\tendIndexInNode: match.endIndex - atIndex,\n\t\t\t\t\t\t\tisEnd: true\n\t\t\t\t\t\t};\n\n\t\t\t\t\t} else if (startPortion) {\n\t\t\t\t\t\t// Intersecting node\n\t\t\t\t\t\tinnerPortions.push({\n\t\t\t\t\t\t\tnode: curNode,\n\t\t\t\t\t\t\tindex: portionIndex++,\n\t\t\t\t\t\t\ttext: curNode.data,\n\t\t\t\t\t\t\tindexInMatch: atIndex - match.startIndex,\n\t\t\t\t\t\t\tindexInNode: 0 // always zero for inner-portions\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!startPortion && curNode.length + atIndex > match.startIndex) {\n\t\t\t\t\t\t// We've found the match start\n\t\t\t\t\t\tstartPortion = {\n\t\t\t\t\t\t\tnode: curNode,\n\t\t\t\t\t\t\tindex: portionIndex++,\n\t\t\t\t\t\t\tindexInMatch: 0,\n\t\t\t\t\t\t\tindexInNode: match.startIndex - atIndex,\n\t\t\t\t\t\t\tendIndexInNode: match.endIndex - atIndex,\n\t\t\t\t\t\t\ttext: curNode.data.substring(match.startIndex - atIndex, match.endIndex - atIndex)\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tatIndex += curNode.data.length;\n\n\t\t\t\t}\n\n\t\t\t\tdoAvoidNode = curNode.nodeType === Node.ELEMENT_NODE && elementFilter && !elementFilter(curNode);\n\n\t\t\t\tif (startPortion && endPortion) {\n\n\t\t\t\t\tcurNode = this.replaceMatch(match, startPortion, innerPortions, endPortion);\n\n\t\t\t\t\t// processMatches has to return the node that replaced the endNode\n\t\t\t\t\t// and then we step back so we can continue from the end of the\n\t\t\t\t\t// match:\n\n\t\t\t\t\tatIndex -= (endPortion.node.data.length - endPortion.endIndexInNode);\n\n\t\t\t\t\tstartPortion = null;\n\t\t\t\t\tendPortion = null;\n\t\t\t\t\tinnerPortions = [];\n\t\t\t\t\tmatch = matches.shift();\n\t\t\t\t\tportionIndex = 0;\n\t\t\t\t\tmatchIndex++;\n\n\t\t\t\t\tif (!match) {\n\t\t\t\t\t\tbreak; // no more matches\n\t\t\t\t\t}\n\n\t\t\t\t} else if (\n\t\t\t\t\t!doAvoidNode &&\n\t\t\t\t\t(curNode.firstChild || curNode.nextSibling)\n\t\t\t\t) {\n\t\t\t\t\t// Move down or forward:\n\t\t\t\t\tif (curNode.firstChild) {\n\t\t\t\t\t\tnodeStack.push(curNode);\n\t\t\t\t\t\tcurNode = curNode.firstChild;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurNode = curNode.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Move forward or up:\n\t\t\t\twhile (true) {\n\t\t\t\t\tif (curNode.nextSibling) {\n\t\t\t\t\t\tcurNode = curNode.nextSibling;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcurNode = nodeStack.pop();\n\t\t\t\t\tif (curNode === node) {\n\t\t\t\t\t\tbreak out;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t},\n\n\t\t/**\n\t\t * Reverts ... TODO\n\t\t */\n\t\trevert: function() {\n\t\t\t// Reversion occurs backwards so as to avoid nodes subsequently\n\t\t\t// replaced during the matching phase (a forward process):\n\t\t\tfor (var l = this.reverts.length; l--;) {\n\t\t\t\tthis.reverts[l]();\n\t\t\t}\n\t\t\tthis.reverts = [];\n\t\t},\n\n\t\tprepareReplacementString: function(string, portion, match) {\n\t\t\tvar portionMode = this.options.portionMode;\n\t\t\tif (\n\t\t\t\tportionMode === PORTION_MODE_FIRST &&\n\t\t\t\tportion.indexInMatch > 0\n\t\t\t) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tstring = string.replace(/\\$(\\d+|&|`|')/g, function($0, t) {\n\t\t\t\tvar replacement;\n\t\t\t\tswitch(t) {\n\t\t\t\t\tcase '&':\n\t\t\t\t\t\treplacement = match[0];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase '`':\n\t\t\t\t\t\treplacement = match.input.substring(0, match.startIndex);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase '\\'':\n\t\t\t\t\t\treplacement = match.input.substring(match.endIndex);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treplacement = match[+t] || '';\n\t\t\t\t}\n\t\t\t\treturn replacement;\n\t\t\t});\n\n\t\t\tif (portionMode === PORTION_MODE_FIRST) {\n\t\t\t\treturn string;\n\t\t\t}\n\n\t\t\tif (portion.isEnd) {\n\t\t\t\treturn string.substring(portion.indexInMatch);\n\t\t\t}\n\n\t\t\treturn string.substring(portion.indexInMatch, portion.indexInMatch + portion.text.length);\n\t\t},\n\n\t\tgetPortionReplacementNode: function(portion, match) {\n\n\t\t\tvar replacement = this.options.replace || '$&';\n\t\t\tvar wrapper = this.options.wrap;\n\t\t\tvar wrapperClass = this.options.wrapClass;\n\n\t\t\tif (wrapper && wrapper.nodeType) {\n\t\t\t\t// Wrapper has been provided as a stencil-node for us to clone:\n\t\t\t\tvar clone = doc.createElement('div');\n\t\t\t\tclone.innerHTML = wrapper.outerHTML || new XMLSerializer().serializeToString(wrapper);\n\t\t\t\twrapper = clone.firstChild;\n\t\t\t}\n\n\t\t\tif (typeof replacement == 'function') {\n\t\t\t\treplacement = replacement(portion, match);\n\t\t\t\tif (replacement && replacement.nodeType) {\n\t\t\t\t\treturn replacement;\n\t\t\t\t}\n\t\t\t\treturn doc.createTextNode(String(replacement));\n\t\t\t}\n\n\t\t\tvar el = typeof wrapper == 'string' ? doc.createElement(wrapper) : wrapper;\n\n \t\t\tif (el && wrapperClass) {\n\t\t\t\tel.className = wrapperClass;\n\t\t\t}\n\n\t\t\treplacement = doc.createTextNode(\n\t\t\t\tthis.prepareReplacementString(\n\t\t\t\t\treplacement, portion, match\n\t\t\t\t)\n\t\t\t);\n\n\t\t\tif (!replacement.data) {\n\t\t\t\treturn replacement;\n\t\t\t}\n\n\t\t\tif (!el) {\n\t\t\t\treturn replacement;\n\t\t\t}\n\n\t\t\tel.appendChild(replacement);\n\n\t\t\treturn el;\n\t\t},\n\n\t\treplaceMatch: function(match, startPortion, innerPortions, endPortion) {\n\n\t\t\tvar matchStartNode = startPortion.node;\n\t\t\tvar matchEndNode = endPortion.node;\n\n\t\t\tvar precedingTextNode;\n\t\t\tvar followingTextNode;\n\n\t\t\tif (matchStartNode === matchEndNode) {\n\n\t\t\t\tvar node = matchStartNode;\n\n\t\t\t\tif (startPortion.indexInNode > 0) {\n\t\t\t\t\t// Add `before` text node (before the match)\n\t\t\t\t\tprecedingTextNode = doc.createTextNode(node.data.substring(0, startPortion.indexInNode));\n\t\t\t\t\tnode.parentNode.insertBefore(precedingTextNode, node);\n\t\t\t\t}\n\n\t\t\t\t// Create the replacement node:\n\t\t\t\tvar newNode = this.getPortionReplacementNode(\n\t\t\t\t\tendPortion,\n\t\t\t\t\tmatch\n\t\t\t\t);\n\n\t\t\t\tnode.parentNode.insertBefore(newNode, node);\n\n\t\t\t\tif (endPortion.endIndexInNode < node.length) { // ?????\n\t\t\t\t\t// Add `after` text node (after the match)\n\t\t\t\t\tfollowingTextNode = doc.createTextNode(node.data.substring(endPortion.endIndexInNode));\n\t\t\t\t\tnode.parentNode.insertBefore(followingTextNode, node);\n\t\t\t\t}\n\n\t\t\t\tnode.parentNode.removeChild(node);\n\n\t\t\t\tthis.reverts.push(function() {\n\t\t\t\t\tif (precedingTextNode === newNode.previousSibling) {\n\t\t\t\t\t\tprecedingTextNode.parentNode.removeChild(precedingTextNode);\n\t\t\t\t\t}\n\t\t\t\t\tif (followingTextNode === newNode.nextSibling) {\n\t\t\t\t\t\tfollowingTextNode.parentNode.removeChild(followingTextNode);\n\t\t\t\t\t}\n\t\t\t\t\tnewNode.parentNode.replaceChild(node, newNode);\n\t\t\t\t});\n\n\t\t\t\treturn newNode;\n\n\t\t\t} else {\n\t\t\t\t// Replace matchStartNode -> [innerMatchNodes...] -> matchEndNode (in that order)\n\n\n\t\t\t\tprecedingTextNode = doc.createTextNode(\n\t\t\t\t\tmatchStartNode.data.substring(0, startPortion.indexInNode)\n\t\t\t\t);\n\n\t\t\t\tfollowingTextNode = doc.createTextNode(\n\t\t\t\t\tmatchEndNode.data.substring(endPortion.endIndexInNode)\n\t\t\t\t);\n\n\t\t\t\tvar firstNode = this.getPortionReplacementNode(\n\t\t\t\t\tstartPortion,\n\t\t\t\t\tmatch\n\t\t\t\t);\n\n\t\t\t\tvar innerNodes = [];\n\n\t\t\t\tfor (var i = 0, l = innerPortions.length; i < l; ++i) {\n\t\t\t\t\tvar portion = innerPortions[i];\n\t\t\t\t\tvar innerNode = this.getPortionReplacementNode(\n\t\t\t\t\t\tportion,\n\t\t\t\t\t\tmatch\n\t\t\t\t\t);\n\t\t\t\t\tportion.node.parentNode.replaceChild(innerNode, portion.node);\n\t\t\t\t\tthis.reverts.push((function(portion, innerNode) {\n\t\t\t\t\t\treturn function() {\n\t\t\t\t\t\t\tinnerNode.parentNode.replaceChild(portion.node, innerNode);\n\t\t\t\t\t\t};\n\t\t\t\t\t}(portion, innerNode)));\n\t\t\t\t\tinnerNodes.push(innerNode);\n\t\t\t\t}\n\n\t\t\t\tvar lastNode = this.getPortionReplacementNode(\n\t\t\t\t\tendPortion,\n\t\t\t\t\tmatch\n\t\t\t\t);\n\n\t\t\t\tmatchStartNode.parentNode.insertBefore(precedingTextNode, matchStartNode);\n\t\t\t\tmatchStartNode.parentNode.insertBefore(firstNode, matchStartNode);\n\t\t\t\tmatchStartNode.parentNode.removeChild(matchStartNode);\n\n\t\t\t\tmatchEndNode.parentNode.insertBefore(lastNode, matchEndNode);\n\t\t\t\tmatchEndNode.parentNode.insertBefore(followingTextNode, matchEndNode);\n\t\t\t\tmatchEndNode.parentNode.removeChild(matchEndNode);\n\n\t\t\t\tthis.reverts.push(function() {\n\t\t\t\t\tprecedingTextNode.parentNode.removeChild(precedingTextNode);\n\t\t\t\t\tfirstNode.parentNode.replaceChild(matchStartNode, firstNode);\n\t\t\t\t\tfollowingTextNode.parentNode.removeChild(followingTextNode);\n\t\t\t\t\tlastNode.parentNode.replaceChild(matchEndNode, lastNode);\n\t\t\t\t});\n\n\t\t\t\treturn lastNode;\n\t\t\t}\n\t\t}\n\n\t};\n\n\treturn exposed;\n\n}));\n","/*!\n * Infinite Scroll v2.0.4\n * measure size of elements\n * MIT license\n */\n\n( function( window, factory ) {\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory();\n  } else {\n    // browser global\n    window.getSize = factory();\n  }\n\n} )( window, function factory() {\n\n// -------------------------- helpers -------------------------- //\n\n// get a number from a string, not a percentage\nfunction getStyleSize( value ) {\n  let num = parseFloat( value );\n  // not a percent like '100%', and a number\n  let isValid = value.indexOf('%') == -1 && !isNaN( num );\n  return isValid && num;\n}\n\n// -------------------------- measurements -------------------------- //\n\nlet measurements = [\n  'paddingLeft',\n  'paddingRight',\n  'paddingTop',\n  'paddingBottom',\n  'marginLeft',\n  'marginRight',\n  'marginTop',\n  'marginBottom',\n  'borderLeftWidth',\n  'borderRightWidth',\n  'borderTopWidth',\n  'borderBottomWidth',\n];\n\nlet measurementsLength = measurements.length;\n\nfunction getZeroSize() {\n  let size = {\n    width: 0,\n    height: 0,\n    innerWidth: 0,\n    innerHeight: 0,\n    outerWidth: 0,\n    outerHeight: 0,\n  };\n  measurements.forEach( ( measurement ) => {\n    size[ measurement ] = 0;\n  } );\n  return size;\n}\n\n// -------------------------- getSize -------------------------- //\n\nfunction getSize( elem ) {\n  // use querySeletor if elem is string\n  if ( typeof elem == 'string' ) elem = document.querySelector( elem );\n\n  // do not proceed on non-objects\n  let isElement = elem && typeof elem == 'object' && elem.nodeType;\n  if ( !isElement ) return;\n\n  let style = getComputedStyle( elem );\n\n  // if hidden, everything is 0\n  if ( style.display == 'none' ) return getZeroSize();\n\n  let size = {};\n  size.width = elem.offsetWidth;\n  size.height = elem.offsetHeight;\n\n  let isBorderBox = size.isBorderBox = style.boxSizing == 'border-box';\n\n  // get all measurements\n  measurements.forEach( ( measurement ) => {\n    let value = style[ measurement ];\n    let num = parseFloat( value );\n    // any 'auto', 'medium' value will be 0\n    size[ measurement ] = !isNaN( num ) ? num : 0;\n  } );\n\n  let paddingWidth = size.paddingLeft + size.paddingRight;\n  let paddingHeight = size.paddingTop + size.paddingBottom;\n  let marginWidth = size.marginLeft + size.marginRight;\n  let marginHeight = size.marginTop + size.marginBottom;\n  let borderWidth = size.borderLeftWidth + size.borderRightWidth;\n  let borderHeight = size.borderTopWidth + size.borderBottomWidth;\n\n  // overwrite width and height if we can get it from style\n  let styleWidth = getStyleSize( style.width );\n  if ( styleWidth !== false ) {\n    size.width = styleWidth +\n      // add padding and border unless it's already including it\n      ( isBorderBox ? 0 : paddingWidth + borderWidth );\n  }\n\n  let styleHeight = getStyleSize( style.height );\n  if ( styleHeight !== false ) {\n    size.height = styleHeight +\n      // add padding and border unless it's already including it\n      ( isBorderBox ? 0 : paddingHeight + borderHeight );\n  }\n\n  size.innerWidth = size.width - ( paddingWidth + borderWidth );\n  size.innerHeight = size.height - ( paddingHeight + borderHeight );\n\n  size.outerWidth = size.width + marginWidth;\n  size.outerHeight = size.height + marginHeight;\n\n  return size;\n}\n\nreturn getSize;\n\n} );\n","/*!\n * Unidragger v3.0.1\n * Draggable base class\n * MIT license\n */\n\n( function( window, factory ) {\n  // universal module definition\n  if ( typeof module == 'object' && module.exports ) {\n    // CommonJS\n    module.exports = factory(\n        window,\n        require('ev-emitter'),\n    );\n  } else {\n    // browser global\n    window.Unidragger = factory(\n        window,\n        window.EvEmitter,\n    );\n  }\n\n}( typeof window != 'undefined' ? window : this, function factory( window, EvEmitter ) {\n\nfunction Unidragger() {}\n\n// inherit EvEmitter\nlet proto = Unidragger.prototype = Object.create( EvEmitter.prototype );\n\n// ----- bind start ----- //\n\n// trigger handler methods for events\nproto.handleEvent = function( event ) {\n  let method = 'on' + event.type;\n  if ( this[ method ] ) {\n    this[ method ]( event );\n  }\n};\n\nlet startEvent, activeEvents;\nif ( 'ontouchstart' in window ) {\n  // HACK prefer Touch Events as you can preventDefault on touchstart to\n  // disable scroll in iOS & mobile Chrome metafizzy/flickity#1177\n  startEvent = 'touchstart';\n  activeEvents = [ 'touchmove', 'touchend', 'touchcancel' ];\n} else if ( window.PointerEvent ) {\n  // Pointer Events\n  startEvent = 'pointerdown';\n  activeEvents = [ 'pointermove', 'pointerup', 'pointercancel' ];\n} else {\n  // mouse events\n  startEvent = 'mousedown';\n  activeEvents = [ 'mousemove', 'mouseup' ];\n}\n\n// prototype so it can be overwriteable by Flickity\nproto.touchActionValue = 'none';\n\nproto.bindHandles = function() {\n  this._bindHandles( 'addEventListener', this.touchActionValue );\n};\n\nproto.unbindHandles = function() {\n  this._bindHandles( 'removeEventListener', '' );\n};\n\n/**\n * Add or remove start event\n * @param {String} bindMethod - addEventListener or removeEventListener\n * @param {String} touchAction - value for touch-action CSS property\n */\nproto._bindHandles = function( bindMethod, touchAction ) {\n  this.handles.forEach( ( handle ) => {\n    handle[ bindMethod ]( startEvent, this );\n    handle[ bindMethod ]( 'click', this );\n    // touch-action: none to override browser touch gestures. metafizzy/flickity#540\n    if ( window.PointerEvent ) handle.style.touchAction = touchAction;\n  } );\n};\n\nproto.bindActivePointerEvents = function() {\n  activeEvents.forEach( ( eventName ) => {\n    window.addEventListener( eventName, this );\n  } );\n};\n\nproto.unbindActivePointerEvents = function() {\n  activeEvents.forEach( ( eventName ) => {\n    window.removeEventListener( eventName, this );\n  } );\n};\n\n// ----- event handler helpers ----- //\n\n// trigger method with matching pointer\nproto.withPointer = function( methodName, event ) {\n  if ( event.pointerId === this.pointerIdentifier ) {\n    this[ methodName ]( event, event );\n  }\n};\n\n// trigger method with matching touch\nproto.withTouch = function( methodName, event ) {\n  let touch;\n  for ( let changedTouch of event.changedTouches ) {\n    if ( changedTouch.identifier === this.pointerIdentifier ) {\n      touch = changedTouch;\n    }\n  }\n  if ( touch ) this[ methodName ]( event, touch );\n};\n\n// ----- start event ----- //\n\nproto.onmousedown = function( event ) {\n  this.pointerDown( event, event );\n};\n\nproto.ontouchstart = function( event ) {\n  this.pointerDown( event, event.changedTouches[0] );\n};\n\nproto.onpointerdown = function( event ) {\n  this.pointerDown( event, event );\n};\n\n// nodes that have text fields\nconst cursorNodes = [ 'TEXTAREA', 'INPUT', 'SELECT', 'OPTION' ];\n// input types that do not have text fields\nconst clickTypes = [ 'radio', 'checkbox', 'button', 'submit', 'image', 'file' ];\n\n/**\n * any time you set `event, pointer` it refers to:\n * @param {Event} event\n * @param {Event | Touch} pointer\n */\nproto.pointerDown = function( event, pointer ) {\n  // dismiss multi-touch taps, right clicks, and clicks on text fields\n  let isCursorNode = cursorNodes.includes( event.target.nodeName );\n  let isClickType = clickTypes.includes( event.target.type );\n  let isOkayElement = !isCursorNode || isClickType;\n  let isOkay = !this.isPointerDown && !event.button && isOkayElement;\n  if ( !isOkay ) return;\n\n  this.isPointerDown = true;\n  // save pointer identifier to match up touch events\n  this.pointerIdentifier = pointer.pointerId !== undefined ?\n    // pointerId for pointer events, touch.indentifier for touch events\n    pointer.pointerId : pointer.identifier;\n  // track position for move\n  this.pointerDownPointer = {\n    pageX: pointer.pageX,\n    pageY: pointer.pageY,\n  };\n\n  this.bindActivePointerEvents();\n  this.emitEvent( 'pointerDown', [ event, pointer ] );\n};\n\n// ----- move ----- //\n\nproto.onmousemove = function( event ) {\n  this.pointerMove( event, event );\n};\n\nproto.onpointermove = function( event ) {\n  this.withPointer( 'pointerMove', event );\n};\n\nproto.ontouchmove = function( event ) {\n  this.withTouch( 'pointerMove', event );\n};\n\nproto.pointerMove = function( event, pointer ) {\n  let moveVector = {\n    x: pointer.pageX - this.pointerDownPointer.pageX,\n    y: pointer.pageY - this.pointerDownPointer.pageY,\n  };\n  this.emitEvent( 'pointerMove', [ event, pointer, moveVector ] );\n  // start drag if pointer has moved far enough to start drag\n  let isDragStarting = !this.isDragging && this.hasDragStarted( moveVector );\n  if ( isDragStarting ) this.dragStart( event, pointer );\n  if ( this.isDragging ) this.dragMove( event, pointer, moveVector );\n};\n\n// condition if pointer has moved far enough to start drag\nproto.hasDragStarted = function( moveVector ) {\n  return Math.abs( moveVector.x ) > 3 || Math.abs( moveVector.y ) > 3;\n};\n\n// ----- drag ----- //\n\nproto.dragStart = function( event, pointer ) {\n  this.isDragging = true;\n  this.isPreventingClicks = true; // set flag to prevent clicks\n  this.emitEvent( 'dragStart', [ event, pointer ] );\n};\n\nproto.dragMove = function( event, pointer, moveVector ) {\n  this.emitEvent( 'dragMove', [ event, pointer, moveVector ] );\n};\n\n// ----- end ----- //\n\nproto.onmouseup = function( event ) {\n  this.pointerUp( event, event );\n};\n\nproto.onpointerup = function( event ) {\n  this.withPointer( 'pointerUp', event );\n};\n\nproto.ontouchend = function( event ) {\n  this.withTouch( 'pointerUp', event );\n};\n\nproto.pointerUp = function( event, pointer ) {\n  this.pointerDone();\n  this.emitEvent( 'pointerUp', [ event, pointer ] );\n\n  if ( this.isDragging ) {\n    this.dragEnd( event, pointer );\n  } else {\n    // pointer didn't move enough for drag to start\n    this.staticClick( event, pointer );\n  }\n};\n\nproto.dragEnd = function( event, pointer ) {\n  this.isDragging = false; // reset flag\n  // re-enable clicking async\n  setTimeout( () => delete this.isPreventingClicks );\n\n  this.emitEvent( 'dragEnd', [ event, pointer ] );\n};\n\n// triggered on pointer up & pointer cancel\nproto.pointerDone = function() {\n  this.isPointerDown = false;\n  delete this.pointerIdentifier;\n  this.unbindActivePointerEvents();\n  this.emitEvent('pointerDone');\n};\n\n// ----- cancel ----- //\n\nproto.onpointercancel = function( event ) {\n  this.withPointer( 'pointerCancel', event );\n};\n\nproto.ontouchcancel = function( event ) {\n  this.withTouch( 'pointerCancel', event );\n};\n\nproto.pointerCancel = function( event, pointer ) {\n  this.pointerDone();\n  this.emitEvent( 'pointerCancel', [ event, pointer ] );\n};\n\n// ----- click ----- //\n\n// handle all clicks and prevent clicks when dragging\nproto.onclick = function( event ) {\n  if ( this.isPreventingClicks ) event.preventDefault();\n};\n\n// triggered after pointer down & up with no/tiny movement\nproto.staticClick = function( event, pointer ) {\n  // ignore emulated mouse up clicks\n  let isMouseup = event.type === 'mouseup';\n  if ( isMouseup && this.isIgnoringMouseUp ) return;\n\n  this.emitEvent( 'staticClick', [ event, pointer ] );\n\n  // set flag for emulated clicks 300ms after touchend\n  if ( isMouseup ) {\n    this.isIgnoringMouseUp = true;\n    // reset flag after 400ms\n    setTimeout( () => {\n      delete this.isIgnoringMouseUp;\n    }, 400 );\n  }\n};\n\n// -----  ----- //\n\nreturn Unidragger;\n\n} ) );\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import Draggabilly from 'draggabilly';\n\nexport class PopupManager {\n    constructor({ mode, interfaceLang, contentLang, popupStyles, debug, reportCitation }) {\n        this.mode = mode;\n        this.interfaceLang = interfaceLang;\n        this.contentLang = contentLang;\n        this.popupStyles = popupStyles;\n        this.debug = debug;\n        this.reportCitation = reportCitation;\n        // no need to declare these but declaring so API is clear\n        this.popUpElem = null;\n        this.heTitle = null;\n        this.enTitle = null;\n        this.heElems = null;\n        this.enElems = null;\n        this.triggerLink = null;\n        this.hidePopup = this.hidePopup.bind(this);\n    }\n\n    setupPopup() {\n        this.category_colors = {\n          \"Commentary\":         \"#4871bf\",\n          \"Tanakh\":             \"#004e5f\",\n          \"Midrash\":            \"#5d956f\",\n          \"Mishnah\":            \"#5a99b7\",\n          \"Talmud\":             \"#ccb479\",\n          \"Halakhah\":           \"#802f3e\",\n          \"Kabbalah\":           \"#594176\",\n          \"Philosophy\":         \"#7f85a9\",   // to delete\n          \"Jewish Thought\":     \"#7f85a9\",\n          \"Liturgy\":            \"#ab4e66\",\n          \"Tanaitic\":           \"#00827f\",   // to delete\n          \"Tosefta\":            \"#00827f\",\n          \"Parshanut\":          \"#9ab8cb\",\n          \"Chasidut\":           \"#97b386\",\n          \"Musar\":              \"#7c406f\",\n          \"Responsa\":           \"#cb6158\",\n          \"Apocrypha\":          \"#c7a7b4\",   // to delete\n          \"Second Temple\":      \"#c7a7b4\",\n          \"Other\":              \"#073570\",   // to delete\n          \"Quoting Commentary\": \"#cb6158\",\n          \"Sheets\":             \"#7c406f\",\n          \"Community\":          \"#7c406f\",\n          \"Targum\":             \"#7f85a9\",\n          \"Modern Works\":       \"#7c406f\",   // to delete\n          \"Modern Commentary\":  \"#7c406f\",\n        };\n        this.popUpElem = document.createElement(\"div\");\n        this.popUpElem.id = \"sefaria-popup\";\n        this.popUpElem.classList.add(\"interface-\" + this.interfaceLang);\n        this.popUpElem.classList.add(\"content-\" + this.contentLang);\n\n        let html = \"\";\n        // Set default content for the popup\n        html += '<style scoped>' +\n            '@import url(\"https://fonts.googleapis.com/css?family=Crimson+Text:ital,wght@0,400;0,700;1,400;1,700|Frank+Ruhl+Libre|Heebo\");' +\n            '#sefaria-popup {'+\n                'width: 400px;'+\n                'max-width: 90%;'+\n                'max-height: 560px;' +\n                'font-size: 16px;' +\n                'border-left: 1px #ddd solid;'+\n                'border-right: 1px #ddd solid;'+\n                'border-bottom: 1px #ddd solid;'+\n                'background-color: #fff;'+\n                'color: #222222;'+\n            '}'+\n            '.sefaria-text .en, .sefaria-text .he {' +\n                'padding: 10px 20px;'+\n                'text-align: justify;'+\n                'font-weight: normal' +\n            '}' +\n            '.sefaria-text {' +\n                'max-height: 430px;'+\n                'overflow-y: auto;' +\n                'overflow-x: hidden;' +\n            '}' +\n            '.sefaria-text:focus {' +\n                'outline: none;'+\n            '}' +\n            '#sefaria-title {' +\n                'font-size: 18px;'+\n                'text-align: center;' +\n                'text-decoration: none;' +\n                'margin: 12px 0;' +\n                'padding: 0;' +\n            '}' +\n            '#sefaria-title .en {' +\n                'text-align: center;' +\n            '}' +\n            '#sefaria-title .he {' +\n                'text-align: center;' +\n            '}' +\n            '#sefaria-popup .en, #sefaria-popup .en * {' +\n                'font-family: \"Crimson Text\";' +\n                'font-size: 18px;' +\n                'line-height: 1.2;' +\n                'direction: ltr;' +\n            '}' +\n            '#sefaria-popup .he, #sefaria-popup .he * {' +\n                'font-family: \"Frank Ruhl Libre\";' +\n                'font-size: 21px;' +\n                'line-height: 1.5;' +\n                'direction: rtl;' +\n            '}' +\n            '.content-hebrew .sefaria-text .en {' +\n                'display: none;' +\n            '}' +\n            '.content-english .sefaria-text .he {' +\n                'display: none' +\n            '}' +\n            '.content-hebrew .sefaria-text .en.enOnly {' +\n                'display: block;' +\n            '}' +\n            '.content-english .sefaria-text .he.heOnly {' +\n                'display: block' +\n            '}' +\n            '.truncatedMessage {' +\n                'direction: ltr;' +\n                'margin-top: 10px;' +\n                'padding: 20px;' +\n                'color: #666;' +\n                'font-size: 14px;' +\n                'font-family: \"Helvetica Neue\", \"Helvetica\", sans-serif;' +\n            '}' +\n            '.interface-hebrew .truncatedMessage {' +\n                'direction: rtl;' +\n                'font-family: \"Heebo\", sans-serif;' +\n            '}' +\n            '#sefaria-logo {' +\n                \"background: url(\\\"data:image/svg+xml,%3Csvg id='Layer_1' data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 340.96 93.15'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:none;%7D.cls-2%7Bclip-path:url(%23clip-path);%7D.cls-3%7Bfill:%23231f20;%7D%3C/style%3E%3CclipPath id='clip-path' transform='translate(-389 -337.85)'%3E%3Crect class='cls-1' x='389' y='337.85' width='340.96' height='93.15'/%3E%3C/clipPath%3E%3C/defs%3E%3Ctitle%3Esefarialogo%3C/title%3E%3Cg class='cls-2'%3E%3Cpath class='cls-3' d='M454,397.67c-2.41,11.31-10.59,16.11-28.82,16.11-44.79,0-28.92-36-22.66-43.42,2.63-3.29,4.47-6,11.15-6h12.71c17.72,0,21.1.84,25.54,9.9,2.4,4.88,3.79,15.41,2.08,23.43m4.81-22.48c-1.5-9.67-3.45-20.19-11.85-26-5.09-3.54-10.34-3.8-16.21-3.8-4,0-18.11-.17-24.29-.17-6,0-10-4.94-10-7.34-3.91,4.79-6.9,10.08-5.85,16.48.94,5.76,4.89,9.44,10.67,10.17-6.55,9.25-12.47,19.9-12.18,31.18.18,7.11,1.81,35.32,33.71,35.32h5.81c13.62,0,21.87-10.11,24.27-14,7.05-11.5,8.23-29.29,6-41.78' transform='translate(-389 -337.85)'/%3E%3Cpath class='cls-3' d='M722.79,402.89a12.32,12.32,0,0,1-9.74,5.06,11.59,11.59,0,0,1-11.78-11.7c0-6.19,4.53-11.7,11.4-11.7a12.78,12.78,0,0,1,10.12,5.06ZM723,414H730V378.51H723v3.24a16.65,16.65,0,0,0-11.1-4,16.87,16.87,0,0,0-8.69,2.27,19,19,0,0,0-.07,32.39,18.26,18.26,0,0,0,8.91,2.34,16.31,16.31,0,0,0,10.95-4ZM676,365.9a4.61,4.61,0,0,0,4.68,4.68,4.68,4.68,0,0,0,4.76-4.68,4.75,4.75,0,0,0-4.76-4.76A4.68,4.68,0,0,0,676,365.9M677.11,414h7.17V378.51h-7.17Zm-8.68-36a18.29,18.29,0,0,0-2.79-.23c-5.21,0-8.91,2.42-10.65,4.83v-4.07h-7V414h7.18V390.51c2-3.4,5.89-6,9.59-6a10.06,10.06,0,0,1,2.79.3ZM628,402.89A12.32,12.32,0,0,1,618.3,408a11.59,11.59,0,0,1-11.78-11.7c0-6.19,4.53-11.7,11.4-11.7A12.8,12.8,0,0,1,628,389.61Zm.22,11.1h7V378.51h-7v3.24a16.62,16.62,0,0,0-11.1-4,16.83,16.83,0,0,0-8.68,2.27,19,19,0,0,0-.07,32.39,18.2,18.2,0,0,0,8.91,2.34,16.3,16.3,0,0,0,10.94-4Zm-33.07-53.83a16.61,16.61,0,0,0-4.23-.53,13.88,13.88,0,0,0-11.62,5.89c-1.59,2.27-2.27,5.21-2.27,10v3h-8.3v6.41h8.3V414h7.18V384.92h10.94v-6.41H584.25v-3.25c0-3.25.37-5.06,1.35-6.34a7,7,0,0,1,5.44-2.49,11.64,11.64,0,0,1,2.64.3ZM546.65,384a9.92,9.92,0,0,1,9.36,7.7H536.68a10.31,10.31,0,0,1,10-7.7m16.76,13.74a14,14,0,0,0,.07-1.51c0-10.5-7.17-18.5-17.06-18.5s-17.29,7.85-17.29,18.5a18,18,0,0,0,18.35,18.5c7.24,0,12.3-3.25,14.95-6.65l-4.69-4.45a12.78,12.78,0,0,1-10.19,4.83,11.43,11.43,0,0,1-11.47-10.72Zm-75.58,8.15a23.68,23.68,0,0,0,18.5,8.84c9.21,0,16.38-6,16.38-15.33,0-6-3.32-9.74-6.87-12.08-6.79-4.53-18-6-18-12.68,0-4.61,4.38-7.1,8.75-7.1a14.55,14.55,0,0,1,9.44,3.62l4.46-5.51a21.76,21.76,0,0,0-14.2-5.28c-9.21,0-16,6.34-16,14,0,5.51,2.94,9.14,6.72,11.63,7,4.6,18.19,5.51,18.19,13.59,0,4.75-4.3,7.92-9.21,7.92-5.44,0-9.81-3-12.91-6.79Z' transform='translate(-389 -337.85)'/%3E%3C/g%3E%3C/svg%3E\\\") no-repeat;\" +\n                'width: 70px;' +\n                'display: inline-block;'+\n                'margin-left: 3px;' +\n                'height: 18px;' +\n                'line-height: 18px;' +\n                'opacity: 0.6' +\n            '}' +\n            '.sefaria-footer {' +\n                'color: #999;' +\n                'padding:20px 20px 20px 20px;' +\n                'border-top: 1px solid #ddd;' +\n                'background-color: #FBFBFA;' +\n                'font-size: 12px;' +\n                'display: flex;' +\n                'justify-content: space-between;' +\n                'align-items: center;' +\n                'font-family: \"Helvetica Neue\", \"Helvetica\", sans-serif;' +\n            '}'+\n            '.sefaria-read-more-button {' +\n                'background-color: #fff;' +\n                'padding: 5px 10px;'+\n                'margin-top: -3px;' +\n                'border: 1px solid #ddd;' +\n                'border-radius: 5px;' +\n            '}' +\n            '.interface-hebrew .sefaria-powered-by-box {' +\n                'margin-top: -6px' +\n            '}'+\n            '.sefaria-read-more-button a {' +\n                'text-decoration: none;' +\n                'color: #666;' +\n            '}'+\n            '#sefaria-linker-header {' +\n                'border-top: 4px solid #ddd;' +\n                'border-bottom: 1px solid #ddd;' +\n                'background-color: #FBFBFA;' +\n                'text-align: center;' +\n                'padding-bottom: 3px;' +\n            '}'+\n            '.interface-hebrew .sefaria-footer {' +\n                'direction: rtl;' +\n                'font-family: \"Heebo\", sans-serif' +\n            '}'+\n            '#sefaria-popup.short-screen .sefaria-text{'+\n                'overflow-y: scroll;' +\n                'max-height: calc(100% - 117px);' +\n            '}'+\n            'span.sefaria-ref-wrapper{'+\n                'display: inline !important;' +\n            '}'+\n            'a.sefaria-ref-debug{'+\n                'border: 3px solid green;' +\n            '}'+\n            'a.sefaria-ref-debug.sefaria-link-failed{'+\n                'border: 3px solid red' +\n            '}'+\n            'a.sefaria-ref-debug.sefaria-link-ambiguous{'+\n                'border: 3px solid orange;' +\n            '}';\n\n        if (this.mode === \"popup-click\") {\n            html += '#sefaria-close {' +\n                '    font-family: \"Crimson Text\";' +\n                '    font-size: 36px;' +\n                '    height: 48px;' +\n                '    line-height: 48px;' +\n                '    position: absolute;' +\n                '    top: 0px;' +\n                '    left: 20px;' +\n                '    cursor: pointer;' +\n                '    color: #999;' +\n                '    border: 0;' +\n                '    outline: none;' +\n                '}' +\n            '</style>' +\n            '<div id=\"sefaria-close\">×</div>';\n        } else {\n            html += '</style>'\n        }\n        let readMoreText = {\n            \"english\": \"Read More ›\",\n            \"hebrew\": \"קרא עוד ›\"\n        }[this.interfaceLang];\n        let poweredByText = {\n            \"english\": \"Powered by\",\n            \"hebrew\": '<center>מונע ע\"י<br></center>'\n        }[this.interfaceLang];\n\n        html += '<div id=\"sefaria-linker-header\">' +\n                '<div id=\"sefaria-title\"><span class=\"he\" dir=\"rtl\"></span><span class=\"en\"></span></div>' +\n            '</div>' +\n            '<div class=\"sefaria-text\" id=\"sefaria-linker-text\" tabindex=\"0\"></div>' +\n\n            '<div class=\"sefaria-footer\">' +\n                '<div class=\"sefaria-powered-by-box\">' + poweredByText + ' <div id=\"sefaria-logo\">&nbsp;</div></div>' +\n                (this.mode == \"popup-click\" ?\n                '<span class=\"sefaria-read-more-button\">' +\n                    '<a class = \"sefaria-popup-ref\" target=\"_blank\" href = \"\">' + readMoreText + '</a>' +\n                '</span>' : \"\") +\n                (this.debug ?\n                    '<span class=\"sefaria-read-more-button\" id=\"sefaria-report-btn\"><a>Report</a></span>'\n                    : ''\n                ) +\n            '</div>';\n\n        this.popUpElem.innerHTML = html;\n\n        // Apply any override styles\n        for (let n in this.popupStyles) {\n            if (this.popupStyles.hasOwnProperty(n)) {\n                this.popUpElem.style[n] = this.popupStyles[n];\n            }\n        }\n\n        // Apply function-critical styles\n        this.popUpElem.style.position = \"fixed\";\n        this.popUpElem.style.overflow = \"hidden\";\n        this.popUpElem.style.display = \"none\";\n        this.popUpElem.style.zIndex = 999999;\n\n        // Accessibility Whatnot\n        this.popUpElem.setAttribute('role', 'dialog');\n        this.popUpElem.tabIndex = \"0\";\n        this.popUpElem.style.outline = \"none\";\n\n        this.popUpElem = document.body.appendChild(this.popUpElem);\n\n        let draggie = new Draggabilly(this.popUpElem, {handle: \"#sefaria-linker-header\"});\n\n        this.linkerHeader = this.popUpElem.querySelector(\"#sefaria-linker-header\");\n        this.linkerFooter = this.popUpElem.querySelector(\".sefaria-footer\");\n        this.textBox = this.popUpElem.querySelector(\".sefaria-text\");\n        this.heTitle = this.popUpElem.querySelector(\"#sefaria-title .he\");\n        this.enTitle = this.popUpElem.querySelector(\"#sefaria-title .en\");\n        this.heElems = this.popUpElem.querySelectorAll(\".he\");\n        this.enElems = this.popUpElem.querySelectorAll(\".en\");\n\n        if (this.mode === \"popup-click\") {\n            this.popUpElem.querySelector('#sefaria-close').addEventListener('click', this.hidePopup, false);\n            this.popUpElem.addEventListener('keydown', (e) => {\n                let key = e.which || e.keyCode;\n                if (key === 27) { // 27 is escape\n                  this.hidePopup();\n                }\n                else if (key === 9) { // 9 is tab\n                  e.preventDefault(); // this traps user in the dialog via tab\n                }\n            });\n        }\n    };\n\n    showPopup(elem, {ref, heRef, en=[], he=[], primaryCategory, isTruncated=false}) {\n        while (this.textBox.firstChild) {\n            this.textBox.removeChild(this.textBox.firstChild);\n        }\n        this.triggerLink = elem;\n        this.linkerHeader.style[\"border-top-color\"] = this.category_colors[primaryCategory];\n\n        // TODO is this right?\n        if (this.contentLang !== \"he\") {\n            // [].forEach.call(heElems, function(e) {e.style.display = \"None\"});\n            this.heTitle.style.display = \"None\";\n            [].forEach.call(this.enElems, function(e) {e.style.display = \"Block\"});\n        } else {\n            [].forEach.call(this.heElems, function(e) {e.style.display = \"Block\"});\n            [].forEach.call(this.enElems, function(e) {e.style.display = \"None\"});\n        }\n\n        if (typeof(en) === \"string\") {\n            en = [en]\n            he = [he]\n        }\n        if (typeof(en) === \"object\") {\n            en = [].concat.apply([], en);\n            he = [].concat.apply([], he);\n        }\n\n        for (let i = 0; i < Math.max(en.length, he.length); i++) {\n            let enBox = document.createElement('div');\n            let heBox = document.createElement('div');\n            enBox.innerHTML = en[i] || \"\";\n            heBox.innerHTML = (he[i] || \"\").replace(/[\\u0591-\\u05af\\u05bd\\u05bf\\u05c0\\u05c4\\u05c5]/g, \"\");\n            enBox.className = \"en\" + (!heBox.innerHTML ? \" enOnly\" : \"\");\n            heBox.className = \"he\" + (!enBox.innerHTML ? \" heOnly\" : \"\");\n            heBox.setAttribute(\"dir\", \"rtl\");\n            if (heBox.innerHTML) { this.textBox.appendChild(heBox); }\n            if (enBox.innerHTML) { this.textBox.appendChild(enBox);}\n        }\n\n        if (isTruncated) {\n            const truncated = document.createElement('div');\n            truncated.innerHTML = this.interfaceLang === \"english\" ? \"Read the complete text on Sefaria\" : \"לקריאת הטקסט המלא בספריא\";\n            truncated.className = \"truncatedMessage\";\n            this.textBox.appendChild(truncated);\n        }\n\n        this.enTitle.textContent = ref;\n        this.heTitle.textContent = heRef;\n\n        let rect = elem.getBoundingClientRect();\n        this.popUpElem.style.top = (rect.top > 100)?rect.top - 50 + \"px\":rect.top + 30 + \"px\";\n        if (rect.left < window.innerWidth / 2) {\n            this.popUpElem.style.left = rect.right + 10 + \"px\";\n            this.popUpElem.style.right = \"auto\";\n        } else {\n            this.popUpElem.style.left = \"auto\";\n            this.popUpElem.style.right = window.innerWidth - rect.left + \"px\";\n        }\n\n        this.popUpElem.style.display = \"block\";\n\n        let popUpRect = this.popUpElem.getBoundingClientRect();\n        if (popUpRect.height > window.innerHeight) {\n            // if the popup is too long for window height, shrink it\n            this.popUpElem.classList.add(\"short-screen\");\n            this.popUpElem.style.height = (window.innerHeight * 0.9) + \"px\";\n        }\n        if (window.innerHeight < popUpRect.bottom) {\n            // if popup drops off bottom screen, pull up\n            let pos = ((window.innerHeight - popUpRect.height) - 10);\n            this.popUpElem.style.top = (pos > 0) ? pos + \"px\" : \"10px\";\n        }\n        if (window.innerWidth < popUpRect.right || popUpRect.left < 0) {\n            // popup drops off the side screen, center it\n            let pos = ((window.innerWidth - popUpRect.width) / 2);\n            this.popUpElem.style.left = pos + \"px\";\n            this.popUpElem.style.right = \"auto\";\n        }\n\n\n        if (this.mode === \"popup-click\") {\n            [].forEach.call(this.popUpElem.querySelectorAll(\".sefaria-popup-ref\"), function(link) {link.setAttribute('href', elem.href);});\n            document.addEventListener(\"click\", function (e) {\n              let level = 0;\n              for (let element = e.target; element; element = element.parentNode) {\n                if (element.id === this.popUpElem.id) {\n                  return;\n                }\n                level++;\n              }\n              this.hidePopup();\n            }.bind(this));\n        }\n\n        if (this.debug) {\n            const reportBtn = document.querySelector('#sefaria-report-btn');\n\n            // remove old event listener\n            reportBtn.removeEventListener('click', this.currReportCitation, false);\n\n            this.currReportCitation = this.reportCitation.bind(null, elem);\n            reportBtn.addEventListener('click', this.currReportCitation, false);\n        }\n\n        let scrollbarOffset = this.popUpElem.clientWidth - this.textBox.clientWidth;\n        if (scrollbarOffset > 0) {\n            let nodes = this.textBox.childNodes;\n            for(let i=0; i<nodes.length; i++) {\n                nodes[i].style.marginRight = -scrollbarOffset+\"px\";\n            }\n        }\n\n    }\n\n    hidePopup() {\n        if (this.popUpElem.style.display === \"block\") {\n            this.triggerLink.focus();\n        }\n        this.popUpElem.style.display = \"none\";\n        this.popUpElem.classList.remove(\"short-screen\");\n        this.popUpElem.style.height = \"auto\";\n    }\n\n    bindEventHandler(elem, baseUrl, source) {\n        const utmSource = window.location.hostname ? window.location.hostname.replace(/^www\\./, \"\") : \"(not%20set)\";\n        const urlLang = this.contentLang.substring(0, 2);\n        const url = `${baseUrl}/${source.url}?lang=${urlLang}&utm_source=${utmSource}&utm_medium=sefaria_linker`;\n        elem.setAttribute('href', url);\n        if (this.mode === \"popup-hover\") {\n            elem.addEventListener('mouseover', (event) => { this.showPopup(elem, source); }, false);\n            elem.addEventListener('mouseout', this.hidePopup, false);\n        } else if (this.mode === \"popup-click\") {\n            elem.addEventListener('click', (event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                this.showPopup(elem, source);\n                document.getElementById(\"sefaria-linker-text\").focus();\n            }, false);\n        }\n    }\n}","/**\n * Class which decides whether a citation should be excluded from either linking or tracking (or both)\n */\n\nexport class LinkExcluder {\n\n    constructor(excludeFromLinkingSelector, excludeFromTrackingSelector) {\n        this.excludeFromLinkingSelector = excludeFromLinkingSelector;\n        this.excludeFromTrackingSelector = excludeFromTrackingSelector;\n        this.excludedFromLinking = {};\n        this.excludedFromTracking = {};\n    }\n\n    shouldExclude(matchKey, node) {\n        // Walk up node tree to see if this context should be excluded from linking or tracking\n        let p = node;\n        // it is possible this node doesn't fit criteria to be excluded, but an earlier portion did.\n        let excludeFromLinking = this.excludedFromLinking[matchKey];\n        let excludeFromTracking = this.excludedFromTracking[matchKey];\n        while (p) {\n            if (p.nodeName === 'A' || (this.excludeFromLinkingSelector && p.matches && p.matches(this.excludeFromLinkingSelector))) {\n                excludeFromLinking = true;\n                this.excludedFromLinking[matchKey] = true;\n            }\n            if (this.excludeFromTrackingSelector && p.matches && p.matches(this.excludeFromTrackingSelector)) {\n                excludeFromTracking = true;\n                this.excludedFromTracking[matchKey] = true;\n            }\n            if (excludeFromTracking && excludeFromLinking) { break; }\n            p = p.parentNode;\n        }\n        return [excludeFromLinking, excludeFromTracking];\n    }\n}","import { Readability } from '@mozilla/readability';\nimport DOMPurify from 'dompurify';\nimport findAndReplaceDOMText from 'findandreplacedomtext';\nimport { PopupManager } from \"./popup\";\nimport {LinkExcluder} from \"./excluder\";\n\n\n(function(ns) {\n    function sanitizeElem(elem) {\n        const cleaned = DOMPurify.sanitize(elem, { USE_PROFILES: { html: true } });\n        const cleanedElem = document.createElement(\"div\");\n        cleanedElem.innerHTML = cleaned;\n        return cleanedElem.textContent;\n    }\n\n    function getWhitelistText(currText) {\n        if (!ns.whitelistSelectors || ns.whitelistSelectors.length === 0) { return \"\"; }\n        const whitelistElems = document.querySelectorAll(ns.whitelistSelectors.join(\", \"));\n        return [].reduce.call(whitelistElems, (prev, curr) => {\n            const currCleaned = sanitizeElem(removeUnwantedElems(curr));\n            if (currText.indexOf(currCleaned) > -1) { return prev; }  // assumption is this text was already included by Readability so no need to include again\n            return prev + currCleaned;\n        }, \"\");\n    }\n\n    function getTextAroundElemInDir(elem, nchars, isPrev) {\n        let context = \"\";\n        if (!elem || nchars <= 0) { return context; }\n        let sibling = elem;\n        while (context.length < nchars) {\n            sibling = isPrev ? sibling.previousSibling : sibling.nextSibling;\n            const tempContext = (sibling === null) ?\n                getTextAroundElemInDir(elem.parentNode, nchars - context.length, isPrev) :\n                sibling.textContent;\n            context = isPrev ? (tempContext + context) : context + tempContext;\n        }\n\n        return isPrev ? context.slice(-nchars) : context.slice(0, nchars);\n    }\n\n    function getTextAroundElem(elem, nchars) {\n        const prev = getTextAroundElemInDir(elem, nchars, true);\n        const next = getTextAroundElemInDir(elem, nchars, false);\n        return [prev, next];\n    }\n\n    function removeUnwantedElems(elem) {\n        const unwantedTags = ['table', 'sup'];\n        for (let tag of unwantedTags) {\n            for (let unwantedElem of elem.getElementsByTagName(tag)) {\n                unwantedElem.remove();\n            }\n        }\n        return elem;\n    }\n\n    function unwrap(el) {\n        /**\n         * from https://plainjs.com/javascript/manipulation/unwrap-a-dom-element-35/\n         * removes el and bumps up children to parent\n         * */\n        const parent = el.parentNode;\n        // move all children out of the element\n        while (el.firstChild) {\n            parent.insertBefore(el.firstChild, el);\n        }\n        // remove the empty element\n        parent.removeChild(el);\n        // merge consecutive text nodes\n        parent.normalize();\n    }\n\n    function removeExistingSefariaLinks() {\n        for (let el of document.querySelectorAll('a.sefaria-ref, span.sefaria-ref-wrapper')) {\n            unwrap(el);\n        }\n    }\n\n    function readabilitySerializer(elem) {\n        let text = \"\";\n        const isNonCts = !!findAndReplaceDOMText.NON_CONTIGUOUS_PROSE_ELEMENTS[elem.nodeName.toLowerCase()];\n        if (isNonCts) { text += \"\\n\"; }\n        if (elem.childNodes.length === 0) {\n            text = elem.innerHTML || elem.textContent;\n        }\n        for (let child of elem.childNodes) {\n            text += readabilitySerializer(child);\n        }\n        return text;\n    }\n\n    function getReadableText() {\n        const documentClone = removeUnwantedElems(document.cloneNode(true));\n        const readableObj = new Readability(documentClone, {\n            serializer: readabilitySerializer,\n        }).parse();\n        return {text: sanitizeElem(readableObj.content), readableObj};\n    }\n\n    function findOccurrences(text) {\n        const occurrences = [];\n        findAndReplaceDOMText(document, {\n            preset: 'prose',\n            find: text,\n            replace: function(portion, match) {\n                if (portion.index === 0) {\n                    occurrences.push([match.startIndex, match.endIndex]);\n                }\n                return portion.text;\n            }\n        });\n        return occurrences;\n    }\n\n    function getNextWhiteSpaceIndex(text) {\n        const match = text.match(/\\S\\s+/);  // `\\S` so whitespace can't be at beginning of string\n        if (match === null || text.substring(0, match.index+1).indexOf('\\n') > -1) { return -1; }  // \\n's are added in by Readability and therefore make it challenging to match against. stop when you hit one.\n        return match.index + 1;\n    }\n\n    function getNthWhiteSpaceIndex(text, n, startIndex) {\n        for (let i = 0; i < n; i++) {\n            const nextIncrement = getNextWhiteSpaceIndex(text.substring(startIndex));\n            if (nextIncrement === -1) { break; }\n            startIndex += nextIncrement;\n        }\n        return startIndex;\n    }\n\n    function getNumWordsAround(linkObj, text, numWordsAround) {\n        /**\n         * gets text with `numWordsAround` number of words surrounding text in linkObj. Words are broken by any white space.\n         * returns: {\n         *     text: str with numWordsAround\n         *     startChar: int, start index of linkObj text within numWordsAround text\n         * }\n         */\n        let { startChar, endChar } = linkObj;\n        if (numWordsAround === 0) {\n            return { text: linkObj.text, startChar: 0 };\n        }\n        const newEndChar = getNthWhiteSpaceIndex(text, numWordsAround, endChar);\n        const textRev = [...text].reverse().join(\"\");\n        const newStartChar = text.length - getNthWhiteSpaceIndex(textRev, numWordsAround, text.length - startChar);\n        const wordsAroundText = text.substring(newStartChar, newEndChar);\n        return {\n            text: wordsAroundText,\n            startChar: startChar - newStartChar,\n        };\n    }\n\n    function createATag(linkFailed, ref, text, url, isAmbiguous, iLinkObj, resultsKey) {\n        const atag = document.createElement(\"a\");\n        atag.target = \"_blank\";\n        atag.textContent = text;\n        atag.className = \"sefaria-ref\";\n        if (ns.debug) {\n            atag.className += \" sefaria-ref-debug\";\n            if (linkFailed) { atag.className += \" sefaria-link-failed\"; }\n            if (isAmbiguous) { atag.className += \" sefaria-link-ambiguous\"; }\n        }\n\n        atag.setAttribute('data-result-index', iLinkObj);\n        atag.setAttribute('data-result-key', resultsKey);\n\n        if (linkFailed) { return atag; }  // debug and linkFailed\n\n        atag.href = `${ns.sefariaUrl}/${url}`;\n        atag.setAttribute('data-ref', ref);\n        atag.setAttribute('aria-controls', 'sefaria-popup');\n        return atag;\n    }\n\n    function createATagWithDebugInfo(urls, linkObj, text, iLinkObj, resultsKey) {\n        /**\n         * if urls is null or len 1, return a tag\n         * else, return a span with n a tags to represent an ambiguous reference.\n         * urls should only be more than len 1 in debug mode\n         */\n        if (!urls || (!ns.debug && urls.length > 1)) {\n            return createATag(linkObj.linkFailed, null, text, null, false, iLinkObj, resultsKey);\n        } else if (urls.length === 1) {\n            return createATag(linkObj.linkFailed, linkObj.refs[0], text, urls[0], false, iLinkObj, resultsKey);\n        } else {\n            // debug and more than 1 url\n            const node = document.createElement(\"span\");\n            node.className=\"sefaria-ref-wrapper\";\n            for (let i = 0; i < urls.length; i++) {\n                const tempText = i === 0 ? text : `[${i}]`;\n                const atag = createATag(linkObj.linkFailed, linkObj.refs[i], tempText, urls[i], true, iLinkObj, resultsKey);\n                node.appendChild(atag);\n            }\n            return node;\n        }\n    }\n\n    function wrapRef(linkObj, normalizedText, refData, iLinkObj, resultsKey, maxNumWordsAround = 10, maxSearchLength = 30) {\n        /**\n         * wraps linkObj.text with an atag. In the case linkObj.text appears multiple times on the page,\n         * increases search scope to ensure we wrap the correct instance of linkObj.text\n         * linkObj: object representing a link, as returned by find-refs API\n         * normalizedText: normalized text of webpage (i.e. webpage text returned from Readability and then put through some normalization)\n         * refData: refData field as returned from find-refs API\n         * iLinkObj: index of linkObj in results list\n         * maxNumWordsAround: maximum number of words around linkObj.text to search to try to find its unique occurrence.\n         * maxSearchLength: if searchText is beyond this length, we assume the string uniquely identifies the citation. Even if there are multiple occurrences, we assume they can be wrapped with the same citation.\n         */\n        if (!ns.debug && (linkObj.linkFailed || linkObj.refs.length > 1)) { return; }\n        const urls = linkObj.refs && linkObj.refs.map(ref => refData[ref].url);\n        document.normalize();\n        let occurrences = [];\n        let numWordsAround = 0;\n        let searchText = linkObj.text;\n        let linkStartChar = 0;  // start index of link text within searchText\n        const excluder = new LinkExcluder(ns.excludeFromLinking, ns.excludeFromTracking);\n        while ((numWordsAround === 0 || occurrences.length > 1) && numWordsAround < maxNumWordsAround) {\n            // see https://flaviocopes.com/javascript-destructure-object-to-existing-variable/\n            ({ text: searchText, startChar: linkStartChar } = getNumWordsAround(linkObj, normalizedText, numWordsAround));\n            occurrences = findOccurrences(searchText);\n            numWordsAround += 1;\n            if (searchText.length >= maxSearchLength) { break; }\n        }\n        if (occurrences.length === 0 || (occurrences.length > 1 && searchText.length < maxSearchLength)) {\n            if (ns.debug) {\n                console.log(\"MISSED\", numWordsAround, occurrences.length, linkObj);\n            }\n            return;\n        }\n        const globalLinkStarts = occurrences.map(([start, end]) => linkStartChar + start);\n        findAndReplaceDOMText(document, {\n            preset: 'prose',\n            find: linkObj.text,\n            replace: function(portion, match) {\n                // check this is the unique match found above\n                if (globalLinkStarts.indexOf(match.startIndex) === -1) { return portion.text; }\n\n                // check if should be excluded from linking and/or tracking\n                const matchKey = match.startIndex + \"|\" + match.endIndex;\n                const [excludeFromLinking, excludeFromTracking] = excluder.shouldExclude(matchKey, portion.node);\n                if (excludeFromLinking) { return portion.text; }\n                if (!excludeFromTracking) { /* TODO ns.trackedMatches.push(matched_ref); */ }\n                return createATagWithDebugInfo(urls, linkObj, portion.text, iLinkObj, resultsKey);\n            }\n        });\n    }\n\n    function handleApiResponse(resp) {\n        if (resp.ok) {\n            return resp.json();\n        } else if (ns.debug) {\n            resp.text().then(text => alert(text));\n        }\n        return Promise.reject(\"API response not ok\");\n    }\n\n    function onFindRefs(resp) {\n        const startTime = performance.now();\n        let numResults = 0;\n        ns.debugData = [];\n        for (let resultsKey of ['title', 'body']) {\n            ns.debugData = ns.debugData.concat(resp[resultsKey].debugData);\n            resp[resultsKey].results.map((linkObj, iLinkObj) => {\n                wrapRef(linkObj, ns.normalizedInputText[resultsKey], resp[resultsKey].refData, iLinkObj + numResults, resultsKey);\n            });\n            bindRefClickHandlers(resp[resultsKey].refData, resultsKey);\n            numResults += resp[resultsKey].results.length;\n        }\n        const endTime = performance.now();\n        if (ns.debug) {\n            alert(`Linker results are ready! Took ${endTime - startTime} ms to wrap. ${numResults} citations wrapped`);\n        }\n    }\n\n    function reportCitation(elem, event, ...rest) {\n        const reason = prompt(\"What is wrong with this citation?\");\n        const [prevContext, nextContext] = getTextAroundElem(elem, 20);\n        const iLinkObj = elem.getAttribute('data-result-index');\n        const postData = {\n            prevContext, nextContext, reason,\n            citation: elem.textContent,\n            debugData: ns.debugData[iLinkObj],\n            url: window.location.href,\n        };\n        console.log(\"Report citation debug info:\", postData);\n        fetch(`${ns.sefariaUrl}/api/find-refs/report`, {\n            method: 'POST',\n            body: JSON.stringify(postData)\n        })\n        .then(handleApiResponse);\n    }\n\n    function bindRefClickHandlers(refData, resultsKey) {\n        // Bind a click event and a mouseover event to each link\n        [].forEach.call(document.querySelectorAll(`.sefaria-ref[data-result-key=\"${resultsKey}\"]`),(elem) => {\n            const ref = elem.getAttribute('data-ref');\n            if (!ref && !ns.debug) { /* failed link */ return; }\n            const source = refData[ref] || {};\n            source.ref = ref;\n            ns.popupManager.bindEventHandler(elem, ns.sefariaUrl, source);\n        });\n    }\n\n    function getPageUrl() {\n        const canonical = document.head.querySelector(\"link[rel~=canonical]\");\n        // don't use canonical url if dynamic site b/c canonical urls tend to only be correct on initial load\n        return (canonical && !ns.dynamic) ? canonical.href : window.location.href;\n    }\n\n    function getPageDescription() {\n        const meta = document.head.querySelector(\"meta[name~=description]\")\n            || document.head.querySelector(\"meta[property~=description]\")\n            || document.head.querySelector(\"meta[name~='og:description']\")\n            || document.head.querySelector(\"meta[property~='og:description']\")\n            || document.head.querySelector(\"meta[name~='twitter:description']\")\n            || document.head.querySelector(\"meta[property~='twitter:description']\");\n        return meta ? meta.content : \"\";\n    }\n\n    function getPopupModeOnMobile(mode) {\n        if (window.innerWidth < 700) {\n            // If the screen is small, default to link mode\n            return \"link\";\n        }\n        return mode;\n    }\n\n    function getFindRefsUrl() {\n        const params = {\n            with_text: 1,\n            debug: 0 + ns.debug,\n            max_segments: ns.maxParagraphs,\n        }\n        const queryString = Object.entries(params)\n            .map(([key, value]) => `${key}=${value}`)\n            .join('&')\n        return `${ns.sefariaUrl}/api/find-refs?${queryString}`;\n    }\n\n    function getWebsiteApiUrl() {\n        const domain = new URL(getPageUrl()).host;\n        return `${ns.sefariaUrl}/api/websites/${encodeURIComponent(domain)}`;\n    }\n\n    function getFindRefsRequest() {\n        const {text: readableText, readableObj} = getReadableText();\n        ns.normalizedInputText = {\n            body: readableText + getWhitelistText(readableText),\n            title: readableObj.title,\n        };\n        return {\n            metaDataForTracking: {\n                url: getPageUrl(),\n                description: getPageDescription(),\n                title: document.title,\n            },\n            version_preferences_by_corpus: ns.versionPreferencesByCorpus,\n            text: {\n                ...ns.normalizedInputText,\n            },\n        };\n    }\n\n    function getFullWhitelistSelectors(userWhitelistSelector) {\n        return fetch(getWebsiteApiUrl())\n            .then(handleApiResponse)\n            .then(json => {\n                return json.whitelist_selectors || [];\n            })\n            .then(websiteWhitelistSelectors => {\n                if (userWhitelistSelector) {\n                    return websiteWhitelistSelectors.concat([userWhitelistSelector]);\n                }\n                return websiteWhitelistSelectors;\n            });\n    }\n\n    function findRefs() {\n        const postData = getFindRefsRequest();\n        return makeFindRefsApiRequest(postData).then(onFindRefs);\n    }\n\n    function makeFindRefsApiRequest(postData) {\n        return new Promise((resolve, reject) => {\n            fetch(getFindRefsUrl(), {\n                method: 'POST',\n                body: JSON.stringify(postData)\n            })\n                .then(handleApiResponse)\n                .then(resp => resolve(resp));\n        });\n    }\n\n    function deprecatedOptionsWarning({ selector, excludeFromTracking, parenthesesOnly, quotationOnly } = {}) {\n        if (selector || excludeFromTracking || parenthesesOnly || quotationOnly) {\n            console.warn(\"Deprecation warning: you are currently using at least one of the following deprecated options:\" +\n                \" `selector`, `excludeFromTracking`, `parenthesesOnly`, `quotationOnly`. These options no longer are\" +\n                \" used and you can safely remove them. See here for documentation: https://github.com/Sefaria/Sefaria-Project/wiki/Sefaria-Auto-Linker-v3\")\n        }\n    }\n\n    function getMode({ mode, hidePopupsOnMobile }) {\n        if (hidePopupsOnMobile) {\n            return getPopupModeOnMobile(mode);\n        }\n        return mode;\n    }\n\n    function applyDefaultOptions(options) {\n        const defaultOptions = {\n            sefariaUrl: \"https://www.sefaria.org\",  // for configuring which backend linker communicates with\n            mode: \"popup-click\",\n            whitelistSelector: null,\n            excludeFromLinking: null,    // CSS Selector\n            popupStyles: {},\n            interfaceLang: \"english\",\n            contentLang: \"bilingual\",\n            dynamic: false,\n            hidePopupsOnMobile: true,\n            debug: false,\n            versionPreferencesByCorpus: null,\n\n            // Deprecated options\n            selector: null,           // CSS Selector\n            excludeFromTracking: null,   // CSS Selector\n            parenthesesOnly: false,\n            quotationOnly: false,\n        };\n        return {...defaultOptions, ...options};\n    }\n\n    // public API\n\n    ns.link = function(inputOptions) {\n        deprecatedOptionsWarning(inputOptions);\n        const options = applyDefaultOptions(inputOptions);\n        ns.sefariaUrl = options.sefariaUrl;\n        ns.excludeFromLinking = options.excludeFromLinking;\n        ns.dynamic = options.dynamic;\n        ns.debug = options.debug;\n        ns.versionPreferencesByCorpus = options.versionPreferencesByCorpus;\n        ns.maxParagraphs = 20;\n        // useful to remove sefaria links for now but I think when released we only want this to run in debug mode\n        if (options.debug || true) { removeExistingSefariaLinks(); }\n        const mode = getMode(options);\n        ns.popupManager = new PopupManager({ mode, reportCitation, ...options });\n        ns.popupManager.setupPopup();\n\n        getFullWhitelistSelectors(options.whitelistSelector)\n            .then(whitelistSelectors => ns.whitelistSelectors = whitelistSelectors)\n            .then(findRefs);\n    }\n}(window.sefaria = window.sefaria || {}));"],"names":["Draggabilly","PopupManager","_ref","mode","interfaceLang","contentLang","popupStyles","debug","reportCitation","_classCallCheck","popUpElem","heTitle","enTitle","heElems","enElems","triggerLink","hidePopup","bind","_createClass","key","value","setupPopup","_this","category_colors","document","createElement","id","classList","add","html","readMoreText","poweredByText","innerHTML","n","hasOwnProperty","style","position","overflow","display","zIndex","setAttribute","tabIndex","outline","body","appendChild","draggie","handle","linkerHeader","querySelector","linkerFooter","textBox","querySelectorAll","addEventListener","e","which","keyCode","preventDefault","showPopup","elem","_ref2","ref","heRef","_ref2$en","en","_ref2$he","he","primaryCategory","_ref2$isTruncated","isTruncated","firstChild","removeChild","forEach","call","_typeof","concat","apply","i","Math","max","length","enBox","heBox","replace","className","truncated","textContent","rect","getBoundingClientRect","top","left","window","innerWidth","right","popUpRect","height","innerHeight","bottom","pos","width","link","href","level","element","target","parentNode","reportBtn","removeEventListener","currReportCitation","scrollbarOffset","clientWidth","nodes","childNodes","marginRight","focus","remove","bindEventHandler","baseUrl","source","_this2","utmSource","location","hostname","urlLang","substring","url","event","stopPropagation","getElementById","LinkExcluder","excludeFromLinkingSelector","excludeFromTrackingSelector","excludedFromLinking","excludedFromTracking","shouldExclude","matchKey","node","p","excludeFromLinking","excludeFromTracking","nodeName","matches","Readability","DOMPurify","findAndReplaceDOMText","ns","sanitizeElem","cleaned","sanitize","USE_PROFILES","cleanedElem","getWhitelistText","currText","whitelistSelectors","whitelistElems","join","reduce","prev","curr","currCleaned","removeUnwantedElems","indexOf","getTextAroundElemInDir","nchars","isPrev","context","sibling","previousSibling","nextSibling","tempContext","slice","getTextAroundElem","next","unwantedTags","_i","_unwantedTags","tag","_iterator","_createForOfIteratorHelper","getElementsByTagName","_step","s","done","unwantedElem","err","f","unwrap","el","parent","insertBefore","normalize","removeExistingSefariaLinks","_iterator2","_step2","readabilitySerializer","text","isNonCts","NON_CONTIGUOUS_PROSE_ELEMENTS","toLowerCase","_iterator3","_step3","child","getReadableText","documentClone","cloneNode","readableObj","serializer","parse","content","findOccurrences","occurrences","preset","find","portion","match","index","push","startIndex","endIndex","getNextWhiteSpaceIndex","getNthWhiteSpaceIndex","nextIncrement","getNumWordsAround","linkObj","numWordsAround","startChar","endChar","newEndChar","textRev","_toConsumableArray","reverse","newStartChar","wordsAroundText","createATag","linkFailed","isAmbiguous","iLinkObj","resultsKey","atag","sefariaUrl","createATagWithDebugInfo","urls","refs","tempText","wrapRef","normalizedText","refData","maxNumWordsAround","arguments","undefined","maxSearchLength","map","searchText","linkStartChar","excluder","_getNumWordsAround","console","log","globalLinkStarts","_slicedToArray","start","end","_excluder$shouldExclu","_excluder$shouldExclu2","handleApiResponse","resp","ok","json","then","alert","Promise","reject","onFindRefs","startTime","performance","now","numResults","debugData","_loop","_arr2","_i2","results","normalizedInputText","bindRefClickHandlers","endTime","reason","prompt","_getTextAroundElem","_getTextAroundElem2","prevContext","nextContext","getAttribute","postData","citation","fetch","method","JSON","stringify","popupManager","getPageUrl","canonical","head","dynamic","getPageDescription","meta","getPopupModeOnMobile","getFindRefsUrl","params","with_text","max_segments","maxParagraphs","queryString","Object","entries","_ref3","_ref4","getWebsiteApiUrl","domain","URL","host","encodeURIComponent","getFindRefsRequest","_getReadableText","readableText","title","metaDataForTracking","description","version_preferences_by_corpus","versionPreferencesByCorpus","_objectSpread","getFullWhitelistSelectors","userWhitelistSelector","whitelist_selectors","websiteWhitelistSelectors","findRefs","makeFindRefsApiRequest","resolve","deprecatedOptionsWarning","_ref5","selector","parenthesesOnly","quotationOnly","warn","getMode","_ref6","hidePopupsOnMobile","applyDefaultOptions","options","defaultOptions","whitelistSelector","inputOptions","sefaria"],"sourceRoot":""}