/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./local_settings.js":
/*!***************************!*\
  !*** ./local_settings.js ***!
  \***************************/
/***/ ((module) => {

var local_settings = {
  NODEJS_PORT: function () {
    if ('NODEJS_PORT' in process.env) {
      return process.env.NODEJS_PORT;
    } else {
      return 3000; // default;
    }
  }(),

  REDIS_HOST: function () {
    if ('REDIS_HOST' in process.env) {
      return process.env.REDIS_HOST;
    } else {
      return "127.0.0.1"; // default;
    }
  }(),

  REDIS_PORT: function () {
    if ('REDIS_PORT' in process.env) {
      return process.env.REDIS_PORT;
    } else {
      return 6379; // default;
    }
  }(),

  DEBUG: function () {
    if ('DEBUG' in process.env) {
      return process.env.DEBUG;
    } else {
      return false; // default
    }
  }()
};

module.exports = local_settings;

/***/ }),

/***/ "./sefaria-logging.js":
/*!****************************!*\
  !*** ./sefaria-logging.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "errorLogger": () => (/* binding */ errorLogger),
/* harmony export */   "expressLogger": () => (/* binding */ expressLogger),
/* harmony export */   "logger": () => (/* binding */ logger)
/* harmony export */ });
var expressWinston = __webpack_require__(/*! express-winston */ "express-winston");
var winston = __webpack_require__(/*! winston */ "winston");
var severity_format = winston.format(function (info) {
  info.severity = info.level;
  delete info.level;
  return info;
});
var error_format = winston.format(function (info) {
  info.message = info.stack;
  delete info.stack;
  delete info.trace;
  return info;
});
var sefariaMeta = function sefariaMeta(req, res) {
  var httpRequest = {};
  var meta = {};
  if (req) {
    var _req$input_props;
    meta.httpRequest = httpRequest;
    httpRequest.requestMethod = req.method;
    httpRequest.requestUrl = req !== null && req !== void 0 && (_req$input_props = req.input_props) !== null && _req$input_props !== void 0 && _req$input_props.initialPath ? req.input_props.initialPath : "".concat(req.protocol, "://").concat(req.get('host')).concat(req.originalUrl);
    httpRequest.requestSize = req.socket.bytesRead;
    if (req.input_props) {
      meta.initialRefs = req.input_props.initialRefs;
      meta.initialMenu = req.input_props.initialMenu;
    }
  }
  if (res) {
    meta.httpRequest = httpRequest;
    httpRequest.status = res.statusCode;
    httpRequest.latency = {
      seconds: Math.floor(res.responseTime / 1000),
      nanos: res.responseTime % 1000 * 1000000
    };
    meta.timing = res.locals.timing;
  }
  return meta;
};
var logger = winston.createLogger({
  transports: [new winston.transports.Console({})],
  format: winston.format.combine(severity_format(), winston.format.json())
});
var expressLogger = expressWinston.logger({
  transports: [new winston.transports.Console()],
  format: winston.format.combine(severity_format(), winston.format.json()),
  metaField: null,
  //this causes the metadata to be stored at the root of the log entry
  responseField: null,
  // this prevents the response from being included in the metadata (including body and status code)
  requestField: null,
  msg: function msg(req, res) {
    return req && req.input_props && req.input_props.initialPath ? "".concat(req.method, " ").concat(req.input_props.initialPath, " ").concat(res.statusCode) : "".concat(req.method, " ").concat(req.originalUrl, " ").concat(res.statusCode);
  },
  // requestWhitelist: ['headers', 'query'],  //these are not included in the standard StackDriver httpRequest
  // responseWhitelist: ['body'], // this populates the `res.body` so we can get the response size (not required)
  dynamicMeta: sefariaMeta
});
var errorLogger = expressWinston.errorLogger({
  transports: [new winston.transports.Console()],
  metaField: null,
  //this causes the metadata to be stored at the root of the log entry
  blacklistedMetaFields: ['exception'],
  // Required to make metaField:null work, as per https://github.com/bithavoc/express-winston/issues/236
  dynamicMeta: sefariaMeta,
  format: winston.format.combine(error_format(), severity_format(), winston.format.json())
});


/***/ }),

/***/ "../static/js/ReaderApp.jsx":
/*!***********************************************!*\
  !*** ../static/js/ReaderApp.jsx + 96 modules ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "ContestLandingPage": () => (/* reexport */ ContestLandingPage),
  "DonatePage": () => (/* reexport */ DonatePage),
  "EditCollectionPage": () => (/* reexport */ js_EditCollectionPage),
  "EducatorsPage": () => (/* reexport */ EducatorsPage),
  "Footer": () => (/* reexport */ js_Footer),
  "PBSC2020LandingPage": () => (/* reexport */ PBSC2020LandingPage),
  "PBSC2021LandingPage": () => (/* reexport */ PBSC2021LandingPage),
  "PoweredByPage": () => (/* reexport */ PoweredByPage),
  "RabbisPage": () => (/* reexport */ RabbisPage),
  "RambanLandingPage": () => (/* reexport */ RambanLandingPage),
  "ReaderApp": () => (/* binding */ ReaderApp),
  "RemoteLearningPage": () => (/* reexport */ RemoteLearningPage),
  "SheetsLandingPage": () => (/* reexport */ SheetsLandingPage),
  "WordByWordPage": () => (/* reexport */ WordByWordPage),
  "loadServerData": () => (/* binding */ loadServerData),
  "sefariaSetup": () => (/* binding */ sefariaSetup),
  "unpackDataFromProps": () => (/* binding */ unpackDataFromProps)
});

// EXTERNAL MODULE: external "react"
var external_react_ = __webpack_require__("react");
var external_react_default = /*#__PURE__*/__webpack_require__.n(external_react_);
;// CONCATENATED MODULE: external "classnames"
const external_classnames_namespaceObject = require("classnames");
var external_classnames_default = /*#__PURE__*/__webpack_require__.n(external_classnames_namespaceObject);
// EXTERNAL MODULE: external "extend"
var external_extend_ = __webpack_require__("extend");
var external_extend_default = /*#__PURE__*/__webpack_require__.n(external_extend_);
;// CONCATENATED MODULE: external "prop-types"
const external_prop_types_namespaceObject = require("prop-types");
var external_prop_types_default = /*#__PURE__*/__webpack_require__.n(external_prop_types_namespaceObject);
;// CONCATENATED MODULE: ../static/js/sefaria/sefariaJquery.js
var sefariaJquery_$;
if (typeof document !== 'undefined') {
  sefariaJquery_$ = __webpack_require__(/*! jquery */ "jquery");
  __webpack_require__(/*! jquery.cookie */ "jquery.cookie"); //NOTE: these require statements are adding props to the $ obj. The order actually doesn't matter b/c it seems webpack deals with it
  __webpack_require__(/*! jquery-ui */ "jquery-ui"); // Using autocomplete, what else?
  __webpack_require__(/*! jquery.scrollto */ "jquery.scrollto");
  window.$ = sefariaJquery_$;
  window.jquery = sefariaJquery_$;
} else {
  var emptyPromise = function emptyPromise() {
    return {
      "always": function always() {
        return new Promise(function () {}, function () {});
      }
    };
  };
  sefariaJquery_$ = __webpack_require__(/*! cheerio */ "cheerio");
  sefariaJquery_$.ajax = emptyPromise; // fail silently if server-side code every hits one of these functions
  sefariaJquery_$.getJSON = emptyPromise; // ditto
  sefariaJquery_$.cookie = function () {};
}
/* harmony default export */ const sefariaJquery = (sefariaJquery_$);
;// CONCATENATED MODULE: ../static/js/sefaria/VersionPreferences.js
function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }
function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return _typeof(key) === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var VersionPreferences = /*#__PURE__*/function () {
  function VersionPreferences(versionPrefsByCorpus) {
    _classCallCheck(this, VersionPreferences);
    this._versionPrefsByCorpus = versionPrefsByCorpus || {};
    this.update_cookie();
  }
  _createClass(VersionPreferences, [{
    key: "getVersionPref",
    value: function getVersionPref(sref) {
      var title = sefaria.parseRef(sref).index;
      try {
        var corpus = sefaria.index(title).corpus; //ref might have been a sheet sp no index at all, index may be null for other reasons or corpus field may not be present
        return this._versionPrefsByCorpus[corpus];
      } catch (e) {
        return null;
      }
    }
  }, {
    key: "update",
    value: function update(corpus, vtitle, lang) {
      if (!corpus) {
        return this;
      }
      var prefsClone = sefaria.util.clone(this._versionPrefsByCorpus);
      if (!prefsClone[corpus]) {
        prefsClone[corpus] = {};
      }
      prefsClone[corpus][lang] = vtitle;
      return new VersionPreferences(prefsClone);
    }
  }, {
    key: "update_cookie",
    value: function update_cookie() {
      sefariaJquery.cookie("version_preferences_by_corpus", JSON.stringify(this._versionPrefsByCorpus), {
        path: "/"
      });
    }
  }]);
  return VersionPreferences;
}();
/* harmony default export */ const sefaria_VersionPreferences = (VersionPreferences);
;// CONCATENATED MODULE: ../static/js/sefaria/FilterNode.js
function FilterNode_typeof(obj) { "@babel/helpers - typeof"; return FilterNode_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, FilterNode_typeof(obj); }
function FilterNode_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function FilterNode_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, FilterNode_toPropertyKey(descriptor.key), descriptor); } }
function FilterNode_createClass(Constructor, protoProps, staticProps) { if (protoProps) FilterNode_defineProperties(Constructor.prototype, protoProps); if (staticProps) FilterNode_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function FilterNode_toPropertyKey(arg) { var key = FilterNode_toPrimitive(arg, "string"); return FilterNode_typeof(key) === "symbol" ? key : String(key); }
function FilterNode_toPrimitive(input, hint) { if (FilterNode_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (FilterNode_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var FilterNode = /*#__PURE__*/function () {
  //FilterTree object - for category filters
  function FilterNode() {
    var _this = this;
    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      title = _ref.title,
      heTitle = _ref.heTitle,
      docCount = _ref.docCount,
      aggKey = _ref.aggKey,
      aggType = _ref.aggType,
      children = _ref.children,
      parent = _ref.parent,
      selected = _ref.selected;
    FilterNode_classCallCheck(this, FilterNode);
    this.title = title;
    this.heTitle = heTitle;
    this.docCount = docCount;
    this.aggKey = aggKey;
    this.aggType = aggType;
    this.children = typeof children === 'undefined' ? [] : children.map(function (child) {
      if (child instanceof FilterNode) {
        return child;
      }
      return _this.restoreFromSerialization(child);
    });
    this.parent = typeof parent === 'undefined' ? null : parent;
    this.selected = typeof selected === 'undefined' ? 0 : selected; //0 - not selected, 1 - selected, 2 - partially selected
  }

  /**
   * FilterNodes get serialized when stored in browser history
   * We need to recreate them and make sure they fit into the FilterNode tree
   * @param serializedFilterNode - plain JS object with the fields of a FilterNode
   * @returns {FilterNode}
   */
  FilterNode_createClass(FilterNode, [{
    key: "restoreFromSerialization",
    value: function restoreFromSerialization(serializedFilterNode) {
      var fullFilterNode = new FilterNode(serializedFilterNode);
      fullFilterNode.parent = this;
      return fullFilterNode;
    }
  }, {
    key: "sumDocs",
    value: function sumDocs() {
      if (!this.hasChildren()) {
        return this.docCount;
      }
      this.docCount = this.children.reduce(function (sum, child) {
        return sum + child.sumDocs();
      }, 0);
      return this.docCount;
    }
  }, {
    key: "append",
    value: function append(child) {
      this.children.push(child);
      child.parent = this;
    }
  }, {
    key: "hasChildren",
    value: function hasChildren() {
      return this.children.length > 0;
    }
  }, {
    key: "getLeafNodes",
    value: function getLeafNodes(searchFilterText) {
      //Return ordered array of leaf (book) level filters
      if (!this.hasChildren()) {
        return [this];
      }
      var results = [];
      for (var i = 0; i < this.children.length; i++) {
        results = results.concat(this.children[i].getLeafNodes(searchFilterText));
      }
      if (searchFilterText && searchFilterText != "") {
        results = results.filter(function (x) {
          return x.title.match(new RegExp("(?:^|.+\\s)".concat(searchFilterText, ".*"), "i")) || x.heTitle.match(new RegExp("(?:^|.+\\s)".concat(searchFilterText, ".*"), "i"));
        });
      }
      return results;
    }
  }, {
    key: "getId",
    value: function getId() {
      return this.aggKey.replace(new RegExp("[/',()]", 'g'), "-").replace(new RegExp(" ", 'g'), "_");
    }
  }, {
    key: "isSelected",
    value: function isSelected() {
      return this.selected === 1;
    }
  }, {
    key: "isPartial",
    value: function isPartial() {
      return this.selected === 2;
    }
  }, {
    key: "isUnselected",
    value: function isUnselected() {
      return this.selected === 0;
    }
  }, {
    key: "setSelected",
    value: function setSelected(propogateParent, noPropogateChild) {
      //default is to propogate children and not parents.
      //Calls from front end should use (true, false), or just (true)
      this.selected = 1;
      if (!noPropogateChild) {
        for (var i = 0; i < this.children.length; i++) {
          this.children[i].setSelected(false);
        }
      }
      if (propogateParent) {
        if (this.parent) this.parent._deriveState();
      }
    }
  }, {
    key: "setUnselected",
    value: function setUnselected(propogateParent, noPropogateChild) {
      //default is to propogate children and not parents.
      //Calls from front end should use (true, false), or just (true)
      this.selected = 0;
      if (!noPropogateChild) {
        for (var i = 0; i < this.children.length; i++) {
          this.children[i].setUnselected(false);
        }
      }
      if (propogateParent) {
        if (this.parent) this.parent._deriveState();
      }
    }
  }, {
    key: "setPartial",
    value: function setPartial() {
      //Never propogate to children.  Always propogate to parents
      this.selected = 2;
      if (this.parent) this.parent._deriveState();
    }
  }, {
    key: "_deriveState",
    value: function _deriveState() {
      //Always called from children, so we can assume at least one
      var potentialState = this.children[0].selected;
      if (potentialState === 2) {
        this.setPartial();
        return;
      }
      for (var i = 1; i < this.children.length; i++) {
        if (this.children[i].selected !== potentialState) {
          this.setPartial();
          return;
        }
      }
      //Don't use setters, so as to avoid looping back through children.
      if (potentialState === 1) {
        this.setSelected(true, true);
      } else {
        this.setUnselected(true, true);
      }
    }
  }, {
    key: "hasAppliedFilters",
    value: function hasAppliedFilters() {
      return this.getAppliedFilters().length > 0;
    }
  }, {
    key: "getAppliedFilters",
    value: function getAppliedFilters() {
      if (this.isUnselected()) {
        return [];
      }
      if (this.isSelected()) {
        return [this.aggKey];
      }
      var results = [];
      for (var i = 0; i < this.children.length; i++) {
        results = results.concat(this.children[i].getAppliedFilters());
      }
      return results;
    }
  }, {
    key: "getSelectedTitles",
    value: function getSelectedTitles(lang) {
      if (this.isUnselected()) {
        return [];
      }
      if (this.isSelected()) {
        var enTitle = !!this.title ? this.title : this.heTitle;
        var heTitle = !!this.heTitle ? this.heTitle : this.title;
        if (!enTitle) {
          if (this.aggType === 'collections') {
            enTitle = '(No Collection)';
          }
          if (this.aggType === 'tags') {
            enTitle = '(No Tag)';
          }
        }
        if (!heTitle) {
          if (this.aggType === 'collections') {
            heTitle = '(ללא אסופה)';
          }
          if (this.aggType === 'tags') {
            heTitle = '(ללא תוית)';
          }
        }
        return [lang === "en" ? enTitle : heTitle];
      }
      var results = [];
      for (var i = 0; i < this.children.length; i++) {
        results = results.concat(this.children[i].getSelectedTitles(lang));
      }
      return results;
    }

    /**
     * Returns a clone of this FilterNode
     * @param prepareForSerialization: bool, if true, sets `parent` field to null. This field is an issue when serializing FilterNode because it recursively refers to existing FilterNodes.
     * @returns {FilterNode}
     */
  }, {
    key: "clone",
    value: function clone(prepareForSerialization) {
      return this._clone(prepareForSerialization, null);
    }

    /**
     * Internal clone function to with recursive params
     * @param prepareForSerialization
     * @param clonedParent
     * @returns {FilterNode}
     * @private
     */
  }, {
    key: "_clone",
    value: function _clone(prepareForSerialization, clonedParent) {
      var cloned = new FilterNode(this);
      cloned.children = cloned.children.map(function (c) {
        return c._clone(prepareForSerialization, cloned);
      });
      cloned.parent = prepareForSerialization ? null : clonedParent;
      return cloned;
    }
  }]);
  return FilterNode;
}();
/* harmony default export */ const sefaria_FilterNode = (FilterNode);
;// CONCATENATED MODULE: external "striptags"
const external_striptags_namespaceObject = require("striptags");
var external_striptags_default = /*#__PURE__*/__webpack_require__.n(external_striptags_namespaceObject);
;// CONCATENATED MODULE: external "humanize-duration"
const external_humanize_duration_namespaceObject = require("humanize-duration");
var external_humanize_duration_default = /*#__PURE__*/__webpack_require__.n(external_humanize_duration_namespaceObject);
;// CONCATENATED MODULE: external "sanitize-html"
const external_sanitize_html_namespaceObject = require("sanitize-html");
var external_sanitize_html_default = /*#__PURE__*/__webpack_require__.n(external_sanitize_html_namespaceObject);
;// CONCATENATED MODULE: external "@hebcal/core"
const core_namespaceObject = require("@hebcal/core");
;// CONCATENATED MODULE: ../static/js/sefaria/util.js
function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function util_typeof(obj) { "@babel/helpers - typeof"; return util_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, util_typeof(obj); }
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function util_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function util_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, util_toPropertyKey(descriptor.key), descriptor); } }
function util_createClass(Constructor, protoProps, staticProps) { if (protoProps) util_defineProperties(Constructor.prototype, protoProps); if (staticProps) util_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function util_toPropertyKey(arg) { var key = util_toPrimitive(arg, "string"); return util_typeof(key) === "symbol" ? key : String(key); }
function util_toPrimitive(input, hint) { if (util_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (util_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }







var INBROWSER = typeof document !== 'undefined';
var Util = /*#__PURE__*/function () {
  function Util() {
    util_classCallCheck(this, Util);
  }
  util_createClass(Util, null, [{
    key: "scrollIntoViewIfNeeded",
    value:
    /**
     * Method to scroll into view port, if it's outside the viewport
     * From: https://medium.com/@makk.bit/scroll-into-view-if-needed-10a96e0bdb61
     * @param {Object} target - DOM Element
     * @returns {undefined}
     * See also: https://www.javascripttutorial.net/dom/css/check-if-an-element-is-visible-in-the-viewport/
     *
     */
    function scrollIntoViewIfNeeded(target, scrollIntoViewOptions) {
      // Target is outside the viewport from the bottom
      if (target.getBoundingClientRect().bottom > window.innerHeight) {
        //  The bottom of the target will be aligned to the bottom of the visible area of the scrollable ancestor.
        target.scrollIntoView(scrollIntoViewOptions);
      }

      // Target is outside the view from the top
      if (target.getBoundingClientRect().top < 0) {
        // The top of the target will be aligned to the top of the visible area of the scrollable ancestor
        target.scrollIntoView(scrollIntoViewOptions);
      }
    }
  }, {
    key: "selectElementContents",
    value: function selectElementContents(el) {
      //source: https://stackoverflow.com/questions/4183401/can-you-set-and-or-change-the-user-s-text-selection-in-javascript
      if (window.getSelection && document.createRange) {
        var sel = window.getSelection();
        var range = document.createRange();
        range.selectNodeContents(el);
        sel.removeAllRanges();
        sel.addRange(range);
      } else if (document.selection && document.body.createTextRange) {
        var textRange = document.body.createTextRange();
        textRange.moveToElementText(el);
        textRange.select();
      }
    }
  }, {
    key: "encodeVtitle",
    value: function encodeVtitle(vtitle) {
      return vtitle.replace(/\s/g, '_').replace(/;/g, '%3B');
    }
  }, {
    key: "getUrlVersionsParams",
    value: function getUrlVersionsParams(currVersions) {
      var _this = this;
      var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      currVersions = this.getCurrVersionsWithoutAPIResultFields(currVersions);
      if (currVersions) {
        return Object.entries(currVersions).filter(function (_ref) {
          var _ref2 = _slicedToArray(_ref, 2),
            vlang = _ref2[0],
            vtitle = _ref2[1];
          return !!vtitle;
        }).map(function (_ref3) {
          var _ref4 = _slicedToArray(_ref3, 2),
            vlang = _ref4[0],
            vtitle = _ref4[1];
          return "&v".concat(vlang).concat(i > 1 ? i : "", "=").concat(_this.encodeVtitle(vtitle));
        }).join("");
      } else {
        return "";
      }
    }
  }, {
    key: "getCurrVersionsWithoutAPIResultFields",
    value: function getCurrVersionsWithoutAPIResultFields(currVersions) {
      /**
       * currVersions can contain fields like `enAPIResult` and `heAPIResult`.
       * returns an object without these fields
       */
      if (!currVersions) {
        return currVersions;
      }
      return Object.entries(currVersions).reduce(function (a, _ref5) {
        var _ref6 = _slicedToArray(_ref5, 2),
          vlang = _ref6[0],
          vtitle = _ref6[1];
        if (vlang.endsWith("APIResult")) {
          return a;
        }
        a[vlang] = vtitle;
        return a;
      }, {});
    }
  }, {
    key: "decodeVtitle",
    value: function decodeVtitle(vtitle) {
      return vtitle.replace(/_/g, ' ').replace(/%3B/g, ';');
    }
  }, {
    key: "localeDate",
    value: function localeDate(dateString) {
      // takes dateString (usually generated from Python datetime object) and returns a human readable string depending on interfaceLang
      var locale = sefaria.interfaceLang === 'english' ? 'en-US' : 'he-Hebr-IL';
      var dateOptions = {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      };
      return new Date(dateString).toLocaleDateString(locale, dateOptions); // remove comma from english date
    }
  }, {
    key: "hebrewCalendarDateStr",
    value: function hebrewCalendarDateStr(dateObjStr) {
      //returns a fully qualified Hebrew calendar date from a Gregorian input. Can output in English or Hebrew
      var hd = new core_namespaceObject.HDate(new Date(dateObjStr));
      //Up to this we could have gotten away with built in international date objects in js:
      // By specifying dateOptions['calendar'] = 'hebrew'; as in the function above.
      //That would result in a hybrid hebrew date though, that still uses English numerals for day and year.
      //So we use Hebcal's renderGematriya()
      return sefaria.interfaceLang === 'english' ? hd.render() : hd.renderGematriya();
    }
  }, {
    key: "sign_up_user_testing",
    value: function sign_up_user_testing() {
      // temporary function to be used in template 'user_testing_israel.html'
      var validateEmail = function validateEmail(email) {
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
      };
      var email = sefariaJquery('#email-input').val();
      if (!validateEmail(email)) {
        alert(email + ' is not a valid email');
        return;
      }
      console.log('Email valid', email);
      var feedback = {
        refs: null,
        type: 'user_testing',
        url: null,
        currVersions: null,
        email: email
      };
      var postData = {
        json: JSON.stringify(feedback)
      };
      sefariaJquery.post('/api/send_feedback', postData);
    }
  }, {
    key: "subscribeToNbList",
    value: function subscribeToNbList(email, lists) {
      if (sefaria.util.isValidEmailAddress(email)) {
        sefariaJquery.post("/api/subscribe/" + email + "?lists=" + lists, function (data) {
          if ("error" in data) {
            console.log(data.error);
          } else {
            console.log("Subscribed! Welcome to our list.");
          }
        }).error(function (data) {
          return console.log("Sorry, there was an error.");
        });
      } else {
        console.log("not valid email address");
      }
    }
  }, {
    key: "naturalTimePlural",
    value: function naturalTimePlural(n, singular, plural) {
      return n <= 1 ? singular : plural;
    }
  }, {
    key: "naturalTime",
    value: function naturalTime(timeStamp) {
      var _ref7 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        lang = _ref7.lang,
        _short = _ref7["short"];
      // given epoch time stamp, return string of time delta between `timeStamp` and now
      var now = Util.epoch_time();
      var language = lang ? lang : sefaria.interfaceLang === 'hebrew' ? 'he' : 'en';
      var spacer = " ";
      if (_short) {
        language = language == "en" ? "shortEn" : "shortHe";
        spacer = language == "shortEn" ? "" : " ";
      }
      return Util.sefariaHumanizeDuration(now - timeStamp, {
        "language": language,
        "spacer": spacer
      });
    }
  }, {
    key: "object_equals",
    value: function object_equals(a, b) {
      // simple object equality assuming values are primitive. see here
      // http://adripofjavascript.com/blog/drips/object-equality-in-javascript.html
      if (util_typeof(a) !== util_typeof(b)) {
        return false;
      }
      if (a === null && b !== null || a !== null && b === null) {
        return false;
      }
      var aProps = Object.getOwnPropertyNames(a);
      var bProps = Object.getOwnPropertyNames(b);
      if (aProps.length != bProps.length) {
        return false;
      }
      var _iterator = _createForOfIteratorHelper(aProps),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var propName = _step.value;
          if (a[propName] !== b[propName]) {
            return false;
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return true;
    }
  }, {
    key: "epoch_time",
    value: function epoch_time() {
      // get current epoch time in UTC
      // silly but thus is JS
      // see: https://stackoverflow.com/a/6777470/4246723
      var now = new Date();
      var nowUTC = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds());
      return Math.round(nowUTC / 1000);
    }
  }, {
    key: "stripImgs",
    value: function stripImgs(s) {
      return !s ? "" : external_sanitize_html_default()(s, {
        allowedTags: external_sanitize_html_default().defaults.allowedTags.filter(function (tag) {
          return tag !== 'img';
        }),
        allowedAttributes: (external_sanitize_html_default()).defaults.allowedAttributes
      });
    }
  }, {
    key: "zip",
    value: function zip() {
      for (var _len = arguments.length, rows = new Array(_len), _key = 0; _key < _len; _key++) {
        rows[_key] = arguments[_key];
      }
      // rows is an array
      // corrolary to zip in python
      return rows[0].map(function (_, c) {
        return rows.map(function (row) {
          return row[c];
        });
      });
    }
  }, {
    key: "clone",
    value: function clone(obj, prepareForSerialization) {
      var _this2 = this;
      // Handle the 3 simple types, and null or undefined
      if (null == obj || "object" != util_typeof(obj)) {
        return obj;
      }
      if (typeof obj.clone === 'function') {
        // this handles any object with a clone function which currently
        // includes SearchState and FilterNode
        return obj.clone(prepareForSerialization);
      }

      // Handle Date
      if (obj instanceof Date) {
        var copy = new Date();
        copy.setTime(obj.getTime());
        return copy;
      }

      // Handle Array
      if (obj instanceof Array) {
        return obj.map(function (item) {
          return _this2.clone(item, prepareForSerialization);
        });
      }

      // Handle Object
      if (obj instanceof Object) {
        var _copy = {};
        for (var _i2 = 0, _Object$entries = Object.entries(obj); _i2 < _Object$entries.length; _i2++) {
          var _ref8 = _Object$entries[_i2];
          var _ref9 = _slicedToArray(_ref8, 2);
          var attr = _ref9[0];
          var value = _ref9[1];
          _copy[attr] = this.clone(value, prepareForSerialization);
        }
        return _copy;
      }
      throw new Error("Unable to copy obj! Its type isn't supported.");
    }
  }, {
    key: "throttle",
    value: function throttle(func, limit) {
      // Returns a functions which throttle `func`
      var wait = false; // Initially, we're not waiting
      return function () {
        // We return a throttled function
        if (!wait) {
          // If we're not waiting
          func.call(); // Execute users function
          wait = true; // Prevent future invocations
          setTimeout(function () {
            // After a period of time
            wait = false; // And allow future invocations
          }, limit);
        }
      };
    }
  }, {
    key: "htmlToText",
    value: function htmlToText(html) {
      //remove code brakes and tabs
      html = html.replace(/\n/g, "");
      html = html.replace(/\t/g, "");

      //keep html brakes and tabs
      html = html.replace(/<\/td>/g, "\t");
      html = html.replace(/<\/table>/g, "\n");
      html = html.replace(/<\/tr>/g, "\n");
      html = html.replace(/<\/p>/g, "\n");
      html = html.replace(/<\/div>/g, "\n");
      html = html.replace(/<br>/g, "\n");
      html = html.replace(/<br( )*\/>/g, "\n");

      //parse html into text
      var dom = new DOMParser().parseFromString('<!doctype html><body>' + html, 'text/html');
      //remove duplicate line breaks
      var text = dom.body.textContent.replace(/\n\s*\n/g, "\n");
      return text;
    }
  }, {
    key: "cleanHTML",
    value: function cleanHTML(html) {
      html = html.replace(/\u00a0/g, ' ').replace(/&nbsp;/g, ' ').replace(new RegExp("(\\n)+$", 'gm'), '');
      var clean = external_sanitize_html_default()(html, {
        allowedTags: ['blockquote', 'p', 'a', 'ul', 'ol', 'nl', 'li', 'b', 'i', 'strong', 'em', 'small', 'big', 'span', 'strike', 'hr', 'br', 'div', 'table', 'thead', 'caption', 'tbody', 'tr', 'th', 'td', 'pre', 'sup', 'u', 'h1'],
        allowedAttributes: {
          a: ['href', 'name', 'target', 'class', 'data-ref'],
          img: ['src'],
          p: ['style'],
          span: ['style'],
          div: ['style'],
          td: ['colspan']
        },
        allowedStyles: {
          '*': {
            'color': [/^\#(0x)?[0-9a-f]+$/i, /^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/],
            'background-color': [/^\#(0x)?[0-9a-f]+$/i, /^rgb(?!\(\s*255\s*,\s*255\s*,\s*255\s*\))\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/],
            'text-align': [/^left$/, /^right$/, /^center$/]
          }
        },
        exclusiveFilter: function exclusiveFilter(frame) {
          return frame.tag === 'p' && !frame.text.trim();
        } //removes empty p tags  generated by ckeditor...
      });

      return clean;
    }
  }, {
    key: "debounce",
    value: function debounce(func, wait, immediate) {
      // Returns a function which debounces `func`
      var timeout;
      return function () {
        var context = this,
          args = arguments;
        var later = function later() {
          timeout = null;
          if (!immediate) func.apply(context, args);
        };
        var callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
      };
    }
  }, {
    key: "inArray",
    value: function inArray(needle, haystack) {
      if (!haystack) {
        return -1;
      } //For parity of behavior w/ JQuery inArray
      var index = -1;
      for (var i = 0; i < haystack.length; i++) {
        if (needle.compare && needle.compare(haystack[i]) || haystack[i] === needle) {
          index = i;
          break;
        }
      }
      return index;
    }
  }, {
    key: "currentPath",
    value: function currentPath() {
      // Returns the current path plus search string if a browser context
      // or "/" in a browser-less context.
      return typeof window === "undefined" ? this._initialPath : window.location.pathname + window.location.search;
    }
  }, {
    key: "isUrl",
    value: function isUrl(string) {
      var res = string.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g);
      return res !== null;
    }
  }, {
    key: "parseUrl",
    value: function parseUrl(url) {
      var a = document.createElement('a');
      a.href = url;
      return {
        source: url,
        protocol: a.protocol.replace(':', ''),
        host: a.hostname,
        port: a.port,
        query: a.search,
        params: function () {
          var ret = {},
            seg = a.search.replace(/^\?/, '').split('&'),
            len = seg.length,
            i = 0,
            s;
          for (; i < len; i++) {
            if (!seg[i]) {
              continue;
            }
            s = seg[i].split('=');
            ret[s[0]] = s[1];
          }
          return ret;
        }(),
        file: (a.pathname.match(/\/([^\/?#]+)$/i) || [, ''])[1],
        hash: a.hash.replace('#', ''),
        path: a.pathname.replace(/^([^\/])/, '/$1'),
        relative: (a.href.match(/tps?:\/\/[^\/]+(.+)/) || [, ''])[1],
        segments: a.pathname.replace(/^\//, '').split('/')
      };
    }
  }, {
    key: "parseHash",
    value: function parseHash(urlHash) {
      var sections = urlHash.split("&");
      var hashDict = {};
      sections.forEach(function (x) {
        var i = x.indexOf("=");
        if (i !== -1) {
          hashDict[x.slice(0, i)] = x.slice(i + 1);
        } else {
          hashDict[x] = x;
        }
      });
      return hashDict;
    }
  }, {
    key: "isValidEmailAddress",
    value: function isValidEmailAddress(emailAddress) {
      var pattern = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);
      return pattern.test(emailAddress);
    }
  }, {
    key: "cookie",
    value: function cookie(key, value) {
      // Mock cookie function to mirror $.cookie for use Server Side
      if (typeof value === "undefined") {
        return Util._cookies[key];
      }
      Util._cookies[key] = value;
    }
  }, {
    key: "openInNewTab",
    value: function openInNewTab(url) {
      var win = window.open(url, '_blank');
      win.focus();
    }
  }, {
    key: "commonSubstring",
    value: function commonSubstring(str1, str2) {
      var length = Math.min(str1.length, str2.length);
      var index = 0;
      while (index < length && str1[index] === str2[index]) index++;
      return str1.substring(0, index);
    }
  }, {
    key: "setupPrototypes",
    value: function setupPrototypes() {
      String.prototype.toProperCase = function () {
        // Treat anything after ", " as a new clause
        // so that titles like "Orot, The Ideals of Israel" keep a capital The
        var clauses = this.split(", ");
        for (var n = 0; n < clauses.length; n++) {
          var i, j, str, lowers, uppers;
          str = clauses[n].replace(/([^\W_]+[^\s-]*) */g, function (txt) {
            // We're not lowercasing the end of the string because of cases like "HaRambam"
            return txt.charAt(0).toUpperCase() + txt.substr(1);
          });

          // Certain minor words should be left lowercase unless
          // they are the first or last words in the string
          lowers = ['A', 'An', 'The', 'And', 'But', 'Or', 'For', 'Nor', 'As', 'At', 'By', 'For', 'From', 'Is', 'In', 'Into', 'Near', 'Of', 'On', 'Onto', 'To', 'With'];
          for (i = 0, j = lowers.length; i < j; i++) {
            str = str.replace(new RegExp('\\s' + lowers[i] + '\\s', 'g'), function (txt) {
              return txt.toLowerCase();
            });
          }

          // Certain words such as initialisms or acronyms should be left uppercase
          uppers = ['Id', 'Tv', 'Ii', 'Iii', "Iv"];
          for (i = 0, j = uppers.length; i < j; i++) {
            str = str.replace(new RegExp('\\b' + uppers[i] + '\\b', 'g'), uppers[i].toUpperCase());
          }
          clauses[n] = str;
        }
        return clauses.join(", ");
      };
      String.prototype.toFirstCapital = function () {
        return this.charAt(0).toUpperCase() + this.substr(1);
      };
      String.prototype.stripHtml = function () {
        return external_striptags_default()(this.replace(/\u00a0/g, ' ').decodeHtmlEntities());
      };
      String.prototype.stripNikkud = function () {
        return this.replace(/[\u0591-\u05C7]/g, "");
      };
      String.prototype.stripHtmlConvertLineBreaks = function () {
        // Converts line breaks to spaces
        return external_striptags_default()(this.replace(/\u00a0/g, ' ').decodeHtmlEntities().replace(/<p>/g, ' <p>').replace(/(<br>|\n)+/g, ' '));
      };
      String.prototype.stripPunctuation = function () {
        var regex = /[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g;
        return this.replace(regex, '');
      };
      String.prototype.escapeHtml = function () {
        return this.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/'/g, '&apos;').replace(/"/g, '&quot;').replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g, '$1<br />$2');
      };
      String.prototype.decodeHtmlEntities = function () {
        return this.replace(/&nbsp;/gi, " ").replace(/&amp;/gi, "&").replace(/&quot;/gi, "\"").replace(/&lt;/gi, "<").replace(/&gt;/gi, ">");
      };
      if (!String.prototype.startsWith) {
        String.prototype.startsWith = function (searchString, position) {
          position = position || 0;
          return this.substr(position, searchString.length) === searchString;
        };
      }
      String.prototype.splitCamelCase = function () {
        return this.replace(/([A-Z])/g, ' $1').trim().replace(/^./, function (str) {
          return str.toUpperCase();
        });
      };
      String.prototype.camelize = function () {
        return this.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g, function (match, index) {
          if (+match === 0) return ""; // or if (/\s+/.test(match)) for white spaces
          return index === 0 ? match.toLowerCase() : match.toUpperCase();
        });
      };
      Array.prototype.compare = function (testArr) {
        if (this.length != testArr.length) return false;
        for (var i = 0; i < testArr.length; i++) {
          if (this[i].compare) {
            if (!this[i].compare(testArr[i])) return false;
          }
          if (this[i] !== testArr[i]) return false;
        }
        return true;
      };
      Array.prototype.elementsAreEqual = function (testArr) {
        // uses Object.is() to determine is elements point to same objects even if outer array is different
        if (!testArr || this.length != testArr.length) return false;
        for (var i = 0; i < testArr.length; i++) {
          if (!Object.is(this[i], testArr[i])) return false;
        }
        return true;
      };
      Array.prototype.pad = function (s, v) {
        var l = Math.abs(s) - this.length;
        var a = [].concat(this);
        if (l <= 0) return a;
        for (var i = 0; i < l; i++) s < 0 ? a.unshift(v) : a.push(v);
        return a;
      };
      Array.prototype.unique = function () {
        var a = [];
        var l = this.length;
        for (var i = 0; i < l; i++) {
          for (var j = i + 1; j < l; j++) {
            // If this[i] is found later in the array
            if (this[i] === this[j]) j = ++i;
          }
          a.push(this[i]);
        }
        return a;
      };
      Array.prototype.toggle = function (value) {
        var index = this.indexOf(value);
        if (index === -1) {
          this.push(value);
        } else {
          this.splice(index, 1);
        }
        return this;
      };
      Array.prototype.move = function (old_index, new_index) {
        if (new_index >= this.length) {
          var k = new_index - this.length;
          while (k-- + 1) {
            this.push(undefined);
          }
        }
        this.splice(new_index, 0, this.splice(old_index, 1)[0]);
        return this; // for testing purposes
      };
      /*  I highly suspect that these functions work properly. Not worth the slight performance gain. Commenting out for now in case we want to revisit later.
      Array.prototype.insertInOrder = function(element, comparer) {
        // see https://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers
        // insert `element` into array so that the array remains sorted, assuming it was sorted to begin with
        this.splice(this.locationOfSorted(element, comparer) + 1, 0, element);
        return this;
      };
       Array.prototype.locationOfSorted = function(element, comparer, start, end) {
        // https://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers
        // get index to insert `element` into array so that array remains sorted, assuming it was sorted to begin with
        if (this.length === 0)
          return -1;
         start = start || 0;
        end = end || this.length;
        const pivot = (start + end) >> 1;  // should be faster than dividing by 2
         const c = comparer(element, this[pivot]);
        if (end - start <= 1) return c == -1 ? pivot - 1 : pivot;
         switch (c) {
          case -1: return this.locationOfSorted(element, comparer, start, pivot);
          case 0: return pivot;
          case 1: return this.locationOfSorted(element, comparer, pivot, end);
        };
      };
      */

      Number.prototype.addCommas = function () {
        return this.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      };
      if (!Array.prototype.fill) {
        Object.defineProperty(Array.prototype, 'fill', {
          value: function value(_value) {
            if (this == null) {
              throw new TypeError('this is null or not defined');
            }
            var O = Object(this);
            var len = O.length >>> 0;
            var start = arguments[1];
            var relativeStart = start >> 0;
            var k = relativeStart < 0 ? Math.max(len + relativeStart, 0) : Math.min(relativeStart, len);
            var end = arguments[2];
            var relativeEnd = end === undefined ? len : end >> 0;
            var _final = relativeEnd < 0 ? Math.max(len + relativeEnd, 0) : Math.min(relativeEnd, len);
            while (k < _final) {
              O[k] = _value;
              k++;
            }
            return O;
          }
        });
      }

      // https://tc39.github.io/ecma262/#sec-array.prototype.find
      if (!Array.prototype.find) {
        Object.defineProperty(Array.prototype, 'find', {
          value: function value(predicate) {
            // 1. Let O be ? ToObject(this value).
            if (this == null) {
              throw new TypeError('"this" is null or not defined');
            }
            var o = Object(this);

            // 2. Let len be ? ToLength(? Get(O, "length")).
            var len = o.length >>> 0;

            // 3. If IsCallable(predicate) is false, throw a TypeError exception.
            if (typeof predicate !== 'function') {
              throw new TypeError('predicate must be a function');
            }

            // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.
            var thisArg = arguments[1];

            // 5. Let k be 0.
            var k = 0;

            // 6. Repeat, while k < len
            while (k < len) {
              // a. Let Pk be ! ToString(k).
              // b. Let kValue be ? Get(O, Pk).
              // c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).
              // d. If testResult is true, return kValue.
              var kValue = o[k];
              if (predicate.call(thisArg, kValue, k, o)) {
                return kValue;
              }
              // e. Increase k by 1.
              k++;
            }

            // 7. Return undefined.
            return undefined;
          }
        });
      }
      RegExp.escape = function (s) {
        return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
      };
    }
  }, {
    key: "setupMisc",
    value: function setupMisc() {
      // Protect against browsers without consoles and forgotten console statements
      if (typeof console === 'undefined') {
        var console = {};
        console.log = function () {};
      }
    }
  }, {
    key: "handleUserCookie",
    value: function handleUserCookie(uid) {
      var cookie = INBROWSER ? sefariaJquery.cookie : this.cookie;
      if (uid) {
        // If logged in, replace cookie with current system details

        var expires = new Date(); // starts with current time
        expires.setTime(expires.getTime() + 2 * 365 * 24 * 3600 * 1000); // milliseconds

        cookie("_user", JSON.stringify({
          _uid: uid
        }), {
          path: "/",
          expires: expires
        });
      } else {
        // If not logged in, get details from cookie
        var c = cookie("_user");
        if (c) {
          c = JSON.parse(c);
          return c;
        }
      }
    }
  }, {
    key: "getNormalizedSelectionString",
    value: function getNormalizedSelectionString() {
      var selection = window.getSelection();
      if (selection.rangeCount) {
        var container = document.createElement("div");
        for (var i = 0, len = selection.rangeCount; i < len; ++i) {
          container.appendChild(selection.getRangeAt(i).cloneContents());
        }
        //remove line numbers
        var lineNumbers = container.getElementsByClassName('segmentNumber');
        while (lineNumbers.length > 0) {
          lineNumbers[0].parentNode.removeChild(lineNumbers[0]);
        }
        var titleBoxes = container.getElementsByClassName('titleBox');
        while (titleBoxes.length > 0) {
          titleBoxes[0].parentNode.removeChild(titleBoxes[0]);
        }
        //remove other language. will need to be generalized for
        var curReaderPanel = selection.getRangeAt(0).commonAncestorContainer.parentNode.closest('.readerPanel');
        if (curReaderPanel && curReaderPanel.classList.contains('hebrew')) {
          var elsToRemove = container.getElementsByClassName('en');
          while (elsToRemove.length > 0) {
            elsToRemove[0].parentNode.removeChild(elsToRemove[0]);
          }
        } else if (curReaderPanel && curReaderPanel.classList.contains('english')) {
          var elsToRemove = container.getElementsByClassName('he');
          while (elsToRemove.length > 0) {
            elsToRemove[0].parentNode.removeChild(elsToRemove[0]);
          }
        }
        return container.innerText;
      } else {
        return selection.toString();
      }
    }
  }, {
    key: "getSelectionBoundaryElement",
    value: function getSelectionBoundaryElement(isStart) {
      // http://stackoverflow.com/questions/1335252/how-can-i-get-the-dom-element-which-contains-the-current-selection
      var range, sel, container;
      if (document.selection) {
        range = document.selection.createRange();
        range.collapse(isStart);
        return range.parentElement();
      } else {
        sel = window.getSelection();
        if (sel.getRangeAt) {
          if (sel.rangeCount > 0) {
            range = sel.getRangeAt(0);
          }
        } else {
          // Old WebKit
          range = document.createRange();
          range.setStart(sel.anchorNode, sel.anchorOffset);
          range.setEnd(sel.focusNode, sel.focusOffset);

          // Handle the case when the selection was selected backwards (from the end to the start in the document)
          if (range.collapsed !== sel.isCollapsed) {
            range.setStart(sel.focusNode, sel.focusOffset);
            range.setEnd(sel.anchorNode, sel.anchorOffset);
          }
        }
        if (range) {
          container = range[isStart ? "startContainer" : "endContainer"];

          // Check if the container is a text node and return its parent if so
          return container.nodeType === 3 ? container.parentNode : container;
        }
      }
    }
  }, {
    key: "getUrlVars",
    value: function getUrlVars() {
      var vars = {};
      var url = INBROWSER ? window.location.href : this._initialPath;
      var parts = url.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
        vars[key] = decodeURIComponent(value);
      });
      return vars;
    }
  }, {
    key: "replaceUrlParam",
    value: function replaceUrlParam(paramName, paramValue) {
      //TODO: This does not create the correct urls for multipanel views. It ends up just tacking on an extra "with" param on the end
      var url = INBROWSER ? window.location.href : this._initialPath;
      if (paramValue == null) paramValue = '';
      var pattern = new RegExp('\\b(' + paramName + '=).*?(&|$)');
      if (url.search(pattern) >= 0) {
        return url.replace(pattern, '$1' + paramValue + '$2');
      }
      return url + (url.indexOf('?') > 0 ? '&' : '?') + paramName + '=' + paramValue;
    }
  }, {
    key: "removeUrlParam",
    value: function removeUrlParam(paramName) {
      var url = INBROWSER ? window.location.href : this._initialPath;
      var pattern = new RegExp('\\b(&|\\?)(' + paramName + '=).*?(&|$)');
      return url.replace(pattern, '$1');
    }
  }, {
    key: "linkify",
    value: function linkify(str) {
      return str.replace(/(?:(https?\:\/\/[^\s]+))/m, '<a target="_blank" href="$1">$1</a>');
    }
  }, {
    key: "getScrollbarWidth",
    value: function getScrollbarWidth() {
      // Returns the size of the browser scrollbars in pixels
      // May be 0 for browsers that hide scrollbars when not in use
      if (Util._scrollbarWidth !== null) {
        return Util._scrollbarWidth;
      }
      sefariaJquery("body").append('<div id="scrollbarTestA" style="display:none;overflow:scroll">' + '<div id="scrollbarTestB"></div>' + '</div>');
      Util._scrollbarWidth = sefariaJquery("#scrollbarTestA").width() - sefariaJquery("#scrollbarTestB").width();
      sefariaJquery("#scrollbarTestA").remove();
      return Util._scrollbarWidth;
    }
  }, {
    key: "subscribeToAnnouncementsList",
    value: function subscribeToAnnouncementsList(email) {}
  }, {
    key: "RefValidator",
    value: function RefValidator($input, $msg, $ok, $preview) {
      var _this3 = this;
      var options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};
      /** Replacement for utils.js:sjs.checkref that uses only new tools.
       * Instantiated as an object, and then invoked with `check` method
       * $input - input element
       * $msg - status message element
       * $ok - Ok button element
       * $preview - Text preview box (optional)
       * config - a dictionary, with named arguments:
           * disallow_segments - if true, only allows book and section level refs.
                              By default, allows section and segment level references.
           * allow_new_titles = if true, allows names not recognized by the system.
                                By default, does not allow unrecognized names.
        * example usage:
        new Sefaria.util.RefValidator($("#inlineAdd"), $("#inlineAddDialogTitle"), $("#inlineAddSourceOK"), $("#preview"));
        The object is instantiated, and sets up its own events.
       It doesn't need to be interacted with from the outside.
       */

      this.$input = $input;
      this.$msg = $msg;
      this.$ok = $ok;
      this.$preview = $preview;
      this.options = options;

      // We want completion messages to be somewhat sticky.
      // This records the string used to build the current message.
      this.completion_message_base = undefined;
      // And the current message
      this.completion_message = "";
      this.current_lookup_ajax = null;
      this.dropdownAnchorSide = this.options.interfaceLang == "he" ? "right" : "left";
      this.$input.on("input", this.check.bind(this)).keyup(function (e) {
        if (e.keyCode == 13) {
          if (!this.$ok.hasClass('disabled')) {
            this.$ok.trigger("click");
          }
        }
      }.bind(this)).autocomplete({
        source: function source(request, response) {
          sefaria.getName(request.term, true).then(function (d) {
            return d.completions;
          }).then(response);
        },
        position: {
          my: this.dropdownAnchorSide + " top",
          at: this.dropdownAnchorSide + " bottom"
        },
        select: function select(event, ui) {
          return _this3._lookupAndRoute(ui.item.value);
        },
        minLength: 3,
        focus: function focus(event, ui) {
          sefariaJquery(".ui-menu-item.ui-state-focus").removeClass("ui-state-focus");
          sefariaJquery("a.ui-state-focus").parent().addClass("ui-state-focus");
        }
      });
    }
  }]);
  return Util;
}();
Util.RefValidator.prototype = {
  _sectionListString: function _sectionListString(arr, lang) {
    //Put together an "A, B, and C" type string from [A,B,C]
    //arr - array of strings
    if (arr.length == 1) return arr[0]; // One alone
    var lastTwo = arr.slice(-2).join(lang == "en" ? " and " : " ו"); // and together last two:
    return arr.slice(0, -2).concat(lastTwo).join(", "); // join the rest with a ,
  },

  //Too simple to merit a function, but function calls are cheap!
  _addressListString: function _addressListString(arr, lang) {
    //Put together an "A:B:C" type string from [A,B,C]
    //arr - array of strings
    return arr.join(lang == "en" ? ":" : " ");
  },
  _getCompletionMessage: function _getCompletionMessage(inString, data, depthUp) {
    // instring - the originally entered string
    // data - data returned from api/names
    // depthUp: 0 for segment.  1 for section.
    if (!data["sectionNames"] || data["sectionNames"].length == 0) return;
    var lang = data["lang"];
    var sectionNames = lang == "en" ? data["sectionNames"] : data["heSectionNames"];
    var addressExamples = lang == "en" ? data["addressExamples"] : data["heAddressExamples"];
    var current = data["sections"].length;
    var sectionListString = this._sectionListString(sectionNames.slice(current, depthUp ? -depthUp : undefined), lang);
    var addressListString = this._addressListString(addressExamples.slice(current, depthUp ? -depthUp : undefined), lang);
    var separator = lang == "en" && !data["is_node"] ? ":" : " ";
    var exampleRef = inString + separator + addressListString;
    return lang == "en" ? "Enter a " + sectionListString + ". E.g: '<b>" + exampleRef + "</b>'" : "הקלידו " + sectionListString + ". לדוגמא " + exampleRef;
  },
  _getSegmentCompletionMessage: function _getSegmentCompletionMessage(inString, data) {
    return this._getCompletionMessage(inString, data, 0);
  },
  _getSectionCompletionMessage: function _getSectionCompletionMessage(inString, data) {
    return this._getCompletionMessage(inString, data, 1);
  },
  _getMessage: function _getMessage(inString, data) {
    // If current string contains string used for last message, and itself isn't a new state, use current message.
    if (inString.indexOf(this.completion_message_base) == 0 && !data["is_ref"]) {
      return this.completion_message;
    }
    var return_message = "";
    var prompt_message = data["lang"] == "en" ? "Select a text" : "נא בחרו טקסט";
    var create_new_message = data["lang"] == "en" ? "Create a new Index record" : "צור טקסט חדש";
    var success_message = data["lang"] == "en" ? "OK. Click <b>add</b> to continue" : "לחצו " + "<b>הוסף</b>" + " בכדי להמשיך";
    var no_segment_message = "Segment Level References Not Allowed Here.";
    var or_phrase = data["lang"] == "en" ? " or " : " או ";
    var range_phrase = data["lang"] == "en" ? "enter a range.  E.g. " : "הוסיפו טווח. לדוגמא ";
    if (!data["is_ref"] && this.options.allow_new_titles) {
      return_message = create_new_message + or_phrase + prompt_message;
    } else if (data["is_node"] || data["is_ref"] && !(data["is_segment"] || data["is_section"])) {
      return_message = this._getSectionCompletionMessage(inString, data) || prompt_message;
    } else if (data["is_section"]) {
      if (this.options.disallow_segments) {
        return_message = success_message;
      } else {
        return_message = success_message + or_phrase + this._getSegmentCompletionMessage(inString, data);
      }
    } else if (data["is_segment"] && this.options.disallow_segments) {
      return_message = no_segment_message;
    } else if (data["is_segment"] && !data["is_range"] && +data["sections"].slice(-1) > 0) {
      // check that it's an int
      var range_end = +data["sections"].slice(-1) + 1;
      return_message = success_message + or_phrase + range_phrase + "<b>" + inString + "-" + range_end + "</b>";
    } else if (data["is_segment"]) {
      return_message = success_message + ".";
    } else {
      return_message = prompt_message;
    }
    this.completion_message_base = inString;
    this.completion_message = return_message;
    return return_message;
  },
  _lookupAndRoute: function _lookupAndRoute(inString) {
    var _this4 = this;
    if (this.current_lookup_ajax) {
      this.current_lookup_ajax.cancel();
    }
    this.current_lookup_ajax = sefaria.makeCancelable(sefaria.getName(inString, true));
    this.current_lookup_ajax.promise.then(function (data) {
      // If this query has been outpaced by typing, just return.
      if (_this4.$input.val() != inString) {
        _this4.current_lookup_ajax = null;
        return;
      }

      // If the query isn't recognized as a ref, but only for reasons of capitalization. Resubmit with recognizable caps.
      if (sefaria.isACaseVariant(inString, data)) {
        _this4._lookupAndRoute(sefaria.repairCaseVariant(inString, data));
        _this4.current_lookup_ajax = null;
        return;
      }
      _this4.$msg.css("direction", data["lang"] == "he" ? "rtl" : "ltr").html(_this4._getMessage(inString, data));
      if (!data.is_ref && _this4.options.allow_new_titles) {
        _this4._allow(inString);
        _this4.current_lookup_ajax = null;
        return;
      }
      if (data.is_ref && (data.is_section || data.is_segment && !_this4.options.disallow_segments)) {
        _this4._allow(inString, data["ref"]); //pass normalized ref
        _this4.current_lookup_ajax = null;
        return;
      }
      _this4._disallow();
      _this4.current_lookup_ajax = null;
    });
  },
  _allow: function _allow(inString, ref) {
    if (inString != this.$input.val()) {
      // Ref was corrected (likely for capitalization)
      this.$input.val(inString);
    }
    this.$ok.removeClass("inactive").removeClass("disabled");
    if (ref) {
      this.$input.autocomplete("disable");
      this._inlineAddSourcePreview(inString, ref);
    }
  },
  _disallow: function _disallow() {
    this.$ok.addClass("inactive").addClass("disabled");
  },
  _preview_segment_mapper: function _preview_segment_mapper(lang, s) {
    return s[lang] ? "<div class='previewLine'><span class='previewNumber'>(" + s.number + ")</span> " + s[lang] + "</div> " : "";
  },
  _inlineAddSourcePreview: function _inlineAddSourcePreview(inString, ref) {
    sefaria.text(ref, {}, function (data) {
      if (this.$input.val() != inString) {
        return;
      }
      if (!this.$preview) {
        return;
      }
      var segments = sefaria.makeSegments(data);
      segments = sefaria.stripImagesFromSegments(segments);
      var en = segments.map(this._preview_segment_mapper.bind(this, "en")).filter(Boolean);
      var he = segments.map(this._preview_segment_mapper.bind(this, "he")).filter(Boolean);

      // Handle missing text cases
      var path = parseURL(document.URL).path;
      if (!en.length && !he.length) {
        this.$msg.html("<i>No text available. Click below to add this text.</i>");
      }

      // Set it on the DOM
      this.$input.autocomplete("disable");
      this.$preview.show();
      this.$preview.html("<div class='en'>" + en.join("") + "</div>" + "<div class='he'>" + he.join("") + "</div>");
      this.$preview.position({
        my: this.dropdownAnchorSide + " top",
        at: this.dropdownAnchorSide + " bottom",
        of: this.$input,
        collision: "none"
      }).width('691px');
    }.bind(this));
  },
  check: function check() {
    if (this.$preview) {
      this.$preview.html("");
      this.$preview.hide();
    }
    this.$input.autocomplete("enable");
    var inString = this.$input.val();
    if (inString.length < 3) {
      this._disallow();
      return;
    }
    this._lookupAndRoute(inString);
  }
};
var secsInDay = 24 * 60 * 60;
Util._cookies = {};
Util._scrollbarWidth = null;
Util.sefariaHumanizeDuration = external_humanize_duration_default().humanizer({
  units: ['y', 'mo', 'w', 'd', 'h', 'm', 's'],
  largest: 1,
  round: true,
  unitMeasures: {
    y: 365 * secsInDay,
    mo: 30 * secsInDay,
    w: 7 * secsInDay,
    d: secsInDay,
    h: 60 * 60,
    m: 60,
    s: 1
  },
  languages: {
    shortEn: {
      y: function y() {
        return "y";
      },
      mo: function mo() {
        return "mo";
      },
      w: function w() {
        return "w";
      },
      d: function d() {
        return "d";
      },
      h: function h() {
        return "h";
      },
      m: function m() {
        return "m";
      },
      s: function s() {
        return "s";
      },
      ms: function ms() {
        return "ms";
      }
    },
    shortHe: {
      y: function y() {
        return "ש'";
      },
      mo: function mo() {
        return "ח'";
      },
      w: function w() {
        return "שב'";
      },
      d: function d() {
        return "י'";
      },
      h: function h() {
        return "שע'";
      },
      m: function m() {
        return "דק'";
      },
      s: function s() {
        return "שנ'";
      },
      ms: function ms() {
        return "מלש'";
      }
    }
  }
});
/* harmony default export */ const util = (Util);
;// CONCATENATED MODULE: ../static/js/sefaria/searchState.js
function searchState_slicedToArray(arr, i) { return searchState_arrayWithHoles(arr) || searchState_iterableToArrayLimit(arr, i) || searchState_unsupportedIterableToArray(arr, i) || searchState_nonIterableRest(); }
function searchState_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function searchState_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function searchState_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function searchState_typeof(obj) { "@babel/helpers - typeof"; return searchState_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, searchState_typeof(obj); }
function searchState_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = searchState_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function searchState_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return searchState_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return searchState_arrayLikeToArray(o, minLen); }
function searchState_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function searchState_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function searchState_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, searchState_toPropertyKey(descriptor.key), descriptor); } }
function searchState_createClass(Constructor, protoProps, staticProps) { if (protoProps) searchState_defineProperties(Constructor.prototype, protoProps); if (staticProps) searchState_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function searchState_toPropertyKey(arg) { var key = searchState_toPrimitive(arg, "string"); return searchState_typeof(key) === "symbol" ? key : String(key); }
function searchState_toPrimitive(input, hint) { if (searchState_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (searchState_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var SearchState = /*#__PURE__*/function () {
  function SearchState() {
    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      type = _ref.type,
      appliedFilters = _ref.appliedFilters,
      appliedFilterAggTypes = _ref.appliedFilterAggTypes,
      availableFilters = _ref.availableFilters,
      filterRegistry = _ref.filterRegistry,
      filtersValid = _ref.filtersValid,
      orphanFilters = _ref.orphanFilters,
      fieldExact = _ref.fieldExact,
      fieldBroad = _ref.fieldBroad,
      field = _ref.field,
      sortType = _ref.sortType;
    searchState_classCallCheck(this, SearchState);
    this.type = type; // always required
    this.appliedFilters = appliedFilters || [];
    this.appliedFilterAggTypes = appliedFilterAggTypes || [];
    this.availableFilters = typeof availableFilters === 'undefined' ? [] : availableFilters.map(function (f) {
      return f instanceof sefaria_FilterNode ? f : new sefaria_FilterNode(f);
    });
    this.filterRegistry = typeof filterRegistry !== "undefined" ? filterRegistry : this._recreateRegistry(this.availableFilters);
    this.filtersValid = filtersValid || false;
    this.orphanFilters = orphanFilters || [];
    this.fieldExact = fieldExact || SearchState.metadataByType[type].fieldExact;
    this.fieldBroad = fieldBroad || SearchState.metadataByType[type].fieldBroad;
    this.field = field || SearchState.metadataByType[type].field;
    this.sortType = sortType || SearchState.metadataByType[type].sortType;
  }
  searchState_createClass(SearchState, [{
    key: "_recreateRegistry",
    value: function _recreateRegistry(filters) {
      var registry = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      var _iterator = searchState_createForOfIteratorHelper(filters),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var f = _step.value;
          registry[f.aggKey] = f;
          registry = this._recreateRegistry(f.children, registry);
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return registry;
    }
  }, {
    key: "clone",
    value: function clone(prepareForSerialization) {
      var clonedAvailableFilters = util.clone(this.availableFilters, prepareForSerialization);
      return new SearchState({
        appliedFilters: util.clone(this.appliedFilters, prepareForSerialization),
        appliedFilterAggTypes: util.clone(this.appliedFilterAggTypes, prepareForSerialization),
        availableFilters: clonedAvailableFilters,
        filtersValid: this.filtersValid,
        orphanFilters: this.orphanFilters,
        type: this.type,
        fieldExact: this.fieldExact,
        fieldBroad: this.fieldBroad,
        field: this.field,
        sortType: this.sortType
      });
    }
  }, {
    key: "update",
    value: function update(_ref2) {
      var type = _ref2.type,
        appliedFilters = _ref2.appliedFilters,
        appliedFilterAggTypes = _ref2.appliedFilterAggTypes,
        availableFilters = _ref2.availableFilters,
        filterRegistry = _ref2.filterRegistry,
        filtersValid = _ref2.filtersValid,
        orphanFilters = _ref2.orphanFilters,
        fieldExact = _ref2.fieldExact,
        fieldBroad = _ref2.fieldBroad,
        field = _ref2.field,
        sortType = _ref2.sortType,
        aggregationsToUpdate = _ref2.aggregationsToUpdate;
      type = typeof type === 'undefined' ? this.type : type;
      appliedFilters = typeof appliedFilters === 'undefined' ? this.appliedFilters : appliedFilters;
      appliedFilterAggTypes = typeof appliedFilterAggTypes === 'undefined' ? this.appliedFilterAggTypes : appliedFilterAggTypes;
      filtersValid = typeof filtersValid === 'undefined' ? this.filtersValid : filtersValid;
      orphanFilters = typeof orphanFilters === 'undefined' ? this.orphanFilters : orphanFilters;
      fieldExact = typeof fieldExact === 'undefined' ? this.fieldExact : fieldExact;
      fieldBroad = typeof fieldBroad === 'undefined' ? this.fieldBroad : fieldBroad;
      field = typeof field === 'undefined' ? this.field : field;
      sortType = typeof sortType === 'undefined' ? this.sortType : sortType;
      var tempAvailableFilters = availableFilters;
      var tempFilterRegistry = typeof filterRegistry === 'undefined' ? this.filterRegistry : filterRegistry;
      if (!!aggregationsToUpdate && this.filtersValid) {
        if (typeof tempAvailableFilters !== 'undefined') {
          availableFilters = this.availableFilters.filter(function (f) {
            return aggregationsToUpdate.indexOf(f.aggType) === -1;
          }).concat(availableFilters);
          filterRegistry = this.filterRegistry;
        }
      } else {
        availableFilters = typeof tempAvailableFilters === 'undefined' ? this.availableFilters : tempAvailableFilters;
        filterRegistry = tempFilterRegistry;
      }
      return new SearchState({
        type: type,
        appliedFilters: appliedFilters,
        appliedFilterAggTypes: appliedFilterAggTypes,
        availableFilters: availableFilters,
        filterRegistry: filterRegistry,
        filtersValid: filtersValid,
        orphanFilters: orphanFilters,
        fieldExact: fieldExact,
        fieldBroad: fieldBroad,
        field: field,
        sortType: sortType
      });
    }
  }, {
    key: "isEqual",
    value: function isEqual(_ref3) {
      var _this = this;
      var other = _ref3.other,
        fields = _ref3.fields;
      if (!(other instanceof SearchState)) {
        return false;
      }
      var _iterator2 = searchState_createForOfIteratorHelper(fields),
        _step2;
      try {
        var _loop = function _loop() {
          var field = _step2.value;
          var thisField = _this[field];
          var otherField = other[field];
          if (thisField instanceof Array) {
            if (!(otherField instanceof Array)) {
              return {
                v: false
              };
            }
            if (thisField.length !== otherField.length) {
              return {
                v: false
              };
            }
            if (!thisField.every(function (v, i) {
              return v === otherField[i];
            })) {
              return {
                v: false
              };
            }
          } else {
            if (thisField !== otherField) {
              return {
                v: false
              };
            }
          }
        };
        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
          var _ret = _loop();
          if (searchState_typeof(_ret) === "object") return _ret.v;
        }
      } catch (err) {
        _iterator2.e(err);
      } finally {
        _iterator2.f();
      }
      return true;
    }
  }, {
    key: "makeURL",
    value: function makeURL(_ref4) {
      var _this2 = this;
      var prefix = _ref4.prefix,
        isStart = _ref4.isStart;
      // prefix: string prepended to every parameter. meant to distinguish between different types
      //         of searchState URL parameters (e.g. sheet and text)
      //         oneOf({'t': 'text', 's': sheet, 'c': collection, 'u': user})
      var aggTypes = SearchState.metadataByType[this.type].aggregation_field_array;
      var aggTypesSuffixes = SearchState.metadataByType[this.type].aggregation_field_lang_suffix_array;
      var aggTypesWithSuffixes = [];
      Sefaria.util // 
      .zip(aggTypes, aggTypesSuffixes).map(function (_ref5) {
        var _ref6 = searchState_slicedToArray(_ref5, 2),
          agg = _ref6[0],
          suffixMap = _ref6[1];
        if (suffixMap) {
          Object.values(suffixMap).map(function (suffix) {
            aggTypesWithSuffixes.push(agg + suffix);
          });
        } else {
          aggTypesWithSuffixes.push(agg);
        }
      });
      var url = aggTypesWithSuffixes.reduce(function (accum, aggType) {
        var aggTypeFilters = aggTypes.length > 1 ? util.zip(_this2.appliedFilters, _this2.appliedFilterAggTypes).filter(function (f) {
          return f[1] === aggType;
        }).map(function (x) {
          return x[0];
        }) : _this2.appliedFilters;
        return accum + (aggTypeFilters.length > 0 ? "&".concat(prefix).concat(aggType, "Filters=").concat(aggTypeFilters.map(function (f) {
          return encodeURIComponent(f);
        }).join('|')) : '');
      }, '') + "&".concat(prefix, "var=") + (this.field !== this.fieldExact ? '1' : '0') + "&".concat(prefix, "sort=").concat(this.sortType);
      if (isStart) {
        url.replace(/&/, '?');
      }
      return url;
    }
  }]);
  return SearchState;
}();
SearchState.metadataByType = {
  text: {
    fieldExact: 'exact',
    fieldBroad: 'naive_lemmatizer',
    field: 'naive_lemmatizer',
    aggregation_field_array: ['path'],
    aggregation_field_lang_suffix_array: [null],
    build_and_apply_filters: 'buildAndApplyTextFilters',
    // func name from Search.js
    sortType: 'relevance',
    sortTypeArray: [
    // this array defines the sort options available for each search type
    {
      type: 'relevance',
      name: 'Relevance',
      heName: 'רלוונטיות',
      fieldArray: ['pagesheetrank'],
      sort_method: 'score',
      // if sort_method == 'score', it will combine the standard elasticsearch score with `field`
      score_missing: 0.04 // this default value comes from the equation used to calculate pagesheetrank. see search.py where this field is created
    }, {
      type: 'chronological',
      name: 'Chronological',
      heName: 'כרונולוגי',
      fieldArray: ['comp_date', 'order'],
      // if sort_method == 'sort', then we need to define fieldArray, which is a list of fields we want to sort on
      sort_method: 'sort',
      direction: 'asc'
    }]
  },
  sheet: {
    fieldExact: null,
    fieldBroad: null,
    field: 'content',
    aggregation_field_array: ['collections', 'topics'],
    aggregation_field_lang_suffix_array: [null, {
      'english': '_en',
      'hebrew': '_he'
    }],
    build_and_apply_filters: 'buildAndApplySheetFilters',
    // func name from Search.js
    sortType: 'relevance',
    sortTypeArray: [{
      type: 'relevance',
      name: 'Relevance',
      heName: 'רלוונטיות',
      fieldArray: [],
      sort_method: 'score'
    }, {
      type: 'dateCreated',
      name: 'Date Created',
      heName: 'תאריך',
      fieldArray: ['dateCreated'],
      sort_method: 'sort',
      direction: 'desc'
    }, {
      type: 'views',
      name: 'Views',
      heName: 'צפיות',
      fieldArray: ['views'],
      sort_method: 'sort',
      direction: 'desc'
    }]
  }
};
/* harmony default export */ const sefaria_searchState = (SearchState);
;// CONCATENATED MODULE: ../static/js/sefaria/search.js
function search_typeof(obj) { "@babel/helpers - typeof"; return search_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, search_typeof(obj); }
function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || search_unsupportedIterableToArray(arr) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return search_arrayLikeToArray(arr); }
function search_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = search_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function search_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return search_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return search_arrayLikeToArray(o, minLen); }
function search_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function search_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function search_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, search_toPropertyKey(descriptor.key), descriptor); } }
function search_createClass(Constructor, protoProps, staticProps) { if (protoProps) search_defineProperties(Constructor.prototype, protoProps); if (staticProps) search_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function search_toPropertyKey(arg) { var key = search_toPrimitive(arg, "string"); return search_typeof(key) === "symbol" ? key : String(key); }
function search_toPrimitive(input, hint) { if (search_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (search_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }




var Search = /*#__PURE__*/function () {
  function Search(searchIndexText, searchIndexSheet) {
    search_classCallCheck(this, Search);
    this.searchIndexText = searchIndexText;
    this.searchIndexSheet = searchIndexSheet;
    this._cache = {};
    this.sefariaQueryQueue = {
      hits: {
        hits: [],
        total: 0,
        max_score: 0.0
      },
      lastSeen: -1
    };
    this.dictaQueryQueue = {
      lastSeen: -1,
      hits: {
        total: 0,
        hits: []
      }
    };
    this.queryDictaFlag = true;
    this.dictaCounts = null;
    this.sefariaSheetsResult = null;
    this.buckets = [];
    this.queryAborter = new HackyQueryAborter();
    this.dictaSearchUrl = 'https://sefaria.loadbalancer.dicta.org.il';
  }
  search_createClass(Search, [{
    key: "cache",
    value: function cache(key, result) {
      if (result !== undefined) {
        this._cache[key] = result;
      }
      if (!this._cache[key]) {
        //console.log("Cache miss");
        //console.log(key);
      }
      return this._cache[key];
    }
  }, {
    key: "sefariaQuery",
    value: function sefariaQuery(args, isQueryStart, wrapper) {
      var _this = this;
      return new Promise(function (resolve, reject) {
        var jsonData = _this.sortedJSON(_this.get_query_object(args));
        var cacheKey = "sefariaQuery|" + jsonData;
        var cacheResult = _this.cache(cacheKey);
        if (cacheResult) {
          resolve(cacheResult);
          return null;
        }
        wrapper.addQuery(sefariaJquery.ajax({
          url: "".concat(Sefaria.apiHost, "/api/search-wrapper"),
          type: 'POST',
          data: jsonData,
          contentType: "application/json; charset=utf-8",
          crossDomain: true,
          processData: false,
          dataType: 'json',
          success: function success(data) {
            _this.cache(cacheKey, data);
            resolve(data);
          },
          error: reject
        }));
      }).then(function (x) {
        if (args.type === "sheet") {
          _this.sefariaSheetsResult = x;
          return null;
        }
        for (var i = 0; i < x.hits.hits.length; i++) {
          x.hits.hits[i]['comp_date'] = x.hits.hits[i]._source.comp_date;
          x.hits.hits[i]['cameFrom'] = 'Sefaria';
          x.hits.hits[i]['score'] = x.hits.hits[i]['_score'] * -1;
        }
        var mergedHits = _this.sefariaQueryQueue.hits.hits.concat(x.hits.hits);
        var lastSeen = _this.sefariaQueryQueue.lastSeen + x.hits.hits.length;
        _this.sefariaQueryQueue = x;
        _this.sefariaQueryQueue.hits.hits = mergedHits;
        _this.sefariaQueryQueue.lastSeen = lastSeen;
      });
    }
    /**
     * Function to reformat the Hebrew Ref from the Dicta convention - תנ״ר/נביאים/ספר זכריה/פרק א/פסוק א
     * to the Sefaria Hebrew Ref convention (the results of Ref('Zechariah 1.1').he_normal())
     * @param {*} ref - the incoming Dicta Ref
     * @returns cleanedHebrewRef - according to Sefaria conventions
     */
  }, {
    key: "reformatDictaRef",
    value: function reformatDictaRef(ref) {
      var hebrewRef = ref.match(/תנ"ך\/.*\/ספר (.*)\/פרק (.*)\/פסוק (.*)/);
      var sefer = hebrewRef[1];
      var perek = hebrewRef[2].length === 1 ? "".concat(hebrewRef[2], "'") : hebrewRef[2].split('').join('"');
      var pasuk = hebrewRef[3].length === 1 ? "".concat(hebrewRef[3], "'") : hebrewRef[3].split('').join('"');
      var cleanedHebrewRef = "".concat(sefer, " ").concat(perek, ":").concat(pasuk);
      return cleanedHebrewRef;
    }
  }, {
    key: "dictaQuery",
    value: function dictaQuery(args, isQueryStart, wrapper) {
      var _this2 = this;
      function ammendArgsForDicta(standardArgs, lastSeen) {
        var filters = standardArgs.applied_filters ? standardArgs.applied_filters.map(function (book) {
          book = book.replace(/\//g, '.');
          return book.replace(/ /g, '_');
        }) : false;
        return {
          query: standardArgs.query,
          from: 'start' in standardArgs ? lastSeen + 1 : 0,
          size: standardArgs.size,
          limitedToBooks: filters,
          sort: standardArgs.sort_type === "relevance" ? 'pagerank' : 'corpus_order_path',
          smallUnitsOnly: true
        };
      }
      return new Promise(function (resolve, reject) {
        if (_this2.queryDictaFlag && args.type === "text") {
          if (_this2.dictaQueryQueue.lastSeen + 1 >= _this2.dictaQueryQueue.hits.total && 'start' in args && args['start'] > 0) {
            /* don't make new queries if results are exhausted.
             * 'start' is omitted on first query (defaults to 0). On a first query, we'll always want to query.
             */
            resolve({
              total: _this2.dictaQueryQueue.hits.total,
              hits: []
            });
          } else {
            var jsonData = _this2.sortedJSON(ammendArgsForDicta(args, _this2.dictaQueryQueue.lastSeen));
            var cacheKey = "dictaQuery|" + jsonData;
            var cacheResult = _this2.cache(cacheKey);
            if (cacheResult) {
              resolve(cacheResult);
              return null;
            }
            wrapper.addQuery(sefariaJquery.ajax({
              url: "".concat(_this2.dictaSearchUrl, "/search"),
              type: 'POST',
              dataType: 'json',
              contentType: 'application/json; charset=UTF-8',
              data: jsonData,
              success: function success(data) {
                _this2.cache(cacheKey, data);
                resolve(data);
              },
              error: reject
            }));
          }
        } else {
          resolve({
            total: 0,
            hits: []
          });
        }
      }).then(function (x) {
        if (args.type === "sheet") {
          return null;
        }
        var adaptedHits = [];
        x.hits.forEach(function (hit) {
          var bookData = hit.xmlId.split(".");
          var categories = bookData.slice(0, 2);
          var bookTitle = bookData[2].replace(/_/g, ' ');
          var bookLoc = bookData.slice(3, 5).join(':');
          var version = "Tanach with Ta'amei Hamikra";
          adaptedHits.push({
            _source: {
              type: 'text',
              lang: "he",
              version: version,
              path: categories,
              ref: "".concat(bookTitle, " ").concat(bookLoc),
              heRef: _this2.reformatDictaRef(hit.hebrewPath),
              pagesheetrank: hit.pagerank ? hit.pagerank : 0
            },
            highlight: {
              naive_lemmatizer: [hit.highlight[0].text]
            },
            score: hit.pagerank ? hit.pagerank * -1 : 0,
            comp_date: -10000 + adaptedHits.length,
            _id: "".concat(bookTitle, " ").concat(bookLoc, " (").concat(version, " [he])"),
            cameFrom: 'dicta'
          });
        });
        _this2.dictaQueryQueue = {
          hits: {
            total: x.total,
            hits: adaptedHits
          },
          lastSeen: 'start' in args ? _this2.dictaQueryQueue.lastSeen + adaptedHits.length : adaptedHits.length - 1
        };
      })["catch"](function (x) {
        console.log(x);
      });
    }
  }, {
    key: "dictaBooksQuery",
    value: function dictaBooksQuery(args, wrapper) {
      var _this3 = this;
      return new Promise(function (resolve, reject) {
        if (_this3.dictaCounts === null && args.type === "text") {
          if (_this3.queryDictaFlag) {
            var jsonData = _this3.sortedJSON({
              query: args.query,
              smallUnitsOnly: true
            });
            var cacheKey = "dictaBooksQuery|" + jsonData;
            var cacheResult = _this3.cache(cacheKey);
            if (cacheResult) {
              resolve(cacheResult);
              return null;
            }
            wrapper.addQuery(sefariaJquery.ajax({
              url: "".concat(_this3.dictaSearchUrl, "/books"),
              type: 'POST',
              dataType: 'json',
              contentType: "application/json;charset=UTF-8",
              data: jsonData,
              timeout: 3000,
              success: function success(data) {
                _this3.cache(cacheKey, data);
                resolve(data);
              },
              error: reject
            }));
          } else {
            resolve([]);
          }
        } else {
          resolve(null);
        }
      }).then(function (x) {
        if (x === null) return;
        var buckets = [];
        x.forEach(function (bucket) {
          buckets.push({
            key: bucket['englishBookName'].map(function (i) {
              return i.replace(/_/g, " ");
            }).join('/'),
            doc_count: bucket['count']
          });
        });
        _this3.dictaCounts = buckets;
      }, function (x) {
        _this3.queryDictaFlag = false;
        console.log(x);
      });
    }
  }, {
    key: "isDictaQuery",
    value: function isDictaQuery(args) {
      return Sefaria.hebrew.isHebrew(args.query) && !args.exact;
    }
  }, {
    key: "sortedJSON",
    value: function sortedJSON(obj) {
      // Returns JSON with keys sorted consistently, suitable for a cache key
      return JSON.stringify(obj, Object.keys(obj).sort());
    }
  }, {
    key: "mergeQueries",
    value: function mergeQueries(addAggregations, sortType, filters) {
      var result = {
        hits: {}
      };
      if (addAggregations) {
        var newBuckets = this.sefariaQueryQueue['aggregations']['path']['buckets'].filter(function (x) {
          return !RegExp(/^Tanakh\//).test(x.key);
        });
        newBuckets = newBuckets.concat(this.dictaCounts);
        result.aggregations = {
          path: {
            buckets: newBuckets
          }
        };
        this.buckets = newBuckets;
      }
      if (!!filters.length) {
        var expression = new RegExp("^(".concat(filters.join('|'), ")(/.*|$)"));
        result.hits.total = this.buckets.reduce(function (total, currentBook) {
          if (expression.test(currentBook.key)) {
            total += currentBook.doc_count;
          }
          return total;
        }, 0);
      } else {
        result.hits.total = this.sefariaQueryQueue.hits.total + this.dictaQueryQueue.hits.total;
      }
      var sefariaHits = this.queryDictaFlag ? this.sefariaQueryQueue.hits.hits.filter(function (i) {
        return !i._source.categories.includes("Tanakh");
      }) : this.sefariaQueryQueue.hits.hits;
      var dictaHits = this.dictaQueryQueue.hits.hits;
      var finalHits;
      if (!dictaHits.length || !sefariaHits.length) /* either or both queues are empty */{
          finalHits = dictaHits.concat(sefariaHits).sort(function (i, j) {
            return i[sortType] - j[sortType];
          });
          this.sefariaQueryQueue.hits.hits = [];
          this.dictaQueryQueue.hits.hits = [];
        } else {
        // when sorting by relevance adjust Dicta score's mean and standard deviation to match Sefaria's
        if (sortType === "score") {
          var sefariaMeanScore = sefariaHits.reduce(function (total, nextValue) {
            return total + nextValue.score / sefariaHits.length;
          }, 0);
          var dictaMeanScore = dictaHits.reduce(function (total, nextValue) {
            return total + nextValue.score / sefariaHits.length;
          }, 0);
          var sefariaStd = Math.sqrt(sefariaHits.reduce(function (total, nextValue) {
            return total + Math.pow(nextValue.score - sefariaMeanScore, 2);
          }, 0));
          var dictaStd = Math.sqrt(dictaHits.reduce(function (total, nextValue) {
            return total + Math.pow(nextValue.score - dictaMeanScore, 2);
          }, 0));
          var factor = dictaStd !== 0 ? sefariaStd / dictaStd : 1;
          for (var i = 0; i < dictaHits.length; i++) {
            dictaHits[i].score = dictaHits[i].score * factor;
          }
          dictaMeanScore = dictaHits.reduce(function (total, nextValue) {
            return total + nextValue.score / sefariaHits.length;
          }, 0);
          var delta = sefariaMeanScore - dictaMeanScore;
          for (var _i = 0; _i < dictaHits.length; _i++) {
            dictaHits[_i].score = dictaHits[_i].score + delta;
          }
        }
        finalHits = dictaHits.concat(sefariaHits).sort(function (i, j) {
          return i[sortType] - j[sortType];
        });
      }
      result.hits.hits = finalHits;
      return result;
    }
  }, {
    key: "execute_query",
    value: function execute_query(args) {
      var _this4 = this;
      /* args can contain
       query: query string
       size: size of result set
       start: from what result to start
       type: "sheet" or "text"
       applied_filters: filter query by these filters
       appliedFilterAggTypes: array of same len as applied_filters giving aggType for each filter
       aggregationsToUpdate
       field: field to query in elastic_search
       sort_type: See SearchState.metadataByType for possible sort types
       exact: if query is exact
       success: callback on success
       error: callback on error
       */
      if (!args.query) {
        return;
      }
      //console.log("*** ", args.query);
      var isQueryStart = !args.start;
      if (isQueryStart)
        // don't touch these parameters if not a text search
        {
          if (args.type === 'text') {
            this.dictaCounts = null;
            this.queryDictaFlag = this.isDictaQuery(args);
            this.sefariaQueryQueue = {
              hits: {
                hits: [],
                total: 0,
                max_score: 0.0
              },
              lastSeen: -1
            };
            this.dictaQueryQueue = {
              lastSeen: -1,
              hits: {
                total: 0,
                hits: []
              }
            };
            this.queryAborter.abort();
          }
        }
      var queryAborter = new HackyQueryAborter();
      this.queryAborter = queryAborter;
      var updateAggreagations = args.aggregationsToUpdate.length > 0;
      if (this.queryDictaFlag) {
        Promise.all([this.sefariaQuery(args, updateAggreagations, queryAborter), this.dictaQuery(args, updateAggreagations, queryAborter), this.dictaBooksQuery(args, queryAborter)]).then(function () {
          if (args.type === "sheet") {
            _this4._cacheQuery(args, _this4.sefariaSheetsResult);
            args.success(_this4.sefariaSheetsResult);
          } else {
            var sortType = args.sort_type === 'relevance' ? 'score' : 'comp_date';
            var mergedQueries = _this4.mergeQueries(updateAggreagations, sortType, args.applied_filters);
            var cacheResult = _this4.getCachedQuery(args);
            if (!cacheResult) {
              _this4._cacheQuery(args, mergedQueries);
              args.success(mergedQueries);
            } else {
              args.success(cacheResult);
            }
          }
        })["catch"](function (x) {
          return console.log(x);
        });
      } else {
        this.sefariaQuery(args, updateAggreagations, queryAborter).then(function () {
          if (args.type === "sheet") {
            _this4._cacheQuery(args, _this4.sefariaSheetsResult);
            args.success(_this4.sefariaSheetsResult);
          } else {
            _this4._cacheQuery(args, _this4.sefariaQueryQueue);
            args.success(_this4.sefariaQueryQueue);
          }
        });
      }
      return queryAborter;
    }
  }, {
    key: "get_query_object",
    value: function get_query_object(_ref) {
      var query = _ref.query,
        applied_filters = _ref.applied_filters,
        appliedFilterAggTypes = _ref.appliedFilterAggTypes,
        aggregationsToUpdate = _ref.aggregationsToUpdate,
        size = _ref.size,
        start = _ref.start,
        type = _ref.type,
        field = _ref.field,
        sort_type = _ref.sort_type,
        exact = _ref.exact;
      var _SearchState$metadata = sefaria_searchState.metadataByType[type],
        sortTypeArray = _SearchState$metadata.sortTypeArray,
        aggregation_field_array = _SearchState$metadata.aggregation_field_array;
      var _sortTypeArray$find = sortTypeArray.find(function (x) {
          return x.type === sort_type;
        }),
        sort_method = _sortTypeArray$find.sort_method,
        fieldArray = _sortTypeArray$find.fieldArray,
        score_missing = _sortTypeArray$find.score_missing,
        direction = _sortTypeArray$find.direction;
      return {
        type: type,
        query: query,
        field: field,
        source_proj: true,
        slop: exact ? 0 : 10,
        start: start,
        size: size,
        filters: applied_filters.length ? applied_filters : [],
        filter_fields: appliedFilterAggTypes,
        aggs: aggregationsToUpdate,
        sort_method: sort_method,
        sort_fields: fieldArray,
        sort_reverse: direction === "desc",
        sort_score_missing: score_missing
      };
    }
  }, {
    key: "mergeTextResultsVersions",
    value: function mergeTextResultsVersions(hits) {
      var newHits = [];
      var newHitsObj = {}; // map ref -> index in newHits
      var alreadySeenIds = {}; // for some reason there are duplicates in the `hits` array. This needs to be dealth with. This is a patch.
      var _iterator = search_createForOfIteratorHelper(hits),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var hit = _step.value;
          if (alreadySeenIds[hit._id]) {
            continue;
          }
          alreadySeenIds[hit._id] = true;
          var currRef = hit._source.ref;
          var newHitsIndex = newHitsObj[currRef];
          if (typeof newHitsIndex != "undefined") {
            newHits[newHitsIndex].push(hit);
          } else {
            newHits.push([hit]);
            newHitsObj[currRef] = newHits.length - 1;
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      newHits = newHits.map(function (hit_list) {
        if (hit_list.length === 1) {
          return hit_list[0];
        }
        var new_hit_list = hit_list.sort(function (a, b) {
          return a._source.version_priority - b._source.version_priority;
        });
        new_hit_list[0].duplicates = hit_list.slice(1);
        return new_hit_list[0];
      });
      return newHits;
    }
  }, {
    key: "getCachedQuery",
    value: function getCachedQuery(args) {
      var cacheKey = this._queryCacheKey(args);
      return this.cache(cacheKey);
    }
  }, {
    key: "_cacheQuery",
    value: function _cacheQuery(args, results) {
      var cacheKey = this._queryCacheKey(args);
      results = Sefaria.util.clone(results);
      this.cache(cacheKey, results);
    }
  }, {
    key: "_queryCacheKey",
    value: function _queryCacheKey(args) {
      return "query|" + this.sortedJSON(args);
    }
  }, {
    key: "buildFilterTree",
    value: function buildFilterTree(aggregation_buckets, appliedFilters) {
      var availableFilters = []; // List of root level FilterNode objects.
      var registry = {}; // Mappings of "/" separated category path strings to FilterNode objects

      // create combined list of filters with {aggKey, docCount, path}
      var filters = [].concat(_toConsumableArray(appliedFilters.map(function (fkey) {
        return {
          aggKey: fkey,
          docCount: 0,
          path: fkey.split("/")
        };
      })), _toConsumableArray(aggregation_buckets.map(function (f) {
        return {
          aggKey: f["key"],
          docCount: f["doc_count"],
          path: f["key"].split("/")
        };
      })));

      // Drop results that don't match our TOC.  This is needed for cases where the TOC updates, but the update hasn't gotten to the ES server yet.
      filters = filters.filter(function (x) {
        return Sefaria._tocOrderLookup[x.aggKey];
      });

      // sort into search toc tree order
      filters.sort(function (a, b) {
        return Sefaria.compareSearchCatPaths(a.aggKey, b.aggKey);
      });

      // Build trees of filters
      // Keep array of previous entry nodes
      var previousNodes = [];
      for (var i = 0; i < filters.length; i++) {
        var f = filters[i];
        var j = void 0; // index of first place where this filter differs from the previous
        for (j = 0; j < Math.min(previousNodes.length, f.path.length); j++) {
          if (previousNodes[j].title !== f.path[j]) {
            break;
          }
        }
        for (var k = j; k < f.path.length; k++) {
          var node = new sefaria_FilterNode({
            "title": f.path[k],
            "aggKey": f.path.slice(0, k + 1).join("/"),
            "heTitle": Sefaria.hebrewTerm(f.path[k]),
            "docCount": f.docCount ? f.docCount : 0
          });
          previousNodes[k] = node;
          if (k === 0) {
            availableFilters.push(node);
          } else {
            previousNodes[k - 1].append(node);
          }
          registry[node.aggKey] = node;
        }
        previousNodes = previousNodes.slice(0, f.path.length);
      }

      //sum doc counts
      availableFilters.forEach(function (n) {
        return n.sumDocs();
      });
      return {
        availableFilters: availableFilters,
        registry: registry
      };
    }
  }, {
    key: "applyFilters",
    value: function applyFilters(registry, appliedFilters) {
      var orphans = [];
      appliedFilters.forEach(function (aggKey) {
        var node = registry[aggKey];
        if (node) {
          node.setSelected(true);
        } else {
          orphans.push(aggKey);
        }
      });
      return orphans;
    }
  }, {
    key: "getAppliedSearchFilters",
    value: function getAppliedSearchFilters(availableFilters) {
      var appliedFilters = [];
      var appliedFilterAggTypes = [];
      //results = results.concat(this.orphanFilters);
      var _iterator2 = search_createForOfIteratorHelper(availableFilters),
        _step2;
      try {
        var _loop = function _loop() {
          var tempFilter = _step2.value;
          var tempApplied = tempFilter.getAppliedFilters();
          var tempAppliedTypes = tempApplied.map(function (x) {
            return tempFilter.aggType;
          }); // assume all child filters have the same type as their parent
          appliedFilters = appliedFilters.concat(tempApplied);
          appliedFilterAggTypes = appliedFilterAggTypes.concat(tempAppliedTypes);
        };
        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
          _loop();
        }
      } catch (err) {
        _iterator2.e(err);
      } finally {
        _iterator2.f();
      }
      return {
        appliedFilters: appliedFilters,
        appliedFilterAggTypes: appliedFilterAggTypes
      };
    }
  }, {
    key: "buildAndApplyTextFilters",
    value: function buildAndApplyTextFilters(aggregation_buckets, appliedFilters, appliedFilterAggTypes, aggType) {
      var _this$buildFilterTree = this.buildFilterTree(aggregation_buckets, appliedFilters),
        availableFilters = _this$buildFilterTree.availableFilters,
        registry = _this$buildFilterTree.registry;
      var orphans = this.applyFilters(registry, appliedFilters);
      return {
        availableFilters: availableFilters,
        registry: registry,
        orphans: orphans
      };
    }
  }, {
    key: "buildAndApplySheetFilters",
    value: function buildAndApplySheetFilters(aggregation_buckets, appliedFilters, appliedFilterAggTypes, aggType) {
      var availableFilters = aggregation_buckets.map(function (b) {
        var isHeb = Sefaria.hebrew.isHebrew(b.key);
        var enTitle = isHeb ? '' : b.key;
        var heTitle = isHeb ? b.key : aggType === 'collections' || !Sefaria.terms[b.key] ? '' : Sefaria.terms[b.key].he;
        var aggKey = enTitle || heTitle;
        var filterInd = appliedFilters.indexOf(aggKey);
        var isSelected = filterInd !== -1 && appliedFilterAggTypes[filterInd] === aggType;
        return new sefaria_FilterNode({
          title: enTitle,
          heTitle: heTitle,
          docCount: b.doc_count,
          aggKey: aggKey,
          aggType: aggType,
          selected: isSelected ? 1 : 0
        });
      });
      return {
        availableFilters: availableFilters,
        registry: {},
        orphans: []
      };
    }
  }]);
  return Search;
}();
var HackyQueryAborter = /*#__PURE__*/function () {
  /*Used to abort multiple ajax queries. Stand-in until AbortController is no longer experimental. At that point
  * we'll want to replace our ajax queries with fetch*/
  function HackyQueryAborter() {
    search_classCallCheck(this, HackyQueryAborter);
    this._queryList = [];
  }
  search_createClass(HackyQueryAborter, [{
    key: "addQuery",
    value: function addQuery(ajaxQuery) {
      this._queryList.push(ajaxQuery);
    }
  }, {
    key: "abort",
    value: function abort() {
      this._queryList.map(function (ajaxQuery) {
        return ajaxQuery.abort();
      });
    }
  }]);
  return HackyQueryAborter;
}();
/* harmony default export */ const search = (Search);
;// CONCATENATED MODULE: ../static/js/sefaria/strings.js
var _i18nInterfaceStrings;
function strings_typeof(obj) { "@babel/helpers - typeof"; return strings_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, strings_typeof(obj); }
function _defineProperty(obj, key, value) { key = strings_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function strings_toPropertyKey(arg) { var key = strings_toPrimitive(arg, "string"); return strings_typeof(key) === "symbol" ? key : String(key); }
function strings_toPrimitive(input, hint) { if (strings_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (strings_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Strings = {
  _i18nInterfaceStrings: (_i18nInterfaceStrings = {
    "Sefaria": "ספריא",
    "Topics": "נושאים",
    "Community": "קהילה",
    "Donate": "תרומה",
    "Sefaria Notifications": "הודעות בספריא",
    "Sefaria: a Living Library of Jewish Texts Online": "ספריא: ספריה יהודית דינמית",
    "Recently Viewed": "נצפו לאחרונה",
    "The Sefaria Library": "תוכן העניינים של ספריא",
    "Sefaria Search": "חיפוש בספריא",
    "Sefaria Account": "חשבון בספריא",
    "Notifcations": "התראות",
    "New Additions to the Sefaria Library": "חידושים בארון הספרים של ספריא",
    "My Notes on Sefaria": "ההערות שלי בספריא",
    "Texts & Source Sheets from Torah, Talmud and Sefaria's library of Jewish sources.": "טקסטים ודפי מקורות מן התורה, התלמוד וספריית המקורות של ספריא.",
    "Moderator Tools": "כלי מנהלים",
    " with ": " עם ",
    "Connections": "קשרים",
    " & ": " | ",
    "My Source Sheets": "דפי המקורות שלי",
    "Public Source Sheets": "דפי מקורות פומביים",
    "Log in": "התחברות",
    "Sign up": "הרשמה",
    // Texts Page
    "Learn More": "לקריאה נוספת",
    "Learning Schedules": "לוח לימוד יומי",
    "Teach with Sefaria": "מלמדים עם ספריא",
    "Visualizations": "תרשימים גרפיים",
    "Torah Tab": "תורה טאב (תוסף)",
    "Get the Mobile App": "הורידו את היישומון",
    "Access the Jewish library anywhere and anytime with the": "בעזרת היישומון תוכלו לגשת לארון הספרים היהודי בכל מקום ובכל זמן.",
    "Sefaria mobile app.": "אפליקציית ספריא לנייד.",
    "Stay Connected": "הישארו מעודכנים",
    "Get updates on new texts, learning resources, features, and more.": "קבלו עדכונים על מקורות חדשים, כלי למידה חדשים ועוד.",
    "Support Sefaria": "תמכו בספריא",
    "Sefaria is an open source, non-profit project. Support us by making a tax-deductible donation.": "ספריא היא מאגר פתוח וחינמי. תמכו בנו בעזרת תרומה.",
    "Make a Donation": "לתרומה",
    "Join the Conversation": "קחו חלק בשיח",
    "Explore the Community": "לעמוד הקהילה",
    "People around the world use Sefaria to create and share Torah resources. You're invited to add your voice.": "לומדים ולומדות מכל רחבי העולם משתמשים בספריא כדי ליצור ולשתף מקורות יהודיים. אנו מזמינים אתכם לקחת חלק בשיח זה.",
    "Create with Sefaria": "צרו בעזרת ספריא",
    "Mobile Apps": "יישומון לטלפון הנייד",
    "Browse the Library": "עיון בספריה",
    "Weekly Torah Portion": "פרשת השבוע",
    "All Learning Schedules": "לוחות לימוד נוספים",
    "Sponsor A Day of Learning": "תרמו יום לימוד בספריא",
    "With your help, we can add more texts and translations to the library, develop new tools for learning, and keep Sefaria accessible for Torah study anytime, anywhere.": "בעזרת התרומה שלכם נוכל להוסיף מקורות, תרגומים, לפתח כלים חדשים ללימוד ולשמור על גישה חופשית ללימוד תורה, בכל מקום ובכל זמן.",
    "Sponsor A Day": "הקדישו יום לימוד",
    // Text Category Pages
    "All Portions": "פרשות השבוע",
    "Popular Texts": "מקורות פופולריים",
    "Explore interconnections among texts with our interactive visualizations.": "העזרו בתרשימים הגרפיים כדי לגלות קשרים מעניינים בין מקורות.",
    "All Visualizations": "תרשימים גרפיים נוספים",
    "Daily Study": "לימוד יומי",
    // Topics and Category Admin tools
    "English Short Description for Table of Contents": "תיאור קצר עבור עמוד מפתח תוכן העניינים אנגלית",
    "Hebrew Short Description for Table of Contents": "תיאור קצר עבור עמוד מפתח תוכן העניינים עברית",
    "Choose a Category": "בחר קטגוריה",
    "Main Menu": "תפריט ראשי",
    "Saving topic information.": "מעדכן נתוני נושא",
    "Processing title changes may take some time.": "עדכון השינויים עלול להמשך זמן מה",
    "Add a short description.": "הוסף תיאור קצר",
    "Add a description.": "הוסף תיאור",
    "Add a title.": "הוסף שם כותר",
    "Explore Jewish Texts by Topic": "עיון בארון הספרים היהודי לפי נושא",
    "Explore by Topic": "לימוד לפי נושאים",
    "About Topics": "אודות \"נושאים\"",
    "Trending Topics": "נושאים נפוצים",
    "More": "עוד",
    "Less": "פחות",
    "All Topics A-Z": "כל הנושאים א-ת",
    "Browse or search our complete list of topics.": "חיפוש ברשימת הנושאים.",
    "Create a Topic": "ליצירת נושא חדש",
    "Edit Topic": "עריכת נושא",
    "English Title": "כותרת אנגלית",
    "Title": "כותרת",
    "English Description": "תיאור אנגלית",
    "Hebrew Description": "תיאור עברית",
    "Topic Deleted": "הנושא נמחק",
    "Topic Editor": "עריכת נושאים",
    "Please choose a category.": "אנא בחרו קטגוריה",
    "Title must be provided": "יש לספק כותרת",
    "Unfortunately, there may have been an error saving this topic information": "הודעת שגיאה: נראה כי חלה שגיאה במהלך שמירת הנתונים",
    "Something went wrong. Sorry!": "מצטערים, משהו השתבש",
    // Topics Tool
    "Search for a Topic.": "חפש נושא",
    "Add Topic": "הוספת נושא",
    "Create a new topic: ": "יצירת נושא: ",
    "Enter Source Ref (for example: 'Yevamot.62b.9-11' or 'Yevamot 62b:9-11')": "הכניסו מראה מקום, לדוגמא שבת פח א:ו",
    "Add sub-category": "הוסף קטגוריה",
    "Reorder sources": "סַדַּר המקורות",
    // All Topics
    "All Topics": "כל הנושאים",
    "Reset": "לאתחל",
    "Search Topics": "חפש נושאים",
    // Community Page
    "From the Community: Today on Sefaria": "מן הקהילה: היום בספריא",
    "Today on Sefaria": "היום בספריא",
    "Who to Follow": "משתמשים שכדאי לעקוב אחריהם",
    "Explore Collections": "עיינו באסופות",
    "Organizations, communities and individuals around the world curate and share collections of sheets for you to explore.": "ארגונים, קהילות ויחידים מרחבי העולם מציגים ומשתפים אסופות של דפי מקורות שתוכלו לגלות.",
    "Recently Published": "פורסמו לאחרונה",
    "Make a Sheet": "יצירת דף מקורות",
    "Combine sources from our library with your own comments, questions, images, and videos.": "השתמשו במקורות מהספריה ושלבו בהם את התגובות, השאלות, התמונות והסרטונים שלכם.",
    "A Living Library of Torah": "ספריה יהודית דינמית",
    // Search
    "Results for": "תוצאות עבור",
    "Results": "תוצאות",
    "Options": "אפשרויות",
    "Exact Matches Only": "התאמה מדויקת למילות החיפוש",
    "Search Texts": "חפש מקורות",
    "Search in this text": "חפש בטקסט",
    // Sheets
    "Sheet": "דף מקורות",
    "About this Sheet": "אודות דף המקורות",
    "Tags": "תוויות",
    "Search for a text...": "חפש מקור בספריא",
    "Paste a link to an image, video, or audio": "הוסף קישור לתמונה, סרטון, או אודיו",
    "Add media": "הוסף מדיה",
    "Add an image": "הוסף תמונה",
    "Add a source": "הוסף מקור",
    "Create a New Sheet": "יצירת דף מקורות",
    "Source Sheets": "דפי מקורות",
    "Sheets": "דפי מקורות",
    "Start a New Source Sheet": "התחלת דף מקורות חדש",
    "Untitled Source Sheet": "דף מקורות ללא שם",
    "Untitled": "ללא שם",
    "New Source Sheet": "דף מקורות חדש",
    "Name New Sheet": "כותרת לדף חדש",
    "Copy": "העתקה",
    "Edit": "עריכה",
    "View in Editor": "לתצוגת עריכה",
    "Enter link URL": "הכנס קישור",
    "Copied": "הועתק",
    "Copying...": "מעתיק...",
    "Delete": "מחיקה",
    "Sorry, there was a problem saving your note.": "סליחה, ארעה שגיאה בזמן השמירה",
    "Unfortunately, there was an error saving this note. Please try again or try reloading this page.": "ארעה שגיאה בזמן השמירה. אנא נסו שוב או טענו את הדף מחדש",
    "Are you sure you want to delete this note?": "האם אתם בטוחים שברצונכם למחוק?",
    "Something went wrong (that's all I know).": "משהו השתבש. סליחה",
    "Write a note...": "כתבו הערות כאן...",
    "Aa": "א",
    "Decrease font size": "הקטן גופן",
    "Increase font size": "הגדל גופן",
    "this comment": "הערה זו",
    "this source": "מקור זה",
    "was added to": "נוסף ל-",
    "View sheet": "מעבר ל-דף המקורות",
    "Please select a source sheet.": "אנא בחרו דף מקורות.",
    "New Source Sheet Name:": "כותרת דף מקורות חדש:",
    "Source Sheet by": "דף מקורות מאת",
    "Created with": 'נוצר עבורך ע"י',
    " hasn't shared any sheets yet.": " טרם שיתפ/ה דפי מקורות כלשהם",
    "Loading...": "טוען...",
    "Saving...": "שומר...",
    "Your Source Sheet has unsaved changes. Before leaving the page, click Save to keep your work.": "קיימים שינויים בלתי שמורים בדף המקורות. השתמשו בכפתור השמירה לפני עזיבת הדף.",
    "Your Source Sheet has unsaved changes. Please wait for the autosave to finish.": "קיימים שינויים בלתי שמורים בדף המקורות. אנא חכו שפעולת השמירה האוטומטית תסתיים.",
    "Are you sure you want to delete this sheet? There is no way to undo this action.": "מחיקת דף מקורות היא פעולה בלתי הפיכה. האם אתם בטוחים?",
    "Unfortunately an error has occurred. If you've recently edited text on this page, you may want to copy your recent work out of this page and click reload to ensure your work is properly saved.": "לצערנו ארעה שגיאה. אם ערכתם לאחרונה את הדף הנוכחי, ייתכן ותרצו להעתיק את השינויים למקור חיצוני ואז לטעון מחדש את הדף כדי לוודא שהשינויים נשמרו.",
    "Are you sure you want to remove this?": "בטוח שברצונך למחוק?",
    "Would you like to save this sheet? You only need to save once, after that changes are saved automatically.": "רוצה לשמור את הדף הזה? כל שעליך לעשות הוא לשמור פעם אחת – לאחר מכן השינויים יישמרו באופן אוטומטי.",
    "Like": "אהבתי",
    "Unlike": "ביטול סימון אהבתי",
    "No one has liked this sheet yet. Will you be the first?": "אף אחד עדיין לא אהב את דף המקורות הזה. תרצו להיות ראשונים?",
    "1 Person Likes This Sheet": "אדם אחד אהב את דף המקורות",
    " People Like This Sheet": " אנשים אהבו את דף המקורות",
    "Tags Saved": "תוית נשמרה",
    "Assignments allow you to create a template that your students can fill out on their own.": "מטלות מאפשרות ליצור דף בסיס שתלמידים יכולים להשתמש בו כדי למלא וליצור את העבודה שלהם.",
    "Students can complete their assignment at this link:": "תלמידים יכולים לבצע את המטלה שלהם בקישור הבא:",
    "Reset text of Hebrew, English or both?": "האם לאפס את התוכן של המקור בעברית, אנגלית או הכל?",
    "Any edits you have made to this source will be lost": "כל השינויים שנעשו במקור זה יאבדו",
    "Looking up Connections...": "מחפש קישורים...",
    "No connections known for this source.": "למקור הזה אין קשרים ידועים",
    "Edit Source title": "עריכת כותרת",
    "Add Source Below": "הוספת מקור מתחת",
    "Add Source": "הוספת מקור",
    "Add Comment": "הוספת תגובה",
    "Add All Connections": "הוספת כל המקורות הקשורים",
    "Reset Source Text": "איפוס טקסט מקור",
    "Copy to Sheet": "העתקה לדף מקורות",
    "Change Source Layout/Language": "שינוי שפת/עימוד מקור",
    "Move Source Up": "הזזת מקור מעלה",
    "Move Source Down": "הזזת מקור מטה",
    "Outdent Source": "הזחת מקור החוצה",
    "Indent Source": "הזחת מקור פנימה",
    "Create New": "יצירת חדש",
    "Close": "סגירה"
  }, _defineProperty(_i18nInterfaceStrings, "Reset", "איפוס"), _defineProperty(_i18nInterfaceStrings, "Views", "צפיות"), _defineProperty(_i18nInterfaceStrings, "Saves", "שמירות"), _defineProperty(_i18nInterfaceStrings, "Not Published", "לא פורסם"), _defineProperty(_i18nInterfaceStrings, "Publish Settings", "הגדרות פרסום"), _defineProperty(_i18nInterfaceStrings, "Publish Sheet", "פרסום דף מקורות"), _defineProperty(_i18nInterfaceStrings, "Your sheet is", "דף המקורות שלך"), _defineProperty(_i18nInterfaceStrings, "published", "פורסם"), _defineProperty(_i18nInterfaceStrings, "on Sefaria and visible to others through search and topics.", ".בספריא ומשתמשים אחרים יכולים למצוא אותו בחיפוש ובדפי הנושא"), _defineProperty(_i18nInterfaceStrings, "List your sheet on Sefaria for others to discover.", ".רישום דף המקורות שלך בספריא באופן שמשתמשים אחרים יוכלו למצוא אותו"), _defineProperty(_i18nInterfaceStrings, "Summary", "תקציר דף המקורות"), _defineProperty(_i18nInterfaceStrings, "Write a short description of your sheet...", "תיאור קצר של דף המקורות..."), _defineProperty(_i18nInterfaceStrings, "Add a topic...", "הוספת נושא..."), _defineProperty(_i18nInterfaceStrings, "Publish", "פרסום דף המקורות"), _defineProperty(_i18nInterfaceStrings, "Unpublish", "ביטול"), _defineProperty(_i18nInterfaceStrings, "Please add a description and topics to publish your sheet.", "יש להוסיף תיאור ונושאים כדי לפרסם את הדף"), _defineProperty(_i18nInterfaceStrings, "Please add topics to publish your sheet.", "יש להוסיף נושאים כדי לפרסם את הדף"), _defineProperty(_i18nInterfaceStrings, "Please add a description to publish your sheet.", "יש להוסיף תיאור כדי לפרסם את הדף"), _defineProperty(_i18nInterfaceStrings, "The summary description is limited to 280 characters.", "תקציר דף המקורות מוגבל ל280 תווים."), _defineProperty(_i18nInterfaceStrings, "People with this link can", "משתמשים עם קישור זה יכולים"), _defineProperty(_i18nInterfaceStrings, "Publish your sheet on Sefaria for others to discover.", "פרסמו את דף המקורות בספריא כדי שאחרים יוכלו ללמוד ממנו."), _defineProperty(_i18nInterfaceStrings, "Search", "חיפוש"), _defineProperty(_i18nInterfaceStrings, "Search Dictionary", "חיפוש במילון"), _defineProperty(_i18nInterfaceStrings, "Search for", "חיפוש"), _defineProperty(_i18nInterfaceStrings, "Search for:", "חיפוש:"), _defineProperty(_i18nInterfaceStrings, "Views", "צפיות"), _defineProperty(_i18nInterfaceStrings, "Search for Texts or Keywords Here", "חיפוש טקסט או מילות מפתח"), _defineProperty(_i18nInterfaceStrings, "Versions", "מהדורות"), _defineProperty(_i18nInterfaceStrings, "Version Open", "מהדורה פתוחה"), _defineProperty(_i18nInterfaceStrings, "About", "אודות"), _defineProperty(_i18nInterfaceStrings, "Current Version", "מהדורה נוכחית"), _defineProperty(_i18nInterfaceStrings, "Current Translation", "תרגום נוכחי"), _defineProperty(_i18nInterfaceStrings, "Select Version", "בחירת מהדורה"), _defineProperty(_i18nInterfaceStrings, "Select Translation", "בחירת תרגום"), _defineProperty(_i18nInterfaceStrings, "View in Sidebar", "פתיחת תרגום"), _defineProperty(_i18nInterfaceStrings, "Merged from", "נוצר ממיזוג"), _defineProperty(_i18nInterfaceStrings, "Source", "מקור"), _defineProperty(_i18nInterfaceStrings, "Sources", "מקורות"), _defineProperty(_i18nInterfaceStrings, "Digitization", "דיגיטציה"), _defineProperty(_i18nInterfaceStrings, "License", "רשיון"), _defineProperty(_i18nInterfaceStrings, "Revision History", "היסטורית עריכה"), _defineProperty(_i18nInterfaceStrings, "Buy in Print", "לרכישה בדפוס"), _defineProperty(_i18nInterfaceStrings, "Buy Now", "רכישה"), _defineProperty(_i18nInterfaceStrings, "Read More", "קרא עוד"), _defineProperty(_i18nInterfaceStrings, "Web Pages", "דפי אינטרנט"), _defineProperty(_i18nInterfaceStrings, "Members", "חברים"), _defineProperty(_i18nInterfaceStrings, "Send", "שלח"), _defineProperty(_i18nInterfaceStrings, "Cancel", "בטל"), _defineProperty(_i18nInterfaceStrings, "Send a message to ", "שלח הודעה ל-"), _defineProperty(_i18nInterfaceStrings, "Following", "נעקבים"), _defineProperty(_i18nInterfaceStrings, "Followers", "עוקבים"), _defineProperty(_i18nInterfaceStrings, "following", "נעקבים"), _defineProperty(_i18nInterfaceStrings, "followers", "עוקבים"), _defineProperty(_i18nInterfaceStrings, "Recent", "תאריך"), _defineProperty(_i18nInterfaceStrings, "Unlisted", "חסוי"), _defineProperty(_i18nInterfaceStrings, "History", "היסטוריה"), _defineProperty(_i18nInterfaceStrings, "Digitized by Sefaria", 'הונגש ועובד לצורה דיגיטלית על ידי ספריא'), _defineProperty(_i18nInterfaceStrings, "Public Domain", "בנחלת הכלל"), _defineProperty(_i18nInterfaceStrings, "Copyright: JPS, 1985", "זכויות שמורות ל-JPS, 1985"), _defineProperty(_i18nInterfaceStrings, "Location: ", "מיקום: "), _defineProperty(_i18nInterfaceStrings, "Translations", "תרגומים"), _defineProperty(_i18nInterfaceStrings, "Uncategorized", "לא מסווג"), _defineProperty(_i18nInterfaceStrings, "Collections", "אסופות"), _defineProperty(_i18nInterfaceStrings, "My Collections", "אסופות שלי"), _defineProperty(_i18nInterfaceStrings, "Public Collections", "אסופות ציבוריות"), _defineProperty(_i18nInterfaceStrings, "About Collections", "אודות \"אסופות\""), _defineProperty(_i18nInterfaceStrings, "Collection", "אסופה"), _defineProperty(_i18nInterfaceStrings, "Collections of sheets are created by Sefaria users and can be privately, shared with friends, or made public on Sefaria.", "אסופות הן מקבצים של דפי מקורות שנוצרו על ידי משתמשי האתר. הן ניתנות לשימוש פרטי, לצורך שיתוף עם אחרים או לשימוש ציבורי באתר ספריא."), _defineProperty(_i18nInterfaceStrings, "Sefaria Collections", "אסופות של ספריא"), _defineProperty(_i18nInterfaceStrings, "Create a Collection", "יצירת אסופה"), _defineProperty(_i18nInterfaceStrings, "Create a New Collection", "יצירת אסופה חדשה"), _defineProperty(_i18nInterfaceStrings, "Owner", "מנהל/ת"), _defineProperty(_i18nInterfaceStrings, "Editor", "עורך/ה"), _defineProperty(_i18nInterfaceStrings, "Editors", "עורכים"), _defineProperty(_i18nInterfaceStrings, "There are no sheets in this collection yet.", "לאסופה זו טרם נוספו דפי מקורות."), _defineProperty(_i18nInterfaceStrings, "You can add sheets to this collection on your profile.", "באפשרותך להוסיף דפי מקורות לאסופה הזאת דרך הפרופיל האישי שלך."), _defineProperty(_i18nInterfaceStrings, "Open Profile", "לפרופיל האישי"), _defineProperty(_i18nInterfaceStrings, "Search the full text of this collection for", "באפשרותך לחפש בטקסט המלא של האסופה את"), _defineProperty(_i18nInterfaceStrings, "No sheets matching ", "לא נמצאו דפים מתאימים ל"), _defineProperty(_i18nInterfaceStrings, "Pinned Sheet - click to unpin", "דף מקורות נעוץ - לחצו להסרה"), _defineProperty(_i18nInterfaceStrings, "Pinned Sheet", "דף מקורות נעוץ"), _defineProperty(_i18nInterfaceStrings, "Pin Sheet", "נעיצת דף מקורות"), _defineProperty(_i18nInterfaceStrings, "can invite & edit settings", "יכולים לשלוח הזמנות ולערוך את ההגדרות"), _defineProperty(_i18nInterfaceStrings, "can add & remove sheets", "יכולים להוסיף ולערוך דפים"), _defineProperty(_i18nInterfaceStrings, "Leave Collection", "עזיבת האסופה"), _defineProperty(_i18nInterfaceStrings, "Invite", "שליחת הזמנה"), _defineProperty(_i18nInterfaceStrings, "Inviting...", "שולח..."), _defineProperty(_i18nInterfaceStrings, "Invitation Sent", "נשלח"), _defineProperty(_i18nInterfaceStrings, "Invited", "הוזמן"), _defineProperty(_i18nInterfaceStrings, "Resend Invitation", "שליחת הזמנה חוזרת"), _defineProperty(_i18nInterfaceStrings, "Invitation Resent", "ההזמנה החוזרת נשלחה"), _defineProperty(_i18nInterfaceStrings, "There was an error sending your invitation.", "אירעה שגיאה בשליחת ההזמנה שלך."), _defineProperty(_i18nInterfaceStrings, "Are you sure you want to change your collection role? You won't be able to undo this action unless another owner restores your permissions.", "האם ברצונך לשנות את ההרשאה שלך באסופה? פעולה זו היא בלתי הפיכה, ולאחריה רק מנהלים אחרים של האסופה יוכל לשחזר את ההרשאות שלך."), _defineProperty(_i18nInterfaceStrings, "Are you sure you want to leave this collection?", "האם ברצונך לעזוב את האסופה?"), _defineProperty(_i18nInterfaceStrings, "Are you sure you want to remove this person from this collection?", "האם ברצונך להסיר משתמש זה מן האסופה?"), _defineProperty(_i18nInterfaceStrings, "Are you sure you want to remove this invitation?", "האם ברצונך למחוק הזמנה זו?"), _defineProperty(_i18nInterfaceStrings, "There was an error pinning your sheet.", "אירעה שגיאה בצירוף דף המקורות."), _defineProperty(_i18nInterfaceStrings, "There are no public collections yet.", "טרם נוצרו אסופות ציבוריות"), _defineProperty(_i18nInterfaceStrings, "You can use collections to organize your sheets or public sheets you like. Collections can be shared privately or made public on Sefaria.", "באפשרותך ליצור אסופות כדי לארגן את דפי המקורות שלך או דפי מקורות פתוחים לשימוש שאהבת. את האסופות אפשר לשתף באופן פרטי או לפרסם באופן ציבורי באתר ספריא."), _defineProperty(_i18nInterfaceStrings, " hasn't shared any collections yet.", " טרם שיתפ/ה אסופות כלשהם"), _defineProperty(_i18nInterfaceStrings, "Create new collection", "יצירת אסופה חדשה"), _defineProperty(_i18nInterfaceStrings, "Create", "יצירה"), _defineProperty(_i18nInterfaceStrings, "Done", "סיום"), _defineProperty(_i18nInterfaceStrings, "Add to Collection", "צירוף לאסופה"), _defineProperty(_i18nInterfaceStrings, "Edit Collection", "עריכת אסופה"), _defineProperty(_i18nInterfaceStrings, "Collection Name", "שם האסופה"), _defineProperty(_i18nInterfaceStrings, "Website", "כתובת אתר"), _defineProperty(_i18nInterfaceStrings, "Description", "תיאור"), _defineProperty(_i18nInterfaceStrings, "Collection Image", "תמונת האסופה"), _defineProperty(_i18nInterfaceStrings, "Upload Image", "העלאת תמונה"), _defineProperty(_i18nInterfaceStrings, "Recommended size: 350px x 350px or larger", 'גודל מומלץ: לפחות 350 פיקסל ע"ג 350 פיקסל'), _defineProperty(_i18nInterfaceStrings, "Default Sheet Header", "כותרת עמוד ראשונית"), _defineProperty(_i18nInterfaceStrings, "Recommended size: 1000px width to fill sheet, smaller images align right", "גודל מומלץ: 1000 פיקסל כדי למלא את חלל הדף. גודל קטן יותר יתיישר לימין"), _defineProperty(_i18nInterfaceStrings, "List on Sefaria", "הצג לכלל משתמשי ספריא"), _defineProperty(_i18nInterfaceStrings, "Your collection will appear on the public collections page where others can find it.", "האסופה שלך תופיע בדף האסופות הציבוריות ותהיה זמינה לעיון של משתמשות ומשתמשים אחרים."), _defineProperty(_i18nInterfaceStrings, "Delete Collection", "מחיקת אסופה"), _defineProperty(_i18nInterfaceStrings, "Are you sure you want to delete this collection? This cannot be undone.", "האם ברצונך למחוק את האסופה הזו? אין אפשרות לבטל את הפעולה אחר כך."), _defineProperty(_i18nInterfaceStrings, "You have unsaved changes to your collection.", "האסופה שלך כוללת שינויים שלא נשמרו."), _defineProperty(_i18nInterfaceStrings, "Images must be smaller than ", "תמונות חייבות להיות קטנות מ"), _defineProperty(_i18nInterfaceStrings, "Unfortunately an error occurred uploading your file.", "אירעה שגיאה בהעלאת הקובץ שלך."), _defineProperty(_i18nInterfaceStrings, "Unfortunately an error occurred saving your collection.", "אירעה שגיאה בשמירת האסופה שלך."), _defineProperty(_i18nInterfaceStrings, "Unfortunately an error occurred deleting your collection.", "אירעה שגיאה במחיקת האסופה שלך."), _defineProperty(_i18nInterfaceStrings, "Saved", "שמורים"), _defineProperty(_i18nInterfaceStrings, "Notifications", "התראות"), _defineProperty(_i18nInterfaceStrings, "Texts and sheets that you read will be available for you to see here.", "מקורות ודפי מקורות שקראתם יהיו זמינים עבורכם כאן לעיון חוזר."), _defineProperty(_i18nInterfaceStrings, "Click the bookmark icon on texts or sheets to save them here.", "לחצו על סמל הסימניה בתוך מקורות או דפי מקורות כדי לשמור מראי מקומות מסוימים כאן."), _defineProperty(_i18nInterfaceStrings, "New Text", "טקסט חדש"), _defineProperty(_i18nInterfaceStrings, "sent you a message", "שלח/ה לך הודעה"), _defineProperty(_i18nInterfaceStrings, "published a new sheet", "פרסמ/ה דף מקורות חדש"), _defineProperty(_i18nInterfaceStrings, "liked your sheet", "שמר/ה את דף המקורות שלך"), _defineProperty(_i18nInterfaceStrings, "is now following you", "נרשמ/ה לעדכונים ממך"), _defineProperty(_i18nInterfaceStrings, "Reply", "תשובה"), _defineProperty(_i18nInterfaceStrings, "added you to a collection", "הוסיפ/ה אותך לאסופה"), _defineProperty(_i18nInterfaceStrings, "Daily Learning", "לימוד יומי"), _defineProperty(_i18nInterfaceStrings, "Weekly Learning", "לימוד שבועי"), _defineProperty(_i18nInterfaceStrings, "Since ancient times, the Torah has been divided into sections which are read each week on a set yearly calendar. Following this practice, many other calendars have been created to help communities of learners work through specific texts together.", "מימי קדם חולקה התורה לקטעי קריאה שבועיים שנועדו לסיום הספר כולו במשך תקופת זמן של שנה. בעקבות המנהג הזה התפתחו לאורך השנים סדרי לימוד תקופתיים רבים נוספים, ובעזרתם יכולות קהילות וקבוצות של לומדים ללמוד יחד טקסטים שלמים."), _defineProperty(_i18nInterfaceStrings, "English", "אנגלית"), _defineProperty(_i18nInterfaceStrings, "Hebrew", "עברית"), _defineProperty(_i18nInterfaceStrings, "Yiddish", "יידיש"), _defineProperty(_i18nInterfaceStrings, "Finnish", "פינית"), _defineProperty(_i18nInterfaceStrings, "Portuguese", "פורטוגזית"), _defineProperty(_i18nInterfaceStrings, "Spanish", "ספרדית"), _defineProperty(_i18nInterfaceStrings, "French", "צרפתית"), _defineProperty(_i18nInterfaceStrings, "German", "גרמנית"), _defineProperty(_i18nInterfaceStrings, "Arabic", "ערבית"), _defineProperty(_i18nInterfaceStrings, "Italian", "איטלקית"), _defineProperty(_i18nInterfaceStrings, "Polish", "פולנית"), _defineProperty(_i18nInterfaceStrings, "Russian", "רוסית"), _defineProperty(_i18nInterfaceStrings, "Esperanto", "אספרנטו"), _defineProperty(_i18nInterfaceStrings, "Persian", "פרסית"), _defineProperty(_i18nInterfaceStrings, "Ladino", "לאדינו"), _defineProperty(_i18nInterfaceStrings, "On", "הצג"), _defineProperty(_i18nInterfaceStrings, "Off", "הסתר"), _defineProperty(_i18nInterfaceStrings, "Yes", "כן"), _defineProperty(_i18nInterfaceStrings, "No", "לא"), _defineProperty(_i18nInterfaceStrings, "Show Parasha Aliyot", "עליות לתורה מוצגות"), _defineProperty(_i18nInterfaceStrings, "Hide Parasha Aliyot", "עליות לתורה מוסתרות"), _defineProperty(_i18nInterfaceStrings, "Language", "שפה"), _defineProperty(_i18nInterfaceStrings, "Layout", "עימוד"), _defineProperty(_i18nInterfaceStrings, "Bilingual Layout", "עימוד דו לשוני"), _defineProperty(_i18nInterfaceStrings, "Color", "צבע"), _defineProperty(_i18nInterfaceStrings, "Font Size", "גודל גופן"), _defineProperty(_i18nInterfaceStrings, "Aliyot", "עליות לתורה"), _defineProperty(_i18nInterfaceStrings, "Taamim and Nikkud", "טעמים וניקוד"), _defineProperty(_i18nInterfaceStrings, "Punctuation", "פיסוק"), _defineProperty(_i18nInterfaceStrings, "Show Punctuation", "הצגת סימני פיסוק"), _defineProperty(_i18nInterfaceStrings, "Hide Punctuation", "הסתרת סימני פיסוק"), _defineProperty(_i18nInterfaceStrings, "Show Vowels and Cantillation", "הצג טקסט עם טעמי מקרא וניקוד"), _defineProperty(_i18nInterfaceStrings, "Vocalization", "טעמים וניקוד"), _defineProperty(_i18nInterfaceStrings, "Vowels", "ניקוד"), _defineProperty(_i18nInterfaceStrings, "Show only vowel points", "הצג טקסט עם ניקוד"), _defineProperty(_i18nInterfaceStrings, "Show only consonantal text", "הצג טקסט עיצורי בלבד"), _defineProperty(_i18nInterfaceStrings, "Email Address", 'כתובת דוא"ל'), _defineProperty(_i18nInterfaceStrings, "Describe the issue...", "טקסט המשוב"), _defineProperty(_i18nInterfaceStrings, "Report an issue with the text", "דיווח על בעיה בטקסט"), _defineProperty(_i18nInterfaceStrings, "Request translation", "בקשה לתרגום"), _defineProperty(_i18nInterfaceStrings, "Report a bug", "דיווח על תקלה באתר"), _defineProperty(_i18nInterfaceStrings, "Get help", "עזרה"), _defineProperty(_i18nInterfaceStrings, "Help", "עזרה"), _defineProperty(_i18nInterfaceStrings, "Get the Newsletter", "הירשמו לקבלת הניוזלטר"), _defineProperty(_i18nInterfaceStrings, "Sign up to get updates", "הירשמו לקבלת עדכונים"), _defineProperty(_i18nInterfaceStrings, "Request a feature", "בקשה להוספת אפשרות באתר"), _defineProperty(_i18nInterfaceStrings, "Give thanks", "תודה"), _defineProperty(_i18nInterfaceStrings, "Other", "אחר"), _defineProperty(_i18nInterfaceStrings, "Please select a feedback type", "אנא בחרו סוג משוב"), _defineProperty(_i18nInterfaceStrings, "Unfortunately, there was an error sending this feedback. Please try again or try reloading this page.", "לצערנו ארעה שגיאה בשליחת המשוב. אנא נסו שוב או רעננו את הדף הנוכחי"), _defineProperty(_i18nInterfaceStrings, "Tell us what you think...", "ספרו לנו מה אתם חושבים..."), _defineProperty(_i18nInterfaceStrings, "Select Type", "סוג משוב"), _defineProperty(_i18nInterfaceStrings, "Added by", "נוסף בידי"), _defineProperty(_i18nInterfaceStrings, "Love Learning?", "אוהבים ללמוד?"), _defineProperty(_i18nInterfaceStrings, "Sign up to get more from Sefaria", "הרשמו כדי לקבל יותר מספריא"), _defineProperty(_i18nInterfaceStrings, "Make source sheets", "הכינו דפי מקורות"), _defineProperty(_i18nInterfaceStrings, "Take notes", "שמרו הערות"), _defineProperty(_i18nInterfaceStrings, "Save texts", "שמרו טקסטים לקריאה חוזרת"), _defineProperty(_i18nInterfaceStrings, "Follow your favorite authors", "עקבו אחר הסופרים האהובים עליכם"), _defineProperty(_i18nInterfaceStrings, "Stay in the know", "השארו מעודכנים"), _defineProperty(_i18nInterfaceStrings, "Already have an account?", "כבר יש לכם חשבון?"), _defineProperty(_i18nInterfaceStrings, "Account Settings", "הגדרות"), _defineProperty(_i18nInterfaceStrings, "Sign in", "התחברו"), _defineProperty(_i18nInterfaceStrings, "Save", "שמירה"), _defineProperty(_i18nInterfaceStrings, "Remove", "הסרה"), _defineProperty(_i18nInterfaceStrings, "Logout", "ניתוק"), _defineProperty(_i18nInterfaceStrings, "Email was successfully changed!", 'כתובת הדוא"ל שונתה בהצלחה!'), _defineProperty(_i18nInterfaceStrings, "Settings Saved", "הגדרות נשמרו"), _defineProperty(_i18nInterfaceStrings, "Turning this feature off will permanently delete your reading history.", "כיבוי אפשרות זו תמחק לצמיתות את היסטורית הקריאה שלך."), _defineProperty(_i18nInterfaceStrings, "Filter", "סינון"), _defineProperty(_i18nInterfaceStrings, "Relevance", 'רלוונטיות'), _defineProperty(_i18nInterfaceStrings, "Chronological", 'כרונולוגי'), _defineProperty(_i18nInterfaceStrings, "Newest", "הכי חדש"), _defineProperty(_i18nInterfaceStrings, "This source is connected to ", "מקור הזה קשור ל-"), _defineProperty(_i18nInterfaceStrings, "This topic is connected to ", "נושא הזה קשור ל-"), _defineProperty(_i18nInterfaceStrings, "by", "על ידי"), _defineProperty(_i18nInterfaceStrings, "based on", "ע“פ"), _defineProperty(_i18nInterfaceStrings, "research of Dr. Michael Sperling", "המחקר של ד\"ר מיכאל ספרלינג"), _defineProperty(_i18nInterfaceStrings, "Read the Portion", "קראו את הפרשה"), _defineProperty(_i18nInterfaceStrings, "My Notes", "הרשומות שלי"), _defineProperty(_i18nInterfaceStrings, "Updates", "עדכונים"), _defineProperty(_i18nInterfaceStrings, "Preferred Translation", "תרגום מועדף"), _defineProperty(_i18nInterfaceStrings, "Text Title", "כותר לועזי"), _defineProperty(_i18nInterfaceStrings, "Hebrew Title", "כותר עברי"), _defineProperty(_i18nInterfaceStrings, "Text Structure", "מבנה טקסט"), _defineProperty(_i18nInterfaceStrings, "Category", "קטגוריה"), _defineProperty(_i18nInterfaceStrings, "Alternate Hebrew Titles", "חלופות כותר עבריות"), _defineProperty(_i18nInterfaceStrings, "Alternate English Titles", "חלופות כותר לועזיות"), _defineProperty(_i18nInterfaceStrings, "Optional", "אופציונלי"), _defineProperty(_i18nInterfaceStrings, "Torah Tracker", "לימוד במספרים"), _defineProperty(_i18nInterfaceStrings, "Previous Year", "לשנה האחרונה"), _defineProperty(_i18nInterfaceStrings, "All Time", "כל הזמן"), _defineProperty(_i18nInterfaceStrings, "Texts Read", "ספרים שנקראו"), _defineProperty(_i18nInterfaceStrings, "Sheets Read", "דפי מקורות שנקראו"), _defineProperty(_i18nInterfaceStrings, "Sheets Created", "דפי מקורות שנוצרו"), _defineProperty(_i18nInterfaceStrings, "Average Sefaria User", "משתמש ממוצע בספריא"), _defineProperty(_i18nInterfaceStrings, "Etc", "שאר"), _defineProperty(_i18nInterfaceStrings, "Please enter a valid email address.", 'כתובת הדוא"ל שהוזנה אינה תקינה.'), _defineProperty(_i18nInterfaceStrings, "Subscribed! Welcome to our list.", "הרשמה בוצעה בהצלחה!"), _defineProperty(_i18nInterfaceStrings, "Sorry, there was an error.", "סליחה, ארעה שגיאה"), _defineProperty(_i18nInterfaceStrings, "Connect", "צרו קשר"), _defineProperty(_i18nInterfaceStrings, "Site Language", "שפת האתר"), _defineProperty(_i18nInterfaceStrings, "Profile", "פרופיל"), _defineProperty(_i18nInterfaceStrings, " at ", " ב-"), _defineProperty(_i18nInterfaceStrings, "on Sefaria", " בספריא"), _defineProperty(_i18nInterfaceStrings, "Thanks for Trying the New Editor!", "תודה שבחרת לנסות את העורך החדש שלנו!"), _defineProperty(_i18nInterfaceStrings, "Go to your profile to create a new sheet, or edit an existing sheet, to try out the new experience. After you’ve had a chance to try it out, we would love to hear your feedback. You can reach us at", "כדי להתנסות בחוויית העריכה החדשה, יש להיכנס לפרופיל האישי שלך וליצור דף מקורות חדש או לערוך דף מקורות קיים. נשמח מאוד לקבל ממך משוב אחרי השימוש. אפשר ליצור איתנו קשר בדוא\"ל"), _defineProperty(_i18nInterfaceStrings, "Back to Profile", "חזרה לפרופיל האישי שלך"), _defineProperty(_i18nInterfaceStrings, "Go back to old version", "חזרה לגרסה הישנה"), _defineProperty(_i18nInterfaceStrings, "Request for Feedback", "נא למלא משוב"), _defineProperty(_i18nInterfaceStrings, "Thank you for trying the new Sefaria editor! We’d love to hear what you thought. Please take a few minutes to give us feedback on your experience.", "תודה שניסית את עורך ספריא החדש! נשמח מאוד לשמוע את דעתך עליו. אנו מבקשים ממך להקדיש כמה דקות למילוי משוב על חוויית השימוש שלך."), _defineProperty(_i18nInterfaceStrings, "Did you encounter any issues while using the new editor? For example:", "האם נתקלת בבעיות בעת השימוש בעורך החדש? למשל..."), _defineProperty(_i18nInterfaceStrings, "Technical problems", "בעיות טכניות"), _defineProperty(_i18nInterfaceStrings, "Difficulties using the editor", "קושי להשתמש בעורך"), _defineProperty(_i18nInterfaceStrings, "Missing features", "תכונות חסרות"), _defineProperty(_i18nInterfaceStrings, "Tell us about it...", "ספר/י לנו על כך..."), _defineProperty(_i18nInterfaceStrings, "Submit Feedback", "לשליחת המשוב"), _defineProperty(_i18nInterfaceStrings, "Thank you!", "תודה רבה!"), _defineProperty(_i18nInterfaceStrings, "You are currently testing the new Sefaria editor.", "ברגע זה הינך עושה שימוש בעורך החדש של ספריא"), _defineProperty(_i18nInterfaceStrings, "You are currently using the old Sefaria editor.", "כעת הינך עושה שימוש בגרסה הישנה של עורך ספריא"), _defineProperty(_i18nInterfaceStrings, "Try the new version", "להתנסוּת בגרסה החדשה"), _defineProperty(_i18nInterfaceStrings, "Your feedback is greatly appreciated. You can now edit your sheets again using the old source sheet editor. If you have any questions or additional feedback you can reach us at", "אנחנו מעריכים מאוד את המשוב שלך. כעת באפשרותך לחזור לערוך את הדפים שלך באמצעות עורך המסמכים הישן. לשאלות או למשוב נוסף אפשר לפנות אלינו בדוא\"ל:"), _defineProperty(_i18nInterfaceStrings, "Contents", "תוכן"), _defineProperty(_i18nInterfaceStrings, "Download", "הורדה"), _defineProperty(_i18nInterfaceStrings, "Table of Contents", "תוכן העניינים"), _defineProperty(_i18nInterfaceStrings, "Hebrew Versions", "בעברית"), _defineProperty(_i18nInterfaceStrings, "English Versions", "באנגלית"), _defineProperty(_i18nInterfaceStrings, "Continue Reading", "המשך קריאה"), _defineProperty(_i18nInterfaceStrings, "Start Reading", "התחלת קריאה"), _defineProperty(_i18nInterfaceStrings, "Composed", "זמן חיבור"), _defineProperty(_i18nInterfaceStrings, "Author", "מחבר"), _defineProperty(_i18nInterfaceStrings, "Authors", "מחברים"), _defineProperty(_i18nInterfaceStrings, "Wikipedia", "ויקיפדיה"), _defineProperty(_i18nInterfaceStrings, "Jewish Encyclopedia", "האנציקלופדיה היהודית"), _defineProperty(_i18nInterfaceStrings, "National Library of Israel", "הספרייה הלאומית"), _defineProperty(_i18nInterfaceStrings, "Works on Sefaria", "חיבורים וכתבים בספריא"), _defineProperty(_i18nInterfaceStrings, "Download Text", "הורדת טקסט"), _defineProperty(_i18nInterfaceStrings, "About this Text", "אודות ספר זה"), _defineProperty(_i18nInterfaceStrings, "About This Text", "אודות ספר זה"), _defineProperty(_i18nInterfaceStrings, "Related Topics", "נושאים קשורים"), _defineProperty(_i18nInterfaceStrings, "Sort by", "מיון לפי"), _defineProperty(_i18nInterfaceStrings, "Get Help", "עזרה"), _defineProperty(_i18nInterfaceStrings, "About Sefaria", "אודות ספריא"), _defineProperty(_i18nInterfaceStrings, "Saved & History", "היסטורית קריאה ושמורים"), _defineProperty(_i18nInterfaceStrings, "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam arcu felis, molestie sed mauris a, hendrerit vestibulum augue.", "בראיט ולחת צורק מונחף, בגורמי מג׳מש. תרבנך וסתעד לכנו סתשם השמה – לתכי מורגם בורק? לתיג ישבעס"), _defineProperty(_i18nInterfaceStrings, 'Citing', 'מצטט'), _defineProperty(_i18nInterfaceStrings, 'Sites that are listed here use the', 'אתרים המפורטים כאן משתמשים'), _defineProperty(_i18nInterfaceStrings, 'Sefaria Linker', 'במרשתת ההפניות'), _i18nInterfaceStrings),
  _i18nInterfaceStringsWithContext: {
    "AddConnectionBox": {
      "Select Type": "בחר סוג קישור",
      "None": "ללא",
      "Commentary": "פירוש",
      "Quotation": "ציטוט",
      "Midrash": "מדרש",
      "Ein Mishpat / Ner Mitsvah": "עין משפט / נר מצווה",
      'Mesorat HaShas': 'מסורת הש"ס',
      "Reference": "עיון",
      "Related Passage": "קשר אחר"
    },
    "SheetAuthorStatement": {
      "by ": "" // by line on sheets in reader, intentionally left blank
    },

    "AboutParashah": {
      "Torah Reading": "פרשת השבוע"
    },
    "ConnectionPanelSection": {
      "Related Texts": "מקורות לעיון",
      "Resources": "עזרים",
      "Tools": "כלים",
      "Share Link": "שיתוף קישור",
      "More Options": "אפשרויות נוספות"
    },
    "FollowButton": {
      "Follow": "עקבו",
      "Unfollow": "הסרת עוקב",
      "Following": "עוקב",
      "Follow Back": "עקבו בחזרה"
    },
    "DownloadVersions": {
      "Select Format": "בחירת פורמט הורדה",
      "Text (with Tags)": "טקסט (עם תיוגים)",
      "Text (without Tags)": "טקסט (ללא תיוגים)",
      "Select Version": "בחירת מהדורה/תרגום",
      "Merged Version": "גרסה משולבת"
    },
    "FilterableList": {
      "Alphabetical": "אלפביתי",
      "Recent": "הכי חדש",
      "Views": "הכי נצפה"
      /*"Relevance": 'רלוונטיות', //these 3 are duplicates but it doesnt seem to work without them, why?
      "Chronological": 'כרונולוגי',
      "Newest": "הכי חדש",*/
    },

    "Header": {
      "Texts": "מקורות"
    },
    "RecentlyPublished": {
      "Load More": "דפי מקורות נוספים"
    },
    "ResourcesModule": {
      "Resources": "כלי עזר"
    },
    "SearchFilters": {
      "Texts": "מקורות",
      "Topics": "נושאים",
      "Collections": "באסופות",
      "See More": "עוד"
    },
    "CalendarListing": {
      "Tanakh": "",
      "Talmud": ""
    },
    "Sheet Share": {
      "View": "לצפות",
      "Add": "להוסיף",
      "Edit": "לערוך"
    },
    "WebPageList": {
      'Author': 'מחבר'
    }
  }
};
/* harmony default export */ const strings = (Strings);
;// CONCATENATED MODULE: ../static/js/sefaria/palette.js
var palette = {
  colors: {
    darkteal: "#004e5f",
    raspberry: "#7c406f",
    green: "#5d956f",
    paleblue: "#9ab8cb",
    blue: "#4871bf",
    orange: "#cb6158",
    lightpink: "#c7a7b4",
    darkblue: "#073570",
    darkpink: "#ab4e66",
    lavender: "#7f85a9",
    yellow: "#ccb479",
    purple: "#594176",
    lightblue: "#5a99b7",
    lightgreen: "#97b386",
    red: "#802f3e",
    teal: "#00827f",
    lightbg: "#B8D4D3",
    tan: "#D4896C"
  }
};
palette.categoryColors = {
  "Commentary": "var(--commentary-blue)",
  "Tanakh": "var(--tanakh-teal)",
  "Midrash": "var(--midrash-green)",
  "Mishnah": "var(--mishnah-blue)",
  "Talmud": "var(--talmud-gold)",
  "Halakhah": "var(--halakhah-red)",
  "Kabbalah": "var(--kabbalah-purple)",
  "Jewish Thought": "var(--philosophy-purple)",
  "Liturgy": "var(--liturgy-rose)",
  "Tosefta": "var(--taanitic-green)",
  "Chasidut": "var(--chasidut-green)",
  "Musar": "var(--mussar-purple)",
  "Responsa": "var(--responsa-red)",
  "Second Temple": "var(--apocrypha-pink)",
  "Quoting Commentary": "var(--responsa-red)",
  "Sheets": "var(--sefaria-blue)",
  "Sheet": "var(--sefaria-blue)",
  "Targum": "var(--miscelaneous-green)",
  "Modern Commentary": "var(--modern-works-blue)",
  "Reference": "var(--reference-orange)",
  "System": "var(--sefaria-blue)",
  "Static": "linear-gradient(90deg, #00505E 0% 10%, #5698B4 10% 20%, #CCB37C 20% 30%, #5B9370 30% 40%, #823241 40% 50%, #5A4474 50% 60%, #AD4F66 60% 70%, #7285A6 70% 80%, #00807E 80% 90%, #4872B3 90% 100%)"
};
palette.categoryColor = function (cat) {
  if (cat in palette.categoryColors) {
    return palette.categoryColors[cat];
  }

  // For unknown categories, map the string a color (random, but stable)
  var colors = Object.values(palette.colors);
  var idx = 0;
  cat = typeof cat == "string" ? cat : "";
  cat.split("").map(function (letter) {
    idx += letter.charCodeAt(0);
  });
  idx = idx % colors.length;
  return colors[idx];
};
/* harmony default export */ const sefaria_palette = (palette);
;// CONCATENATED MODULE: ../static/js/sefaria/track.js
function track_typeof(obj) { "@babel/helpers - typeof"; return track_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, track_typeof(obj); }
function track_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function track_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, track_toPropertyKey(descriptor.key), descriptor); } }
function track_createClass(Constructor, protoProps, staticProps) { if (protoProps) track_defineProperties(Constructor.prototype, protoProps); if (staticProps) track_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function track_toPropertyKey(arg) { var key = track_toPrimitive(arg, "string"); return track_typeof(key) === "symbol" ? key : String(key); }
function track_toPrimitive(input, hint) { if (track_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (track_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var ga;
var tracker, trackerName;
if (typeof window !== 'undefined' && typeof window.ga === "function" && typeof window.ga.getAll == "function" && window.ga.getAll().length > 0) {
  ga = window.ga;
  tracker = ga.getAll()[0];
  trackerName = tracker.get("name"); // Google Tag Manager assigns a Tracker Name
  window.onerror = function (msg, url, lineNumber) {
    ga(trackerName + ".send", 'event', 'Javascript Errors', msg, url + ':' + lineNumber);
  };
  ga(trackerName + '.require', 'ec');
} else {
  ga = function ga() {}; // Fail gracefully if we reach one of these methods server side or when GA doesn't load properly
  ga._mock = true;
  trackerName = "mock";
}
var SET = trackerName + ".set";
var SEND = trackerName + ".send";
var Track = /*#__PURE__*/function () {
  function Track() {
    track_classCallCheck(this, Track);
  }
  track_createClass(Track, null, [{
    key: "event",
    value:
    // Helper functions for event tracking (with Google Analytics and Mixpanel)
    function event(category, action, label, value, options) {
      // https://developers.google.com/analytics/devguides/collection/analyticsjs/command-queue-reference#send
      ga(SEND, 'event', category, action, label, value, options);
      console.log(SEND, 'event', category, action, label, value, options);
      if (ga._mock && value && value.hitCallback) {
        // When Google Analytics isn't being used, trigger hitCallback immediately.
        value.hitCallback();
        // Unsure why we have param mismatch... what we call value here is treated as options.
        // A previous attempt to insert `null` for value to put `options` in the right place broke tracking.
      } else if (value && value.hitCallback) {
        // Creates a timeout to call `hitCallback` after one second (in case of no return from ga).
        setTimeout(value.hitCallback, 1000);
      }
    }
  }, {
    key: "promoView",
    value: function promoView(id, position) {
      // Promo details provided in a promoFieldObject. Can add name, and creative if we desire.
      ga(trackerName + '.ec:addPromo', {
        'id': id,
        'name': id,
        'position': position
      });
      ga(SEND, 'event', 'Internal Promotions', 'view', id, {
        nonInteraction: true
      });
    }
  }, {
    key: "promoClick",
    value: function promoClick(id, position) {
      // Identify the promotion that was clicked.
      ga(trackerName + '.ec:addPromo', {
        'id': id,
        'name': id,
        'position': position
      });

      // Send the promo_click action with an event.
      ga(trackerName + '.ec:setAction', 'promo_click');
      ga(SEND, 'event', 'Internal Promotions', 'click', id);
    }
  }, {
    key: "pageview",
    value: function pageview(url) {
      ga(SET, 'page', url);
      ga(SEND, 'pageview');
    }
  }, {
    key: "setPrimaryCategory",
    value: function setPrimaryCategory(category_name) {
      ga(SET, 'contentGroup1', category_name);
    }
  }, {
    key: "setSecondaryCategory",
    value: function setSecondaryCategory(category_name) {
      ga(SET, 'contentGroup2', category_name);
    }
  }, {
    key: "setContentLanguage",
    value: function setContentLanguage(language) {
      ga(SET, 'contentGroup5', language);
    }
  }, {
    key: "setNumberOfPanels",
    value: function setNumberOfPanels(val) {
      ga(SET, 'dimension1', val);
    }
  }, {
    key: "setBookName",
    value: function setBookName(val) {
      ga(SET, 'dimension2', val);
      ga(SET, 'contentGroup3', val);
    }
  }, {
    key: "setRef",
    value: function setRef(val) {
      ga(SET, 'dimension3', val);
    }
  }, {
    key: "setVersionTitle",
    value: function setVersionTitle(val) {
      ga(SET, 'dimension4', val);
    }
  }, {
    key: "setPageType",
    value: function setPageType(val) {
      ga(SET, 'dimension5', val);
    }
  }, {
    key: "setSidebars",
    value: function setSidebars(val) {
      ga(SET, 'dimension6', val);
    }
  }, {
    key: "setUserLoggedIn",
    value: function setUserLoggedIn(bool) {
      ga(SET, 'dimension7', bool ? "Logged In" : "Logged Out");
    }
  }, {
    key: "setUserID",
    value: function setUserID(val) {
      var sval = String(val);
      ga(SET, 'userId', sval);
      ga(SET, 'dimension10', sval);
    }
  }, {
    key: "setUserData",
    value: function setUserData(loggedIn, analytics_uid) {
      this.setUserLoggedIn(loggedIn);
      if (analytics_uid) this.setUserID(analytics_uid);
    }
  }, {
    key: "sheets",
    value: function sheets(action, label) {
      this.event("Sheets", action, label);
    }
  }, {
    key: "uiFeedback",
    value: function uiFeedback(component, likeStatus) {
      this.event("UI", component, likeStatus);
    }
  }, {
    key: "exploreUrl",
    value: function exploreUrl(url) {
      this.event("Explorer", "Open", url);
      this.pageview(url);
    }
  }, {
    key: "exploreBook",
    value: function exploreBook(book) {
      this.event("Explorer", "Book", book);
    }
  }, {
    key: "exploreBrush",
    value: function exploreBrush(book) {
      this.event("Explorer", "Brush", book);
    }
  }, {
    key: "setInterfaceLanguage",
    value: function setInterfaceLanguage(origin, language) {
      // Tracks a user setting their interface langauge, which can be done either account settings or footer
      this.event("Settings", origin, language);
    }
  }]);
  return Track;
}();
/* harmony default export */ const track = (Track);
;// CONCATENATED MODULE: ../static/js/sefaria/hebrew.js
function hebrew_typeof(obj) { "@babel/helpers - typeof"; return hebrew_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, hebrew_typeof(obj); }
function hebrew_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function hebrew_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, hebrew_toPropertyKey(descriptor.key), descriptor); } }
function hebrew_createClass(Constructor, protoProps, staticProps) { if (protoProps) hebrew_defineProperties(Constructor.prototype, protoProps); if (staticProps) hebrew_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function hebrew_toPropertyKey(arg) { var key = hebrew_toPrimitive(arg, "string"); return hebrew_typeof(key) === "symbol" ? key : String(key); }
function hebrew_toPrimitive(input, hint) { if (hebrew_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (hebrew_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var GERESH = "\u05F3";
var GERSHAYIM = "\u05F4";
var Hebrew = /*#__PURE__*/function () {
  function Hebrew() {
    hebrew_classCallCheck(this, Hebrew);
  }
  hebrew_createClass(Hebrew, null, [{
    key: "decodeHebrewNumeral",
    value: function decodeHebrewNumeral(h) {
      // Takes a string representing a Hebrew numeral and returns it integer value.
      var values = this.hebrewNumerals;
      if (h === values[15] || h === values[16]) {
        return values[h];
      }
      var n = 0;
      for (var i = 0; i < h.length; i++) {
        n += values[h.charAt(i)];
      }
      return n;
    }

    /**
     * Encodes an integer "Daf" and returns a string encoding it as a Hebrew numeral.
     * @param {number} n - The integer
     * @returns {number[]} - Hebrew numeral
     */
  }, {
    key: "breakIntMagnitudes",
    value: function breakIntMagnitudes(n) {
      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      /* Accepts an integer and an optional integer (multiple of 10) for at what order of
      magnitude to start breaking apart the integer.  If no option "start" is provided,
      function will determine the size of the input integer and start that the largest order
      of magnitude.
      Returns a big-endian list of the various orders of magnitude, by 10s, broken apart.
      breakIntMagnitudes(1129, 100)
      [1100, 20, 9]
      breakIntMagnitudes(2130)
      [2000, 100, 30, 0]
      breakIntMagnitudes(15000)
      [10000, 5000, 0, 0, 0]
       */
      if (!!start) {
        if (!(start % 10 === 0 || start === 1)) {
          throw new TypeError("Argument 'start' must be 1 or divisible by 10, ".concat(start, " provided."));
        }
      } else {
        start = Math.pow(10, Math.floor(Math.log10(n)));
      }
      if (start === 1) {
        return [n];
      } else {
        var thisIntMagnitude = Math.floor(n / start) * start;
        var nextIntMagnitude = this.breakIntMagnitudes(n - Math.floor(n / start) * start, start = Math.floor(start / 10));
        return [thisIntMagnitude].concat(nextIntMagnitude);
      }
    }
  }, {
    key: "getChunks",
    value: function getChunks(list, chunkSize) {
      return list.reduce(function (all, one, i) {
        var ch = Math.floor(i / chunkSize);
        all[ch] = [].concat(all[ch] || [], one);
        return all;
      }, []);
    }
  }, {
    key: "sanitize",
    value: function sanitize(inputString) {
      var punctuation = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
      var replacementPairs = [[/\u05d9\u05d4/g, "\u05D8\u05D5"],
      //15
      [/\u05d9\u05d5/g, "\u05D8\u05D6"],
      //16
      [/\u05e8\u05e2\u05d4/g, "\u05E2\u05E8\u05D4"],
      //275
      [/\u05e8\u05e2\u05d1/g, "\u05E2\u05E8\u05D1"],
      //272
      [/\u05e8\u05e2/g, "\u05E2\u05E8"] //270
      ];

      replacementPairs.forEach(function (pair) {
        inputString = inputString.replace(pair[0], pair[1]);
      });
      if (punctuation) {
        // add gershayim at the end if longer than one character
        if (inputString.length > 1) {
          // if a geresh is not one of the last two items in the string
          if (this.right(inputString, 2).indexOf(GERESH) < 0) {
            inputString = inputString.substr(0, inputString.length - 1) + GERSHAYIM + this.right(inputString, 1);
          }
        } else {
          inputString += GERESH;
        }
      }
      return inputString;
    }
  }, {
    key: "right",
    value: function right(string, numChars) {
      'use strict';

      return string.slice(string.length - numChars);
    }
  }, {
    key: "encodeLargeHebrewNumeral",
    value: function encodeLargeHebrewNumeral(n) {
      var _this = this;
      var punctuation = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
      // Break into magnitudes, then break into thousands buckets, big-endian
      var ret = this.breakIntMagnitudes(n).reverse();
      ret = this.getChunks(ret, 3);

      // Eliminate the orders of magnitude in preparation for being encoded
      ret = ret.map(function (arr, index) {
        var sum = arr.reduce(function (a, b) {
          return a + b;
        }, 0);
        return parseInt(sum * Math.pow(10, -3 * index));
      });

      // encode and join together, separating thousands with geresh
      ret = ret.map(function (x) {
        return _this.encodeHebrewNumeral(x);
      });
      ret = ret.reverse().join(GERESH);
      ret = this.sanitize(ret, punctuation);
      return ret;
    }
  }, {
    key: "encodeHebrewNumeral",
    value: function encodeHebrewNumeral(n) {
      var punctuation = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
      n = parseInt(n);
      if (n >= 1300) {
        return this.encodeLargeHebrewNumeral(n, punctuation = punctuation);
      }
      var values = this.hebrewNumerals;
      var heb = "";
      if (n >= 100) {
        var hundreds = n - n % 100;
        heb += values[hundreds];
        n -= hundreds;
      }
      if (n === 15 || n === 16) {
        // Catch 15/16 no matter what the hundreds column says
        heb += values[n];
      } else {
        if (n >= 10) {
          var tens = n - n % 10;
          heb += values[tens];
          n -= tens;
        }
        if (n > 0) {
          if (!values[n]) {
            return undefined;
          }
          heb += values[n];
        }
      }
      return heb;
    }

    /**
     * Encodes an English "Daf" (2 sided page) ref address string into a corresponding Hebrew one.
     * @param {string} daf - The English daf string
     * @param {string} form - Whether to use colon or letters
     * @returns {string} - Hebrew representation
     */
  }, {
    key: "encodeHebrewDaf",
    value: function encodeHebrewDaf(daf, form) {
      // Returns Hebrew daf strings from "32b"
      form = form || "short";
      var n = parseInt(daf.slice(0, -1));
      var a = daf.slice(-1);
      if (form === "short") {
        a = {
          a: ".",
          b: ":"
        }[a];
        return this.encodeHebrewNumeral(n) + a;
      } else if (form === "long") {
        a = {
          a: 1,
          b: 2
        }[a];
        return this.encodeHebrewNumeral(n) + " " + this.encodeHebrewNumeral(a);
      }
    }

    /**
     * Encodes an English "Folio" (4 sided daf) ref address string into a corresponding Hebrew one.
     * @param {string} daf - The English folio string
     * @returns {string} - Hebrew representation
     */
  }, {
    key: "encodeHebrewFolio",
    value: function encodeHebrewFolio(daf) {
      var n = parseInt(daf.slice(0, -1));
      var a = {
        a: "א",
        b: "ב",
        c: "ג",
        d: "ד"
      }[daf.slice(-1)];
      return this.encodeHebrewNumeral(n) + "," + a;
    }
  }, {
    key: "getNikkudRegex",
    value: function getNikkudRegex(rawString) {
      // given a Hebrew string, return regex that allows for arbitrary nikkud in between letters
      return rawString.stripNikkud().split("").join("[\u0591-\u05C7]*");
    }
  }, {
    key: "isHebrew",
    value: function isHebrew(text) {
      // Returns true if text is (mostly) Hebrew
      // Examines up to the first 200 characters, ignoring html tags, punctuation and numbers
      text = text.stripHtml().stripNikkud();
      var heCount = 0;
      var enCount = 0;
      var punctuationRE = /[0-9 .,'"?!;:\-=@#$%^&*()/<>]/;
      for (var i = 0; i < Math.min(200, text.length); i++) {
        if (punctuationRE.test(text[i])) {
          continue;
        }
        if (text.charCodeAt(i) > 0x590 && text.charCodeAt(i) < 0x5FF) {
          heCount++;
        } else {
          enCount++;
        }
      }
      return heCount > enCount;
    }
  }, {
    key: "containsHebrew",
    value: function containsHebrew(text) {
      // Returns true if there are any Hebrew characters in text
      for (var i = 0; i < text.length; i++) {
        if (text.charCodeAt(i) > 0x590 && text.charCodeAt(i) < 0x5FF) {
          return true;
        }
      }
      return false;
    }
  }, {
    key: "containsEnglish",
    value: function containsEnglish(text) {
      // Returns true if there are any English characters in text
      return !!text.match(/[a-zA-Z]/);
    }
  }, {
    key: "hebrewPlural",
    value: function hebrewPlural(s) {
      var known = {
        "Daf": "Dappim",
        "Mitzvah": "Mitzvot",
        "Mitsva": "Mitzvot",
        "Mesechet": "Mesechtot",
        "Perek": "Perokim",
        "Siman": "Simanim",
        "Seif": "Seifim",
        "Se'if": "Se'ifim",
        "Mishnah": "Mishnayot",
        "Mishna": "Mishnayot",
        "Chelek": "Chelekim",
        "Parasha": "Parshiot",
        "Parsha": "Parshiot",
        "Pasuk": "Psukim",
        "Midrash": "Midrashim",
        "Aliyah": "Aliyot"
      };
      return s in known ? known[s] : s + "s";
    }

    /**
     * Takes an integer representing a database addressable location and converts it into the appropriate 2 sided Talmud page address. 
     * For Reverse function see below dafToInt()
     * @param {number} i - The integer physical location
     * @returns {string} The Daf X[a/b] notation, e.g. Daf 15b
     */
  }, {
    key: "intToDaf",
    value: function intToDaf(i) {
      // Base 0 int -> daf
      // e.g. 2 -> "2a"
      i += 1;
      var daf = Math.ceil(i / 2);
      return daf + (i % 2 ? "a" : "b");
    }

    /**
     * Takes a Talmud daf string and turns it into the correct db addressable physical location for that text. The reverse of the above intToDaf()
     * @param {string} daf - The input string
     * @returns {number} The actual integer location of the text
     */
  }, {
    key: "dafToInt",
    value: function dafToInt(daf) {
      var amud = daf.slice(-1);
      var i = parseInt(daf.slice(0, -1)) - 1;
      i = amud == "a" ? i * 2 : i * 2 + 1;
      return i;
    }

    /**
     * Takes an integer representing a database addressable location and converts it into the appropriate 4 sided Jerusalem Talmud like manuscript page address
     * @param {number} i - The integer physical location
     * @returns {string} The Daf X[a-d] notation, e.g. Daf 4c
     */
  }, {
    key: "intToFolio",
    value: function intToFolio(i) {
      i += 1;
      var daf = Math.ceil(i / 4);
      var mod = i % 4;
      return daf + (mod === 1 ? "a" : mod === 2 ? "b" : mod === 3 ? "c" : "d");
    }
  }]);
  return Hebrew;
}();
Hebrew.hebrewNumerals = {
  "\u05D0": 1,
  "\u05D1": 2,
  "\u05D2": 3,
  "\u05D3": 4,
  "\u05D4": 5,
  "\u05D5": 6,
  "\u05D6": 7,
  "\u05D7": 8,
  "\u05D8": 9,
  "\u05D9": 10,
  "\u05D8\u05D5": 15,
  "\u05D8\u05D6": 16,
  "\u05DB": 20,
  "\u05DC": 30,
  "\u05DE": 40,
  "\u05E0": 50,
  "\u05E1": 60,
  "\u05E2": 70,
  "\u05E4": 80,
  "\u05E6": 90,
  "\u05E7": 100,
  "\u05E8": 200,
  "\u05E9": 300,
  "\u05EA": 400,
  "\u05EA\u05E7": 500,
  "\u05EA\u05E8": 600,
  "\u05EA\u05E9": 700,
  "\u05EA\u05EA": 800,
  1: "\u05D0",
  2: "\u05D1",
  3: "\u05D2",
  4: "\u05D3",
  5: "\u05D4",
  6: "\u05D5",
  7: "\u05D6",
  8: "\u05D7",
  9: "\u05D8",
  10: "\u05D9",
  15: "\u05D8\u05D5",
  16: "\u05D8\u05D6",
  20: "\u05DB",
  30: "\u05DC",
  40: "\u05DE",
  50: "\u05E0",
  60: "\u05E1",
  70: "\u05E2",
  80: "\u05E4",
  90: "\u05E6",
  100: "\u05E7",
  200: "\u05E8",
  300: "\u05E9",
  400: "\u05EA",
  500: "\u05EA\u05E7",
  600: "\u05EA\u05E8",
  700: "\u05EA\u05E9",
  800: "\u05EA\u05EA",
  900: "\u05EA\u05EA\u05E7",
  1000: "\u05EA\u05EA\u05E8",
  1100: "\u05EA\u05EA\u05E9",
  1200: "\u05EA\u05EA\u05EA"
};
/* harmony default export */ const hebrew = (Hebrew);
;// CONCATENATED MODULE: ../static/js/context.js

var ContentLanguageContext = /*#__PURE__*/external_react_default().createContext({
  language: "english"
});
ContentLanguageContext.displayName = 'ContentLanguageContext'; //This lets us see this name in the devtools

var AdContext = /*#__PURE__*/external_react_default().createContext({});
AdContext.displayName = 'AdContext';

;// CONCATENATED MODULE: ../static/js/sefaria/sefaria.js
var _excluded = ["children"];
function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }
function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { sefaria_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function sefaria_defineProperty(obj, key, value) { key = sefaria_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function sefaria_toPropertyKey(arg) { var key = sefaria_toPrimitive(arg, "string"); return sefaria_typeof(key) === "symbol" ? key : String(key); }
function sefaria_toPrimitive(input, hint) { if (sefaria_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (sefaria_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function sefaria_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = sefaria_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function _regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == sefaria_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function sefaria_toConsumableArray(arr) { return sefaria_arrayWithoutHoles(arr) || sefaria_iterableToArray(arr) || sefaria_unsupportedIterableToArray(arr) || sefaria_nonIterableSpread(); }
function sefaria_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function sefaria_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function sefaria_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return sefaria_arrayLikeToArray(arr); }
function sefaria_slicedToArray(arr, i) { return sefaria_arrayWithHoles(arr) || sefaria_iterableToArrayLimit(arr, i) || sefaria_unsupportedIterableToArray(arr, i) || sefaria_nonIterableRest(); }
function sefaria_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function sefaria_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return sefaria_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return sefaria_arrayLikeToArray(o, minLen); }
function sefaria_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function sefaria_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function sefaria_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function sefaria_typeof(obj) { "@babel/helpers - typeof"; return sefaria_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, sefaria_typeof(obj); }

var extend = __webpack_require__(/*! extend */ "extend"),
  param = (__webpack_require__(/*! querystring */ "querystring").stringify);









var sefaria_Sefaria = sefaria_Sefaria || {
  _dataLoaded: false,
  _inBrowser: typeof document !== "undefined",
  toc: [],
  books: [],
  booksDict: {},
  last_place: [],
  apiHost: "" // Defaults to localhost, override to talk another server
};

if (typeof window !== 'undefined') {
  window.Sefaria = sefaria_Sefaria; // allow access to `Sefaria` from console
}

sefaria_Sefaria = extend(sefaria_Sefaria, {
  _parseRef: {},
  // cache for results of local ref parsing
  parseRef: function parseRef(q) {
    // Client side ref parsing without depending on book index data.
    // Does depend on Sefaria.booksDict.
    // One of the oldest functions in Sefaria! But should be intelligently merged into Sefaria.ref()
    q = q || "";
    q = decodeURIComponent(q);
    q = q.replace(/_/g, " ").replace(/[.:]/g, " ").replace(/ +/, " ");
    q = q.trim().toFirstCapital();
    if (q in sefaria_Sefaria._parseRef) {
      return sefaria_Sefaria._parseRef[q];
    }
    var response = {
      book: false,
      index: false,
      sections: [],
      toSections: [],
      ref: ""
    };
    if (!q) {
      sefaria_Sefaria._parseRef[q] = response;
      return response;
    }
    var toSplit = q.split("-");
    var first = toSplit[0];
    var book, index, nums;
    for (var i = first.length; i >= 0; i--) {
      book = first.slice(0, i);
      if (sefaria_Sefaria.virtualBooks.includes(book)) {
        // todo: This assumes that this is a depth one integer indexed node
        var numberMatch = first.match(/([\d ]+)$/);
        if (numberMatch) {
          nums = String(+numberMatch[0]);
          book = first.slice(0, numberMatch.index);
        } else {
          book = first;
        }
        break;
      }
      if (book in sefaria_Sefaria.booksDict || book === "Sheet") {
        var remainder = first.slice(i);
        if (remainder && remainder[0] !== " ") {
          continue; // book name must be followed by a space, Jobs != Job
        }

        nums = remainder.slice(1);
        break;
      }
    }
    // Get the root index name. (For complex works, this may be different than `book`)
    for (var _i = book.length; _i >= 0; _i--) {
      index = book.slice(0, _i);
      if (this.index(index)) {
        break;
      }
    }
    if (!book) {
      sefaria_Sefaria._parseRef[q] = {
        "error": "Unknown book."
      };
      return sefaria_Sefaria._parseRef[q];
    }
    if (nums && !nums.match(/\d+[ab]?( \d+)*$/)) {
      sefaria_Sefaria._parseRef[q] = {
        "error": "Bad section string."
      };
      console.log(sefaria_Sefaria._parseRef[q]);
      return sefaria_Sefaria._parseRef[q];
    }
    response.index = index;
    response.book = book;
    response.sections = nums ? nums.split(" ") : [];
    response.toSections = nums ? nums.split(" ") : [];
    response.ref = q;

    // Parse range end (if any)
    if (toSplit.length === 2) {
      var toSections = toSplit[1].replace(/[.:]/g, " ").split(" ");
      var diff = response.sections.length - toSections.length;
      for (var _i2 = diff; _i2 < toSections.length + diff; _i2++) {
        response.toSections[_i2] = toSections[_i2 - diff];
      }
    }
    sefaria_Sefaria._parseRef[q] = response;
    return response;
  },
  makeRef: function makeRef(q) {
    // Returns a string ref corresponding to the parsed ref `q` (like Ref.url() in Python)
    if (!(q.book && q.sections && q.toSections)) {
      return {
        "error": "Bad input."
      };
    }
    var ref = q.book.replace(/ /g, "_");
    ref = encodeURIComponent(ref);
    if (q.sections.length) ref += "." + q.sections.join(".");
    if (!q.sections.compare(q.toSections)) {
      var i;
      for (i = 0; i < q.toSections.length; i++) if (q.sections[i] !== q.toSections[i]) break;
      ref += "-" + q.toSections.slice(i).join(".");
    }
    return ref;
  },
  normRef: function normRef(ref) {
    // Returns a string of the URL normalized form of `ref` (using _ for spaces and . for section seprator).
    // `ref` may be a string, or an array of strings. If ref is an array of strings, it is passed to normRefList.
    if (ref instanceof Array) {
      return sefaria_Sefaria.normRefList(ref);
    }
    var norm = sefaria_Sefaria.makeRef(sefaria_Sefaria.parseRef(ref));
    if (sefaria_typeof(norm) === "object" && "error" in norm) {
      // If the ref doesn't parse, just replace spaces with undescores.
      return typeof ref === "string" ? ref.replace(/ /g, "_") : ref;
    }
    return norm;
  },
  humanRef: function humanRef(ref) {
    // Returns a string of the normalized form of `ref`.
    // `ref` may be a string, or an array of strings. If ref is an array of strings, it is passed to normRefList.
    ref = sefaria_Sefaria.normRef(ref);
    var pRef = sefaria_Sefaria.parseRef(ref);
    if (pRef.error) {
      return ref;
    }
    if (pRef.sections.length === 0) {
      return pRef.book;
    }
    var book = pRef.book + " ";
    var hRef = pRef.ref.replace(/ /g, ":");
    return book + hRef.slice(book.length);
  },
  isRef: function isRef(ref) {
    // Returns true if `ref` appears to be a ref relative to known books in Sefaria.books
    var q = sefaria_Sefaria.parseRef(ref);
    return "book" in q && q.book;
  },
  normRefList: function normRefList(refs) {
    // Returns a single string ref corresponding the range expressed in the list of `refs`
    // e.g. ["Genesis 1:4", "Genesis 1:5", "Genesis 1:6"] -> "Genesis 1:4-6"
    if (refs.length === 1) {
      return refs[0];
    }
    var pRef = sefaria_Sefaria.parseRef(refs[0]);
    var pRefEnd = sefaria_Sefaria.parseRef(refs[refs.length - 1]);
    if (pRef.book !== pRefEnd.book) {
      return refs[0]; // We don't handle ranges over multiple nodes of complex texts
    }

    var nRef = sefaria_Sefaria.util.clone(pRef);
    nRef.toSections = pRefEnd.toSections;
    return sefaria_Sefaria.makeRef(nRef);
  },
  joinRefList: function joinRefList(refs, lang) {
    // Returns a string Ref in `lang` that corresponds to the range of refs in `refs`
    // Hebrew results depend on `refs` being available in the refs cache.
    //only use for display as it doesn't rely on any ref parsing!
    //since this is just string manipulation it works language agnostically.
    //does not work well in cases like Genesis 1:10, Genesis 1:15 (will return Genesis 1:10-5). Needs fixing
    //Deuteronomy 11:32-2:1 instead of Deuteronomy 11:32-12:1
    var refStrAttr = {
      "he": "heRef",
      "en": "ref"
    }[lang];
    if (!refs.length) {
      return null;
    }
    var start, end;
    if (refs[0].indexOf("-") != -1) {
      // did we get a ranged ref for some reason inside the arguemnts
      var startSplit = sefaria_Sefaria.splitRangingRef(refs[0]);
      start = sefaria_Sefaria.getRefFromCache(startSplit[0]);
    } else {
      start = sefaria_Sefaria.getRefFromCache(refs[0]);
    }
    if (!start) {
      // We don't have this ref in cache, fall back to normRefList and sorry no Hebrew
      return sefaria_Sefaria.humanRef(sefaria_Sefaria.normRefList(refs));
    }
    start = start[refStrAttr];
    if (refs[refs.length - 1].indexOf("-") != -1) {
      var endSplit = sefaria_Sefaria.splitRangingRef(refs[refs.length - 1]);
      end = sefaria_Sefaria.getRefFromCache(endSplit[endSplit.length - 1])[refStrAttr];
    } else {
      end = sefaria_Sefaria.getRefFromCache(refs[refs.length - 1])[refStrAttr];
    }
    //deal with case where this doesnt exist in cache with getName or a new function o combine refs from server side

    //TODO handle ranged refs as input
    if (start == end) {
      return start;
    }
    //break down refs into textual part and "numeric "address parts, the comparison of the numeric parts has to be atomic and not char by char
    var lastSpaceStart = start.lastIndexOf(" ");
    var namedPartStart = start.substr(0, lastSpaceStart);
    var addressPartStart = start.substr(lastSpaceStart + 1).split(":");
    var lastSpaceEnd = end.lastIndexOf(" ");
    var namedPartEnd = end.substr(0, lastSpaceEnd);
    var addressPartEnd = end.substr(lastSpaceEnd + 1).split(":");
    if (namedPartStart != namedPartEnd) {
      //the string part is different already, so the numeric parts will be for sure separated correctly.
      //works mostly for ranged complex text refs
      var similarpart = sefaria_Sefaria.util.commonSubstring(start, end);
      var startDiff = start.substring(similarpart.length, start.length);
      var endDiff = end.substring(similarpart.length, end.length);
      return "".concat(similarpart).concat(startDiff, "-").concat(endDiff);
    } else {
      var similaraddrs = [];
      var addrLength = Math.min(addressPartStart.length, addressPartEnd.length);
      var index = 0;
      while (index < addrLength && addressPartStart[index] === addressPartEnd[index]) {
        similaraddrs.push(addressPartStart[index]);
        index++;
      }
      var addrStr = similaraddrs.join(":") + (index == 0 ? "" : ":") + addressPartStart.slice(index).join(":") + "-" + addressPartEnd.slice(index).join(":");
      return "".concat(namedPartStart, " ").concat(addrStr);
    }
  },
  refContains: function refContains(ref1, ref2) {
    // Returns true is `ref1` contains `ref2`
    var oRef1 = sefaria_Sefaria.parseRef(ref1);
    var oRef2 = sefaria_Sefaria.parseRef(ref2);
    //need to convert to ints, add ancestors for complex and copy logic from server

    if ("error" in oRef1 || "error" in oRef2) {
      return null;
    }

    //We need numerical representations of the sections, and not to trip up on talmud sections
    if (oRef2.index !== oRef2.index || oRef1.book !== oRef2.book) {
      return false;
    }
    var _map = [oRef1.sections, oRef1.toSections, oRef2.sections, oRef2.toSections].map(function (arr) {
        return arr.map(function (x) {
          return x.match(/\d+[ab]/) ? sefaria_Sefaria.hebrew.dafToInt(x) : parseInt(x);
        });
      }),
      _map2 = sefaria_slicedToArray(_map, 4),
      oRef1sections = _map2[0],
      oRef1toSections = _map2[1],
      oRef2sections = _map2[2],
      oRef2toSections = _map2[3];
    var sectionsLen = Math.min(oRef1sections.length, oRef2sections.length);
    //duplicated from server side logic to finally fix
    for (var i = 0; i < sectionsLen; i++) {
      if (oRef2toSections[i] > oRef1toSections[i]) {
        return false;
      }
      if (oRef2toSections[i] < oRef1toSections[i]) {
        break;
      }
    }
    for (var _i3 = 0; _i3 < sectionsLen; _i3++) {
      if (oRef2sections[_i3] < oRef1sections[_i3]) {
        return false;
      }
      if (oRef2sections[_i3] > oRef1sections[_i3]) {
        break;
      }
    }
    return true;
  },
  refCategories: function refCategories(ref) {
    // Returns the text categories for `ref`
    var pRef = sefaria_Sefaria.parseRef(ref);
    if ("error" in pRef) {
      return [];
    }
    var index = sefaria_Sefaria.index(pRef.index);
    return index && index.categories ? index.categories : [];
  },
  sectionRef: function sectionRef(ref) {
    // Returns the section level ref for `ref` or null if no data is available
    var oref = this.getRefFromCache(ref);
    return oref ? oref.sectionRef : null;
  },
  splitSpanningRefNaive: function splitSpanningRefNaive(ref) {
    if (ref.indexOf("-") == -1) {
      return ref;
    }
    return ref.split("-");
  },
  splitRangingRef: function splitRangingRef(ref) {
    // Returns an array of segment level refs which correspond to the ranging `ref`
    // e.g. "Genesis 1:1-2" -> ["Genesis 1:1", "Genesis 1:2"]
    if (!ref || sefaria_typeof(ref) === "object" || typeof ref === "undefined") {
      debugger;
    }
    if (ref.indexOf("-") == -1) {
      return [ref];
    }
    var oRef = sefaria_Sefaria.parseRef(ref);
    var isDepth1 = oRef.sections.length === 1;
    var textData = sefaria_Sefaria.getTextFromCache(ref);
    if (textData) {
      return sefaria_Sefaria.makeSegments(textData).map(function (segment) {
        return segment.ref;
      });
    } else if (!isDepth1 && oRef.sections[oRef.sections.length - 2] !== oRef.toSections[oRef.sections.length - 2]) {
      // TODO handle spanning refs when no text data is available to answer how many segments are in each section.
      // e.g., in "Shabbat 2a:5-2b:8", what is the last segment of Shabbat 2a?
      // For now, just return the split of the first non-spanning ref.
      var newRef = sefaria_Sefaria.util.clone(oRef);
      newRef.toSections = newRef.sections;
      return sefaria_Sefaria.splitRangingRef(this.humanRef(this.makeRef(newRef)));
    } else {
      var refs = [];
      var start = oRef.sections[oRef.sections.length - 1];
      var end = oRef.toSections[oRef.sections.length - 1];
      for (var i = parseInt(start); i <= parseInt(end); i++) {
        var _newRef = sefaria_Sefaria.util.clone(oRef);
        _newRef.sections[oRef.sections.length - 1] = i;
        _newRef.toSections[oRef.sections.length - 1] = i;
        refs.push(this.humanRef(this.makeRef(_newRef)));
      }
      return refs;
    }
  },
  /**
   * Helps the BookPage toc translate the given integer to the correctly formatted display string for the section given the varying address types. 
   * @param {string} addressType - The address type of the schema being requested
   * @param {number} i - The numeric section string from the database
   * @param {number} offset - If needed, an offest to allow section addresses that do not start counting with 0
   * @returns {[string,string]} Section string in both languages. 
   */
  getSectionStringByAddressType: function getSectionStringByAddressType(addressType, i) {
    var offset = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    var section = i + offset;
    var enSection, heSection;
    if (addressType === 'Talmud') {
      enSection = sefaria_Sefaria.hebrew.intToDaf(section);
      heSection = sefaria_Sefaria.hebrew.encodeHebrewDaf(enSection);
    } else if (addressType === "Year") {
      enSection = section + 1241;
      heSection = sefaria_Sefaria.hebrew.encodeHebrewNumeral(section + 1);
      heSection = heSection.slice(0, -1) + '"' + heSection.slice(-1);
    } else if (addressType === "Folio") {
      enSection = sefaria_Sefaria.hebrew.intToFolio(section);
      heSection = sefaria_Sefaria.hebrew.encodeHebrewFolio(enSection);
    } else {
      enSection = section + 1;
      heSection = sefaria_Sefaria.hebrew.encodeHebrewNumeral(section + 1);
    }
    return [enSection, heSection];
  },
  titlesInText: function titlesInText(text) {
    // Returns an array of the known book titles that appear in text.
    return sefaria_Sefaria.books.filter(function (title) {
      return text.indexOf(title) > -1;
    });
  },
  makeRefRe: function makeRefRe(titles) {
    // Construct and store a Regular Expression for matching citations
    // based on known books, or a list of titles explicitly passed
    titles = titles || sefaria_Sefaria.books;
    var books = "(" + titles.map(RegExp.escape).join("|") + ")";
    var refReStr = books + " (\\d+[ab]?)(?:[:., ]+)?(\\d+)?(?:(?:[\\-–])?(\\d+[ab]?)?(?:[:., ]+)?(\\d+)?)?";
    return new RegExp(refReStr, "gi");
  },
  wrapRefLinks: function wrapRefLinks(text) {
    if (typeof text !== "string" || text.indexOf("data-ref") !== -1) {
      return text;
    }
    var titles = sefaria_Sefaria.titlesInText(text);
    if (titles.length === 0) {
      return text;
    }
    var refRe = sefaria_Sefaria.makeRefRe(titles);
    var replacer = function replacer(match, p1, p2, p3, p4, p5) {
      // p1: Book
      // p2: From section
      // p3: From segment
      // p4: To section
      // p5: To segment
      var uref, nref, r;
      uref = p1 + "." + p2;
      nref = p1 + " " + p2;
      if (p3) {
        uref += "." + p3;
        nref += ":" + p3;
      }
      if (p4) {
        uref += "-" + p4;
        nref += "-" + p4;
      }
      if (p5) {
        uref += "." + p5;
        nref += ":" + p5;
      }
      r = '<span class="refLink" data-ref="' + uref + '">' + nref + '</span>';
      if (match.slice(-1)[0] === " ") {
        r = r + " ";
      }
      return r;
    };
    return text.replace(refRe, replacer);
  },
  _texts: {},
  // cache for data from /api/texts/
  _refmap: {},
  // Mapping of simple ref/context keys to the (potentially) versioned key for that ref in _texts.
  _complete_text_settings: function _complete_text_settings() {
    var s = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
    var settings = s || {};
    settings = {
      commentary: settings.commentary || 0,
      context: settings.context || 0,
      pad: settings.pad || 0,
      enVersion: settings.enVersion || null,
      heVersion: settings.heVersion || null,
      multiple: settings.multiple || 0,
      stripItags: settings.stripItags || 0,
      wrapLinks: "wrapLinks" in settings ? settings.wrapLinks : 1,
      wrapNamedEntities: "wrapNamedEntities" in settings ? settings.wrapNamedEntities : 1,
      translationLanguagePreference: settings.translationLanguagePreference || null,
      versionPref: settings.versionPref || null,
      firstAvailableRef: "firstAvailableRef" in settings ? settings.firstAvailableRef : 1,
      fallbackOnDefaultVersion: "fallbackOnDefaultVersion" in settings ? settings.fallbackOnDefaultVersion : 1
    };
    if (settings.versionPref) {
      // for every lang/vtitle pair in versionPref, update corresponding version url param if it doesn't already exist
      for (var _i4 = 0, _Object$entries = Object.entries(settings.versionPref); _i4 < _Object$entries.length; _i4++) {
        var _ref = _Object$entries[_i4];
        var _ref2 = sefaria_slicedToArray(_ref, 2);
        var vlang = _ref2[0];
        var vtitle = _ref2[1];
        var versionPrefKey = "".concat(vlang, "Version");
        if (!settings[versionPrefKey]) {
          settings[versionPrefKey] = vtitle;
        }
      }
    }
    return settings;
  },
  getTextFromCache: function getTextFromCache(ref, settings) {
    settings = this._complete_text_settings(settings);
    var key = this._textKey(ref, settings);
    if (key in this._texts) {
      return this._getOrBuildTextData(key, settings);
    }
    return null;
  },
  getText: function getText(ref, settings) {
    // returns a promise
    settings = this._complete_text_settings(settings);
    var data = this.getTextFromCache(ref, settings);
    if (data && !("updateFromAPI" in data)) {
      return Promise.resolve(data);
    }
    return this._ApiPromise(sefaria_Sefaria.apiHost + this._textUrl(ref, settings)).then(function (d) {
      var _d$versions;
      //swap out original versions from the server with the ones that Sefaria client side has sorted and updated with some fields.
      // This happens before saving the text to cache so that both caches are consistent
      if (d !== null && d !== void 0 && (_d$versions = d.versions) !== null && _d$versions !== void 0 && _d$versions.length) {
        var versions = sefaria_Sefaria._saveVersions(d.sectionRef, d.versions);
        d.versions = sefaria_Sefaria._makeVersions(versions, false);
      }
      sefaria_Sefaria._saveText(d, settings);
      return d;
    });
  },
  _bulkTexts: {},
  getBulkText: function getBulkText(refs) {
    var _this = this;
    var asSizedString = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
    var minChar = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    var maxChar = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;
    var transLangPref = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;
    if (refs.length === 0) {
      return Promise.resolve({});
    }
    var MAX_URL_LENGTH = 3800;
    var hostStr = "".concat(sefaria_Sefaria.apiHost, "/api/bulktext/");
    var paramStr = '';
    for (var _i5 = 0, _Object$entries2 = Object.entries({
        asSizedString: asSizedString,
        minChar: minChar,
        maxChar: maxChar,
        transLangPref: transLangPref
      }); _i5 < _Object$entries2.length; _i5++) {
      var _ref3 = _Object$entries2[_i5];
      var _ref4 = sefaria_slicedToArray(_ref3, 2);
      var paramKey = _ref4[0];
      var paramVal = _ref4[1];
      paramStr = !!paramVal ? paramStr + "&".concat(paramKey, "=").concat(paramVal) : paramStr;
    }
    paramStr = paramStr.replace(/&/, '?');

    // Split into multiple requests if URL length goes above limit
    var refStrs = [""];
    refs.map(function (ref) {
      var last = refStrs[refStrs.length - 1];
      if (encodeURI("".concat(hostStr).concat(last, "|").concat(ref).concat(paramStr)).length > MAX_URL_LENGTH) {
        refStrs.push(ref);
      } else {
        refStrs[refStrs.length - 1] += last.length ? "|".concat(ref) : ref;
      }
    });
    var promises = refStrs.map(function (refStr) {
      return _this._cachedApiPromise({
        url: "".concat(hostStr).concat(refStr).concat(paramStr),
        key: refStr + paramStr,
        store: _this._bulkTexts
      });
    });
    return Promise.all(promises).then(function (results) {
      return Object.assign.apply(Object, [{}].concat(sefaria_toConsumableArray(results)));
    });
  },
  _bulkSheets: {},
  getBulkSheets: function getBulkSheets(sheetIds) {
    if (sheetIds.length === 0) {
      return Promise.resolve({});
    }
    var idStr = sheetIds.join("|");
    return this._cachedApiPromise({
      url: "".concat(sefaria_Sefaria.apiHost, "/api/v2/sheets/bulk/").concat(idStr),
      key: idStr,
      store: this._bulkSheets
    });
  },
  text: function text(ref) {
    var settings = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    var cb = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    // To be deprecated in favor of `getText`
    if (!ref || sefaria_typeof(ref) === "object" || typeof ref === "undefined") {
      debugger;
    }
    settings = this._complete_text_settings(settings);
    var key = this._textKey(ref, settings);
    if (!cb) {
      return this._getOrBuildTextData(key, settings);
    }
    if (key in this._texts && !("updateFromAPI" in this._texts[key])) {
      var data = this._getOrBuildTextData(key, settings);
      cb(data);
      return data;
    }
    this._api(sefaria_Sefaria.apiHost + this._textUrl(ref, settings), function (data) {
      var _data$versions;
      //save versions and then text so both caches have updated versions
      if (data !== null && data !== void 0 && (_data$versions = data.versions) !== null && _data$versions !== void 0 && _data$versions.length) {
        var versions = this._saveVersions(data.sectionRef, data.versions);
        data.versions = this._makeVersions(versions, false);
      }
      this._saveText(data, settings);
      cb(data);
    }.bind(this));
    return null;
  },
  ISOMap: {
    "ar": {
      "name": "Arabic",
      "nativeName": "عربى",
      "showTranslations": 1,
      "title": "نصوص يهودية بالعربية"
    },
    "de": {
      "name": "German",
      "nativeName": "Deutsch",
      "showTranslations": 1,
      "title": "Jüdische Texte in Deutscher Sprache"
    },
    "en": {
      "name": "English",
      "nativeName": "English",
      "showTranslations": 1,
      "title": "Jewish Texts in English"
    },
    "eo": {
      "name": "Esperanto",
      "nativeName": "Esperanto",
      "showTranslations": 1,
      "title": "Judaj Tekstoj en Esperanto"
    },
    "es": {
      "name": "Spanish",
      "nativeName": "Español",
      "showTranslations": 1,
      "title": "Textos Judíos en Español"
    },
    "fa": {
      "name": "Persian",
      "nativeName": "فارسی",
      "showTranslations": 1,
      "title": "متون یهودی به زبان فارسی"
    },
    "fi": {
      "name": "Finnish",
      "nativeName": "suomen kieli",
      "showTranslations": 1,
      "title": "Juutalaiset tekstit suomeksi"
    },
    "fr": {
      "name": "French",
      "nativeName": "Français",
      "showTranslations": 1,
      "title": "Textes juifs en français"
    },
    "he": {
      "name": "Hebrew",
      "nativeName": "עברית",
      "showTranslations": 0,
      "title": "ספריה בעברית"
    },
    "it": {
      "name": "Italian",
      "nativeName": "Italiano",
      "showTranslations": 1,
      "title": "Testi ebraici in italiano"
    },
    "lad": {
      "name": "Ladino",
      "nativeName": "Judeo-español",
      "showTranslations": 0
    },
    "pl": {
      "name": "Polish",
      "nativeName": "Polski",
      "showTranslations": 1,
      "title": "Teksty żydowskie w języku polskim"
    },
    "pt": {
      "name": "Portuguese",
      "nativeName": "Português",
      "showTranslations": 1,
      "title": "Textos judaicos em portugues"
    },
    "ru": {
      "name": "Russian",
      "nativeName": "Pусский",
      "showTranslations": 1,
      "title": "Еврейские тексты на русском языке"
    },
    "yi": {
      "name": "Yiddish",
      "nativeName": "יידיש",
      "showTranslations": 1,
      "title": "יידישע טעקסטן אויף יידיש"
    },
    "jrb": {
      "name": "Judeo-Arabic",
      "nativeName": "Arabia Yehudia",
      "showTranslations": 0
    } // nativeName in English because hard to determine correct native name
  },
  translateISOLanguageCode: function translateISOLanguageCode(code) {
    var _Sefaria$ISOMap, _Sefaria$ISOMap$code$;
    var _native = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
    //takes two-letter ISO 639.2 code and returns full language name
    var lookupVar = _native ? "nativeName" : "name";
    return ((_Sefaria$ISOMap = sefaria_Sefaria.ISOMap) === null || _Sefaria$ISOMap === void 0 ? void 0 : (_Sefaria$ISOMap$code$ = _Sefaria$ISOMap[code.toLowerCase()]) === null || _Sefaria$ISOMap$code$ === void 0 ? void 0 : _Sefaria$ISOMap$code$[lookupVar]) || code;
  },
  getHebrewTitle: function getHebrewTitle(slug) {
    return sefaria_Sefaria.ISOMap[slug] ? sefaria_Sefaria.ISOMap[slug]["title"] ? sefaria_Sefaria.ISOMap[slug]["title"] : "Jewish Texts in " + sefaria_Sefaria.ISOMap[slug]["name"] : "Jewish texts in " + slug;
  },
  _versions: {},
  _translateVersions: {},
  getVersionFromCache: function getVersionFromCache(ref, byLang, filter, excludeFilter) {
    var versions = this._cachedApi(ref, this._versions, []);
    return this._makeVersions(versions, byLang);
  },
  getVersions: function () {
    var _getVersions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(ref) {
      var _this2 = this;
      var versionsInCache, url;
      return _regeneratorRuntime().wrap(function _callee$(_context) {
        while (1) switch (_context.prev = _context.next) {
          case 0:
            /**
             * Gets versions from cache or API
             * @ref {string} ref
             * @returns {string: [versions]} Versions by language
             */
            versionsInCache = ref in this._versions;
            if (versionsInCache) {
              _context.next = 5;
              break;
            }
            url = sefaria_Sefaria.apiHost + "/api/texts/versions/" + sefaria_Sefaria.normRef(ref);
            _context.next = 5;
            return this._ApiPromise(url).then(function (d) {
              _this2._saveVersions(ref, d);
            });
          case 5:
            return _context.abrupt("return", Promise.resolve(this._versions[ref]));
          case 6:
          case "end":
            return _context.stop();
        }
      }, _callee, this);
    }));
    function getVersions(_x2) {
      return _getVersions.apply(this, arguments);
    }
    return getVersions;
  }(),
  filterVersionsObjByLangs: function filterVersionsObjByLangs(versionsObj, langs, includeFilter) {
    /**
     * @versionsObj {object} whode keys are language codes ('he', 'en' etc.) and values are version objects (like the object that getVersions returns)
     * @langs {array} of string of language codes
     * @includeFilter {boolean} true for returning the language in the langs param, false for returning other languages
     */
    return Object.keys(versionsObj).filter(function (lang) {
      return includeFilter === langs.includes(lang);
    }).reduce(function (obj, lang) {
      obj[lang] = versionsObj[lang];
      return obj;
    }, {});
  },
  filterVersionsArrayByAttr: function filterVersionsArrayByAttr(versionsArray, filterObj) {
    /**
     * @versionsArray {array} of version objects
     * @filterObj {object} keys are attribute of version objects and values are their values
     * returns an array of versions from versionsArray that has all the attributes and their values as in filterObj
     */
    return versionsArray.filter(function (version) {
      return Object.keys(filterObj).every(function (key) {
        return (version === null || version === void 0 ? void 0 : version[key]) === filterObj[key];
      });
    });
  },
  getSourceVersions: function () {
    var _getSourceVersions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(ref) {
      return _regeneratorRuntime().wrap(function _callee2$(_context2) {
        while (1) switch (_context2.prev = _context2.next) {
          case 0:
            return _context2.abrupt("return", sefaria_Sefaria.getVersions(ref).then(function (versions) {
              return sefaria_Sefaria.filterVersionsObjByLangs(versions, ['he'], true);
            }));
          case 1:
          case "end":
            return _context2.stop();
        }
      }, _callee2);
    }));
    function getSourceVersions(_x3) {
      return _getSourceVersions.apply(this, arguments);
    }
    return getSourceVersions;
  }(),
  getTranslations: function () {
    var _getTranslations = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(ref) {
      return _regeneratorRuntime().wrap(function _callee3$(_context3) {
        while (1) switch (_context3.prev = _context3.next) {
          case 0:
            return _context3.abrupt("return", sefaria_Sefaria.getVersions(ref).then(function (result) {
              var versions = sefaria_Sefaria.filterVersionsObjByLangs(result, ['he'], false);
              var heVersions = sefaria_Sefaria.filterVersionsArrayByAttr((result === null || result === void 0 ? void 0 : result.he) || [], {
                isBaseText: false
              });
              if (heVersions.length) {
                versions.he = heVersions;
              }
              return versions;
            }));
          case 1:
          case "end":
            return _context3.stop();
        }
      }, _callee3);
    }));
    function getTranslations(_x4) {
      return _getTranslations.apply(this, arguments);
    }
    return getTranslations;
  }(),
  _makeVersions: function _makeVersions(versions, byLang) {
    return byLang ? versions : Object.values(versions).flat();
  },
  _saveVersions: function _saveVersions(ref, versions) {
    var _iterator = sefaria_createForOfIteratorHelper(versions),
      _step;
    try {
      for (_iterator.s(); !(_step = _iterator.n()).done;) {
        var v = _step.value;
        sefaria_Sefaria._translateVersions[sefaria_Sefaria.getTranslateVersionsKey(v.versionTitle, v.language)] = {
          en: v.versionTitle,
          he: !!v.versionTitleInHebrew ? v.versionTitleInHebrew : v.versionTitle
        };
      }
    } catch (err) {
      _iterator.e(err);
    } finally {
      _iterator.f();
    }
    this._versions[ref] = this._sortVersionsIntoBuckets(versions);
    return this._versions[ref];
  },
  _sortVersionsIntoBuckets: function _sortVersionsIntoBuckets(versions) {
    var versionStore = {};
    //let generalCount = 0;
    var _iterator2 = sefaria_createForOfIteratorHelper(versions),
      _step2;
    try {
      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
        var v = _step2.value;
        //generalCount++;
        var matches = v.versionTitle.match(new RegExp("\\[([a-z]{2,3})\\]$")); // two-letter ISO language code
        var lang = matches ? matches[1] : v.language;
        v.actualLanguage = lang; //add actual language onto the object. Hopefully its then available always.
        //Sort each language into its own bucket
        versionStore[lang] = !!versionStore[lang] ? versionStore[lang].concat(v) : [v];
      }
    } catch (err) {
      _iterator2.e(err);
    } finally {
      _iterator2.f();
    }
    return versionStore;
  },
  transformVersionObjectsToByActualLanguageKeys: function transformVersionObjectsToByActualLanguageKeys(versionObjects) {
    //not related to above, used to turn curent version object in client code into an object mapped by the real language vs just "he/"en
    return Object.entries(versionObjects).filter(function (_ref5) {
      var _ref6 = sefaria_slicedToArray(_ref5, 2),
        lang = _ref6[0],
        v = _ref6[1];
      return !!v;
    }).reduce(function (obj, _ref7) {
      var _ref8 = sefaria_slicedToArray(_ref7, 2),
        lang = _ref8[0],
        version = _ref8[1];
      if (version !== null && version !== void 0 && version.merged) {
        //this would be the best guess of the merged language's version currently
        obj[lang] = version;
      } else if (version !== null && version !== void 0 && version.actualLanguage) {
        obj[version.actualLanguage] = version;
      }
      return obj;
    }, {});
  },
  getTranslateVersionsKey: function getTranslateVersionsKey(vTitle, lang) {
    return "".concat(vTitle, "|").concat(lang);
  },
  deconstructVersionsKey: function deconstructVersionsKey(versionsKey) {
    return versionsKey.split('|');
  },
  setVersionPreference: function setVersionPreference(sref, vtitle, lang) {
    if (lang !== 'en') {
      return;
    } // Currently only tracking preferences for translations
    var title = sefaria_Sefaria.parseRef(sref).index;
    var corpus = sefaria_Sefaria.index(title).corpus;
    sefaria_Sefaria.versionPreferences = sefaria_Sefaria.versionPreferences.update(corpus, vtitle, lang);
    sefaria_Sefaria.track.event("Reader", "Set Version Preference", "".concat(corpus, "|").concat(vtitle, "|").concat(lang));
    sefaria_Sefaria.editProfileAPI({
      version_preferences_by_corpus: sefaria_defineProperty({}, corpus, sefaria_defineProperty({}, lang, vtitle))
    });
  },
  getLicenseMap: function getLicenseMap() {
    var licenseMap = {
      "Public Domain": "https://en.wikipedia.org/wiki/Public_domain",
      "CC0": "https://creativecommons.org/publicdomain/zero/1.0/",
      "CC-BY": "https://creativecommons.org/licenses/by/3.0/",
      "CC-BY-SA": "https://creativecommons.org/licenses/by-sa/3.0/",
      "CC-BY-NC": "https://creativecommons.org/licenses/by-nc/4.0/"
    };
    return licenseMap;
  },
  _textUrl: function _textUrl(ref, settings) {
    // copy the parts of settings that are used as parameters, but not other
    var params = param({
      commentary: settings.commentary,
      context: settings.context,
      pad: settings.pad,
      wrapLinks: settings.wrapLinks,
      wrapNamedEntities: settings.wrapNamedEntities,
      multiple: settings.multiple,
      stripItags: settings.stripItags,
      transLangPref: settings.translationLanguagePreference,
      firstAvailableRef: settings.firstAvailableRef,
      fallbackOnDefaultVersion: settings.fallbackOnDefaultVersion
    });
    var url = "/api/texts/" + sefaria_Sefaria.normRef(ref);
    if (settings.enVersion) {
      url += "&ven=" + encodeURIComponent(settings.enVersion.replace(/ /g, "_"));
    }
    if (settings.heVersion) {
      url += "&vhe=" + encodeURIComponent(settings.heVersion.replace(/ /g, "_"));
    }
    url += "&" + params;
    return url.replace("&", "?"); // make sure first param has a '?'
  },

  _textKey: function _textKey(ref, settings) {
    // Returns a string used as a key for the cache object of `ref` given `settings`.
    if (!ref) {
      debugger;
    }
    var key = ref.toLowerCase();
    if (settings) {
      if (settings.enVersion) {
        key += "&ven=" + settings.enVersion;
      }
      if (settings.heVersion) {
        key += "&vhe=" + settings.heVersion;
      }
      if (settings.translationLanguagePreference) {
        key += "&transLangPref=" + settings.translationLanguagePreference;
      }
      if (settings.fallbackOnDefaultVersion) {
        key += "|FALLBACK_ON_DEFAULT_VERSION";
      }
      key = settings.context ? key + "|CONTEXT" : key;
    }
    return key;
  },
  _refKey: function _refKey(ref, settings) {
    // Returns the key for this ref without any version/language elements
    if (!ref) {
      debugger;
    }
    var key = ref.toLowerCase();
    if (settings) {
      key = settings.context ? key + "|CONTEXT" : key;
    }
    return key;
  },
  _getOrBuildTextData: function _getOrBuildTextData(key, settings) {
    var cached = this._texts[key];
    if (!cached || !cached.buildable) {
      return cached;
    }

    // clone the segment, add text from the section ref
    var segmentData = sefaria_Sefaria.util.clone(this._texts[this._textKey(cached.ref, extend(settings, {
      context: 0
    }))]);
    var contextData = this._texts[this._textKey(cached.sectionRef, extend(settings, {
      context: 0
    }))] || this._texts[this._textKey(cached.sectionRef, extend(settings, {
      context: 1
    }))];
    segmentData.text = contextData.text;
    segmentData.he = contextData.he;
    return segmentData;
    // Should we be saving the built data?
  },

  _saveText: function _saveText(data, settings) {
    var _this3 = this;
    if (Array.isArray(data)) {
      data.map(function (d) {
        return _this3._saveText(d, settings);
      });
      return;
    }
    if (!data || "error" in data) {
      return;
    }
    settings = settings || {};
    var key = this._textKey(data.ref, settings);
    this._texts[key] = data;
    //console.log("Saving", key);
    var refkey = this._refKey(data.ref, settings);
    this._refmap[refkey] = key;
    var isSectionLevel = data.sections.length !== data.sectionNames.length;
    if (isSectionLevel && !data.isSpanning) {
      // Save data in buckets for each segment
      this._splitTextSection(data, settings);
    }
    if (settings.context) {
      // Save a copy of the data at section level with & without context flag
      var newData = sefaria_Sefaria.util.clone(data);
      newData.ref = data.sectionRef;
      newData.heRef = data.heSectionRef;
      if (!isSectionLevel) {
        newData.sections = data.sections.slice(0, -1);
        newData.toSections = data.toSections.slice(0, -1);
      }
      var newSettings = sefaria_Sefaria.util.clone(settings);
      // Note: data for section level refs is identical when called with or without context,
      // but both are saved in cache for code paths that may always call with or without context.
      if (!isSectionLevel) {
        // Segment level ref with context, save section level marked with context
        this._saveText(newData, newSettings);
      }
      // Any level ref with context, save section level marked without context
      newSettings.context = 0;
      this._saveText(newData, newSettings);
    }
    if (data.isSpanning) {
      var spanningContextSettings = sefaria_Sefaria.util.clone(settings);
      spanningContextSettings.context = 1;
      for (var i = 0; i < data.spanningRefs.length; i++) {
        // For spanning refs, request each section ref to prime cache.
        // console.log("calling spanning prefetch " + data.spanningRefs[i])
        sefaria_Sefaria.getText(data.spanningRefs[i], spanningContextSettings);
      }
    }
  },
  _get_offsets: function _get_offsets(data) {
    var _data$index_offsets_b;
    var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
    var offsets = (data === null || data === void 0 ? void 0 : (_data$index_offsets_b = data.index_offsets_by_depth) === null || _data$index_offsets_b === void 0 ? void 0 : _data$index_offsets_b[data.textDepth]) || Array(length).fill(0);
    offsets = typeof offsets === 'number' ? [offsets] : offsets.flat();
    return offsets;
  },
  _splitTextSection: function _splitTextSection(data, settings) {
    // Takes data for a section level text and populates cache with segment levels.
    // Don't do this for Refs above section level, like "Rashi on Genesis 1",
    // since it's impossible to correctly derive next & prev.

    // No splits needed for segments
    if (data.textDepth === data.sections.length) {
      return;
    }
    var isSuperSection = data.textDepth == data.sections.length + 2;
    settings = settings || {};
    var en = typeof data.text === "string" ? [data.text] : data.text;
    var he = typeof data.he === "string" ? [data.he] : data.he;
    // Pad the shorter array to make stepping through them easier.
    var length = Math.max(en.length, he.length);
    en = en.pad(length, "");
    he = he.pad(length, "");
    var delim = data.ref === data.book ? " " : ":";
    var offset = this._get_offsets(data);
    var start = data.textDepth === data.sections.length ? data.sections[data.textDepth - 1] : 1 + offset[0];
    var prev = Array(length);
    var next = Array(length);
    if (isSuperSection) {
      // For supersections, correctly set next and prev on each section to skip empty content
      var hasContent = Array(length);
      for (var i = 0; i < length; i++) {
        hasContent[i] = !!en[i].length || !!he[i].length;
      }
      prev[0] = data.prev;
      for (var _i6 = 1; _i6 < length; _i6++) {
        prev[_i6] = hasContent[_i6 - 1] ? data.ref + delim + (_i6 - 1 + start) : prev[_i6 - 1];
      }
      next[length - 1] = data.next;
      for (var _i7 = length - 2; _i7 >= 0; _i7--) {
        next[_i7] = hasContent[_i7 + 1] ? data.ref + delim + (_i7 + 1 + start) : next[_i7 + 1];
      }
    }
    for (var _i8 = 0; _i8 < length; _i8++) {
      var ref = data.ref + delim + (_i8 + start);
      var segment_data = sefaria_Sefaria.util.clone(data);
      var sectionRef = isSuperSection ? data.ref + delim + (_i8 + 1) : data.sectionRef;
      extend(segment_data, {
        ref: ref,
        heRef: data.heRef + delim + sefaria_Sefaria.hebrew.encodeHebrewNumeral(_i8 + start),
        text: en[_i8],
        he: he[_i8],
        sections: data.sections.concat(_i8 + 1),
        toSections: data.sections.concat(_i8 + 1),
        sectionRef: sectionRef,
        next: isSuperSection ? next[_i8] : data.next,
        prev: isSuperSection ? prev[_i8] : data.prev,
        nextSegment: _i8 + start === length ? data.next + delim + 1 : data.ref + delim + (_i8 + start + 1),
        prevSegment: _i8 + start === 1 ? null : data.ref + delim + (_i8 + start - 1)
      });
      var context_settings = {};
      if (settings.enVersion) {
        context_settings.enVersion = settings.enVersion;
      }
      if (settings.heVersion) {
        context_settings.heVersion = settings.heVersion;
      }
      this._saveText(segment_data, context_settings);
      context_settings.context = 1;
      var contextKey = this._textKey(ref, context_settings);
      this._texts[contextKey] = {
        buildable: "Add Context",
        ref: ref,
        sectionRef: sectionRef,
        updateFromAPI: data.updateFromAPI
      };
      var refkey = this._refKey(ref, context_settings);
      this._refmap[refkey] = contextKey;
    }
  },
  /*  Not used?
  _splitSpanningText: function(data) {
  // Returns an array of section level data, corresponding to spanning `data`.
  // Assumes `data` includes context.
  var sections = [];
  var en = data.text;
  var he = data.he;
  var length = Math.max(en.length, he.length);
  en = en.pad(length, []);
  he = he.pad(length, []);
  var length = Math.max(data.text.length, data.he.length);
  for (var i = 0; i < length; i++) {
    var section        = Sefaria.util.clone(data);
    section.text       = en[i];
    section.he         = he[i];
  }
  },
   */

  /* not used?
  _wrapRefs: function(data) {
  // Wraps citations found in text of data
  if (!data.text) { return data; }
  if (typeof data.text === "string") {
    data.text = Sefaria.wrapRefLinks(data.text);
  } else {
    data.text = data.text.map(Sefaria.wrapRefLinks);
  }
  return data;
  }, */
  _index: {},
  // Cache for text index records
  index: function index(text, _index) {
    if (!_index) {
      return this._index[text];
    } else if (text in this._index) {
      this._index[text] = extend(this._index[text], _index);
    } else {
      this._index[text] = _index;
    }
  },
  _shape: {},
  // Cache for shape records
  getShape: function getShape(title) {
    return this._cachedApiPromise({
      url: this.apiHost + "/api/shape/" + title,
      key: title,
      store: this._shape
    });
  },
  _tocOrderLookup: {},
  _cacheFromToc: function _cacheFromToc(tocBranch) {
    var parentsPath = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "";
    var parentsOrders = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
    var rewrittenFrom = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "";
    var rewrittenTo = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : "";
    // Cache:
    // - Index Data
    // - Search TOC order
    for (var i = 0; i < tocBranch.length; i++) {
      var thisOrder = parentsOrders.concat([i]);
      var thisPath = (parentsPath ? parentsPath + "/" : "") + ("category" in tocBranch[i] ? tocBranch[i].category : tocBranch[i].title);
      if (tocBranch[i].searchRoot) {
        rewrittenFrom = thisPath;
        rewrittenTo = tocBranch[i].searchRoot + "/" + tocBranch[i].category;
        thisOrder = [100].concat(thisOrder);
        sefaria_Sefaria._tocOrderLookup[rewrittenTo] = thisOrder;
      } else if (rewrittenFrom) {
        var new_path = thisPath.replace(RegExp("^" + rewrittenFrom), rewrittenTo);
        sefaria_Sefaria._tocOrderLookup[new_path] = thisOrder;
      } else {
        sefaria_Sefaria._tocOrderLookup[thisPath] = thisOrder;
      }
      if ("category" in tocBranch[i]) {
        sefaria_Sefaria._translateTerms[tocBranch[i].category] = {
          "en": tocBranch[i].category,
          "he": tocBranch[i].heCategory
        };
        if (tocBranch[i].contents) {
          sefaria_Sefaria._cacheFromToc(tocBranch[i].contents, thisPath, thisOrder, rewrittenFrom, rewrittenTo);
        }
      } else {
        sefaria_Sefaria.index(tocBranch[i].title, tocBranch[i]);
      }
    }
  },
  compareSearchCatPaths: function compareSearchCatPaths(a, b) {
    // Given two paths, sort according to the cached numeric arrays of their locations in the toc
    var aPath = sefaria_Sefaria._tocOrderLookup[a];
    var bPath = sefaria_Sefaria._tocOrderLookup[b];
    if (!(Array.isArray(aPath) && Array.isArray(bPath))) {
      console.log("Failed to compare paths: ".concat(a, " and ").concat(b));
      return 0;
    }

    // Favor the earliest lesser number
    for (var i = 0; i < Math.min(aPath.length, bPath.length); i++) {
      if (aPath[i] === bPath[i]) {
        continue;
      }
      return aPath[i] < bPath[i] ? -1 : 1;
    }

    // Otherwise, favor the one higher in the toc
    return aPath.length < bPath.length ? -1 : 1;
  },
  _indexDetails: {},
  getIndexDetailsFromCache: function getIndexDetailsFromCache(title) {
    return this._cachedApi(title, this._indexDetails, null);
  },
  getIndexDetails: function getIndexDetails(title) {
    return this._cachedApiPromise({
      url: sefaria_Sefaria.apiHost + "/api/v2/index/" + title + "?with_content_counts=1&with_related_topics=1",
      key: title,
      store: this._indexDetails
    });
  },
  titleIsTorah: function titleIsTorah(title) {
    var torah_re = /^(Genesis|Exodus|Leviticus|Numbers|Deuteronomy)/;
    return torah_re.test(title);
  },
  postSegment: function postSegment(ref, versionTitle, language, text, success, error) {
    var _this4 = this;
    if (!versionTitle || !language) {
      return;
    }
    this.getName(ref, true).then(function (data) {
      if (!data.is_segment) {
        return;
      }
      var d = {
        json: JSON.stringify({
          versionTitle: versionTitle,
          language: language,
          text: text
        })
      };
      sefariaJquery.ajax({
        dataType: "json",
        url: sefaria_Sefaria.apiHost + "/api/texts/" + data.url,
        data: d,
        type: "POST",
        // Clear cache with a sledgehammer.  May need more subtlety down the road.
        success: function (d) {
          this._texts = {};
          this._refmap = {};
          success(d);
        }.bind(_this4),
        error: error
      }, error);
    });
  },
  isFullSegmentImage: function isFullSegmentImage(text) {
    /**
     * Is `text` a segment with only an image
     * To distinguish from inline images
     * Returns `true` if yes.
     */
    var pattern = /^\s*<img\b[^>]*>\s*$/i;
    return pattern.test(text);
  },
  getRefFromCache: function getRefFromCache(ref) {
    if (!ref) return null;
    var versionedKey = this._refmap[this._refKey(ref)] || this._refmap[this._refKey(ref, {
      context: 1
    })];
    if (versionedKey) {
      return this._getOrBuildTextData(versionedKey);
    }
    return null;
  },
  getRef: function getRef(ref) {
    // Returns Promise for parsed ref info
    if (!ref) {
      return Promise.reject(new Error("No Ref!"));
    }
    var r = this.getRefFromCache(ref);
    if (r) return Promise.resolve(r);

    // To avoid an extra API call, first look for any open API calls to this ref (regardless of params)
    // todo: Ugly.  Breaks abstraction.
    var urlPattern = "/api/texts/" + this.normRef(ref);
    var openApiCalls = Object.keys(this._ajaxObjects);
    for (var i = 0; i < openApiCalls.length; i++) {
      if (openApiCalls[i].startsWith(urlPattern)) {
        return this._ajaxObjects[openApiCalls[i]];
      }
    }

    // If no open calls found, call the texts API.
    // Called with context:1 because this is our most common mode, maximize change of saving an API Call
    return sefaria_Sefaria.getText(ref, {
      context: 1
    });
  },
  ref: function ref(_ref9, callback) {
    if (callback) {
      throw new Error("Use of Sefaria.ref() with a callback has been deprecated in favor of Sefaria.getRef()");
    }
    return _ref9 ? this.getRefFromCache(_ref9) : null;
  },
  _lookups: {},
  // getName w/ refOnly true should work as a replacement for parseRef - it uses a callback rather than return value.  Besides that - same data.
  getName: function getName(name) {
    var refOnly = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
    var limit = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;
    var trimmed_name = name.trim();
    var params = {};
    if (refOnly) {
      params["ref_only"] = 1;
    }
    if (limit != undefined) {
      params["limit"] = limit;
    }
    var queryString = Object.keys(params).map(function (key) {
      return key + '=' + params[key];
    }).join('&');
    queryString = queryString ? "?" + queryString : "";
    return this._cachedApiPromise({
      url: this.apiHost + "/api/name/" + encodeURIComponent(trimmed_name) + queryString,
      key: trimmed_name + queryString,
      store: this._lookups
    });
  },
  _lexiconCompletions: {},
  lexiconCompletion: function lexiconCompletion(word, lexicon, callback) {
    word = word.trim();
    var key = lexicon ? word + "/" + lexicon : word;
    if (key in this._lexiconCompletions) {
      callback(this._lexiconCompletions[key]);
      return null;
    }
    return sefariaJquery.ajax({
      dataType: "json",
      url: sefaria_Sefaria.apiHost + "/api/words/completion/" + word + (lexicon ? "/" + lexicon : ""),
      success: function (data) {
        this._lexiconCompletions[key] = data;
        callback(data);
      }.bind(this)
    });
  },
  _topicCompletions: {},
  getTopicCompletions: function getTopicCompletions(word, callback) {
    return this._cachedApiPromise({
      url: "".concat(sefaria_Sefaria.apiHost, "/api/topic/completion/").concat(word),
      key: word,
      store: sefaria_Sefaria._topicCompletions,
      processor: callback
    }); // this API is used instead of api/name because when we want all topics. api/name only gets topics with a minimum amount of sources
  },

  _lexiconLookups: {},
  getLexiconWords: function getLexiconWords(words, ref) {
    // Returns Promise which resolve to a list of lexicon entries for the given words
    ref = typeof ref !== "undefined" ? ref : null;
    words = typeof words !== "undefined" ? words : "";
    if (words.length <= 0) {
      return Promise.resolve([]);
    }
    words = words.normalize("NFC"); //make sure we normalize any errant unicode (vowels and diacritics that may appear to be equal but the underlying characters are out of order or different.
    var key = ref ? words + "|" + ref : words;
    var url = sefaria_Sefaria.apiHost + "/api/words/" + encodeURIComponent(words) + "?always_consonants=1&never_split=1" + (ref ? "&lookup_ref=" + encodeURIComponent(ref) : "");
    return this._cachedApiPromise({
      url: url,
      key: key,
      store: this._lexiconLookups
    });
  },
  _links: {},
  getLinks: function getLinks(ref) {
    var _this5 = this;
    // When there is an error in the returned data, this calls `reject` rather than returning empty.
    return new Promise(function (resolve, reject) {
      ref = sefaria_Sefaria.humanRef(ref);
      if (ref in _this5._links) {
        resolve(_this5._links[ref]);
      } else {
        var url = sefaria_Sefaria.apiHost + "/api/links/" + ref + "?with_text=0";
        var p = _this5._ApiPromise(url).then(function (data) {
          if ("error" in data) reject(data);
          _this5._saveLinkData(ref, data);
          return data;
        });
        resolve(p);
      }
    });
  },
  getLinksFromCache: function getLinksFromCache(ref) {
    ref = sefaria_Sefaria.humanRef(ref);
    return ref in this._links ? this._links[ref] : [];
  },
  _saveLinkData: function _saveLinkData(ref, data) {
    ref = sefaria_Sefaria.humanRef(ref);
    var l = this._saveLinksByRef(data);
    this._links[ref] = data;
    this._cacheIndexFromLinks(data);
    this._cacheTranslationsOfEssays(data);
    return l;
  },
  _cacheTranslationsOfEssays: function _cacheTranslationsOfEssays(links) {
    var _iterator3 = sefaria_createForOfIteratorHelper(links),
      _step3;
    try {
      for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
        var link = _step3.value;
        if (link.type !== "essay") {
          continue;
        }
        sefaria_Sefaria._translateTerms[link.displayedText.en] = link.displayedText;
      }
    } catch (err) {
      _iterator3.e(err);
    } finally {
      _iterator3.f();
    }
  },
  _cacheIndexFromLinks: function _cacheIndexFromLinks(links) {
    // Cache partial index information (title, Hebrew title, categories) found in link data.
    for (var i = 0; i < links.length; i++) {
      if ("collectiveTitle" in links[i] && this.index(links[i].collectiveTitle["en"])) {
        continue;
      }
      var index = {
        title: links[i].collectiveTitle["en"],
        heTitle: links[i].collectiveTitle["he"],
        categories: [links[i].category]
      };
      this.index(links[i].collectiveTitle["en"], index);
    }
  },
  _saveLinksByRef: function _saveLinksByRef(data) {
    return this._saveItemsByRef(data, this._links);
  },
  _saveItemsByRef: function _saveItemsByRef(data, store) {
    // For a set of items from the API, save each set split by the specific ref the items points to.
    // E.g, API is called on "Genesis 1", this function also stores the data in buckets like "Genesis 1:1", "Genesis 1:2" etc.
    var splitItems = {}; // Aggregate links by anchorRef
    for (var i = 0; i < data.length; i++) {
      var ref = data[i].anchorRef;
      if (!ref) {
        console.log("_saveItemsByRef encountered an item without a ref field:");
        console.log(data[i]);
        continue;
      }
      var refs = "anchorRefExpanded" in data[i] ? data[i].anchorRefExpanded : sefaria_Sefaria.splitRangingRef(ref);
      for (var j = 0; j < refs.length; j++) {
        ref = refs[j];
        if (ref in splitItems) {
          splitItems[ref].push(data[i]);
        } else {
          splitItems[ref] = [data[i]];
        }
      }
    }
    for (var ref in splitItems) {
      if (splitItems.hasOwnProperty(ref)) {
        if (!(ref in store) || store[ref].length <= splitItems[ref].length) {
          // Don't overwrite the cache if it already contains more items than the new list.
          // Due to range logic, if cache was populated with "Genesis 1", a call for "Genesis 1:2-4" could yeild
          // a smaller list of results for "Genesis 1:4" than was already present.
          store[ref] = splitItems[ref];
        }
      }
    }
    return splitItems;
  },
  linksLoaded: function linksLoaded(ref) {
    // Returns true if link data has been loaded for `ref`.
    if (typeof ref === "string") {
      return ref in this._links;
    } else {
      for (var i = 0; i < ref.length; i++) {
        if (!this.linksLoaded(ref[i])) {
          return false;
        }
      }
      return true;
    }
  },
  linkCount: function linkCount(ref, filter) {
    // Returns the number links available for `ref` filtered by `filter`, an array of strings.
    if (!(ref in this._links)) {
      return 0;
    }
    var links = this._links[ref];
    links = filter ? this._filterLinks(links, filter) : links;
    return links.length;
  },
  _filterLinks: function _filterLinks(links, filter) {
    // Filters array `links` for only those that match array `filter`.
    // If `filter` ends with "|Quoting" return Quoting Commentary only,
    // otherwise commentary `filters` will return only links with type `commentary`
    if (filter.length == 0) {
      return links;
    }
    var filterAndSuffix = filter[0].split("|");
    filter = [filterAndSuffix[0]];
    var isQuoting = filterAndSuffix.length == 2 && filterAndSuffix[1] == "Quoting";
    var isEssay = filterAndSuffix.length == 2 && filterAndSuffix[1] == "Essay";
    var index = sefaria_Sefaria.index(filter);
    var isCommentary = index && !isQuoting && (index.categories[0] == "Commentary" || index.primary_category == "Commentary");
    return links.filter(function (link) {
      if (isCommentary && link.category !== "Commentary") {
        return false;
      }
      if (isQuoting && link.category !== "Quoting Commentary") {
        return false;
      }
      if (isEssay) {
        return link.type === "essay" && sefaria_Sefaria.util.inArray(link.displayedText["en"], filter) !== -1;
      }
      return sefaria_Sefaria.util.inArray(link.category, filter) !== -1 || sefaria_Sefaria.util.inArray(link["collectiveTitle"]["en"], filter) !== -1;
    });
  },
  _filterSheetFromLinks: function _filterSheetFromLinks(links, sheetID) {
    links = links.filter(function (link) {
      return !link.isSheet || link.id !== sheetID;
    });
    return links;
  },
  _dedupeLinks: function _dedupeLinks(links) {
    var key = function key(link) {
      return [link.anchorRef, link.sourceRef, link.type].join("|");
    };
    var dedupedLinks = {};
    links.map(function (link) {
      dedupedLinks[key(link)] = link;
    });
    return Object.values(dedupedLinks);
  },
  hasEssayLinks: function hasEssayLinks(ref) {
    var links = [];
    ref.map(function (r) {
      var newlinks = sefaria_Sefaria.getLinksFromCache(r);
      links = links.concat(newlinks);
    });
    links = links.filter(function (l) {
      return l["type"] === "essay";
    });
    return links.length > 0;
  },
  essayLinks: function essayLinks(ref, versions) {
    var links = [];
    ref.map(function (r) {
      var newlinks = sefaria_Sefaria.getLinksFromCache(r);
      links = links.concat(newlinks);
    });
    links = this._dedupeLinks(links); // by aggregating links to each ref above, we can get duplicates of links to spanning refs
    var essayLinks = [];
    for (var i = 0; i < links.length; i++) {
      if (links[i]["type"] === "essay" && "displayedText" in links[i]) {
        var linkLang = links[i]["anchorVersion"]["language"];
        var currVersionTitle = versions[linkLang] ? versions[linkLang]["versionTitle"] : "NONE";
        var linkVersionTitle = links[i]["anchorVersion"]["title"];
        if (linkVersionTitle === "ALL" || linkVersionTitle !== "NONE" && currVersionTitle === linkVersionTitle) {
          essayLinks.push(links[i]);
        }
      }
    }
    return essayLinks.sort(function (a, b) {
      return sefaria_Sefaria.refContains(a["sourceRef"], b["sourceRef"]);
    });
  },
  _linkSummaries: {},
  linkSummary: function linkSummary(ref, excludedSheet) {
    // Returns an ordered array summarizing the link counts by category and text
    // Takes either a single string `ref` or an array of refs strings.
    // If `excludedSheet` is present, exclude links to that sheet ID.
    var categoryOrderOverrides = {
      "Tanakh": ["Talmud", "Midrash", "Halakhah"],
      "Mishnah": ["Tanakh", "Mishnah", "Talmud"],
      "Talmud": ["Tanakh", "Talmud", "Halakhah"],
      "Midrash": ["Tanakh", "Talmud", "Midrash"],
      "Halakhah": ["Tanakh", "Talmud", "Halakhah"],
      "Kabbalah": ["Tanakh", "Talmud", "Kabbalah"],
      "Liturgy": ["Tanakh", "Talmud", "Liturgy"],
      "Jewish Thought": ["Tanakh", "Talmud", "Jewish Thought"],
      "Tosefta": ["Tanakh", "Mishnah", "Talmud"],
      "Chasidut": ["Tanakh", "Talmud", "Midrash"],
      "Musar": ["Tanakh", "Talmud", "Musar"],
      "Responsa": ["Tanakh", "Talmud", "Halakhah"],
      "Second Temple": [],
      "Reference": []
    };
    var oref = typeof ref == "string" ? sefaria_Sefaria.ref(ref) : sefaria_Sefaria.ref(ref[0]);
    var categoryOverridesForRef = oref && oref.hasOwnProperty("primary_category") ? categoryOrderOverrides.hasOwnProperty(oref.primary_category) ? categoryOrderOverrides[oref.primary_category] : null : null;
    var links = [];
    if (!this.linksLoaded(ref)) {
      return [];
    }
    var normRef = sefaria_Sefaria.humanRef(ref);
    var cacheKey = normRef + "/" + excludedSheet;
    if (cacheKey in this._linkSummaries) {
      return this._linkSummaries[cacheKey];
    }
    if (typeof ref == "string") {
      links = this.getLinksFromCache(ref);
    } else {
      links = [];
      ref.map(function (r) {
        var newlinks = sefaria_Sefaria.getLinksFromCache(r);
        links = links.concat(newlinks);
      });
      links = this._dedupeLinks(links); // by aggregating links to each ref above, we can get duplicates of links to spanning refs
    }

    links = excludedSheet ? this._filterSheetFromLinks(links, excludedSheet) : links;
    var summary = {};
    for (var i = 0; i < links.length; i++) {
      var link = links[i];
      if (link["type"] === "essay") {
        continue;
      }
      // Count Category
      if (link.category in summary) {
        summary[link.category].count += 1;
        summary[link.category].hasEnglish = summary[link.category].hasEnglish || link.sourceHasEn;
      } else {
        summary[link.category] = {
          count: 1,
          books: {},
          hasEnglish: link.sourceHasEn
        };
      }
      var category = summary[link.category];
      // Count Book
      if (link["collectiveTitle"]["en"] in category.books) {
        category.books[link["collectiveTitle"]["en"]].count += 1;
        category.books[link["collectiveTitle"]["en"]].hasEnglish = category.books[link["collectiveTitle"]["en"]].hasEnglish || link.sourceHasEn;
        category.books[link["collectiveTitle"]["en"]].categoryList = sefaria_Sefaria.index(link["index_title"]) ? sefaria_Sefaria.index(link["index_title"]).categories : [];
      } else {
        category.books[link["collectiveTitle"]["en"]] = {
          count: 1,
          hasEnglish: link.sourceHasEn
        };
        category.books[link["collectiveTitle"]["en"]].categoryList = sefaria_Sefaria.index(link["index_title"]) ? sefaria_Sefaria.index(link["index_title"]).categories : [];
        category.books[link["collectiveTitle"]["en"]].fullTitle = link["index_title"];
      }
    }
    // Add Zero counts for every commentator in this section not already in list
    var baseRef = typeof ref == "string" ? ref : ref[0]; // TODO handle refs spanning sections
    var oRef = sefaria_Sefaria.getRefFromCache(baseRef);
    var sectionRef = oRef ? oRef.sectionRef : baseRef;
    if (ref !== sectionRef) {
      var sectionLinks = sefaria_Sefaria.getLinksFromCache(sectionRef);
      for (var _i9 = 0; _i9 < sectionLinks.length; _i9++) {
        var l = sectionLinks[_i9];
        if (l.category === "Commentary") {
          if (!("Commentary" in summary)) {
            summary["Commentary"] = {
              count: 0,
              books: {}
            };
          }
          if (!(l["collectiveTitle"]["en"] in summary["Commentary"].books)) {
            summary["Commentary"].books[l["collectiveTitle"]["en"]] = {
              count: 0
            };
            summary["Commentary"].books[l["collectiveTitle"]["en"]].categoryList = sefaria_Sefaria.index(l["index_title"]) ? sefaria_Sefaria.index(l["index_title"]).categories : [];
          }
        }
      }
    }
    // Convert object into ordered list
    var summaryList = Object.keys(summary).map(function (category) {
      var categoryData = summary[category];
      categoryData.category = category;
      categoryData.books = Object.keys(categoryData.books).map(function (book) {
        var bookData = categoryData.books[book];
        var index = sefaria_Sefaria.index(book);
        var fullTitleIndex = sefaria_Sefaria.index(bookData.fullTitle) ? sefaria_Sefaria.index(bookData.fullTitle) : index;
        bookData.book = index.title;
        bookData.heBook = index.heTitle;
        bookData.category = category;
        bookData.enShortDesc = fullTitleIndex.enShortDesc || fullTitleIndex.enDesc;
        bookData.heShortDesc = fullTitleIndex.heShortDesc || fullTitleIndex.heDesc;
        bookData.categoryList = index.categories[0] == ['Commentary'] ? bookData.categoryList : index.categories;
        if (bookData.categoryList != "Quoting Commentary") {
          bookData.categoryListNew = [];
          for (var _i10 = 0; _i10 < bookData.categoryList.length; _i10++) {
            if (bookData.categoryList[_i10] === bookData.book || bookData.book.split(" ")[0] === bookData.categoryList[_i10] || bookData.book.split(" ")[0] === bookData.categoryList[_i10].split(" ")[0]) {
              break;
            } else {
              bookData.categoryListNew.push(bookData.categoryList[_i10]);
            }
          }
          bookData.categoryList = bookData.categoryListNew;
          // bookData.enShortDesc = Sefaria.tocItemsByCategories(bookData.categoryList).map((e)=>(e.category || e.title === bookData.book ? e.enShortDesc: null))
        }

        if (bookData.categoryList && !bookData.enShortDesc) {
          var desc = sefaria_Sefaria.getDescriptionDict(bookData.book, bookData.categoryList);
          if (desc) {
            bookData.enShortDesc = desc[0] || null;
            bookData.heShortDesc = desc[1] || null;
          }
        }
        return bookData;
      });
      // Sort the books in the category
      var cat = oRef ? oRef["categories"][0] : null;
      categoryData.books.sort(sefaria_Sefaria.linkSummaryBookSort.bind(null, cat));
      return categoryData;
    });
    // Sort the categories
    var categoryOrder = sefaria_Sefaria.toc.map(function (cat) {
      return cat.category;
    });
    categoryOrder.splice(0, 0, "Commentary"); // Always show Commentary First
    categoryOrder.splice(2, 0, "Targum"); // Show Targum after Tanakh (Or Tanakh's original location)
    if (categoryOverridesForRef && categoryOverridesForRef.length > 1) {
      //if we have been passed the "top connection categories" for this ref's categroy, preference them
      categoryOrder.splice.apply(categoryOrder, [1, 0].concat(sefaria_toConsumableArray(categoryOverridesForRef)));
    }
    summaryList.sort(function (a, b) {
      var orderA = categoryOrder.indexOf(a.category);
      var orderB = categoryOrder.indexOf(b.category);
      orderA = orderA === -1 ? categoryOrder.length : orderA;
      orderB = orderB === -1 ? categoryOrder.length : orderB;
      return orderA - orderB;
    });
    sefaria_Sefaria._linkSummaries[cacheKey] = summaryList;
    return summaryList;
  },
  linkSummaryBookSort: function linkSummaryBookSort(category, a, b, byHebrew) {
    // Sorter for links in a link summary, included a hard coded list of top spots by category
    // First sort by predefined "top"
    var hebrewTopByCategory = {
      "Tanakh": ["Rashi", "Ibn Ezra", "Ramban", "Sforno"],
      "Talmud": ["Rashi", "Tosafot"],
      "Mishnah": ["Bartenura", "Rambam", "Ikar Tosafot Yom Tov", "Yachin", "Boaz"]
    };
    var englishTopByCategory = {
      "Tanakh": ["Rashi", "Ibn Ezra", "Ramban", "Sforno"],
      "Talmud": ["Rashi", "Tosafot"],
      "Mishnah": ["Bartenura", "English Explanation of Mishnah", "Rambam", "Ikar Tosafot Yom Tov", "Yachin", "Boaz"]
    };
    var top = (byHebrew ? hebrewTopByCategory[category] : englishTopByCategory[category]) || [];
    var aTop = top.indexOf(a.book);
    var bTop = top.indexOf(b.book);
    if (aTop !== -1 || bTop !== -1) {
      aTop = aTop === -1 ? 999 : aTop;
      bTop = bTop === -1 ? 999 : bTop;
      return aTop < bTop ? -1 : 1;
    }
    // Then sort alphabetically
    if (byHebrew) {
      return a.heBook > b.heBook ? 1 : -1;
    }
    return a.book > b.book ? 1 : -1;
  },
  linkSummaryBookSortHebrew: function linkSummaryBookSortHebrew(category, a, b) {
    return sefaria_Sefaria.linkSummaryBookSort(category, a, b, true);
  },
  commentarySectionRef: function commentarySectionRef(commentator, baseRef) {
    // Given a commentator name and a baseRef, return a ref to the commentary which spans the entire baseRef
    // E.g. ("Rashi", "Genesis 3") -> "Rashi on Genesis 3"
    // Even though most commentaries have a 1:1 structural match to basetexts, this is not alway so.
    // Works by examining links available on baseRef, returns null if no links are in cache.
    if (commentator == "Abarbanel") {
      return null; // This text is too giant, optimizing up to section level is too slow. TODO: generalize.
    }

    var links = sefaria_Sefaria.getLinksFromCache(baseRef);
    links = sefaria_Sefaria._filterLinks(links, [commentator]);
    if (!links || !links.length || links[0].isSheet) {
      return null;
    }
    var pRefs = links.map(function (link) {
      return sefaria_Sefaria.parseRef(link.sourceRef);
    });
    if (pRefs.some(function (pRef) {
      return "error" in pRef;
    })) {
      return null;
    } // Give up on bad refs

    var books = pRefs.map(function (pRef) {
      return pRef.book;
    }).unique();
    if (books.length > 1) {
      return null;
    } // Can't handle multiple index titles or schemaNodes

    try {
      var startSections = pRefs.map(function (pRef) {
        return pRef.sections[0];
      });
      var endSections = pRefs.map(function (pRef) {
        return pRef.toSections[0];
      });
    } catch (e) {
      return null;
    }
    var sorter = function sorter(a, b) {
      return a.match(/\d+[ab]/) ? sefaria_Sefaria.hebrew.dafToInt(a) - sefaria_Sefaria.hebrew.dafToInt(b) : parseInt(a) - parseInt(b);
    };
    var commentaryRef = {
      book: books[0],
      sections: startSections.sort(sorter).slice(0, 1),
      toSections: endSections.sort(sorter).reverse().slice(0, 1)
    };
    var ref = sefaria_Sefaria.humanRef(sefaria_Sefaria.makeRef(commentaryRef));
    return ref;
  },
  _descDict: {},
  // cache for the description dictionary
  getDescriptions: function getDescriptions(keyName, categoryList) {
    var catlist = sefaria_Sefaria.tocItemsByCategories(categoryList);
    var catmap = catlist.map(function (e) {
      return [e.category || e.title, e.enShortDesc, e.heShortDesc];
    });
    var d = {};
    catmap.map(function (e) {
      // return array of key: name of "book" value: list of both descriptions
      if (e) {
        d[e[0]] = [e[1], e[2]];
      }
      // special case for commentators that the book name is "on" eg. "Ramban on Genesis"
      if (e[0].includes("on")) {
        d[e[0].split(" on")[0]] = [e[1], e[2]];
      }
    });
    var descs = d[keyName] || d[sefaria_Sefaria.index(keyName).collectiveTitle] || d[keyName.split(" on")[0]];
    var enShortDesc = descs && descs[0] ? descs[0] : null;
    var heShortDesc = descs && descs[1] ? descs[1] : null;
    return [enShortDesc, heShortDesc];
  },
  getDescriptionDict: function getDescriptionDict(keyName, categoryList) {
    var _this6 = this;
    var desc = this._cachedApi([keyName, categoryList], this._descDict, null);
    if (Object.keys(this._descDict).length === 0) {
      //Init of the Dict with the Category level descriptions
      sefaria_Sefaria.toc.map(function (e) {
        _this6._descDict[[e.category, []]] = [e.enShortDesc, e.heShortDesc];
      });
      // todo: get this data out of code (into db?)
      this._descDict[["Commentary", []]] = ["Interpretations and discussions surrounding Jewish texts, ranging from early medieval to contemporary.", "פירושים ודיונים סביב טקסטים תורניים, מימי הביניים ועד ימינו."];
      this._descDict[["Quoting Commentary", []]] = ["References to this source within commentaries on other texts in the wider library.", "התייחסויות אל המקור הנוכחי במפרשים משניים."];

      // special case of a category in sidebar that is a sub cat on the navigation toc pages
      this._descDict[["Targum", []]] = this.getDescriptions("Targum", ["Tanakh"]);
    }
    if (!desc && categoryList.length !== 0) {
      desc = this.getDescriptions(keyName, categoryList);
      this._descDict[[keyName, categoryList]] = desc;
    }
    if (desc) {
      return [desc[0], desc[1]];
    } else {
      return [null, null];
    }
  },
  _notes: {},
  notes: function notes(ref, callback) {
    var notes = null;
    if (typeof ref == "string") {
      if (ref in this._notes) {
        notes = this._notes[ref];
      }
    } else {
      var notes = [];
      ref.map(function (r) {
        var newNotes = sefaria_Sefaria.notes(r);
        notes = newNotes ? notes.concat(newNotes) : notes;
      });
    }
    if (notes) {
      if (callback) {
        callback(notes);
      }
    } else {
      sefaria_Sefaria.related(ref, function (data) {
        if (callback) {
          callback(data.notes);
        }
      });
    }
    return notes;
  },
  _saveNoteData: function _saveNoteData(ref, data) {
    return this._saveItemsByRef(data, this._notes);
  },
  _privateNotes: {},
  privateNotes: function privateNotes(refs, callback) {
    // Returns an array of private notes for `refs` (a string or array or strings)
    // or `null` if notes have not yet been loaded.
    if (!sefaria_Sefaria._uid) return;
    var notes = null;
    if (typeof refs == "string") {
      if (refs in this._privateNotes) {
        notes = this._privateNotes[refs];
      }
      refs = [refs]; // Stanfardize type to simplify processing below
    } else {
      var notesByRef = refs.map(function (ref) {
        return sefaria_Sefaria._privateNotes[ref];
      });
      if (notesByRef.some(function (e) {
        return !e;
      })) {
        // If any ref in `refs` returned `null`, treat the whole thing as not yet loaded, call the API.
        notes = null;
      } else {
        notes = [];
        notesByRef.map(function (n) {
          notes = notes.concat(n);
        });
      }
    }
    if (notes) {
      if (callback) {
        callback(notes);
      }
    } else {
      var aggregateCallback = function aggregateCallback() {
        // Check if all refs have loaded, call callback if so
        if (sefaria_Sefaria.privateNotesLoaded(refs) && callback) {
          callback(sefaria_Sefaria.privateNotes(refs));
        }
      };
      refs.map(function (ref) {
        if (ref in sefaria_Sefaria._privateNotes) {
          return;
        } // Only make API calls for unloaded refs
        var url = sefaria_Sefaria.apiHost + "/api/notes/" + sefaria_Sefaria.normRef(ref) + "?private=1";
        this._api(url, function (data) {
          if ("error" in data) {
            return;
          }
          this._savePrivateNoteData(ref, data);
          aggregateCallback(data);
        }.bind(this));
      }.bind(this));
    }
    return notes;
  },
  privateNotesLoaded: function privateNotesLoaded(refs) {
    // Returns true if private notes have been loaded for every ref in `refs.
    refs.map(function (ref) {
      if (!(ref in sefaria_Sefaria._privateNotes)) {
        return false;
      }
    });
    return true;
  },
  addPrivateNote: function addPrivateNote(note) {
    // Add a single private note to the cache of private notes.
    var notes = this.privateNotes(note["anchorRef"]) || [];
    notes = [note].concat(notes);
    this._saveItemsByRef(notes, this._privateNotes);
  },
  clearPrivateNotes: function clearPrivateNotes() {
    this._privateNotes = {};
    this._allPrivateNotes = null;
  },
  _allPrivateNotes: null,
  allPrivateNotes: function allPrivateNotes(callback) {
    var _this7 = this;
    if (!callback) {
      return this._allPrivateNotes;
    }
    if (this._allPrivateNotes) {
      callback(this._allPrivateNotes);
    } else {
      var url = sefaria_Sefaria.apiHost + "/api/notes/all?private=1";
      this._api(url, function (data) {
        if ("error" in data) {
          return;
        }
        _this7._savePrivateNoteData(null, data);
        _this7._allPrivateNotes = data;
        callback(data);
      });
    }
    return this._allPrivateNotes;
  },
  _savePrivateNoteData: function _savePrivateNoteData(ref, data) {
    return this._saveItemsByRef(data, this._privateNotes);
  },
  notesTotalCount: function notesTotalCount(refs) {
    // Returns the total number of private and public notes on `refs` without double counting my public notes.
    var notes = sefaria_Sefaria.notes(refs) || [];
    if (sefaria_Sefaria._uid) {
      var myNotes = sefaria_Sefaria.privateNotes(refs) || [];
      notes = notes.filter(function (note) {
        return note.owner !== sefaria_Sefaria._uid;
      }).concat(myNotes);
    }
    return notes.length;
  },
  deleteNote: function deleteNote(noteId) {
    return new Promise(function (resolve, reject) {
      sefariaJquery.ajax({
        type: "delete",
        url: "/api/notes/".concat(noteId),
        success: function success() {
          sefaria_Sefaria.clearPrivateNotes();
          sefaria_Sefaria.track.event("Tools", "Delete Note", noteId);
          resolve();
        },
        error: reject
      });
    });
  },
  _media: {},
  mediaByRef: function mediaByRef(refs) {
    var _this8 = this;
    refs = typeof refs == "string" ? sefaria_Sefaria.splitRangingRef(refs) : refs.slice();
    var ref = sefaria_Sefaria.normRefList(refs);
    var media = [];
    refs.map(function (r) {
      if (_this8._media[r]) {
        media = media.concat(_this8._media[r]);
      }
    }, this);
    return media;
  },
  _webpages: {},
  _processedWebpages: {},
  webPagesByRef: function webPagesByRef(refs) {
    var _this9 = this;
    refs = typeof refs == "string" ? sefaria_Sefaria.splitRangingRef(refs) : refs.slice();
    var ref = sefaria_Sefaria.normRefList(refs);
    if (ref in this._processedWebpages) {
      return this._processedWebpages[ref];
    }
    var webpages = [];
    refs.map(function (r) {
      if (_this9._webpages[r]) {
        webpages = webpages.concat(_this9._webpages[r]);
      }
    }, this);
    webpages.map(function (page) {
      return page.isHebrew = sefaria_Sefaria.hebrew.isHebrew(page.title);
    });
    webpages = webpages.sort(function (a, b) {
      // Sort first by page language matching interface language
      if (a.isHebrew !== b.isHebrew) {
        return (b.isHebrew ? -1 : 1) * (sefaria_Sefaria.interfaceLang === "hebrew" ? -1 : 1);
      }

      // Second, sort by how many anchorRefExpanded refs there are.  Intuition: Genesis 1:2 should come before Genesis 1:2-5, which in turn should come before Genesis 1
      var aNumAnchorRefs, bNumAnchorRefs;
      var _map3 = [a, b].map(function (page) {
        return page.anchorRefExpanded.length;
      });
      var _map4 = sefaria_slicedToArray(_map3, 2);
      aNumAnchorRefs = _map4[0];
      bNumAnchorRefs = _map4[1];
      if (aNumAnchorRefs !== bNumAnchorRefs) {
        return aNumAnchorRefs - bNumAnchorRefs;
      }

      // Genesis 2 should come before Genesis 1-3
      var aIsRange, bIsRange;
      var _map5 = [a, b].map(function (page) {
        return page.anchorRef.indexOf("-") !== -1;
      });
      var _map6 = sefaria_slicedToArray(_map5, 2);
      aIsRange = _map6[0];
      bIsRange = _map6[1];
      if (aIsRange !== bIsRange) {
        return bIsRange ? -1 : 1;
      }
      return a.linkerHits > b.linkerHits ? -1 : 1;
    });
    this._processedWebpages[ref] = webpages;
    return webpages;
  },
  _refTopicLinks: {},
  _saveTopicByRef: function _saveTopicByRef(ref, data) {
    ref = sefaria_Sefaria.humanRef(ref);
    var split = this._saveItemsByRef(data, this._refTopicLinks);
    this._refTopicLinks[ref] = data;
    return split;
  },
  topicsByRef: function topicsByRef(refs) {
    refs = typeof refs == "string" ? sefaria_Sefaria.splitRangingRef(refs) : refs.slice();
    var topicsObj = {};
    var resultLoaded = false; // _refTopicLinks will have an empty array for ref if ref's topics were loaded
    var _iterator4 = sefaria_createForOfIteratorHelper(refs),
      _step4;
    try {
      for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {
        var r = _step4.value;
        var tempTopicList = this._refTopicLinks[r];
        if (!tempTopicList) {
          continue;
        }
        resultLoaded = true;
        var _iterator5 = sefaria_createForOfIteratorHelper(tempTopicList),
          _step5;
        try {
          for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {
            var tempTopic = _step5.value;
            if (!topicsObj[tempTopic.topic]) {
              tempTopic.order = tempTopic.order || {};
              tempTopic.dataSources = {};
              topicsObj[tempTopic.topic] = tempTopic;
            }
            // aggregate dataSources for display in tooltip
            topicsObj[tempTopic.topic].dataSources[tempTopic.dataSource.slug] = tempTopic.dataSource;
          }
        } catch (err) {
          _iterator5.e(err);
        } finally {
          _iterator5.f();
        }
      }
    } catch (err) {
      _iterator4.e(err);
    } finally {
      _iterator4.f();
    }
    if (!resultLoaded) {
      return null;
    }
    return Object.values(topicsObj).sort(function (a, b) {
      return b.order.pr - a.order.pr;
    });
  },
  topicsByRefCount: function topicsByRefCount(refs) {
    var topics = sefaria_Sefaria.topicsByRef(refs);
    return topics && topics.length;
  },
  _related: {},
  related: function related(ref, callback) {
    // Single API to bundle public links, sheets, and notes by ref.
    // `ref` may be either a string or an array of consecutive ref strings.
    ref = sefaria_Sefaria.humanRef(ref);
    if (!callback) {
      return this._related[ref] || null;
    }
    if (ref in this._related) {
      callback(this._related[ref]);
    } else {
      this.relatedApi(ref, callback);
    }
  },
  _manuscripts: {},
  manuscriptsByRef: function manuscriptsByRef(refs) {
    var _this10 = this;
    refs = typeof refs === "string" ? sefaria_Sefaria.splitRangingRef(refs) : refs.slice();
    var manuscriptPages = [];
    refs.forEach(function (r) {
      if (_this10._manuscripts[r]) {
        manuscriptPages = manuscriptPages.concat(_this10._manuscripts[r]);
      }
    });
    return manuscriptPages;
  },
  relatedApi: function relatedApi(ref, callback) {
    var _this11 = this;
    var url = sefaria_Sefaria.apiHost + "/api/related/" + sefaria_Sefaria.normRef(ref) + "?with_sheet_links=1";
    return this._api(url, function (data) {
      if ("error" in data) {
        return;
      }
      var originalData = sefaria_Sefaria.util.clone(data);

      // Save link, note, and sheet data, and retain the split data from each of these saves
      var split_data = {
        links: _this11._saveLinkData(ref, data.links),
        notes: _this11._saveNoteData(ref, data.notes),
        sheets: _this11.sheets._saveSheetsByRefData(ref, data.sheets),
        webpages: _this11._saveItemsByRef(data.webpages, _this11._webpages),
        topics: _this11._saveTopicByRef(ref, data.topics || []),
        media: _this11._saveItemsByRef(data.media, _this11._media),
        manuscripts: _this11._saveItemsByRef(data.manuscripts, _this11._manuscripts)
      };

      // Build split related data from individual split data arrays
      ["links", "notes", "sheets", "webpages", "media"].forEach(function (obj_type) {
        for (var ref in split_data[obj_type]) {
          if (split_data[obj_type].hasOwnProperty(ref)) {
            if (!(ref in _this11._related)) {
              _this11._related[ref] = {
                links: [],
                notes: [],
                sheets: [],
                webpages: [],
                media: [],
                topics: []
              };
            }
            _this11._related[ref][obj_type] = split_data[obj_type][ref];
          }
        }
      }, _this11);

      // Save the original data after the split data - lest a split version overwrite it.
      _this11._related[ref] = originalData;
      callback(data);
    });
  },
  _relatedPrivate: {},
  relatedPrivate: function relatedPrivate(ref, callback) {
    // Single API to bundle private user sheets and notes by ref.
    // `ref` may be either a string or an array of consecutive ref strings.
    // Separated from public content so that public content can be cached
    ref = sefaria_Sefaria.humanRef(ref);
    if (!callback) {
      return this._relatedPrivate[ref] || null;
    }
    if (ref in this._relatedPrivate) {
      callback(this._relatedPrivate[ref]);
    } else {
      var url = sefaria_Sefaria.apiHost + "/api/related/" + sefaria_Sefaria.normRef(ref) + "?private=1";
      this._api(url, function (data) {
        var _this12 = this;
        if ("error" in data) {
          return;
        }
        var originalData = sefaria_Sefaria.util.clone(data);

        // Save link, note, and sheet data, and retain the split data from each of these saves
        var split_data = {
          notes: this._savePrivateNoteData(ref, data.notes),
          sheets: this.sheets._saveUserSheetsByRefData(ref, data.sheets)
        };

        // If ref is a range or section, mark the cache as empty for any subref we didn't encouter.
        var potentialEmptyRefs = sefaria_Sefaria.splitRangingRef(ref);
        potentialEmptyRefs.forEach(function (eref) {
          split_data["notes"][eref] = eref in split_data["notes"] ? split_data["notes"][eref] : [];
          _this12._privateNotes[eref] = eref in _this12._privateNotes ? _this12._privateNotes[eref] : [];
        });
        potentialEmptyRefs.forEach(function (eref) {
          split_data["sheets"][eref] = eref in split_data["sheets"] ? split_data["sheets"][eref] : [];
          _this12.sheets._userSheetsByRef[eref] = eref in _this12.sheets._userSheetsByRef ? _this12.sheets._userSheetsByRef[eref] : [];
        });

        // Build split related data from individual split data arrays
        ["notes", "sheets"].forEach(function (obj_type) {
          for (var ref in split_data[obj_type]) {
            if (split_data[obj_type].hasOwnProperty(ref)) {
              if (!(ref in this._relatedPrivate)) {
                this._relatedPrivate[ref] = {
                  notes: [],
                  sheets: []
                };
              }
              this._relatedPrivate[ref][obj_type] = split_data[obj_type][ref];
            }
          }
        }, this);

        // Save the original data after the split data - lest a split version overwrite it.
        this._relatedPrivate[ref] = originalData;
        callback(data);
      }.bind(this));
    }
  },
  clearLinks: function clearLinks() {
    this._related = {};
    this._links = {};
    this._linkSummaries = {};
  },
  removeLink: function removeLink(_id) {},
  isACaseVariant: function isACaseVariant(query, data) {
    // Check if query is just an improper capitalization of something that otherwise would be a ref
    // query: string
    // data: dictionary, as returned by /api/name
    return !data["is_ref"] && data["completions"] && data["completions"].length && data["completions"][0] != query && data["completions"][0].toLowerCase().replace('״', '"') == query.slice(0, data["completions"][0].length).toLowerCase().replace('״', '"') && data["completions"][0] != query.slice(0, data["completions"][0].length);
  },
  repairCaseVariant: function repairCaseVariant(query, data) {
    // Used when isACaseVariant() is true to prepare the alternative
    return data["completions"][0] + query.slice(data["completions"][0].length);
  },
  makeSegments: function makeSegments(data, withContext) {
    var sheets = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    // Returns a flat list of annotated segment objects,
    // derived from the walking the text in data
    if (!data || "error" in data) {
      return [];
    }
    var segments = [];
    var highlight = data.sections.length === data.textDepth;
    var wrapEn = typeof data.text == "string";
    var wrapHe = typeof data.he == "string";
    var en = wrapEn ? [data.text] : data.text;
    var he = wrapHe ? [data.he] : data.he;
    var topLength = Math.max(en.length, he.length);
    en = en.pad(topLength, "");
    he = he.pad(topLength, "");
    var index_offsets_by_depth = this._get_offsets(data, topLength);
    var start = data.textDepth == data.sections.length && !withContext ? data.sections.slice(-1)[0] : 1 + index_offsets_by_depth[0];
    if (!data.isSpanning) {
      for (var i = 0; i < topLength; i++) {
        var number = i + start;
        var delim = data.textDepth == 1 ? " " : ":";
        var ref = data.sectionRef + delim + number;
        segments.push({
          ref: ref,
          en: en[i],
          he: he[i],
          number: number,
          highlight: highlight && number >= data.sections.slice(-1)[0] && number <= data.toSections.slice(-1)[0],
          alt: "alts" in data && i < data.alts.length ? data.alts[i] : null
        });
      }
    } else {
      for (var n = 0; n < topLength; n++) {
        var en2 = typeof en[n] == "string" ? [en[n]] : en[n];
        var he2 = typeof he[n] == "string" ? [he[n]] : he[n];
        var length = Math.max(en2.length, he2.length);
        en2 = en2.pad(length, "");
        he2 = he2.pad(length, "");
        var baseRef = data.book;
        var baseSection = data.sections.slice(0, -2).join(":");
        var delim = baseSection ? ":" : " ";
        var baseRef = baseSection ? baseRef + " " + baseSection : baseRef;
        start = n == 0 ? start : 1 + index_offsets_by_depth[n];
        for (var i = 0; i < length; i++) {
          var startSection = data.sections.slice(-2)[0];
          var section = typeof startSection == "string" ? sefaria_Sefaria.hebrew.intToDaf(n + sefaria_Sefaria.hebrew.dafToInt(startSection)) : n + startSection;
          var number = i + start;
          var ref = baseRef + delim + section + ":" + number;
          segments.push({
            ref: ref,
            en: en2[i],
            he: he2[i],
            number: number,
            highlight: highlight && (n == 0 && number >= data.sections.slice(-1)[0] || n == topLength - 1 && number <= data.toSections.slice(-1)[0] || n > 0 && n < topLength - 1),
            alt: "alts" in data && n < data.alts.length && i < data.alts[n].length ? data.alts[n][i] : null
          });
        }
      }
    }
    return segments;
  },
  stripImagesFromSegments: function stripImagesFromSegments(segments) {
    // Used by sheets editors.  Sefaria.makeSegments creates a list of segments and this function handles the images.
    return segments.map(function (x) {
      x.he = sefaria_Sefaria.util.stripImgs(x.he);
      x.en = sefaria_Sefaria.util.stripImgs(x.en);
      return x;
    });
  },
  sectionString: function sectionString(ref) {
    // Returns a pair of nice strings (en, he) of the sections indicated in ref. e.g.,
    // "Genesis 4" -> "Chapter 4", "Guide for the Perplexed, Introduction" - > "Introduction"
    var data = this.getRefFromCache(ref);
    var result = {
      en: {
        named: "",
        numbered: ""
      },
      he: {
        named: "",
        numbered: ""
      }
    };
    if (!data) {
      return result;
    }

    // English
    var sections = ref.slice(data.indexTitle.length + 1);
    var name = data.sectionNames.length > 1 ? data.sectionNames[0] + " " : "";
    if (data.isComplex) {
      var numberedSections = data.ref.slice(data.book.length + 1);
      if (numberedSections) {
        var namedSections = sections.slice(0, -(numberedSections.length + 1));
        var string = (namedSections ? namedSections + ", " : "") + name + numberedSections;
      } else {
        var string = sections;
      }
    } else {
      var string = name + sections;
    }
    result.en.named = string;
    result.en.numbered = sections;

    // Hebrew
    var sections = data.heRef.slice(data.heIndexTitle.length + 1);
    var name = ""; // missing he section names // data.sectionNames.length > 1 ? " " + data.sectionNames[0] : "";
    if (data.isComplex) {
      var numberedSections = data.heRef.slice(data.heTitle.length + 1);
      if (numberedSections) {
        var namedSections = sections.slice(0, -(numberedSections.length + 1));
        var string = (namedSections ? namedSections + ", " : "") + name + " " + numberedSections;
      } else {
        string = sections;
      }
    } else {
      var string = name + sections;
    }
    result.he.named = string;
    result.he.numbered = sections;
    return result;
  },
  commentaryList: function commentaryList(title, toc) {
    var title = arguments.length == 0 || arguments[0] === undefined ? null : arguments[0];
    /** Returns the list of commentaries for 'title' which are found in Sefaria.toc **/
    var toc = arguments.length <= 1 || arguments[1] === undefined ? sefaria_Sefaria.util.clone(sefaria_Sefaria.toc) : arguments[1];
    if (title != null) {
      var index = this.index(title); //TODO: a little bit redundant to do on every recursion
      if (!index) {
        return [];
      }
      title = index.title;
    }
    var results = [];
    for (var i = 0; i < toc.length; i++) {
      var curTocElem = toc[i];
      if (curTocElem.title) {
        //this is a book
        if (curTocElem.dependence == 'Commentary') {
          if (title && curTocElem.base_text_titles && title in curTocElem.refs_to_base_texts || title == null) {
            results.push(curTocElem);
          }
        }
      } else if (curTocElem.contents) {
        //this is still a category and might have books under it
        results = results.concat(sefaria_Sefaria.commentaryList(title, curTocElem.contents));
      }
    }
    return results;
  },
  tocObjectByCategories: function tocObjectByCategories(cats) {
    // Returns the TOC entry that corresponds to list of categories `cats`
    var found, item;
    var list = sefaria_Sefaria.toc;
    for (var i = 0; i < cats.length; i++) {
      found = false;
      item = null;
      for (var k = 0; k < list.length; k++) {
        if (list[k].category === cats[i]) {
          item = list[k];
          list = item.contents || [];
          found = true;
          break;
        }
      }
      if (!found) {
        return null;
      }
    }
    return item;
  },
  tocItemsByCategories: function tocItemsByCategories(cats) {
    // Returns the TOC items that correspond to the list of categories 'cats'
    var object = sefaria_Sefaria.tocObjectByCategories(cats);
    return object ? sefaria_Sefaria.util.clone(object.contents) : [];
  },
  categoryAttribution: function categoryAttribution(categories) {
    var attributions = [{
      categories: ["Talmud", "Bavli"],
      english: "The William Davidson Talmud",
      hebrew: "תלמוד מהדורת ויליאם דוידסון",
      englishAsEdition: "The William Davidson Edition",
      hebrewAsEdition: "מהדורת ויליאם דוידסון",
      link: "/william-davidson-talmud"
    }];
    var attribution = null;
    for (var i = 0; i < attributions.length; i++) {
      if (categories.length >= attributions[i].categories.length && attributions[i].categories.compare(categories.slice(0, attributions[i].categories.length))) {
        attribution = attributions[i];
        break;
      }
    }
    return attribution;
  },
  getPassages: function getPassages(refs) {
    // refs: list of ref strings
    // resolves to dictionary mapping ref to sugya ref
    return this._ApiPromise(sefaria_Sefaria.apiHost + "/api/passages/" + refs.join("|"));
  },
  areVersionsEqual: function areVersionsEqual(v1, v2) {
    // v1, v2 are `currVersions` objects stored like {en: ven, he: vhe}
    return v1.en == v2.en && v1.he == v2.he;
  },
  getSavedItem: function getSavedItem(_ref10) {
    var ref = _ref10.ref,
      versions = _ref10.versions;
    return sefaria_Sefaria.saved.items.find(function (s) {
      return s.ref === ref && sefaria_Sefaria.areVersionsEqual(s.versions, versions);
    });
  },
  removeSavedItem: function removeSavedItem(_ref11) {
    var ref = _ref11.ref,
      versions = _ref11.versions;
    sefaria_Sefaria.saved.items = sefaria_Sefaria.saved.items.filter(function (x) {
      return !(x.ref === ref && sefaria_Sefaria.areVersionsEqual(versions, x.versions));
    });
  },
  toggleSavedItem: function toggleSavedItem(_ref12) {
    var ref = _ref12.ref,
      versions = _ref12.versions,
      sheet_owner = _ref12.sheet_owner,
      sheet_title = _ref12.sheet_title;
    return new Promise(function (resolve, reject) {
      var action = !!sefaria_Sefaria.getSavedItem({
        ref: ref,
        versions: versions
      }) ? "delete_saved" : "add_saved";
      var savedItem = {
        ref: ref,
        versions: versions,
        time_stamp: sefaria_Sefaria.util.epoch_time(),
        action: action,
        sheet_owner: sheet_owner,
        sheet_title: sheet_title
      };
      if (sefaria_Sefaria._uid) {
        sefariaJquery.post("".concat(sefaria_Sefaria.apiHost, "/api/profile/sync?no_return=1"), {
          user_history: JSON.stringify([savedItem]),
          client: 'web'
        }).done(function (response) {
          if (!!response['error']) {
            reject(response['error']);
          } else {
            if (action === "add_saved" && !!response.created && response.created.length > 0) {
              sefaria_Sefaria.saved.items = response.created.concat(sefaria_Sefaria.saved.items);
            } else {
              // delete
              sefaria_Sefaria.removeSavedItem({
                ref: ref,
                versions: versions
              });
            }
            resolve(response);
          }
        }).fail(function (jqXHR, textStatus, errorThrown) {
          reject(errorThrown);
        });
      } else {
        reject('notSignedIn');
      }
    });
  },
  editProfileAPI: function editProfileAPI(partialProfile) {
    var data = {
      json: JSON.stringify(partialProfile)
    };
    return new Promise(function (resolve, reject) {
      sefariaJquery.post("".concat(sefaria_Sefaria.apiHost, "/api/profile"), data, resolve);
    });
  },
  followAPI: function followAPI(slug, ftype) {
    return sefaria_Sefaria._ApiPromise(sefaria_Sefaria.apiHost + "/api/profile/".concat(slug, "/").concat(ftype));
  },
  messageAPI: function messageAPI(uid, message) {
    var data = {
      json: JSON.stringify({
        recipient: uid,
        message: message.escapeHtml()
      })
    };
    return new Promise(function (resolve, reject) {
      sefariaJquery.post("".concat(sefaria_Sefaria.apiHost, "/api/messages"), data, resolve);
    });
  },
  chatMessageAPI: function chatMessageAPI(roomId, senderId, timestamp, messageContent) {
    var data = {
      json: JSON.stringify({
        roomId: roomId,
        senderId: senderId,
        timestamp: timestamp,
        messageContent: messageContent
      })
    };
    return new Promise(function (resolve, reject) {
      sefariaJquery.post("".concat(sefaria_Sefaria.apiHost, "/api/chat-messages"), data, resolve);
    });
  },
  getChatMessagesAPI: function getChatMessagesAPI(roomId) {
    return sefaria_Sefaria._ApiPromise(sefaria_Sefaria.apiHost + "/api/chat-messages/?room_id=".concat(roomId));
  },
  getRefSavedHistory: function getRefSavedHistory(tref) {
    return sefaria_Sefaria._ApiPromise(sefaria_Sefaria.apiHost + "/api/user_history/saved?tref=".concat(tref));
  },
  _profiles: {},
  profileAPI: function profileAPI(slug) {
    return sefaria_Sefaria._cachedApiPromise({
      url: sefaria_Sefaria.apiHost + "/api/profile/" + slug,
      key: slug,
      store: sefaria_Sefaria._profiles
    });
  },
  userHistory: {
    loaded: false,
    items: []
  },
  saveUserHistory: function saveUserHistory(history_item) {
    // history_item contains:
    // `ref`, `book`, `versions`, `sheet_title`, `sheet_owner``
    // optionally: `secondary`, `he_ref`, `language`
    if (!sefaria_Sefaria.is_history_enabled || !history_item) {
      return;
    }
    var history_item_array = Array.isArray(history_item) ? history_item : [history_item];
    var _iterator6 = sefaria_createForOfIteratorHelper(history_item_array),
      _step6;
    try {
      for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {
        var h = _step6.value;
        h.time_stamp = sefaria_Sefaria.util.epoch_time();
      }
    } catch (err) {
      _iterator6.e(err);
    } finally {
      _iterator6.f();
    }
    if (sefaria_Sefaria._uid) {
      sefariaJquery.post(sefaria_Sefaria.apiHost + "/api/profile/sync?no_return=1&annotate=1", {
        user_history: JSON.stringify(history_item_array)
      }, function (data) {
        // Insert new items to beginning of history
        sefaria_Sefaria.userHistory.items = data.created.concat(sefaria_Sefaria.userHistory.items);
      });
    } else {
      // we need to get the heRef for each history item
      Promise.all(history_item_array.filter(function (x) {
        return !x.secondary;
      }).map(function (h) {
        return new Promise(function (resolve, reject) {
          sefaria_Sefaria.getRef(h.ref).then(function (oref) {
            h.he_ref = oref.heRef;
            resolve(h);
          });
        });
      })).then(function (new_hist_array) {
        var cookie = sefaria_Sefaria._inBrowser ? sefariaJquery.cookie : sefaria_Sefaria.util.cookie;
        var user_history_cookie = cookie("user_history");
        var user_history = !!user_history_cookie ? JSON.parse(user_history_cookie) : [];
        cookie("user_history", JSON.stringify(new_hist_array.concat(user_history)), {
          path: "/"
        });
        sefaria_Sefaria.userHistory.items = new_hist_array.concat(user_history);

        //console.log("saving history cookie", new_hist_array);
        if (sefaria_Sefaria._inBrowser) {
          // check if we've reached the cookie size limit
          var cookie_hist = JSON.parse(cookie("user_history"));
          if (cookie_hist.length < user_history.length + new_hist_array.length) {
            // save failed silently. resave by popping old history
            if (new_hist_array.length < user_history.length) {
              new_hist_array = new_hist_array.concat(user_history.slice(0, -new_hist_array.length));
            }
            cookie("user_history", JSON.stringify(new_hist_array), {
              path: "/"
            });
          }
        }
      });
    }
    sefaria_Sefaria.last_place = history_item_array.filter(function (x) {
      return !x.secondary;
    }).concat(sefaria_Sefaria.last_place); // while technically we should remove dup. books, this list is only used on client
  },

  uploadProfilePhoto: function uploadProfilePhoto(formData) {
    return new Promise(function (resolve, reject) {
      if (sefaria_Sefaria._uid) {
        sefariaJquery.ajax({
          url: sefaria_Sefaria.apiHost + "/api/profile/upload-photo",
          type: 'post',
          data: formData,
          contentType: false,
          processData: false,
          success: function success(data) {
            resolve(data);
          },
          error: function error(e) {
            console.log("photo upload ERROR", e);
            reject(e);
          }
        });
      }
    });
  },
  lastPlaceForText: function lastPlaceForText(title) {
    // Return the most recently visited item for text `title` or undefined if `title` is not present in last_place.
    return sefaria_Sefaria.last_place.find(function (x) {
      return x.book === title;
    });
  },
  _topicList: null,
  topicList: function topicList(callback) {
    var _this13 = this;
    // Returns promise for all topics list.
    if (this._topicList) {
      return Promise.resolve(this._topicList);
    }
    return this._ApiPromise(sefaria_Sefaria.apiHost + "/api/topics?limit=0").then(function (d) {
      var _iterator7 = sefaria_createForOfIteratorHelper(d),
        _step7;
      try {
        for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {
          var topic = _step7.value;
          topic.normTitles = topic.titles.map(function (title) {
            return title.text.toLowerCase();
          });
        }
      } catch (err) {
        _iterator7.e(err);
      } finally {
        _iterator7.f();
      }
      _this13._topicList = d;
      return d;
    });
  },
  sortTopicsCompareFn: function sortTopicsCompareFn(a, b) {
    // a compare function that is useful for sorting topics
    // Don't use display order intended for top level a category level. Bandaid for unclear semantics on displayOrder.
    var _map7 = [a, b].map(function (x) {
        return sefaria_Sefaria.isTopicTopLevel(x.slug) ? 10000 : x.displayOrder;
      }),
      _map8 = sefaria_slicedToArray(_map7, 2),
      aDisplayOrder = _map8[0],
      bDisplayOrder = _map8[1];

    // Sort alphabetically according to interface lang in absense of display order
    if (aDisplayOrder === bDisplayOrder) {
      var stripInitialPunctuation = function stripInitialPunctuation(str) {
        return str.replace(/^["#]/, "");
      };
      var _map9 = [a, b].map(function (x) {
          if (sefaria_Sefaria.interfaceLang === "hebrew") {
            return x.he.length ? stripInitialPunctuation(x.he) : "תתת" + stripInitialPunctuation(x.en);
          } else {
            return x.en.length ? stripInitialPunctuation(x.en) : stripInitialPunctuation(x.he);
          }
        }),
        _map10 = sefaria_slicedToArray(_map9, 2),
        aAlpha = _map10[0],
        bAlpha = _map10[1];
      return aAlpha < bAlpha ? -1 : 1;
    }
    return aDisplayOrder - bDisplayOrder;
  },
  _tableOfContentsDedications: {},
  _inAppAds: null,
  _stories: {
    stories: [],
    page: 0
  },
  _parashaNextRead: {},
  getParashaNextRead: function getParashaNextRead(parasha) {
    return this._cachedApiPromise({
      url: "".concat(this.apiHost, "/api/calendars/next-read/").concat(parasha),
      key: parasha,
      store: this._parashaNextRead
    });
  },
  _bookSearchPathFilter: {},
  bookSearchPathFilterAPI: function bookSearchPathFilterAPI(title) {
    return sefaria_Sefaria._cachedApiPromise({
      url: sefaria_Sefaria.apiHost + "/api/search-path-filter/" + title,
      key: title,
      store: sefaria_Sefaria._bookSearchPathFilter
    });
  },
  _topics: {},
  _topicPageSize: 70,
  // how many sources should show when incrementally loading sources
  _CAT_REF_LINK_TYPE_FILTER_MAP: {
    'authors': ['popular-writing-of']
  },
  getTopic: function getTopic(slug) {
    var _ref13 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
      _ref13$annotated = _ref13.annotated,
      annotated = _ref13$annotated === void 0 ? true : _ref13$annotated,
      _ref13$with_html = _ref13.with_html,
      with_html = _ref13$with_html === void 0 ? false : _ref13$with_html;
    var cat = sefaria_Sefaria.topicTocCategory(slug);
    var ref_link_type_filters = ['about', 'popular-writing-of'];
    // overwrite ref_link_type_filters with predefined list. currently used to hide "Sources" and "Sheets" on author pages.
    if (!!cat && !!sefaria_Sefaria._CAT_REF_LINK_TYPE_FILTER_MAP[cat.slug]) {
      ref_link_type_filters = sefaria_Sefaria._CAT_REF_LINK_TYPE_FILTER_MAP[cat.slug];
    }
    var a = 0 + annotated;
    var url = "".concat(this.apiHost, "/api/v2/topics/").concat(slug, "?annotate_time_period=1&ref_link_type_filters=").concat(ref_link_type_filters.join('|'), "&with_html=").concat(0 + with_html, "&with_links=").concat(a, "&annotate_links=").concat(a, "&with_refs=").concat(a, "&group_related=").concat(a, "&with_indexes=").concat(a);
    var key = this._getTopicCacheKey(slug, {
      annotated: annotated,
      with_html: with_html
    });
    return this._cachedApiPromise({
      url: url,
      key: key,
      store: this._topics,
      processor: this.processTopicsData
    });
  },
  _getTopicCacheKey: function _getTopicCacheKey(slug) {
    var _ref14 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
      _ref14$annotated = _ref14.annotated,
      annotated = _ref14$annotated === void 0 ? true : _ref14$annotated,
      _ref14$with_html = _ref14.with_html,
      with_html = _ref14$with_html === void 0 ? false : _ref14$with_html;
    return slug + (annotated ? "-a" : "") + (with_html ? "-h" : "");
  },
  processTopicsData: function processTopicsData(data) {
    if (!data) {
      return null;
    }
    if (!data.refs) {
      return data;
    }
    var tabs = {};
    for (var _i11 = 0, _Object$entries3 = Object.entries(data.refs); _i11 < _Object$entries3.length; _i11++) {
      var _ref15 = _Object$entries3[_i11];
      var _ref16 = sefaria_slicedToArray(_ref15, 2);
      var linkTypeSlug = _ref16[0];
      var linkTypeObj = _ref16[1];
      var _iterator8 = sefaria_createForOfIteratorHelper(linkTypeObj.refs),
        _step8;
      try {
        for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {
          var refObj = _step8.value;
          var tabKey = linkTypeSlug;
          if (tabKey === 'about') {
            tabKey = refObj.is_sheet ? 'sheets' : 'sources';
          }
          if (!tabs[tabKey]) {
            var title = linkTypeObj.title;
            if (tabKey === 'sheets') {
              title = {
                en: 'Sheets',
                he: sefaria_Sefaria._('Sheets')
              };
            }
            if (tabKey === 'sources') {
              title = {
                en: 'Sources',
                he: sefaria_Sefaria._('Sources')
              };
            }
            tabs[tabKey] = {
              refMap: {},
              title: title,
              shouldDisplay: linkTypeObj.shouldDisplay
            };
          }
          var ref = refObj.is_sheet ? parseInt(refObj.ref.replace('Sheet ', '')) : refObj.ref;
          if (refObj.order) {
            var _refObj$order, _refObj$order2, _refObj$order3, _refObj$order4, _refObj$order5, _refObj$order5$curate, _refObj$order6, _refObj$order6$curate;
            refObj.order = _objectSpread(_objectSpread({}, refObj.order), {}, {
              availableLangs: (refObj === null || refObj === void 0 ? void 0 : (_refObj$order = refObj.order) === null || _refObj$order === void 0 ? void 0 : _refObj$order.availableLangs) || [],
              numDatasource: (refObj === null || refObj === void 0 ? void 0 : (_refObj$order2 = refObj.order) === null || _refObj$order2 === void 0 ? void 0 : _refObj$order2.numDatasource) || 1,
              tfidf: (refObj === null || refObj === void 0 ? void 0 : (_refObj$order3 = refObj.order) === null || _refObj$order3 === void 0 ? void 0 : _refObj$order3.tfidf) || 0,
              pr: (refObj === null || refObj === void 0 ? void 0 : (_refObj$order4 = refObj.order) === null || _refObj$order4 === void 0 ? void 0 : _refObj$order4.pr) || 0,
              curatedPrimacy: {
                he: (refObj === null || refObj === void 0 ? void 0 : (_refObj$order5 = refObj.order) === null || _refObj$order5 === void 0 ? void 0 : (_refObj$order5$curate = _refObj$order5.curatedPrimacy) === null || _refObj$order5$curate === void 0 ? void 0 : _refObj$order5$curate.he) || 0,
                en: (refObj === null || refObj === void 0 ? void 0 : (_refObj$order6 = refObj.order) === null || _refObj$order6 === void 0 ? void 0 : (_refObj$order6$curate = _refObj$order6.curatedPrimacy) === null || _refObj$order6$curate === void 0 ? void 0 : _refObj$order6$curate.en) || 0
              }
            });
          }
          tabs[tabKey].refMap[refObj.ref] = {
            ref: ref,
            order: refObj.order,
            dataSources: refObj.dataSources,
            descriptions: refObj.descriptions
          };
        }
      } catch (err) {
        _iterator8.e(err);
      } finally {
        _iterator8.f();
      }
    }
    for (var _i12 = 0, _Object$values = Object.values(tabs); _i12 < _Object$values.length; _i12++) {
      var tabObj = _Object$values[_i12];
      tabObj.refs = Object.values(tabObj.refMap);
      delete tabObj.refMap;
    }
    data.tabs = tabs;
    return data;
  },
  getTopicFromCache: function getTopicFromCache(slug) {
    var _ref17 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
      _ref17$annotated = _ref17.annotated,
      annotated = _ref17$annotated === void 0 ? true : _ref17$annotated,
      _ref17$with_html = _ref17.with_html,
      with_html = _ref17$with_html === void 0 ? false : _ref17$with_html;
    var key = this._getTopicCacheKey(slug, {
      annotated: annotated,
      with_html: with_html
    });
    return this._topics[key];
  },
  _topicSlugsToTitles: null,
  slugsToTitles: function slugsToTitles() {
    //initializes _topicSlugsToTitles for Topic Editor tool and adds necessary "Choose a Category" and "Main Menu" for
    //proper use of the Topic Editor tool
    if (!sefaria_Sefaria._topicSlugsToTitles) {
      this._topicSlugsToTitles = sefaria_Sefaria.topic_toc.reduce(sefaria_Sefaria._initTopicTocSlugToTitleReducer, {});
    }
    return sefaria_Sefaria._topicSlugsToTitles;
  },
  _topicTocPages: null,
  _initTopicTocPages: function _initTopicTocPages() {
    this._topicTocPages = this.topic_toc.reduce(this._initTopicTocReducer, {});
    this._topicTocPages[this._topicTocPageKey()] = this.topic_toc.map(function (_ref18) {
      var children = _ref18.children,
        goodstuff = _objectWithoutProperties(_ref18, _excluded);
      return goodstuff;
    });
  },
  _initTopicTocReducer: function _initTopicTocReducer(a, c) {
    if (!c.children) {
      return a;
    }
    a[sefaria_Sefaria._topicTocPageKey(c.slug)] = c.children;
    var _iterator9 = sefaria_createForOfIteratorHelper(c.children),
      _step9;
    try {
      for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {
        var sub_c = _step9.value;
        sefaria_Sefaria._initTopicTocReducer(a, sub_c);
      }
    } catch (err) {
      _iterator9.e(err);
    } finally {
      _iterator9.f();
    }
    return a;
  },
  _initTopicTocSlugToTitleReducer: function _initTopicTocSlugToTitleReducer(a, c) {
    if (!c.children) {
      return a;
    }
    a[c.slug] = {
      "en": c.en,
      "he": c.he
    };
    var _iterator10 = sefaria_createForOfIteratorHelper(c.children),
      _step10;
    try {
      for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {
        var sub_c = _step10.value;
        sefaria_Sefaria._initTopicTocSlugToTitleReducer(a, sub_c);
      }
    } catch (err) {
      _iterator10.e(err);
    } finally {
      _iterator10.f();
    }
    return a;
  },
  _topicTocCategory: null,
  _initTopicTocCategory: function _initTopicTocCategory() {
    this._topicTocCategory = this.topic_toc.reduce(this._initTopicTocCategoryReducer, {});
  },
  _initTopicTocCategoryReducer: function _initTopicTocCategoryReducer(a, c) {
    if (!c.children) {
      a[c.slug] = c.parent;
      return a;
    }
    var _iterator11 = sefaria_createForOfIteratorHelper(c.children),
      _step11;
    try {
      for (_iterator11.s(); !(_step11 = _iterator11.n()).done;) {
        var sub_c = _step11.value;
        sub_c.parent = {
          en: c.en,
          he: c.he,
          slug: c.slug
        };
        sefaria_Sefaria._initTopicTocCategoryReducer(a, sub_c);
      }
    } catch (err) {
      _iterator11.e(err);
    } finally {
      _iterator11.f();
    }
    return a;
  },
  _topicTocPageKey: function _topicTocPageKey(slug) {
    return "_" + slug;
  },
  topicTocPage: function topicTocPage(parent) {
    var key = this._topicTocPageKey(parent);
    if (!this._topicTocPages) {
      this._initTopicTocPages();
    }
    return this._topicTocPages[key];
  },
  topicTocCategory: function topicTocCategory(slug) {
    // return category english and hebrew for slug
    if (!this._topicTocCategory) {
      this._initTopicTocCategory();
    }
    return this._topicTocCategory[slug];
  },
  _topicTocCategoryTitles: null,
  _initTopicTocCategoryTitles: function _initTopicTocCategoryTitles() {
    this._topicTocCategoryTitles = this.topic_toc.reduce(this._initTopicTocCategoryTitlesReducer, {});
  },
  _initTopicTocCategoryTitlesReducer: function _initTopicTocCategoryTitlesReducer(a, c) {
    if (!c.children) {
      return a;
    }
    a[c.slug] = {
      en: c.en,
      he: c.he
    };
    var _iterator12 = sefaria_createForOfIteratorHelper(c.children),
      _step12;
    try {
      for (_iterator12.s(); !(_step12 = _iterator12.n()).done;) {
        var sub_c = _step12.value;
        sefaria_Sefaria._initTopicTocCategoryReducer(a, sub_c);
      }
    } catch (err) {
      _iterator12.e(err);
    } finally {
      _iterator12.f();
    }
    return a;
  },
  topicTocCategoryTitle: function topicTocCategoryTitle(slug) {
    // returns english and hebrew titles for the topic category named by `slug``
    if (!this._topicTocCategoryTitles) {
      this._initTopicTocCategoryTitles();
    }
    return this._topicTocCategoryTitles[slug];
  },
  isTopicTopLevel: function isTopicTopLevel(slug) {
    // returns true is `slug` is part of the top level of topic toc
    return sefaria_Sefaria.topic_toc.filter(function (x) {
      return x.slug == slug;
    }).length > 0;
  },
  sheets: {
    _loadSheetByID: {},
    loadSheetByID: function loadSheetByID(id, callback, reset) {
      var _this14 = this;
      if (reset) {
        delete this._loadSheetByID[id];
      }
      var sheet = this._loadSheetByID[id];
      if (sheet) {
        if (callback) {
          callback(sheet);
        }
      } else if (callback) {
        var url = "/api/sheets/" + id + "?more_data=1";
        sefariaJquery.getJSON(url, function (data) {
          if ("error" in data) {
            console.log(data["error"]);
          }
          _this14._loadSheetByID[id] = data;
          callback(data);
          callback(data);
        });
      }
      return sheet;
    },
    deleteSheetById: function deleteSheetById(id) {
      return sefaria_Sefaria._ApiPromise("/api/sheets/".concat(id, "/delete"));
    },
    _userSheets: {},
    userSheets: function userSheets(uid, callback) {
      var _this15 = this;
      var sortBy = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "date";
      var offset = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
      var numberToRetrieve = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
      // Returns a list of source sheets belonging to `uid`
      // Only a user logged in as `uid` will get private data from this API.
      // Otherwise, only public data will be returned
      var key = uid + "|" + sortBy + offset + numberToRetrieve;
      var sheets = this._userSheets[key];
      if (sheets) {
        if (callback) {
          callback(sheets);
        }
      } else {
        var url = sefaria_Sefaria.apiHost + "/api/sheets/user/" + uid + "/" + sortBy + "/" + numberToRetrieve + "/" + offset;
        sefaria_Sefaria._ApiPromise(url).then(function (data) {
          _this15._userSheets[key] = data.sheets;
          if (callback) {
            callback(data.sheets);
          }
        });
      }
      return sheets;
    },
    updateUserSheets: function updateUserSheets(sheet, uid) {
      var update = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
      var updateInPlace = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
      for (var key in this._userSheets) {
        if (key.startsWith(uid.toString() + "|")) {
          if (update) {
            var sheetIndex = this._userSheets[key].findIndex(function (item) {
              return item.id === sheet.id;
            });
            if (key.includes("date") && !updateInPlace) {
              //add to front because we sorted by date
              this._userSheets[key].splice(sheetIndex, 1);
              this._userSheets[key].unshift(sheet);
            } else if (updateInPlace) {
              this._userSheets[key][sheetIndex] = sheet;
            } else {
              this._userSheets[key].unshift(sheet);
            }
          } else {
            this._userSheets[key].push(sheet);
          }
        }
      }
    },
    clearUserSheets: function clearUserSheets(uid) {
      var _this16 = this;
      this._userSheets = Object.keys(this._userSheets).filter(function (key) {
        return !key.startsWith(uid.toString());
      }).reduce(function (obj, key) {
        return _objectSpread(_objectSpread({}, obj), {}, sefaria_defineProperty({}, key, _this16._userSheets[key]));
      }, {});
    },
    _publicSheets: {},
    publicSheets: function publicSheets(offset, limit, options, skipCache, callback) {
      // Returns a list of public sheets
      offset = offset || 0;
      limit = limit || 30;
      options = options || {};
      var params = param(options);
      var path = limit + "/" + offset + (params ? "?" + params : "");
      var sheets = this._publicSheets[path];
      if (sheets && !skipCache) {
        if (callback) {
          callback(sheets);
        }
      } else {
        var url = sefaria_Sefaria.apiHost + "/api/sheets/all-sheets/" + path;
        sefaria_Sefaria._api(url, function (data) {
          this._publicSheets[path] = data.sheets;
          if (callback) {
            callback(data.sheets);
          }
        }.bind(this));
      }
      return sheets;
    },
    _sheetsByRef: {},
    sheetsByRef: function sheetsByRef(ref, cb) {
      // Returns a list of public sheets that include `ref`.
      var sheets = null;
      if (typeof ref == "string") {
        if (ref in this._sheetsByRef) {
          sheets = this._sheetsByRef[ref];
        }
      } else {
        var sheets = [];
        ref.map(function (r) {
          var newSheets = sefaria_Sefaria.sheets.sheetsByRef(r);
          if (newSheets) {
            sheets = sheets.concat(newSheets);
          }
        });
        // sheets anchored to spanning refs may cause duplicates
        var seen = {};
        var deduped = [];
        sheets.map(function (sheet) {
          if (!seen[sheet.id]) {
            deduped.push(sheet);
          }
          seen[sheet.id] = true;
        });
        sheets = deduped;
      }
      if (sheets) {
        if (cb) {
          cb(sheets);
        }
      } else {
        sefaria_Sefaria.related(ref, function (data) {
          if (cb) {
            cb(data.sheets);
          }
        });
      }
      return sheets;
    },
    _saveSheetsByRefData: function _saveSheetsByRefData(ref, data) {
      this._sheetsByRef[ref] = data;
      return sefaria_Sefaria._saveItemsByRef(data, this._sheetsByRef);
    },
    _userSheetsByRef: {},
    userSheetsByRef: function userSheetsByRef(ref, cb) {
      // Returns a list of public sheets that include `ref`.
      var sheets = null;
      if (typeof ref == "string") {
        if (ref in this._userSheetsByRef) {
          sheets = this._userSheetsByRef[ref];
        }
      } else {
        var sheets = [];
        ref.map(function (r) {
          var newSheets = sefaria_Sefaria.sheets.userSheetsByRef(r);
          if (newSheets) {
            sheets = sheets.concat(newSheets);
          }
        });
      }
      if (sheets) {
        if (cb) {
          cb(sheets);
        }
      } else {
        sefaria_Sefaria.relatedPrivate(ref, function (data) {
          if (cb) {
            cb(data.sheets);
          }
        });
      }
      return sheets;
    },
    _saveUserSheetsByRefData: function _saveUserSheetsByRefData(ref, data) {
      this._userSheetsByRef[ref] = data;
      return sefaria_Sefaria._saveItemsByRef(data, this._userSheetsByRef);
    },
    sheetsTotalCount: function sheetsTotalCount(refs) {
      // Returns the total number of private and public sheets on `refs` without double counting my public sheets.
      var sheets = sefaria_Sefaria.sheets.sheetsByRef(refs) || [];
      if (sefaria_Sefaria._uid) {
        var mySheets = sefaria_Sefaria.sheets.userSheetsByRef(refs) || [];
        sheets = sheets.filter(function (sheet) {
          return sheet.owner !== sefaria_Sefaria._uid;
        }).concat(mySheets);
      }
      return sheets.length;
    },
    extractIdFromSheetRef: function extractIdFromSheetRef(ref) {
      return typeof ref === "string" ? parseInt(ref.split(" ")[1]) : parseInt(ref[0].split(" ")[1]);
    }
  },
  _translations: {},
  getTranslation: function getTranslation(key) {
    var url = sefaria_Sefaria.apiHost + "/api/texts/translations/" + key;
    var store = this._translations;
    return this._cachedApiPromise({
      url: url,
      key: key,
      store: store
    });
  },
  _collections: {},
  getCollection: function getCollection(key) {
    var url = sefaria_Sefaria.apiHost + "/api/collections/" + encodeURIComponent(key);
    var store = this._collections;
    return this._cachedApiPromise({
      url: url,
      key: key,
      store: store
    });
  },
  getCollectionFromCache: function getCollectionFromCache(key) {
    return sefaria_Sefaria._collections[key];
  },
  _collectionsList: {},
  getCollectionsList: function getCollectionsList() {
    return this._cachedApiPromise({
      url: sefaria_Sefaria.apiHost + "/api/collections",
      key: "list",
      store: sefaria_Sefaria._collectionsList
    });
  },
  getCollectionsListFromCache: function getCollectionsListFromCache() {
    return sefaria_Sefaria._collectionsList.list;
  },
  _userCollections: {},
  getUserCollections: function getUserCollections(uid) {
    return this._cachedApiPromise({
      url: "".concat(sefaria_Sefaria.apiHost, "/api/collections/user-collections/").concat(uid),
      key: uid,
      store: sefaria_Sefaria._userCollections
    });
  },
  getUserCollectionsFromCache: function getUserCollectionsFromCache(uid) {
    return sefaria_Sefaria._userCollections[uid];
  },
  _userCollectionsForSheet: {},
  getUserCollectionsForSheet: function getUserCollectionsForSheet(sheetID) {
    return this._cachedApiPromise({
      url: "".concat(sefaria_Sefaria.apiHost, "/api/collections/for-sheet/").concat(sheetID),
      key: sheetID,
      store: sefaria_Sefaria._userCollectionsForSheet
    });
  },
  getUserCollectionsForSheetFromCache: function getUserCollectionsForSheetFromCache(sheetID) {
    return sefaria_Sefaria._userCollectionsForSheet[sheetID];
  },
  getBackgroundData: function getBackgroundData() {
    return sefaria_Sefaria._ApiPromise("/api/background-data?locale=" + sefaria_Sefaria.interfaceLang).then(function (data) {
      sefaria_Sefaria = extend(sefaria_Sefaria, data);
    });
  },
  calendarRef: function calendarRef(calendarTitle) {
    var cal = sefaria_Sefaria.calendars.filter(function (cal) {
      return cal.title.en === calendarTitle;
    });
    return cal.length ? cal[0].ref : null;
  },
  _translateTerms: {},
  _cacheHebrewTerms: function _cacheHebrewTerms(terms) {
    sefaria_Sefaria._translateTerms = extend(terms, sefaria_Sefaria._translateTerms);
  },
  hebrewTerm: function hebrewTerm(name) {
    // Returns a string translating `name` into Hebrew.
    var categories = {
      "Quoting Commentary": "פרשנות מצטטת",
      "Modern Commentary": "פרשנות מודרנית",
      "Sheets": "דפי מקורות",
      "Notes": "הערות",
      "Community": "קהילה"
    };
    if (name in sefaria_Sefaria._translateTerms) {
      return sefaria_Sefaria._translateTerms[name]["he"];
    } else if (sefaria_Sefaria._translateVersions[sefaria_Sefaria.getTranslateVersionsKey(name, 'en')]) {
      return sefaria_Sefaria._translateVersions[sefaria_Sefaria.getTranslateVersionsKey(name, 'en')]["he"];
    } else if (sefaria_Sefaria._translateVersions[sefaria_Sefaria.getTranslateVersionsKey(name, 'he')]) {
      return sefaria_Sefaria._translateVersions[sefaria_Sefaria.getTranslateVersionsKey(name, 'he')]["he"];
    } else if (name in categories) {
      return categories[name];
    } else if (sefaria_Sefaria.index(name)) {
      return sefaria_Sefaria.index(name).heTitle;
    } else {
      return name;
    }
  },
  hebrewTranslation: function hebrewTranslation(inputStr) {
    var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    var translatedString;
    if (context && context in sefaria_Sefaria._i18nInterfaceStringsWithContext) {
      translatedString = sefaria_Sefaria._getStringCaseInsensitive(sefaria_Sefaria._i18nInterfaceStringsWithContext[context], inputStr);
      if (translatedString !== null) return translatedString;
    }
    if ((translatedString = sefaria_Sefaria._getStringCaseInsensitive(sefaria_Sefaria._i18nInterfaceStrings, inputStr)) !== null) {
      return translatedString;
    }
    if ((translatedString = sefaria_Sefaria.hebrewTerm(inputStr)) != inputStr) {
      return translatedString;
    }
    if (inputStr.indexOf(" | ") !== -1) {
      var inputStrs = inputStr.split(" | ");
      return sefaria_Sefaria._(inputStrs[0]) + " | " + sefaria_Sefaria._(inputStrs[1]);
    } else {
      //console.warn("Missing Hebrew translation for: " + inputStr);
      return inputStr;
    }
  },
  translation: function translation(language, inputStr) {
    var context = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    var translationMatrix = {
      "he": sefaria_Sefaria.hebrewTranslation
    };
    try {
      return translationMatrix[language.slice(0, 2)](inputStr, context);
    } catch (e) {
      console.warn("No transaltion available for " + language);
      return inputStr;
    }
  },
  _: function _(inputStr) {
    var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    if (sefaria_Sefaria.interfaceLang != "english") {
      return sefaria_Sefaria.translation(sefaria_Sefaria.interfaceLang, inputStr, context);
    } else {
      return inputStr;
    }
  },
  _v: function _v(langOptions) {
    /* Takes an object {en: "something", he: "משהו"}
     * and returns the correct one according to interface language
     * Convenience method for when there are two data variables in an object one wishes to return
     * according to interface, in places where HTML is not allowed (inside <options> tag for ex.
    */
    var lang = sefaria_Sefaria.interfaceLang.slice(0, 2);
    return langOptions[lang] ? langOptions[lang] : "";
  },
  _r: function _r(inputRef) {
    var oref = sefaria_Sefaria.getRefFromCache(inputRef);
    if (!oref) {
      return inputRef;
    }
    return sefaria_Sefaria.interfaceLang != "english" ? oref.heRef : oref.ref;
  },
  _getStringCaseInsensitive: function _getStringCaseInsensitive(store, inputStr) {
    if (inputStr in store) {
      return store[inputStr];
    } else if (inputStr.toLowerCase() in store) {
      return store[inputStr.toLowerCase()];
    } else return null;

    //return inputStr in store ? store[inputStr] : (inputStr.toLowerCase() in store ? store[inputStr.toLowerCase()]
    // : null);
  },

  _cacheSiteInterfaceStrings: function _cacheSiteInterfaceStrings() {
    // Ensure that names set in Site Settings are available for translation in JS.
    if (!sefaria_Sefaria._siteSettings) {
      return;
    }
    ["SITE_NAME", "LIBRARY_NAME"].map(function (key) {
      sefaria_Sefaria._i18nInterfaceStrings[sefaria_Sefaria._siteSettings[key]["en"]] = sefaria_Sefaria._siteSettings[key]["he"];
    });
  },
  _makeBooksDict: function _makeBooksDict() {
    // Transform books array into a dictionary for quick lookup
    // Which is worse: the cycles wasted in computing this on the client
    // or the bandwidth wasted in letting the server computer once and transmitting the same data twice in different form?
    this.booksDict = {};
    for (var i = 0; i < this.books.length; i++) {
      this.booksDict[this.books[i]] = 1;
    }
  },
  _ajaxObjects: {},
  // These are jqXHR objects, which implement the Promise interface
  _api: function _api(url, callback) {
    // Manage API calls and callbacks to prevent duplicate calls
    // This method will be deprecated, in favor of _ApiPromise
    //
    if (url in this._ajaxObjects) {
      return this._ajaxObjects[url].then(callback);
    }
    return this._ApiPromise(url).then(callback);
  },
  _ApiPromise: function _ApiPromise(url) {
    var _this17 = this;
    // Uses same _ajaxObjects as _api
    // Use built in Promise logic to handle multiple .then()s
    if (url in this._ajaxObjects) {
      return this._ajaxObjects[url];
    }
    this._ajaxObjects[url] = sefariaJquery.getJSON(url).always(function (_) {
      delete _this17._ajaxObjects[url];
    });
    return this._ajaxObjects[url];
  },
  _cachedApi: function _cachedApi(key, store, defaultVal) {
    return key in store ? store[key] : defaultVal;
  },
  _cachedApiPromise: function _cachedApiPromise(_ref19) {
    var url = _ref19.url,
      key = _ref19.key,
      store = _ref19.store,
      processor = _ref19.processor;
    // Checks store[key].  Resolves to this value, if present.
    // Otherwise, calls Promise(url), caches in store[key], and returns
    return key in store ? Promise.resolve(store[key]) : sefaria_Sefaria._ApiPromise(url).then(function (data) {
      if (processor) {
        data = processor(data);
      }
      store[key] = data;
      return data;
    });
  },
  //  https://reactjs.org/blog/2015/12/16/ismounted-antipattern.html
  makeCancelable: function makeCancelable(promise) {
    var hasCanceled_ = false;
    var wrappedPromise = new Promise(function (resolve, reject) {
      promise.then(function (val) {
        return hasCanceled_ ? reject({
          isCanceled: true
        }) : resolve(val);
      }, function (error) {
        return hasCanceled_ ? reject({
          isCanceled: true
        }) : reject(error);
      });
    });
    return {
      promise: wrappedPromise,
      cancel: function cancel() {
        hasCanceled_ = true;
      }
    };
  },
  incrementalPromise: function () {
    var _incrementalPromise = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(fetchResponse, data, increment, setResponse, setCancel) {
      var lastEndIndex, _loop;
      return _regeneratorRuntime().wrap(function _callee4$(_context5) {
        while (1) switch (_context5.prev = _context5.next) {
          case 0:
            /*
            fetchResponse - func that takes slice of `data` as param and returns promise
            data - array of input data for fetchResponse
            increment - int, how many values to send to fetchResponse at a time
            setResponse - callback to react to send updated results
            setCancel - function that saves cancel function so it can be called in outside scope
            */
            lastEndIndex = 0;
            _loop = /*#__PURE__*/_regeneratorRuntime().mark(function _loop() {
              var tempData, _Sefaria$makeCancelab, promise, cancel, tempResponses;
              return _regeneratorRuntime().wrap(function _loop$(_context4) {
                while (1) switch (_context4.prev = _context4.next) {
                  case 0:
                    tempData = data.slice(lastEndIndex, lastEndIndex + increment);
                    _Sefaria$makeCancelab = sefaria_Sefaria.makeCancelable(fetchResponse(tempData)), promise = _Sefaria$makeCancelab.promise, cancel = _Sefaria$makeCancelab.cancel;
                    setCancel(cancel);
                    _context4.next = 5;
                    return promise;
                  case 5:
                    tempResponses = _context4.sent;
                    setResponse(function (prevResponses) {
                      return !prevResponses ? tempResponses : prevResponses.concat(tempResponses);
                    });
                    lastEndIndex += increment;
                  case 8:
                  case "end":
                    return _context4.stop();
                }
              }, _loop);
            });
          case 2:
            if (!(lastEndIndex <= data.length)) {
              _context5.next = 6;
              break;
            }
            return _context5.delegateYield(_loop(), "t0", 4);
          case 4:
            _context5.next = 2;
            break;
          case 6:
          case "end":
            return _context5.stop();
        }
      }, _callee4);
    }));
    function incrementalPromise(_x5, _x6, _x7, _x8, _x9) {
      return _incrementalPromise.apply(this, arguments);
    }
    return incrementalPromise;
  }()
});
sefaria_Sefaria.unpackDataFromProps = function (props) {
  // Populate local cache with various data passed as props.
  var initialPanels = props.initialPanels || [];
  for (var i = 0; i < initialPanels.length; i++) {
    var panel = initialPanels[i];
    if (panel.text) {
      var _panel$text, _panel$text$versions;
      var settings = {
        context: 1,
        enVersion: panel.enVersion,
        heVersion: panel.heVersion
      };
      //save versions first, so their new format is also saved on text cache
      if ((_panel$text = panel.text) !== null && _panel$text !== void 0 && (_panel$text$versions = _panel$text.versions) !== null && _panel$text$versions !== void 0 && _panel$text$versions.length) {
        var versions = sefaria_Sefaria._saveVersions(panel.text.sectionRef, panel.text.versions);
        panel.text.versions = sefaria_Sefaria._makeVersions(versions, false);
      }
      sefaria_Sefaria._saveText(panel.text, settings);
    }
    if (panel.bookRef) {
      var _panel$versions;
      if ((_panel$versions = panel.versions) !== null && _panel$versions !== void 0 && _panel$versions.length) {
        var _versions = sefaria_Sefaria._saveVersions(panel.bookRef, panel.versions);
        panel.versions = sefaria_Sefaria._makeVersions(_versions, false);
      }
    }
    if (panel.indexDetails) {
      sefaria_Sefaria._indexDetails[panel.bookRef] = panel.indexDetails;
    }
    if (panel.sheet) {
      sefaria_Sefaria.sheets._loadSheetByID[panel.sheet.id] = panel.sheet;
    }
  }
  if (props.collectionData) {
    sefaria_Sefaria._collections[props.initialCollectionSlug] = props.collectionData;
  }
  if (props.translationsData) {
    sefaria_Sefaria._translations[props.initialTranslationsSlug] = props.translationsData;
  }
  if (props.topicData) {
    sefaria_Sefaria._topics[props.initialTopic] = sefaria_Sefaria.processTopicsData(props.topicData);
  }
  if (props.topicList) {
    sefaria_Sefaria._topicList = props.topicList;
  }
  if (props.collectionListing) {
    sefaria_Sefaria._collectionsList.list = props.collectionListing;
  }
  sefaria_Sefaria.versionPreferences = new sefaria_VersionPreferences(props.versionPrefsByCorpus);
  sefaria_Sefaria.util._initialPath = props.initialPath ? props.initialPath : "/";
  sefaria_Sefaria.unpackBaseProps(props);
  sefaria_Sefaria.getBackgroundData();
};
sefaria_Sefaria.unpackBaseProps = function (props) {
  //TODO: verify these are all base props!!!
  if (typeof props === 'undefined') {
    return;
  }
  var dataPassedAsProps = ["_uid", "_email", "_uses_new_editor", "slug", "is_moderator", "is_editor", "full_name", "profile_pic_url", "is_history_enabled", "translation_language_preference_suggestion", "following", "blocking", "calendars", "notificationCount", "notifications", "saved", "userHistory", "last_place", "interfaceLang", "multiPanel", "interruptingMessage", "community", "followRecommendations", "trendingTopics", "_siteSettings", "_debug"];
  for (var _i13 = 0, _dataPassedAsProps = dataPassedAsProps; _i13 < _dataPassedAsProps.length; _i13++) {
    var element = _dataPassedAsProps[_i13];
    if (element in props) {
      sefaria_Sefaria[element] = props[element];
    }
  }
};
sefaria_Sefaria.loadServerData = function (data) {
  // data parameter is optional. in the event it isn't passed, we assume that DJANGO_DATA_VARS exists as a global var
  // data should but defined server-side and undefined client-side
  //TODO: Can we get rid of this global scope thing?
  if (typeof data === "undefined") {
    data = typeof DJANGO_DATA_VARS === "undefined" ? undefined : DJANGO_DATA_VARS;
  }
  if (typeof data !== 'undefined') {
    for (var _i14 = 0, _Object$entries4 = Object.entries(data); _i14 < _Object$entries4.length; _i14++) {
      var _ref20 = _Object$entries4[_i14];
      var _ref21 = sefaria_slicedToArray(_ref20, 2);
      var key = _ref21[0];
      var value = _ref21[1];
      this[key] = value;
    }
  }
};
sefaria_Sefaria.util = util;
sefaria_Sefaria.hebrew = hebrew;
sefaria_Sefaria.track = track;
sefaria_Sefaria.palette = sefaria_palette;
sefaria_Sefaria.palette.indexColor = function (title) {
  return title && sefaria_Sefaria.index(title) ? sefaria_Sefaria.index(title)['primary_category'] ? sefaria_Sefaria.palette.categoryColor(sefaria_Sefaria.index(title)['primary_category']) : sefaria_Sefaria.palette.categoryColor(sefaria_Sefaria.index(title).categories[0]) : sefaria_Sefaria.palette.categoryColor("Other");
};
sefaria_Sefaria.palette.refColor = function (ref) {
  return sefaria_Sefaria.palette.indexColor(sefaria_Sefaria.parseRef(ref).index);
};
sefaria_Sefaria = extend(sefaria_Sefaria, strings);
sefaria_Sefaria.setup = function (data) {
  var props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
  sefaria_Sefaria.loadServerData(data);
  var baseProps = props != null ? props : typeof DJANGO_VARS === "undefined" ? undefined : DJANGO_VARS.props;
  sefaria_Sefaria.unpackBaseProps(baseProps);
  sefaria_Sefaria.util.setupPrototypes();
  sefaria_Sefaria.util.setupMisc();
  var cookie = sefaria_Sefaria.util.handleUserCookie(sefaria_Sefaria._uid);
  // And store current uid in analytics id
  sefaria_Sefaria._analytics_uid = sefaria_Sefaria._uid;
  sefaria_Sefaria._makeBooksDict();
  sefaria_Sefaria._cacheFromToc(sefaria_Sefaria.toc);
  sefaria_Sefaria._cacheHebrewTerms(sefaria_Sefaria.terms);
  sefaria_Sefaria._cacheSiteInterfaceStrings();
  //console.log(`sending user logged in status to GA, uid as bool: ${!!Sefaria._uid} | analytics id: ${Sefaria._analytics_uid}`);
  sefaria_Sefaria.track.setUserData(!!sefaria_Sefaria._uid, sefaria_Sefaria._analytics_uid);
  sefaria_Sefaria.search = new search(sefaria_Sefaria.searchIndexText, sefaria_Sefaria.searchIndexSheet);
};
sefaria_Sefaria.setup();
/* harmony default export */ const sefaria = (sefaria_Sefaria);
;// CONCATENATED MODULE: external "react-dom"
const external_react_dom_namespaceObject = require("react-dom");
var external_react_dom_default = /*#__PURE__*/__webpack_require__.n(external_react_dom_namespaceObject);
;// CONCATENATED MODULE: external "react-class"
const external_react_class_namespaceObject = require("react-class");
var external_react_class_default = /*#__PURE__*/__webpack_require__.n(external_react_class_namespaceObject);
;// CONCATENATED MODULE: ../static/js/CollectionsWidget.jsx
function CollectionsWidget_toConsumableArray(arr) { return CollectionsWidget_arrayWithoutHoles(arr) || CollectionsWidget_iterableToArray(arr) || CollectionsWidget_unsupportedIterableToArray(arr) || CollectionsWidget_nonIterableSpread(); }
function CollectionsWidget_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function CollectionsWidget_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function CollectionsWidget_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return CollectionsWidget_arrayLikeToArray(arr); }
function CollectionsWidget_slicedToArray(arr, i) { return CollectionsWidget_arrayWithHoles(arr) || CollectionsWidget_iterableToArrayLimit(arr, i) || CollectionsWidget_unsupportedIterableToArray(arr, i) || CollectionsWidget_nonIterableRest(); }
function CollectionsWidget_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function CollectionsWidget_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return CollectionsWidget_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return CollectionsWidget_arrayLikeToArray(o, minLen); }
function CollectionsWidget_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function CollectionsWidget_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function CollectionsWidget_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }



var CollectionsModal = function CollectionsModal(props) {
  // A CollectionsWidget as a modal
  var onClose = function onClose() {
    props.handleCollectionsChange && props.handleCollectionsChange();
    props.close();
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "collectionsModalBox"
  }, /*#__PURE__*/React.createElement("div", {
    className: "whiteOverlay",
    onClick: onClose
  }), /*#__PURE__*/React.createElement(CollectionsWidget, props));
};
var CollectionsWidget = function CollectionsWidget(_ref) {
  var sheetID = _ref.sheetID,
    close = _ref.close,
    handleCollectionsChange = _ref.handleCollectionsChange;
  // A box that lets you control which of your collections `sheetID` belongs to

  var initialCollectionsSort = function initialCollectionsSort(cs, csSelected) {
    // When first opened, sort checked collections to top, but don't reshuffle when user clicks check of open modal
    if (!cs || !csSelected) {
      return null;
    }
    return cs.sort(function (a, b) {
      var aSel, bSel;
      var _map = [a, b].map(function (x) {
        return !!csSelected.filter(function (y) {
          return y.slug === x.slug;
        }).length;
      });
      var _map2 = CollectionsWidget_slicedToArray(_map, 2);
      aSel = _map2[0];
      bSel = _map2[1];
      if (aSel == bSel) {
        return a.lastModified > b.lastModified ? -1 : 1;
      } else {
        return aSel ? -1 : 1;
      }
    });
  };
  var _useState = (0,external_react_.useState)(sefaria.getUserCollectionsForSheetFromCache(sheetID)),
    _useState2 = CollectionsWidget_slicedToArray(_useState, 2),
    collectionsSelected = _useState2[0],
    setCollectionsSelected = _useState2[1];
  var initialCollections = sefaria.getUserCollectionsFromCache(sefaria._uid);
  initialCollections = initialCollections ? initialCollectionsSort(initialCollections.slice(), collectionsSelected) : null;
  var _useState3 = (0,external_react_.useState)(initialCollections),
    _useState4 = CollectionsWidget_slicedToArray(_useState3, 2),
    collections = _useState4[0],
    setCollections = _useState4[1];
  var _useState5 = (0,external_react_.useState)(!!collections && !!collectionsSelected),
    _useState6 = CollectionsWidget_slicedToArray(_useState5, 2),
    dataLoaded = _useState6[0],
    setDataLoaded = _useState6[1];
  var _useState7 = (0,external_react_.useState)(""),
    _useState8 = CollectionsWidget_slicedToArray(_useState7, 2),
    newName = _useState8[0],
    setNewName = _useState8[1];
  var _useState9 = (0,external_react_.useState)(false),
    _useState10 = CollectionsWidget_slicedToArray(_useState9, 2),
    changed = _useState10[0],
    setChanged = _useState10[1];

  // Make sure we have loaded the user's list of collections, 
  // and which collections this sheet belongs to for this user
  (0,external_react_.useEffect)(function () {
    if (!dataLoaded) {
      Promise.all([sefaria.getUserCollections(sefaria._uid), sefaria.getUserCollectionsForSheet(sheetID)]).then(function () {
        var initialCollectionsSelected = sefaria.getUserCollectionsForSheetFromCache(sheetID);
        var initialSortedCollections = initialCollectionsSort(sefaria.getUserCollectionsFromCache(sefaria._uid), initialCollectionsSelected);
        setCollections(initialSortedCollections);
        setCollectionsSelected(initialCollectionsSelected);
        setDataLoaded(true);
      });
    }
  }, []);
  var onCheckChange = function onCheckChange(collection, checked) {
    // When a checkmark changes, add or remove this sheet from that collection
    var url, newCollectionsSelected;
    if (checked) {
      newCollectionsSelected = [].concat(CollectionsWidget_toConsumableArray(collectionsSelected), [collection]);
      url = "/api/collections/".concat(collection.slug, "/add/").concat(sheetID);
    } else {
      newCollectionsSelected = collectionsSelected.filter(function (x) {
        return x.slug !== collection.slug;
      });
      url = "/api/collections/".concat(collection.slug, "/remove/").concat(sheetID);
    }
    $.post(url, function (data) {
      return handleCollectionInclusionChange(data);
    });
    sefaria._userCollectionsForSheet[sheetID] = newCollectionsSelected;
    setCollectionsSelected(newCollectionsSelected);
  };
  var handleCollectionInclusionChange = function handleCollectionInclusionChange(data) {
    // When a sheet has been added or removed, update collections list data in cache
    var newCollections = sefaria.getUserCollectionsFromCache(sefaria._uid).filter(function (c) {
      return c.slug != data.collection.slug;
    });
    // Put the new collection first since it's just been modified
    newCollections = [data.collectionListing].concat(CollectionsWidget_toConsumableArray(newCollections));
    // Update in cache, but not in Component state -- prevents the list from jumping around
    // while you're looking at it, but show this collection first next time you see the list.
    sefaria._userCollections[sefaria._uid] = newCollections;
    // Update cache for this collection's full listing, which has now changed
    sefaria._collections[data.collection.slug] = data.collection;
    // Update sheet cache
    sefaria.sheets._loadSheetByID[sheetID] = data.sheet;
    sefaria.sheets.updateUserSheets(data.sheetListing, sefaria._uid, true, true);
    setChanged(true);
  };
  var onNameChange = function onNameChange(event) {
    return setNewName(event.target.value);
  };
  var onCreateClick = function onCreateClick() {
    var collection = {
      name: newName
    };
    $.post("/api/collections", {
      json: JSON.stringify(collection)
    }, function (data) {
      if ("error" in data) {
        alert(data.error);
        return;
      }
      setNewName("");
      var newCollections = [data.collection].concat(CollectionsWidget_toConsumableArray(collections));
      sefaria._userCollections[sefaria._uid] = newCollections;
      setCollections(newCollections);
      onCheckChange(data.collection, true);
      handleCollectionsChange && handleCollectionsChange();
    });
  };
  var onClose = function onClose() {
    if (changed && handleCollectionsChange) {
      handleCollectionsChange();
    }
    close();
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "collectionsWidget"
  }, /*#__PURE__*/React.createElement("div", {
    className: "collectionsWidgetTop"
  }, /*#__PURE__*/React.createElement("span", {
    className: "collectionsWidgetTitle"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "Collections")), /*#__PURE__*/React.createElement("div", {
    className: "collectionsWidgetClose",
    onClick: onClose
  }, "\xD7")), /*#__PURE__*/React.createElement("div", {
    className: "collectionsWidgetList serif"
  }, !dataLoaded ? null : collections.map(function (collection, i) {
    return /*#__PURE__*/React.createElement("label", {
      className: "checkmarkLabel",
      key: i + collection.name
    }, /*#__PURE__*/React.createElement("input", {
      type: "checkbox",
      onChange: function onChange(event) {
        return onCheckChange(collection, event.target.checked);
      },
      checked: collectionsSelected.filter(function (x) {
        return x.slug === collection.slug;
      }).length ? "checked" : ""
    }), /*#__PURE__*/React.createElement("span", {
      className: "checkmark"
    }), collection.name);
  }), dataLoaded && collections.length == 0 ? /*#__PURE__*/React.createElement("span", {
    className: "emptyMessage"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "You can use collections to organize your sheets or public sheets you like. Collections can shared privately or made public on Sefaria.")) : null), /*#__PURE__*/React.createElement("div", {
    className: "collectionsWidgetCreate"
  }, /*#__PURE__*/React.createElement("span", {
    className: "collectionsWidgetPlus"
  }, "+"), /*#__PURE__*/React.createElement("div", {
    className: "collectionsWidgetCreateInputBox"
  }, /*#__PURE__*/React.createElement("input", {
    className: "collectionsWidgetCreateInput",
    placeholder: sefaria._("Create new collection"),
    value: newName,
    onChange: onNameChange
  })), newName.length ? /*#__PURE__*/React.createElement("div", {
    className: "button extraSmall white collectionsWidgetCreateButton",
    onClick: onCreateClick
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "Create")) : null), /*#__PURE__*/React.createElement("div", {
    className: "collectionsWidgetDone"
  }, /*#__PURE__*/React.createElement("div", {
    className: "button large fillWidth",
    onClick: onClose
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "Done"))));
};

;// CONCATENATED MODULE: ../static/js/Hooks.jsx
function Hooks_toConsumableArray(arr) { return Hooks_arrayWithoutHoles(arr) || Hooks_iterableToArray(arr) || Hooks_unsupportedIterableToArray(arr) || Hooks_nonIterableSpread(); }
function Hooks_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function Hooks_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function Hooks_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return Hooks_arrayLikeToArray(arr); }
function Hooks_slicedToArray(arr, i) { return Hooks_arrayWithHoles(arr) || Hooks_iterableToArrayLimit(arr, i) || Hooks_unsupportedIterableToArray(arr, i) || Hooks_nonIterableRest(); }
function Hooks_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function Hooks_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return Hooks_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return Hooks_arrayLikeToArray(o, minLen); }
function Hooks_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function Hooks_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function Hooks_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }




function useContentLang(defaultToInterfaceOnBilingual, overrideLanguage) {
  /* useful for determining language for content text while taking into account ContentLanguageContent and interfaceLang
  * `overrideLanguage` a string with the language name (full not 2 letter) to force to render to overriding what the content language context says. Can be useful if calling object determines one langugae is missing in a dynamic way
  * `defaultToInterfaceOnBilingual` use if you want components not to render all languages in bilingual mode, and default them to what the interface language is*/
  var contentLanguage = (0,external_react_.useContext)(ContentLanguageContext);
  var languageToFilter = defaultToInterfaceOnBilingual && contentLanguage.language === "bilingual" ? sefaria.interfaceLang : overrideLanguage ? overrideLanguage : contentLanguage.language;
  var langShort = languageToFilter.slice(0, 2);
  return [languageToFilter, langShort];
}

//From https://usehooks.com/useDebounce/
function useDebounce(value, delay) {
  // State and setters for debounced value
  var _useState = (0,external_react_.useState)(value),
    _useState2 = Hooks_slicedToArray(_useState, 2),
    debouncedValue = _useState2[0],
    setDebouncedValue = _useState2[1];
  (0,external_react_.useEffect)(function () {
    // Update debounced value after delay
    var handler = setTimeout(function () {
      setDebouncedValue(value);
    }, delay);

    // Cancel the timeout if value changes (also on delay change or unmount)
    // This is how we prevent debounced value from updating if value is changed ...
    // .. within the delay period. Timeout gets cleared and restarted.
    return function () {
      clearTimeout(handler);
    };
  }, [value, delay] // Only re-call effect if value or delay changes
  );

  return debouncedValue;
}
function useScrollToLoad(_ref) {
  var scrollableRef = _ref.scrollableRef,
    url = _ref.url,
    setter = _ref.setter,
    _ref$itemsPreLoaded = _ref.itemsPreLoaded,
    itemsPreLoaded = _ref$itemsPreLoaded === void 0 ? 0 : _ref$itemsPreLoaded,
    _ref$pageSize = _ref.pageSize,
    pageSize = _ref$pageSize === void 0 ? 20 : _ref$pageSize;
  // Loads data from `url` and calls `setter` on the resulting data when `scrollableRef` scrolls
  // close to its bottom. 
  // API endpoint must return an array of results and support params `skip` and `limit`.
  // `itemsPreLoaded` counts the number of items already loaded, e.g. when some data was already available
  // in the JS cache.  If `itemsPreLoaded` > 0, no initial API is made
  // call will be made until scroll occurs, otherwise the size page is requeste immediately.
  var _useState3 = (0,external_react_.useState)(itemsPreLoaded),
    _useState4 = Hooks_slicedToArray(_useState3, 2),
    skip = _useState4[0],
    setSkip = _useState4[1];
  var _useState5 = (0,external_react_.useState)(false),
    _useState6 = Hooks_slicedToArray(_useState5, 2),
    loading = _useState6[0],
    setLoading = _useState6[1];
  var _useState7 = (0,external_react_.useState)(false),
    _useState8 = Hooks_slicedToArray(_useState7, 2),
    loadedToEnd = _useState8[0],
    setLoadedToEnd = _useState8[1];
  var isFirstRender = (0,external_react_.useRef)(true);

  // Set a scroll handler that will update the value of `skip`.
  (0,external_react_.useEffect)(function () {
    var $scrollable = sefariaJquery(scrollableRef.current);
    var margin = 600;
    var handleScroll = function handleScroll() {
      if (loadedToEnd || loading) {
        return;
      }
      if ($scrollable.scrollTop() + $scrollable.innerHeight() + margin >= $scrollable[0].scrollHeight) {
        setSkip(skip + pageSize);
      }
    };
    $scrollable.on("scroll", handleScroll);
    return function () {
      $scrollable.off("scroll", handleScroll);
    };
  }, [scrollableRef.current, loadedToEnd, skip, loading]);

  // Load and set data whenever `skip` changes.
  (0,external_react_.useEffect)(function () {
    if (isFirstRender.current && itemsPreLoaded > 10) {
      return;
    }
    setLoading(true);
    var nextUrl = url + (url.indexOf("?") === -1 ? "?" : "&") + "skip=" + skip + "&limit=" + pageSize;
    sefariaJquery.getJSON(nextUrl, function (data) {
      setter(data);
      if (data.length < pageSize) {
        setLoadedToEnd(true);
      }
      setLoading(false);
    });
  }, [skip]);
  (0,external_react_.useEffect)(function () {
    if (isFirstRender.current) {
      isFirstRender.current = false;
    }
  }, []);
}
function usePaginatedScroll(scrollable_element_ref, url, setter) {
  var pagesPreLoaded = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
  // Fetches and sets data from `url` when user scrolls to the
  // bottom of `scollable_element_ref`

  var _useState9 = (0,external_react_.useState)(pagesPreLoaded > 0 ? pagesPreLoaded - 1 : 0),
    _useState10 = Hooks_slicedToArray(_useState9, 2),
    page = _useState10[0],
    setPage = _useState10[1];
  var _useState11 = (0,external_react_.useState)(pagesPreLoaded > 0 ? pagesPreLoaded : 1),
    _useState12 = Hooks_slicedToArray(_useState11, 2),
    nextPage = _useState12[0],
    setNextPage = _useState12[1];
  var _useState13 = (0,external_react_.useState)(false),
    _useState14 = Hooks_slicedToArray(_useState13, 2),
    loadedToEnd = _useState14[0],
    setLoadedToEnd = _useState14[1];
  var isFirstRender = (0,external_react_.useRef)(true);
  (0,external_react_.useEffect)(function () {
    var scrollable_element = sefariaJquery(scrollable_element_ref.current);
    var margin = 600;
    var handleScroll = function handleScroll() {
      if (loadedToEnd || page === nextPage) {
        return;
      }
      if (scrollable_element.scrollTop() + scrollable_element.innerHeight() + margin >= scrollable_element[0].scrollHeight) {
        setPage(nextPage);
      }
    };
    scrollable_element.on("scroll", handleScroll);
    return function () {
      scrollable_element.off("scroll", handleScroll);
    };
  }, [scrollable_element_ref.current, loadedToEnd, page, nextPage]);
  (0,external_react_.useEffect)(function () {
    if (pagesPreLoaded > 0 && isFirstRender.current) {
      return;
    }
    var paged_url = url + "&page=" + page;
    sefariaJquery.getJSON(paged_url, function (data) {
      setter(data);
      if (data.count < data.page_size) {
        setLoadedToEnd(true);
      } else {
        setNextPage(page + 1);
      }
    });
  }, [page]);
  (0,external_react_.useEffect)(function () {
    if (isFirstRender.current) {
      isFirstRender.current = false;
    }
  }, []);
}
function usePaginatedDisplay(scrollable_element_ref, input, pageSize, bottomMargin, initialRenderSize) {
  /*
  Listens until user is scrolled within `bottomMargin` of `scrollable_element_ref`
  when this happens, show `pageSize` more elements from `input`.
  On initial run, return `initialRenderSize` items if greater than `pageSize`.
  */
  initialRenderSize = Math.max(initialRenderSize, pageSize);
  bottomMargin = bottomMargin || 800;
  var _useState15 = (0,external_react_.useState)(parseInt(initialRenderSize / pageSize) - 1),
    _useState16 = Hooks_slicedToArray(_useState15, 2),
    page = _useState16[0],
    setPage = _useState16[1];
  var _useState17 = (0,external_react_.useState)(false),
    _useState18 = Hooks_slicedToArray(_useState17, 2),
    loadedToEnd = _useState18[0],
    setLoadedToEnd = _useState18[1];
  var _useState19 = (0,external_react_.useState)(input.slice(0, initialRenderSize)),
    _useState20 = Hooks_slicedToArray(_useState19, 2),
    inputUpToPage = _useState20[0],
    setInputUpToPage = _useState20[1];
  (0,external_react_.useEffect)(function () {
    return function () {
      setInputUpToPage(function (prev) {
        // use `setInputUpToPage` to get access to previous value
        // input changes because of useIncrementalLoad even though inputUpToPage may not change
        // as long as inputUpToPage is the same element by element, dont reset page to 0
        if (!inputUpToPage && !!prev) {
          setPage(0);
        } else if (!inputUpToPage.elementsAreEqual(prev)) {
          setPage(0);
        }
        return prev;
      });
      setLoadedToEnd(false);
    };
  }, [scrollable_element_ref && scrollable_element_ref.current, input]);
  var numPages = (0,external_react_.useMemo)(function () {
    return Math.ceil(input.length / pageSize);
  }, [input, pageSize]);
  (0,external_react_.useEffect)(function () {
    if (!scrollable_element_ref) {
      return;
    }
    var scrollable_element = sefariaJquery(scrollable_element_ref.current);
    var handleScroll = function handleScroll() {
      if (loadedToEnd) {
        return;
      }
      if (scrollable_element.scrollTop() + scrollable_element.innerHeight() + bottomMargin >= scrollable_element[0].scrollHeight) {
        setPage(function (prevPage) {
          return prevPage + 1;
        });
      }
    };
    scrollable_element.on("scroll", handleScroll);
    return function () {
      scrollable_element.off("scroll", handleScroll);
    };
  }, [scrollable_element_ref && scrollable_element_ref.current, loadedToEnd]);
  (0,external_react_.useEffect)(function () {
    setInputUpToPage(function (prev) {
      // decide whether or not inputUpToPage has changed. if it's the same element-by-element to `prev`, return `prev`
      var next = input.slice(0, pageSize * (page + 1));
      if (!next.elementsAreEqual(prev)) {
        return next;
      }
      return prev;
    });
  }, [page, input, pageSize]);
  (0,external_react_.useEffect)(function () {
    if (page >= numPages) {
      setLoadedToEnd(true);
    }
  }, [page, numPages]);
  return inputUpToPage;
}
function useIncrementalLoad(fetchData, input, pageSize, setter, identityElement) {
  var resetValue = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;
  /*
  Loads all items in `input` in `pageSize` chunks.
  Each input chunk is passed to `fetchData`
  fetchData: (data) => Promise(). Takes subarray from `input` and returns promise.
  input: array of input data for `fetchData`
  pageSize: int, chunk size
  setter: (data) => null. Sets paginated data on component.  setter(false) clears data.
  identityElement: a string identifying a invocation of this effect.  When it changes, pagination and processing will restart.  Old calls in processes will be dropped on landing.
  resetValue: value to pass to `setter` to indicate that it should forget previous values and reset.
  */

  // When input changes, creates function to fetch data by page, computes number of pages
  var _useMemo = (0,external_react_.useMemo)(function () {
      var fetchDataByPage = function fetchDataByPage(page) {
        if (!input) {
          return Promise.reject({
            error: "input not array",
            input: input
          });
        }
        var pagedInput = input.slice(page * pageSize, (page + 1) * pageSize);
        return fetchData(pagedInput);
      };
      var numPages = Math.ceil(input.length / pageSize);
      return [fetchDataByPage, numPages];
    }, [input]),
    _useMemo2 = Hooks_slicedToArray(_useMemo, 2),
    fetchDataByPage = _useMemo2[0],
    numPages = _useMemo2[1];
  usePaginatedLoad(fetchDataByPage, setter, identityElement, numPages, resetValue);
}
function usePaginatedLoad(fetchDataByPage, setter, identityElement, numPages) {
  var resetValue = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;
  /*
  See `useIncrementalLoad` docs
  */

  var _useState21 = (0,external_react_.useState)(0),
    _useState22 = Hooks_slicedToArray(_useState21, 2),
    page = _useState22[0],
    setPage = _useState22[1];
  var _useState23 = (0,external_react_.useState)({}),
    _useState24 = Hooks_slicedToArray(_useState23, 2),
    isCanceled = _useState24[0],
    setCanceled = _useState24[1]; // dict {idElem: Bool}
  var _useState25 = (0,external_react_.useState)(null),
    _useState26 = Hooks_slicedToArray(_useState25, 2),
    valueQueue = _useState26[0],
    setValueQueue = _useState26[1];

  // When identityElement changes:
  // Set current identityElement to not canceled
  // Sets previous identityElement to canceled.
  //    Removes old items by calling setter(false);
  //    Resets page to 0
  (0,external_react_.useEffect)(function () {
    setCanceled(function (d) {
      d[identityElement] = false;
      return Object.assign({}, d);
    });
    return function () {
      setCanceled(function (d) {
        d[identityElement] = true;
        return Object.assign({}, d);
      });
      setter(resetValue);
      setPage(0);
    };
  }, [identityElement]);
  var fetchPage = (0,external_react_.useCallback)(function () {
    return fetchDataByPage(page);
  }, [page, fetchDataByPage]);

  // make sure value setting callback and page procession get short circuited when id_elem has been canceled
  // clear value queue on success
  var setResult = (0,external_react_.useCallback)(function (id_elem, val) {
    if (isCanceled[id_elem]) {
      setValueQueue(null);
      return;
    }
    setter(val);
    setValueQueue(null);
    if (page === numPages - 1 || numPages === 0) {
      return;
    }
    setPage(function (prevPage) {
      return prevPage + 1;
    });
  }, [isCanceled, setter, numPages, page, identityElement]);

  // Make sure that current value is processed with latest setResult function
  // if this is called from within the fetchPage effect, it will have stale canceled data
  (0,external_react_.useEffect)(function () {
    if (valueQueue) {
      setResult.apply(void 0, Hooks_toConsumableArray(valueQueue));
    }
  }, [valueQueue, setResult]);

  // Put value returned and originating identity element into value queue
  (0,external_react_.useEffect)(function () {
    fetchPage().then(function (val, err) {
      return setValueQueue([identityElement, val]);
    });
  }, [fetchPage]);
}

;// CONCATENATED MODULE: external "react-image-crop"
const external_react_image_crop_namespaceObject = require("react-image-crop");
var external_react_image_crop_default = /*#__PURE__*/__webpack_require__.n(external_react_image_crop_namespaceObject);
;// CONCATENATED MODULE: external "react-image-crop/dist/ReactCrop.css"
const ReactCrop_css_namespaceObject = require("react-image-crop/dist/ReactCrop.css");
;// CONCATENATED MODULE: ../static/js/ContentText.jsx
function ContentText_slicedToArray(arr, i) { return ContentText_arrayWithHoles(arr) || ContentText_iterableToArrayLimit(arr, i) || ContentText_unsupportedIterableToArray(arr, i) || ContentText_nonIterableRest(); }
function ContentText_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function ContentText_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return ContentText_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return ContentText_arrayLikeToArray(o, minLen); }
function ContentText_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function ContentText_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function ContentText_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }



var ContentText = function ContentText(props) {
  /* Renders content language throughout the site (content that comes from the database and is not interface language).
  * Gets the active content language from Context and returns only the appropriate child(ren) for given language
  * text {{text: object}} a dictionary {en: "some text", he: "some translated text"} to use for each language
  * markdown {{markdown: object}} a dictionary {en: "some text", he: "some translated text"} to use for each language in the case where text contains markdown
  * html {{html: object}} a dictionary {en: "some html", he: "some translated html"} to use for each language in the case where it needs to be dangerously set html
  * overrideLanguage a string with the language name (full not 2 letter) to force to render to overriding what the content language context says. Can be useful if calling object determines one langugae is missing in a dynamic way
  * defaultToInterfaceOnBilingual use if you want components not to render all languages in bilingual mode, and default them to what the interface language is
  * bilingualOrder is an array of short language notations (e.g. ["he", "en"]) meant to tell the component what
  * order to return the bilingual langauage elements in (as opposed to the unguaranteed order by default).
  */
  var langAndContentItems = _filterContentTextByLang(props);
  return langAndContentItems.map(function (item) {
    return /*#__PURE__*/external_react_default().createElement(ContentSpan, {
      lang: item[0],
      content: item[1],
      isHTML: !!props.html
    });
  });
};
var VersionContent = function VersionContent(props) {
  /* Used to render content of Versions.
  * imageLoadCallback is called to update segment numbers placement
  * overrideLanguage a string with the language name (full not 2 letter) to force to render to overriding what the content language context says. Can be useful if calling object determines one langugae is missing in a dynamic way
  * defaultToInterfaceOnBilingual use if you want components not to render all languages in bilingual mode, and default them to what the interface language is
  * See filterContentTextByLang for more documentation */
  var langAndContentItems = _filterContentTextByLang(props);
  var _useContentLang = useContentLang(props.defaultToInterfaceOnBilingual, props.overrideLanguage),
    _useContentLang2 = ContentText_slicedToArray(_useContentLang, 2),
    languageToFilter = _useContentLang2[0],
    _ = _useContentLang2[1];
  return langAndContentItems.map(function (item) {
    var _item = ContentText_slicedToArray(item, 2),
      lang = _item[0],
      content = _item[1];
    if (sefaria.isFullSegmentImage(content)) {
      return /*#__PURE__*/external_react_default().createElement(VersionImageSpan, {
        lang: lang,
        content: content,
        languageToFilter: languageToFilter,
        imageLoadCallback: props.imageLoadCallback
      });
    }
    return /*#__PURE__*/external_react_default().createElement(ContentSpan, {
      lang: lang,
      content: content,
      isHTML: true
    });
  });
};
var VersionImageSpan = function VersionImageSpan(_ref) {
  var lang = _ref.lang,
    content = _ref.content,
    languageToFilter = _ref.languageToFilter,
    imageLoadCallback = _ref.imageLoadCallback;
  function getImageAttribute(imgTag, attribute) {
    var parser = new DOMParser();
    var doc = parser.parseFromString(imgTag, 'text/html');
    var imgElement = doc.querySelector('img');
    if (imgElement) {
      return imgElement.getAttribute(attribute);
    }
    return null;
  }
  var altText = getImageAttribute(content, 'alt');
  var srcText = getImageAttribute(content, 'src');
  content = /*#__PURE__*/external_react_default().createElement("div", {
    className: "image-in-text"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    onLoad: imageLoadCallback,
    src: srcText,
    alt: altText
  }), /*#__PURE__*/external_react_default().createElement("p", {
    className: "image-in-text-title"
  }, altText));
  if (lang === 'he' && languageToFilter === "bilingual") {
    content = '';
  }
  return /*#__PURE__*/external_react_default().createElement("span", {
    className: "contentSpan ".concat(lang),
    lang: lang,
    key: lang
  }, content);
};
var _filterContentTextByLang = function _filterContentTextByLang(_ref2) {
  var text = _ref2.text,
    html = _ref2.html,
    markdown = _ref2.markdown,
    overrideLanguage = _ref2.overrideLanguage,
    _ref2$defaultToInterf = _ref2.defaultToInterfaceOnBilingual,
    defaultToInterfaceOnBilingual = _ref2$defaultToInterf === void 0 ? false : _ref2$defaultToInterf,
    _ref2$bilingualOrder = _ref2.bilingualOrder,
    bilingualOrder = _ref2$bilingualOrder === void 0 ? null : _ref2$bilingualOrder;
  /**
   See ContentText for documentation
   */
  var contentVariable = html || markdown || text; // assumption is `markdown` or `html` are preferred over `text` if they are present
  var _useContentLang3 = useContentLang(defaultToInterfaceOnBilingual, overrideLanguage),
    _useContentLang4 = ContentText_slicedToArray(_useContentLang3, 2),
    languageToFilter = _useContentLang4[0],
    langShort = _useContentLang4[1];
  var langAndContentItems = Object.entries(contentVariable);
  if (languageToFilter === "bilingual") {
    if (bilingualOrder !== null) {
      //nifty function that sorts one array according to the order of a second array.
      langAndContentItems.sort(function (a, b) {
        return bilingualOrder.indexOf(a[0]) - bilingualOrder.indexOf(b[0]);
      });
    }
  } else {
    langAndContentItems = langAndContentItems.filter(function (_ref3) {
      var _ref4 = ContentText_slicedToArray(_ref3, 2),
        lang = _ref4[0],
        _ = _ref4[1];
      return lang === langShort;
    });
  }
  return langAndContentItems;
};
var ContentSpan = function ContentSpan(_ref5) {
  var lang = _ref5.lang,
    content = _ref5.content,
    isHTML = _ref5.isHTML;
  return isHTML ? /*#__PURE__*/external_react_default().createElement("span", {
    className: "contentSpan ".concat(lang),
    lang: lang,
    key: lang,
    dangerouslySetInnerHTML: {
      __html: content
    }
  }) : /*#__PURE__*/external_react_default().createElement("span", {
    className: "contentSpan ".concat(lang),
    lang: lang,
    key: lang
  }, content);
};

;// CONCATENATED MODULE: external "react-tag-autocomplete"
const external_react_tag_autocomplete_namespaceObject = require("react-tag-autocomplete");
var external_react_tag_autocomplete_default = /*#__PURE__*/__webpack_require__.n(external_react_tag_autocomplete_namespaceObject);
;// CONCATENATED MODULE: ../static/js/AdminEditor.jsx
function AdminEditor_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = AdminEditor_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function AdminEditor_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function AdminEditor_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? AdminEditor_ownKeys(Object(source), !0).forEach(function (key) { AdminEditor_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : AdminEditor_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function AdminEditor_defineProperty(obj, key, value) { key = AdminEditor_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function AdminEditor_toPropertyKey(arg) { var key = AdminEditor_toPrimitive(arg, "string"); return AdminEditor_typeof(key) === "symbol" ? key : String(key); }
function AdminEditor_toPrimitive(input, hint) { if (AdminEditor_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (AdminEditor_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function AdminEditor_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ AdminEditor_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == AdminEditor_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function AdminEditor_typeof(obj) { "@babel/helpers - typeof"; return AdminEditor_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, AdminEditor_typeof(obj); }
function AdminEditor_toConsumableArray(arr) { return AdminEditor_arrayWithoutHoles(arr) || AdminEditor_iterableToArray(arr) || AdminEditor_unsupportedIterableToArray(arr) || AdminEditor_nonIterableSpread(); }
function AdminEditor_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function AdminEditor_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function AdminEditor_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return AdminEditor_arrayLikeToArray(arr); }
function AdminEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function AdminEditor_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { AdminEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { AdminEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function AdminEditor_slicedToArray(arr, i) { return AdminEditor_arrayWithHoles(arr) || AdminEditor_iterableToArrayLimit(arr, i) || AdminEditor_unsupportedIterableToArray(arr, i) || AdminEditor_nonIterableRest(); }
function AdminEditor_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function AdminEditor_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return AdminEditor_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return AdminEditor_arrayLikeToArray(o, minLen); }
function AdminEditor_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function AdminEditor_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function AdminEditor_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }





var AdminEditorButton = function AdminEditorButton(_ref) {
  var toggleAddingTopics = _ref.toggleAddingTopics,
    text = _ref.text,
    _ref$top = _ref.top,
    top = _ref$top === void 0 ? false : _ref$top,
    _ref$bottom = _ref.bottom,
    bottom = _ref$bottom === void 0 ? false : _ref$bottom;
  var classes = external_classnames_default()({
    button: 1,
    extraSmall: 1,
    topic: 1,
    top: top,
    bottom: bottom
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    onClick: toggleAddingTopics,
    id: "editTopic",
    className: classes,
    role: "button"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, text));
};
function useEditToggle() {
  var _useState = (0,external_react_.useState)(false),
    _useState2 = AdminEditor_slicedToArray(_useState, 2),
    editingBool = _useState2[0],
    toggleEditingBool = _useState2[1];
  var toggleAddingTopics = function toggleAddingTopics(e) {
    if (e.currentTarget.id === "editTopic") {
      toggleEditingBool(true);
    } else if (e.currentTarget.id === "cancel") {
      toggleEditingBool(false);
    }
  };
  return [editingBool, toggleAddingTopics];
}
var validateMarkdownLinks = /*#__PURE__*/function () {
  var _ref2 = AdminEditor_asyncToGenerator( /*#__PURE__*/AdminEditor_regeneratorRuntime().mark(function _callee(input) {
    var regexp, matches, matches_without_duplicates, _loop, _i2, _matches_without_dupl, _ret;
    return AdminEditor_regeneratorRuntime().wrap(function _callee$(_context2) {
      while (1) switch (_context2.prev = _context2.next) {
        case 0:
          regexp = /\[.*?\]\((.*?)\)/g;
          matches = AdminEditor_toConsumableArray(input.matchAll(regexp));
          matches_without_duplicates = Array.from(new Set(matches));
          _loop = /*#__PURE__*/AdminEditor_regeneratorRuntime().mark(function _loop() {
            var match, url, name, namesFound, d, validLink;
            return AdminEditor_regeneratorRuntime().wrap(function _loop$(_context) {
              while (1) switch (_context.prev = _context.next) {
                case 0:
                  match = _matches_without_dupl[_i2];
                  url = match[1];
                  name = url.split("/").slice(-1)[0];
                  namesFound = [];
                  d = [];
                  if (!url.startsWith("/topics")) {
                    _context.next = 11;
                    break;
                  }
                  _context.next = 8;
                  return sefaria.getTopicCompletions(name, function (x) {
                    return x[1];
                  });
                case 8:
                  d = _context.sent;
                  _context.next = 17;
                  break;
                case 11:
                  _context.next = 13;
                  return sefaria.getName(name, false);
                case 13:
                  d = _context.sent;
                  if (!d.is_ref) {
                    _context.next = 16;
                    break;
                  }
                  return _context.abrupt("return", "continue");
                case 16:
                  d = d.completion_objects;
                case 17:
                  d.forEach(function (x) {
                    Array.isArray(x.key) ? x.key.forEach(function (y) {
                      return namesFound.push(y);
                    }) // the key is an array when getName returns a TocCategory
                    : namesFound.push(x.key);
                  });
                  validLink = namesFound.includes(name) > 0 ? true : confirm("".concat(name, " not found in Sefaria database.  Please confirm that you meant to write '").concat(url, "' in the description."));
                  if (validLink) {
                    _context.next = 21;
                    break;
                  }
                  return _context.abrupt("return", {
                    v: false
                  });
                case 21:
                case "end":
                  return _context.stop();
              }
            }, _loop);
          });
          _i2 = 0, _matches_without_dupl = matches_without_duplicates;
        case 5:
          if (!(_i2 < _matches_without_dupl.length)) {
            _context2.next = 15;
            break;
          }
          return _context2.delegateYield(_loop(), "t0", 7);
        case 7:
          _ret = _context2.t0;
          if (!(_ret === "continue")) {
            _context2.next = 10;
            break;
          }
          return _context2.abrupt("continue", 12);
        case 10:
          if (!(AdminEditor_typeof(_ret) === "object")) {
            _context2.next = 12;
            break;
          }
          return _context2.abrupt("return", _ret.v);
        case 12:
          _i2++;
          _context2.next = 5;
          break;
        case 15:
          return _context2.abrupt("return", true);
        case 16:
        case "end":
          return _context2.stop();
      }
    }, _callee);
  }));
  return function validateMarkdownLinks(_x2) {
    return _ref2.apply(this, arguments);
  };
}();
var AdminEditor = function AdminEditor(_ref3) {
  var title = _ref3.title,
    data = _ref3.data,
    close = _ref3.close,
    catMenu = _ref3.catMenu,
    updateData = _ref3.updateData,
    savingStatus = _ref3.savingStatus,
    validate = _ref3.validate,
    deleteObj = _ref3.deleteObj,
    _ref3$items = _ref3.items,
    items = _ref3$items === void 0 ? [] : _ref3$items,
    _ref3$isNew = _ref3.isNew,
    isNew = _ref3$isNew === void 0 ? true : _ref3$isNew,
    _ref3$extras = _ref3.extras,
    extras = _ref3$extras === void 0 ? [] : _ref3$extras,
    _ref3$path = _ref3.path,
    path = _ref3$path === void 0 ? [] : _ref3$path;
  var _useState3 = (0,external_react_.useState)(false),
    _useState4 = AdminEditor_slicedToArray(_useState3, 2),
    validatingLinks = _useState4[0],
    setValidatingLinks = _useState4[1];
  var setInputValue = function setInputValue(e) {
    if (data.hasOwnProperty(e.target.id)) {
      data[e.target.id] = external_sanitize_html_default()(e.target.value, {
        allowedTags: [],
        disallowedTagsMode: 'discard'
      });
    }
    updateData(AdminEditor_objectSpread({}, data));
  };
  var preprocess = /*#__PURE__*/function () {
    var _ref4 = AdminEditor_asyncToGenerator( /*#__PURE__*/AdminEditor_regeneratorRuntime().mark(function _callee2() {
      var _iterator, _step, _options_for_form$x, x, field, valid_tags;
      return AdminEditor_regeneratorRuntime().wrap(function _callee2$(_context3) {
        while (1) switch (_context3.prev = _context3.next) {
          case 0:
            setValidatingLinks(true);
            _iterator = AdminEditor_createForOfIteratorHelper(items);
            _context3.prev = 2;
            _iterator.s();
          case 4:
            if ((_step = _iterator.n()).done) {
              _context3.next = 16;
              break;
            }
            x = _step.value;
            if (!((_options_for_form$x = options_for_form[x]) !== null && _options_for_form$x !== void 0 && _options_for_form$x.is_textarea)) {
              _context3.next = 14;
              break;
            }
            field = options_for_form[x].field;
            _context3.next = 10;
            return validateMarkdownLinks(data[field]);
          case 10:
            valid_tags = _context3.sent;
            if (valid_tags) {
              _context3.next = 14;
              break;
            }
            setValidatingLinks(false);
            return _context3.abrupt("return", false);
          case 14:
            _context3.next = 4;
            break;
          case 16:
            _context3.next = 21;
            break;
          case 18:
            _context3.prev = 18;
            _context3.t0 = _context3["catch"](2);
            _iterator.e(_context3.t0);
          case 21:
            _context3.prev = 21;
            _iterator.f();
            return _context3.finish(21);
          case 24:
            validate();
            setValidatingLinks(false);
          case 26:
          case "end":
            return _context3.stop();
        }
      }, _callee2, null, [[2, 18, 21, 24]]);
    }));
    return function preprocess() {
      return _ref4.apply(this, arguments);
    };
  }();
  var item = function item(_ref5) {
    var label = _ref5.label,
      field = _ref5.field,
      placeholder = _ref5.placeholder,
      is_textarea = _ref5.is_textarea;
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "section"
    }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, label)), is_textarea ?
    /*#__PURE__*/
    // <MDEditor textareaProps={{id: field, placeholder: Sefaria._(placeholder)}}
    //      commands={[commands.bold, commands.italic, commands.link]}
    //      value={data[field]} onChange={setTextareaValue}/>
    external_react_default().createElement("textarea", {
      className: "default",
      id: field,
      onBlur: setInputValue,
      defaultValue: data[field],
      placeholder: sefaria._(placeholder)
    }) : /*#__PURE__*/external_react_default().createElement("input", {
      type: "text",
      id: field,
      onBlur: setInputValue,
      defaultValue: data[field],
      placeholder: sefaria._(placeholder)
    }));
  };
  var options_for_form = {
    "Title": {
      label: "Title",
      field: "enTitle",
      placeholder: "Add a title."
    },
    "Hebrew Title": {
      label: "Hebrew Title",
      field: "heTitle",
      placeholder: "Add a title."
    },
    "English Description": {
      label: "English Description",
      field: "enDescription",
      placeholder: "Add a description.",
      is_textarea: true
    },
    "Hebrew Description": {
      label: "Hebrew Description",
      field: "heDescription",
      placeholder: "Add a description.",
      is_textarea: true
    },
    "Prompt": {
      label: "Prompt",
      field: "prompt",
      placeholder: "Add a prompt.",
      textarea: true
    },
    "English Short Description": {
      label: "English Short Description for Table of Contents",
      field: "enCategoryDescription",
      placeholder: "Add a short description.",
      is_textarea: false
    },
    "Hebrew Short Description": {
      label: "Hebrew Short Description for Table of Contents",
      field: "heCategoryDescription",
      placeholder: "Add a short description.",
      is_textarea: false
    }
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "editTextInfo"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "static"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "inner"
  }, (savingStatus || validatingLinks) && /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionsWidget"
  }, sefaria._("Saving...")), /*#__PURE__*/external_react_default().createElement("div", {
    id: "newIndex"
  }, /*#__PURE__*/external_react_default().createElement(AdminToolHeader, {
    title: title,
    close: close,
    validate: preprocess
  }), items.map(function (x) {
    if (x.includes("Hebrew") && !sefaria._siteSettings.TORAH_SPECIFIC) {
      return null;
    } else if (x === "Category Menu") {
      return catMenu;
    } else {
      return item(AdminEditor_objectSpread({}, options_for_form[x]));
    }
  }), extras, !isNew && /*#__PURE__*/external_react_default().createElement("div", {
    onClick: deleteObj,
    id: "deleteTopic",
    className: "button small deleteTopic",
    tabIndex: "0",
    role: "button"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Delete"))))));
};

;// CONCATENATED MODULE: ../static/js/CategoryEditor.jsx
function CategoryEditor_typeof(obj) { "@babel/helpers - typeof"; return CategoryEditor_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, CategoryEditor_typeof(obj); }
function CategoryEditor_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function CategoryEditor_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? CategoryEditor_ownKeys(Object(source), !0).forEach(function (key) { CategoryEditor_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : CategoryEditor_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function CategoryEditor_defineProperty(obj, key, value) { key = CategoryEditor_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function CategoryEditor_toPropertyKey(arg) { var key = CategoryEditor_toPrimitive(arg, "string"); return CategoryEditor_typeof(key) === "symbol" ? key : String(key); }
function CategoryEditor_toPrimitive(input, hint) { if (CategoryEditor_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (CategoryEditor_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function CategoryEditor_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ CategoryEditor_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == CategoryEditor_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function CategoryEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function CategoryEditor_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { CategoryEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { CategoryEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function CategoryEditor_slicedToArray(arr, i) { return CategoryEditor_arrayWithHoles(arr) || CategoryEditor_iterableToArrayLimit(arr, i) || CategoryEditor_unsupportedIterableToArray(arr, i) || CategoryEditor_nonIterableRest(); }
function CategoryEditor_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function CategoryEditor_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function CategoryEditor_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function CategoryEditor_toConsumableArray(arr) { return CategoryEditor_arrayWithoutHoles(arr) || CategoryEditor_iterableToArray(arr) || CategoryEditor_unsupportedIterableToArray(arr) || CategoryEditor_nonIterableSpread(); }
function CategoryEditor_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function CategoryEditor_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return CategoryEditor_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return CategoryEditor_arrayLikeToArray(o, minLen); }
function CategoryEditor_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function CategoryEditor_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return CategoryEditor_arrayLikeToArray(arr); }
function CategoryEditor_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }






var displayOptionForSources = function displayOptionForSources(child) {
  if (sefaria.interfaceLang === 'english') {
    var _child$descriptions, _child$descriptions2, _child$descriptions2$;
    return child !== null && child !== void 0 && (_child$descriptions = child.descriptions) !== null && _child$descriptions !== void 0 && _child$descriptions.en ? "".concat(child === null || child === void 0 ? void 0 : (_child$descriptions2 = child.descriptions) === null || _child$descriptions2 === void 0 ? void 0 : (_child$descriptions2$ = _child$descriptions2.en) === null || _child$descriptions2$ === void 0 ? void 0 : _child$descriptions2$.title, " - ").concat(child.ref) : child.ref;
  } else {
    var _child$descriptions3, _child$descriptions4, _child$descriptions4$;
    var refInCache = sefaria.getRefFromCache(child.ref);
    var displayRef = refInCache ? refInCache.heRef : child.ref;
    return child !== null && child !== void 0 && (_child$descriptions3 = child.descriptions) !== null && _child$descriptions3 !== void 0 && _child$descriptions3.he ? "".concat(child === null || child === void 0 ? void 0 : (_child$descriptions4 = child.descriptions) === null || _child$descriptions4 === void 0 ? void 0 : (_child$descriptions4$ = _child$descriptions4.he) === null || _child$descriptions4$ === void 0 ? void 0 : _child$descriptions4$.title, " - ").concat(displayRef) : displayRef;
  }
};
var displayOptions = {
  "cats": function cats(child) {
    return child.title || child.category;
  },
  "topics": function topics(child) {
    return child.en;
  },
  "sources": function sources(child) {
    return displayOptionForSources(child);
  }
};
var Reorder = function Reorder(_ref) {
  var subcategoriesAndBooks = _ref.subcategoriesAndBooks,
    updateOrder = _ref.updateOrder,
    displayType = _ref.displayType,
    _ref$updateParentChan = _ref.updateParentChangedStatus,
    updateParentChangedStatus = _ref$updateParentChan === void 0 ? null : _ref$updateParentChan;
  var clickHandler = function clickHandler(dir, child) {
    var index = subcategoriesAndBooks.indexOf(child);
    var index_to_swap = -1;
    if (dir === 'down' && index < subcategoriesAndBooks.length) {
      index_to_swap = index + 1;
    } else if (dir === 'up' && index > 0) {
      index_to_swap = index - 1;
    }
    if (index_to_swap >= 0) {
      var temp = subcategoriesAndBooks[index_to_swap];
      subcategoriesAndBooks[index_to_swap] = subcategoriesAndBooks[index];
      subcategoriesAndBooks[index] = temp;
      updateOrder(CategoryEditor_toConsumableArray(subcategoriesAndBooks));
      if (updateParentChangedStatus) {
        updateParentChangedStatus(true);
      }
    }
  };
  return subcategoriesAndBooks.map(function (child, i) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      id: "reorder-".concat(i),
      className: "reorderTool"
    }, /*#__PURE__*/external_react_default().createElement("div", {
      id: "title"
    }, displayOptions[displayType](child)), /*#__PURE__*/external_react_default().createElement("img", {
      src: "/static/img/arrow-up.png",
      id: "up",
      onClick: function onClick() {
        return clickHandler('up', child);
      }
    }), /*#__PURE__*/external_react_default().createElement("img", {
      src: "/static/img/arrow-down.png",
      id: "down",
      onClick: function onClick() {
        return clickHandler('down', child);
      }
    }));
  });
};
var ReorderEditor = function ReorderEditor(_ref2) {
  var close = _ref2.close,
    _ref2$type = _ref2.type,
    type = _ref2$type === void 0 ? "" : _ref2$type,
    _ref2$postURL = _ref2.postURL,
    postURL = _ref2$postURL === void 0 ? "" : _ref2$postURL,
    _ref2$redirect = _ref2.redirect,
    _redirect = _ref2$redirect === void 0 ? "" : _ref2$redirect,
    _ref2$origItems = _ref2.origItems,
    origItems = _ref2$origItems === void 0 ? [] : _ref2$origItems;
  /*
  Wrapper for Reorder that allows a full-screen view of `origItems` elements to be reordered.
  This is currently used when admin edits the root of the topic TOC or category TOC, as well
  as when an admin reorders sources.
   */
  var _useState = (0,external_react_.useState)(origItems),
    _useState2 = CategoryEditor_slicedToArray(_useState, 2),
    tocItems = _useState2[0],
    setTocItems = _useState2[1];
  var _useState3 = (0,external_react_.useState)(false),
    _useState4 = CategoryEditor_slicedToArray(_useState3, 2),
    savingStatus = _useState4[0],
    setSavingStatus = _useState4[1];
  var _useState5 = (0,external_react_.useState)(false),
    _useState6 = CategoryEditor_slicedToArray(_useState5, 2),
    isChanged = _useState6[0],
    setIsChanged = _useState6[1];
  var update = function update(newTocItems) {
    setTocItems(newTocItems);
    setIsChanged(true);
  };
  var _validate = function validate() {
    if (!isChanged) {
      alert("You haven't reordered the categories.");
    } else {
      save();
    }
  };
  var save = function save() {
    setSavingStatus(true);
    var postCategoryData = {};
    if (type === "cats") {
      // use displayOptions to map toc objects to titles of category/book
      postCategoryData = {
        subcategoriesAndBooks: tocItems.map(function (x) {
          return displayOptions["cats"](x);
        }),
        path: []
      };
    } else if (type === "topics") {
      postCategoryData = {
        topics: tocItems
      };
    } else if (type === 'sources') {
      postCategoryData = {
        sources: tocItems
      };
    }
    requestWithCallBack({
      url: postURL,
      data: postCategoryData,
      setSavingStatus: setSavingStatus,
      redirect: function redirect() {
        return window.location.href = _redirect;
      }
    });
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "editTextInfo"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "static"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "inner"
  }, savingStatus ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionsWidget"
  }, sefaria._("Saving...")) : null, /*#__PURE__*/external_react_default().createElement("div", {
    id: "newIndex"
  }, /*#__PURE__*/external_react_default().createElement(AdminToolHeader, {
    title: "Reorder Editor",
    close: close,
    validate: function validate() {
      return _validate();
    }
  }), /*#__PURE__*/external_react_default().createElement(Reorder, {
    subcategoriesAndBooks: tocItems,
    updateOrder: update,
    displayType: type
  })))));
};
var CategoryEditor = function CategoryEditor(_ref3) {
  var _origData$origDesc, _origData$origDesc2, _origData$origCategor, _origData$origCategor2;
  var _ref3$origData = _ref3.origData,
    origData = _ref3$origData === void 0 ? {} : _ref3$origData,
    close = _ref3.close,
    _ref3$origPath = _ref3.origPath,
    origPath = _ref3$origPath === void 0 ? [] : _ref3$origPath;
  var _useState7 = (0,external_react_.useState)(origPath),
    _useState8 = CategoryEditor_slicedToArray(_useState7, 2),
    path = _useState8[0],
    setPath = _useState8[1];
  var _useState9 = (0,external_react_.useState)({
      enTitle: origData.origEn,
      heTitle: origData.origHe || "",
      heDescription: (origData === null || origData === void 0 ? void 0 : (_origData$origDesc = origData.origDesc) === null || _origData$origDesc === void 0 ? void 0 : _origData$origDesc.he) || "",
      enDescription: (origData === null || origData === void 0 ? void 0 : (_origData$origDesc2 = origData.origDesc) === null || _origData$origDesc2 === void 0 ? void 0 : _origData$origDesc2.en) || "",
      enCategoryDescription: origData === null || origData === void 0 ? void 0 : (_origData$origCategor = origData.origCategoryDesc) === null || _origData$origCategor === void 0 ? void 0 : _origData$origCategor.en,
      heCategoryDescription: origData === null || origData === void 0 ? void 0 : (_origData$origCategor2 = origData.origCategoryDesc) === null || _origData$origCategor2 === void 0 ? void 0 : _origData$origCategor2.he
    }),
    _useState10 = CategoryEditor_slicedToArray(_useState9, 2),
    data = _useState10[0],
    setData = _useState10[1];
  var _useState11 = (0,external_react_.useState)((origData === null || origData === void 0 ? void 0 : origData.origEn) === ""),
    _useState12 = CategoryEditor_slicedToArray(_useState11, 2),
    isNew = _useState12[0],
    setIsNew = _useState12[1];
  var _useState13 = (0,external_react_.useState)(false),
    _useState14 = CategoryEditor_slicedToArray(_useState13, 2),
    changed = _useState14[0],
    setChanged = _useState14[1];
  var _useState15 = (0,external_react_.useState)(false),
    _useState16 = CategoryEditor_slicedToArray(_useState15, 2),
    savingStatus = _useState16[0],
    setSavingStatus = _useState16[1];
  var _useState17 = (0,external_react_.useState)(origData.isPrimary ? 'true' : 'false'),
    _useState18 = CategoryEditor_slicedToArray(_useState17, 2),
    isPrimary = _useState18[0],
    setIsPrimary = _useState18[1];
  var origSubcategoriesAndBooks = (0,external_react_.useRef)(sefaria.tocItemsByCategories([].concat(CategoryEditor_toConsumableArray(origPath), [origData.origEn])) || []);
  var _useState19 = (0,external_react_.useState)(CategoryEditor_toConsumableArray(origSubcategoriesAndBooks.current)),
    _useState20 = CategoryEditor_slicedToArray(_useState19, 2),
    subcategoriesAndBooks = _useState20[0],
    setSubcategoriesAndBooks = _useState20[1];
  var handlePrimaryClick = function handlePrimaryClick(type, status) {
    setIsPrimary(status);
    setChanged(true);
  };
  var populateCatMenu = function populateCatMenu(update) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "section"
    }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Parent Category")), /*#__PURE__*/external_react_default().createElement(CategoryChooser, {
      categories: path,
      update: update
    }));
  };
  var updateCatMenu = function updateCatMenu(newPath) {
    if (newPath !== path && !changed) {
      setChanged(true);
    }
    setPath(newPath);
  };
  var catMenu = populateCatMenu(updateCatMenu);
  var updateData = function updateData(newData) {
    setChanged(true);
    setData(newData);
  };
  var validate = /*#__PURE__*/function () {
    var _ref4 = CategoryEditor_asyncToGenerator( /*#__PURE__*/CategoryEditor_regeneratorRuntime().mark(function _callee() {
      return CategoryEditor_regeneratorRuntime().wrap(function _callee$(_context) {
        while (1) switch (_context.prev = _context.next) {
          case 0:
            if (changed) {
              _context.next = 3;
              break;
            }
            alert("Please change one of the fields before saving.");
            return _context.abrupt("return", false);
          case 3:
            if (!(data.enTitle.length === 0)) {
              _context.next = 6;
              break;
            }
            alert(sefaria._("Title must be provided."));
            return _context.abrupt("return", false);
          case 6:
            _context.next = 8;
            return save();
          case 8:
          case "end":
            return _context.stop();
        }
      }, _callee);
    }));
    return function validate() {
      return _ref4.apply(this, arguments);
    };
  }();
  var save = /*#__PURE__*/function () {
    var _ref5 = CategoryEditor_asyncToGenerator( /*#__PURE__*/CategoryEditor_regeneratorRuntime().mark(function _callee2() {
      var fullPath, origFullPath, postCategoryData, url, urlParams, origSubcategoryTitles, newSubcategoryTitles, reordered;
      return CategoryEditor_regeneratorRuntime().wrap(function _callee2$(_context2) {
        while (1) switch (_context2.prev = _context2.next) {
          case 0:
            setSavingStatus(true);
            fullPath = [].concat(CategoryEditor_toConsumableArray(path), [data.enTitle]);
            origFullPath = [].concat(CategoryEditor_toConsumableArray(origPath), [origData.origEn]);
            postCategoryData = {
              "isPrimary": isPrimary === 'true',
              "enDesc": data.enDescription,
              "heDesc": data.heDescription,
              "enShortDesc": data.enCategoryDescription,
              "heShortDesc": data.heCategoryDescription,
              "heSharedTitle": data.heTitle,
              "sharedTitle": data.enTitle,
              "path": fullPath
            };
            if (!sefaria._siteSettings.TORAH_SPECIFIC) {
              postCategoryData["heSharedTitle"] = data.enTitle.slice(0, -1); // there needs to be a hebrew title for the category's term
            }
            url = "/api/category/".concat(fullPath.join("/"));
            urlParams = [];
            if (!isNew) {
              urlParams.push("update=1");
              postCategoryData = CategoryEditor_objectSpread(CategoryEditor_objectSpread({}, postCategoryData), {}, {
                origPath: origFullPath
              });
            }
            origSubcategoryTitles = origSubcategoriesAndBooks.current.map(displayOptions["cats"]);
            newSubcategoryTitles = subcategoriesAndBooks.map(displayOptions["cats"]);
            reordered = origSubcategoryTitles.some(function (val, index) {
              return val !== newSubcategoryTitles[index];
            });
            if (reordered && !isNew) {
              // only reorder children when category isn't new
              postCategoryData["subcategoriesAndBooks"] = newSubcategoryTitles;
              urlParams.push("reorder=1");
            }
            if (urlParams.length > 0) {
              url += "?".concat(urlParams.join('&'));
            }
            requestWithCallBack({
              url: url,
              data: postCategoryData,
              setSavingStatus: setSavingStatus,
              redirect: function redirect() {
                return window.location.href = "/texts/" + fullPath;
              }
            });
          case 14:
          case "end":
            return _context2.stop();
        }
      }, _callee2);
    }));
    return function save() {
      return _ref5.apply(this, arguments);
    };
  }();
  var deleteObj = function deleteObj() {
    if (subcategoriesAndBooks.length > 0) {
      alert("Cannot delete a category with contents.");
      return;
    }
    var url = "/api/category/".concat(origPath.concat(origData.origEn).join("/"));
    requestWithCallBack({
      url: url,
      type: "DELETE",
      redirect: function redirect() {
        return window.location.href = "/texts";
      }
    });
  };
  var primaryOptions = [{
    name: "true",
    content: sefaria._("True"),
    role: "radio",
    ariaLabel: sefaria._("Set Primary Status to True")
  }, {
    name: "false",
    content: sefaria._("False"),
    role: "radio",
    ariaLabel: sefaria._("Set Primary Status to False")
  }];
  var items = ["Title", "Hebrew Title", "English Description", "Hebrew Description", "Category Menu", "English Short Description", "Hebrew Short Description"];
  return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(AdminEditor, {
    title: "Category Editor",
    close: close,
    catMenu: catMenu,
    data: data,
    savingStatus: savingStatus,
    validate: validate,
    deleteObj: deleteObj,
    updateData: updateData,
    isNew: isNew,
    items: items,
    path: path,
    extras: [isNew ? null : /*#__PURE__*/external_react_default().createElement(Reorder, {
      subcategoriesAndBooks: subcategoriesAndBooks,
      updateParentChangedStatus: setChanged,
      updateOrder: setSubcategoriesAndBooks,
      displayType: "cats"
    }), /*#__PURE__*/external_react_default().createElement("div", {
      className: "section"
    }, /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, sefaria._("Primary Status (If true, this category will display its contents on its own category page.)"))), /*#__PURE__*/external_react_default().createElement(ToggleSet, {
      blueStyle: true,
      ariaLabel: "Primary Status (If true, this category will display its contents on its own category page.)",
      label: "",
      name: "primary",
      separated: false,
      options: primaryOptions,
      setOption: handlePrimaryClick,
      currentValue: isPrimary
    }))]
  }));
};

;// CONCATENATED MODULE: ../static/js/Promotions.jsx
function Promotions_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = Promotions_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function Promotions_slicedToArray(arr, i) { return Promotions_arrayWithHoles(arr) || Promotions_iterableToArrayLimit(arr, i) || Promotions_unsupportedIterableToArray(arr, i) || Promotions_nonIterableRest(); }
function Promotions_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function Promotions_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return Promotions_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return Promotions_arrayLikeToArray(o, minLen); }
function Promotions_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function Promotions_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function Promotions_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }





var Promotions = function Promotions(_ref) {
  var adType = _ref.adType,
    rerender = _ref.rerender;
  var _useState = (0,external_react_.useState)(sefaria._inAppAds),
    _useState2 = Promotions_slicedToArray(_useState, 2),
    inAppAds = _useState2[0],
    setInAppAds = _useState2[1];
  var _useState3 = (0,external_react_.useState)(null),
    _useState4 = Promotions_slicedToArray(_useState3, 2),
    matchingAds = _useState4[0],
    setMatchingAds = _useState4[1];
  var _useState5 = (0,external_react_.useState)([]),
    _useState6 = Promotions_slicedToArray(_useState5, 2),
    prevMatchingAdIds = _useState6[0],
    setPrevMatchingAdIds = _useState6[1];
  var context = (0,external_react_.useContext)(AdContext);
  (0,external_react_.useEffect)(function () {
    google.charts.load("current");
    google.charts.setOnLoadCallback(getAds);
  }, []);
  (0,external_react_.useEffect)(function () {
    if (inAppAds) {
      setMatchingAds(getCurrentMatchingAds());
    }
  }, [context, inAppAds]);
  (0,external_react_.useEffect)(function () {
    if (!matchingAds) {
      return;
    }
    var matchingAdIds = matchingAds.map(function (x) {
      return x.campaignId;
    }).sort();
    var newIds = matchingAdIds.filter(function (value) {
      return !prevMatchingAdIds.includes(value);
    });
    if (newIds.length > 0) {
      var _iterator = Promotions_createForOfIteratorHelper(matchingAds),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var matchingAd = _step.value;
          if (newIds.includes(matchingAd.campaignId)) {
            gtag("event", "promo_viewed", {
              campaignID: matchingAd.campaignId,
              adType: matchingAd.adType
            });
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      setPrevMatchingAdIds(newIds);
    }
  }, [matchingAds]);
  function getAds() {
    var url = 'https://docs.google.com/spreadsheets/d/1UJw2Akyv3lbLqBoZaFVWhaAp-FUQ-YZfhprL_iNhhQc/edit#gid=0';
    var query = new google.visualization.Query(url);
    query.setQuery('select A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q');
    query.send(processSheetsData);
  }
  function showToUser(ad) {
    if (ad.trigger.showTo === "all") {
      return true;
    } else if (ad.trigger.showTo === "loggedIn" && context.isLoggedIn) {
      return true;
    } else if (ad.trigger.showTo === "loggedOut" && !context.isLoggedIn) {
      return true;
    } else {
      return false;
    }
  }
  function showGivenDebugMode(ad) {
    if (!ad.debug) {
      return true;
    } else if (context.isDebug == true) {
      return true;
    } else {
      return false;
    }
  }
  function getCurrentMatchingAds() {
    // TODO: refine matching algorithm to order by matchingness?
    return inAppAds.filter(function (ad) {
      return showToUser(ad) && showGivenDebugMode(ad) && ad.trigger.interfaceLang === context.interfaceLang && ad.adType === adType && context.dt > ad.trigger.dt_start && context.dt < ad.trigger.dt_end && (context.keywordTargets.some(function (kw) {
        return ad.trigger.keywordTargets.includes(kw);
      }) || ad.trigger.excludeKeywordTargets.length !== 0 && !context.keywordTargets.some(function (kw) {
        return ad.trigger.excludeKeywordTargets.includes(kw);
      })) && ( /* line below checks if ad with particular repetition number has been seen before and is a banner */
      sefaria._inBrowser && !document.cookie.includes("".concat(ad.campaignId, "_").concat(ad.repetition)) || ad.adType === "sidebar");
    });
  }
  function processSheetsData(response) {
    if (response.isError()) {
      alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
      return;
    }
    var data = response.getDataTable();
    var columns = data.getNumberOfColumns();
    var rows = data.getNumberOfRows();
    sefaria._inAppAds = [];
    for (var r = 0; r < rows; r++) {
      var row = [];
      for (var c = 0; c < columns; c++) {
        row.push(data.getFormattedValue(r, c));
      }
      var keywordTargetsArray = row[5].split(",").map(function (x) {
        return x.trim().toLowerCase();
      });
      var excludeKeywordTargets = keywordTargetsArray.filter(function (x) {
        return x.indexOf("!") === 0;
      });
      excludeKeywordTargets = excludeKeywordTargets.map(function (x) {
        return x.slice(1);
      });
      keywordTargetsArray = keywordTargetsArray.filter(function (x) {
        return x.indexOf("!") !== 0;
      });
      sefaria._inAppAds.push({
        campaignId: row[0],
        title: row[6],
        bodyText: row[7],
        buttonText: row[8],
        buttonUrl: row[9],
        buttonIcon: row[10],
        buttonLocation: row[11],
        adType: row[12],
        hasBlueBackground: parseInt(row[13]),
        repetition: row[14],
        buttonStyle: row[15],
        trigger: {
          showTo: row[4],
          interfaceLang: row[3],
          dt_start: Date.parse(row[1]),
          dt_end: Date.parse(row[2]),
          keywordTargets: keywordTargetsArray,
          excludeKeywordTargets: excludeKeywordTargets
        },
        debug: parseInt(row[16])
      });
    }
    setInAppAds(sefaria._inAppAds);
  }

  // TODO: refactor once old InterruptingMessage pattern is retired
  function createBannerHtml(matchingAd) {
    return "<div id=\"bannerTextBox\">\n\t<span class=\"".concat(context.interfaceLang === "hebrew" ? "int-he" : "int-en", "\" style=\"font-weight: bold\">\n        ").concat(matchingAd.bodyText, "\n    </span>\n</div>\n<div id=\"bannerButtonBox\">\n\t<a class=\"button white ").concat(context.interfaceLang === "hebrew" ? "int-he" : "int-en", "\" \n\t    href=\"").concat(matchingAd.buttonUrl, "\"   \n\t    onclick='gtag(\"event\", \"promo_clicked\", {  \n            campaignID: matchingAd.campaignId, adType:matchingAd.adType\n            })' \n        target=\"_blank\">\n        <span>").concat(matchingAd.buttonText, "</span>\n    </a>\n</div>");
  }
  function styleAds() {
    if (adType === "banner") {
      var matchingAd = matchingAds[0]; // Only allow a single banner
      if (!matchingAd) {
        return null;
      }
      var bannerHtml = createBannerHtml(matchingAd);
      return /*#__PURE__*/external_react_default().createElement(InterruptingMessage, {
        messageName: matchingAd.campaignId,
        messageHTML: bannerHtml,
        style: "banner",
        repetition: matchingAd.repetition,
        onClose: rerender
      });
    } else {
      var sidebarAds = matchingAds.map(function (ad) {
        return /*#__PURE__*/external_react_default().createElement(SidebarAd, {
          matchingAd: ad,
          key: ad.campaignId
        });
      });
      return sidebarAds;
    }
  }
  return matchingAds ? styleAds() : null;
};
var SidebarAd = function SidebarAd(_ref2) {
  var matchingAd = _ref2.matchingAd;
  var classes = external_classnames_default()({
    sidebarPromo: 1,
    blue: matchingAd.hasBlueBackground
  });
  function getButton() {
    return /*#__PURE__*/external_react_default().createElement("a", {
      className: matchingAd.buttonStyle,
      href: matchingAd.buttonUrl,
      onClick: function onClick() {
        return gtag("event", "promo_clicked", {
          campaignID: matchingAd.campaignId,
          adType: matchingAd.adType
        });
      }
    }, /*#__PURE__*/external_react_default().createElement("img", {
      src: "/static/icons/".concat(matchingAd.buttonIcon),
      "aria-hidden": "true"
    }), matchingAd.buttonText);
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: classes
  }, /*#__PURE__*/external_react_default().createElement("h3", null, matchingAd.title), matchingAd.buttonLocation === "below" ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("p", null, matchingAd.bodyText), getButton()) : /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, getButton(), /*#__PURE__*/external_react_default().createElement("p", null, matchingAd.bodyText)));
};

;// CONCATENATED MODULE: ../static/js/NavSidebar.jsx
function NavSidebar_typeof(obj) { "@babel/helpers - typeof"; return NavSidebar_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, NavSidebar_typeof(obj); }
function NavSidebar_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function NavSidebar_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? NavSidebar_ownKeys(Object(source), !0).forEach(function (key) { NavSidebar_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : NavSidebar_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function NavSidebar_defineProperty(obj, key, value) { key = NavSidebar_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function NavSidebar_toPropertyKey(arg) { var key = NavSidebar_toPrimitive(arg, "string"); return NavSidebar_typeof(key) === "symbol" ? key : String(key); }
function NavSidebar_toPrimitive(input, hint) { if (NavSidebar_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (NavSidebar_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }
function NavSidebar_slicedToArray(arr, i) { return NavSidebar_arrayWithHoles(arr) || NavSidebar_iterableToArrayLimit(arr, i) || NavSidebar_unsupportedIterableToArray(arr, i) || NavSidebar_nonIterableRest(); }
function NavSidebar_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function NavSidebar_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function NavSidebar_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function NavSidebar_toConsumableArray(arr) { return NavSidebar_arrayWithoutHoles(arr) || NavSidebar_iterableToArray(arr) || NavSidebar_unsupportedIterableToArray(arr) || NavSidebar_nonIterableSpread(); }
function NavSidebar_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function NavSidebar_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return NavSidebar_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return NavSidebar_arrayLikeToArray(o, minLen); }
function NavSidebar_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function NavSidebar_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return NavSidebar_arrayLikeToArray(arr); }
function NavSidebar_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }







var NavSidebar = function NavSidebar(_ref) {
  var modules = _ref.modules;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "navSidebar sans-serif"
  }, modules.map(function (m, i) {
    return /*#__PURE__*/external_react_default().createElement(Modules, {
      type: m.type,
      props: m.props || {},
      key: i
    });
  }));
};
var Modules = function Modules(_ref2) {
  var type = _ref2.type,
    props = _ref2.props;
  // Choose the appropriate module component to render by `type`
  var moduleTypes = {
    "AboutSefaria": AboutSefaria,
    "Promo": Promo,
    "Resources": Resources,
    "TheJewishLibrary": TheJewishLibrary,
    "AboutTextCategory": AboutTextCategory,
    "AboutText": AboutText,
    "SupportSefaria": SupportSefaria,
    "SponsorADay": SponsorADay,
    "LearningSchedules": LearningSchedules,
    "Translations": Translations,
    "WeeklyTorahPortion": WeeklyTorahPortion,
    "DafYomi": DafYomi,
    "AboutTopics": AboutTopics,
    "TrendingTopics": TrendingTopics,
    "RelatedTopics": RelatedTopics,
    "TitledText": TitledText,
    "Visualizations": Visualizations,
    "JoinTheConversation": JoinTheConversation,
    "JoinTheCommunity": JoinTheCommunity,
    "GetTheApp": GetTheApp,
    "StayConnected": StayConnected,
    "AboutLearningSchedules": AboutLearningSchedules,
    "AboutTranslatedText": AboutTranslatedText,
    "AboutCollections": AboutCollections,
    "ExploreCollections": ExploreCollections,
    "DownloadVersions": DownloadVersions,
    "WhoToFollow": WhoToFollow,
    "Image": Image,
    "Wrapper": Wrapper
  };
  if (!type) {
    return null;
  }
  var ModuleType = moduleTypes[type];
  return /*#__PURE__*/external_react_default().createElement(ModuleType, props);
};
var Module = function Module(_ref3) {
  var children = _ref3.children,
    blue = _ref3.blue,
    wide = _ref3.wide;
  var classes = external_classnames_default()({
    navSidebarModule: 1,
    "sans-serif": 1,
    blue: blue,
    wide: wide
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: classes
  }, children);
};
var ModuleTitle = function ModuleTitle(_ref4) {
  var children = _ref4.children,
    en = _ref4.en,
    he = _ref4.he,
    h1 = _ref4.h1;
  var content = children ? /*#__PURE__*/external_react_default().createElement(InterfaceText, null, children) : /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: en,
      he: he
    }
  });
  return h1 ? /*#__PURE__*/external_react_default().createElement("h1", null, content) : /*#__PURE__*/external_react_default().createElement("h3", null, content);
};
var TitledText = function TitledText(_ref5) {
  var enTitle = _ref5.enTitle,
    heTitle = _ref5.heTitle,
    enText = _ref5.enText,
    heText = _ref5.heText;
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, {
    en: enTitle,
    he: heTitle
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    markdown: {
      en: enText,
      he: heText
    }
  }));
};
var Promo = function Promo() {
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(Promotions, {
    adType: "sidebar"
  }));
};
var AboutSefaria = function AboutSefaria(_ref6) {
  var hideTitle = _ref6.hideTitle;
  return /*#__PURE__*/external_react_default().createElement(Module, null, !hideTitle ? /*#__PURE__*/external_react_default().createElement(ModuleTitle, {
    h1: true
  }, "A Living Library of Torah") : null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, "Sefaria is home to 3,000 years of Jewish texts. We are a non-profit organization offering free access to texts, translations, and commentaries so that everyone can participate in the ongoing process of studying, interpreting, and creating Torah."), /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05E1\u05E4\u05E8\u05D9\u05D0 \u05D4\u05D9\u05D0 \u05D1\u05D9\u05EA\u05DD \u05E9\u05DC 3,000 \u05E9\u05E0\u05D5\u05EA \u05E1\u05E4\u05E8\u05D5\u05EA \u05D9\u05D4\u05D5\u05D3\u05D9\u05EA. \u05D0\u05E0\u05D5 \u05D0\u05E8\u05D2\u05D5\u05DF \u05DC\u05DC\u05D0 \u05DE\u05D8\u05E8\u05D5\u05EA \u05E8\u05D5\u05D5\u05D7 \u05D4\u05DE\u05E6\u05D9\u05E2 \u05D2\u05D9\u05E9\u05D4 \u05D7\u05D5\u05E4\u05E9\u05D9\u05EA \u05DC\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD, \u05DC\u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD \u05D5\u05DC\u05E4\u05E8\u05E9\u05E0\u05D5\u05D9\u05D5\u05EA, \u05D5\u05DE\u05D8\u05E8\u05EA\u05E0\u05D5 \u05DC\u05D0\u05E4\u05E9\u05E8 \u05DC\u05DB\u05DC \u05D0\u05D7\u05D3 \u05D5\u05D0\u05D7\u05EA \u05DC\u05D4\u05E9\u05EA\u05EA\u05E3 \u05D1\u05EA\u05D4\u05DC\u05D9\u05DA \u05D4\u05DE\u05EA\u05DE\u05E9\u05DA \u05E9\u05DC \u05DC\u05D9\u05DE\u05D5\u05D3 \u05D5\u05D7\u05D9\u05D3\u05D5\u05E9 \u05D1\u05EA\u05D5\u05E8\u05D4.")), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/about",
    className: "inTextLink"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, "Learn More \u203A"), /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05DC\u05E7\u05E8\u05D9\u05D0\u05D4 \u05E0\u05D5\u05E1\u05E4\u05EA \u203A"))), sefaria.interfaceLang === 'english' && !hideTitle && /*#__PURE__*/external_react_default().createElement("a", {
    className: "button get-start",
    href: "/sheets/210670"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/vector.svg"
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "get-start"
  }, "Getting Started (2 min)")));
};
var AboutTranslatedText = function AboutTranslatedText(_ref7) {
  var translationsSlug = _ref7.translationsSlug;
  var translationLookup = {
    "ar": {
      title: "نصوص يهودية بالعربية",
      body: "سفاريا هي موطن 3000 سنة من النصوص اليهودية. نحن منظمة غير ربحية تقدم وصولاً مجانيًا إلى النصوص والترجمات والتعليقات حتى يتمكن الجميع من المشاركة في العملية المستمرة لدراسة التوراة وتفسيرها وخلقها."
    },
    "de": {
      title: "Eine lebendige Bibliothek der Tora",
      body: "Sefaria ist eine Bibliothek für jüdische Texte aus 3.000 Jahren. Wir sind eine gemeinnützige Organisation, die freien Zugang zu Texten, Übersetzungen und Kommentaren bietet, damit jede und jeder am fortlaufenden Prozess des Studierens, Interpretierens und der Entwicklung der Tora teilnehmen kann."
    },
    "eo": {
      title: "Vivanta Biblioteko de Torao",
      body: "Sefaria estas hejmo de 3,000 jaroj da judaj tekstoj. Ni estas neprofitcela organizo ofertanta senpagan aliron al tekstoj, tradukoj kaj komentaĵoj por ke ĉiuj povu partopreni en la daŭra procezo de studado, interpretado kaj kreado de Torao."
    },
    "es": {
      title: "Una biblioteca viva de la Torá",
      body: "Sefaria alberga 3.000 años de textos judíos. Somos una organización sin fines de lucro que ofrece acceso gratuito a textos, traducciones y comentarios para que todos puedan participar en el proceso continuo de estudio, interpretación y creación de la Torá."
    },
    "fa": {
      title: "کتابخانه زنده تورات",
      body: "سفاریا خانه 3000 سال متون یهودی است. ما یک سازمان غیرانتفاعی هستیم که دسترسی رایگان به متون، ترجمه ها و تفسیرها را ارائه می دهیم تا همه بتوانند در روند مداوم مطالعه، تفسیر و ایجاد تورات شرکت کنند."
    },
    "fi": {
      title: "Tooran elävä kirjasto",
      body: "Sefaria on koti 3000 vuoden juutalaisille teksteille. Olemme voittoa tavoittelematon organisaatio, joka tarjoaa ilmaisen pääsyn teksteihin, käännöksiin ja kommentteihin, jotta kaikki voivat osallistua jatkuvaan Tooran opiskelu-, tulkkaus- ja luomisprosessiin."
    },
    "fr": {
      title: "Une bibliothèque vivante de la Torah",
      body: "Une bibliothèque de Torah vivante. Sefaria abrite 3 000 ans de textes juifs. Nous sommes une organisation à but non lucratif offrant un accès gratuit aux textes de la Torah, aux commentaires et aux traductions, afin que chacun puisse participer au processus infini de l'étude, de l'interprétation et de la création de la Torah."
    },
    "it": {
      title: "Una biblioteca vivente della Torah",
      body: "Sefaria ospita 3.000 anni di testi ebraici. Siamo un'organizzazione senza scopo di lucro che offre libero accesso a testi, traduzioni e commenti in modo che tutti possano partecipare al processo in corso di studio, interpretazione e creazione della Torah."
    },
    "pl": {
      title: "Żywa Biblioteka Tory",
      body: "Sefaria jest domem dla 3000 lat żydowskich tekstów. Jesteśmy organizacją non-profit oferującą bezpłatny dostęp do tekstów, tłumaczeń i komentarzy, dzięki czemu każdy może uczestniczyć w bieżącym procesie studiowania, tłumaczenia i tworzenia Tory."
    },
    "pt": {
      title: "Uma Biblioteca Viva da Torá",
      body: "Sefaria é o lar de 3.000 anos de textos judaicos. Somos uma organização sem fins lucrativos que oferece acesso gratuito a textos, traduções e comentários para que todos possam participar do processo contínuo de estudo, interpretação e criação da Torá."
    },
    "ru": {
      title: "Живая библиотека Торы",
      body: "Сефария является домом для еврейских текстов 3000-летней давности. Мы — некоммерческая организация, предлагающая бесплатный доступ к текстам, переводам и комментариям, чтобы каждый мог участвовать в продолжающемся процессе изучения, толкования и создания Торы."
    },
    "yi": {
      title: "א לעבעדיקע ביבליאטעק פון תורה",
      body: "אין ספֿריאַ איז אַ היים פֿון 3,000 יאָר ייִדישע טעקסטן. מיר זענען אַ נאַן-נוץ אָרגאַניזאַציע וואָס אָפפערס פריי אַקסעס צו טעקסטן, איבערזעצונגען און קאָמענטאַרן אַזוי אַז אַלעמען קענען אָנטייל נעמען אין די אָנגאָינג פּראָצעס פון לערנען, ינטערפּריטיישאַן און שאפן תורה."
    }
  };
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, {
    h1: true
  }, translationLookup[translationsSlug] ? translationLookup[translationsSlug]["title"] : "A Living Library of Torah"), translationLookup[translationsSlug] ? translationLookup[translationsSlug]["body"] : /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, "Sefaria is home to 3,000 years of Jewish texts. We are a non-profit organization offering free access to texts, translations, and commentaries so that everyone can participate in the ongoing process of studying, interpreting, and creating Torah."), /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05E1\u05E4\u05E8\u05D9\u05D0 \u05D4\u05D9\u05D0 \u05D1\u05D9\u05EA\u05DD \u05E9\u05DC 3,000 \u05E9\u05E0\u05D5\u05EA \u05E1\u05E4\u05E8\u05D5\u05EA \u05D9\u05D4\u05D5\u05D3\u05D9\u05EA. \u05D0\u05E0\u05D5 \u05D0\u05E8\u05D2\u05D5\u05DF \u05DC\u05DC\u05D0 \u05DE\u05D8\u05E8\u05D5\u05EA \u05E8\u05D5\u05D5\u05D7 \u05D4\u05DE\u05E6\u05D9\u05E2 \u05D2\u05D9\u05E9\u05D4 \u05D7\u05D5\u05E4\u05E9\u05D9\u05EA \u05DC\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD, \u05DC\u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD \u05D5\u05DC\u05E4\u05E8\u05E9\u05E0\u05D5\u05D9\u05D5\u05EA, \u05D5\u05DE\u05D8\u05E8\u05EA\u05E0\u05D5 \u05DC\u05D0\u05E4\u05E9\u05E8 \u05DC\u05DB\u05DC \u05D0\u05D7\u05D3 \u05D5\u05D0\u05D7\u05EA \u05DC\u05D4\u05E9\u05EA\u05EA\u05E3 \u05D1\u05EA\u05D4\u05DC\u05D9\u05DA \u05D4\u05DE\u05EA\u05DE\u05E9\u05DA \u05E9\u05DC \u05DC\u05D9\u05DE\u05D5\u05D3 \u05D5\u05D7\u05D9\u05D3\u05D5\u05E9 \u05D1\u05EA\u05D5\u05E8\u05D4.")));
};
var Resources = function Resources() {
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement("h3", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    context: "ResourcesModule"
  }, "Resources")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "linkList"
  }, /*#__PURE__*/external_react_default().createElement(IconLink, {
    text: "Mobile Apps",
    url: "/mobile",
    icon: "mobile.svg"
  }), /*#__PURE__*/external_react_default().createElement(IconLink, {
    text: "Create with Sefaria",
    url: "/sheets",
    icon: "sheet.svg"
  }), /*#__PURE__*/external_react_default().createElement(IconLink, {
    text: "Collections",
    url: "/collections",
    icon: "collection.svg"
  }), /*#__PURE__*/external_react_default().createElement(IconLink, {
    text: "Teach with Sefaria",
    url: "/educators",
    icon: "educators.svg"
  }), /*#__PURE__*/external_react_default().createElement(IconLink, {
    text: "Visualizations",
    url: "/visualizations",
    icon: "visualizations.svg"
  }), /*#__PURE__*/external_react_default().createElement(IconLink, {
    text: "Torah Tab",
    url: "/torah-tab",
    icon: "torah-tab.svg"
  }), /*#__PURE__*/external_react_default().createElement(IconLink, {
    text: "Help",
    url: "/help",
    icon: "help.svg"
  })));
};
var TheJewishLibrary = function TheJewishLibrary(_ref8) {
  var hideTitle = _ref8.hideTitle;
  return /*#__PURE__*/external_react_default().createElement(Module, null, !hideTitle ? /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "The Jewish Library") : null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "The tradition of Torah texts is a vast, interconnected network that forms a conversation across space and time. The five books of the Torah form its foundation, and each generation of later texts functions as a commentary on those that came before it."));
};
var SupportSefaria = function SupportSefaria(_ref9) {
  var blue = _ref9.blue;
  return /*#__PURE__*/external_react_default().createElement(Module, {
    blue: blue
  }, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Support Sefaria"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sefaria is an open source, non-profit project. Support us by making a tax-deductible donation."), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement(DonateLink, {
    classes: "button small" + (blue ? " white" : ""),
    source: "NavSidebar-SupportSefaria"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/heart.png",
    alt: "donation icon"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Make a Donation")));
};
var SponsorADay = function SponsorADay() {
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Sponsor A Day of Learning"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "With your help, we can add more texts and translations to the library, develop new tools for learning, and keep Sefaria accessible for Torah study anytime, anywhere."), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement(DonateLink, {
    classes: "button small",
    link: "dayOfLearning",
    source: "NavSidebar-SponsorADay"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/heart.png",
    alt: "donation icon"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sponsor A Day")));
};
var AboutTextCategory = function AboutTextCategory(_ref10) {
  var cats = _ref10.cats;
  var tocObject = sefaria.tocObjectByCategories(cats);
  var enTitle = "About " + tocObject.category;
  var heTitle = "אודות " + tocObject.heCategory;
  if (sefaria.interfaceLang === "hebrew" && !tocObject.heDesc || sefaria.interfaceLang === "english" && !tocObject.enDesc) {
    return null;
  }
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement("h3", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: enTitle,
      he: heTitle
    }
  })), /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    markdown: {
      en: tocObject.enDesc,
      he: tocObject.heDesc
    }
  }));
};
var AboutText = function AboutText(_ref11) {
  var _index$compPlaceStrin, _index$compDateString, _ref12;
  var index = _ref11.index,
    hideTitle = _ref11.hideTitle;
  var lang = sefaria.interfaceLang === "hebrew" ? "he" : "en";
  var composed = [(_index$compPlaceStrin = index.compPlaceString) === null || _index$compPlaceStrin === void 0 ? void 0 : _index$compPlaceStrin[lang], (_index$compDateString = index.compDateString) === null || _index$compDateString === void 0 ? void 0 : _index$compDateString[lang]].filter(function (x) {
    return !!x;
  }).join(", ");
  composed = composed.replace(/[()]/g, "");
  if (index.categories.length == 2 && index.categories[0] == "Tanakh" && ["Torah", "Prophets", "Writings"].indexOf(index.categories[1]) !== -1) {
    // Don't show date/time for Tanakh.
    composed = null;
  }
  var authors = (index === null || index === void 0 ? void 0 : index.authors) || [];
  authors = authors.filter(function (a) {
    return !!a[lang];
  }).map(function (a) {
    return /*#__PURE__*/external_react_default().createElement("a", {
      href: "/topics/" + a.slug,
      key: a.slug
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, a[lang]));
  });
  authors = (_ref12 = []).concat.apply(_ref12, NavSidebar_toConsumableArray(authors.map(function (x) {
    return [/*#__PURE__*/external_react_default().createElement("span", null, ", "), x];
  }))).slice(1); // Like a join for an array of React elements
  var heDesc = index.heDesc || index.heShortDesc;
  var enDesc = index.enDesc || index.enShortDesc;
  var description = lang === "he" ? heDesc : enDesc;
  if (!authors.length && !composed && !description) {
    return null;
  }
  return /*#__PURE__*/external_react_default().createElement(Module, null, hideTitle ? null : /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "About This Text"), composed || authors.length ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "aboutTextMetadata"
  }, authors.length ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "aboutTextAuthor"
  }, authors.length == 1 ? /*#__PURE__*/external_react_default().createElement("span", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Author"), ":") : /*#__PURE__*/external_react_default().createElement("span", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Authors"), ":"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "aboutTextAuthorText"
  }, "\xA0", authors)) : null, composed ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "aboutTextComposed"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Composed"), ":", /*#__PURE__*/external_react_default().createElement("span", {
    className: "aboutTextComposedText"
  }, "\xA0", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, composed))) : null) : null, description ? /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    markdown: {
      en: enDesc,
      he: heDesc
    }
  }) : null);
};
var TranslationLinks = function TranslationLinks() {
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "navSidebarLink serif language"
  }, /*#__PURE__*/external_react_default().createElement("ul", null, Object.keys(sefaria.ISOMap).map(function (key) {
    return sefaria.ISOMap[key]["showTranslations"] ? /*#__PURE__*/external_react_default().createElement("li", {
      key: key
    }, /*#__PURE__*/external_react_default().createElement("a", {
      href: "/translations/".concat(key)
    }, sefaria.ISOMap[key]["nativeName"])) : null;
  }), " "));
};
var ParashahLink = function ParashahLink() {
  var parashah = sefaria.calendars.filter(function (c) {
    return c.title.en === "Parashat Hashavua";
  })[0];
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "navSidebarLink ref serif"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/book.svg",
    className: "navSidebarIcon",
    alt: "book icon"
  }), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/" + parashah.url
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: parashah.ref,
      he: parashah.heRef
    }
  })));
};
var ParashahName = function ParashahName() {
  var parashah = sefaria.calendars.filter(function (c) {
    return c.title.en === "Parashat Hashavua";
  })[0];
  return /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: parashah.displayValue
  });
};
var HaftarotLinks = function HaftarotLinks() {
  var haftarot = sefaria.calendars.filter(function (c) {
    return c.title.en.startsWith("Haftarah");
  });
  return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, haftarot.map(function (h) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "navSidebarLink ref serif",
      key: h.url
    }, /*#__PURE__*/external_react_default().createElement("img", {
      src: "/static/icons/book.svg",
      className: "navSidebarIcon",
      alt: "book icon"
    }), /*#__PURE__*/external_react_default().createElement("a", {
      href: "/" + h.url
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: h.displayValue
    })));
  }));
};
var DafLink = function DafLink() {
  var daf = sefaria.calendars.filter(function (c) {
    return c.title.en === "Daf Yomi";
  })[0];
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "navSidebarLink ref serif"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/book.svg",
    className: "navSidebarIcon",
    alt: sefaria._("book icon")
  }), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/" + daf.url
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: daf.displayValue
  })));
};
var Translations = function Translations() {
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Translations"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, "Access key works from the library in several languages."), /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05D9\u05E6\u05D9\u05E8\u05D5\u05EA \u05E0\u05D1\u05D7\u05E8\u05D5\u05EA \u05DE\u05D4\u05E1\u05E4\u05E8\u05D9\u05D9\u05D4 \u05D1\u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD \u05DC\u05E9\u05E4\u05D5\u05EA \u05E9\u05D5\u05E0\u05D5\u05EA.")), /*#__PURE__*/external_react_default().createElement(TranslationLinks, null));
};
var LearningSchedules = function LearningSchedules() {
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Learning Schedules"), /*#__PURE__*/external_react_default().createElement("div", {
    className: "readingsSection"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "readingsSectionTitle"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Weekly Torah Portion"), ": ", /*#__PURE__*/external_react_default().createElement(ParashahName, null)), /*#__PURE__*/external_react_default().createElement(ParashahLink, null)), /*#__PURE__*/external_react_default().createElement("div", {
    className: "readingsSection"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "readingsSectionTitle"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Haftarah")), /*#__PURE__*/external_react_default().createElement(HaftarotLinks, null)), /*#__PURE__*/external_react_default().createElement("div", {
    className: "readingsSection"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "readingsSectionTitle"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Daf Yomi")), /*#__PURE__*/external_react_default().createElement(DafLink, null)), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/calendars",
    className: "allLink"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, "All Learning Schedules \u203A"), /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05DC\u05D5\u05D7\u05D5\u05EA \u05DC\u05D9\u05DE\u05D5\u05D3 \u05E0\u05D5\u05E1\u05E4\u05D9\u05DD \u203A"))));
};
var WeeklyTorahPortion = function WeeklyTorahPortion() {
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Weekly Torah Portion"), /*#__PURE__*/external_react_default().createElement("div", {
    className: "readingsSection"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "readingsSectionTitle"
  }, /*#__PURE__*/external_react_default().createElement(ParashahName, null)), /*#__PURE__*/external_react_default().createElement(ParashahLink, null)), /*#__PURE__*/external_react_default().createElement("div", {
    className: "readingsSection"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "readingsSectionTitle"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Haftarah")), /*#__PURE__*/external_react_default().createElement(HaftarotLinks, null)), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/topics/category/torah-portions",
    className: "allLink"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, "All Portions \u203A"), /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05E4\u05E8\u05E9\u05D5\u05EA \u05D4\u05E9\u05D1\u05D5\u05E2 \u203A"))));
};
var DafYomi = function DafYomi() {
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Daily Learning"), /*#__PURE__*/external_react_default().createElement("div", {
    className: "readingsSection"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "readingsSectionTitle"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Daf Yomi")), /*#__PURE__*/external_react_default().createElement(DafLink, null)));
};
var Visualizations = function Visualizations(_ref13) {
  var categories = _ref13.categories;
  var visualizations = [{
    en: "Tanakh & Talmud",
    he: 'תנ"ך ותלמוד',
    url: "/explore"
  }, {
    en: "Talmud & Mishneh Torah",
    he: "תלמוד ומשנה תורה",
    url: "/explore-Bavli-and-Mishneh-Torah"
  }, {
    en: "Talmud & Shulchan Arukh",
    he: "תלמוד ושולחן ערוך",
    url: "/explore-Bavli-and-Shulchan-Arukh"
  }, {
    en: "Mishneh Torah & Shulchan Arukh",
    he: "משנה תורה ושולחן ערוך",
    url: "/explore-Mishneh-Torah-and-Shulchan-Arukh"
  }, {
    en: "Tanakh & Midrash Rabbah",
    he: 'תנ"ך ומדרש רבה',
    url: "/explore-Tanakh-and-Midrash-Rabbah"
  }, {
    en: "Tanakh & Mishneh Torah",
    he: 'תנ"ך ומשנה תורה',
    url: "/explore-Tanakh-and-Mishneh-Torah"
  }, {
    en: "Tanakh & Shulchan Arukh",
    he: 'תנ"ך ושולחן ערוך',
    url: "/explore-Tanakh-and-Shulchan-Arukh"
  }];
  var links = visualizations.filter(function (v) {
    return categories.some(function (cat) {
      return v.en.indexOf(cat) > -1;
    });
  });
  if (links.length == 0) {
    return null;
  }
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Visualizations"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Explore interconnections among texts with our interactive visualizations."), /*#__PURE__*/external_react_default().createElement("div", {
    className: "linkList"
  }, links.map(function (link, i) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "navSidebarLink gray",
      key: i
    }, /*#__PURE__*/external_react_default().createElement("img", {
      src: "/static/icons/visualization.svg",
      className: "navSidebarIcon",
      alt: sefaria._("visualization icon")
    }), /*#__PURE__*/external_react_default().createElement("a", {
      href: link.url
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: {
        en: link.en,
        he: link.he
      }
    })));
  })), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/visualizations",
    className: "allLink"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, "All Visualizations \u203A"), /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05EA\u05E8\u05E9\u05D9\u05DE\u05D9\u05DD \u05D2\u05E8\u05E4\u05D9\u05D9\u05DD \u05E0\u05D5\u05E1\u05E4\u05D9\u05DD \u203A"))));
};
var AboutTopics = function AboutTopics(_ref14) {
  var hideTitle = _ref14.hideTitle;
  return /*#__PURE__*/external_react_default().createElement(Module, null, hideTitle ? null : /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "About Topics"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05D1\u05D3\u05E4\u05D9 \u05D4\u05E0\u05D5\u05E9\u05D0 \u05DE\u05DC\u05D5\u05E7\u05D8\u05D9\u05DD \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E0\u05D1\u05D7\u05E8\u05D9\u05DD \u05D5\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05DC \u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05E2\u05DC \u05E0\u05D5\u05E9\u05D0 \u05DE\u05E1\u05D5\u05D9\u05DD. \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D4\u05DE\u05D5\u05E4\u05D9\u05E2\u05D9\u05DD \u05D1\u05D3\u05E4\u05D9 \u05D4\u05E0\u05D5\u05E9\u05D0 \u05E0\u05D0\u05E1\u05E4\u05D9\u05DD \u05DE\u05DE\u05D0\u05D2\u05E8\u05D9\u05DD \u05E7\u05D9\u05D9\u05DE\u05D9\u05DD \u05E9\u05DC \u05E1\u05E4\u05E8\u05D5\u05EA \u05D9\u05D4\u05D5\u05D3\u05D9\u05EA (\u05D3\u05D5\u05D2\u05DE\u05EA '\u05D0\u05E1\u05E4\u05E7\u05DC\u05E8\u05D9\u05D0') \u05D5\u05DE\u05EA\u05D5\u05DA \u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E4\u05D5\u05DE\u05D1\u05D9\u05D9\u05DD \u05E9\u05DC \u05DE\u05E9\u05EA\u05DE\u05E9\u05D9 \u05E1\u05E4\u05E8\u05D9\u05D0."), /*#__PURE__*/external_react_default().createElement(EnglishText, null, "Topics bring you straight to selections of texts and user created source sheets about thousands of subjects. Sources that appear are drawn from existing indices of Jewish texts (like Aspaklaria) and from the sources our users include on their public source sheets.")));
};
var TrendingTopics = function TrendingTopics() {
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Trending Topics"), sefaria.trendingTopics.map(function (topic, i) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "navSidebarLink ref serif",
      key: i
    }, /*#__PURE__*/external_react_default().createElement("a", {
      href: "/topics/" + topic.slug
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: {
        en: topic.en,
        he: topic.he
      }
    })));
  }));
};
var RelatedTopics = function RelatedTopics(_ref15) {
  var _Sefaria$getIndexDeta;
  var title = _ref15.title;
  var _useState = (0,external_react_.useState)(((_Sefaria$getIndexDeta = sefaria.getIndexDetailsFromCache(title)) === null || _Sefaria$getIndexDeta === void 0 ? void 0 : _Sefaria$getIndexDeta.relatedTopics) || []),
    _useState2 = NavSidebar_slicedToArray(_useState, 2),
    topics = _useState2[0],
    setTopics = _useState2[1];
  var _useState3 = (0,external_react_.useState)(false),
    _useState4 = NavSidebar_slicedToArray(_useState3, 2),
    showMore = _useState4[0],
    setShowMore = _useState4[1];
  var showMoreLink = !showMore && topics.length > 5;
  var shownTopics = showMore ? topics : topics.slice(0, 5);
  (0,external_react_.useEffect)(function () {
    sefaria.getIndexDetails(title).then(function (data) {
      return setTopics(data.relatedTopics);
    });
  }, [title]);
  return topics.length ? /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Related Topics"), shownTopics.map(function (topic, i) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "navSidebarLink ref serif",
      key: i
    }, /*#__PURE__*/external_react_default().createElement("a", {
      href: "/topics/" + topic.slug
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: {
        en: topic.title.en,
        he: topic.title.he
      }
    })));
  }), showMoreLink ? /*#__PURE__*/external_react_default().createElement("a", {
    className: "moreLink",
    onClick: function onClick() {
      setShowMore(true);
    }
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "More")) : null) : null;
};
var JoinTheConversation = function JoinTheConversation(_ref16) {
  var wide = _ref16.wide;
  if (!sefaria.multiPanel) {
    return null;
  } // Don't advertise create sheets on mobile (yet)

  return /*#__PURE__*/external_react_default().createElement(Module, {
    wide: wide
  }, /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Join the Conversation"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Combine sources from our library with your own comments, questions, images, and videos.")), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "button small",
    href: "/sheets/new"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/new-sheet-black.svg",
    alt: "make a sheet icon"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Make a Sheet"))));
};
var JoinTheCommunity = function JoinTheCommunity(_ref17) {
  var wide = _ref17.wide;
  return /*#__PURE__*/external_react_default().createElement(Module, {
    wide: wide
  }, /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Join the Conversation"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "People around the world use Sefaria to create and share Torah resources. You're invited to add your voice.")), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "button small",
    href: "/community"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/community-black.svg",
    alt: "make a sheet icon"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Explore the Community"))));
};
var GetTheApp = function GetTheApp() {
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Get the Mobile App"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Access the Jewish library anywhere and anytime with the"), " ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "/mobile",
    className: "inTextLink"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sefaria mobile app.")), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement("a", {
    target: "_blank",
    className: "button small white appButton ios",
    href: "https://itunes.apple.com/us/app/sefaria/id1163273965?ls=1&mt=8"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/ios.svg",
    alt: sefaria._("Sefaria app on IOS")
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "iOS")), /*#__PURE__*/external_react_default().createElement("a", {
    target: "_blank",
    className: "button small white appButton",
    href: "https://play.google.com/store/apps/details?id=org.sefaria.sefaria"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/android.svg",
    alt: sefaria._("Sefaria app on Android")
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Android")));
};
var StayConnected = function StayConnected() {
  // TODO: remove? looks like we are not using this
  var fbURL = sefaria.interfaceLang == "hebrew" ? "https://www.facebook.com/sefaria.org.il" : "https://www.facebook.com/sefaria.org";
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Stay Connected"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Get updates on new texts, learning resources, features, and more."), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement(NewsletterSignUpForm, {
    context: "sidebar"
  }), /*#__PURE__*/external_react_default().createElement("a", {
    target: "_blank",
    className: "button small white appButton iconOnly",
    href: fbURL
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/facebook.svg",
    alt: sefaria._("Sefaria on Facebook")
  })), /*#__PURE__*/external_react_default().createElement("a", {
    target: "_blank",
    className: "button small white appButton iconOnly",
    href: "https://twitter.com/SefariaProject"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/twitter.svg",
    alt: sefaria._("Sefaria on Twitter")
  })), /*#__PURE__*/external_react_default().createElement("a", {
    target: "_blank",
    className: "button small white appButton iconOnly",
    href: "https://www.instagram.com/sefariaproject"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/instagram.svg",
    alt: sefaria._("Sefaria on Instagram")
  })), /*#__PURE__*/external_react_default().createElement("a", {
    target: "_blank",
    className: "button small white appButton iconOnly",
    href: "https://www.youtube.com/user/SefariaProject"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/youtube.svg",
    alt: sefaria._("Sefaria on YouTube")
  })));
};
var AboutLearningSchedules = function AboutLearningSchedules() {
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, {
    h1: true
  }, "Learning Schedules"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, "Since biblical times, the Torah has been divided into sections which are read each week on a set yearly calendar. Following this practice, many other calendars have been created to help communities of learners work through specific texts together."), /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05DE\u05D9\u05DE\u05D9 \u05E7\u05D3\u05DD \u05D7\u05D5\u05DC\u05E7\u05D4 \u05D4\u05EA\u05D5\u05E8\u05D4 \u05DC\u05E7\u05D8\u05E2\u05D9 \u05E7\u05E8\u05D9\u05D0\u05D4 \u05E9\u05D1\u05D5\u05E2\u05D9\u05D9\u05DD \u05E9\u05E0\u05D5\u05E2\u05D3\u05D5 \u05DC\u05E1\u05D9\u05D5\u05DD \u05D4\u05E1\u05E4\u05E8 \u05DB\u05D5\u05DC\u05D5 \u05D1\u05DE\u05E9\u05DA \u05EA\u05E7\u05D5\u05E4\u05EA \u05D6\u05DE\u05DF \u05E9\u05DC \u05E9\u05E0\u05D4. \u05D1\u05E2\u05E7\u05D1\u05D5\u05EA \u05D4\u05DE\u05E0\u05D4\u05D2 \u05D4\u05D6\u05D4 \u05D4\u05EA\u05E4\u05EA\u05D7\u05D5 \u05DC\u05D0\u05D5\u05E8\u05DA \u05D4\u05E9\u05E0\u05D9\u05DD \u05E1\u05D3\u05E8\u05D9 \u05DC\u05D9\u05DE\u05D5\u05D3 \u05EA\u05E7\u05D5\u05E4\u05EA\u05D9\u05D9\u05DD \u05E8\u05D1\u05D9\u05DD \u05E0\u05D5\u05E1\u05E4\u05D9\u05DD, \u05D5\u05D1\u05E2\u05D6\u05E8\u05EA\u05DD \u05D9\u05DB\u05D5\u05DC\u05D5\u05EA \u05E7\u05D4\u05D9\u05DC\u05D5\u05EA \u05D5\u05E7\u05D1\u05D5\u05E6\u05D5\u05EA \u05E9\u05DC \u05DC\u05D5\u05DE\u05D3\u05D9\u05DD \u05DC\u05DC\u05DE\u05D5\u05D3 \u05D9\u05D7\u05D3 \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05E9\u05DC\u05DE\u05D9\u05DD.")));
};
var AboutCollections = function AboutCollections(_ref18) {
  var hideTitle = _ref18.hideTitle;
  return /*#__PURE__*/external_react_default().createElement(Module, null, hideTitle ? null : /*#__PURE__*/external_react_default().createElement(ModuleTitle, {
    h1: true
  }, "About Collections"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, "Collections are user generated bundles of sheets which can be used privately, shared with friends, or made public on Sefaria."), /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05D0\u05E1\u05D5\u05E4\u05D5\u05EA \u05D4\u05DF \u05DE\u05E7\u05D1\u05E6\u05D9\u05DD \u05E9\u05DC \u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05E0\u05D5\u05E6\u05E8\u05D5 \u05E2\u05DC \u05D9\u05D3\u05D9 \u05DE\u05E9\u05EA\u05DE\u05E9\u05D9 \u05D4\u05D0\u05EA\u05E8. \u05D4\u05DF \u05E0\u05D9\u05EA\u05E0\u05D5\u05EA \u05DC\u05E9\u05D9\u05DE\u05D5\u05E9 \u05E4\u05E8\u05D8\u05D9, \u05DC\u05E6\u05D5\u05E8\u05DA \u05E9\u05D9\u05EA\u05D5\u05E3 \u05E2\u05DD \u05D0\u05D7\u05E8\u05D9\u05DD \u05D0\u05D5 \u05DC\u05E9\u05D9\u05DE\u05D5\u05E9 \u05E6\u05D9\u05D1\u05D5\u05E8\u05D9 \u05D1\u05D0\u05EA\u05E8 \u05E1\u05E4\u05E8\u05D9\u05D0.")), hideTitle ? null : /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "button small",
    href: "/collections/new"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/collection-black.svg",
    alt: "create a collection icon"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Create a Collection"))));
};
var ExploreCollections = function ExploreCollections() {
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Collections"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Organizations, communities and individuals around the world curate and share collections of sheets for you to explore."), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "button small white",
    href: "/collections"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/collection.svg",
    alt: "collection icon"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Explore Collections"))));
};
var WhoToFollow = function WhoToFollow(_ref19) {
  var toggleSignUpModal = _ref19.toggleSignUpModal;
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Who to Follow"), sefaria.followRecommendations.map(function (user) {
    return /*#__PURE__*/external_react_default().createElement(ProfileListing, _extends({}, user, {
      key: user.uid,
      toggleSignUpModal: toggleSignUpModal
    }));
  }));
};
var Image = function Image(_ref20) {
  var url = _ref20.url;
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement("img", {
    className: "imageModuleImage",
    src: url
  }));
};
var Wrapper = function Wrapper(_ref21) {
  var title = _ref21.title,
    content = _ref21.content;
  return /*#__PURE__*/external_react_default().createElement(Module, null, title ? /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, title) : null, content);
};
var IconLink = function IconLink(_ref22) {
  var text = _ref22.text,
    url = _ref22.url,
    icon = _ref22.icon;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "navSidebarLink gray"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/" + icon,
    className: "navSidebarIcon",
    alt: "".concat(sefaria._(text), " ").concat(sefaria._("icon"))
  }), /*#__PURE__*/external_react_default().createElement("a", {
    href: url
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, text)));
};
var DownloadVersions = function DownloadVersions(_ref23) {
  var sref = _ref23.sref;
  //sref is generally an index title, but just in case we ever need a different resolution
  var _useState5 = (0,external_react_.useState)([]),
    _useState6 = NavSidebar_slicedToArray(_useState5, 2),
    versions = _useState6[0],
    setVersions = _useState6[1];
  var _useState7 = (0,external_react_.useState)(false),
    _useState8 = NavSidebar_slicedToArray(_useState7, 2),
    isReady = _useState8[0],
    setIsReady = _useState8[1];
  var _useState9 = (0,external_react_.useState)({
      dlVersionTitle: null,
      dlVersionFormat: null,
      dlVersionLanguage: null
    }),
    _useState10 = NavSidebar_slicedToArray(_useState9, 2),
    downloadSelected = _useState10[0],
    setDownloadSelected = _useState10[1];
  var isVersionPublicDomain = function isVersionPublicDomain(v) {
    return !(v.license && v.license.startsWith("Copyright"));
  };
  var handleInputChange = function handleInputChange(event) {
    var target = event.target;
    var value = target.value;
    var name = target.name;
    var newState = {};
    if (name == "dlVersionName") {
      var _value$split = value.split("/"),
        _value$split2 = NavSidebar_slicedToArray(_value$split, 2),
        versionTitle = _value$split2[0],
        versionLang = _value$split2[1];
      newState = {
        dlVersionTitle: versionTitle,
        dlVersionLanguage: versionLang
      };
    } else {
      newState = NavSidebar_defineProperty({}, name, value);
    }
    var dlstate = NavSidebar_objectSpread(NavSidebar_objectSpread({}, downloadSelected), newState);
    setDownloadSelected(dlstate);
    if (downloadParamsReady(dlstate)) {
      setIsReady(true);
    }
  };
  var downloadParamsReady = function downloadParamsReady(downloadParams) {
    return !Object.values(downloadParams).some(function (x) {
      return x === null;
    });
  };
  var versionDlLink = function versionDlLink() {
    return isReady ? "/download/version/".concat(sref, " - ").concat(downloadSelected.dlVersionLanguage, " - ").concat(downloadSelected.dlVersionTitle, ".").concat(downloadSelected.dlVersionFormat) : "#";
  };
  var handleClick = function handleClick(event) {
    if (!isReady) {
      event.preventDefault();
      return false;
    }
    recordDownload();
    return true;
  };
  var recordDownload = function recordDownload() {
    sefaria.track.event("Reader", "Version Download", "".concat(sref, " / ").concat(downloadSelected.dlVersionTitle, " / ").concat(downloadSelected.dlVersionLanguage, " / ").concat(downloadSelected.dlVersionFormat));
  };
  (0,external_react_.useEffect)(function () {
    sefaria.getVersions(sref).then(function (data) {
      data = Object.values(data).flat();
      data = data.filter(isVersionPublicDomain);
      data.sort(function (a, b) {
        return a.versionTitle.localeCompare(b.versionTitle);
      });
      setVersions(data);
    });
  }, [sref]);
  return /*#__PURE__*/external_react_default().createElement(Module, null, /*#__PURE__*/external_react_default().createElement(ModuleTitle, null, "Download Text"), /*#__PURE__*/external_react_default().createElement("div", {
    className: "downloadTextModule sans-serif"
  }, /*#__PURE__*/external_react_default().createElement(Dropdown, {
    name: "dlVersionName",
    options: versions.map(function (v) {
      return {
        value: "".concat(v.versionTitle, "/").concat(v.language),
        label: "".concat(sefaria._v({
          he: v.versionTitleInHebrew ? v.versionTitleInHebrew : v.versionTitle,
          en: v.versionTitle
        }), " (").concat(sefaria._(sefaria.translateISOLanguageCode(v.actualLanguage)), ")")
      };
    }).concat(
    // add merged versions for both primary langs "en" and "he" where applicable. (not yet possible for individual actual languages)
    versions.map(function (v) {
      return v.language;
    }).unique().map(function (lang) {
      return {
        value: "merged/".concat(lang),
        label: "".concat(sefaria._("Merged Version", "DownloadVersions"), " (").concat(sefaria._(sefaria.translateISOLanguageCode(lang)), ")")
      };
    })),
    placeholder: sefaria._("Select Version", "DownloadVersions"),
    onChange: handleInputChange
  }), /*#__PURE__*/external_react_default().createElement(Dropdown, {
    name: "dlVersionFormat",
    options: [{
      value: "txt",
      label: sefaria._("Text (with Tags)", "DownloadVersions")
    }, {
      value: "plain.txt",
      label: sefaria._("Text (without Tags)", "DownloadVersions")
    }, {
      value: "csv",
      label: "CSV"
    }, {
      value: "json",
      label: "JSON"
    }],
    placeholder: sefaria._("Select Format", "DownloadVersions"),
    onChange: handleInputChange
  }), /*#__PURE__*/external_react_default().createElement("a", {
    className: "button fillWidth".concat(isReady ? "" : " disabled"),
    onClick: handleClick,
    href: versionDlLink(),
    download: true
  }, sefaria._("Download"))));
};

;// CONCATENATED MODULE: ../static/js/Footer.jsx
function Footer_typeof(obj) { "@babel/helpers - typeof"; return Footer_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, Footer_typeof(obj); }
function Footer_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function Footer_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, Footer_toPropertyKey(descriptor.key), descriptor); } }
function Footer_createClass(Constructor, protoProps, staticProps) { if (protoProps) Footer_defineProperties(Constructor.prototype, protoProps); if (staticProps) Footer_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function Footer_toPropertyKey(arg) { var key = Footer_toPrimitive(arg, "string"); return Footer_typeof(key) === "symbol" ? key : String(key); }
function Footer_toPrimitive(input, hint) { if (Footer_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (Footer_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }
function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }
function _possibleConstructorReturn(self, call) { if (call && (Footer_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return _assertThisInitialized(self); }
function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }






var Section = function Section(_ref) {
  var en = _ref.en,
    he = _ref.he,
    children = _ref.children;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "header"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: en,
      he: he
    }
  })), children);
};
var Link = function Link(_ref2) {
  var href = _ref2.href,
    en = _ref2.en,
    he = _ref2.he,
    blank = _ref2.blank;
  return /*#__PURE__*/external_react_default().createElement("a", {
    href: href,
    target: blank ? "_blank" : "_self"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: en,
      he: he
    }
  }));
};
var Footer = /*#__PURE__*/function (_Component) {
  _inherits(Footer, _Component);
  var _super = _createSuper(Footer);
  function Footer(props) {
    var _this;
    Footer_classCallCheck(this, Footer);
    _this = _super.call(this, props);
    _this.state = {};
    return _this;
  }
  Footer_createClass(Footer, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.setState({
        isClient: true
      });
    }
  }, {
    key: "trackLanguageClick",
    value: function trackLanguageClick(language) {
      sefaria.track.setInterfaceLanguage('interface language footer', language);
    }
  }, {
    key: "render",
    value: function render() {
      if (!sefaria._siteSettings.TORAH_SPECIFIC) {
        return null;
      }
      var fbURL = sefaria.interfaceLang == "hebrew" ? "https://www.facebook.com/sefaria.org.il" : "https://www.facebook.com/sefaria.org";
      var blgURL = sefaria.interfaceLang == "hebrew" ? "https://blog.sefaria.org.il/" : "https://blog.sefaria.org/";
      var next = this.state.isClient ? encodeURIComponent(sefaria.util.currentPath()) : "/"; //try to make sure that a server render of this does not get some weird data in the url that then gets cached
      return /*#__PURE__*/external_react_default().createElement("footer", {
        id: "footer",
        className: "static sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        id: "footerInner"
      }, /*#__PURE__*/external_react_default().createElement(Section, {
        en: "About",
        he: "\u05D0\u05D5\u05D3\u05D5\u05EA"
      }, /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/about",
        en: "What is Sefaria?",
        he: "\u05DE\u05D4\u05D9 \u05E1\u05E4\u05E8\u05D9\u05D0"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/help",
        en: "Help",
        he: "\u05E2\u05D6\u05E8\u05D4"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/team",
        en: "Team",
        he: "\u05E6\u05D5\u05D5\u05EA"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/testimonials",
        en: "Testimonials",
        he: "\u05D7\u05D5\u05D5\u05EA \u05D3\u05E2\u05EA"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/metrics",
        en: "Metrics",
        he: "\u05DE\u05D3\u05D3\u05D9\u05DD"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/annualreport/2022",
        en: "Annual Report",
        he: "\u05D3\u05D5\"\u05D7 \u05E9\u05E0\u05EA\u05D9"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/terms",
        en: "Terms of Use",
        he: "\u05EA\u05E0\u05D0\u05D9 \u05E9\u05D9\u05DE\u05D5\u05E9"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/privacy-policy",
        en: "Privacy Policy",
        he: "\u05DE\u05D3\u05D9\u05E0\u05D9\u05D5\u05EA \u05E4\u05E8\u05D8\u05D9\u05D5\u05EA"
      })), /*#__PURE__*/external_react_default().createElement(Section, {
        en: "Tools",
        he: "\u05DB\u05DC\u05D9\u05DD"
      }, /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/educators",
        en: "Teach with Sefaria",
        he: "\u05DE\u05DC\u05DE\u05D3\u05D9\u05DD \u05E2\u05DD \u05E1\u05E4\u05E8\u05D9\u05D0"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/calendars",
        en: "Learning Schedules",
        he: "\u05DC\u05D5\u05D7 \u05DC\u05D9\u05DE\u05D5\u05D3 \u05D9\u05D5\u05DE\u05D9"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/sheets",
        en: "Source Sheets",
        he: "\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/visualizations",
        en: "Visualizations",
        he: "\u05EA\u05E8\u05E9\u05D9\u05DE\u05D9\u05DD \u05D2\u05E8\u05E4\u05D9\u05D9\u05DD"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/mobile",
        en: "Mobile Apps",
        he: "\u05E1\u05E4\u05E8\u05D9\u05D0 \u05D1\u05E0\u05D9\u05D9\u05D3"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/daf-yomi",
        en: "Daf Yomi",
        he: "\u05D3\u05E3 \u05D9\u05D5\u05DE\u05D9"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/torah-tab",
        en: "Torah Tab",
        he: "\u05EA\u05D5\u05E8\u05D4 \u05D8\u05D0\u05D1"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/people",
        en: "Authors",
        he: "\u05DE\u05D7\u05D1\u05E8\u05D9\u05DD"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/collections",
        en: "Collections",
        he: "\u05D0\u05E1\u05D5\u05E4\u05D5\u05EA"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/updates",
        en: "New Additions",
        he: "\u05E2\u05D3\u05DB\u05D5\u05E0\u05D9\u05DD"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/remote-learning",
        en: "Remote Learning",
        he: "\u05DC\u05DE\u05D9\u05D3\u05D4 \u05DE\u05E8\u05D7\u05D5\u05E7"
      })), /*#__PURE__*/external_react_default().createElement(Section, {
        en: "Developers",
        he: "\u05DE\u05E4\u05EA\u05D7\u05D9\u05DD"
      }, /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/developers",
        en: "Get Involved",
        he: "\u05D4\u05E6\u05D8\u05E8\u05E4\u05D5 \u05D0\u05DC\u05D9\u05E0\u05D5",
        blank: true
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/developers#api",
        en: "API Docs",
        he: "\u05DE\u05E1\u05DE\u05DB\u05D9 API",
        blank: true
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "https://github.com/Sefaria/Sefaria-Project",
        en: "Fork us on GitHub",
        he: "Github",
        blank: true
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "https://github.com/Sefaria/Sefaria-Export",
        en: "Download our Data",
        he: "\u05D1\u05E1\u05D9\u05E1 \u05E0\u05EA\u05D5\u05E0\u05D9\u05DD",
        blank: true
      })), /*#__PURE__*/external_react_default().createElement(Section, {
        en: "Join Us",
        he: "\u05D4\u05E6\u05D8\u05E8\u05E4\u05D5 \u05D0\u05DC\u05D9\u05E0\u05D5"
      }, /*#__PURE__*/external_react_default().createElement(DonateLink, {
        source: "Footer"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: {
          en: "Donate",
          he: "תרומות"
        }
      })), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/ways-to-give",
        en: "Ways to Give",
        he: "\u05D0\u05E4\u05E9\u05E8\u05D5\u05D9\u05D5\u05EA \u05EA\u05E8\u05D5\u05DE\u05D4"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/supporters",
        en: "Supporters",
        he: "\u05EA\u05D5\u05DE\u05DB\u05D9\u05DD"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "/jobs",
        en: "Jobs",
        he: "\u05D3\u05E8\u05D5\u05E9\u05D9\u05DD"
      }), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "https://store.sefaria.org",
        en: "Shop",
        he: "\u05D7\u05E0\u05D5\u05EA"
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "section last connect"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "header connect"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Connect")), /*#__PURE__*/external_react_default().createElement(NewsletterSignUpForm, {
        contextName: "Footer"
      }), /*#__PURE__*/external_react_default().createElement(LikeFollowButtons, null), /*#__PURE__*/external_react_default().createElement("div", {
        className: "socialLinks"
      }, /*#__PURE__*/external_react_default().createElement(Link, {
        href: fbURL,
        en: "Facebook",
        he: "\u05E4\u05D9\u05D9\u05E1\u05D1\u05D5\u05E7",
        blank: true
      }), "\u2022", /*#__PURE__*/external_react_default().createElement(Link, {
        href: "https://twitter.com/SefariaProject",
        en: "Twitter",
        he: "\u05D8\u05D5\u05D5\u05D9\u05D8\u05E8"
      }), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "https://www.youtube.com/user/SefariaProject",
        en: "YouTube",
        he: "\u05D9\u05D5\u05D8\u05D9\u05D5\u05D1"
      }), "\u2022", /*#__PURE__*/external_react_default().createElement(Link, {
        href: blgURL,
        en: "Blog",
        he: "\u05D1\u05DC\u05D5\u05D2",
        blank: true
      }), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement(Link, {
        href: "https://www.instagram.com/sefariaproject/",
        en: "Instagram",
        he: "\u05D0\u05D9\u05E0\u05E1\u05D8\u05D2\u05E8\u05DD"
      }), "\u2022", /*#__PURE__*/external_react_default().createElement(Link, {
        href: "mailto:hello@sefaria.org",
        en: "Email",
        he: "\u05D3\u05D5\u05D0\"\u05DC"
      })), /*#__PURE__*/external_react_default().createElement("div", {
        id: "siteLanguageToggle"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        id: "siteLanguageToggleLabel"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Site Language")), /*#__PURE__*/external_react_default().createElement("a", {
        href: "/interface/english?next=" + next,
        id: "siteLanguageEnglish",
        onClick: this.trackLanguageClick.bind(null, "English")
      }, "English"), "|", /*#__PURE__*/external_react_default().createElement("a", {
        href: "/interface/hebrew?next=" + next,
        id: "siteLanguageHebrew",
        onClick: this.trackLanguageClick.bind(null, "Hebrew")
      }, "\u05E2\u05D1\u05E8\u05D9\u05EA")))));
    }
  }]);
  return Footer;
}((external_react_class_default()));
var LikeFollowButtons = /*#__PURE__*/function (_Component2) {
  _inherits(LikeFollowButtons, _Component2);
  var _super2 = _createSuper(LikeFollowButtons);
  function LikeFollowButtons() {
    Footer_classCallCheck(this, LikeFollowButtons);
    return _super2.apply(this, arguments);
  }
  Footer_createClass(LikeFollowButtons, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.loadFacebook();
      this.loadTwitter();
    }
  }, {
    key: "loadFacebook",
    value: function loadFacebook() {
      if (typeof FB !== "undefined") {
        FB.XFBML.parse();
      } else {
        (function (d, s, id) {
          var js,
            fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s);
          js.id = id;
          js.src = sefaria.interfaceLang == "hebrew" ? "https://connect.facebook.net/he_IL/sdk.js#xfbml=1&version=v2.10&appId=206308089417064" : "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.10&appId=206308089417064";
          fjs.parentNode.insertBefore(js, fjs);
        })(document, 'script', 'facebook-jssdk');
      }
    }
  }, {
    key: "loadTwitter",
    value: function loadTwitter() {
      if (typeof twttr !== "undefined") {
        if ("widgets" in twttr) {
          twttr.widgets.load();
        }
      } else {
        window.twttr = function (d, s, id) {
          var js,
            fjs = d.getElementsByTagName(s)[0],
            t = window.twttr || {};
          if (d.getElementById(id)) return t;
          js = d.createElement(s);
          js.id = id;
          js.src = "https://platform.twitter.com/widgets.js";
          fjs.parentNode.insertBefore(js, fjs);
          t._e = [];
          t.ready = function (f) {
            t._e.push(f);
          };
          return t;
        }(document, "script", "twitter-wjs");
      }
    }
  }, {
    key: "render",
    value: function render() {
      var fbURL = sefaria.interfaceLang == "hebrew" ? "https://www.facebook.com/sefaria.org.il" : "https://www.facebook.com/sefaria.org";
      var lang = sefaria.interfaceLang.substring(0, 2);
      return /*#__PURE__*/external_react_default().createElement("div", {
        id: "socialButtons"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        id: "facebookButton"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "fb-like",
        "data-href": fbURL,
        "data-layout": "button",
        "data-action": "like",
        "data-size": "small",
        "data-show-faces": "false",
        "data-share": "true"
      })), /*#__PURE__*/external_react_default().createElement("div", {
        id: "twitterButton"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        className: "twitter-follow-button",
        href: "https://twitter.com/SefariaProject",
        "data-show-screen-name": "false",
        "data-show-count": "false",
        "data-lang": lang
      })));
    }
  }]);
  return LikeFollowButtons;
}((external_react_class_default()));
/* harmony default export */ const js_Footer = (Footer);
;// CONCATENATED MODULE: ../static/js/TopicEditor.jsx
function TopicEditor_typeof(obj) { "@babel/helpers - typeof"; return TopicEditor_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, TopicEditor_typeof(obj); }
function TopicEditor_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ TopicEditor_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == TopicEditor_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function TopicEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function TopicEditor_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { TopicEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { TopicEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function TopicEditor_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function TopicEditor_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? TopicEditor_ownKeys(Object(source), !0).forEach(function (key) { TopicEditor_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : TopicEditor_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function TopicEditor_defineProperty(obj, key, value) { key = TopicEditor_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function TopicEditor_toPropertyKey(arg) { var key = TopicEditor_toPrimitive(arg, "string"); return TopicEditor_typeof(key) === "symbol" ? key : String(key); }
function TopicEditor_toPrimitive(input, hint) { if (TopicEditor_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (TopicEditor_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function TopicEditor_slicedToArray(arr, i) { return TopicEditor_arrayWithHoles(arr) || TopicEditor_iterableToArrayLimit(arr, i) || TopicEditor_unsupportedIterableToArray(arr, i) || TopicEditor_nonIterableRest(); }
function TopicEditor_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function TopicEditor_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return TopicEditor_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TopicEditor_arrayLikeToArray(o, minLen); }
function TopicEditor_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function TopicEditor_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function TopicEditor_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }






var TopicEditor = function TopicEditor(_ref) {
  var _origData$origDesc, _origData$origDesc2, _origData$origCategor, _origData$origCategor2;
  var origData = _ref.origData,
    onCreateSuccess = _ref.onCreateSuccess,
    close = _ref.close,
    origWasCat = _ref.origWasCat;
  var _useState = (0,external_react_.useState)(TopicEditor_objectSpread(TopicEditor_objectSpread({}, origData), {}, {
      catSlug: origData.origCategorySlug || "",
      enTitle: origData.origEn,
      heTitle: origData.origHe || "",
      heDescription: (origData === null || origData === void 0 ? void 0 : (_origData$origDesc = origData.origDesc) === null || _origData$origDesc === void 0 ? void 0 : _origData$origDesc.he) || "",
      enDescription: (origData === null || origData === void 0 ? void 0 : (_origData$origDesc2 = origData.origDesc) === null || _origData$origDesc2 === void 0 ? void 0 : _origData$origDesc2.en) || "",
      enCategoryDescription: origData === null || origData === void 0 ? void 0 : (_origData$origCategor = origData.origCategoryDesc) === null || _origData$origCategor === void 0 ? void 0 : _origData$origCategor.en,
      heCategoryDescription: origData === null || origData === void 0 ? void 0 : (_origData$origCategor2 = origData.origCategoryDesc) === null || _origData$origCategor2 === void 0 ? void 0 : _origData$origCategor2.he
    })),
    _useState2 = TopicEditor_slicedToArray(_useState, 2),
    data = _useState2[0],
    setData = _useState2[1];
  var isNew = !('origSlug' in origData);
  var _useState3 = (0,external_react_.useState)(false),
    _useState4 = TopicEditor_slicedToArray(_useState3, 2),
    savingStatus = _useState4[0],
    setSavingStatus = _useState4[1];
  var _useState5 = (0,external_react_.useState)(origWasCat),
    _useState6 = TopicEditor_slicedToArray(_useState5, 2),
    isCategory = _useState6[0],
    setIsCategory = _useState6[1]; // initialize to True if the topic originally was a category
  // isCategory determines whether user can edit categoryDescriptions of topic
  var subtopics = sefaria.topicTocPage(origData.origSlug);
  var _useState7 = (0,external_react_.useState)((subtopics === null || subtopics === void 0 ? void 0 : subtopics.sort(sefaria.sortTopicsCompareFn).filter(function (x) {
      return x.slug !== origData.origSlug;
    }) // dont include topics that are self-linked
    ) || []),
    _useState8 = TopicEditor_slicedToArray(_useState7, 2),
    sortedSubtopics = _useState8[0],
    setSortedSubtopics = _useState8[1];
  var _useState9 = (0,external_react_.useState)(false),
    _useState10 = TopicEditor_slicedToArray(_useState9, 2),
    isChanged = _useState10[0],
    setIsChanged = _useState10[1];
  var toggle = function toggle() {
    setSavingStatus(function (savingStatus) {
      return !savingStatus;
    });
  };
  var handleCatChange = function handleCatChange(e) {
    data.catSlug = e.target.value;
    //logic is: if it starts out originally a category, isCategory should always be true, otherwise, it should depend solely on 'Main Menu'
    var newIsCategory = origWasCat || e.target.value === sefaria._("Main Menu");
    setIsCategory(newIsCategory);
    setData(data);
  };
  var slugsToTitles = sefaria.slugsToTitles();
  var specialCases = {
    "": {
      "en": "Choose a Parent Topic",
      "he": sefaria.translation('he', "Choose a Parent Topic")
    },
    "Main Menu": {
      "en": "Main Menu",
      "he": sefaria.translation('he', "Main Menu")
    }
  };
  slugsToTitles = Object.assign(specialCases, slugsToTitles);
  var _useState11 = (0,external_react_.useState)( /*#__PURE__*/external_react_default().createElement("div", {
      className: "section"
    }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Parent Topic")), /*#__PURE__*/external_react_default().createElement("div", {
      id: "categoryChooserMenu"
    }, /*#__PURE__*/external_react_default().createElement("select", {
      key: "topicCats",
      id: "topicCats",
      onChange: handleCatChange
    }, Object.keys(slugsToTitles).map(function (tempSlug, i) {
      var tempTitle = sefaria.interfaceLang === 'english' ? slugsToTitles[tempSlug].en : slugsToTitles[tempSlug].he;
      return /*#__PURE__*/external_react_default().createElement("option", {
        key: i,
        value: tempSlug,
        selected: data.catSlug === tempSlug
      }, tempTitle);
    }))))),
    _useState12 = TopicEditor_slicedToArray(_useState11, 2),
    catMenu = _useState12[0],
    setCatMenu = _useState12[1];
  var updateData = function updateData(newData) {
    setIsChanged(true);
    setData(newData);
  };
  var validate = /*#__PURE__*/function () {
    var _ref2 = TopicEditor_asyncToGenerator( /*#__PURE__*/TopicEditor_regeneratorRuntime().mark(function _callee() {
      return TopicEditor_regeneratorRuntime().wrap(function _callee$(_context) {
        while (1) switch (_context.prev = _context.next) {
          case 0:
            if (isChanged) {
              _context.next = 3;
              break;
            }
            alert("You haven't changed any of the fields.");
            return _context.abrupt("return", false);
          case 3:
            if (!(data.catSlug === "")) {
              _context.next = 6;
              break;
            }
            alert(sefaria._("Please choose a category."));
            return _context.abrupt("return", false);
          case 6:
            if (!(data.enTitle.length === 0)) {
              _context.next = 9;
              break;
            }
            alert(sefaria._("Title must be provided."));
            return _context.abrupt("return", false);
          case 9:
            if (!(sortedSubtopics.length > 0 && !isNew)) {
              _context.next = 12;
              break;
            }
            _context.next = 12;
            return saveReorderedSubtopics();
          case 12:
            saveTopic();
          case 13:
          case "end":
            return _context.stop();
        }
      }, _callee);
    }));
    return function validate() {
      return _ref2.apply(this, arguments);
    };
  }();
  var saveReorderedSubtopics = function saveReorderedSubtopics() {
    var url = "/api/topic/reorder";
    var postCategoryData = {
      topics: sortedSubtopics
    };
    requestWithCallBack({
      url: url,
      data: postCategoryData,
      setSavingStatus: setSavingStatus,
      redirect: function redirect() {
        return window.location.href = "/topics";
      }
    });
  };
  var saveTopic = function saveTopic() {
    toggle();
    var url = "";
    var postData = TopicEditor_objectSpread(TopicEditor_objectSpread({}, data), {}, {
      "description": {
        "en": data.enDescription,
        "he": data.heDescription
      },
      "title": data.enTitle,
      "heTitle": data.heTitle
    });
    if (isCategory) {
      postData = TopicEditor_objectSpread(TopicEditor_objectSpread({}, postData), {}, {
        "catDescription": {
          "en": data.enCategoryDescription,
          "he": data.heCategoryDescription
        }
      });
    }
    postData.category = data.catSlug;
    if (isNew) {
      url = "/api/topic/new";
    } else {
      url = "/api/topics/".concat(data.origSlug);
      postData = TopicEditor_objectSpread(TopicEditor_objectSpread({}, postData), {}, {
        origCategory: data.origCategorySlug,
        origDescription: data.origDesc,
        origSlug: data.origSlug
      });
      if (isCategory) {
        postData.origCatDescription = data.origCategoryDesc;
      }
    }
    var postJSON = JSON.stringify(postData);
    sefariaJquery.post(url, {
      "json": postJSON
    }, function (result) {
      if (result.error) {
        toggle();
        alert(result.error);
      } else {
        var newSlug = result.slug;
        onCreateSuccess(newSlug);
      }
    }).fail(function (xhr, status, errorThrown) {
      alert("Unfortunately, there may have been an error saving this topic information: " + errorThrown.toString());
    });
  };
  var deleteObj = function deleteObj() {
    var url = "/api/topic/delete/".concat(data.origSlug);
    requestWithCallBack({
      url: url,
      type: "DELETE",
      redirect: function redirect() {
        return window.location.href = "/topics";
      }
    });
  };
  var items = ["Title", "Hebrew Title", "Category Menu", "English Description", "Hebrew Description"];
  if (isCategory) {
    items.push("English Short Description");
    items.push("Hebrew Short Description");
  }
  return /*#__PURE__*/external_react_default().createElement(AdminEditor, {
    title: "Topic Editor",
    close: close,
    catMenu: catMenu,
    data: data,
    savingStatus: savingStatus,
    validate: validate,
    deleteObj: deleteObj,
    updateData: updateData,
    isNew: isNew,
    items: items,
    extras: [isNew ? null : /*#__PURE__*/external_react_default().createElement(Reorder, {
      subcategoriesAndBooks: sortedSubtopics,
      updateOrder: setSortedSubtopics,
      displayType: "topics"
    })]
  });
};

;// CONCATENATED MODULE: ../static/js/Story.jsx






// Much of Stories was removed November 2022.
// It remains because some of the Components are re-used in other areas of the site.

var sheetPropType = external_prop_types_default().shape({
  publisher_id: (external_prop_types_default()).number,
  publisher_name: (external_prop_types_default()).string,
  publisher_url: (external_prop_types_default()).string,
  publisher_image: (external_prop_types_default()).string,
  publisher_position: (external_prop_types_default()).string,
  publisher_organization: (external_prop_types_default()).string,
  publisher_followed: (external_prop_types_default()).bool,
  sheet_id: external_prop_types_default().oneOfType([(external_prop_types_default()).number, (external_prop_types_default()).string]),
  sheet_title: (external_prop_types_default()).string,
  sheet_summary: (external_prop_types_default()).string
});
var textPropType = external_prop_types_default().shape({
  ref: (external_prop_types_default()).string.isRequired,
  heRef: (external_prop_types_default()).string.isRequired,
  en: (external_prop_types_default()).string.isRequired,
  he: (external_prop_types_default()).string.isRequired
});
var bilingualPropType = external_prop_types_default().shape({
  en: (external_prop_types_default()).string.isRequired,
  he: (external_prop_types_default()).string.isRequired
});
var SheetListStory = function SheetListStory(props) {
  var lead = props.data.lead || {
    en: "Sheets",
    he: "גליונות"
  };
  return /*#__PURE__*/external_react_default().createElement(StoryFrame, {
    cls: "sheetListStory"
  }, /*#__PURE__*/external_react_default().createElement(StoryTypeBlock, {
    en: lead.en,
    he: lead.he
  }), /*#__PURE__*/external_react_default().createElement(StoryTitleBlock, {
    en: props.data.title.en,
    he: props.data.title.he
  }), /*#__PURE__*/external_react_default().createElement(StorySheetList, {
    sheets: props.data.sheets,
    toggleSignUpModal: props.toggleSignUpModal
  }));
};
SheetListStory.propTypes = {
  storyForm: (external_prop_types_default()).string,
  timestamp: (external_prop_types_default()).number,
  is_shared: (external_prop_types_default()).bool,
  data: external_prop_types_default().shape({
    lead: bilingualPropType,
    title: bilingualPropType.isRequired,
    sheets: external_prop_types_default().arrayOf(sheetPropType).isRequired
  }),
  interfaceLang: (external_prop_types_default()).string,
  toggleSignUpModal: (external_prop_types_default()).func
};

/****************************
*                             *
*           Pieces            *
*                             *
*****************************/

// todo: if we don't want the monopoly card effect, this component isn't needed.    // style={{"borderColor": cardColor || "#18345D"}}>
var StoryFrame = function StoryFrame(_ref) {
  var cls = _ref.cls,
    cardColor = _ref.cardColor,
    children = _ref.children;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: 'story ' + cls
  }, children);
};
StoryFrame.propTypes = {
  cls: (external_prop_types_default()).string,
  // Story type as class name
  cardColor: (external_prop_types_default()).string
};
var StoryTypeBlock = function StoryTypeBlock(_ref2) {
  var en = _ref2.en,
    he = _ref2.he;
  return /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    en: en,
    he: he,
    classes: "storyTypeBlock sectionTitleText"
  });
};
var StoryTitleBlock = function StoryTitleBlock(_ref3) {
  var url = _ref3.url,
    he = _ref3.he,
    en = _ref3.en,
    children = _ref3.children;
  var SBlock = url ? SimpleLinkedBlock : SimpleInterfaceBlock;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "storyTitleBlock"
  }, /*#__PURE__*/external_react_default().createElement(SBlock, {
    classes: "storyTitle",
    url: url,
    he: he,
    en: en
  }), children);
};
var StoryBodyBlock = function StoryBodyBlock(_ref4) {
  var children = _ref4.children;
  return /*#__PURE__*/external_react_default().createElement(SimpleContentBlock, {
    classes: "storyBody"
  }, children);
};
var StoryTextListItem = function StoryTextListItem(_ref5) {
  var text = _ref5.text,
    toggleSignUpModal = _ref5.toggleSignUpModal;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "storyTextListItem"
  }, /*#__PURE__*/external_react_default().createElement(ColorBarBox, {
    tref: text.ref
  }, /*#__PURE__*/external_react_default().createElement(StoryBodyBlock, null, /*#__PURE__*/external_react_default().createElement(ContentText, {
    html: {
      en: text.en,
      he: text.he
    }
  }))), /*#__PURE__*/external_react_default().createElement(SaveLine, {
    dref: text.ref,
    toggleSignUpModal: toggleSignUpModal
  }, /*#__PURE__*/external_react_default().createElement(SimpleLinkedBlock, {
    url: "/" + sefaria.normRef(text.ref),
    en: text.ref,
    he: text.heRef,
    classes: "contentText citationLine"
  })));
};
StoryTextListItem.propTypes = {
  text: textPropType.isRequired
};
var StorySheetList = function StorySheetList(_ref6) {
  var sheets = _ref6.sheets,
    toggleSignUpModal = _ref6.toggleSignUpModal,
    compact = _ref6.compact,
    cozy = _ref6.cozy,
    smallfonts = _ref6.smallfonts;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "storySheetList"
  }, sheets.map(function (sheet, i) {
    return /*#__PURE__*/external_react_default().createElement(SheetBlock, {
      sheet: sheet,
      key: i,
      smallfonts: smallfonts,
      compact: compact,
      cozy: cozy,
      toggleSignUpModal: toggleSignUpModal
    });
  }));
};
StorySheetList.propTypes = {
  sheets: external_prop_types_default().arrayOf(sheetPropType).isRequired,
  toggleSignUpModal: (external_prop_types_default()).func
};
var IntroducedTextPassage = function IntroducedTextPassage(_ref7) {
  var _text$descriptions, _text$descriptions$en, _text$descriptions2, _text$descriptions2$h, _text$descriptions3, _text$descriptions3$e, _text$descriptions4, _text$descriptions4$h;
  var text = _ref7.text,
    topic = _ref7.topic,
    afterSave = _ref7.afterSave,
    toggleSignUpModal = _ref7.toggleSignUpModal,
    _ref7$bodyTextIsLink = _ref7.bodyTextIsLink,
    bodyTextIsLink = _ref7$bodyTextIsLink === void 0 ? false : _ref7$bodyTextIsLink;
  if (!text.ref) {
    return null;
  }
  var versions = text.versions || {};
  var params = sefaria.util.getUrlVersionsParams(versions);
  var url = "/" + sefaria.normRef(text.ref) + (params ? "?" + params : "");
  var heOnly = !text.en;
  var enOnly = !text.he;
  var overrideLanguage = enOnly || heOnly ? heOnly ? "hebrew" : "english" : null;
  var innerContent = /*#__PURE__*/external_react_default().createElement(ContentText, {
    html: {
      en: text.en,
      he: text.he
    },
    overrideLanguage: overrideLanguage,
    bilingualOrder: ["he", "en"]
  });
  var content = bodyTextIsLink ? /*#__PURE__*/external_react_default().createElement("a", {
    href: url,
    style: {
      textDecoration: 'none'
    }
  }, innerContent) : innerContent;
  return /*#__PURE__*/external_react_default().createElement(StoryFrame, {
    cls: "introducedTextPassageStory"
  }, /*#__PURE__*/external_react_default().createElement(CategoryHeader, {
    type: "sources",
    data: [topic, text],
    buttonsToDisplay: ["edit"]
  }, /*#__PURE__*/external_react_default().createElement(StoryTitleBlock, {
    en: (_text$descriptions = text.descriptions) === null || _text$descriptions === void 0 ? void 0 : (_text$descriptions$en = _text$descriptions.en) === null || _text$descriptions$en === void 0 ? void 0 : _text$descriptions$en.title,
    he: (_text$descriptions2 = text.descriptions) === null || _text$descriptions2 === void 0 ? void 0 : (_text$descriptions2$h = _text$descriptions2.he) === null || _text$descriptions2$h === void 0 ? void 0 : _text$descriptions2$h.title
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "systemText learningPrompt"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      "en": (_text$descriptions3 = text.descriptions) === null || _text$descriptions3 === void 0 ? void 0 : (_text$descriptions3$e = _text$descriptions3.en) === null || _text$descriptions3$e === void 0 ? void 0 : _text$descriptions3$e.prompt,
      "he": (_text$descriptions4 = text.descriptions) === null || _text$descriptions4 === void 0 ? void 0 : (_text$descriptions4$h = _text$descriptions4.he) === null || _text$descriptions4$h === void 0 ? void 0 : _text$descriptions4$h.prompt
    }
  })), /*#__PURE__*/external_react_default().createElement(SaveLine, {
    dref: text.ref,
    versions: versions,
    toggleSignUpModal: toggleSignUpModal,
    classes: "storyTitleWrapper",
    afterChildren: afterSave || null
  }, /*#__PURE__*/external_react_default().createElement(SimpleLinkedBlock, {
    classes: "contentText subHeading",
    en: text.ref,
    he: text.heRef,
    url: url
  })), /*#__PURE__*/external_react_default().createElement(ColorBarBox, {
    tref: text.ref
  }, /*#__PURE__*/external_react_default().createElement(StoryBodyBlock, null, content)));
};
IntroducedTextPassage.propTypes = {
  intros: (external_prop_types_default()).object,
  text: textPropType,
  afterSave: (external_prop_types_default()).object,
  toggleSignUpModal: (external_prop_types_default()).func
};
var TextPassage = function TextPassage(_ref8) {
  var text = _ref8.text,
    topic = _ref8.topic,
    afterSave = _ref8.afterSave,
    toggleSignUpModal = _ref8.toggleSignUpModal,
    _ref8$bodyTextIsLink = _ref8.bodyTextIsLink,
    bodyTextIsLink = _ref8$bodyTextIsLink === void 0 ? false : _ref8$bodyTextIsLink;
  if (!text.ref) {
    return null;
  }
  var versions = text.versions || {};
  var params = sefaria.util.getUrlVersionsParams(versions);
  var url = "/" + sefaria.normRef(text.ref) + (params ? "?" + params : "");
  var heOnly = !text.en;
  var enOnly = !text.he;
  var overrideLanguage = enOnly || heOnly ? heOnly ? "hebrew" : "english" : null;
  var innerContent = /*#__PURE__*/external_react_default().createElement(ContentText, {
    html: {
      en: text.en,
      he: text.he
    },
    overrideLanguage: overrideLanguage,
    bilingualOrder: ["he", "en"]
  });
  var content = bodyTextIsLink ? /*#__PURE__*/external_react_default().createElement("a", {
    href: url,
    style: {
      textDecoration: 'none'
    }
  }, innerContent) : innerContent;
  return /*#__PURE__*/external_react_default().createElement(StoryFrame, {
    cls: "textPassageStory"
  }, /*#__PURE__*/external_react_default().createElement(CategoryHeader, {
    type: "sources",
    data: [topic, text],
    buttonsToDisplay: ["edit"]
  }, /*#__PURE__*/external_react_default().createElement(SaveLine, {
    dref: text.ref,
    versions: versions,
    toggleSignUpModal: toggleSignUpModal,
    classes: "storyTitleWrapper",
    afterChildren: afterSave || null
  }, /*#__PURE__*/external_react_default().createElement(StoryTitleBlock, {
    en: text.ref,
    he: text.heRef,
    url: url
  }))), /*#__PURE__*/external_react_default().createElement(ColorBarBox, {
    tref: text.ref
  }, /*#__PURE__*/external_react_default().createElement(StoryBodyBlock, null, content)));
};
TextPassage.propTypes = {
  text: textPropType,
  afterSave: (external_prop_types_default()).object,
  toggleSignUpModal: (external_prop_types_default()).func
};
var SheetBlock = function SheetBlock(_ref9) {
  var sheet = _ref9.sheet,
    compact = _ref9.compact,
    cozy = _ref9.cozy,
    smallfonts = _ref9.smallfonts,
    afterSave = _ref9.afterSave,
    toggleSignUpModal = _ref9.toggleSignUpModal;
  var historyObject = {
    ref: "Sheet " + sheet.sheet_id,
    sheet_title: sheet.sheet_title,
    sheet_owner: sheet.publisher_name,
    versions: {}
  };
  return /*#__PURE__*/external_react_default().createElement(StoryFrame, {
    cls: "storySheetListItem" + (smallfonts ? " small" : "")
  }, /*#__PURE__*/external_react_default().createElement(SaveLine, {
    historyObject: historyObject,
    afterChildren: afterSave || null,
    toggleSignUpModal: toggleSignUpModal
  }, /*#__PURE__*/external_react_default().createElement(SimpleLinkedBlock, {
    en: sheet.sheet_title,
    he: sheet.sheet_title,
    url: "/sheets/" + sheet.sheet_id,
    classes: "sheetTitle storyTitle"
  })), sheet.sheet_summary && !(compact || cozy) ? /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "storyBody",
    en: sheet.sheet_summary,
    he: sheet.sheet_summary
  }) : null, cozy ? null : /*#__PURE__*/external_react_default().createElement(ProfileListing, {
    uid: sheet.publisher_id,
    url: sheet.publisher_url,
    image: sheet.publisher_image,
    name: sheet.publisher_name,
    is_followed: sheet.publisher_followed,
    smallfonts: smallfonts,
    position: sheet.publisher_position,
    organization: sheet.publisher_organization,
    toggleSignUpModal: toggleSignUpModal
  }));
};
SheetBlock.propTypes = {
  sheet: sheetPropType.isRequired,
  afterSave: (external_prop_types_default()).object,
  toggleSignUpModal: (external_prop_types_default()).func
};
var SaveLine = function SaveLine(_ref10) {
  var classes = _ref10.classes,
    children = _ref10.children,
    historyObject = _ref10.historyObject,
    dref = _ref10.dref,
    versions = _ref10.versions,
    hideSave = _ref10.hideSave,
    afterChildren = _ref10.afterChildren,
    toggleSignUpModal = _ref10.toggleSignUpModal;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "saveLine " + (classes ? classes : "")
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "beforeSave"
  }, children), hideSave ? null : /*#__PURE__*/external_react_default().createElement(SaveButton, {
    tooltip: true,
    historyObject: historyObject || {
      ref: dref,
      versions: versions || {}
    },
    toggleSignUpModal: toggleSignUpModal
  }), afterChildren ? afterChildren : null);
};
SaveLine.propTypes = {
  historyObject: (external_prop_types_default()).object,
  // One or
  dref: (external_prop_types_default()).string,
  // the other
  toggleSignUpModal: (external_prop_types_default()).func,
  versions: (external_prop_types_default()).object,
  classes: (external_prop_types_default()).string,
  hideSave: (external_prop_types_default()).bool,
  afterChildren: (external_prop_types_default()).object
};

;// CONCATENATED MODULE: ../static/js/TopicPage.jsx
function TopicPage_typeof(obj) { "@babel/helpers - typeof"; return TopicPage_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, TopicPage_typeof(obj); }
function TopicPage_toConsumableArray(arr) { return TopicPage_arrayWithoutHoles(arr) || TopicPage_iterableToArray(arr) || TopicPage_unsupportedIterableToArray(arr) || TopicPage_nonIterableSpread(); }
function TopicPage_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function TopicPage_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function TopicPage_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return TopicPage_arrayLikeToArray(arr); }
function TopicPage_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ TopicPage_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == TopicPage_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function TopicPage_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function TopicPage_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? TopicPage_ownKeys(Object(source), !0).forEach(function (key) { TopicPage_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : TopicPage_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function TopicPage_defineProperty(obj, key, value) { key = TopicPage_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function TopicPage_toPropertyKey(arg) { var key = TopicPage_toPrimitive(arg, "string"); return TopicPage_typeof(key) === "symbol" ? key : String(key); }
function TopicPage_toPrimitive(input, hint) { if (TopicPage_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (TopicPage_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function TopicPage_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function TopicPage_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { TopicPage_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { TopicPage_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function TopicPage_extends() { TopicPage_extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return TopicPage_extends.apply(this, arguments); }
function TopicPage_slicedToArray(arr, i) { return TopicPage_arrayWithHoles(arr) || TopicPage_iterableToArrayLimit(arr, i) || TopicPage_unsupportedIterableToArray(arr, i) || TopicPage_nonIterableRest(); }
function TopicPage_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function TopicPage_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function TopicPage_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function TopicPage_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = TopicPage_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function TopicPage_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return TopicPage_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TopicPage_arrayLikeToArray(o, minLen); }
function TopicPage_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }













/*
*** Helper functions
*/

var norm_hebrew_ref = function norm_hebrew_ref(tref) {
  return tref.replace(/[׳״]/g, '');
};
var fetchBulkText = function fetchBulkText(translationLanguagePreference, inRefs) {
  return sefaria.getBulkText(inRefs.map(function (x) {
    return x.ref;
  }), true, 500, 600, translationLanguagePreference).then(function (outRefs) {
    var _iterator = TopicPage_createForOfIteratorHelper(inRefs),
      _step;
    try {
      for (_iterator.s(); !(_step = _iterator.n()).done;) {
        var tempRef = _step.value;
        // annotate outRefs with `order` and `dataSources` from `topicRefs`
        if (outRefs[tempRef.ref]) {
          outRefs[tempRef.ref].order = tempRef.order;
          outRefs[tempRef.ref].dataSources = tempRef.dataSources;
          if (tempRef.descriptions) {
            outRefs[tempRef.ref].descriptions = tempRef.descriptions;
          }
        }
      }
    } catch (err) {
      _iterator.e(err);
    } finally {
      _iterator.f();
    }
    return Object.entries(outRefs);
  });
};
var fetchBulkSheet = function fetchBulkSheet(inSheets) {
  return sefaria.getBulkSheets(inSheets.map(function (x) {
    return x.ref;
  })).then(function (outSheets) {
    var _iterator2 = TopicPage_createForOfIteratorHelper(inSheets),
      _step2;
    try {
      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
        var tempSheet = _step2.value;
        if (outSheets[tempSheet.ref]) {
          outSheets[tempSheet.ref].order = tempSheet.order;
        }
      }
    } catch (err) {
      _iterator2.e(err);
    } finally {
      _iterator2.f();
    }
    return Object.values(outSheets);
  });
};
var refFilter = function refFilter(currFilter, ref) {
  var n = function n(text) {
    return !!text ? text.toLowerCase() : '';
  };
  currFilter = n(currFilter);
  ref[1].categories = sefaria.refCategories(ref[1].ref).join(" ");
  for (var _i = 0, _arr = ['en', 'he', 'ref', 'categories']; _i < _arr.length; _i++) {
    var field = _arr[_i];
    if (n(ref[1][field]).indexOf(currFilter) > -1) {
      return true;
    }
  }
};
var sheetFilter = function sheetFilter(currFilter, sheet) {
  var n = function n(text) {
    return !!text ? text.toLowerCase() : '';
  };
  currFilter = n(currFilter);
  for (var _i2 = 0, _arr2 = ['sheet_title', 'publisher_name', 'publisher_position', 'publisher_organization']; _i2 < _arr2.length; _i2++) {
    var field = _arr2[_i2];
    if (n(sheet[field]).indexOf(currFilter) > -1) {
      return true;
    }
  }
};
var refSort = function refSort(currSortOption, a, b) {
  a = a[1];
  b = b[1];
  if (!a.order && !b.order) {
    return 0;
  }
  if (0 + !!a.order !== 0 + !!b.order) {
    return 0 + !!b.order - (0 + !!a.order);
  }
  if (currSortOption === 'Chronological') {
    if (a.order.comp_date === b.order.comp_date) {
      if (a.order.order_id < b.order.order_id) {
        return -1;
      }
      if (b.order.order_id < a.order.order_id) {
        return 1;
      }
      return 0;
    }
    return a.order.comp_date - b.order.comp_date;
  } else {
    var aAvailLangs = a.order.availableLangs;
    var bAvailLangs = b.order.availableLangs;
    if (sefaria.interfaceLang === 'english' && (a.order.curatedPrimacy.en > 0 || b.order.curatedPrimacy.en > 0)) {
      return b.order.curatedPrimacy.en - a.order.curatedPrimacy.en;
    } else if (sefaria.interfaceLang === 'hebrew' && (a.order.curatedPrimacy.he > 0 || b.order.curatedPrimacy.he > 0)) {
      return b.order.curatedPrimacy.he - a.order.curatedPrimacy.he;
    }
    if (sefaria.interfaceLang === 'english' && aAvailLangs.length !== bAvailLangs.length) {
      if (aAvailLangs.indexOf('en') > -1) {
        return -1;
      }
      if (bAvailLangs.indexOf('en') > -1) {
        return 1;
      }
      return 0;
    } else if (a.order.custom_order !== b.order.custom_order) {
      return b.order.custom_order - a.order.custom_order;
    } // custom_order, when present, should trump other data
    else if (a.order.pr !== b.order.pr) {
      return b.order.pr - a.order.pr;
    } else {
      return b.order.numDatasource * b.order.tfidf - a.order.numDatasource * a.order.tfidf;
    }
  }
};
var sheetSort = function sheetSort(currSortOption, a, b) {
  if (!a.order && !b.order) {
    return 0;
  }
  if (0 + !!a.order !== 0 + !!b.order) {
    return 0 + !!b.order - (0 + !!a.order);
  }
  var aTLangHe = 0 + (a.order.titleLanguage === 'hebrew');
  var bTLangHe = 0 + (b.order.titleLanguage === 'hebrew');
  var aLangHe = 0 + (a.order.language === 'hebrew');
  var bLangHe = 0 + (b.order.language === 'hebrew');
  if (sefaria.interfaceLang === 'hebrew' && (aTLangHe ^ bTLangHe || aLangHe ^ bLangHe)) {
    if (aTLangHe ^ bTLangHe && aLangHe ^ bLangHe) {
      return bTLangHe - aTLangHe;
    } // title lang takes precedence over content lang
    return bTLangHe + bLangHe - (aTLangHe + aLangHe);
  } else if (sefaria.interfaceLang === 'english' && (aTLangHe ^ bTLangHe || aLangHe ^ bLangHe)) {
    if (aTLangHe ^ bTLangHe && aLangHe ^ bLangHe) {
      return aTLangHe - bTLangHe;
    } // title lang takes precedence over content lang
    return aTLangHe + aLangHe - (bTLangHe + bLangHe);
  }
  if (currSortOption === 'Views') {
    return b.order.views - a.order.views;
  } else if (currSortOption === 'Newest') {
    if (b.order.dateCreated < a.order.dateCreated) {
      return -1;
    }
    if (a.order.dateCreated < b.order.dateCreated) {
      return 1;
    }
  } else {
    // relevance
    if (b.order.relevance === a.order.relevance) {
      return b.order.views - a.order.views;
    }
    return Math.log(b.order.views) * b.order.relevance - Math.log(a.order.views) * a.order.relevance;
  }
};
var refRenderWrapper = function refRenderWrapper(toggleSignUpModal, topicData, topicTestVersion) {
  return function (item) {
    var text = item[1];
    var topicTitle = topicData && topicData.primaryTitle;
    var langKey = sefaria.interfaceLang === 'english' ? 'en' : 'he';
    var dataSourceText = '';
    if (!!text.dataSources && Object.values(text.dataSources).length > 0) {
      dataSourceText = "".concat(sefaria._('This source is connected to '), "\"").concat(topicTitle && topicTitle[langKey], "\" ").concat(sefaria._('by'), " ").concat(Object.values(text.dataSources).map(function (d) {
        return d[langKey];
      }).join(' & '), ".");
    }
    var afterSave = /*#__PURE__*/external_react_default().createElement(ToolTipped, {
      altText: dataSourceText,
      classes: "saveButton tooltip-toggle three-dots-button"
    }, /*#__PURE__*/external_react_default().createElement("img", {
      src: "/static/img/three-dots.svg",
      alt: dataSourceText
    }));
    var hasPrompts = text.descriptions && text.descriptions[langKey] && text.descriptions[langKey].title;

    // When running a test, topicTestVersion is respected.
    // const Passage = (topicTestVersion && hasPrompts) ? IntroducedTextPassage : TextPassage;
    var Passage = hasPrompts ? IntroducedTextPassage : TextPassage;
    return /*#__PURE__*/external_react_default().createElement(Passage, {
      key: item[0],
      topic: topicData.slug,
      text: text,
      afterSave: afterSave,
      toggleSignUpModal: toggleSignUpModal,
      bodyTextIsLink: true
    });
  };
};
var sheetRenderWrapper = function sheetRenderWrapper(toggleSignUpModal) {
  return function (item) {
    return /*#__PURE__*/external_react_default().createElement(SheetBlock, {
      key: item.sheet_id,
      sheet: item,
      toggleSignUpModal: toggleSignUpModal
    });
  };
};

/*
*** Components
*/

var TopicCategory = function TopicCategory(_ref) {
  var topic = _ref.topic,
    topicTitle = _ref.topicTitle,
    setTopic = _ref.setTopic,
    setNavTopic = _ref.setNavTopic,
    compare = _ref.compare,
    initialWidth = _ref.initialWidth,
    openDisplaySettings = _ref.openDisplaySettings,
    openSearch = _ref.openSearch;
  var _useState = (0,external_react_.useState)(sefaria.getTopicFromCache(topic) || {
      primaryTitle: topicTitle
    }),
    _useState2 = TopicPage_slicedToArray(_useState, 2),
    topicData = _useState2[0],
    setTopicData = _useState2[1];
  var _useState3 = (0,external_react_.useState)(sefaria.topicTocPage(topic)),
    _useState4 = TopicPage_slicedToArray(_useState3, 2),
    subtopics = _useState4[0],
    setSubtopics = _useState4[1];
  (0,external_react_.useEffect)(function () {
    sefaria.getTopic(topic).then(setTopicData);
  }, [topic]);
  (0,external_react_.useEffect)(function () {
    setSubtopics(sefaria.topicTocPage(topic));
  }, [topic]);
  var topicBlocks = subtopics.filter(function (t) {
    return t.shouldDisplay !== false;
  }).sort(sefaria.sortTopicsCompareFn).map(function (t, i) {
    var slug = t.slug,
      children = t.children,
      description = t.description;
    var openTopic = function openTopic(e) {
      e.preventDefault();
      t.children ? setNavTopic(slug, {
        en: en,
        he: he
      }) : setTopic(slug, {
        en: en,
        he: he
      });
    };
    var en = t.en,
      he = t.he;
    en = en.replace(/^Parashat /, "");
    he = he.replace(/^פרשת /, "");
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "navBlock"
    }, /*#__PURE__*/external_react_default().createElement("a", {
      href: "/topics/".concat(children ? 'category/' : '').concat(slug),
      className: "navBlockTitle",
      onClick: openTopic,
      key: i
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: {
        en: en,
        he: he
      }
    })), description ? /*#__PURE__*/external_react_default().createElement("div", {
      className: "navBlockDescription clamped"
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      markdown: {
        en: description.en,
        he: description.he
      }
    })) : null);
  });
  var sidebarModules = [{
    type: "Promo"
  }, {
    type: "TrendingTopics"
  }, {
    type: "SponsorADay"
  }];
  if (topicData.description) {
    sidebarModules.unshift({
      type: "TitledText",
      props: {
        enTitle: "About",
        heTitle: sefaria._("About"),
        enText: topicData.description.en,
        heText: topicData.description.he
      }
    });
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerNavMenu noLangToggleInHebrew"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "content readerTocTopics"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sidebarLayout"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "contentInner"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "navTitle tight"
  }, /*#__PURE__*/external_react_default().createElement(CategoryHeader, {
    type: "topics",
    data: topicData
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: topicTitle.en,
      he: topicTitle.he
    }
  })))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerNavCategories"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    content: topicBlocks,
    initialWidth: initialWidth
  }))), /*#__PURE__*/external_react_default().createElement(NavSidebar, {
    modules: sidebarModules
  })), /*#__PURE__*/external_react_default().createElement(js_Footer, null)));
};
var TopicSponsorship = function TopicSponsorship(_ref2) {
  var topic_slug = _ref2.topic_slug;
  // TODO: Store this data somewhere intelligent
  var topic_sponsorship_map = {
    "parashat-lech-lecha": {
      "en": "Sponsored by The Rita J. & Stanley H. Kaplan Family Foundation in honor of Scott and Erica Belsky’s wedding anniversary.",
      "he": "נתרם על-ידי קרן משפחת ריטה ג’. וסטנלי ה. קפלן, לכבוד יום הנישואים של סקוט ואריקה בלסקי."
    },
    "parashat-toldot": {
      "en": "Dedicated by Nancy (née Ackerman) and Alex Warshofsky in gratitude for Jewish learning as their daughter, Avigayil, is called to the Torah as a bat mitzvah, and in loving memory of Freydl Gitl who paved the way in her Jewish life.",
      "he": "מוקדש על-ידי ננסי (שם נעורים: אקרמן) ואלכס ורשופסקי בתודה על לימודי היהדות, לציון עלייתה של בתם אביגיל לתורה לרגל בת המצווה שלה ולזכרה האהוב של פריידי גיטל שסללה את הדרך בחייה היהודיים."
    },
    "parashat-vayigash": {
      "en": "Dedicated by Linda and Leib Koyfman in memory of Dr. Douglas Rosenman, z\"l, beloved father of Hilary Koyfman, and father-in-law of Mo Koyfman.",
      "he": "נתרם על-ידי לינדה ולייב קויפמן לזכר ד\"ר דאגלס רוזנמן ז\"ל, אביה האהוב של הילארי קויפמן וחותנו של מו קויפמן"
    },
    "parashat-achrei-mot": {
      "en": "Dedicated by Kevin Waldman in loving memory of his grandparents, Rose and Morris Waldman, who helped nurture his commitment to Jewish life.",
      "he": "מוקדש על-ידי קווין ולדמן לזכרם האהוב של סביו, רוז ומוריס ולדמן, שעזרו לטפח את מחויבותו לחיים יהודיים."
    },
    "parashat-vaetchanan": {
      "en": "Shabbat Nachamu learning is dedicated in memory of Jerome L. Stern, Yehuda Leib ben David Shmuel, z\"l.",
      "he": "הלימוד לשבת נחמו מוקדש לזכרו של ג'רום ל. שטרן, יהודה לייב בן דוד שמואל ז\"ל."
    }
  };
  var sponsorship_language = topic_sponsorship_map[topic_slug];
  if (!sponsorship_language) return null;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "dedication"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: sponsorship_language
  }));
};
var TopicHeader = function TopicHeader(_ref3) {
  var _topicData$indexes;
  var topic = _ref3.topic,
    topicData = _ref3.topicData,
    multiPanel = _ref3.multiPanel,
    isCat = _ref3.isCat,
    setNavTopic = _ref3.setNavTopic,
    openDisplaySettings = _ref3.openDisplaySettings,
    openSearch = _ref3.openSearch;
  var _ref4 = !!topicData && topicData.primaryTitle ? topicData.primaryTitle : {
      en: "Loading...",
      he: "טוען..."
    },
    en = _ref4.en,
    he = _ref4.he;
  var isTransliteration = !!topicData ? topicData.primaryTitleIsTransliteration : {
    en: false,
    he: false
  };
  var category = !!topicData ? sefaria.topicTocCategory(topicData.slug) : null;
  return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "navTitle tight"
  }, /*#__PURE__*/external_react_default().createElement(CategoryHeader, {
    type: "topics",
    data: topicData,
    buttonsToDisplay: ["source", "edit", "reorder"]
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: en,
      he: he
    }
  })))), !topicData && !isCat ? /*#__PURE__*/external_react_default().createElement(LoadingMessage, null) : null, !isCat && category ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "topicCategory sectionTitleText"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/topics/category/".concat(category.slug),
    onClick: function onClick(e) {
      e.preventDefault();
      setNavTopic(category.slug, category);
    }
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: category.en,
      he: category.he
    }
  }))) : null, topicData && topicData.ref ? /*#__PURE__*/external_react_default().createElement(TopicSponsorship, {
    topic_slug: topicData.slug
  }) : null, topicData && topicData.description ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "topicDescription systemText"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    markdown: {
      en: topicData.description.en,
      he: topicData.description.he
    }
  })) : null, topicData && topicData.ref ? /*#__PURE__*/external_react_default().createElement("a", {
    href: "/".concat(topicData.ref.url),
    className: "resourcesLink button blue"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/book-icon-black.svg",
    alt: "Book Icon"
  }), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, topicData.parasha ? sefaria._('Read the Portion') : topicData.ref.en), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, topicData.parasha ? sefaria._('Read the Portion') : norm_hebrew_ref(topicData.ref.he))) : null, topicData !== null && topicData !== void 0 && (_topicData$indexes = topicData.indexes) !== null && _topicData$indexes !== void 0 && _topicData$indexes.length ? /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sectionTitleText authorIndexTitle"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Works on Sefaria")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "authorIndexList"
  }, topicData.indexes.map(function (_ref5) {
    var text = _ref5.text,
      url = _ref5.url;
    return /*#__PURE__*/external_react_default().createElement(SimpleLinkedBlock, TopicPage_extends({
      key: url
    }, text, {
      url: url,
      classes: "authorIndex"
    }));
  }))) : null);
};
var useTabDisplayData = function useTabDisplayData(translationLanguagePreference) {
  var getTabDisplayData = (0,external_react_.useCallback)(function () {
    return [{
      key: 'popular-writing-of',
      fetcher: fetchBulkText.bind(null, translationLanguagePreference),
      sortOptions: ['Relevance', 'Chronological'],
      filterFunc: refFilter,
      sortFunc: refSort,
      renderWrapper: refRenderWrapper
    }, {
      key: 'sources',
      fetcher: fetchBulkText.bind(null, translationLanguagePreference),
      sortOptions: ['Relevance', 'Chronological'],
      filterFunc: refFilter,
      sortFunc: refSort,
      renderWrapper: refRenderWrapper
    }, {
      key: 'sheets',
      fetcher: fetchBulkSheet,
      sortOptions: ['Relevance', 'Views', 'Newest'],
      filterFunc: sheetFilter,
      sortFunc: sheetSort,
      renderWrapper: sheetRenderWrapper
    }];
  }, [translationLanguagePreference]);
  return getTabDisplayData();
};
var TopicPage = function TopicPage(_ref6) {
  var tab = _ref6.tab,
    topic = _ref6.topic,
    topicTitle = _ref6.topicTitle,
    setTopic = _ref6.setTopic,
    setNavTopic = _ref6.setNavTopic,
    openTopics = _ref6.openTopics,
    multiPanel = _ref6.multiPanel,
    showBaseText = _ref6.showBaseText,
    navHome = _ref6.navHome,
    toggleSignUpModal = _ref6.toggleSignUpModal,
    openDisplaySettings = _ref6.openDisplaySettings,
    setTab = _ref6.setTab,
    openSearch = _ref6.openSearch,
    translationLanguagePreference = _ref6.translationLanguagePreference,
    versionPref = _ref6.versionPref,
    topicTestVersion = _ref6.topicTestVersion;
  var defaultTopicData = {
    primaryTitle: topicTitle,
    tabs: {},
    isLoading: true
  };
  var _useState5 = (0,external_react_.useState)(sefaria.getTopicFromCache(topic, {
      with_html: true
    }) || defaultTopicData),
    _useState6 = TopicPage_slicedToArray(_useState5, 2),
    topicData = _useState6[0],
    setTopicData = _useState6[1];
  var _useState7 = (0,external_react_.useState)(topicData ? Object.entries(topicData.tabs).reduce(function (obj, _ref7) {
      var _ref8 = TopicPage_slicedToArray(_ref7, 2),
        key = _ref8[0],
        tabObj = _ref8[1];
      obj[key] = tabObj.loadedData;
      return obj;
    }, {}) : {}),
    _useState8 = TopicPage_slicedToArray(_useState7, 2),
    loadedData = _useState8[0],
    setLoadedData = _useState8[1];
  var _useState9 = (0,external_react_.useState)({}),
    _useState10 = TopicPage_slicedToArray(_useState9, 2),
    refsToFetchByTab = _useState10[0],
    setRefsToFetchByTab = _useState10[1];
  var _useState11 = (0,external_react_.useState)(null),
    _useState12 = TopicPage_slicedToArray(_useState11, 2),
    parashaData = _useState12[0],
    setParashaData = _useState12[1];
  var _useState13 = (0,external_react_.useState)(false),
    _useState14 = TopicPage_slicedToArray(_useState13, 2),
    showFilterHeader = _useState14[0],
    setShowFilterHeader = _useState14[1];
  var tabDisplayData = useTabDisplayData(translationLanguagePreference, versionPref);
  var scrollableElement = (0,external_react_.useRef)();
  var clearAndSetTopic = function clearAndSetTopic(topic, topicTitle) {
    setTopic(topic, topicTitle);
  };

  // Initial Topic Data, updates when `topic` changes
  (0,external_react_.useEffect)(function () {
    setTopicData(defaultTopicData); // Ensures topicTitle displays while loading
    var _Sefaria$makeCancelab = sefaria.makeCancelable(TopicPage_asyncToGenerator( /*#__PURE__*/TopicPage_regeneratorRuntime().mark(function _callee() {
        var d, _loop, _i3, _Object$entries, _ref11;
        return TopicPage_regeneratorRuntime().wrap(function _callee$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              _context2.next = 2;
              return sefaria.getTopic(topic, {
                with_html: true
              });
            case 2:
              d = _context2.sent;
              if (d.parasha) {
                sefaria.getParashaNextRead(d.parasha).then(setParashaData);
              }
              setTopicData(d);
              // Data remaining to fetch that was not already in the cache
              _loop = /*#__PURE__*/TopicPage_regeneratorRuntime().mark(function _loop() {
                var _ref10, tabKey, tabObj, refsWithoutData;
                return TopicPage_regeneratorRuntime().wrap(function _loop$(_context) {
                  while (1) switch (_context.prev = _context.next) {
                    case 0:
                      _ref10 = _Object$entries[_i3];
                      _ref11 = TopicPage_slicedToArray(_ref10, 2);
                      tabKey = _ref11[0];
                      tabObj = _ref11[1];
                      refsWithoutData = tabObj.loadedData ? tabObj.refs.slice(tabObj.loadedData.length) : tabObj.refs;
                      if (refsWithoutData.length) {
                        setRefsToFetchByTab(function (prev) {
                          return TopicPage_objectSpread(TopicPage_objectSpread({}, prev), {}, TopicPage_defineProperty({}, tabKey, refsWithoutData));
                        });
                      } else {
                        setLoadedData(function (prev) {
                          return TopicPage_objectSpread(TopicPage_objectSpread({}, prev), {}, TopicPage_defineProperty({}, tabKey, tabObj.loadedData));
                        });
                      }
                    case 6:
                    case "end":
                      return _context.stop();
                  }
                }, _loop);
              });
              _i3 = 0, _Object$entries = Object.entries(d.tabs);
            case 7:
              if (!(_i3 < _Object$entries.length)) {
                _context2.next = 12;
                break;
              }
              return _context2.delegateYield(_loop(), "t0", 9);
            case 9:
              _i3++;
              _context2.next = 7;
              break;
            case 12:
            case "end":
              return _context2.stop();
          }
        }, _callee);
      }))()),
      promise = _Sefaria$makeCancelab.promise,
      cancel = _Sefaria$makeCancelab.cancel;
    promise["catch"](function (error) {
      if (!error.isCanceled) {
        console.log('TopicPage Error', error);
      }
    });
    return function () {
      cancel();
      setTopicData(false);
      setLoadedData({});
      setRefsToFetchByTab({});
    };
  }, [topic]);

  // Set up tabs and register incremental load hooks
  var displayTabs = [];
  var onClickFilterIndex = 2;
  var _iterator3 = TopicPage_createForOfIteratorHelper(tabDisplayData),
    _step3;
  try {
    var _loop2 = function _loop2() {
      var _topicData$tabs2;
      var tabObj = _step3.value;
      var key = tabObj.key;
      useIncrementalLoad(tabObj.fetcher, refsToFetchByTab[key] || false, sefaria._topicPageSize, function (data) {
        return setLoadedData(function (prev) {
          var _topicData$tabs;
          var updatedData = !prev[key] || data === false ? data : [].concat(TopicPage_toConsumableArray(prev[key]), TopicPage_toConsumableArray(data));
          if (topicData !== null && topicData !== void 0 && (_topicData$tabs = topicData.tabs) !== null && _topicData$tabs !== void 0 && _topicData$tabs[key]) {
            topicData.tabs[key].loadedData = updatedData;
          } // Persist loadedData in cache
          return TopicPage_objectSpread(TopicPage_objectSpread({}, prev), {}, TopicPage_defineProperty({}, key, updatedData));
        });
      }, topic);
      if (topicData !== null && topicData !== void 0 && (_topicData$tabs2 = topicData.tabs) !== null && _topicData$tabs2 !== void 0 && _topicData$tabs2[key]) {
        displayTabs.push({
          title: topicData.tabs[key].title,
          id: key
        });
      }
    };
    for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
      _loop2();
    }
  } catch (err) {
    _iterator3.e(err);
  } finally {
    _iterator3.f();
  }
  if (displayTabs.length) {
    displayTabs.push({
      title: {
        en: "Filter",
        he: sefaria._("Filter")
      },
      id: 'filter',
      icon: "/static/icons/arrow-".concat(showFilterHeader ? 'up' : 'down', "-bold.svg"),
      justifyright: true
    });
    onClickFilterIndex = displayTabs.length - 1;
  }
  var classStr = external_classnames_default()({
    topicPanel: 1,
    readerNavMenu: 1
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: classStr
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "content noOverflowX",
    ref: scrollableElement
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "columnLayout"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "mainColumn storyFeedInner"
  }, /*#__PURE__*/external_react_default().createElement(TopicHeader, {
    topic: topic,
    topicData: topicData,
    multiPanel: multiPanel,
    setNavTopic: setNavTopic,
    openSearch: openSearch,
    openDisplaySettings: openDisplaySettings
  }), !topicData.isLoading && displayTabs.length ? /*#__PURE__*/external_react_default().createElement(TabView, {
    currTabName: tab,
    setTab: setTab,
    tabs: displayTabs,
    renderTab: function renderTab(t) {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: external_classnames_default()({
          tab: 1,
          noselect: 1,
          filter: t.justifyright,
          open: t.justifyright && showFilterHeader
        })
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: t.title
      }), t.icon ? /*#__PURE__*/external_react_default().createElement("img", {
        src: t.icon,
        alt: "".concat(t.title.en, " icon")
      }) : null);
    },
    containerClasses: "largeTabs",
    onClickArray: TopicPage_defineProperty({}, onClickFilterIndex, function () {
      return setShowFilterHeader(!showFilterHeader);
    })
  }, tabDisplayData.map(function (tabObj) {
    var key = tabObj.key,
      sortOptions = tabObj.sortOptions,
      filterFunc = tabObj.filterFunc,
      sortFunc = tabObj.sortFunc,
      renderWrapper = tabObj.renderWrapper;
    var displayTab = displayTabs.find(function (x) {
      return x.id === key;
    });
    if (!displayTab) {
      return null;
    }
    return /*#__PURE__*/external_react_default().createElement(TopicPageTab, {
      key: key,
      scrollableElement: scrollableElement,
      showFilterHeader: showFilterHeader,
      data: loadedData[key],
      sortOptions: sortOptions,
      filterFunc: filterFunc,
      sortFunc: sortFunc,
      onDisplayedDataChange: function onDisplayedDataChange(data) {
        if (!topicData._refsDisplayedByTab) {
          topicData._refsDisplayedByTab = {};
        }
        topicData._refsDisplayedByTab[key] = data.length;
      },
      initialRenderSize: topicData._refsDisplayedByTab && topicData._refsDisplayedByTab[key] || 0,
      renderItem: renderWrapper(toggleSignUpModal, topicData, topicTestVersion)
    });
  })) : topicData.isLoading ? /*#__PURE__*/external_react_default().createElement(LoadingMessage, null) : null), /*#__PURE__*/external_react_default().createElement("div", {
    className: "sideColumn"
  }, topicData ? /*#__PURE__*/external_react_default().createElement(TopicSideColumn, {
    key: topic,
    slug: topic,
    links: topicData.links,
    clearAndSetTopic: clearAndSetTopic,
    setNavTopic: setNavTopic,
    parashaData: parashaData,
    tref: topicData.ref,
    timePeriod: topicData.timePeriod,
    properties: topicData.properties
  }) : null, /*#__PURE__*/external_react_default().createElement(Promotions, {
    adType: "sidebar"
  }))), /*#__PURE__*/external_react_default().createElement(js_Footer, null)));
};
TopicPage.propTypes = {
  tab: (external_prop_types_default()).string,
  topic: (external_prop_types_default()).string.isRequired,
  setTopic: (external_prop_types_default()).func.isRequired,
  setNavTopic: (external_prop_types_default()).func.isRequired,
  openTopics: (external_prop_types_default()).func.isRequired,
  setTab: (external_prop_types_default()).func.isRequired,
  multiPanel: (external_prop_types_default()).bool,
  showBaseText: (external_prop_types_default()).func,
  navHome: (external_prop_types_default()).func,
  openDisplaySettings: (external_prop_types_default()).func,
  toggleSignUpModal: (external_prop_types_default()).func,
  topicTestVersion: (external_prop_types_default()).string
};
var TopicPageTab = function TopicPageTab(_ref13) {
  var data = _ref13.data,
    renderItem = _ref13.renderItem,
    classes = _ref13.classes,
    sortOptions = _ref13.sortOptions,
    sortFunc = _ref13.sortFunc,
    filterFunc = _ref13.filterFunc,
    showFilterHeader = _ref13.showFilterHeader,
    scrollableElement = _ref13.scrollableElement,
    onDisplayedDataChange = _ref13.onDisplayedDataChange,
    initialRenderSize = _ref13.initialRenderSize;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "topicTabContents"
  }, !!data ? /*#__PURE__*/external_react_default().createElement("div", {
    className: classes
  }, /*#__PURE__*/external_react_default().createElement(FilterableList, {
    pageSize: 20,
    scrollableElement: scrollableElement,
    showFilterHeader: showFilterHeader,
    filterFunc: filterFunc,
    sortFunc: sortFunc,
    renderItem: renderItem,
    renderEmptyList: function renderEmptyList() {
      return null;
    },
    renderHeader: function renderHeader() {
      return null;
    },
    sortOptions: sortOptions,
    onDisplayedDataChange: onDisplayedDataChange,
    initialRenderSize: initialRenderSize,
    data: data
  })) : /*#__PURE__*/external_react_default().createElement(LoadingMessage, null));
};
var TopicLink = function TopicLink(_ref14) {
  var topic = _ref14.topic,
    topicTitle = _ref14.topicTitle,
    onClick = _ref14.onClick,
    isTransliteration = _ref14.isTransliteration,
    isCategory = _ref14.isCategory;
  return /*#__PURE__*/external_react_default().createElement(Misc_Link, {
    className: "relatedTopic",
    href: "/topics/".concat(isCategory ? 'category/' : '').concat(topic),
    onClick: onClick.bind(null, topic, topicTitle),
    key: topic,
    title: topicTitle.en
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: topicTitle.en,
      he: topicTitle.he
    }
  }));
};
TopicLink.propTypes = {
  topic: (external_prop_types_default()).string.isRequired,
  clearAndSetTopic: (external_prop_types_default()).func.isRequired,
  isTransliteration: (external_prop_types_default()).object
};
var TopicSideColumn = function TopicSideColumn(_ref15) {
  var slug = _ref15.slug,
    links = _ref15.links,
    clearAndSetTopic = _ref15.clearAndSetTopic,
    parashaData = _ref15.parashaData,
    tref = _ref15.tref,
    setNavTopic = _ref15.setNavTopic,
    timePeriod = _ref15.timePeriod,
    properties = _ref15.properties;
  var category = sefaria.topicTocCategory(slug);
  var linkTypeArray = links ? Object.values(links).filter(function (linkType) {
    return !!linkType && linkType.shouldDisplay && linkType.links.filter(function (l) {
      return l.shouldDisplay !== false;
    }).length > 0;
  }) : [];
  if (linkTypeArray.length === 0) {
    linkTypeArray.push({
      title: {
        en: !category ? 'Explore Topics' : category.en,
        he: !category ? 'נושאים כלליים' : category.he
      },
      links: sefaria.topicTocPage(category && category.slug).slice(0, 20).map(function (_ref16) {
        var slug = _ref16.slug,
          en = _ref16.en,
          he = _ref16.he;
        return {
          topic: slug,
          title: {
            en: en,
            he: he
          },
          isCategory: !category
        };
      })
    });
  }
  var hasReadings = parashaData && (!Array.isArray(parashaData) || parashaData.length > 0) && tref;
  var readingsComponent = hasReadings ? /*#__PURE__*/external_react_default().createElement(ReadingsComponent, {
    parashaData: parashaData,
    tref: tref
  }) : null;
  var topicMetaData = /*#__PURE__*/external_react_default().createElement(TopicMetaData, {
    timePeriod: timePeriod,
    properties: properties
  });
  var linksComponent = links ? linkTypeArray.sort(function (a, b) {
    var aInd = a.title.en.indexOf('Related');
    var bInd = b.title.en.indexOf('Related');
    if (aInd > -1 && bInd > -1) {
      return 0;
    }
    if (aInd > -1) {
      return -1;
    }
    if (bInd > -1) {
      return 1;
    }
    //alphabetical by en just to keep order consistent
    return a.title.en.localeCompare(b.title.en);
  }).map(function (_ref17) {
    var title = _ref17.title,
      pluralTitle = _ref17.pluralTitle,
      links = _ref17.links;
    var linksToDisplay = links.filter(function (l) {
      return l.shouldDisplay !== false;
    });
    var hasPlural = linksToDisplay.length > 1 && pluralTitle;
    var pluralizedTitle = {
      en: hasPlural ? pluralTitle.en : title.en,
      he: hasPlural ? pluralTitle.he : title.he
    };
    var hasMore = linksToDisplay.length > 10;
    return /*#__PURE__*/external_react_default().createElement(TopicSideSection, {
      key: title.en + title.he,
      title: pluralizedTitle,
      hasMore: hasMore
    }, linksToDisplay.sort(function (a, b) {
      var shortLang = sefaria.interfaceLang == 'hebrew' ? 'he' : 'en';
      if (!!a.title[shortLang] !== !!b.title[shortLang]) {
        return 0 + !!b.title[shortLang] - (0 + !!a.title[shortLang]);
      }
      if (!a.order && !b.order) {
        return 0;
      }
      if (0 + !!a.order !== 0 + !!b.order) {
        return 0 + !!b.order - (0 + !!a.order);
      }
      return b.order.tfidf - a.order.tfidf;
    }).map(function (l) {
      return TopicLink({
        topic: l.topic,
        topicTitle: l.title,
        onClick: l.isCategory ? setNavTopic : clearAndSetTopic,
        isTransliteration: l.titleIsTransliteration,
        isCategory: l.isCategory
      });
    }));
  }) : null;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "topicSideColumn"
  }, readingsComponent, topicMetaData, linksComponent);
};
TopicSideColumn.propTypes = {
  topicData: (external_prop_types_default()).object,
  clearAndSetTopic: (external_prop_types_default()).func.isRequired
};
var TopicSideSection = function TopicSideSection(_ref18) {
  var title = _ref18.title,
    children = _ref18.children,
    hasMore = _ref18.hasMore;
  var _useState15 = (0,external_react_.useState)(false),
    _useState16 = TopicPage_slicedToArray(_useState15, 2),
    showMore = _useState16[0],
    setShowMore = _useState16[1];
  return /*#__PURE__*/external_react_default().createElement("div", {
    key: title.en,
    className: "link-section"
  }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, title.en), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, title.he)), /*#__PURE__*/external_react_default().createElement("div", {
    className: "sideList"
  }, external_react_default().Children.toArray(children).slice(0, showMore ? undefined : 10)), hasMore ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "sideColumnMore sans-serif",
    onClick: function onClick() {
      return setShowMore(!showMore);
    }
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, showMore ? "Less" : "More")) : null);
};
var ReadingsComponent = function ReadingsComponent(_ref19) {
  var _parashaData$parasha$, _parashaData$parasha, _parashaData$parasha$2, _parashaData$parasha$3;
  var parashaData = _ref19.parashaData,
    tref = _ref19.tref;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "readings link-section"
  }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: "Readings",
      he: "פרשיות והפטרות"
    }
  })), /*#__PURE__*/external_react_default().createElement("span", {
    className: "smallText parasha-date"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: sefaria.util.localeDate(parashaData.date),
      he: sefaria.util.localeDate(parashaData.date)
    }
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: sefaria.util.hebrewCalendarDateStr(parashaData.date),
      he: sefaria.util.hebrewCalendarDateStr(parashaData.date)
    }
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "parasha"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sectionTitleText"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: "Torah",
      he: "תורה"
    }
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "navSidebarLink ref serif"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/book.svg",
    className: "navSidebarIcon",
    alt: "book icon"
  }), /*#__PURE__*/external_react_default().createElement("a", {
    href: '/' + tref.url,
    className: "contentText"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: tref.en,
      he: norm_hebrew_ref(tref.he)
    }
  }))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "aliyot"
  }, (_parashaData$parasha$ = (_parashaData$parasha = parashaData.parasha) === null || _parashaData$parasha === void 0 ? void 0 : (_parashaData$parasha$2 = _parashaData$parasha.extraDetails) === null || _parashaData$parasha$2 === void 0 ? void 0 : (_parashaData$parasha$3 = _parashaData$parasha$2.aliyot) === null || _parashaData$parasha$3 === void 0 ? void 0 : _parashaData$parasha$3.map(function (aliya, index) {
    var sectionNum = index + 1;
    var sectionStr = sectionNum <= 7 ? sectionNum : 'M';
    var heSectionStr = sectionNum <= 7 ? sefaria.hebrew.encodeHebrewNumeral(sectionNum) : 'מ';
    return /*#__PURE__*/external_react_default().createElement("a", {
      className: "sectionLink",
      href: "/" + sefaria.normRef(aliya),
      "data-ref": aliya,
      key: aliya
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: {
        en: sectionStr,
        he: heSectionStr
      }
    }));
  })) !== null && _parashaData$parasha$ !== void 0 ? _parashaData$parasha$ : null)), /*#__PURE__*/external_react_default().createElement("div", {
    className: "haftarah"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sectionTitleText"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: "Haftarah",
      he: "הפטרה"
    }
  })), parashaData.haftarah ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "haftarot"
  }, parashaData.haftarah.map(function (h) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "navSidebarLink ref serif"
    }, /*#__PURE__*/external_react_default().createElement("img", {
      src: "/static/icons/book.svg",
      className: "navSidebarIcon",
      alt: "book icon"
    }), /*#__PURE__*/external_react_default().createElement("a", {
      href: '/' + h.url,
      className: "contentText",
      key: h.url
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: {
        en: h.displayValue.en,
        he: norm_hebrew_ref(h.displayValue.he)
      }
    })));
  })) : ""));
};
var propKeys = [{
  en: 'enWikiLink',
  he: 'heWikiLink',
  title: 'Wikipedia'
}, {
  en: 'jeLink',
  he: 'jeLink',
  title: 'Jewish Encyclopedia'
}, {
  en: 'enNliLink',
  he: 'heNliLink',
  title: 'National Library of Israel'
}];
var TopicMetaData = function TopicMetaData(_ref20) {
  var timePeriod = _ref20.timePeriod,
    _ref20$properties = _ref20.properties,
    properties = _ref20$properties === void 0 ? {} : _ref20$properties;
  var tpSection = !!timePeriod ? /*#__PURE__*/external_react_default().createElement(TopicSideSection, {
    title: {
      en: "Lived",
      he: "תקופת פעילות"
    }
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "systemText topicMetaData"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: timePeriod.name
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "systemText topicMetaData"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: timePeriod.yearRange
  }))) : null;
  var propValues = propKeys.map(function (keyObj) {
    return {
      url: {
        en: (properties[keyObj.en] || {})['value'],
        he: (properties[keyObj.he] || {})['value']
      },
      title: keyObj.title
    };
  });
  var hasProps = propValues.reduce(function (accum, curr) {
    return accum || curr.url.en || curr.url.he;
  }, false);
  var propsSection = hasProps ? /*#__PURE__*/external_react_default().createElement(TopicSideSection, {
    title: {
      en: "Learn More",
      he: "לקריאה נוספת"
    }
  }, propValues.map(function (propObj) {
    var url,
      urlExists = true;
    if (sefaria.interfaceLang === 'hebrew') {
      if (!propObj.url.he) {
        urlExists = false;
      }
      url = propObj.url.he || propObj.url.en;
    } else {
      if (!propObj.url.en) {
        urlExists = false;
      }
      url = propObj.url.en || propObj.url.he;
    }
    if (!url) {
      return null;
    }
    return /*#__PURE__*/external_react_default().createElement(SimpleLinkedBlock, {
      key: url,
      en: propObj.title + (urlExists ? "" : " (Hebrew)"),
      he: sefaria._(propObj.title) + (urlExists ? "" : " (".concat(sefaria._("English"), ")")),
      url: url,
      aclasses: "systemText topicMetaData",
      openInNewTab: true
    });
  })) : null;
  return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, tpSection, propsSection);
};

;// CONCATENATED MODULE: ../static/js/sefaria/signupModalContent.js
var _signUpModalContent;
function signupModalContent_typeof(obj) { "@babel/helpers - typeof"; return signupModalContent_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, signupModalContent_typeof(obj); }
function signupModalContent_defineProperty(obj, key, value) { key = signupModalContent_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function signupModalContent_toPropertyKey(arg) { var key = signupModalContent_toPrimitive(arg, "string"); return signupModalContent_typeof(key) === "symbol" ? key : String(key); }
function signupModalContent_toPrimitive(input, hint) { if (signupModalContent_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (signupModalContent_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var SignUpModalKind = {
  AddConnection: Symbol("Add Connection"),
  AddToSheet: Symbol("Add to Sheet"),
  AddTranslation: Symbol("Add Translation"),
  Follow: Symbol("Follow"),
  Notes: Symbol("Notes"),
  Save: Symbol("Save"),
  Default: Symbol("Default")
};
var signUpModalContent = (_signUpModalContent = {}, signupModalContent_defineProperty(_signUpModalContent, SignUpModalKind.AddConnection, {
  h2: {
    en: "Want to document a connection to another text?",
    he: "רוצים לתעד חיבור לטקסט נוסף?"
  },
  h3: {
    en: "Create a free account to do more on Sefaria",
    he: "פתחו חשבון משתמש בחינם - ותוכלו לעשות הרבה יותר עם ספריא"
  },
  contentList: [{
    icon: "tools-add-connection-white.svg",
    bulletContent: {
      en: "Add interconnections & translations",
      he: "הוסיפו תרגומים וחיבורים בין טקסטים"
    }
  }, {
    icon: "sheetsplus-white.svg",
    bulletContent: {
      en: "Build & share source sheets",
      he: "בנו ושתפו דפי מקורות"
    }
  }, {
    icon: "note-white.png",
    bulletContent: {
      en: "Take notes",
      he: "רשמו הערות"
    }
  }, {
    icon: "email-white.png",
    bulletContent: {
      en: "Get updates on new texts",
      he: "התעדכנו בטקסטים חדשים הנוספים לספרייה"
    }
  }]
}), signupModalContent_defineProperty(_signUpModalContent, SignUpModalKind.AddToSheet, {
  h2: {
    en: "Want to make your own source sheet?",
    he: "רוצים ליצור דף מקורות משלכם?"
  },
  h3: {
    en: "Create a free account to join the conversation",
    he: "פתחו חשבון משתמש בחינם כדי להוסיף דפי מקורות משלכם - ועוד:"
  },
  contentList: [{
    icon: "sheetsplus-white.svg",
    bulletContent: {
      en: "Build & share source sheets",
      he: "בנו ושתפו דפי מקורות"
    }
  }, {
    icon: "star-white.png",
    bulletContent: {
      en: "Save texts",
      he: "שמרו טקסטים"
    }
  }, {
    icon: "note-white.svg",
    bulletContent: {
      en: "Take notes",
      he: "רשמו הערות"
    }
  }, {
    icon: "share-icon-white.svg",
    bulletContent: {
      en: "Connect with other users",
      he: "התחברו עם משתמשי ספריא אחרים"
    }
  }]
}), signupModalContent_defineProperty(_signUpModalContent, SignUpModalKind.AddTranslation, {
  h2: {
    en: "Have your own translation of this text?",
    he: "יש לכם תרגום משלכם לטקסט זה?"
  },
  h3: {
    en: "Create a free account to add it to the library & do more on Sefaria",
    he: "פתחו חשבון משתמש בחינם כדי להוסיף אותו לספרייה - ועוד:"
  },
  contentList: [{
    icon: "sheetsplus-white.svg",
    bulletContent: {
      en: "Build & share source sheets",
      he: "בנו ושתפו דפי מקורות"
    }
  }, {
    icon: "star-white.png",
    bulletContent: {
      en: "Save texts",
      he: "שמרו טקסטים"
    }
  }, {
    icon: "note-white.svg",
    bulletContent: {
      en: "Take notes",
      he: "רשמו הערות"
    }
  }, {
    icon: "share-icon-white.svg",
    bulletContent: {
      en: "Connect with other users",
      he: "התחברו עם משתמשי ספריא אחרים"
    }
  }]
}), signupModalContent_defineProperty(_signUpModalContent, SignUpModalKind.Follow, {
  h2: {
    en: "Want to connect with other Sefaria users?",
    he: "רוצים להתחבר עם משתמשים אחרים בספריא?"
  },
  h3: {
    en: "Create a free account to join the conversation",
    he: "פתחו חשבון משתמש בחינם והצטרפו לשיח"
  },
  contentList: [{
    icon: "profile-white.svg",
    bulletContent: {
      en: "Follow your favorite creators",
      he: "עקבו אחרי היוצרים האהובים עליכם"
    }
  }, {
    icon: "sheetsplus-white.svg",
    bulletContent: {
      en: "Build & share source sheets",
      he: "בנו ושתפו דפי מקורות"
    }
  }, {
    icon: "note-white.svg",
    bulletContent: {
      en: "Send messages",
      he: "שלחו הודעות דרך ספריא"
    }
  }]
}), signupModalContent_defineProperty(_signUpModalContent, SignUpModalKind.Notes, {
  h2: {
    en: "Don’t lose that thought!",
    he: "אל תשכחו את המחשבה שעלתה בכם!"
  },
  h3: {
    en: "Create a free account to do more on Sefaria",
    he: "פתחו חשבון משתמש בחינם כדי לעשות יותר עם ספריא"
  },
  contentList: [{
    icon: "note-white.svg",
    bulletContent: {
      en: "Take notes on this text",
      he: "רשמו הערות על הטקסט שאתם לומדים"
    }
  }, {
    icon: "sheetsplus-white.svg",
    bulletContent: {
      en: "Build & create source sheets",
      he: "בנו ושתפו דפי מקורות"
    }
  }, {
    icon: "share-icon-white.svg",
    bulletContent: {
      en: "Connect with other users",
      he: "התחברו עם משתמשים אחרים באתר"
    }
  }, {
    icon: "email-white.png",
    bulletContent: {
      en: "Get updates on new features",
      he: "קבלו עדכונים טכנולוגיים על תכונות חדשות בספריא"
    }
  }]
}), signupModalContent_defineProperty(_signUpModalContent, SignUpModalKind.Save, {
  h2: {
    en: "Want to return to this text?",
    he: "רוצים לחזור לטקסט הזה?"
  },
  h3: {
    en: "Create a free account to do more on Sefaria",
    he: "פתחו חשבון משתמש בחינם כדי לעשות יותר עם ספריא"
  },
  contentList: [{
    icon: "star-white.png",
    bulletContent: {
      en: "Save texts",
      he: "שמרו טקסטים"
    }
  }, {
    icon: "note-white.svg",
    bulletContent: {
      en: "Take notes",
      he: "כתבו הערות"
    }
  }, {
    icon: "clock-white.svg",
    bulletContent: {
      en: "View your reading history",
      he: "צפו בהיסטוריית הקריאה שלכם"
    }
  }, {
    icon: "sheetsplus-white.svg",
    bulletContent: {
      en: "Build & share source sheets",
      he: "צרו ושתפו דפי מקורות"
    }
  }]
}), signupModalContent_defineProperty(_signUpModalContent, SignUpModalKind.Default, {
  h2: {
    en: "Love Learning?",
    he: "אוהבים ללמוד?"
  },
  h3: {
    en: "Sign up to get more from Sefaria",
    he: "הרשמו כדי לקבל יותר מספריא"
  },
  contentList: [{
    icon: "star-white.png",
    bulletContent: {
      en: "Save texts",
      he: "שמרו טקסטים לקריאה חוזרת"
    }
  }, {
    icon: "sheet-white.png",
    bulletContent: {
      en: "Make source sheets",
      he: "הכינו דפי מקורות"
    }
  }, {
    icon: "note-white.png",
    bulletContent: {
      en: "Take notes",
      he: "שמרו הערות"
    }
  }, {
    icon: "email-white.png",
    bulletContent: {
      en: "Stay in the know",
      he: "השארו מעודכנים"
    }
  }]
}), _signUpModalContent);
function generateContentForModal(signUpModalKind) {
  if (signUpModalContent.hasOwnProperty(signUpModalKind)) {
    return signUpModalContent[signUpModalKind];
  } else {
    return signUpModalContent[SignUpModalKind.Default];
  }
}
;// CONCATENATED MODULE: ../static/js/SourceEditor.jsx
function SourceEditor_typeof(obj) { "@babel/helpers - typeof"; return SourceEditor_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, SourceEditor_typeof(obj); }
function SourceEditor_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ SourceEditor_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == SourceEditor_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function SourceEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function SourceEditor_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { SourceEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { SourceEditor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function SourceEditor_slicedToArray(arr, i) { return SourceEditor_arrayWithHoles(arr) || SourceEditor_iterableToArrayLimit(arr, i) || SourceEditor_unsupportedIterableToArray(arr, i) || SourceEditor_nonIterableRest(); }
function SourceEditor_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function SourceEditor_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return SourceEditor_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return SourceEditor_arrayLikeToArray(o, minLen); }
function SourceEditor_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function SourceEditor_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function SourceEditor_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }





var SourceEditor = function SourceEditor(_ref) {
  var _origData$description, _origData$description2, _origData$description3, _origData$description4, _origData$description5, _origData$description6, _origData$description7, _origData$description8;
  var topic = _ref.topic,
    close = _ref.close,
    _ref$origData = _ref.origData,
    origData = _ref$origData === void 0 ? {} : _ref$origData;
  var isNew = !origData.ref;
  var _useState = (0,external_react_.useState)(origData.lang === 'he' ? origData.heRef || "" : origData.ref || ""),
    _useState2 = SourceEditor_slicedToArray(_useState, 2),
    displayRef = _useState2[0],
    setDisplayRef = _useState2[1];
  var title = sefaria.interfaceLang === 'english' ? (origData === null || origData === void 0 ? void 0 : (_origData$description = origData.descriptions) === null || _origData$description === void 0 ? void 0 : (_origData$description2 = _origData$description.en) === null || _origData$description2 === void 0 ? void 0 : _origData$description2.title) || '' : (origData === null || origData === void 0 ? void 0 : (_origData$description3 = origData.descriptions) === null || _origData$description3 === void 0 ? void 0 : (_origData$description4 = _origData$description3.he) === null || _origData$description4 === void 0 ? void 0 : _origData$description4.title) || '';
  var prompt = sefaria.interfaceLang === 'english' ? (origData === null || origData === void 0 ? void 0 : (_origData$description5 = origData.descriptions) === null || _origData$description5 === void 0 ? void 0 : (_origData$description6 = _origData$description5.en) === null || _origData$description6 === void 0 ? void 0 : _origData$description6.prompt) || '' : (origData === null || origData === void 0 ? void 0 : (_origData$description7 = origData.descriptions) === null || _origData$description7 === void 0 ? void 0 : (_origData$description8 = _origData$description7.he) === null || _origData$description8 === void 0 ? void 0 : _origData$description8.prompt) || '';
  var _useState3 = (0,external_react_.useState)({
      enTitle: title,
      // use enTitle for hebrew or english case
      prompt: prompt
    }),
    _useState4 = SourceEditor_slicedToArray(_useState3, 2),
    data = _useState4[0],
    setData = _useState4[1];
  var _useState5 = (0,external_react_.useState)(false),
    _useState6 = SourceEditor_slicedToArray(_useState5, 2),
    changed = _useState6[0],
    setChanged = _useState6[1];
  var _useState7 = (0,external_react_.useState)(false),
    _useState8 = SourceEditor_slicedToArray(_useState7, 2),
    savingStatus = _useState8[0],
    setSavingStatus = _useState8[1];
  var updateData = function updateData(newData) {
    setChanged(true);
    setData(newData);
  };
  var validate = /*#__PURE__*/function () {
    var _ref2 = SourceEditor_asyncToGenerator( /*#__PURE__*/SourceEditor_regeneratorRuntime().mark(function _callee() {
      var _refInCache;
      var refInCache;
      return SourceEditor_regeneratorRuntime().wrap(function _callee$(_context) {
        while (1) switch (_context.prev = _context.next) {
          case 0:
            if (changed) {
              _context.next = 3;
              break;
            }
            alert("Please change one of the fields before saving.");
            return _context.abrupt("return", false);
          case 3:
            if (!(displayRef.length === 0)) {
              _context.next = 6;
              break;
            }
            alert(sefaria._("Ref must be provided."));
            return _context.abrupt("return", false);
          case 6:
            refInCache = sefaria.getRefFromCache(displayRef);
            if (refInCache) {
              _context.next = 11;
              break;
            }
            _context.next = 10;
            return sefaria.getRef(displayRef);
          case 10:
            refInCache = _context.sent;
          case 11:
            if ((_refInCache = refInCache) !== null && _refInCache !== void 0 && _refInCache.ref) {
              _context.next = 14;
              break;
            }
            alert(sefaria._("Valid ref must be provided."));
            return _context.abrupt("return", false);
          case 14:
            _context.next = 16;
            return save();
          case 16:
          case "end":
            return _context.stop();
        }
      }, _callee);
    }));
    return function validate() {
      return _ref2.apply(this, arguments);
    };
  }();
  var save = /*#__PURE__*/function () {
    var _ref3 = SourceEditor_asyncToGenerator( /*#__PURE__*/SourceEditor_regeneratorRuntime().mark(function _callee2() {
      var refInUrl, url, postData;
      return SourceEditor_regeneratorRuntime().wrap(function _callee2$(_context2) {
        while (1) switch (_context2.prev = _context2.next) {
          case 0:
            setSavingStatus(true);
            refInUrl = isNew ? displayRef : origData.ref;
            url = "/api/ref-topic-links/".concat(sefaria.normRef(refInUrl));
            postData = {
              "topic": topic,
              "is_new": isNew,
              'new_ref': displayRef,
              'interface_lang': sefaria.interfaceLang
            };
            if (data.enTitle.length > 0) {
              postData['description'] = {
                "title": data.enTitle,
                "prompt": data.prompt
              };
            }
            requestWithCallBack({
              url: url,
              data: postData,
              setSavingStatus: setSavingStatus,
              redirect: function redirect() {
                return window.location.href = "/topics/" + topic;
              }
            });
          case 6:
          case "end":
            return _context2.stop();
        }
      }, _callee2);
    }));
    return function save() {
      return _ref3.apply(this, arguments);
    };
  }();
  var handleChange = function handleChange(x) {
    setChanged(true);
    setDisplayRef(x);
  };
  var getSuggestions = /*#__PURE__*/function () {
    var _ref4 = SourceEditor_asyncToGenerator( /*#__PURE__*/SourceEditor_regeneratorRuntime().mark(function _callee3(input) {
      var results, d;
      return SourceEditor_regeneratorRuntime().wrap(function _callee3$(_context3) {
        while (1) switch (_context3.prev = _context3.next) {
          case 0:
            results = {
              "helperPromptText": null,
              "currentSuggestions": null,
              "showAddButton": false
            };
            setDisplayRef(input);
            if (!(input === "")) {
              _context3.next = 4;
              break;
            }
            return _context3.abrupt("return", results);
          case 4:
            _context3.next = 6;
            return sefaria.getName(input, true, 5);
          case 6:
            d = _context3.sent;
            if (!(d.is_section || d.is_segment)) {
              _context3.next = 15;
              break;
            }
            results.helperPromptText = null;
            results.currentSuggestions = null;
            results.showAddButton = true;
            results.previewText = input;
            return _context3.abrupt("return", results);
          case 15:
            results.previewText = null;
          case 16:
            results.currentSuggestions = d.completion_objects.map(function (suggestion) {
              return {
                name: suggestion.title,
                key: suggestion.key,
                border_color: sefaria.palette.refColor(suggestion.key)
              };
            });
            return _context3.abrupt("return", results);
          case 18:
          case "end":
            return _context3.stop();
        }
      }, _callee3);
    }));
    return function getSuggestions(_x2) {
      return _ref4.apply(this, arguments);
    };
  }();
  var deleteTopicSource = function deleteTopicSource() {
    var url = "/api/ref-topic-links/".concat(origData.ref, "?topic=").concat(topic, "&interface_lang=").concat(sefaria.interfaceLang);
    requestWithCallBack({
      url: url,
      type: "DELETE",
      redirect: function redirect() {
        return window.location.href = "/topics/".concat(topic);
      }
    });
  };
  return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(AdminEditor, {
    title: "Source Editor",
    close: close,
    data: data,
    savingStatus: savingStatus,
    validate: validate,
    items: ["Title", "Prompt"],
    deleteObj: deleteTopicSource,
    updateData: updateData,
    isNew: isNew,
    extras: [/*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Enter Source Ref (for example: 'Yevamot.62b.9-11' or 'Yevamot 62b:9-11')")), /*#__PURE__*/external_react_default().createElement(Autocompleter, {
      selectedCallback: function selectedCallback() {},
      getSuggestions: getSuggestions,
      inputValue: displayRef,
      changeInputValue: handleChange,
      inputPlaceholder: "Search for a Text or Commentator.",
      buttonTitle: "Select Source",
      autocompleteClassNames: "addInterfaceInput",
      showSuggestionsOnSelect: true
    }))]
  }));
};

;// CONCATENATED MODULE: external "js-cookie"
const external_js_cookie_namespaceObject = require("js-cookie");
var external_js_cookie_default = /*#__PURE__*/__webpack_require__.n(external_js_cookie_namespaceObject);
;// CONCATENATED MODULE: ../static/js/DictionarySearch.jsx
function DictionarySearch_typeof(obj) { "@babel/helpers - typeof"; return DictionarySearch_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, DictionarySearch_typeof(obj); }
function DictionarySearch_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function DictionarySearch_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, DictionarySearch_toPropertyKey(descriptor.key), descriptor); } }
function DictionarySearch_createClass(Constructor, protoProps, staticProps) { if (protoProps) DictionarySearch_defineProperties(Constructor.prototype, protoProps); if (staticProps) DictionarySearch_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function DictionarySearch_toPropertyKey(arg) { var key = DictionarySearch_toPrimitive(arg, "string"); return DictionarySearch_typeof(key) === "symbol" ? key : String(key); }
function DictionarySearch_toPrimitive(input, hint) { if (DictionarySearch_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (DictionarySearch_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function DictionarySearch_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) DictionarySearch_setPrototypeOf(subClass, superClass); }
function DictionarySearch_setPrototypeOf(o, p) { DictionarySearch_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return DictionarySearch_setPrototypeOf(o, p); }
function DictionarySearch_createSuper(Derived) { var hasNativeReflectConstruct = DictionarySearch_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = DictionarySearch_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = DictionarySearch_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return DictionarySearch_possibleConstructorReturn(this, result); }; }
function DictionarySearch_possibleConstructorReturn(self, call) { if (call && (DictionarySearch_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return DictionarySearch_assertThisInitialized(self); }
function DictionarySearch_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function DictionarySearch_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function DictionarySearch_getPrototypeOf(o) { DictionarySearch_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return DictionarySearch_getPrototypeOf(o); }







var DictionarySearch = /*#__PURE__*/function (_Component) {
  DictionarySearch_inherits(DictionarySearch, _Component);
  var _super = DictionarySearch_createSuper(DictionarySearch);
  function DictionarySearch(props) {
    var _this;
    DictionarySearch_classCallCheck(this, DictionarySearch);
    _this = _super.call(this, props);
    _this.state = {
      val: "",
      timer: null,
      autocomplete: null
    };
    return _this;
  }
  DictionarySearch_createClass(DictionarySearch, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.attachKeyboard();
      this.initAutocomplete();
      this.checkIfChanged();
    }
    /*
    shouldComponentUpdate(nextProps, nextState) {
      if (this.props.interfaceLang != nextProps.interfaceLang) { return true; }
      return false;
    } */
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      clearTimeout(this.state.timer);
    }
  }, {
    key: "checkIfChanged",
    value: function checkIfChanged() {
      var _this2 = this;
      var current;
      try {
        current = sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").val();
      } catch (e) {
        // The component is unmounted
        return;
      }
      if (this.state.val != current) {
        if (document.getElementById('keyboardInputMaster')) {
          // If the keyboard is open, place autocomplete results below it
          sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").autocomplete("option", "position", {
            my: "left+15 top+180",
            at: "left bottom",
            of: this.props.contextSelector + ' .dictionarySearchBox'
          });
        } else {
          // Otherwise results are below input box
          sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").autocomplete("option", "position", {
            my: "left top",
            at: "left bottom",
            of: this.props.contextSelector + ' .dictionarySearchBox'
          });
        }
        sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").autocomplete("search");
      }
      this.setState({
        val: current,
        timer: setTimeout(function () {
          return _this2.checkIfChanged();
        }, 330)
      });
    }
  }, {
    key: "attachKeyboard",
    value: function attachKeyboard() {
      var inputElement = document.querySelector(this.props.contextSelector + ' .dictionarySearchBox .keyboardInput');
      if (inputElement && !inputElement.VKI_attached) {
        VKI_attach(inputElement);
      }
    }
  }, {
    key: "initAutocomplete",
    value: function initAutocomplete() {
      var _this3 = this;
      sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").autocomplete({
        position: {
          my: "left top",
          at: "left bottom",
          of: this.props.contextSelector + ' .dictionarySearchBox'
        },
        open: function (e) {
          var searchBoxWidth = sefariaJquery(this.props.contextSelector + " .dictionarySearchBox").width();
          if (document.getElementById('keyboardInputMaster')) {
            // If the keyboard is open, set width to whichever is less of width of input box and width of keyboard
            var keyboardWidth = sefariaJquery('#keyboardInputMaster').width() + 10;
            sefariaJquery(this.props.contextSelector + " .dictionary-toc-autocomplete").width(Math.min(searchBoxWidth, keyboardWidth));
          } else {
            // Otherwise width of input box
            sefariaJquery(this.props.contextSelector + " .dictionary-toc-autocomplete").width(searchBoxWidth);
          }
        }.bind(this),
        close: function (event) {
          this.setState({
            val: sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").val()
          });
          this.checkIfChanged();
        }.bind(this),
        classes: {
          "ui-autocomplete": "dictionary-toc-autocomplete" //todo: make unique identifier?
        },

        minLength: 1,
        focus: function focus(e) {
          return clearTimeout(_this3.state.timer);
        },
        select: function (event, ui) {
          if (ui.item.value == "__invalid") {
            return false;
          }
          sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").val(ui.item.value); // This will disappear when the next line executes, but the eye can sometimes catch it.
          this.submitSearch(ui.item.label);
          return false;
        }.bind(this),
        source: function (request, response) {
          if (sefaria.hebrew.containsEnglish(request.term)) {
            response([{
              label: "Invalid entry.  Please type a Hebrew word.",
              value: "__invalid"
            }]);
            return;
          }
          sefaria.lexiconCompletion(request.term, this.props.lexiconName, function (d) {
            if (d.length > 0) {
              response(d.map(function (e) {
                return {
                  label: e[1],
                  value: e[0]
                };
              }));
            } else {
              response([]);
            }
          });
        }.bind(this)
      });
    }
  }, {
    key: "handleSearchButtonClick",
    value: function handleSearchButtonClick(event) {
      var query = sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".search").val();
      if (query) {
        this.submitSearch(query, true);
      }
    }
  }, {
    key: "handleSearchKeyUp",
    value: function handleSearchKeyUp(event) {
      if (event.keyCode === 13) {
        var query = sefariaJquery(event.target).val();
        if (query) {
          sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").autocomplete("close");
          this.submitSearch(query, true);
        }
      }
    }
  }, {
    key: "displayWord",
    value: function displayWord(word) {
      var _this4 = this;
      // Either show results in sidebar, or show word in reader, depending on which mode we're in.
      console.log(word);
      if (this.props.showWordList) {
        this.props.showWordList(word);
      } else if (this.props.navigatePanel || this.props.showBaseText) {
        var ref = this.props.title + ", " + word;
        sefaria.getText(ref).then(function (data) {
          // Check that this ref exists first before trying to open a panel
          if ("error" in data) {
            return;
          }
          _this4.props.navigatePanel ? _this4.props.navigatePanel(ref, _this4.props.currVersions) : _this4.props.showBaseText(ref, false, _this4.props.currVersions);
        });
      }
    }
  }, {
    key: "submitSearch",
    value: function submitSearch(word, needsResolution) {
      var _this5 = this;
      if (needsResolution) {
        // Get the dotted form of this word, or the nearest match
        sefaria.lexiconCompletion(word, this.props.lexiconName, function (d) {
          var resolvedWord = d.length > 0 ? d[0][1] : word;
          _this5.displayWord(resolvedWord);
        });
      } else {
        this.displayWord(word);
      }
    }
  }, {
    key: "showVirtualKeyboardIcon",
    value: function showVirtualKeyboardIcon(show) {
      if (document.getElementById('keyboardInputMaster')) {
        // if keyboard is open, ignore.
        return; //this prevents the icon from flashing on every key stroke.
      }

      if (sefaria.interfaceLang === 'english') {
        var opacity = show ? 0.4 : 0;
        sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".keyboardInputInitiator").css({
          "opacity": opacity
        });
      }
    }
  }, {
    key: "render",
    value: function render() {
      var inputClasses = external_classnames_default()({
        search: 1,
        keyboardInput: sefaria.interfaceLang == 'english'
      });
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchBox dictionarySearchBox ui-front"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        className: "dictionarySearchButton",
        src: "/static/icons/magnifier.svg",
        onClick: this.handleSearchButtonClick,
        role: "button",
        alt: "image of maginfying glass"
      }), /*#__PURE__*/external_react_default().createElement("input", {
        className: inputClasses,
        id: "searchInput",
        placeholder: sefaria._("Search Dictionary"),
        onKeyUp: this.handleSearchKeyUp,
        onFocus: this.showVirtualKeyboardIcon.bind(this, true),
        onBlur: this.showVirtualKeyboardIcon.bind(this, false),
        maxLength: 75,
        title: sefaria._("Search for Texts or Keywords Here")
      }));
    }
  }]);
  return DictionarySearch;
}((external_react_class_default()));
DictionarySearch.propTypes = {
  lexiconName: (external_prop_types_default()).string,
  // req. for redirect to text - e.g. TOC case.
  title: (external_prop_types_default()).string,
  // req. for redirect to text - e.g. TOC case.
  showBaseText: (external_prop_types_default()).func,
  // req. for redirect to text - e.g. TOC case.
  showWordList: (external_prop_types_default()).func,
  // req. for sidebar case
  currVersions: (external_prop_types_default()).object,
  // req. for redirect to text - e.g. TOC case.
  contextSelector: (external_prop_types_default()).string.isRequired // CSS Selector for uniquely identifiable context that this is in.
};

/* harmony default export */ const js_DictionarySearch = (DictionarySearch);
;// CONCATENATED MODULE: ../static/js/VersionBlock.jsx
function VersionBlock_typeof(obj) { "@babel/helpers - typeof"; return VersionBlock_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, VersionBlock_typeof(obj); }
function VersionBlock_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function VersionBlock_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? VersionBlock_ownKeys(Object(source), !0).forEach(function (key) { VersionBlock_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : VersionBlock_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function VersionBlock_slicedToArray(arr, i) { return VersionBlock_arrayWithHoles(arr) || VersionBlock_iterableToArrayLimit(arr, i) || VersionBlock_unsupportedIterableToArray(arr, i) || VersionBlock_nonIterableRest(); }
function VersionBlock_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function VersionBlock_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return VersionBlock_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return VersionBlock_arrayLikeToArray(o, minLen); }
function VersionBlock_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function VersionBlock_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function VersionBlock_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function VersionBlock_defineProperty(obj, key, value) { key = VersionBlock_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function VersionBlock_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function VersionBlock_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, VersionBlock_toPropertyKey(descriptor.key), descriptor); } }
function VersionBlock_createClass(Constructor, protoProps, staticProps) { if (protoProps) VersionBlock_defineProperties(Constructor.prototype, protoProps); if (staticProps) VersionBlock_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function VersionBlock_toPropertyKey(arg) { var key = VersionBlock_toPrimitive(arg, "string"); return VersionBlock_typeof(key) === "symbol" ? key : String(key); }
function VersionBlock_toPrimitive(input, hint) { if (VersionBlock_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (VersionBlock_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function VersionBlock_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) VersionBlock_setPrototypeOf(subClass, superClass); }
function VersionBlock_setPrototypeOf(o, p) { VersionBlock_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return VersionBlock_setPrototypeOf(o, p); }
function VersionBlock_createSuper(Derived) { var hasNativeReflectConstruct = VersionBlock_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = VersionBlock_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = VersionBlock_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return VersionBlock_possibleConstructorReturn(this, result); }; }
function VersionBlock_possibleConstructorReturn(self, call) { if (call && (VersionBlock_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return VersionBlock_assertThisInitialized(self); }
function VersionBlock_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function VersionBlock_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function VersionBlock_getPrototypeOf(o) { VersionBlock_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return VersionBlock_getPrototypeOf(o); }








var VersionBlock = /*#__PURE__*/function (_Component) {
  VersionBlock_inherits(VersionBlock, _Component);
  var _super = VersionBlock_createSuper(VersionBlock);
  function VersionBlock(props) {
    var _this;
    VersionBlock_classCallCheck(this, VersionBlock);
    _this = _super.call(this, props);
    _this.updateableVersionAttributes = ["versionTitle", "versionSource", "versionNotes", "license", "priority", "digitizedBySefaria", "status", "versionTitleInHebrew", "shortVersionTitle", "shortVersionTitleInHebrew", "versionNotesInHebrew", "purchaseInformationImage", "purchaseInformationURL"];
    var s = {
      editing: false,
      error: null,
      originalVersionTitle: props.version["versionTitle"]
    };
    _this.updateableVersionAttributes.forEach(function (attr) {
      return s[attr] = props.version[attr];
    });
    _this.state = s;
    return _this;
  }
  VersionBlock_createClass(VersionBlock, [{
    key: "onVersionTitleClick",
    value: function onVersionTitleClick(e) {
      e.preventDefault();
      this.index = sefaria.parseRef(this.props.currentRef).index;
      gtag("event", "onClick_version_title", {
        element_name: "version_title",
        change_to: "".concat(this.props.version.versionTitle),
        change_from: "".concat(this.props.currObjectVersions[this.props.version.language]['versionTitle']),
        categories: "".concat(sefaria.refCategories(this.props.currentRef)),
        book: "".concat(sefaria.parseRef(this.props.currentRef).index)
      });
      if (!this.props.openVersionInSidebar && !this.props.openVersionInReader) return;
      if (this.props.firstSectionRef) {
        window.location = "/".concat(this.props.firstSectionRef, "?v").concat(this.props.version.language, "=").concat(this.props.version.versionTitle.replace(/\s/g, '_'));
      } else {
        var action = this.props.openVersionInSidebar ? this.props.openVersionInSidebar : this.props.openVersionInReader;
        if (action) {
          action(this.props.version.versionTitle, this.props.version.language);
        }
      }
    }
  }, {
    key: "onSelectVersionClick",
    value: function onSelectVersionClick(e) {
      e.preventDefault();
      gtag("event", "onClick_select_version", {
        element_name: "select_version",
        change_to: "".concat(this.props.version.versionTitle),
        change_from: "".concat(this.props.currObjectVersions[this.props.version.language]['versionTitle']),
        categories: "".concat(sefaria.refCategories(this.props.currentRef)),
        book: "".concat(sefaria.parseRef(this.props.currentRef).index)
      });
      if (this.props.openVersionInReader) {
        this.props.openVersionInReader(this.props.version.versionTitle, this.props.version.language);
        sefaria.setVersionPreference(this.props.currentRef, this.props.version.versionTitle, this.props.version.language);
      }
    }
  }, {
    key: "handleInputChange",
    value: function handleInputChange(event) {
      var _this$setState;
      var target = event.target;
      var name = target.name;
      var value = target.type === 'checkbox' ? name === "status" ? target.checked ? "locked" : null : target.checked : target.value;
      this.setState((_this$setState = {}, VersionBlock_defineProperty(_this$setState, name, value), VersionBlock_defineProperty(_this$setState, "error", null), _this$setState));
    }
  }, {
    key: "saveVersionUpdate",
    value: function saveVersionUpdate(event) {
      var v = this.props.version;
      var payloadVersion = {};
      this.updateableVersionAttributes.forEach(function (attr) {
        if (this.state[attr] || this.state[attr] != this.props.version[attr]) {
          payloadVersion[attr] = this.state[attr];
        }
      }.bind(this));
      delete payloadVersion.versionTitle;
      if (this.state.versionTitle != this.state.originalVersionTitle) {
        payloadVersion.newVersionTitle = this.state.versionTitle;
      }
      this.setState({
        "error": "Saving.  Page will reload on success."
      });
      sefariaJquery.ajax({
        url: "/api/version/flags/".concat(v.title, "/").concat(v.language, "/").concat(v.versionTitle),
        dataType: 'json',
        type: 'POST',
        data: {
          json: JSON.stringify(payloadVersion)
        },
        success: function (data) {
          if (data.status == "ok") {
            document.location.reload(true);
          } else {
            this.setState({
              error: data.error
            });
          }
        }.bind(this),
        error: function (xhr, status, err) {
          this.setState({
            error: err.toString()
          });
        }.bind(this)
      });
    }
  }, {
    key: "deleteVersion",
    value: function deleteVersion() {
      if (!confirm("Are you sure you want to delete this text version?")) {
        return;
      }
      var url = "/api/texts/" + this.props.version.title + "/" + this.props.version.language + "/" + this.props.version.versionTitle;
      sefariaJquery.ajax({
        url: url,
        type: "DELETE",
        success: function success(data) {
          if ("error" in data) {
            alert(data.error);
          } else {
            alert("Text Version Deleted.");
            window.location = "/" + sefaria.normRef(this.props.version.title);
          }
        }
      }).fail(function () {
        alert("Something went wrong. Sorry!");
      });
    }
  }, {
    key: "openEditor",
    value: function openEditor() {
      if (sefaria.is_moderator) {
        this.setState({
          editing: true
        });
      } else {
        return;
      }
    }
  }, {
    key: "closeEditor",
    value: function closeEditor() {
      this.setState({
        editing: false
      });
    }
  }, {
    key: "openExtendedNotes",
    value: function openExtendedNotes(e) {
      e.preventDefault();
      this.props.viewExtendedNotes(this.props.version.title, this.props.version.language, this.props.version.versionTitle);
    }
  }, {
    key: "makeVersionLink",
    value: function makeVersionLink(versionParam) {
      var _this2 = this;
      //versionParam - either version language (e.g. 'en') in the case when you're making a link for versions in reader
      //otherwise, 'side' for making link for versions in sidebar

      // maintain all versions for languages you're not currently selecting
      if (this.props.version.merged) {
        return "#"; // there's no url for a merged version
      }

      var withParam = versionParam === 'side' ? "&with=Translation Open" : "";
      var nonSelectedVersionParams = Object.entries(this.props.currObjectVersions).filter(function (_ref) {
        var _ref2 = VersionBlock_slicedToArray(_ref, 2),
          vlang = _ref2[0],
          version = _ref2[1];
        return !!version && !!(version !== null && version !== void 0 && version.versionTitle) && !(version !== null && version !== void 0 && version.merged) && (versionParam === 'side' || vlang !== _this2.props.version.language);
      }) // in 'side' case, keep all version params
      .map(function (_ref3) {
        var _ref4 = VersionBlock_slicedToArray(_ref3, 2),
          vlang = _ref4[0],
          version = _ref4[1];
        return "&v".concat(vlang, "=").concat(version.versionTitle.replace(/\s/g, '_'));
      }).join("");
      var versionLink = nonSelectedVersionParams == "" ? null : "/".concat(sefaria.normRef(this.props.currentRef)).concat(nonSelectedVersionParams, "&v").concat(versionParam, "=").concat(this.props.version.versionTitle.replace(/\s/g, '_')).concat(withParam).replace("&", "?");
      return versionLink;
    }
  }, {
    key: "makeVersionTitle",
    value: function makeVersionTitle() {
      if (this.props.version.merged) {
        return {
          "className": "",
          "text": sefaria._("Merged from") + " " + Array.from(new Set(this.props.version.sources)).join(", ")
        };
      } else if (sefaria.interfaceLang == "english" || !this.props.version.versionTitleInHebrew) {
        return {
          "className": "",
          "text": this.props.version.versionTitle
        };
      } else {
        return {
          "className": "he",
          "text": this.props.version.versionTitleInHebrew
        };
      }
    }
  }, {
    key: "makeVersionNotes",
    value: function makeVersionNotes() {
      if (sefaria.interfaceLang == "english" && !!this.props.version.versionNotes) {
        return this.props.version.versionNotes;
      } else if (sefaria.interfaceLang == "hebrew" && !!this.props.version.versionNotesInHebrew) {
        return this.props.version.versionNotesInHebrew;
      } else {
        return null;
      }
    }
  }, {
    key: "makeLicenseLink",
    value: function makeLicenseLink() {
      var license_map = sefaria.getLicenseMap();
      return this.props.version.license in license_map ? license_map[this.props.version.license] : "#";
    }
  }, {
    key: "makeSelectVersionLanguage",
    value: function makeSelectVersionLanguage() {
      if (this.isHeTranslation() && !this.props.isCurrent) {
        return sefaria._("View in Sidebar");
      }
      var voc = this.props.version.isBaseText ? 'Version' : "Translation";
      return this.props.isCurrent ? sefaria._("Current " + voc) : sefaria._("Select " + voc);
    }
  }, {
    key: "hasExtendedNotes",
    value: function hasExtendedNotes() {
      return !!(this.props.version.extendedNotes || this.props.version.extendedNotesHebrew);
    }
  }, {
    key: "makeAttrClassNames",
    value: function makeAttrClassNames(extraClassNames) {
      var attrToExist = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      var attrIsMultilingual = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
      if (attrIsMultilingual && sefaria.interfaceLang != "english") {
        attrToExist = attrToExist + "In" + sefaria.interfaceLang.toFirstCapital();
      }
      return VersionBlock_objectSpread(VersionBlock_objectSpread({}, extraClassNames), {}, {
        "n-a": attrToExist ? !this.props.version[attrToExist] : 0
      });
    }
  }, {
    key: "makeImageLink",
    value: function makeImageLink() {
      return !!this.props.version.purchaseInformationURL ? this.props.version.purchaseInformationURL : this.props.version.versionSource;
    }
  }, {
    key: "makeImageSrc",
    value: function makeImageSrc() {
      return !!this.props.version.purchaseInformationImage ? this.props.version.purchaseInformationImage : "data:,";
    }
  }, {
    key: "isHeTranslation",
    value: function isHeTranslation() {
      return this.props.version.actualLanguage === 'he' && !this.props.version.isBaseText && this.props.inTranslationBox;
    }
  }, {
    key: "render",
    value: function render() {
      if (this.props.version.title == "Sheet") return null; //why are we even getting here in such a case??;
      var v = this.props.version;
      var vtitle = this.makeVersionTitle();
      var vnotes = this.makeVersionNotes();
      var showLanguagLabel = this.props.rendermode == "book-page";
      if (this.state.editing && sefaria.is_moderator) {
        // Editing View
        var close_icon = sefaria.is_moderator ? /*#__PURE__*/external_react_default().createElement("i", {
          className: "fa fa-times-circle",
          "aria-hidden": "true",
          onClick: this.closeEditor
        }) : "";
        var licenses = Object.keys(sefaria.getLicenseMap());
        licenses = licenses.includes(v.license) ? licenses : [v.license].concat(licenses);
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionBlock"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "error"
        }, this.state.error), /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionEditForm"
        }, /*#__PURE__*/external_react_default().createElement("label", {
          htmlFor: "versionTitle",
          className: ""
        }, "Version Title"), close_icon, /*#__PURE__*/external_react_default().createElement("input", {
          id: "versionTitle",
          name: "versionTitle",
          className: "",
          type: "text",
          value: this.state.versionTitle,
          onChange: this.handleInputChange
        }), /*#__PURE__*/external_react_default().createElement("label", {
          htmlFor: "versionTitleInHebrew",
          className: ""
        }, "Hebrew Version Title"), /*#__PURE__*/external_react_default().createElement("input", {
          id: "versionTitleInHebrew",
          name: "versionTitleInHebrew",
          className: "",
          type: "text",
          value: this.state.versionTitleInHebrew,
          onChange: this.handleInputChange
        }), /*#__PURE__*/external_react_default().createElement("label", {
          htmlFor: "shortVersionTitle",
          className: ""
        }, "Short Version Title"), /*#__PURE__*/external_react_default().createElement("input", {
          id: "shortVersionTitle",
          name: "shortVersionTitle",
          className: "",
          type: "text",
          value: this.state.shortVersionTitle,
          onChange: this.handleInputChange
        }), /*#__PURE__*/external_react_default().createElement("label", {
          htmlFor: "shortVersionTitleInHebrew",
          className: ""
        }, "Short Hebrew Version Title"), /*#__PURE__*/external_react_default().createElement("input", {
          id: "shortVersionTitleInHebrew",
          name: "shortVersionTitleInHebrew",
          className: "",
          type: "text",
          value: this.state.shortVersionTitleInHebrew,
          onChange: this.handleInputChange
        }), /*#__PURE__*/external_react_default().createElement("label", {
          htmlFor: "versionSource"
        }, "Version Source"), /*#__PURE__*/external_react_default().createElement("input", {
          id: "versionSource",
          name: "versionSource",
          className: "",
          type: "text",
          value: this.state.versionSource,
          onChange: this.handleInputChange
        }), /*#__PURE__*/external_react_default().createElement("label", {
          id: "license_label",
          htmlFor: "license"
        }, "License"), /*#__PURE__*/external_react_default().createElement("select", {
          id: "license",
          name: "license",
          className: "",
          value: this.state.license,
          onChange: this.handleInputChange
        }, licenses.map(function (v) {
          return /*#__PURE__*/external_react_default().createElement("option", {
            key: v,
            value: v
          }, v ? v : "(None Listed)");
        })), /*#__PURE__*/external_react_default().createElement("label", {
          id: "digitzedBySefaria_label",
          htmlFor: "digitzedBySefaria"
        }, "Digitized by Sefaria"), /*#__PURE__*/external_react_default().createElement("input", {
          type: "checkbox",
          id: "digitzedBySefaria",
          name: "digitizedBySefaria",
          checked: this.state.digitizedBySefaria,
          onChange: this.handleInputChange
        }), /*#__PURE__*/external_react_default().createElement("label", {
          id: "priority_label",
          htmlFor: "priority"
        }, "Priority"), /*#__PURE__*/external_react_default().createElement("input", {
          id: "priority",
          name: "priority",
          className: "",
          type: "text",
          value: this.state.priority,
          onChange: this.handleInputChange
        }), /*#__PURE__*/external_react_default().createElement("label", {
          id: "locked_label",
          htmlFor: "locked"
        }, "Locked"), /*#__PURE__*/external_react_default().createElement("input", {
          type: "checkbox",
          id: "locked",
          name: "status",
          checked: this.state.status == "locked",
          onChange: this.handleInputChange
        }), /*#__PURE__*/external_react_default().createElement("label", {
          id: "versionNotes_label",
          htmlFor: "versionNotes"
        }, "VersionNotes"), /*#__PURE__*/external_react_default().createElement("textarea", {
          id: "versionNotes",
          name: "versionNotes",
          placeholder: "Version Notes",
          onChange: this.handleInputChange,
          value: this.state.versionNotes,
          rows: "5",
          cols: "40"
        }), /*#__PURE__*/external_react_default().createElement("label", {
          id: "versionNotesInHebrew_label",
          htmlFor: "versionNotes_in_hebrew"
        }, "Hebrew VersionNotes"), /*#__PURE__*/external_react_default().createElement("textarea", {
          id: "versionNotesInHebrew",
          name: "versionNotesInHebrew",
          placeholder: "Hebrew Version Notes",
          onChange: this.handleInputChange,
          value: this.state.versionNotesInHebrew,
          rows: "5",
          cols: "40"
        }), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("h3", null, "Purchase Information"), /*#__PURE__*/external_react_default().createElement("label", {
          htmlFor: "purchase_url"
        }, "Buy URL (Link to Store Item):"), /*#__PURE__*/external_react_default().createElement("input", {
          id: "purchase_url",
          name: "purchaseInformationURL",
          className: "",
          type: "text",
          value: this.state.purchaseInformationURL,
          onChange: this.handleInputChange
        }), /*#__PURE__*/external_react_default().createElement("label", {
          htmlFor: "purchase_image"
        }, "Buy Image (Image to Display for Link)"), /*#__PURE__*/external_react_default().createElement("input", {
          id: "purchase_image",
          name: "purchaseInformationImage",
          className: "",
          type: "text",
          value: this.state.purchaseInformationImage,
          onChange: this.handleInputChange
        })), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("div", {
          id: "delete_button",
          onClick: this.deleteVersion
        }, "Delete Version"), /*#__PURE__*/external_react_default().createElement("div", {
          id: "save_button",
          onClick: this.saveVersionUpdate
        }, "SAVE"), /*#__PURE__*/external_react_default().createElement("div", {
          className: "clearFix"
        }))));
      } else {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionBlock"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionBlockHeading"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionTitle",
          role: "heading"
        }, /*#__PURE__*/external_react_default().createElement("a", {
          className: vtitle["className"],
          href: this.makeVersionLink('side'),
          onClick: this.onVersionTitleClick
        }, vtitle["text"])), /*#__PURE__*/external_react_default().createElement("i", {
          className: "fa fa-pencil versionEditIcon ".concat(sefaria.is_moderator && this.props.rendermode == "book-page" ? "enabled" : ""),
          "aria-hidden": "true",
          onClick: this.openEditor
        }), /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionLanguage sans-serif"
        }, showLanguagLabel ? sefaria._(sefaria.translateISOLanguageCode(v.actualLanguage)) : "")), /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionSelect sans-serif"
        }, /*#__PURE__*/external_react_default().createElement("a", {
          className: "selectButton ".concat(this.props.isCurrent ? "currSelectButton" : this.isHeTranslation() ? "heTranslation" : ""),
          href: this.makeVersionLink(v.language),
          onClick: this.isHeTranslation() ? this.onVersionTitleClick : this.onSelectVersionClick
        }, this.makeSelectVersionLanguage())), /*#__PURE__*/external_react_default().createElement("div", {
          className: external_classnames_default()(this.makeAttrClassNames({
            "versionNotes": 1,
            "sans-serif": this.props.rendermode == "book-page"
          }, "versionNotes", true))
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "",
          dangerouslySetInnerHTML: {
            __html: vnotes
          }
        }), /*#__PURE__*/external_react_default().createElement("span", {
          className: "versionExtendedNotesLinks ".concat(this.hasExtendedNotes() ? "" : "n-a")
        }, /*#__PURE__*/external_react_default().createElement("a", {
          onClick: this.openExtendedNotes,
          href: "/".concat(this.props.version.title, "/").concat(this.props.version.language, "/").concat(this.props.version.versionTitle, "/notes")
        }, sefaria._("Read More")))), !v.merged ? /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionDetails sans-serif"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionDetailsInformation"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: external_classnames_default()(this.makeAttrClassNames({
            "versionSource": 1,
            "versionDetailsElement": 1
          }, "versionSource"))
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "versionDetailsLabel"
        }, "".concat(sefaria._("Source"), ": ")), /*#__PURE__*/external_react_default().createElement("a", {
          className: "versionDetailsLink",
          href: v.versionSource,
          target: "_blank"
        }, sefaria.util.parseUrl(v.versionSource).host.replace("www.", ""))), /*#__PURE__*/external_react_default().createElement("div", {
          className: external_classnames_default()(this.makeAttrClassNames({
            "versionDigitizedBySefaria": 1,
            "versionDetailsElement": 1
          }, "digitizedBySefaria"))
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "versionDetailsLabel"
        }, "".concat(sefaria._("Digitization"), ": ")), /*#__PURE__*/external_react_default().createElement("a", {
          className: "versionDetailsLink",
          href: "/digitized-by-sefaria",
          target: "_blank"
        }, sefaria._("Sefaria"))), /*#__PURE__*/external_react_default().createElement("div", {
          className: external_classnames_default()(this.makeAttrClassNames({
            "versionLicense": 1,
            "versionDetailsElement": 1
          }, "license"))
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "versionDetailsLabel"
        }, "".concat(sefaria._("License"), ": ")), /*#__PURE__*/external_react_default().createElement("a", {
          className: "versionDetailsLink",
          href: this.makeLicenseLink(),
          target: "_blank"
        }, sefaria._(v === null || v === void 0 ? void 0 : v.license))), /*#__PURE__*/external_react_default().createElement("div", {
          className: external_classnames_default()(this.makeAttrClassNames({
            "versionHistoryLink": 1,
            "versionDetailsElement": 1
          }, null))
        }, /*#__PURE__*/external_react_default().createElement("a", {
          className: "versionDetailsLink",
          href: "/activity/".concat(sefaria.normRef(this.props.currentRef), "/").concat(v.language, "/").concat(v.versionTitle && v.versionTitle.replace(/\s/g, "_")),
          target: "_blank"
        }, sefaria._("Revision History"))), /*#__PURE__*/external_react_default().createElement("div", {
          className: external_classnames_default()(this.makeAttrClassNames({
            "versionBuyLink": 1,
            "versionDetailsElement": 1
          }, "purchaseInformationURL"))
        }, /*#__PURE__*/external_react_default().createElement("a", {
          className: "versionDetailsLink",
          href: v.purchaseInformationURL,
          target: "_blank"
        }, sefaria._("Buy in Print")))), /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionDetailsImage"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: external_classnames_default()(this.makeAttrClassNames({
            "versionBuyImage": 1,
            "versionDetailsElement": 1
          }, "purchaseInformationImage"))
        }, /*#__PURE__*/external_react_default().createElement("a", {
          className: "versionDetailsLink versionDetailsImageLink",
          href: this.makeImageLink(),
          target: "_blank"
        }, /*#__PURE__*/external_react_default().createElement("img", {
          className: "versionImage",
          src: this.makeImageSrc(),
          alt: sefaria._("Buy Now")
        }))))) : null);
      }
    }
  }]);
  return VersionBlock;
}((external_react_class_default()));
VersionBlock.propTypes = {
  version: (external_prop_types_default()).object.isRequired,
  currObjectVersions: (external_prop_types_default()).object.isRequired,
  currentRef: (external_prop_types_default()).string,
  firstSectionRef: (external_prop_types_default()).string,
  showHistory: (external_prop_types_default()).bool,
  showNotes: (external_prop_types_default()).bool,
  openVersionInSidebar: (external_prop_types_default()).func,
  openVersionInReader: (external_prop_types_default()).func,
  isCurrent: (external_prop_types_default()).bool,
  viewExtendedNotes: (external_prop_types_default()).func,
  sidebarDisplay: (external_prop_types_default()).bool,
  rendermode: (external_prop_types_default()).string,
  inTranslationBox: (external_prop_types_default()).bool
};
VersionBlock.defaultProps = {
  showHistory: true,
  showNotes: true,
  sidebarDisplay: false
};
var VersionsBlocksList = /*#__PURE__*/function (_Component2) {
  VersionBlock_inherits(VersionsBlocksList, _Component2);
  var _super2 = VersionBlock_createSuper(VersionsBlocksList);
  function VersionsBlocksList(props) {
    var _this3;
    VersionBlock_classCallCheck(this, VersionsBlocksList);
    _this3 = _super2.call(this, props);
    _this3.state = {
      currentKeys: _this3.getCurrentVersionsKeys(_this3.props.currObjectVersions)
    };
    return _this3;
  }
  VersionBlock_createClass(VersionsBlocksList, [{
    key: "sortVersions",
    value: function sortVersions() {
      var prioritize = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      //sorts the languages of the available versions
      var standard_langs = ["en", "he"];
      //const activeLanguages = Object.values(this.props.currObjectVersions).map(({actualLanguage}) => actualLanguage);
      return Object.keys(this.props.versionsByLanguages).sort(function (a, b) {
        if (!!prioritize && a === prioritize) {
          return -1;
        } else if (!!prioritize && b === prioritize) {
          return 1;
        }
        /*else if (a in standard_langs && !(b in standard_langs))   {return -1;}
        else if (b in standard_langs && !(a in standard_langs))   {return  1;}
        else if (this.props.activeLanguages.includes(a))          {return -1;}
        else if (this.props.activeLanguages.includes(b))          {return  1;}*/else if (a < b) {
          return -1;
        } else if (b < a) {
          return 1;
        } else {
          return 0;
        }
      });
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      this.updateCurrentVersionKeys();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (!sefaria.util.object_equals(this.props.currObjectVersions, prevProps.currObjectVersions)) {
        this.updateCurrentVersionKeys();
      }
    }
  }, {
    key: "updateCurrentVersionKeys",
    value: function updateCurrentVersionKeys() {
      this.setState({
        currentKeys: this.getCurrentVersionsKeys(this.props.currObjectVersions)
      });
    }
  }, {
    key: "isVersionCurrent",
    value: function isVersionCurrent(version) {
      //make versions string key and check if that key is in the current keys array (hashing for morons)
      var actualLanguage = version.actualLanguage,
        versionTitle = version.versionTitle;
      return this.state.currentKeys.includes("".concat(actualLanguage, "|").concat(versionTitle));
    }
  }, {
    key: "getCurrentVersionsKeys",
    value: function getCurrentVersionsKeys(currentVersions) {
      //make an array of strings that are keys of the current versions
      return Object.values(currentVersions).map(function (v) {
        return !!v ? "".concat(v.actualLanguage, "|").concat(v.versionTitle) : "";
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this4 = this;
      var sortedLanguages = this.sortVersions(this.props.sortPrioritizeLanugage);
      if (!this.props.versionsByLanguages) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionsBox"
        }, /*#__PURE__*/external_react_default().createElement(LoadingMessage, null));
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "versionsBox"
      }, sortedLanguages.map(function (lang) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          key: lang
        }, _this4.props.showLanguageHeaders ? /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionLanguage sans-serif"
        }, sefaria._(sefaria.translateISOLanguageCode(lang)), /*#__PURE__*/external_react_default().createElement("span", {
          className: "enInHe connectionsCount"
        }, " (".concat(_this4.props.versionsByLanguages[lang].length, ")"))) : null, _this4.props.versionsByLanguages[lang].map(function (v) {
          return /*#__PURE__*/external_react_default().createElement(VersionBlock, {
            rendermode: "versions-box",
            sidebarDisplay: true,
            version: v,
            currObjectVersions: _this4.props.currObjectVersions,
            currentRef: _this4.props.currentRef,
            firstSectionRef: "firstSectionRef" in v ? v.firstSectionRef : null,
            key: "".concat(_this4.isVersionCurrent(v) ? "current" : "", "|").concat(v.versionTitle, "|").concat(v.actualLanguage),
            openVersionInReader: _this4.props.openVersionInReader,
            openVersionInSidebar: _this4.props.openVersionInSidebar,
            viewExtendedNotes: _this4.props.viewExtendedNotes,
            isCurrent: _this4.isVersionCurrent(v),
            inTranslationBox: _this4.props.inTranslationBox
          });
        }));
      }));
    }
  }]);
  return VersionsBlocksList;
}((external_react_class_default()));
VersionsBlocksList.propTypes = {
  versionsByLanguages: (external_prop_types_default()).object.isRequired,
  currObjectVersions: (external_prop_types_default()).object,
  displayCurrentVersions: (external_prop_types_default()).bool,
  sortPrioritizeLanugage: (external_prop_types_default()).string,
  currentRef: (external_prop_types_default()).string,
  openVersionInReader: (external_prop_types_default()).func,
  openVersionInSidebar: (external_prop_types_default()).func,
  viewExtendedNotes: (external_prop_types_default()).func,
  showLanguageHeaders: (external_prop_types_default()).bool,
  inTranslationBox: (external_prop_types_default()).bool
};
VersionsBlocksList.defaultProps = {
  displayCurrentVersions: true,
  showLanguageHeaders: true
};

;// CONCATENATED MODULE: ../static/js/ExtendedNotes.jsx
function ExtendedNotes_typeof(obj) { "@babel/helpers - typeof"; return ExtendedNotes_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, ExtendedNotes_typeof(obj); }
function ExtendedNotes_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function ExtendedNotes_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, ExtendedNotes_toPropertyKey(descriptor.key), descriptor); } }
function ExtendedNotes_createClass(Constructor, protoProps, staticProps) { if (protoProps) ExtendedNotes_defineProperties(Constructor.prototype, protoProps); if (staticProps) ExtendedNotes_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function ExtendedNotes_toPropertyKey(arg) { var key = ExtendedNotes_toPrimitive(arg, "string"); return ExtendedNotes_typeof(key) === "symbol" ? key : String(key); }
function ExtendedNotes_toPrimitive(input, hint) { if (ExtendedNotes_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (ExtendedNotes_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function ExtendedNotes_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) ExtendedNotes_setPrototypeOf(subClass, superClass); }
function ExtendedNotes_setPrototypeOf(o, p) { ExtendedNotes_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return ExtendedNotes_setPrototypeOf(o, p); }
function ExtendedNotes_createSuper(Derived) { var hasNativeReflectConstruct = ExtendedNotes_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = ExtendedNotes_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = ExtendedNotes_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return ExtendedNotes_possibleConstructorReturn(this, result); }; }
function ExtendedNotes_possibleConstructorReturn(self, call) { if (call && (ExtendedNotes_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return ExtendedNotes_assertThisInitialized(self); }
function ExtendedNotes_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function ExtendedNotes_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function ExtendedNotes_getPrototypeOf(o) { ExtendedNotes_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return ExtendedNotes_getPrototypeOf(o); }





var ExtendedNotes = /*#__PURE__*/function (_Component) {
  ExtendedNotes_inherits(ExtendedNotes, _Component);
  var _super = ExtendedNotes_createSuper(ExtendedNotes);
  function ExtendedNotes(props) {
    var _this;
    ExtendedNotes_classCallCheck(this, ExtendedNotes);
    _this = _super.call(this, props);
    _this.state = {
      'notesLanguage': sefaria.interfaceLang,
      'extendedNotes': '',
      'langToggle': false
    };
    return _this;
  }
  ExtendedNotes_createClass(ExtendedNotes, [{
    key: "getVersionData",
    value: function getVersionData(versionList) {
      var versionTitle = this.props.currVersions['en'] ? this.props.currVersions['en'] : this.props.currVersions['he'];
      var thisVersion = versionList.filter(function (x) {
        return x.versionTitle === versionTitle;
      })[0];
      var extendedNotes = {
        'english': thisVersion.extendedNotes,
        'hebrew': thisVersion.extendedNotesHebrew
      };
      if (extendedNotes.english && extendedNotes.hebrew) {
        this.setState({
          'extendedNotes': extendedNotes,
          'langToggle': true
        });
      } else if (extendedNotes.english && !extendedNotes.hebrew) {
        this.setState({
          'extendedNotes': extendedNotes,
          'notesLanguage': 'english'
        });
      } else if (extendedNotes.hebrew && !extendedNotes.english) {
        this.setState({
          'extendedNotes': extendedNotes,
          'notesLanguage': 'hebrew'
        });
      } else {
        this.props.backFromExtendedNotes();
      }
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this2 = this;
      // use Sefaria.getVersions(ref, cb), where cb will invoke setState
      sefaria.getVersions(this.props.title).then(function (versions) {
        _this2.getVersionData(Object.values(versions).flat());
      });
    }
  }, {
    key: "goBack",
    value: function goBack(event) {
      event.preventDefault();
      this.props.backFromExtendedNotes();
    }
  }, {
    key: "changeLanguage",
    value: function changeLanguage(event) {
      event.preventDefault();
      if (this.state.notesLanguage === 'english') {
        this.setState({
          'notesLanguage': 'hebrew'
        });
      } else {
        this.setState({
          'notesLanguage': 'english'
        });
      }
    }
  }, {
    key: "render",
    value: function render() {
      var notes = '';
      if (this.state.extendedNotes) {
        notes = this.state.extendedNotes[this.state.notesLanguage];
        if (this.state.notesLanguage === 'hebrew' && !notes) {
          notes = 'לא קיימים רשימות מורחבות בשפה העברית עבור גרסה זו';
        } else if (this.state.notesLanguage === 'english' && !notes) {
          notes = 'Extended notes in English do not exist for this version';
        }
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "extendedNotes"
      }, this.props.backFromExtendedNotes ? /*#__PURE__*/external_react_default().createElement("a", {
        onClick: this.goBack,
        href: "".concat(this.props.title)
      }, sefaria.interfaceLang === "hebrew" ? "חזור" : "Back") : "", this.state.extendedNotes ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "extendedNotesText",
        dangerouslySetInnerHTML: {
          __html: notes
        }
      }) : /*#__PURE__*/external_react_default().createElement(LoadingMessage, null), this.state.langToggle ? /*#__PURE__*/external_react_default().createElement("a", {
        onClick: this.changeLanguage,
        href: "".concat(this.props.title)
      }, this.state.notesLanguage === 'english' ? 'עברית' : 'English') : '');
    }
  }]);
  return ExtendedNotes;
}((external_react_class_default()));
ExtendedNotes.PropTypes = {
  currVersions: (external_prop_types_default()).object.isRequired,
  title: (external_prop_types_default()).string.isRequired,
  backFromExtendedNotes: (external_prop_types_default()).func
};
/* harmony default export */ const js_ExtendedNotes = (ExtendedNotes);
;// CONCATENATED MODULE: ../static/js/BookPage.jsx
function BookPage_typeof(obj) { "@babel/helpers - typeof"; return BookPage_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, BookPage_typeof(obj); }
var _this5 = undefined;
function BookPage_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ BookPage_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == BookPage_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function BookPage_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function BookPage_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { BookPage_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { BookPage_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function BookPage_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = BookPage_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function BookPage_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function BookPage_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? BookPage_ownKeys(Object(source), !0).forEach(function (key) { BookPage_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : BookPage_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function BookPage_defineProperty(obj, key, value) { key = BookPage_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function BookPage_slicedToArray(arr, i) { return BookPage_arrayWithHoles(arr) || BookPage_iterableToArrayLimit(arr, i) || BookPage_unsupportedIterableToArray(arr, i) || BookPage_nonIterableRest(); }
function BookPage_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function BookPage_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return BookPage_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return BookPage_arrayLikeToArray(o, minLen); }
function BookPage_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function BookPage_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function BookPage_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function BookPage_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function BookPage_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, BookPage_toPropertyKey(descriptor.key), descriptor); } }
function BookPage_createClass(Constructor, protoProps, staticProps) { if (protoProps) BookPage_defineProperties(Constructor.prototype, protoProps); if (staticProps) BookPage_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function BookPage_toPropertyKey(arg) { var key = BookPage_toPrimitive(arg, "string"); return BookPage_typeof(key) === "symbol" ? key : String(key); }
function BookPage_toPrimitive(input, hint) { if (BookPage_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (BookPage_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function BookPage_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) BookPage_setPrototypeOf(subClass, superClass); }
function BookPage_setPrototypeOf(o, p) { BookPage_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return BookPage_setPrototypeOf(o, p); }
function BookPage_createSuper(Derived) { var hasNativeReflectConstruct = BookPage_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = BookPage_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = BookPage_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return BookPage_possibleConstructorReturn(this, result); }; }
function BookPage_possibleConstructorReturn(self, call) { if (call && (BookPage_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return BookPage_assertThisInitialized(self); }
function BookPage_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function BookPage_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function BookPage_getPrototypeOf(o) { BookPage_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return BookPage_getPrototypeOf(o); }


















var BookPage = /*#__PURE__*/function (_Component) {
  BookPage_inherits(BookPage, _Component);
  var _super = BookPage_createSuper(BookPage);
  // Menu for the Table of Contents for a single text
  function BookPage(props) {
    var _this;
    BookPage_classCallCheck(this, BookPage);
    _this = _super.call(this, props);
    _this.state = {
      versions: [],
      versionsLoaded: false,
      currentVersion: null,
      currObjectVersions: {
        en: null,
        he: null
      },
      indexDetails: sefaria.getIndexDetailsFromCache(props.title),
      dlVersionTitle: null,
      dlVersionLanguage: null,
      dlVersionFormat: null,
      dlReady: false
    };
    return _this;
  }
  BookPage_createClass(BookPage, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.loadData();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (this.props.settingsLanguage != prevProps.settingsLanguage) {
        this.forceUpdate();
      }
    }
  }, {
    key: "getDataRef",
    value: function getDataRef() {
      // Returns ref to be used to looking up data
      return sefaria.sectionRef(this.props.currentRef) || this.props.currentRef;
    }
  }, {
    key: "getData",
    value: function getData() {
      // Gets data about this text from cache, which may be null.
      return sefaria.text(this.getDataRef(), {
        context: 1,
        enVersion: this.props.currVersions.en,
        heVersion: this.props.currVersions.he
      });
    }
  }, {
    key: "loadData",
    value: function loadData() {
      var _this2 = this;
      // Ensures data this text is in cache, rerenders after data load if needed
      sefaria.getIndexDetails(this.props.title).then(function (data) {
        return _this2.setState({
          indexDetails: data
        });
      });
      if (this.isBookToc() && !this.props.compare) {
        if (!this.state.versionsLoaded) {
          sefaria.getVersions(this.props.title).then(function (result) {
            _this2.onVersionsLoad(Object.values(result).flat());
          });
        }
      }
    }
  }, {
    key: "onVersionsLoad",
    value: function onVersionsLoad(versions) {
      this.setState({
        versions: versions,
        currObjectVersions: this.makeFullCurrentVersionsObjects(versions),
        versionsLoaded: true
      });
    }
  }, {
    key: "makeFullCurrentVersionsObjects",
    value: function makeFullCurrentVersionsObjects(versions) {
      //build full versions of current object versions
      var currObjectVersions = {
        en: null,
        he: null
      };
      var _loop = function _loop() {
        var _ref = _Object$entries[_i2];
        _ref2 = BookPage_slicedToArray(_ref, 2);
        var lang = _ref2[0];
        var ver = _ref2[1];
        if (!!ver) {
          var fullVer = versions.find(function (version) {
            return version.versionTitle == ver && version.language == lang;
          });
          currObjectVersions[lang] = fullVer ? fullVer : null;
        }
      };
      for (var _i2 = 0, _Object$entries = Object.entries(this.props.currVersions); _i2 < _Object$entries.length; _i2++) {
        var _ref2;
        _loop();
      }
      return currObjectVersions;
    }
  }, {
    key: "getCurrentVersion",
    value: function getCurrentVersion() {
      // For now treat bilingual as english. TODO show attribution for 2 versions in bilingual case.
      if (this.isBookToc()) {
        return null;
      }
      var d = this.getData();
      if (!d) {
        return null;
      }
      var currentLanguage = this.props.settingsLanguage == "he" ? "he" : "en";
      if (currentLanguage == "en" && !d.text.length) {
        currentLanguage = "he";
      }
      if (currentLanguage == "he" && !d.he.length) {
        currentLanguage = "en";
      }
      var currObjectVersions;
      if (this.state.versions.length) {
        currObjectVersions = this.state.currObjectVersions;
      } else {
        currObjectVersions = this.makeFullCurrentVersionsObjects(d.versions);
      }
      var currentVersion = BookPage_objectSpread(BookPage_objectSpread({}, currObjectVersions[currentLanguage]), {
        language: currentLanguage,
        versionTitle: currentLanguage == "he" ? d.heVersionTitle : d.versionTitle,
        versionSource: currentLanguage == "he" ? d.heVersionSource : d.versionSource,
        versionStatus: currentLanguage == "he" ? d.heVersionStatus : d.versionStatus,
        license: currentLanguage == "he" ? d.heLicense : d.license,
        sources: currentLanguage == "he" ? d.heSources : d.sources,
        versionNotes: currentLanguage == "he" ? d.heVersionNotes : d.versionNotes,
        digitizedBySefaria: currentLanguage == "he" ? d.heDigitizedBySefaria : d.digitizedBySefaria,
        versionTitleInHebrew: currentLanguage == "he" ? d.heVersionTitleInHebrew : d.VersionTitleInHebrew,
        shortVersionTitle: currentLanguage == "he" ? d.heShortVersionTitle : d.shortVersionTitle,
        shortVersionTitleInHebrew: currentLanguage == "he" ? d.heShortVersionTitleInHebrew : d.shortVersionTitleInHebrew,
        versionNotesInHebrew: currentLanguage == "he" ? d.heVersionNotesInHebrew : d.VersionNotesInHebrew,
        extendedNotes: currentLanguage == "he" ? d.heExtendedNotes : d.extendedNotes,
        extendedNotesHebrew: currentLanguage == "he" ? d.extendedNotesHebrew : d.heExtendedNotesHebrew
      });
      currentVersion.merged = !!currentVersion.sources;
      return currentVersion;
    }
  }, {
    key: "openVersion",
    value: function openVersion(version, language) {
      // Selects a version and closes this menu to show it.
      // Calling this functon wihtout parameters resets to default
      this.props.selectVersion(version, language);
      this.props.close();
    }
  }, {
    key: "isBookToc",
    value: function isBookToc() {
      return this.props.mode == "book toc";
    }
  }, {
    key: "isTextToc",
    value: function isTextToc() {
      return this.props.mode == "text toc";
    }
  }, {
    key: "extendedNotesBack",
    value: function extendedNotesBack(event) {
      return null;
    }
  }, {
    key: "render",
    value: function render() {
      var title = this.props.title;
      var index = sefaria.index(title);
      var heTitle = index ? index.heTitle : title;
      var category = this.props.category;
      var isDictionary = this.state.indexDetails && !!this.state.indexDetails.lexiconName;
      var categories = sefaria.index(this.props.title).categories;
      var currObjectVersions = this.state.currObjectVersions;
      var catUrl;
      if (category == "Commentary") {
        var baseCategory = index.categories[0];
        var commCategory = index.categories.find(function (x) {
          return x === "Commentary" || x.includes(" on ".concat(baseCategory));
        }); //this finds commentary categories in Mishnah, Talmud and Tanakh such as "Rishonim on Tanakh"
        var urlCategories = index.categories.slice(0, index.categories.indexOf(commCategory || baseCategory) + 1);
        catUrl = "/texts/".concat(urlCategories.join("/"));
      } else if (category == "Targum" || category == "Guides") {
        catUrl = "/texts/" + index.categories.slice(0, index.categories.indexOf(category) + 1).join("/");
      } else if (category == "Talmud") {
        catUrl = "/texts/" + index.categories.slice(0, index.categories.indexOf("Talmud") + 2).join("/");
      } else {
        catUrl = "/texts/" + category;
      }
      var readButton = !this.state.indexDetails || this.isTextToc() || this.props.compare ? null : sefaria.lastPlaceForText(title) ? /*#__PURE__*/external_react_default().createElement("a", {
        className: "button small readButton",
        href: "/" + sefaria.normRef(sefaria.lastPlaceForText(title).ref)
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Continue Reading")) : /*#__PURE__*/external_react_default().createElement("a", {
        className: "button small readButton",
        href: "/" + sefaria.normRef(this.state.indexDetails["firstSectionRef"])
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Start Reading"));
      var tabs = [{
        id: "contents",
        title: {
          en: "Contents",
          he: sefaria._("Contents")
        }
      }];
      if (this.isBookToc()) {
        tabs.push({
          id: "versions",
          title: {
            en: "Versions",
            he: sefaria._("Versions")
          }
        });
      }
      var renderTab = function renderTab(t) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: external_classnames_default()({
            tab: 1,
            noselect: 1
          })
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
          text: t.title
        }), t.icon ? /*#__PURE__*/external_react_default().createElement("img", {
          src: t.icon,
          alt: "".concat(t.title.en, " icon")
        }) : null);
      };
      var sidebarModules = !this.state.indexDetails ? [] : [this.props.multiPanel ? {
        type: "AboutText",
        props: {
          index: this.state.indexDetails
        }
      } : {
        type: null
      }, {
        type: "Promo"
      }, {
        type: "RelatedTopics",
        props: {
          title: this.props.title
        }
      }, !isDictionary ? {
        type: "DownloadVersions",
        props: {
          sref: this.props.title
        }
      } : {
        type: null
      }];
      var classes = external_classnames_default()({
        bookPage: 1,
        readerNavMenu: 1,
        fullBookPage: this.isBookToc(),
        narrowPanel: this.props.narrowPanel,
        compare: this.props.compare,
        noLangToggleInHebrew: sefaria.interfaceLang === 'hebrew'
      });
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes
      }, /*#__PURE__*/external_react_default().createElement(CategoryColorLine, {
        category: category
      }), this.isTextToc() || this.props.compare ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerControls"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerControlsInner"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "leftButtons"
      }, this.props.compare ? /*#__PURE__*/external_react_default().createElement(MenuButton, {
        onClick: this.props.onCompareBack,
        compare: true
      }) : /*#__PURE__*/external_react_default().createElement(CloseButton, {
        onClick: this.props.close
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerTextToc readerTextTocHeader"
      }, this.props.compare ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerTextTocBox"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, title)) : /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerTextTocBox sans-serif"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Table of Contents"))), /*#__PURE__*/external_react_default().createElement("div", {
        className: "rightButtons"
      }, sefaria.interfaceLang !== "hebrew" ? /*#__PURE__*/external_react_default().createElement(DisplaySettingsButton, {
        onClick: this.props.openDisplaySettings
      }) : /*#__PURE__*/external_react_default().createElement(DisplaySettingsButton, {
        placeholder: true
      }))))) : null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "content"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sidebarLayout"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "contentInner followsContentLang"
      }, this.props.compare ? null : /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocTop"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocTitle",
        role: "heading",
        "aria-level": "1"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocTitleControls"
      }, /*#__PURE__*/external_react_default().createElement(CategoryHeader, {
        type: "books",
        buttonsToDisplay: ["section", "edit"],
        data: title
      }, /*#__PURE__*/external_react_default().createElement(ContentText, {
        text: {
          en: title,
          he: heTitle
        }
      }))), this.props.multiPanel && this.props.toggleLanguage && sefaria.interfaceLang !== "hebrew" && sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement(LanguageToggleButton, {
        toggleLanguage: this.props.toggleLanguage
      }) : null), /*#__PURE__*/external_react_default().createElement("a", {
        className: "tocCategory",
        href: catUrl
      }, /*#__PURE__*/external_react_default().createElement(ContentText, {
        text: {
          en: category,
          he: sefaria.hebrewTerm(category)
        }
      })), /*#__PURE__*/external_react_default().createElement(CategoryAttribution, {
        categories: categories,
        asEdition: true
      }), this.state.indexDetails && this.state.indexDetails.dedication ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "dedication"
      }, /*#__PURE__*/external_react_default().createElement("span", null, /*#__PURE__*/external_react_default().createElement(ContentText, {
        html: {
          en: this.state.indexDetails.dedication.en,
          he: this.state.indexDetails.dedication.he
        }
      }))) : null), this.state.indexDetails ? /*#__PURE__*/external_react_default().createElement("div", null, readButton, this.props.multiPanel ? null : /*#__PURE__*/external_react_default().createElement("div", {
        className: "about"
      }, /*#__PURE__*/external_react_default().createElement(Modules, {
        type: "AboutText",
        props: {
          index: this.state.indexDetails,
          hideTitle: true
        }
      })), /*#__PURE__*/external_react_default().createElement(TabView, {
        tabs: tabs,
        currTabName: this.props.tab,
        setTab: this.props.setTab,
        renderTab: renderTab,
        containerClasses: "largeTabs"
      }, /*#__PURE__*/external_react_default().createElement(TextTableOfContents, {
        narrowPanel: this.props.narrowPanel,
        title: this.props.title,
        close: this.props.close,
        showBaseText: this.props.showBaseText,
        currVersions: this.props.currVersions
      }), /*#__PURE__*/external_react_default().createElement(VersionsList, {
        currObjectVersions: currObjectVersions,
        openVersionInReader: this.openVersion,
        currentRef: this.props.currentRef,
        viewExtendedNotes: this.props.viewExtendedNotes
      }))) : /*#__PURE__*/external_react_default().createElement(LoadingMessage, null)), this.isBookToc() && !this.props.compare ? /*#__PURE__*/external_react_default().createElement(NavSidebar, {
        modules: sidebarModules
      }) : null), this.isBookToc() && !this.props.compare ? /*#__PURE__*/external_react_default().createElement(js_Footer, null) : null));
    }
  }]);
  return BookPage;
}((external_react_class_default()));
BookPage.propTypes = {
  mode: (external_prop_types_default()).string.isRequired,
  title: (external_prop_types_default()).string.isRequired,
  category: (external_prop_types_default()).string.isRequired,
  currentRef: (external_prop_types_default()).string.isRequired,
  settingsLanguage: (external_prop_types_default()).string.isRequired,
  currVersions: (external_prop_types_default()).object.isRequired,
  compare: (external_prop_types_default()).bool,
  narrowPanel: (external_prop_types_default()).bool,
  close: (external_prop_types_default()).func.isRequired,
  showBaseText: (external_prop_types_default()).func.isRequired,
  selectVersion: (external_prop_types_default()).func,
  viewExtendedNotes: (external_prop_types_default()).func,
  onCompareBack: (external_prop_types_default()).func,
  backFromExtendedNotes: (external_prop_types_default()).func,
  extendedNotes: (external_prop_types_default()).string,
  extendedNotesHebrew: (external_prop_types_default()).string
};
var TextTableOfContents = /*#__PURE__*/function (_Component2) {
  BookPage_inherits(TextTableOfContents, _Component2);
  var _super2 = BookPage_createSuper(TextTableOfContents);
  // The content section of the text table of contents that includes links to text sections,
  // and tabs for alternate structures and commentary.

  function TextTableOfContents(props) {
    var _this3;
    BookPage_classCallCheck(this, TextTableOfContents);
    _this3 = _super2.call(this, props);
    _this3.state = {
      tab: "schema",
      indexDetails: sefaria.getIndexDetailsFromCache(props.title)
    };
    return _this3;
  }
  BookPage_createClass(TextTableOfContents, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.loadData();
      this.scrollToCurrent();
    }
  }, {
    key: "loadData",
    value: function loadData() {
      var _this4 = this;
      // Ensures data this text is in cache, rerenders after data load if needed
      sefaria.getIndexDetails(this.props.title).then(function (data) {
        _this4.setState({
          indexDetails: data,
          tab: _this4.getDefaultActiveTab(data)
        });
        _this4.scrollToCurrent();
      });
    }
  }, {
    key: "annotateTorahAltDisplayProperties",
    value: function annotateTorahAltDisplayProperties(altStructSchema) {
      var _iterator = BookPage_createForOfIteratorHelper(altStructSchema.nodes),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var node = _step.value;
          node["displayFixedTitleSubSections"] = true;
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
    }
  }, {
    key: "scrollToCurrent",
    value: function scrollToCurrent() {
      var curr = document.querySelector(".current");
      if (curr) {
        sefaria.util.scrollIntoViewIfNeeded(curr, {
          block: "center"
        });
      }
    }
  }, {
    key: "getDefaultActiveTab",
    value: function getDefaultActiveTab(indexDetails) {
      return "default_struct" in indexDetails && indexDetails.default_struct in (indexDetails === null || indexDetails === void 0 ? void 0 : indexDetails.alts) ? indexDetails.default_struct : "schema";
    }
  }, {
    key: "setTab",
    value: function setTab(tab) {
      this.setState({
        tab: tab
      });
    }
  }, {
    key: "handleClick",
    value: function handleClick(e) {
      var $a = sefariaJquery(e.target).closest("a");
      if ($a.length && ($a.hasClass("sectionLink") || $a.hasClass("linked"))) {
        var _this$props;
        var ref = $a.attr("data-ref");
        ref = decodeURIComponent(ref);
        ref = sefaria.humanRef(ref);
        if ((_this$props = this.props) !== null && _this$props !== void 0 && _this$props.close) {
          this.props.close();
        }
        this.props.navigatePanel ? this.props.navigatePanel(ref, this.props.currVersions) : this.props.showBaseText(ref, false, this.props.currVersions);
        e.preventDefault();
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this$state$indexDeta, _this$state$indexDeta2, _this$state$indexDeta3;
      if (this.state.indexDetails == null) {
        return /*#__PURE__*/external_react_default().createElement(LoadingMessage, null);
      }
      var isTorah = ["Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy"].indexOf(this.props.title) > -1;
      var isDictionary = (_this$state$indexDeta = this.state.indexDetails) === null || _this$state$indexDeta === void 0 ? void 0 : _this$state$indexDeta.lexiconName;
      var defaultStruct = this.getDefaultActiveTab(this.state.indexDetails);
      var excludedStructs = ((_this$state$indexDeta2 = this.state.indexDetails) === null || _this$state$indexDeta2 === void 0 ? void 0 : _this$state$indexDeta2.exclude_structs) || [];
      var alts = ((_this$state$indexDeta3 = this.state.indexDetails) === null || _this$state$indexDeta3 === void 0 ? void 0 : _this$state$indexDeta3.alts) || {};
      if (isTorah) {
        //add a dummy prop (maybe later add to actual db) to indicate the special display case for this alt struct. 
        // Showing both linked title and subsections
        this.annotateTorahAltDisplayProperties(alts["Parasha"]);
      }
      var structTabOptions = [];
      if (!excludedStructs.includes("schema")) {
        var _this$state$indexDeta4;
        structTabOptions.push({
          name: "schema",
          text: "sectionNames" in ((_this$state$indexDeta4 = this.state.indexDetails) === null || _this$state$indexDeta4 === void 0 ? void 0 : _this$state$indexDeta4.schema) ? this.state.indexDetails.schema.sectionNames[0] : "Contents",
          onPress: this.setTab.bind(null, "schema")
        });
      }
      for (var alt in alts) {
        if (alts.hasOwnProperty(alt) && !excludedStructs.includes(alt)) {
          structTabOptions.push({
            name: alt,
            text: alt,
            onPress: this.setTab.bind(null, alt)
          });
        }
      }
      structTabOptions = structTabOptions.sort(function (a, b) {
        return a.name == defaultStruct ? -1 : b.name == defaultStruct ? 1 : 0;
      }.bind(this));
      var showToggle = !(isDictionary || isTorah) && structTabOptions.length > 1;
      var toggleNames = showToggle ? structTabOptions.map(function (x) {
        return x.text;
      }) : [];
      var toggle = showToggle ? /*#__PURE__*/external_react_default().createElement(TabbedToggleSet, {
        tabOptions: structTabOptions,
        activeTab: this.state.tab,
        narrowPanel: this.props.narrowPanel
      }) : null;
      var dictionarySearch = isDictionary ? /*#__PURE__*/external_react_default().createElement(js_DictionarySearch, {
        lexiconName: this.state.indexDetails.lexiconName,
        title: this.props.title,
        showBaseText: this.props.showBaseText,
        navigatePanel: this.props.navigatePanel,
        contextSelector: ".textTableOfContents",
        currVersions: this.props.currVersions
      }) : null;
      var content;
      switch (this.state.tab) {
        case "schema":
          if (isTorah) {
            content = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement(SchemaNode, {
              schema: this.state.indexDetails.schema,
              topToggleTitles: toggleNames,
              addressTypes: this.state.indexDetails.schema.addressTypes,
              refPath: this.props.title,
              topLevel: true,
              topLevelHeader: "Chapters",
              currentlyVisibleRef: this.props.currentlyVisibleRef,
              currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef
            }), /*#__PURE__*/external_react_default().createElement("div", {
              className: "torahNavParshiot"
            }, /*#__PURE__*/external_react_default().createElement(SchemaNode, {
              schema: alts["Parasha"],
              addressTypes: alts["Parasha"]["nodes"][0]["addressTypes"],
              refPath: this.props.title,
              topLevel: true,
              topLevelHeader: "Torah Portions",
              disableSubCollapse: true,
              currentlyVisibleRef: this.props.currentlyVisibleRef,
              currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef
            })));
          } else {
            content = /*#__PURE__*/external_react_default().createElement(SchemaNode, {
              schema: this.state.indexDetails.schema,
              topToggleTitles: toggleNames,
              addressTypes: this.state.indexDetails.schema.addressTypes,
              refPath: this.props.title,
              topLevel: true,
              currentlyVisibleRef: this.props.currentlyVisibleRef,
              currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef
            });
          }
          break;
        default:
          content = /*#__PURE__*/external_react_default().createElement(SchemaNode, {
            schema: alts[this.state.tab],
            addressTypes: this.state.indexDetails.schema.addressTypes,
            refPath: this.props.title,
            topLevel: true,
            currentlyVisibleRef: this.props.currentlyVisibleRef,
            currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef
          });
          break;
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        onClick: this.handleClick
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "textTableOfContents"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocTools"
      }, toggle, dictionarySearch), /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocContent"
      }, content)));
    }
  }]);
  return TextTableOfContents;
}((external_react_class_default()));
TextTableOfContents.propTypes = {
  title: (external_prop_types_default()).string.isRequired,
  narrowPanel: (external_prop_types_default()).bool,
  close: (external_prop_types_default()).func,
  showBaseText: (external_prop_types_default()).func,
  currVersions: (external_prop_types_default()).object
};
var TabbedToggleSet = function TabbedToggleSet(_ref3) {
  var tabOptions = _ref3.tabOptions,
    activeTab = _ref3.activeTab,
    narrowPanel = _ref3.narrowPanel;
  var options = tabOptions.map(function (option, i) {
    var handleClick = function (e) {
      e.preventDefault();
      option.onPress();
    }.bind(this);
    var classes = external_classnames_default()({
      altStructToggle: 1,
      "sans-serif": 1,
      active: activeTab === option.name
    });
    var url = sefaria.util.replaceUrlParam("tab", option.name);
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "altStructToggleBox",
      key: i
    }, /*#__PURE__*/external_react_default().createElement("a", {
      className: classes,
      onClick: handleClick,
      href: url
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, option.text)));
  }.bind(_this5));
  var rows = [];
  if (narrowPanel) {
    var rowSize = options.length == 4 ? 2 : 3;
    for (var i = 0; i < options.length; i += rowSize) {
      rows.push(options.slice(i, i + rowSize));
    }
  } else {
    rows = [options];
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "structToggles"
  }, rows.map(function (row, i) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "structTogglesInner",
      key: i
    }, row);
  }));
};
TabbedToggleSet.propTypes = {
  tabOptions: (external_prop_types_default()).array.isRequired,
  // array of object with `name`. `text`, `heText`, `onPress`
  activeTab: (external_prop_types_default()).string.isRequired,
  narrowPanel: (external_prop_types_default()).bool
};
var SchemaNode = /*#__PURE__*/function (_Component3) {
  BookPage_inherits(SchemaNode, _Component3);
  var _super3 = BookPage_createSuper(SchemaNode);
  function SchemaNode(props) {
    var _this6;
    BookPage_classCallCheck(this, SchemaNode);
    _this6 = _super3.call(this, props);
    _this6.state = {
      // Collapse nodes below top level, and those that aren't default or makred includedSections
      collapsed: "nodes" in props.schema && !(props.topLevel || props.disableSubCollapse) ? props.schema.nodes.map(function (node) {
        return !(node["default"] || node.includeSections);
      }) : []
    };
    return _this6;
  }
  BookPage_createClass(SchemaNode, [{
    key: "toggleCollapse",
    value: function toggleCollapse(i) {
      if (this.props.disableSubCollapse) return;
      this.state.collapsed[i] = !this.state.collapsed[i];
      this.setState({
        collapsed: this.state.collapsed
      });
    }
  }, {
    key: "render",
    value: function render() {
      if (!("nodes" in this.props.schema)) {
        if (this.props.schema.nodeType === "JaggedArrayNode") {
          return /*#__PURE__*/external_react_default().createElement(JaggedArrayNode, {
            schema: this.props.schema,
            topToggleTitles: this.props.topToggleTitles,
            refPath: this.props.refPath,
            topLevel: this.props.topLevel,
            topLevelHeader: this.props.topLevelHeader,
            currentlyVisibleRef: this.props.currentlyVisibleRef,
            currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef
          });
        } else if (this.props.schema.nodeType === "ArrayMapNode") {
          return /*#__PURE__*/external_react_default().createElement(ArrayMapNode, {
            schema: this.props.schema,
            currentlyVisibleRef: this.props.currentlyVisibleRef,
            currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef
          });
        } else if (this.props.schema.nodeType === "DictionaryNode") {
          return /*#__PURE__*/external_react_default().createElement(DictionaryNode, {
            schema: this.props.schema,
            currentlyVisibleRef: this.props.currentlyVisibleRef,
            currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef
          });
        }
      } else {
        //we do have subcontent
        var content = this.props.schema.nodes.map(function (node, i) {
          var _this7 = this;
          var path;
          if (node.nodeType == "ArrayMapNode") {
            //ArrayMapNode content
            path = this.props.refPath + ", " + node.title;
            return /*#__PURE__*/external_react_default().createElement(ArrayMapNode, {
              schema: node,
              currentlyVisibleRef: this.props.currentlyVisibleRef,
              currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef,
              key: path
            });
          } else if ("nodes" in node) {
            // SchemaNode with children (nodes)
            path = this.props.refPath + ", " + node.title;
            return /*#__PURE__*/external_react_default().createElement("div", {
              className: "schema-node-toc",
              "data-ref": path,
              key: path
            }, /*#__PURE__*/external_react_default().createElement("span", {
              className: "schema-node-title ".concat(this.state.collapsed[i] ? "collapsed" : "open", " ").concat(this.props.disableSubCollapse ? "fixed" : ""),
              onClick: function onClick() {
                _this7.toggleCollapse(i);
              },
              onKeyPress: function onKeyPress(e) {
                e.charCode == 13 ? _this7.toggleCollapse(i) : null;
              },
              role: "heading",
              "aria-level": "3",
              "aria-hidden": "true",
              tabIndex: 0
            }, /*#__PURE__*/external_react_default().createElement(ContentText, {
              text: {
                en: node.title,
                he: node.heTitle
              }
            })), !this.state.collapsed[i] ? /*#__PURE__*/external_react_default().createElement("div", {
              className: "schema-node-contents"
            }, /*#__PURE__*/external_react_default().createElement(SchemaNode, {
              schema: node,
              refPath: this.props.refPath + ", " + node.title,
              topToggleTitles: this.props.topToggleTitles,
              currentlyVisibleRef: this.props.currentlyVisibleRef,
              currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef
            })) : null);
          } else if (node.nodeType == "DictionaryNode") {
            return /*#__PURE__*/external_react_default().createElement(DictionaryNode, {
              schema: node,
              currentlyVisibleRef: this.props.currentlyVisibleRef,
              currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef,
              key: i
            });
          } else if (node.depth == 1 && !node["default"]) {
            var _this$props2;
            // SchemaNode title that points straight to content
            //we check if this happens to be where the reader is currently at
            path = this.props.refPath + ", " + node.title;
            var currentPlace = path == ((_this$props2 = this.props) === null || _this$props2 === void 0 ? void 0 : _this$props2.currentlyVisibleSectionRef);
            var linkClasses = external_classnames_default()({
              "schema-node-toc": 1,
              "linked": 1,
              "current": currentPlace
            });
            return /*#__PURE__*/external_react_default().createElement("a", {
              className: linkClasses,
              href: "/" + sefaria.normRef(path),
              "data-ref": path,
              key: i
            }, /*#__PURE__*/external_react_default().createElement("span", {
              className: "schema-node-title",
              role: "heading",
              "aria-level": "3"
            }, /*#__PURE__*/external_react_default().createElement(ContentText, {
              text: {
                en: node.title,
                he: node.heTitle
              }
            })));
          } else {
            // SchemaNode that has a JaggedArray below it
            return /*#__PURE__*/external_react_default().createElement("div", {
              className: "schema-node-toc janode",
              key: i
            }, !node["default"] ? /*#__PURE__*/external_react_default().createElement("span", {
              className: "schema-node-title ".concat(this.state.collapsed[i] ? "collapsed" : "open"),
              role: "heading",
              "aria-level": "3",
              tabIndex: 0,
              onClick: this.toggleCollapse.bind(null, i),
              onKeyPress: function (e) {
                e.charCode == 13 ? this.toggleCollapse(i) : null;
              }.bind(this)
            }, /*#__PURE__*/external_react_default().createElement(ContentText, {
              text: {
                en: node.title,
                he: node.heTitle
              }
            })) : null, !this.state.collapsed[i] ? /*#__PURE__*/external_react_default().createElement("div", {
              className: "schema-node-contents"
            }, /*#__PURE__*/external_react_default().createElement(JaggedArrayNode, {
              schema: node,
              topToggleTitles: this.props.topToggleTitles,
              contentLang: this.props.contentLang,
              refPath: this.props.refPath + (node["default"] ? "" : ", " + node.title),
              currentlyVisibleRef: this.props.currentlyVisibleRef,
              currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef
            })) : null);
          }
        }.bind(this));
        var topLevelHeader = this.props.topLevel && this.props.topLevelHeader ? /*#__PURE__*/external_react_default().createElement("div", {
          className: "specialNavSectionHeader"
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: this.props.topLevelHeader,
            he: sefaria.hebrewTranslation(this.props.topLevelHeader)
          }
        })) : null;
        return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, topLevelHeader, /*#__PURE__*/external_react_default().createElement("div", {
          className: "tocLevel"
        }, content));
      }
    }
  }]);
  return SchemaNode;
}((external_react_class_default()));
SchemaNode.propTypes = {
  schema: (external_prop_types_default()).object.isRequired,
  refPath: (external_prop_types_default()).string.isRequired
};
var JaggedArrayNode = /*#__PURE__*/function (_Component4) {
  BookPage_inherits(JaggedArrayNode, _Component4);
  var _super4 = BookPage_createSuper(JaggedArrayNode);
  function JaggedArrayNode() {
    BookPage_classCallCheck(this, JaggedArrayNode);
    return _super4.apply(this, arguments);
  }
  BookPage_createClass(JaggedArrayNode, [{
    key: "render",
    value: function render() {
      var _this$props$schema, _this$props$schema$in, _this$props$schema2, _this$props$schema3;
      var offset = ((_this$props$schema = this.props.schema) === null || _this$props$schema === void 0 ? void 0 : (_this$props$schema$in = _this$props$schema.index_offsets_by_depth) === null || _this$props$schema$in === void 0 ? void 0 : _this$props$schema$in['1']) || 0;
      if ("toc_zoom" in this.props.schema) {
        var zoom = this.props.schema.toc_zoom - 1;
        return /*#__PURE__*/external_react_default().createElement(JaggedArrayNodeSection, {
          depth: this.props.schema.depth - zoom,
          sectionNames: this.props.schema.sectionNames.slice(0, -zoom),
          addressTypes: this.props.schema.addressTypes.slice(0, -zoom),
          contentCounts: this.props.schema.content_counts,
          refPath: this.props.refPath,
          currentlyVisibleRef: this.props.currentlyVisibleRef,
          currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef,
          offset: offset
        });
      }
      var specialHeaderText = this.props.topLevelHeader || ((_this$props$schema2 = this.props.schema) === null || _this$props$schema2 === void 0 ? void 0 : _this$props$schema2.sectionNames[0]) || "Chapters";
      var topLevelHeader = !this.props.topToggleTitles.includes(specialHeaderText) && this.props.topLevel && (((_this$props$schema3 = this.props.schema) === null || _this$props$schema3 === void 0 ? void 0 : _this$props$schema3.depth) <= 2 || this.props.topLevelHeader) ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "specialNavSectionHeader"
      }, /*#__PURE__*/external_react_default().createElement(ContentText, {
        text: {
          en: specialHeaderText,
          he: sefaria.hebrewTranslation(specialHeaderText)
        }
      })) : null;
      return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, topLevelHeader, /*#__PURE__*/external_react_default().createElement(JaggedArrayNodeSection, {
        depth: this.props.schema.depth,
        sectionNames: this.props.schema.sectionNames,
        addressTypes: this.props.schema.addressTypes,
        contentCounts: this.props.schema.content_counts,
        refPath: this.props.refPath,
        currentlyVisibleRef: this.props.currentlyVisibleRef,
        currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef,
        offset: offset
      }));
    }
  }]);
  return JaggedArrayNode;
}((external_react_class_default()));
JaggedArrayNode.propTypes = {
  schema: (external_prop_types_default()).object.isRequired,
  refPath: (external_prop_types_default()).string.isRequired,
  topToggleTitles: (external_prop_types_default()).array
};
var JaggedArrayNodeSection = /*#__PURE__*/function (_Component5) {
  BookPage_inherits(JaggedArrayNodeSection, _Component5);
  var _super5 = BookPage_createSuper(JaggedArrayNodeSection);
  function JaggedArrayNodeSection() {
    BookPage_classCallCheck(this, JaggedArrayNodeSection);
    return _super5.apply(this, arguments);
  }
  BookPage_createClass(JaggedArrayNodeSection, [{
    key: "contentCountIsEmpty",
    value: function contentCountIsEmpty(count) {
      // Returns true if count is zero or is an an array (of arrays) of zeros.
      if (typeof count == "number") {
        return count == 0;
      }
      var innerCounts = count.map(this.contentCountIsEmpty);
      return innerCounts.unique().compare([true]);
    }
  }, {
    key: "refPathTerminal",
    value: function refPathTerminal(count) {
      // Returns a string to be added to the end of a section link depending on a content count
      // Used in cases of "zoomed" JaggedArrays, where `contentCounts` is deeper than `depth` so that zoomed section
      // links still point to section level.
      if (typeof count == "number") {
        return "";
      }
      var terminal = ":";
      for (var i = 0; i < count.length; i++) {
        if (count[i]) {
          terminal += i + 1 + this.refPathTerminal(count[i]);
          break;
        }
      }
      return terminal;
    }
  }, {
    key: "render",
    value: function render() {
      if (this.props.depth > 2) {
        var content = [];
        for (var i = 0; i < this.props.contentCounts.length; i++) {
          if (this.contentCountIsEmpty(this.props.contentCounts[i])) {
            continue;
          }
          var _Sefaria$getSectionSt = sefaria.getSectionStringByAddressType(this.props.addressTypes[0], i),
            _Sefaria$getSectionSt2 = BookPage_slicedToArray(_Sefaria$getSectionSt, 2),
            enSection = _Sefaria$getSectionSt2[0],
            heSection = _Sefaria$getSectionSt2[1];
          content.push( /*#__PURE__*/external_react_default().createElement("div", {
            className: "tocSection",
            key: i
          }, /*#__PURE__*/external_react_default().createElement("div", {
            className: "sectionName"
          }, /*#__PURE__*/external_react_default().createElement(ContentText, {
            text: {
              en: this.props.sectionNames[0] + " " + enSection,
              he: sefaria.hebrewTerm(this.props.sectionNames[0]) + " " + heSection
            }
          })), /*#__PURE__*/external_react_default().createElement(JaggedArrayNodeSection, {
            depth: this.props.depth - 1,
            sectionNames: this.props.sectionNames.slice(1),
            addressTypes: this.props.addressTypes.slice(1),
            contentCounts: this.props.contentCounts[i],
            refPath: this.props.refPath + ":" + enSection,
            currentlyVisibleRef: this.props.currentlyVisibleRef,
            currentlyVisibleSectionRef: this.props.currentlyVisibleSectionRef
          })));
        }
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "tocLevel"
        }, content);
      }
      var contentCounts = this.props.depth == 1 ? new Array(this.props.contentCounts).fill(1) : this.props.contentCounts;
      var sectionLinks = [];
      for (var _i3 = 0; _i3 < contentCounts.length; _i3++) {
        var _this$props3, _this$props4, _this$props5;
        if (this.contentCountIsEmpty(contentCounts[_i3])) {
          continue;
        }
        var _Sefaria$getSectionSt3 = sefaria.getSectionStringByAddressType(this.props.addressTypes[0], _i3, this.props.offset),
          _Sefaria$getSectionSt4 = BookPage_slicedToArray(_Sefaria$getSectionSt3, 2),
          section = _Sefaria$getSectionSt4[0],
          _heSection = _Sefaria$getSectionSt4[1];
        var ref = (this.props.refPath + ":" + section).replace(":", " ") + this.refPathTerminal(contentCounts[_i3]);
        var currentPlace = ref == ((_this$props3 = this.props) === null || _this$props3 === void 0 ? void 0 : _this$props3.currentlyVisibleSectionRef) || ref == ((_this$props4 = this.props) === null || _this$props4 === void 0 ? void 0 : _this$props4.currentlyVisibleRef) || sefaria.refContains((_this$props5 = this.props) === null || _this$props5 === void 0 ? void 0 : _this$props5.currentlyVisibleSectionRef, ref); //the second clause is for depth 1 texts
        var linkClasses = external_classnames_default()({
          "sectionLink": 1,
          "current": currentPlace
        });
        var link = /*#__PURE__*/external_react_default().createElement("a", {
          className: linkClasses,
          href: "/" + sefaria.normRef(ref),
          "data-ref": ref,
          key: _i3
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: section,
            he: _heSection
          }
        }));
        sectionLinks.push(link);
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocLevel"
      }, sectionLinks);
    }
  }]);
  return JaggedArrayNodeSection;
}((external_react_class_default()));
JaggedArrayNodeSection.propTypes = {
  depth: (external_prop_types_default()).number.isRequired,
  sectionNames: (external_prop_types_default()).array.isRequired,
  addressTypes: (external_prop_types_default()).array.isRequired,
  contentCounts: external_prop_types_default().oneOfType([(external_prop_types_default()).array, (external_prop_types_default()).number]),
  refPath: (external_prop_types_default()).string.isRequired
};
var ArrayMapNode = /*#__PURE__*/function (_Component6) {
  BookPage_inherits(ArrayMapNode, _Component6);
  var _super6 = BookPage_createSuper(ArrayMapNode);
  function ArrayMapNode(props) {
    var _this8;
    BookPage_classCallCheck(this, ArrayMapNode);
    _this8 = _super6.call(this, props);
    _this8.state = {
      collapsed: false
    };
    return _this8;
  }
  BookPage_createClass(ArrayMapNode, [{
    key: "toggleCollapse",
    value: function toggleCollapse() {
      if (this.props.schema.displayFixedTitleSubSections) return;
      this.setState({
        collapsed: !this.state.collapsed
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _schema$includeSectio,
        _this9 = this;
      var schema = this.props.schema;
      var includeSections = (_schema$includeSectio = schema === null || schema === void 0 ? void 0 : schema.includeSections) !== null && _schema$includeSectio !== void 0 ? _schema$includeSectio : true; //either undefined or explicitly true
      if ("refs" in schema && schema.refs.length && includeSections) {
        var skip = 0;
        var sectionLinks = schema.refs.map(function (ref, i) {
          var _this$props6, _this$props7, _this$props8;
          if ('addresses' in schema) {
            i = schema.addresses[i] - 1;
          } else {
            i += schema.offset || 0;
            if ('skipped_addresses' in schema) {
              i += skip;
              while (schema.skipped_addresses.includes(i + 1)) {
                skip++;
                i++;
              }
            }
          }
          if (ref === "") {
            return null;
          }
          var _Sefaria$getSectionSt5 = sefaria.getSectionStringByAddressType(schema.addressTypes[0], i),
            _Sefaria$getSectionSt6 = BookPage_slicedToArray(_Sefaria$getSectionSt5, 2),
            section = _Sefaria$getSectionSt6[0],
            heSection = _Sefaria$getSectionSt6[1];
          var currentPlace = ref == ((_this$props6 = this.props) === null || _this$props6 === void 0 ? void 0 : _this$props6.currentlyVisibleSectionRef) || ref == ((_this$props7 = this.props) === null || _this$props7 === void 0 ? void 0 : _this$props7.currentlyVisibleRef) || sefaria.refContains(ref, (_this$props8 = this.props) === null || _this$props8 === void 0 ? void 0 : _this$props8.currentlyVisibleRef);
          var linkClasses = external_classnames_default()({
            "sectionLink": 1,
            "current": currentPlace
          });
          return /*#__PURE__*/external_react_default().createElement("a", {
            className: linkClasses,
            href: "/" + sefaria.normRef(ref),
            "data-ref": ref,
            key: i
          }, /*#__PURE__*/external_react_default().createElement(ContentText, {
            text: {
              en: section,
              he: heSection
            }
          }));
        }.bind(this));
        var path = this.props.refPath + ", " + schema.title;
        var ref = "wholeRef" in schema ? sefaria.splitSpanningRefNaive(schema.wholeRef)[0] : null;
        return schema.displayFixedTitleSubSections ? /*#__PURE__*/external_react_default().createElement("a", {
          className: "schema-node-toc linked",
          href: "/" + sefaria.normRef(ref),
          "data-ref": ref,
          key: path
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "schema-node-title open fixed",
          role: "heading",
          "aria-level": "3",
          "aria-hidden": "true",
          tabIndex: 0
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: schema.title,
            he: schema.heTitle
          }
        })), /*#__PURE__*/external_react_default().createElement("div", {
          className: "schema-node-contents"
        }, sectionLinks)) : /*#__PURE__*/external_react_default().createElement("div", {
          className: "schema-node-toc",
          "data-ref": path,
          key: path
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "schema-node-title ".concat(this.state.collapsed ? "collapsed" : "open"),
          onClick: function onClick() {
            _this9.toggleCollapse();
          },
          onKeyPress: function onKeyPress(e) {
            e.charCode == 13 ? _this9.toggleCollapse() : null;
          },
          role: "heading",
          "aria-level": "3",
          "aria-hidden": "true",
          tabIndex: 0
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: schema.title,
            he: schema.heTitle
          }
        })), !this.state.collapsed ? /*#__PURE__*/external_react_default().createElement("div", {
          className: "schema-node-contents"
        }, sectionLinks) : null);
      } else {
        var _this$props9, _this$props10, _this$props11;
        //just a single link for an alt struct section
        var currentPlace = ((_this$props9 = this.props) === null || _this$props9 === void 0 ? void 0 : _this$props9.currentlyVisibleSectionRef) && (schema.wholeRef == ((_this$props10 = this.props) === null || _this$props10 === void 0 ? void 0 : _this$props10.currentlyVisibleRef) || sefaria.refContains(schema.wholeRef, (_this$props11 = this.props) === null || _this$props11 === void 0 ? void 0 : _this$props11.currentlyVisibleRef));
        var linkClasses = external_classnames_default()({
          "schema-node-toc": 1,
          "linked": 1,
          "current": currentPlace
        });
        return /*#__PURE__*/external_react_default().createElement("a", {
          className: linkClasses,
          href: "/" + sefaria.normRef(schema.wholeRef),
          "data-ref": schema.wholeRef
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "schema-node-title",
          role: "heading",
          "aria-level": "3"
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: schema.title,
            he: schema.heTitle
          }
        })));
      }
    }
  }]);
  return ArrayMapNode;
}((external_react_class_default()));
ArrayMapNode.propTypes = {
  schema: (external_prop_types_default()).object.isRequired
};
var DictionaryNode = /*#__PURE__*/function (_Component7) {
  BookPage_inherits(DictionaryNode, _Component7);
  var _super7 = BookPage_createSuper(DictionaryNode);
  function DictionaryNode() {
    BookPage_classCallCheck(this, DictionaryNode);
    return _super7.apply(this, arguments);
  }
  BookPage_createClass(DictionaryNode, [{
    key: "getCurrentLetter",
    value: function getCurrentLetter() {
      var _this$props12;
      //we need this so we can tell what letter of the alphabet a user is currently looking at based on the current ref, since the letters arent actually super
      // sections. 
      if ((_this$props12 = this.props) !== null && _this$props12 !== void 0 && _this$props12.currentlyVisibleSectionRef) {
        var rf = this.props.currentlyVisibleSectionRef;
        var letterSectionRf = rf.substring(0, rf.lastIndexOf(",") + 3);
        //get the substring up to the character after the last comma (and the space) thats the letter of the
        // alphabet we are on
        return letterSectionRf;
      }
      return null;
    }
  }, {
    key: "render",
    value: function render() {
      if (this.props.schema.headwordMap) {
        var headerText = this.props.schema.title ? /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: this.props.schema.title,
            he: this.props.schema.heTitle
          }
        }) : /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: "Browse By Letter",
            he: 'לפי סדר הא"ב'
          }
        });
        var letterSection = this.getCurrentLetter();
        var sectionLinks = this.props.schema.headwordMap.map(function (m, i) {
          var letter = m[0];
          var ref = m[1];
          var currentPlace = letterSection ? ref == letterSection : false;
          var linkClasses = external_classnames_default()({
            "sectionLink": 1,
            "current": currentPlace
          });
          return /*#__PURE__*/external_react_default().createElement("a", {
            className: linkClasses,
            href: "/" + sefaria.normRef(ref),
            "data-ref": ref,
            key: i
          }, /*#__PURE__*/external_react_default().createElement(ContentText, {
            text: {
              en: letter,
              he: letter
            }
          }));
        });
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "schema-node-toc"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "schema-node-contents"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "specialNavSectionHeader"
        }, headerText), /*#__PURE__*/external_react_default().createElement("div", {
          className: "tocLevel"
        }, sectionLinks)));
      }
    }
  }]);
  return DictionaryNode;
}((external_react_class_default()));
DictionaryNode.propTypes = {
  schema: (external_prop_types_default()).object.isRequired
};
var VersionsList = /*#__PURE__*/function (_Component8) {
  BookPage_inherits(VersionsList, _Component8);
  var _super8 = BookPage_createSuper(VersionsList);
  function VersionsList() {
    BookPage_classCallCheck(this, VersionsList);
    return _super8.apply(this, arguments);
  }
  BookPage_createClass(VersionsList, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this10 = this;
      sefaria.getVersions(this.props.currentRef).then(function (result) {
        _this10.onVersionsLoad(Object.values(result).flat());
      });
    }
  }, {
    key: "onVersionsLoad",
    value: function onVersionsLoad(versions) {
      versions.sort(function (a, b) {
        if (a.priority > b.priority) {
          return -1;
        } else if (a.priority < b.priority) {
          return 1;
        } else if (a.versionTitle < b.versionTitle) {
          return -1;
        } else if (a.versionTitle > b.versionTitle) {
          return 1;
        } else {
          return 0;
        }
      });
      this.setState({
        versions: versions
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this$state,
        _this11 = this;
      if (!(this !== null && this !== void 0 && (_this$state = this.state) !== null && _this$state !== void 0 && _this$state.versions)) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionsBox"
        }, /*#__PURE__*/external_react_default().createElement(LoadingMessage, null));
      }
      var versions = this.state.versions;
      var vblocks = versions.map(function (v) {
        return /*#__PURE__*/external_react_default().createElement(VersionBlock, {
          rendermode: "book-page",
          version: v,
          currObjectVersions: _this11.props.currObjectVersions,
          currentRef: _this11.props.currentRef,
          firstSectionRef: "firstSectionRef" in v ? v.firstSectionRef : null,
          openVersionInReader: _this11.props.openVersionInReader,
          viewExtendedNotes: _this11.props.viewExtendedNotes,
          key: v.versionTitle + "/" + v.language
        });
      });
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "versionsBox"
      }, vblocks);
    }
  }]);
  return VersionsList;
}((external_react_class_default()));
VersionsList.propTypes = {
  currentRef: (external_prop_types_default()).string,
  currObjectVersions: (external_prop_types_default()).object,
  openVersionInReader: (external_prop_types_default()).func,
  viewExtendedNotes: (external_prop_types_default()).func
};
var SectionTypesBox = function SectionTypesBox(_ref4) {
  var sections = _ref4.sections,
    canEdit = _ref4.canEdit,
    updateParent = _ref4.updateParent;
  var box = (0,external_react_.useRef)(null);
  var add = function add() {
    updateParent(sections.concat("")); //tell parent new values
  };

  var remove = function remove(i) {
    updateParent(sections.slice(0, i + 1)); //tell parent new values
  };

  var updateSelfAndParent = function updateSelfAndParent() {
    var newSections = Array.from(box.current.children).map(function (item) {
      return item.value;
    });
    updateParent(newSections);
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    id: "sBox",
    ref: box
  }, sections.map(function (section, i) {
    if (i === 0) {
      return /*#__PURE__*/external_react_default().createElement("input", {
        onBlur: updateSelfAndParent,
        className: 'sectionType',
        defaultValue: section
      });
    } else if (canEdit) {
      return /*#__PURE__*/external_react_default().createElement("span", null, /*#__PURE__*/external_react_default().createElement("input", {
        onBlur: updateSelfAndParent,
        className: 'sectionType',
        defaultValue: section
      }), /*#__PURE__*/external_react_default().createElement("span", {
        className: "remove",
        onClick: function onClick(i) {
          return remove(i);
        }
      }, "X"));
    } else {
      return /*#__PURE__*/external_react_default().createElement("input", {
        onBlur: updateSelfAndParent,
        className: 'sectionType',
        defaultValue: section
      });
    }
  }), canEdit ? /*#__PURE__*/external_react_default().createElement("span", {
    className: "add",
    onClick: add
  }, "Add Section") : null);
};
var EditTextInfo = function EditTextInfo(_ref5) {
  var _index$current, _index$current2, _index$current3, _index$current4, _index$current$author, _index$current5, _index$current6;
  var initTitle = _ref5.initTitle,
    close = _ref5.close;
  var index = (0,external_react_.useRef)(null);
  index.current = sefaria.getIndexDetailsFromCache(initTitle);
  var oldTitle = index.current.title; //save original title, in case english title gets edited
  var _useState = (0,external_react_.useState)(index.current.title),
    _useState2 = BookPage_slicedToArray(_useState, 2),
    enTitle = _useState2[0],
    setEnTitle = _useState2[1];
  var _useState3 = (0,external_react_.useState)(index.current.heTitle),
    _useState4 = BookPage_slicedToArray(_useState3, 2),
    heTitle = _useState4[0],
    setHeTitle = _useState4[1];
  var _useState5 = (0,external_react_.useState)(index.current.titleVariants.map(function (item, i) {
      var _ref6;
      return _ref6 = {}, BookPage_defineProperty(_ref6, "name", item), BookPage_defineProperty(_ref6, "id", i), _ref6;
    })),
    _useState6 = BookPage_slicedToArray(_useState5, 2),
    titleVariants = _useState6[0],
    setTitleVariants = _useState6[1];
  var _useState7 = (0,external_react_.useState)(index.current.heTitleVariants.map(function (item, i) {
      var _ref7;
      return _ref7 = {}, BookPage_defineProperty(_ref7, "name", item), BookPage_defineProperty(_ref7, "id", i), _ref7;
    })),
    _useState8 = BookPage_slicedToArray(_useState7, 2),
    heTitleVariants = _useState8[0],
    setHeTitleVariants = _useState8[1];
  var _useState9 = (0,external_react_.useState)(index.current.categories),
    _useState10 = BookPage_slicedToArray(_useState9, 2),
    categories = _useState10[0],
    setCategories = _useState10[1];
  var _useState11 = (0,external_react_.useState)(false),
    _useState12 = BookPage_slicedToArray(_useState11, 2),
    savingStatus = _useState12[0],
    setSavingStatus = _useState12[1];
  var _useState13 = (0,external_react_.useState)(index.current.sectionNames),
    _useState14 = BookPage_slicedToArray(_useState13, 2),
    sections = _useState14[0],
    setSections = _useState14[1];
  var _useState15 = (0,external_react_.useState)(((_index$current = index.current) === null || _index$current === void 0 ? void 0 : _index$current.enDesc) || ""),
    _useState16 = BookPage_slicedToArray(_useState15, 2),
    enDesc = _useState16[0],
    setEnDesc = _useState16[1];
  var _useState17 = (0,external_react_.useState)(((_index$current2 = index.current) === null || _index$current2 === void 0 ? void 0 : _index$current2.enShortDesc) || ""),
    _useState18 = BookPage_slicedToArray(_useState17, 2),
    enShortDesc = _useState18[0],
    setEnShortDesc = _useState18[1];
  var _useState19 = (0,external_react_.useState)(((_index$current3 = index.current) === null || _index$current3 === void 0 ? void 0 : _index$current3.heDesc) || ""),
    _useState20 = BookPage_slicedToArray(_useState19, 2),
    heDesc = _useState20[0],
    setHeDesc = _useState20[1];
  var _useState21 = (0,external_react_.useState)(((_index$current4 = index.current) === null || _index$current4 === void 0 ? void 0 : _index$current4.heShortDesc) || ""),
    _useState22 = BookPage_slicedToArray(_useState21, 2),
    heShortDesc = _useState22[0],
    setHeShortDesc = _useState22[1];
  var _useState23 = (0,external_react_.useState)(((_index$current$author = index.current.authors) === null || _index$current$author === void 0 ? void 0 : _index$current$author.map(function (item, i) {
      var _ref8;
      return _ref8 = {}, BookPage_defineProperty(_ref8, "name", item.en), BookPage_defineProperty(_ref8, "slug", item.slug), BookPage_defineProperty(_ref8, "id", i), _ref8;
    })) || []),
    _useState24 = BookPage_slicedToArray(_useState23, 2),
    authors = _useState24[0],
    setAuthors = _useState24[1];
  var _useState25 = (0,external_react_.useState)(Number((_index$current5 = index.current) === null || _index$current5 === void 0 ? void 0 : _index$current5.errorMargin) || 0),
    _useState26 = BookPage_slicedToArray(_useState25, 2),
    errorMargin = _useState26[0],
    setErrorMargin = _useState26[1];
  var getYearAsStr = function getYearAsStr(initCompDate) {
    if (typeof initCompDate === 'undefined' || initCompDate === '') {
      return "";
    } else {
      initCompDate = String(initCompDate);
      var pattern = /(-?\d+)(-?)(-?\d*)/; // this may occur if it is a range.  Some books, such as Genesis store compDate as a range
      var result = initCompDate.match(pattern);
      if (result[2] === "-") {
        return initCompDate;
      } else {
        initCompDate = Number(initCompDate);
        if (errorMargin === 0) {
          return "".concat(initCompDate);
        } else {
          var start = initCompDate - errorMargin;
          var end = initCompDate + errorMargin;
          return "".concat(start, "-").concat(end);
        }
      }
    }
  };
  var _useState27 = (0,external_react_.useState)((_index$current6 = index.current) === null || _index$current6 === void 0 ? void 0 : _index$current6.compDate),
    _useState28 = BookPage_slicedToArray(_useState27, 2),
    compDate = _useState28[0],
    setCompDate = _useState28[1];
  var _useState29 = (0,external_react_.useState)(getYearAsStr(compDate)),
    _useState30 = BookPage_slicedToArray(_useState29, 2),
    compDateStr = _useState30[0],
    setCompDateStr = _useState30[1];
  var toggleInProgress = function toggleInProgress() {
    setSavingStatus(function (savingStatus) {
      return !savingStatus;
    });
  };
  var validate = /*#__PURE__*/function () {
    var _ref9 = BookPage_asyncToGenerator( /*#__PURE__*/BookPage_regeneratorRuntime().mark(function _callee() {
      var i, _i4, _arr2, x, valid_tags;
      return BookPage_regeneratorRuntime().wrap(function _callee$(_context) {
        while (1) switch (_context.prev = _context.next) {
          case 0:
            if (enTitle) {
              _context.next = 3;
              break;
            }
            alert("Please give a text title or commentator name.");
            return _context.abrupt("return", false);
          case 3:
            if (!(!heTitle && sefaria._siteSettings.TORAH_SPECIFIC)) {
              _context.next = 6;
              break;
            }
            alert("Please give a Hebrew text title.");
            return _context.abrupt("return", false);
          case 6:
            if (!/[.\-\\\/]/.test(enTitle)) {
              _context.next = 9;
              break;
            }
            alert('Text titles may not contain periods, hyphens or slashes.');
            return _context.abrupt("return", false);
          case 9:
            if (!/[0-9]/.test(enTitle)) {
              _context.next = 12;
              break;
            }
            alert('Text titles may not contain numbers. This form is for general information about a text as a whole, not specific citations.');
            return _context.abrupt("return", false);
          case 12:
            if (!(categories.length === 0)) {
              _context.next = 15;
              break;
            }
            alert("Please choose a text category.");
            return _context.abrupt("return", false);
          case 15:
            i = 0;
          case 16:
            if (!(i < categories.length)) {
              _context.next = 23;
              break;
            }
            if (!/[.\-\\\/]/.test(categories[i])) {
              _context.next = 20;
              break;
            }
            alert('Categories may not contain periods, hyphens or slashes.');
            return _context.abrupt("return", false);
          case 20:
            i++;
            _context.next = 16;
            break;
          case 23:
            if (!hebrew.containsHebrew(enTitle)) {
              _context.next = 26;
              break;
            }
            alert("Please enter a primary title in English. Use the Hebrew Title field to specify a title in Hebrew.");
            return _context.abrupt("return", false);
          case 26:
            _i4 = 0, _arr2 = [enDesc, heDesc];
          case 27:
            if (!(_i4 < _arr2.length)) {
              _context.next = 37;
              break;
            }
            x = _arr2[_i4];
            _context.next = 31;
            return validateMarkdownLinks(x);
          case 31:
            valid_tags = _context.sent;
            if (valid_tags) {
              _context.next = 34;
              break;
            }
            return _context.abrupt("return", false);
          case 34:
            _i4++;
            _context.next = 27;
            break;
          case 37:
            return _context.abrupt("return", true);
          case 38:
          case "end":
            return _context.stop();
        }
      }, _callee);
    }));
    return function validate() {
      return _ref9.apply(this, arguments);
    };
  }();
  var validateCompDate = function validateCompDate(newValue) {
    var pattern = /(-?\d+)(-?)(-?\d*)/;
    var result = newValue.match(pattern);
    if (!result) {
      setErrorMargin(0);
      setCompDate(0);
    } else if (result[2] === "-") {
      var start = Number.parseInt(result[1]);
      var end = Number.parseInt(result[3]);
      if (Number.isNaN(start) || Number.isNaN(end)) {
        alert("Year must be an integer or range of integers.");
      } else if (end <= start) {
        alert("Invalid date format ".concat(start, " to ").concat(end));
      } else {
        var midpoint = (start + end) / 2;
        setCompDate(midpoint);
        setErrorMargin(midpoint - start);
      }
    } else {
      setErrorMargin(0);
      var year = Number.parseInt(newValue);
      if (Number.isNaN(year)) {
        alert("Year must be an integer or range of integers.");
      } else {
        setCompDate(year);
      }
    }
  };
  var save = function save() {
    var enTitleVariantNames = titleVariants.map(function (i) {
      return i.name;
    });
    var heTitleVariantNames = heTitleVariants.map(function (i) {
      return i.name;
    });
    var authorSlugs = authors.map(function (i) {
      return i.slug;
    });
    var postIndex = {
      title: enTitle,
      authors: authorSlugs,
      titleVariants: enTitleVariantNames,
      heTitleVariants: heTitleVariantNames,
      heTitle: heTitle,
      categories: categories,
      enDesc: enDesc,
      enShortDesc: enShortDesc,
      heDesc: heDesc,
      heShortDesc: heShortDesc
    };
    if (sections && sections.length > 0) {
      postIndex.sectionNames = sections;
    }
    if (enTitle !== oldTitle) {
      postIndex.oldTitle = oldTitle;
    }
    if (compDateStr !== "") {
      postIndex.compDate = compDate;
      postIndex.errorMargin = errorMargin;
    }
    var postJSON = JSON.stringify(postIndex);
    var title = enTitle.replace(/ /g, "_");
    var url = "/api/v2/raw/index/" + title;
    if ("oldTitle" in index.current) {
      url += "?update=1";
    }
    toggleInProgress();
    sefariaJquery.post(url, {
      "json": postJSON
    }, function (data) {
      if (data.error) {
        toggleInProgress();
        alert(data.error);
      } else {
        alert("Text information saved.");
        window.location.href = "/admin/reset/" + index.current.title;
      }
    }).fail(function (xhr, textStatus, errorThrown) {
      alert("Unfortunately, there may have been an error saving this text information.");
      window.location.href = "/admin/reset/" + index.current.title; // often this occurs when save occurs successfully but there is simply a timeout on cauldron so try resetting it
    });
  };

  var validateThenSave = function validateThenSave() {
    if (validate()) {
      save();
    }
  };
  var addAuthor = function addAuthor(newAuthor) {
    var lowerCaseName = newAuthor.name.toLowerCase();
    sefaria._ApiPromise(sefaria.apiHost + "/api/topic/completion/" + newAuthor.name).then(function (d) {
      var matches = d[1].filter(function (t) {
        return t.type === 'AuthorTopic';
      });
      var exactMatch = matches.find(function (t) {
        return t.title.toLowerCase() === lowerCaseName;
      });
      if (!exactMatch) {
        var closestMatches = matches.map(function (t) {
          return t.title;
        });
        var closestMatchMsg = matches.length > 0 ? "The closest match(es) found were: ".concat(closestMatches.join(', ')) : "";
        alert("Invalid author.  Make sure it is listed under the 'Authors' category in the Topic Table of Contents. ".concat(closestMatchMsg));
      } else {
        var _newAuthor = [{
          "id": authors.length,
          "name": exactMatch.title,
          "slug": exactMatch.key
        }];
        setAuthors([].concat(authors, _newAuthor));
      }
    });
  };
  var removeAuthor = function removeAuthor(authorIDtoRemove) {
    var newAuthors = authors.filter(function (author) {
      return author.id !== authorIDtoRemove;
    });
    setAuthors(newAuthors);
  };
  var deleteObj = function deleteObj() {
    setSavingStatus(true);
    var url = "/api/v2/index/".concat(enTitle);
    requestWithCallBack({
      url: url,
      type: "DELETE",
      redirect: function redirect() {
        return window.location.href = "/texts";
      }
    });
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "editTextInfo"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "static"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "inner"
  }, savingStatus ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionsWidget"
  }, "Saving text information...", /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement("br", null), "(processing title changes may take some time)") : null, /*#__PURE__*/external_react_default().createElement("div", {
    id: "newIndex"
  }, /*#__PURE__*/external_react_default().createElement(AdminToolHeader, {
    title: "Index Editor",
    close: close,
    validate: validateThenSave
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Text Title")), /*#__PURE__*/external_react_default().createElement("input", {
    type: "text",
    id: "textTitle",
    onBlur: function onBlur(e) {
      return setEnTitle(e.target.value);
    },
    defaultValue: enTitle
  })), sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Hebrew Title")), /*#__PURE__*/external_react_default().createElement("input", {
    id: "textTitle",
    type: "text",
    onBlur: function onBlur(e) {
      return setHeTitle(e.target.value);
    },
    defaultValue: heTitle
  })) : null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "English Description")), /*#__PURE__*/external_react_default().createElement("textarea", {
    className: "default",
    onBlur: function onBlur(e) {
      return setEnDesc(e.target.value);
    },
    defaultValue: enDesc
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Short English Description")), /*#__PURE__*/external_react_default().createElement("textarea", {
    className: "default",
    onBlur: function onBlur(e) {
      return setEnShortDesc(e.target.value);
    },
    defaultValue: enShortDesc
  })), sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Hebrew Description")), /*#__PURE__*/external_react_default().createElement("textarea", {
    className: "default",
    onBlur: function onBlur(e) {
      return setHeDesc(e.target.value);
    },
    defaultValue: heDesc
  })) : null, sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Short Hebrew Description")), /*#__PURE__*/external_react_default().createElement("textarea", {
    className: "default",
    onBlur: function onBlur(e) {
      return setHeShortDesc(e.target.value);
    },
    defaultValue: heShortDesc
  })) : null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Category")), /*#__PURE__*/external_react_default().createElement(CategoryChooser, {
    update: setCategories,
    categories: categories
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Authors")), /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "optional"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Optional"))), /*#__PURE__*/external_react_default().createElement(TitleVariants, {
    titles: authors,
    options: {
      'onTitleAddition': addAuthor,
      'onTitleDelete': removeAuthor
    }
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Alternate English Titles")), /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "optional"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Optional"))), /*#__PURE__*/external_react_default().createElement(TitleVariants, {
    update: setTitleVariants,
    titles: titleVariants
  })), sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Alternate Hebrew Titles")), /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "optional"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Optional"))), /*#__PURE__*/external_react_default().createElement(TitleVariants, {
    update: setHeTitleVariants,
    titles: heTitleVariants
  })) : null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Completion Year")), /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "optional"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Optional.  Provide a range if there is an error margin or the work was completed over the course of many years such as 1797-1800 or -900--200 (to denote 900 BCE to 200 BCE)."))), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement("input", {
    id: "compDate",
    onBlur: function onBlur(e) {
      return validateCompDate(e.target.value);
    },
    defaultValue: compDateStr
  })), index.current.hasOwnProperty("sectionNames") ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "section"
  }, /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Text Structure"))), /*#__PURE__*/external_react_default().createElement(SectionTypesBox, {
    updateParent: setSections,
    sections: sections,
    canEdit: index.current === {}
  })) : null, /*#__PURE__*/external_react_default().createElement("div", {
    onClick: deleteObj,
    id: "deleteTopic",
    className: "button small deleteTopic",
    tabIndex: "0",
    role: "button"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Delete"))))));
};
var ReadMoreText = /*#__PURE__*/function (_Component9) {
  BookPage_inherits(ReadMoreText, _Component9);
  var _super9 = BookPage_createSuper(ReadMoreText);
  function ReadMoreText(props) {
    var _this12;
    BookPage_classCallCheck(this, ReadMoreText);
    _this12 = _super9.call(this, props);
    _this12.state = {
      expanded: props.text.split(" ").length < props.initialWords
    };
    return _this12;
  }
  BookPage_createClass(ReadMoreText, [{
    key: "render",
    value: function render() {
      var _this13 = this;
      /** todo fix interfacetext */
      var text = this.state.expanded ? this.props.text : this.props.text.split(" ").slice(0, this.props.initialWords).join(" ") + "...";
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "readMoreText"
      }, text, this.state.expanded ? null : /*#__PURE__*/external_react_default().createElement("span", {
        className: "readMoreLink",
        onClick: function onClick() {
          return _this13.setState({
            expanded: true
          });
        }
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, {
        className: "int-en"
      }, "Read More \u203A"), /*#__PURE__*/external_react_default().createElement(HebrewText, {
        className: "int-he"
      }, "\u05E7\u05E8\u05D0 \u05E2\u05D5\u05D3 \u203A"))));
    }
  }]);
  return ReadMoreText;
}((external_react_class_default()));
ReadMoreText.propTypes = {
  text: (external_prop_types_default()).string.isRequired,
  initialWords: (external_prop_types_default()).number
};
ReadMoreText.defaultProps = {
  initialWords: 30
};

/*
  TODO what happened to ExtendedNotes?

  {this.props.mode === "extended notes" ?
  <ExtendedNotes
    title={this.props.title}
    currVersions={this.props.currVersions}
    backFromExtendedNotes={this.props.backFromExtendedNotes}
  />
  : null }
*/


;// CONCATENATED MODULE: external "react-markdown"
const external_react_markdown_namespaceObject = require("react-markdown");
var external_react_markdown_default = /*#__PURE__*/__webpack_require__.n(external_react_markdown_namespaceObject);
;// CONCATENATED MODULE: ../static/js/sefaria/trackG4.js
function trackG4_typeof(obj) { "@babel/helpers - typeof"; return trackG4_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, trackG4_typeof(obj); }
function trackG4_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, trackG4_toPropertyKey(descriptor.key), descriptor); } }
function trackG4_createClass(Constructor, protoProps, staticProps) { if (protoProps) trackG4_defineProperties(Constructor.prototype, protoProps); if (staticProps) trackG4_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function trackG4_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function trackG4_defineProperty(obj, key, value) { key = trackG4_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function trackG4_toPropertyKey(arg) { var key = trackG4_toPrimitive(arg, "string"); return trackG4_typeof(key) === "symbol" ? key : String(key); }
function trackG4_toPrimitive(input, hint) { if (trackG4_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (trackG4_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
//
var TrackG4 = /*#__PURE__*/trackG4_createClass(function TrackG4() {
  trackG4_classCallCheck(this, TrackG4);
});
/**
 * This function should be called in components that we want to track click events on.
 * before the return you need to add in this line `const analyticsContext = useContext(AdContext);` to get the context.
 * and then call the gtagClick as fallowing: onClick={e => TrackG4.gtagClick(e, onClick, `ToolTipped`, {"classes": `${classes}`}, analyticsContext)}
 * if there is an onClick function already pass it in the `onClick` parameter in the gtagClick function.
 */
trackG4_defineProperty(TrackG4, "gtagClick", function (e) {
  var onClick = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};
  var comp_name = arguments.length > 2 ? arguments[2] : undefined;
  var params = arguments.length > 3 ? arguments[3] : undefined;
  var analyticsContext = arguments.length > 4 ? arguments[4] : undefined;
  var contextParams = {
    "keywordTargets": analyticsContext.keywordTargets,
    "interfaceLang": analyticsContext.interfaceLang
  };
  var allParams = Object.assign({}, params, contextParams);
  gtag("event", "onclick_".concat(comp_name), allParams);
  onClick(e);
});
/* harmony default export */ const trackG4 = (TrackG4);
;// CONCATENATED MODULE: ../static/js/Misc.jsx
function Misc_typeof(obj) { "@babel/helpers - typeof"; return Misc_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, Misc_typeof(obj); }
function Misc_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function Misc_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? Misc_ownKeys(Object(source), !0).forEach(function (key) { Misc_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : Misc_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function Misc_defineProperty(obj, key, value) { key = Misc_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function Misc_slicedToArray(arr, i) { return Misc_arrayWithHoles(arr) || Misc_iterableToArrayLimit(arr, i) || Misc_unsupportedIterableToArray(arr, i) || Misc_nonIterableRest(); }
function Misc_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function Misc_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return Misc_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return Misc_arrayLikeToArray(o, minLen); }
function Misc_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function Misc_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function Misc_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function Misc_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ Misc_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == Misc_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function Misc_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function Misc_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { Misc_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { Misc_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function Misc_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function Misc_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, Misc_toPropertyKey(descriptor.key), descriptor); } }
function Misc_createClass(Constructor, protoProps, staticProps) { if (protoProps) Misc_defineProperties(Constructor.prototype, protoProps); if (staticProps) Misc_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function Misc_toPropertyKey(arg) { var key = Misc_toPrimitive(arg, "string"); return Misc_typeof(key) === "symbol" ? key : String(key); }
function Misc_toPrimitive(input, hint) { if (Misc_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (Misc_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function Misc_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) Misc_setPrototypeOf(subClass, superClass); }
function Misc_setPrototypeOf(o, p) { Misc_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return Misc_setPrototypeOf(o, p); }
function Misc_createSuper(Derived) { var hasNativeReflectConstruct = Misc_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = Misc_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = Misc_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return Misc_possibleConstructorReturn(this, result); }; }
function Misc_possibleConstructorReturn(self, call) { if (call && (Misc_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return Misc_assertThisInitialized(self); }
function Misc_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function Misc_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function Misc_getPrototypeOf(o) { Misc_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return Misc_getPrototypeOf(o); }
//const React      = require('react');
























/**
 * Component meant to simply denote a language specific string to go inside an InterfaceText element
 * ```
 * <InterfaceText>
 *     <EnglishText>lorem ipsum</EnglishText>
 *     <HebrewText>lorem ipsum</HebrewText>
 * </InterfaceText>
 * ```
 * @param children
 * @returns {JSX.Element}
 * @constructor
 */
var HebrewText = function HebrewText(_ref) {
  var children = _ref.children;
  return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, children);
};
var EnglishText = function EnglishText(_ref2) {
  var children = _ref2.children;
  return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, children);
};
var AvailableLanguages = function AvailableLanguages() {
  return {
    "english": EnglishText,
    "hebrew": HebrewText
  };
};
var AvailableLanguagesValidator = function AvailableLanguagesValidator(children, key, componentName, location, propFullName) {
  if (!(children[key].type && Object.values(AvailableLanguages()).indexOf(children[key].type) != -1)) {
    return new Error('Invalid prop `' + propFullName + '` supplied to' + ' `' + componentName + '`. Validation failed.');
  }
};
var __filterChildrenByLanguage = function __filterChildrenByLanguage(children, language) {
  var chlArr = external_react_default().Children.toArray(children);
  var currLangComponent = AvailableLanguages()[language];
  var newChildren = chlArr.filter(function (x) {
    return x.type == currLangComponent;
  });
  return newChildren;
};
var InterfaceText = function InterfaceText(_ref3) {
  var text = _ref3.text,
    html = _ref3.html,
    markdown = _ref3.markdown,
    children = _ref3.children,
    context = _ref3.context;
  /**
   * Renders a single span for interface string with either class `int-en`` or `int-he` depending on Sefaria.interfaceLang.
   *  If passed explicit text or html objects as props with "en" and/or "he", will only use those to determine correct text or fallback text to display.
   *  Otherwise:
   * `children` can be the English string, which will be translated with Sefaria._ if needed.
   * `children` can also take the form of <LangText> components above, so they can be used for longer paragrpahs or paragraphs containing html, if needed.
   * `context` is passed to Sefaria._ for additional translation context
   */
  var contentVariable = html || markdown || text; // assumption is `markdown` or `html` are preferred over `text` if they are present
  var isHebrew = sefaria.interfaceLang === "hebrew";
  var elemclasses = external_classnames_default()({
    "int-en": !isHebrew,
    "int-he": isHebrew
  });
  var textResponse = null;
  if (contentVariable) {
    // Prioritize explicit props passed in for text of the element, does not attempt to use Sefaria._() for this case.
    var he = contentVariable.he,
      en = contentVariable.en;
    textResponse = isHebrew ? he || en : en || he;
    var fallbackCls = isHebrew && !he ? " enInHe" : !isHebrew && !en ? " heInEn" : "";
    elemclasses += fallbackCls;
  } else {
    // Also handle composition with children
    var chlCount = external_react_default().Children.count(children);
    if (chlCount === 1) {
      // Same as passing in a `en` key but with children syntax
      textResponse = sefaria._(children, context);
    } else if (chlCount <= Object.keys(AvailableLanguages()).length) {
      // When multiple languages are passed in via children
      var newChildren = __filterChildrenByLanguage(children, sefaria.interfaceLang);
      textResponse = newChildren[0]; //assumes one language element per InterfaceText, may be too naive
    } else {
      console.log("Error too many children");
    }
  }
  return html ? /*#__PURE__*/external_react_default().createElement("span", {
    className: elemclasses,
    dangerouslySetInnerHTML: {
      __html: textResponse
    }
  }) : markdown ? /*#__PURE__*/external_react_default().createElement("span", {
    className: elemclasses
  }, /*#__PURE__*/external_react_default().createElement((external_react_markdown_default()), {
    className: 'reactMarkdown',
    unwrapDisallowed: true,
    disallowedElements: ['p']
  }, textResponse)) : /*#__PURE__*/external_react_default().createElement("span", {
    className: elemclasses
  }, textResponse);
};
InterfaceText.propTypes = {
  //Makes sure that children passed in are either a single string, or an array consisting only of <EnglishText>, <HebrewText>
  children: external_prop_types_default().oneOfType([(external_prop_types_default()).string, external_prop_types_default().arrayOf(AvailableLanguagesValidator)]),
  content: (external_prop_types_default()).object,
  html: (external_prop_types_default()).object,
  context: (external_prop_types_default()).string,
  className: (external_prop_types_default()).string
};
var LoadingRing = function LoadingRing() {
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "lds-ring"
  }, /*#__PURE__*/external_react_default().createElement("div", null), /*#__PURE__*/external_react_default().createElement("div", null), /*#__PURE__*/external_react_default().createElement("div", null), /*#__PURE__*/external_react_default().createElement("div", null));
};
var DonateLink = function DonateLink(_ref4) {
  var children = _ref4.children,
    classes = _ref4.classes,
    source = _ref4.source,
    link = _ref4.link;
  link = link || "default";
  source = source || "undefined";
  var linkOptions = {
    "default": {
      en: "https://donate.sefaria.org/give/451346/#!/donation/checkout",
      he: "https://donate.sefaria.org/give/468442/#!/donation/checkout"
    },
    sustainer: {
      en: "https://donate.sefaria.org/give/457760/#!/donation/checkout",
      he: "https://donate.sefaria.org/give/478929/#!/donation/checkout"
    },
    dayOfLearning: {
      en: "https://donate.sefaria.org/sponsor",
      he: "https://donate.sefaria.org/sponsorhe"
    }
  };
  var url = "".concat(sefaria._v(linkOptions[link]), "?c_src=").concat(source);
  return /*#__PURE__*/external_react_default().createElement("a", {
    href: url,
    className: classes,
    target: "_blank"
  }, children);
};

/* flexible profile picture that overrides the default image of gravatar with text with the user's initials */
var ProfilePic = /*#__PURE__*/function (_Component) {
  Misc_inherits(ProfilePic, _Component);
  var _super = Misc_createSuper(ProfilePic);
  function ProfilePic(props) {
    var _this;
    Misc_classCallCheck(this, ProfilePic);
    _this = _super.call(this, props);
    _this.state = {
      showDefault: !_this.props.url || _this.props.url.startsWith("https://www.gravatar"),
      // We can't know in advance if a gravatar image exists of not, so start with the default beforing trying to load image
      src: null,
      isFirstCropChange: true,
      crop: {
        unit: "px",
        width: 250,
        aspect: 1
      },
      croppedImageBlob: null,
      error: null
    };
    _this.imgFile = /*#__PURE__*/external_react_default().createRef();
    return _this;
  }
  Misc_createClass(ProfilePic, [{
    key: "setShowDefault",
    value: function setShowDefault() {
      /* console.log("error"); */this.setState({
        showDefault: true
      });
    }
  }, {
    key: "setShowImage",
    value: function setShowImage() {
      /* console.log("load"); */this.setState({
        showDefault: false
      });
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      if (this.didImageLoad()) {
        this.setShowImage();
      } else {
        this.setShowDefault();
      }
    }
  }, {
    key: "didImageLoad",
    value: function didImageLoad() {
      // When using React Hydrate, the onLoad event of the profile image will return before
      // react code runs, so we check after mount as well to look replace bad images, or to
      // swap in a gravatar image that we now know is valid.
      var img = this.imgFile.current;
      return img && img.complete && img.naturalWidth !== 0;
    }
  }, {
    key: "onSelectFile",
    value: function onSelectFile(e) {
      var _this2 = this;
      if (e.target.files && e.target.files.length > 0) {
        if (!e.target.files[0].type.startsWith('image/')) {
          this.setState({
            error: "Error: Please upload an image with the correct file extension (e.g. jpg, png)"
          });
          return;
        }
        var reader = new FileReader();
        reader.addEventListener("load", function () {
          return _this2.setState({
            src: reader.result
          });
        });
        console.log("FILE", e.target.files[0]);
        reader.readAsDataURL(e.target.files[0]);
      }
    }
  }, {
    key: "onImageLoaded",
    value: function onImageLoaded(image) {
      this.imageRef = image;
    }
  }, {
    key: "onCropComplete",
    value: function onCropComplete(crop) {
      this.makeClientCrop(crop);
    }
  }, {
    key: "onCropChange",
    value: function onCropChange(crop, percentCrop) {
      // You could also use percentCrop:
      // this.setState({ crop: percentCrop });
      if (this.state.isFirstCropChange) {
        var _this$imageRef = this.imageRef,
          width = _this$imageRef.clientWidth,
          height = _this$imageRef.clientHeight;
        crop.width = Math.min(width, height);
        crop.height = crop.width;
        crop.x = this.imageRef.width / 2 - crop.width / 2;
        crop.y = this.imageRef.height / 2 - crop.width / 2;
        this.setState({
          crop: crop,
          isFirstCropChange: false
        });
      } else {
        this.setState({
          crop: crop
        });
      }
    }
  }, {
    key: "makeClientCrop",
    value: function () {
      var _makeClientCrop = Misc_asyncToGenerator( /*#__PURE__*/Misc_regeneratorRuntime().mark(function _callee(crop) {
        var croppedImageBlob;
        return Misc_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              if (!(this.imageRef && crop.width && crop.height)) {
                _context.next = 5;
                break;
              }
              _context.next = 3;
              return this.getCroppedImg(this.imageRef, crop, "newFile.jpeg");
            case 3:
              croppedImageBlob = _context.sent;
              //console.log(croppedImageUrl);
              this.setState({
                croppedImageBlob: croppedImageBlob
              });
            case 5:
            case "end":
              return _context.stop();
          }
        }, _callee, this);
      }));
      function makeClientCrop(_x) {
        return _makeClientCrop.apply(this, arguments);
      }
      return makeClientCrop;
    }()
  }, {
    key: "getCroppedImg",
    value: function getCroppedImg(image, crop, fileName) {
      var canvas = document.createElement("canvas");
      var scaleX = image.naturalWidth / image.width;
      var scaleY = image.naturalHeight / image.height;
      canvas.width = crop.width * scaleX;
      canvas.height = crop.height * scaleY;
      var ctx = canvas.getContext("2d");
      ctx.drawImage(image, crop.x * scaleX, crop.y * scaleY, crop.width * scaleX, crop.height * scaleY, 0, 0, crop.width * scaleX, crop.height * scaleY);
      return new Promise(function (resolve, reject) {
        canvas.toBlob(function (blob) {
          if (!blob) {
            console.error("Canvas is empty");
            return;
          }
          blob.name = fileName;
          resolve(blob);
        }, "image/jpeg");
      });
    }
  }, {
    key: "closePopup",
    value: function closePopup(_ref5) {
      var cb = _ref5.cb;
      this.setState({
        src: null,
        crop: {
          unit: "px",
          width: 250,
          aspect: 1
        },
        isFirstCropChange: true,
        croppedImageBlob: null,
        error: null
      }, cb);
    }
  }, {
    key: "upload",
    value: function () {
      var _upload = Misc_asyncToGenerator( /*#__PURE__*/Misc_regeneratorRuntime().mark(function _callee2() {
        var formData, errored, response;
        return Misc_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              formData = new FormData();
              formData.append('file', this.state.croppedImageBlob);
              this.setState({
                uploading: true
              });
              errored = false;
              _context2.prev = 4;
              _context2.next = 7;
              return sefaria.uploadProfilePhoto(formData);
            case 7:
              response = _context2.sent;
              if (!response.error) {
                _context2.next = 12;
                break;
              }
              throw new Error(response.error);
            case 12:
              this.closePopup({
                cb: function cb() {
                  window.location = "/profile/" + sefaria.slug; // reload to get update
                  return;
                }
              });
            case 13:
              _context2.next = 19;
              break;
            case 15:
              _context2.prev = 15;
              _context2.t0 = _context2["catch"](4);
              errored = true;
              console.log(_context2.t0);
            case 19:
              this.setState({
                uploading: false,
                errored: errored
              });
            case 20:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this, [[4, 15]]);
      }));
      function upload() {
        return _upload.apply(this, arguments);
      }
      return upload;
    }()
  }, {
    key: "render",
    value: function render() {
      var _this$props = this.props,
        name = _this$props.name,
        url = _this$props.url,
        len = _this$props.len,
        hideOnDefault = _this$props.hideOnDefault,
        showButtons = _this$props.showButtons,
        outerStyle = _this$props.outerStyle;
      var _this$state = this.state,
        showDefault = _this$state.showDefault,
        src = _this$state.src,
        crop = _this$state.crop,
        error = _this$state.error,
        uploading = _this$state.uploading,
        isFirstCropChange = _this$state.isFirstCropChange;
      var nameArray = !!name.trim() ? name.trim().split(/\s/) : [];
      var initials = nameArray.length > 0 ? nameArray.length === 1 ? nameArray[0][0] : nameArray[0][0] + nameArray[nameArray.length - 1][0] : "";
      var defaultViz = showDefault ? 'flex' : 'none';
      var profileViz = showDefault ? 'none' : 'block';
      var imageSrc = url.replace("profile-default.png", 'profile-default-404.png'); // replace default with non-existant image to force onLoad to fail

      return /*#__PURE__*/external_react_default().createElement("div", {
        style: outerStyle,
        className: "profile-pic"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: external_classnames_default()({
          'default-profile-img': 1,
          noselect: 1,
          invisible: hideOnDefault
        }),
        style: {
          display: defaultViz,
          width: len,
          height: len,
          fontSize: len / 2
        }
      }, showButtons ? null : "".concat(initials)), /*#__PURE__*/external_react_default().createElement("img", {
        className: "img-circle profile-img",
        style: {
          display: profileViz,
          width: len,
          height: len,
          fontSize: len / 2
        },
        src: imageSrc,
        alt: "User Profile Picture",
        ref: this.imgFile,
        onLoad: this.setShowImage,
        onError: this.setShowDefault
      }), this.props.children ? this.props.children : null /*required for slate.js*/, showButtons ?
      /*#__PURE__*/
      /* cant style file input directly. see: https://stackoverflow.com/questions/572768/styling-an-input-type-file-button */
      external_react_default().createElement("div", {
        className: external_classnames_default()({
          "profile-pic-button-visible": showDefault !== null,
          "profile-pic-hover-button": !showDefault,
          "profile-pic-button": 1
        })
      }, /*#__PURE__*/external_react_default().createElement("input", {
        type: "file",
        className: "profile-pic-input-file",
        id: "profile-pic-input-file",
        onChange: this.onSelectFile,
        onClick: function onClick(event) {
          event.target.value = null;
        }
      }), /*#__PURE__*/external_react_default().createElement("label", {
        htmlFor: "profile-pic-input-file",
        className: external_classnames_default()({
          resourcesLink: 1,
          blue: showDefault
        })
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, showDefault ? "Add Picture" : "Upload New"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, showDefault ? "הוספת תמונה" : "עדכון תמונה"))) : null, (src || !!error) && /*#__PURE__*/external_react_default().createElement("div", {
        id: "interruptingMessageBox",
        className: "sefariaModalBox"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        id: "interruptingMessageOverlay",
        onClick: this.closePopup
      }), /*#__PURE__*/external_react_default().createElement("div", {
        id: "interruptingMessage",
        className: "profile-pic-cropper-modal"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sefariaModalContent profile-pic-cropper-modal-inner"
      }, src ? /*#__PURE__*/external_react_default().createElement((external_react_image_crop_default()), {
        src: src,
        crop: crop,
        className: "profile-pic-cropper",
        keepSelection: true,
        onImageLoaded: this.onImageLoaded,
        onComplete: this.onCropComplete,
        onChange: this.onCropChange
      }) : /*#__PURE__*/external_react_default().createElement("div", {
        className: "profile-pic-cropper-error"
      }, error)), uploading || isFirstCropChange ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "profile-pic-loading"
      }, /*#__PURE__*/external_react_default().createElement(LoadingRing, null)) : /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "smallText profile-pic-cropper-desc"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Drag corners to crop image"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05DC\u05D7\u05D9\u05EA\u05D5\u05DA \u05D4\u05EA\u05DE\u05D5\u05E0\u05D4, \u05D2\u05E8\u05D5\u05E8 \u05D0\u05EA \u05D4\u05E4\u05D9\u05E0\u05D5\u05EA")), /*#__PURE__*/external_react_default().createElement("div", {
        className: "profile-pic-cropper-button-row"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: "#",
        className: "resourcesLink profile-pic-cropper-button",
        onClick: this.closePopup
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Cancel"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D1\u05D8\u05DC")), /*#__PURE__*/external_react_default().createElement("a", {
        href: "#",
        className: "resourcesLink blue profile-pic-cropper-button",
        onClick: this.upload
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Save"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05E9\u05DE\u05D5\u05E8")))))));
    }
  }]);
  return ProfilePic;
}((external_react_class_default()));
ProfilePic.propTypes = {
  url: (external_prop_types_default()).string,
  name: (external_prop_types_default()).string,
  len: (external_prop_types_default()).number,
  hideOnDefault: (external_prop_types_default()).bool,
  // hide profile pic if you have are displaying default pic
  showButtons: (external_prop_types_default()).bool // show profile pic action buttons
};

var FilterableList = function FilterableList(_ref6) {
  var filterFunc = _ref6.filterFunc,
    sortFunc = _ref6.sortFunc,
    renderItem = _ref6.renderItem,
    sortOptions = _ref6.sortOptions,
    getData = _ref6.getData,
    data = _ref6.data,
    renderEmptyList = _ref6.renderEmptyList,
    renderHeader = _ref6.renderHeader,
    renderFooter = _ref6.renderFooter,
    showFilterHeader = _ref6.showFilterHeader,
    refreshData = _ref6.refreshData,
    initialFilter = _ref6.initialFilter,
    scrollableElement = _ref6.scrollableElement,
    pageSize = _ref6.pageSize,
    onDisplayedDataChange = _ref6.onDisplayedDataChange,
    initialRenderSize = _ref6.initialRenderSize,
    bottomMargin = _ref6.bottomMargin,
    containerClass = _ref6.containerClass;
  var _useState = (0,external_react_.useState)(initialFilter || ''),
    _useState2 = Misc_slicedToArray(_useState, 2),
    filter = _useState2[0],
    setFilter = _useState2[1];
  var _useState3 = (0,external_react_.useState)(sortOptions[0]),
    _useState4 = Misc_slicedToArray(_useState3, 2),
    sortOption = _useState4[0],
    setSortOption = _useState4[1];
  var _useState5 = (0,external_react_.useState)(false),
    _useState6 = Misc_slicedToArray(_useState5, 2),
    displaySort = _useState6[0],
    setDisplaySort = _useState6[1];

  // Apply filter and sort to the raw data
  var processData = function processData(rawData) {
    return rawData ? rawData.filter(function (item) {
      return !filter ? true : filterFunc(filter, item);
    }).sort(function (a, b) {
      return sortFunc(sortOption, a, b);
    }) : [];
  };
  var cachedData = data || null;
  var _useState7 = (0,external_react_.useState)(!cachedData),
    _useState8 = Misc_slicedToArray(_useState7, 2),
    loading = _useState8[0],
    setLoading = _useState8[1];
  var _useState9 = (0,external_react_.useState)(cachedData),
    _useState10 = Misc_slicedToArray(_useState9, 2),
    rawData = _useState10[0],
    setRawData = _useState10[1];
  var _useState11 = (0,external_react_.useState)(processData(rawData)),
    _useState12 = Misc_slicedToArray(_useState11, 2),
    displayData = _useState12[0],
    setDisplayData = _useState12[1];

  // If `getData` function is passed, load data through this effect
  (0,external_react_.useEffect)(function () {
    var isMounted = true;
    if (!rawData && !!getData) {
      // Don't try calling getData when `data` is intially passed
      setLoading(true);
      getData().then(function (data) {
        if (isMounted) {
          setRawData(data);
          setDisplayData(processData(data));
          setLoading(false);
        }
      });
    }
    return function () {
      isMounted = false;
    };
  }, [getData, rawData]);

  // Alternatively, if there is no `getData` function passed, we expect data
  // to be fed in directly through the `data` prop. Check `data` again whenever
  // refreshData signal changes.
  (0,external_react_.useEffect)(function () {
    setRawData(data);
    setDisplayData(processData(data));
  }, [data, refreshData]);

  // Updates to filter or sort
  (0,external_react_.useEffect)(function () {
    setDisplayData(processData(rawData));
  }, [filter, sortOption]);
  var dataUpToPage = usePaginatedDisplay(scrollableElement, displayData, pageSize, bottomMargin, initialRenderSize || pageSize);
  if (onDisplayedDataChange) {
    (0,external_react_.useEffect)(function () {
      onDisplayedDataChange(dataUpToPage);
    }, [dataUpToPage]);
  }
  var onSortChange = function onSortChange(newSortOption) {
    if (newSortOption === sortOption) {
      return;
    }
    setSortOption(newSortOption);
    setDisplaySort(false);
  };
  var oldDesign = typeof showFilterHeader == 'undefined';
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "filterable-list"
  }, oldDesign ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "filter-bar"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "filter-bar-inner"
  }, /*#__PURE__*/external_react_default().createElement(SearchButton, null), /*#__PURE__*/external_react_default().createElement("input", {
    type: "text",
    placeholder: sefaria._("Search"),
    name: "filterableListInput",
    value: filter,
    onChange: function onChange(e) {
      return setFilter(e.target.value);
    }
  })), /*#__PURE__*/external_react_default().createElement("div", null, sortOptions.length > 1 ? /*#__PURE__*/external_react_default().createElement(DropdownModal, {
    close: function close() {
      return setDisplaySort(false);
    },
    isOpen: displaySort
  }, /*#__PURE__*/external_react_default().createElement(DropdownButton, {
    isOpen: displaySort,
    toggle: function toggle() {
      return setDisplaySort(function (prev) {
        return !prev;
      });
    },
    enText: "Sort",
    heText: "מיון"
  }), /*#__PURE__*/external_react_default().createElement(DropdownOptionList, {
    isOpen: displaySort,
    options: sortOptions.map(function (option) {
      return {
        type: option,
        name: option,
        heName: sefaria._(option, "FilterableList")
      };
    }),
    currOptionSelected: sortOption,
    handleClick: onSortChange
  })) : null)) : null, !oldDesign && showFilterHeader ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "filter-bar-new"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "filter-input"
  }, /*#__PURE__*/external_react_default().createElement(SearchButton, null), /*#__PURE__*/external_react_default().createElement("input", {
    type: "text",
    placeholder: sefaria._("Search"),
    name: "filterableListInput",
    value: filter,
    onChange: function onChange(e) {
      return setFilter(e.target.value);
    }
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "filter-sort-wrapper"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "systemText"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sort by")), sortOptions.map(function (option) {
    return /*#__PURE__*/external_react_default().createElement("span", {
      key: option,
      className: external_classnames_default()({
        'sans-serif': 1,
        'sort-option': 1,
        noselect: 1,
        active: sortOption === option
      }),
      onClick: function onClick() {
        return onSortChange(option);
      }
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      context: "FilterableList"
    }, option));
  }))) : null, loading ? /*#__PURE__*/external_react_default().createElement(LoadingMessage, null) : /*#__PURE__*/external_react_default().createElement("div", {
    className: "filter-content" + (containerClass ? " " + containerClass : "")
  }, dataUpToPage.length ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, !!renderHeader ? renderHeader({
    filter: filter
  }) : null, dataUpToPage.map(renderItem)) : /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, !!renderEmptyList ? renderEmptyList({
    filter: filter
  }) : null), !!renderFooter ? renderFooter({
    filter: filter
  }) : null));
};
FilterableList.propTypes = {
  filterFunc: (external_prop_types_default()).func.isRequired,
  sortFunc: (external_prop_types_default()).func.isRequired,
  renderItem: (external_prop_types_default()).func.isRequired,
  sortOptions: (external_prop_types_default()).array.isRequired,
  getData: (external_prop_types_default()).func,
  // At least one of `getData` or `data` is required
  data: (external_prop_types_default()).array,
  renderEmptyList: (external_prop_types_default()).func,
  renderHeader: (external_prop_types_default()).func,
  renderFooter: (external_prop_types_default()).func,
  showFilterHeader: (external_prop_types_default()).bool
};
var TabView = /*#__PURE__*/function (_Component2) {
  Misc_inherits(TabView, _Component2);
  var _super2 = Misc_createSuper(TabView);
  function TabView(props) {
    var _this3;
    Misc_classCallCheck(this, TabView);
    _this3 = _super2.call(this, props);
    var currTabName = props.currTabName;
    _this3.state = {
      currTabName: typeof currTabName === 'undefined' ? _this3.props.tabs[0].id : currTabName
    };
    return _this3;
  }
  Misc_createClass(TabView, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      if (this.props.currTabName === null) {
        this.props.setTab(this.props.tabs[0].id, true);
      }
    }
  }, {
    key: "openTab",
    value: function openTab(index) {
      this.setState({
        currTabIndex: index
      });
    }
  }, {
    key: "getTabIndex",
    value: function getTabIndex() {
      var _this4 = this;
      var tabIndex;
      if (typeof this.props.currTabName === 'undefined') {
        tabIndex = this.props.tabs.findIndex(function (tab) {
          return tab.id === _this4.state.currTabName ? true : false;
        });
      } else if (this.props.currTabName === null) {
        tabIndex = 0;
      } else {
        tabIndex = this.props.tabs.findIndex(function (tab) {
          return tab.id === _this4.props.currTabName ? true : false;
        });
      }
      if (tabIndex === -1) {
        tabIndex = 0;
      }
      return tabIndex;
    }
  }, {
    key: "onClickTab",
    value: function onClickTab(e, clickTabOverride) {
      if (clickTabOverride) {
        clickTabOverride();
      } else {
        var target = sefariaJquery(event.target);
        while (!target.attr("data-tab-index")) {
          target = target.parent();
        }
        var tabIndex = parseInt(target.attr("data-tab-index"));
        var _this$props2 = this.props,
          onClickArray = _this$props2.onClickArray,
          setTab = _this$props2.setTab,
          tabs = _this$props2.tabs;
        if (onClickArray && onClickArray[tabIndex]) {
          onClickArray[tabIndex]();
        } else {
          this.openTab(tabIndex);
          var tab = this.props.tabs[tabIndex];
          setTab && setTab(tab.id);
        }
      }
    }
  }, {
    key: "renderTab",
    value: function renderTab(tab, index) {
      var _this5 = this;
      var currTabIndex = this.getTabIndex();
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: external_classnames_default()({
          active: currTabIndex === index,
          justifyright: tab.justifyright
        }),
        key: tab.id,
        "data-tab-index": index,
        onClick: function onClick(e) {
          _this5.onClickTab(e, tab.clickTabOverride);
        }
      }, this.props.renderTab(tab, index));
    }
  }, {
    key: "render",
    value: function render() {
      var currTabIndex = this.getTabIndex();
      var classes = external_classnames_default()(Misc_defineProperty({
        "tab-view": 1
      }, this.props.containerClasses, 1));
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "tab-list sans-serif"
      }, this.props.tabs.map(this.renderTab)), external_react_default().Children.toArray(this.props.children)[currTabIndex]);
    }
  }]);
  return TabView;
}((external_react_class_default()));
TabView.propTypes = {
  tabs: (external_prop_types_default()).array.isRequired,
  // array of objects of any form. only requirement is each tab has a unique 'id' field. These objects will be passed to renderTab.
  renderTab: (external_prop_types_default()).func.isRequired,
  currTabName: (external_prop_types_default()).string,
  // optional. If passed, TabView will be controlled from outside
  setTab: (external_prop_types_default()).func,
  // optional. If passed, TabView will be controlled from outside
  onClickArray: (external_prop_types_default()).object // optional. If passed, TabView will be controlled from outside
};
var DropdownOptionList = /*#__PURE__*/function (_Component3) {
  Misc_inherits(DropdownOptionList, _Component3);
  var _super3 = Misc_createSuper(DropdownOptionList);
  function DropdownOptionList() {
    Misc_classCallCheck(this, DropdownOptionList);
    return _super3.apply(this, arguments);
  }
  Misc_createClass(DropdownOptionList, [{
    key: "render",
    value: function render() {
      var _this6 = this;
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: this.props.isOpen ? "dropdown-option-list" : "dropdown-option-list hidden"
      }, /*#__PURE__*/external_react_default().createElement("table", null, /*#__PURE__*/external_react_default().createElement("tbody", null, this.props.options.map(function (option, iSortTypeObj) {
        var tempClasses = external_classnames_default()({
          'filter-title': 1,
          unselected: _this6.props.currOptionSelected !== option.type
        });
        return /*#__PURE__*/external_react_default().createElement("tr", {
          key: option.type,
          className: tempClasses,
          onClick: function onClick() {
            _this6.props.handleClick(option.type);
          },
          tabIndex: "".concat(iSortTypeObj),
          onKeyPress: function onKeyPress(e) {
            e.charCode == 13 ? _this6.props.handleClick(option.type) : null;
          },
          "aria-label": "Sort by ".concat(option.name)
        }, /*#__PURE__*/external_react_default().createElement("td", null, /*#__PURE__*/external_react_default().createElement("img", {
          className: "dropdown-option-check",
          src: "/static/img/check-mark.svg",
          alt: "".concat(option.name, " sort selected")
        })), /*#__PURE__*/external_react_default().createElement("td", {
          className: "dropdown-option-list-label"
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "int-en"
        }, option.name), /*#__PURE__*/external_react_default().createElement("span", {
          className: "int-he",
          dir: "rtl"
        }, option.heName)));
      }))));
    }
  }]);
  return DropdownOptionList;
}((external_react_class_default()));
DropdownOptionList.propTypes = {
  initialTabIndex: (external_prop_types_default()).number,
  setTab: (external_prop_types_default()).func,
  isOpen: (external_prop_types_default()).bool.isRequired,
  options: (external_prop_types_default()).array.isRequired,
  currOptionSelected: (external_prop_types_default()).string.isRequired,
  handleClick: (external_prop_types_default()).func.isRequired
};
var DropdownButton = function DropdownButton(_ref7) {
  var isOpen = _ref7.isOpen,
    toggle = _ref7.toggle,
    enText = _ref7.enText,
    heText = _ref7.heText,
    buttonStyle = _ref7.buttonStyle;
  var filterTextClasses = external_classnames_default()({
    "dropdown-button": 1,
    active: isOpen,
    buttonStyle: buttonStyle
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: filterTextClasses,
    tabIndex: "0",
    onClick: toggle,
    onKeyPress: function onKeyPress(e) {
      e.charCode == 13 ? toggle(e) : null;
    }
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: enText,
      he: heText
    }
  }), isOpen ? /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/arrow-up.png",
    alt: ""
  }) : /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/arrow-down.png",
    alt: ""
  }));
};
DropdownButton.propTypes = {
  isOpen: (external_prop_types_default()).bool.isRequired,
  toggle: (external_prop_types_default()).func.isRequired,
  enText: (external_prop_types_default()).string.isRequired,
  heText: (external_prop_types_default()).string.isRequired,
  buttonStyle: (external_prop_types_default()).bool
};
var DropdownModal = /*#__PURE__*/function (_Component4) {
  Misc_inherits(DropdownModal, _Component4);
  var _super4 = Misc_createSuper(DropdownModal);
  function DropdownModal() {
    Misc_classCallCheck(this, DropdownModal);
    return _super4.apply(this, arguments);
  }
  Misc_createClass(DropdownModal, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      document.addEventListener('mousedown', this.handleClickOutside, false);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      document.removeEventListener('mousedown', this.handleClickOutside, false);
    }
  }, {
    key: "handleClickOutside",
    value: function handleClickOutside(event) {
      var domNode = external_react_dom_default().findDOMNode(this);
      if ((!domNode || !domNode.contains(event.target)) && this.props.isOpen) {
        this.props.close();
      }
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: external_classnames_default()({
          "dropdown-modal": 1,
          "position-unset": this.props.positionUnset,
          "sans-serif": 1
        })
      }, this.props.children);
    }
  }]);
  return DropdownModal;
}((external_react_class_default()));
DropdownModal.propTypes = {
  close: (external_prop_types_default()).func.isRequired,
  isOpen: (external_prop_types_default()).bool.isRequired,
  positionUnset: (external_prop_types_default()).bool // for search filters
};
var Misc_Link = /*#__PURE__*/function (_Component5) {
  Misc_inherits(Link, _Component5);
  var _super5 = Misc_createSuper(Link);
  function Link() {
    Misc_classCallCheck(this, Link);
    return _super5.apply(this, arguments);
  }
  Misc_createClass(Link, [{
    key: "handleClick",
    value: function handleClick(e) {
      e.preventDefault();
      this.props.onClick();
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("a", {
        className: this.props.className,
        href: this.props.href,
        onClick: this.handleClick,
        title: this.props.title
      }, this.props.children);
    }
  }]);
  return Link;
}((external_react_class_default()));
Misc_Link.propTypes = {
  href: (external_prop_types_default()).string.isRequired,
  onClick: (external_prop_types_default()).func,
  title: (external_prop_types_default()).string.isRequired
};
var GlobalWarningMessage = /*#__PURE__*/function (_Component6) {
  Misc_inherits(GlobalWarningMessage, _Component6);
  var _super6 = Misc_createSuper(GlobalWarningMessage);
  function GlobalWarningMessage() {
    Misc_classCallCheck(this, GlobalWarningMessage);
    return _super6.apply(this, arguments);
  }
  Misc_createClass(GlobalWarningMessage, [{
    key: "close",
    value: function close() {
      sefaria.globalWarningMessage = null;
      this.forceUpdate();
    }
  }, {
    key: "render",
    value: function render() {
      return sefaria.globalWarningMessage ? /*#__PURE__*/external_react_default().createElement("div", {
        id: "globalWarningMessage"
      }, /*#__PURE__*/external_react_default().createElement("i", {
        className: "close fa fa-times",
        onClick: this.close
      }), /*#__PURE__*/external_react_default().createElement("div", {
        dangerouslySetInnerHTML: {
          __html: sefaria.globalWarningMessage
        }
      })) : null;
    }
  }]);
  return GlobalWarningMessage;
}((external_react_class_default()));
var TextBlockLink = /*#__PURE__*/function (_Component7) {
  Misc_inherits(TextBlockLink, _Component7);
  var _super7 = Misc_createSuper(TextBlockLink);
  function TextBlockLink() {
    Misc_classCallCheck(this, TextBlockLink);
    return _super7.apply(this, arguments);
  }
  Misc_createClass(TextBlockLink, [{
    key: "render",
    value:
    // Monopoly card style link with category color at top
    // This component is seriously overloaded :grimacing:

    function render() {
      var _this$props3 = this.props,
        book = _this$props3.book,
        category = _this$props3.category,
        title = _this$props3.title,
        heTitle = _this$props3.heTitle,
        showSections = _this$props3.showSections,
        sref = _this$props3.sref,
        heRef = _this$props3.heRef,
        displayValue = _this$props3.displayValue,
        heDisplayValue = _this$props3.heDisplayValue,
        position = _this$props3.position,
        url_string = _this$props3.url_string,
        recentItem = _this$props3.recentItem,
        currVersions = _this$props3.currVersions,
        sideColor = _this$props3.sideColor,
        saved = _this$props3.saved,
        sheetTitle = _this$props3.sheetTitle,
        sheetOwner = _this$props3.sheetOwner,
        timeStamp = _this$props3.timeStamp,
        intlang = _this$props3.intlang;
      var index = sefaria.index(book);
      category = category || (index ? index.primary_category : "Other");
      var style = {
        "borderColor": sefaria.palette.categoryColor(category)
      };
      title = title || (showSections ? sref : book);
      heTitle = heTitle || (showSections ? heRef : index.heTitle);
      var hlang = intlang ? "int-he" : "he";
      var elang = intlang ? "int-en" : "en";
      var byLine;
      if (!!sheetOwner && sideColor) {
        title = sheetTitle.stripHtml();
        heTitle = title;
        byLine = sheetOwner;
      }
      var subtitle = displayValue ? /*#__PURE__*/external_react_default().createElement("span", {
        className: "blockLinkSubtitle"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: elang
      }, displayValue), /*#__PURE__*/external_react_default().createElement("span", {
        className: hlang
      }, heDisplayValue)) : null;
      position = position || 0;
      var isSheet = book === 'Sheet';
      var classes = external_classnames_default()({
        refLink: !isSheet,
        sheetLink: isSheet,
        blockLink: 1,
        recentItem: recentItem,
        calendarLink: subtitle != null,
        saved: saved
      });
      url_string = url_string ? url_string : sref;
      var url;
      if (isSheet) {
        url = "/sheets/".concat(sefaria.normRef(url_string).replace('Sheet.', ''));
      } else {
        url = "/" + sefaria.normRef(url_string) + sefaria.util.getUrlVersionsParams(currVersions).replace("&", "?");
      }
      if (sideColor) {
        return /*#__PURE__*/external_react_default().createElement("a", {
          href: url,
          className: classes,
          "data-ref": sref,
          "data-ven": currVersions.en,
          "data-vhe": currVersions.he,
          "data-position": position
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "sideColorLeft",
          "data-ref-child": true
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "sideColor",
          "data-ref-child": true,
          style: {
            backgroundColor: sefaria.palette.categoryColor(category)
          }
        }), /*#__PURE__*/external_react_default().createElement("div", {
          className: "sideColorInner",
          "data-ref-child": true
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: elang,
          "data-ref-child": true
        }, title, !!sheetOwner ? /*#__PURE__*/external_react_default().createElement("i", {
          className: "byLine",
          "data-ref-child": true
        }, byLine) : null), /*#__PURE__*/external_react_default().createElement("span", {
          className: hlang,
          "data-ref-child": true
        }, heTitle, !!sheetOwner ? /*#__PURE__*/external_react_default().createElement("i", {
          className: "byLine",
          "data-ref-child": true
        }, byLine) : null))), /*#__PURE__*/external_react_default().createElement("div", {
          className: "sideColorRight"
        }, saved ? /*#__PURE__*/external_react_default().createElement(SaveButton, {
          historyObject: {
            ref: sref,
            versions: currVersions
          }
        }) : null, !saved && timeStamp ? /*#__PURE__*/external_react_default().createElement("span", {
          className: "sans-serif"
        }, sefaria.util.naturalTime(timeStamp)) : null));
      }
      return /*#__PURE__*/external_react_default().createElement("a", {
        href: url,
        className: classes,
        "data-ref": sref,
        "data-ven": currVersions.en,
        "data-vhe": currVersions.he,
        "data-position": position,
        style: style
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: elang
      }, title), /*#__PURE__*/external_react_default().createElement("span", {
        className: hlang
      }, heTitle), subtitle);
    }
  }]);
  return TextBlockLink;
}((external_react_class_default()));
TextBlockLink.propTypes = {
  sref: (external_prop_types_default()).string.isRequired,
  currVersions: (external_prop_types_default()).object.isRequired,
  heRef: (external_prop_types_default()).string,
  book: (external_prop_types_default()).string,
  category: (external_prop_types_default()).string,
  title: (external_prop_types_default()).string,
  heTitle: (external_prop_types_default()).string,
  displayValue: (external_prop_types_default()).string,
  heDisplayValue: (external_prop_types_default()).string,
  url_string: (external_prop_types_default()).string,
  showSections: (external_prop_types_default()).bool,
  recentItem: (external_prop_types_default()).bool,
  position: (external_prop_types_default()).number,
  sideColor: (external_prop_types_default()).bool,
  saved: (external_prop_types_default()).bool,
  sheetTitle: (external_prop_types_default()).string,
  sheetOwner: (external_prop_types_default()).string,
  timeStamp: (external_prop_types_default()).number
};
TextBlockLink.defaultProps = {
  currVersions: {
    en: null,
    he: null
  }
};
var LanguageToggleButton = /*#__PURE__*/function (_Component8) {
  Misc_inherits(LanguageToggleButton, _Component8);
  var _super8 = Misc_createSuper(LanguageToggleButton);
  function LanguageToggleButton() {
    Misc_classCallCheck(this, LanguageToggleButton);
    return _super8.apply(this, arguments);
  }
  Misc_createClass(LanguageToggleButton, [{
    key: "toggle",
    value: function toggle(e) {
      e.preventDefault();
      this.props.toggleLanguage();
    }
  }, {
    key: "render",
    value: function render() {
      var url = this.props.url || "";
      return /*#__PURE__*/external_react_default().createElement("a", {
        href: url,
        className: "languageToggle",
        onClick: this.toggle
      }, /*#__PURE__*/external_react_default().createElement("img", {
        className: "en",
        src: "/static/img/aleph.svg",
        alt: "Hebrew Language Toggle Icon"
      }), /*#__PURE__*/external_react_default().createElement("img", {
        className: "he",
        src: "/static/img/aye.svg",
        alt: "English Language Toggle Icon"
      }));
    }
  }]);
  return LanguageToggleButton;
}((external_react_class_default()));
LanguageToggleButton.propTypes = {
  toggleLanguage: (external_prop_types_default()).func.isRequired,
  url: (external_prop_types_default()).string
};
var ColorBarBox = function ColorBarBox(_ref8) {
  var tref = _ref8.tref,
    children = _ref8.children;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "colorBarBox",
    style: {
      "borderColor": sefaria.palette.refColor(tref)
    }
  }, children);
};
var DangerousInterfaceBlock = function DangerousInterfaceBlock(_ref9) {
  var en = _ref9.en,
    he = _ref9.he,
    classes = _ref9.classes;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: classes
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    html: {
      "en": en,
      "he": he
    }
  }));
};
DangerousInterfaceBlock.propTypes = {
  en: (external_prop_types_default()).string,
  he: (external_prop_types_default()).string,
  classes: (external_prop_types_default()).string
};
var SimpleInterfaceBlock = function SimpleInterfaceBlock(_ref10) {
  var en = _ref10.en,
    he = _ref10.he,
    classes = _ref10.classes;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: classes
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: en,
      he: he
    }
  }));
};
SimpleInterfaceBlock.propTypes = {
  en: (external_prop_types_default()).string,
  he: (external_prop_types_default()).string,
  classes: (external_prop_types_default()).string
};
var SimpleContentBlock = function SimpleContentBlock(_ref11) {
  var children = _ref11.children,
    classes = _ref11.classes;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: classes
  }, children);
};
SimpleContentBlock.propTypes = {
  classes: (external_prop_types_default()).string
};
var SimpleLinkedBlock = function SimpleLinkedBlock(_ref12) {
  var en = _ref12.en,
    he = _ref12.he,
    url = _ref12.url,
    classes = _ref12.classes,
    aclasses = _ref12.aclasses,
    children = _ref12.children,
    onClick = _ref12.onClick,
    openInNewTab = _ref12.openInNewTab;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: classes,
    onClick: onClick
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: url,
    className: aclasses,
    target: openInNewTab ? "_blank" : "_self"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: en,
      he: he
    }
  })), children);
};
SimpleLinkedBlock.propTypes = {
  en: (external_prop_types_default()).string,
  he: (external_prop_types_default()).string,
  url: (external_prop_types_default()).string,
  classes: (external_prop_types_default()).string,
  aclasses: (external_prop_types_default()).string
};
var BlockLink = /*#__PURE__*/function (_Component9) {
  Misc_inherits(BlockLink, _Component9);
  var _super9 = Misc_createSuper(BlockLink);
  function BlockLink() {
    Misc_classCallCheck(this, BlockLink);
    return _super9.apply(this, arguments);
  }
  Misc_createClass(BlockLink, [{
    key: "render",
    value: function render() {
      var interfaceClass = this.props.interfaceLink ? 'int-' : '';
      var cn = {
        blockLink: 1
      };
      var linkClass = this.props.title.toLowerCase().replace(" ", "-") + "-link";
      cn[linkClass] = 1;
      var classes = external_classnames_default()(cn);
      return /*#__PURE__*/external_react_default().createElement("a", {
        className: classes,
        href: this.props.target
      }, this.props.image ? /*#__PURE__*/external_react_default().createElement("img", {
        src: this.props.image,
        alt: ""
      }) : null, /*#__PURE__*/external_react_default().createElement("span", {
        className: "".concat(interfaceClass, "en")
      }, this.props.title), /*#__PURE__*/external_react_default().createElement("span", {
        className: "".concat(interfaceClass, "he")
      }, this.props.heTitle));
    }
  }]);
  return BlockLink;
}((external_react_class_default()));
BlockLink.propTypes = {
  title: (external_prop_types_default()).string,
  heTitle: (external_prop_types_default()).string,
  target: (external_prop_types_default()).string,
  image: (external_prop_types_default()).string,
  interfaceLink: (external_prop_types_default()).bool
};
BlockLink.defaultProps = {
  interfaceLink: false
};
var ToggleSet = /*#__PURE__*/function (_Component10) {
  Misc_inherits(ToggleSet, _Component10);
  var _super10 = Misc_createSuper(ToggleSet);
  function ToggleSet() {
    Misc_classCallCheck(this, ToggleSet);
    return _super10.apply(this, arguments);
  }
  Misc_createClass(ToggleSet, [{
    key: "render",
    value:
    // A set of options grouped together.
    function render() {
      var _this7 = this;
      var classes = {
        toggleSet: 1,
        separated: this.props.separated,
        blueStyle: this.props.blueStyle
      };
      classes[this.props.name] = 1;
      classes = external_classnames_default()(classes);
      var width = 100.0 - (this.props.separated ? (this.props.options.length - 1) * 3 : 0);
      var style = {
        width: width / this.props.options.length + "%"
      };
      var label = this.props.label ? /*#__PURE__*/external_react_default().createElement("span", {
        className: "toggle-set-label"
      }, this.props.label) : null;
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes,
        role: "radiogroup",
        "aria-label": this.props.ariaLabel
      }, label, /*#__PURE__*/external_react_default().createElement("div", {
        className: "toggleSetToggleBox"
      }, this.props.options.map(function (option) {
        return /*#__PURE__*/external_react_default().createElement(ToggleOption, {
          name: option.name,
          key: option.name,
          set: _this7.props.name,
          role: option.role,
          ariaLabel: option.ariaLabel,
          on: _this7.props.currentValue == option.name,
          setOption: _this7.props.setOption,
          style: style,
          image: option.image,
          fa: option.fa,
          content: option.content
        });
      })));
    }
  }]);
  return ToggleSet;
}((external_react_class_default()));
ToggleSet.propTypes = {
  name: (external_prop_types_default()).string.isRequired,
  label: (external_prop_types_default()).string,
  setOption: (external_prop_types_default()).func.isRequired,
  currentValue: (external_prop_types_default()).string,
  options: (external_prop_types_default()).array.isRequired,
  separated: (external_prop_types_default()).bool,
  blueStyle: (external_prop_types_default()).bool,
  role: (external_prop_types_default()).string,
  ariaLabel: (external_prop_types_default()).string
};
var ToggleOption = /*#__PURE__*/function (_Component11) {
  Misc_inherits(ToggleOption, _Component11);
  var _super11 = Misc_createSuper(ToggleOption);
  function ToggleOption() {
    Misc_classCallCheck(this, ToggleOption);
    return _super11.apply(this, arguments);
  }
  Misc_createClass(ToggleOption, [{
    key: "handleClick",
    value:
    // A single option in a ToggleSet

    function handleClick() {
      this.props.setOption(this.props.set, this.props.name);
      if (sefaria.site) {
        sefaria.track.event("Reader", "Display Option Click", this.props.set + " - " + this.props.name);
      }
    }
  }, {
    key: "checkKeyPress",
    value: function checkKeyPress(e) {
      if (e.keyCode === 39 || e.keyCode === 40) {
        //39 is right arrow -- 40 is down
        sefariaJquery(e.target).siblings(".toggleOption").attr("tabIndex", "-1");
        sefariaJquery(e.target).attr("tabIndex", "-1");
        sefariaJquery(e.target).next(".toggleOption").focus().attr("tabIndex", "0");
      } else if (e.keyCode === 37 || e.keyCode === 38) {
        //37 is left arrow -- 38 is up
        sefariaJquery(e.target).siblings(".toggleOption").attr("tabIndex", "-1");
        sefariaJquery(e.target).attr("tabIndex", "-1");
        sefariaJquery(e.target).prev(".toggleOption").focus().attr("tabIndex", "0");
      } else if (e.keyCode === 13) {
        //13 is enter
        sefariaJquery(e.target).trigger("click");
      } else if (e.keyCode === 9) {
        //9 is tab
        var lastTab = sefariaJquery("div[role='dialog']").find(':tabbable').last();
        var firstTab = sefariaJquery("div[role='dialog']").find(':tabbable').first();
        if (e.shiftKey) {
          if (sefariaJquery(e.target).is(firstTab)) {
            sefariaJquery(lastTab).focus();
            e.preventDefault();
          }
        } else {
          if (sefariaJquery(e.target).is(lastTab)) {
            sefariaJquery(firstTab).focus();
            e.preventDefault();
          }
        }
      } else if (e.keyCode === 27) {
        //27 is escape
        e.stopPropagation();
        sefariaJquery(".mask").trigger("click");
      }
    }
  }, {
    key: "render",
    value: function render() {
      var classes = {
        toggleOption: 1,
        on: this.props.on
      };
      var tabIndexValue = this.props.on ? 0 : -1;
      var ariaCheckedValue = this.props.on ? "true" : "false";
      classes[this.props.name] = 1;
      classes = external_classnames_default()(classes);
      var content = this.props.image ? /*#__PURE__*/external_react_default().createElement("img", {
        src: this.props.image,
        alt: ""
      }) : this.props.fa ? /*#__PURE__*/external_react_default().createElement("i", {
        className: "fa fa-" + this.props.fa
      }) : typeof this.props.content === "string" ? /*#__PURE__*/external_react_default().createElement("span", {
        dangerouslySetInnerHTML: {
          __html: this.props.content
        }
      }) : this.props.content;
      return /*#__PURE__*/external_react_default().createElement("div", {
        role: this.props.role,
        "aria-label": this.props.ariaLabel,
        tabIndex: this.props.role == "radio" ? tabIndexValue : "0",
        "aria-checked": ariaCheckedValue,
        className: classes,
        onKeyDown: this.checkKeyPress,
        onClick: this.handleClick
      }, content);
    }
  }]);
  return ToggleOption;
}((external_react_class_default())); //style={this.props.style}
var requestWithCallBack = function requestWithCallBack(_ref13) {
  var url = _ref13.url,
    setSavingStatus = _ref13.setSavingStatus,
    redirect = _ref13.redirect,
    _ref13$type = _ref13.type,
    type = _ref13$type === void 0 ? "POST" : _ref13$type,
    _ref13$data = _ref13.data,
    data = _ref13$data === void 0 ? {} : _ref13$data;
  var ajaxPayload = {
    url: url,
    type: type
  };
  if (type === "POST") {
    ajaxPayload.data = {
      json: JSON.stringify(data)
    };
  }
  sefariaJquery.ajax(Misc_objectSpread(Misc_objectSpread({}, ajaxPayload), {}, {
    success: function success(result) {
      if ("error" in result) {
        if (setSavingStatus) {
          setSavingStatus(false);
        }
        alert(result.error);
      } else {
        redirect();
      }
    }
  })).fail(function () {
    alert(sefaria._("Something went wrong. Sorry!"));
  });
};
var TopicToCategorySlug = function TopicToCategorySlug(topic) {
  var category = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
  //helper function for AdminEditor
  if (!category) {
    category = sefaria.topicTocCategory(topic.slug);
  }
  var initCatSlug = category ? category.slug : "Main Menu"; //category topics won't be found using topicTocCategory,
  // so all category topics initialized to "Main Menu"
  if ("displays-under" in (topic === null || topic === void 0 ? void 0 : topic.links) && "displays-above" in (topic === null || topic === void 0 ? void 0 : topic.links)) {
    var _topic$links$displays;
    // this case handles categories that are not top level but have children under them
    var displayUnderLinks = (_topic$links$displays = topic.links["displays-under"]) === null || _topic$links$displays === void 0 ? void 0 : _topic$links$displays.links;
    if (displayUnderLinks && displayUnderLinks.length === 1) {
      initCatSlug = displayUnderLinks[0].topic;
    }
  }
  return initCatSlug;
};
function useHiddenButtons() {
  var _useState13 = (0,external_react_.useState)(true),
    _useState14 = Misc_slicedToArray(_useState13, 2),
    hideButtons = _useState14[0],
    setHideButtons = _useState14[1];
  var handleMouseOverAdminButtons = function handleMouseOverAdminButtons() {
    setHideButtons(false);
    setTimeout(function () {
      return setHideButtons(true);
    }, 3000);
  };
  return [hideButtons, handleMouseOverAdminButtons];
}
var AllAdminButtons = function AllAdminButtons(_ref14) {
  var buttonOptions = _ref14.buttonOptions,
    buttonsToDisplay = _ref14.buttonsToDisplay,
    adminClasses = _ref14.adminClasses;
  return /*#__PURE__*/external_react_default().createElement("span", {
    className: adminClasses
  }, buttonsToDisplay.map(function (key, i) {
    var top = i === 0;
    var bottom = i === buttonsToDisplay.length - 1;
    var _buttonOptions$key = Misc_slicedToArray(buttonOptions[key], 2),
      buttonText = _buttonOptions$key[0],
      toggleAddingTopics = _buttonOptions$key[1];
    return /*#__PURE__*/external_react_default().createElement(AdminEditorButton, {
      text: buttonText,
      top: top,
      bottom: bottom,
      toggleAddingTopics: toggleAddingTopics
    });
  }));
};
var CategoryHeader = function CategoryHeader(_ref15) {
  var children = _ref15.children,
    type = _ref15.type,
    _ref15$data = _ref15.data,
    data = _ref15$data === void 0 ? [] : _ref15$data,
    _ref15$buttonsToDispl = _ref15.buttonsToDisplay,
    buttonsToDisplay = _ref15$buttonsToDispl === void 0 ? ["subcategory", "edit"] : _ref15$buttonsToDispl;
  /*
  Provides an interface for using admin tools.
  `type` is 'sources', 'cats', 'books' or 'topics'
  `data` is list when `type` === 'cats' which tells us where we are in the TOC tree,
        for `type` === 'books' it's the name of the book
        for `type` === 'topics' it's a dictionary of the topic object
        for `type` === 'sources' it's a list where the first item is topic slug and second item is source data
  `buttonsToDisplay` is a list that says in the specified order we want all of the buttons in buttonOptions
   */
  var _useEditToggle = useEditToggle(),
    _useEditToggle2 = Misc_slicedToArray(_useEditToggle, 2),
    editCategory = _useEditToggle2[0],
    toggleEditCategory = _useEditToggle2[1];
  var _useEditToggle3 = useEditToggle(),
    _useEditToggle4 = Misc_slicedToArray(_useEditToggle3, 2),
    addCategory = _useEditToggle4[0],
    toggleAddCategory = _useEditToggle4[1];
  var _useEditToggle5 = useEditToggle(),
    _useEditToggle6 = Misc_slicedToArray(_useEditToggle5, 2),
    reorderCategory = _useEditToggle6[0],
    toggleReorderCategory = _useEditToggle6[1];
  var _useEditToggle7 = useEditToggle(),
    _useEditToggle8 = Misc_slicedToArray(_useEditToggle7, 2),
    addSource = _useEditToggle8[0],
    toggleAddSource = _useEditToggle8[1];
  var _useEditToggle9 = useEditToggle(),
    _useEditToggle10 = Misc_slicedToArray(_useEditToggle9, 2),
    addSection = _useEditToggle10[0],
    toggleAddSection = _useEditToggle10[1];
  var _useHiddenButtons = useHiddenButtons(true),
    _useHiddenButtons2 = Misc_slicedToArray(_useHiddenButtons, 2),
    hiddenButtons = _useHiddenButtons2[0],
    setHiddenButtons = _useHiddenButtons2[1];
  var buttonOptions = {
    "subcategory": ["Add sub-category", toggleAddCategory],
    "source": ["Add a source", toggleAddSource],
    "section": ["Add section", toggleAddSection],
    "reorder": ["Reorder sources", toggleReorderCategory],
    "edit": ["Edit", toggleEditCategory]
  };
  var wrapper = "";
  var adminButtonsSpan = null;
  if (sefaria.is_moderator) {
    if (editCategory) {
      adminButtonsSpan = /*#__PURE__*/external_react_default().createElement(CategoryEditorWrapper, {
        toggle: toggleEditCategory,
        data: data,
        type: type
      });
    } else if (addSource) {
      adminButtonsSpan = /*#__PURE__*/external_react_default().createElement(SourceEditor, {
        topic: data.slug,
        close: toggleAddSource
      });
    } else if (addCategory) {
      adminButtonsSpan = /*#__PURE__*/external_react_default().createElement(CategoryAdderWrapper, {
        toggle: toggleAddCategory,
        data: data,
        type: type
      });
    } else if (addSection) {
      window.location = "/add/".concat(data);
    } else if (reorderCategory) {
      adminButtonsSpan = /*#__PURE__*/external_react_default().createElement(ReorderEditorWrapper, {
        toggle: toggleReorderCategory,
        data: data,
        type: type
      }); // reordering sources on a topic page
    } else {
      wrapper = "headerWithAdminButtons";
      var adminClasses = external_classnames_default()({
        adminButtons: 1,
        hiddenButtons: hiddenButtons
      });
      adminButtonsSpan = /*#__PURE__*/external_react_default().createElement(AllAdminButtons, {
        buttonOptions: buttonOptions,
        buttonsToDisplay: buttonsToDisplay,
        adminClasses: adminClasses
      });
    }
  }
  return /*#__PURE__*/external_react_default().createElement("span", {
    className: wrapper
  }, /*#__PURE__*/external_react_default().createElement("span", {
    onMouseEnter: function onMouseEnter() {
      return setHiddenButtons();
    }
  }, children), /*#__PURE__*/external_react_default().createElement("span", null, adminButtonsSpan));
};
var ReorderEditorWrapper = function ReorderEditorWrapper(_ref16) {
  var toggle = _ref16.toggle,
    type = _ref16.type,
    data = _ref16.data;
  /*
  Wrapper for ReorderEditor that can reorder topics, categories, and sources.  It is only used for reordering topics and categories at the
  root of the topic or category TOC, so an empty array for `data` is passed indicating these cases.  In the case of reordering sources, `data`
  is a dictionary of the topic whose sources can be accessed via its `refs` field.
   */
  var reorderingSources = data.length !== 0;
  var _filterAndSortRefs = function _filterAndSortRefs(refs) {
    if (!refs) {
      return [];
    }
    // a topic can be connected to refs in one language and not in another so filter out those that are not in current interface lang
    refs = refs.filter(function (x) {
      var _x$order, _x$order$availableLan;
      return !x.is_sheet && (x === null || x === void 0 ? void 0 : (_x$order = x.order) === null || _x$order === void 0 ? void 0 : (_x$order$availableLan = _x$order.availableLangs) === null || _x$order$availableLan === void 0 ? void 0 : _x$order$availableLan.includes(sefaria.interfaceLang.slice(0, 2)));
    });
    // then sort the refs and take only first 30 sources because admins don't want to reorder hundreds of sources
    return refs.sort(function (a, b) {
      return refSort('relevance', [a.ref, a], [b.ref, b]);
    }).slice(0, 30);
  };
  var _createURLs = function _createURLs(type, data) {
    if (reorderingSources) {
      var _data$refs, _data$refs$about;
      return {
        url: "/api/source/reorder?topic=".concat(data.slug, "&lang=").concat(sefaria.interfaceLang),
        redirect: "/topics/".concat(data.slug),
        origItems: _filterAndSortRefs((_data$refs = data.refs) === null || _data$refs === void 0 ? void 0 : (_data$refs$about = _data$refs.about) === null || _data$refs$about === void 0 ? void 0 : _data$refs$about.refs) || []
      };
    }
    switch (type) {
      // at /texts or /topics
      case 'topics':
        return {
          url: '/api/topic/reorder',
          redirect: '/topics',
          origItems: sefaria.topic_toc
        };
      case 'cats':
        return {
          url: '/api/category?reorder=1',
          redirect: '/texts',
          origItems: sefaria.toc
        };
    }
  };
  var _createURLs2 = _createURLs(type, data),
    url = _createURLs2.url,
    redirect = _createURLs2.redirect,
    origItems = _createURLs2.origItems;
  return /*#__PURE__*/external_react_default().createElement(ReorderEditor, {
    close: toggle,
    type: !reorderingSources ? type : 'sources',
    origItems: origItems,
    postURL: url,
    redirect: redirect
  });
};
var EditorForExistingTopic = function EditorForExistingTopic(_ref17) {
  var toggle = _ref17.toggle,
    data = _ref17.data;
  var initCatSlug = TopicToCategorySlug(data);
  var origData = {
    origSlug: data.slug,
    origCategorySlug: initCatSlug,
    origEn: data.primaryTitle.en,
    origHe: data.primaryTitle.he || "",
    origDesc: data.description || {
      "en": "",
      "he": ""
    },
    origCategoryDesc: data.categoryDescription || {
      "en": "",
      "he": ""
    }
  };
  var origWasCat = ("displays-above" in (data === null || data === void 0 ? void 0 : data.links));
  return /*#__PURE__*/external_react_default().createElement(TopicEditor, {
    origData: origData,
    origWasCat: origWasCat,
    onCreateSuccess: function onCreateSuccess(slug) {
      return window.location.href = "\"/topics/\"".concat(slug);
    },
    close: toggle
  });
};
var EditorForExistingCategory = function EditorForExistingCategory(_ref18) {
  var toggle = _ref18.toggle,
    data = _ref18.data;
  var tocObject = sefaria.tocObjectByCategories(data);
  var origDesc = {
    en: tocObject.enDesc,
    he: tocObject.heDesc
  };
  var origCategoryDesc = {
    en: tocObject.enShortDesc,
    he: tocObject.heShortDesc
  };
  var origData = {
    origEn: tocObject.category,
    origHe: tocObject.heCategory,
    origDesc: origDesc,
    origCategoryDesc: origCategoryDesc,
    isPrimary: tocObject.isPrimary
  };
  return /*#__PURE__*/external_react_default().createElement(CategoryEditor, {
    origData: origData,
    close: toggle,
    origPath: data.slice(0, -1)
  });
};
var CategoryEditorWrapper = function CategoryEditorWrapper(_ref19) {
  var toggle = _ref19.toggle,
    data = _ref19.data,
    type = _ref19.type;
  switch (type) {
    case "books":
      return /*#__PURE__*/external_react_default().createElement(EditTextInfo, {
        initTitle: data,
        close: toggle
      });
    case "sources":
      var _data = Misc_slicedToArray(data, 2),
        topicSlug = _data[0],
        refData = _data[1];
      return /*#__PURE__*/external_react_default().createElement(SourceEditor, {
        topic: topicSlug,
        origData: refData,
        close: toggle
      });
    case "cats":
      return /*#__PURE__*/external_react_default().createElement(EditorForExistingCategory, {
        toggle: toggle,
        data: data
      });
    case "topics":
      return /*#__PURE__*/external_react_default().createElement(EditorForExistingTopic, {
        toggle: toggle,
        data: data
      });
  }
};
var CategoryAdderWrapper = function CategoryAdderWrapper(_ref20) {
  var toggle = _ref20.toggle,
    data = _ref20.data,
    type = _ref20.type;
  var origData = {
    origEn: ""
  };
  switch (type) {
    case "cats":
      return /*#__PURE__*/external_react_default().createElement(CategoryEditor, {
        origData: origData,
        close: toggle,
        origPath: data
      });
    case "topics":
      origData['origCategorySlug'] = data;
      return /*#__PURE__*/external_react_default().createElement(TopicEditor, {
        origData: origData,
        close: toggle,
        origWasCat: false,
        onCreateSuccess: function onCreateSuccess(slug) {
          return window.location.href = "/topics/" + slug;
        }
      });
  }
};
var SearchButton = /*#__PURE__*/function (_Component12) {
  Misc_inherits(SearchButton, _Component12);
  var _super12 = Misc_createSuper(SearchButton);
  function SearchButton() {
    Misc_classCallCheck(this, SearchButton);
    return _super12.apply(this, arguments);
  }
  Misc_createClass(SearchButton, [{
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("span", {
        className: "readerNavMenuSearchButton",
        onClick: this.props.onClick
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/iconmonstr-magnifier-2.svg"
      }));
    }
  }]);
  return SearchButton;
}((external_react_class_default()));
var MenuButton = /*#__PURE__*/function (_Component13) {
  Misc_inherits(MenuButton, _Component13);
  var _super13 = Misc_createSuper(MenuButton);
  function MenuButton() {
    Misc_classCallCheck(this, MenuButton);
    return _super13.apply(this, arguments);
  }
  Misc_createClass(MenuButton, [{
    key: "render",
    value: function render() {
      var isheb = sefaria.interfaceLang == "hebrew";
      var icon = this.props.compare ? isheb ? /*#__PURE__*/external_react_default().createElement("i", {
        className: "fa fa-chevron-right"
      }) : /*#__PURE__*/external_react_default().createElement("i", {
        className: "fa fa-chevron-left"
      }) : /*#__PURE__*/external_react_default().createElement("i", {
        className: "fa fa-bars"
      });
      return /*#__PURE__*/external_react_default().createElement("span", {
        className: "readerNavMenuMenuButton",
        onClick: this.props.onClick
      }, icon);
    }
  }]);
  return MenuButton;
}((external_react_class_default()));
MenuButton.propTypes = {
  onClick: (external_prop_types_default()).func,
  compare: (external_prop_types_default()).bool
};
var CloseButton = /*#__PURE__*/function (_Component14) {
  Misc_inherits(CloseButton, _Component14);
  var _super14 = Misc_createSuper(CloseButton);
  function CloseButton() {
    Misc_classCallCheck(this, CloseButton);
    return _super14.apply(this, arguments);
  }
  Misc_createClass(CloseButton, [{
    key: "onClick",
    value: function onClick(e) {
      e.preventDefault();
      this.props.onClick();
    }
  }, {
    key: "render",
    value: function render() {
      if (this.props.icon == "circledX") {
        var icon = /*#__PURE__*/external_react_default().createElement("img", {
          src: "/static/icons/circled-x.svg"
        });
      } else if (this.props.icon == "chevron") {
        var icon = /*#__PURE__*/external_react_default().createElement("i", {
          className: "fa fa-chevron-left"
        });
      } else {
        var icon = "×";
      }
      var classes = external_classnames_default()({
        readerNavMenuCloseButton: 1,
        circledX: this.props.icon === "circledX"
      });
      var url = this.props.url || "";
      return /*#__PURE__*/external_react_default().createElement("a", {
        href: url,
        className: classes,
        onClick: this.onClick
      }, icon);
    }
  }]);
  return CloseButton;
}((external_react_class_default()));
var DisplaySettingsButton = /*#__PURE__*/function (_Component15) {
  Misc_inherits(DisplaySettingsButton, _Component15);
  var _super15 = Misc_createSuper(DisplaySettingsButton);
  function DisplaySettingsButton() {
    Misc_classCallCheck(this, DisplaySettingsButton);
    return _super15.apply(this, arguments);
  }
  Misc_createClass(DisplaySettingsButton, [{
    key: "render",
    value: function render() {
      var style = this.props.placeholder ? {
        visibility: "hidden"
      } : {};
      var icon = sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/img/ayealeph.svg",
        alt: "Toggle Reader Menu Display Settings",
        style: style
      }) : /*#__PURE__*/external_react_default().createElement("span", {
        className: "textIcon"
      }, "Aa");
      return /*#__PURE__*/external_react_default().createElement("a", {
        className: "readerOptions",
        tabIndex: "0",
        role: "button",
        "aria-haspopup": "true",
        "aria-label": "Toggle Reader Menu Display Settings",
        style: style,
        onClick: this.props.onClick,
        onKeyPress: function (e) {
          e.charCode == 13 ? this.props.onClick(e) : null;
        }.bind(this)
      }, icon);
    }
  }]);
  return DisplaySettingsButton;
}((external_react_class_default()));
DisplaySettingsButton.propTypes = {
  onClick: (external_prop_types_default()).func,
  placeholder: (external_prop_types_default()).bool
};
function InterfaceLanguageMenu(_ref21) {
  var currentLang = _ref21.currentLang,
    translationLanguagePreference = _ref21.translationLanguagePreference,
    setTranslationLanguagePreference = _ref21.setTranslationLanguagePreference;
  var _useState15 = (0,external_react_.useState)(false),
    _useState16 = Misc_slicedToArray(_useState15, 2),
    isOpen = _useState16[0],
    setIsOpen = _useState16[1];
  var wrapperRef = (0,external_react_.useRef)(null);
  var getCurrentPage = function getCurrentPage() {
    return isOpen ? encodeURIComponent(sefaria.util.currentPath()) : "/";
  };
  var handleClick = function handleClick(e) {
    e.stopPropagation();
    setIsOpen(function (isOpen) {
      return !isOpen;
    });
  };
  var handleTransPrefResetClick = function handleTransPrefResetClick(e) {
    e.stopPropagation();
    setTranslationLanguagePreference(null);
  };
  var handleHideDropdown = function handleHideDropdown(event) {
    if (event.key === 'Escape') {
      setIsOpen(false);
    }
  };
  var handleClickOutside = function handleClickOutside(event) {
    if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {
      setIsOpen(false);
    }
  };
  (0,external_react_.useEffect)(function () {
    document.addEventListener('keydown', handleHideDropdown, true);
    document.addEventListener('click', handleClickOutside, true);
    return function () {
      document.removeEventListener('keydown', handleHideDropdown, true);
      document.removeEventListener('click', handleClickOutside, true);
    };
  }, []);
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "interfaceLinks",
    ref: wrapperRef
  }, /*#__PURE__*/external_react_default().createElement("a", {
    className: "interfaceLinks-button",
    onClick: handleClick
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/globe-wire.svg"
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "interfaceLinks-menu ".concat(isOpen ? "open" : "closed")
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "interfaceLinks-header"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Site Language")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "interfaceLinks-options"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    className: "interfaceLinks-option int-bi int-he ".concat(currentLang == 'hebrew' ? 'active' : ''),
    href: "/interface/hebrew?next=".concat(getCurrentPage())
  }, "\u05E2\u05D1\u05E8\u05D9\u05EA"), /*#__PURE__*/external_react_default().createElement("a", {
    className: "interfaceLinks-option int-bi int-en ".concat(currentLang == 'english' ? 'active' : ''),
    href: "/interface/english?next=".concat(getCurrentPage())
  }, "English")), !!translationLanguagePreference ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "interfaceLinks-header"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Preferred Translation")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "interfaceLinks-options trans-pref-header-container"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, sefaria.translateISOLanguageCode(translationLanguagePreference, true)), /*#__PURE__*/external_react_default().createElement("a", {
    className: "trans-pref-reset",
    onClick: handleTransPrefResetClick
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/circled-x.svg",
    className: "reset-btn"
  }), /*#__PURE__*/external_react_default().createElement("span", {
    className: "smallText"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Reset"))))) : null));
}
InterfaceLanguageMenu.propTypes = {
  currentLang: (external_prop_types_default()).string,
  translationLanguagePreference: (external_prop_types_default()).string
};
function SaveButton(_ref22) {
  var historyObject = _ref22.historyObject,
    placeholder = _ref22.placeholder,
    tooltip = _ref22.tooltip,
    toggleSignUpModal = _ref22.toggleSignUpModal;
  if (!historyObject) {
    placeholder = true;
  }
  var isSelected = function isSelected() {
    return !!sefaria.getSavedItem(historyObject);
  };
  var _useState17 = (0,external_react_.useState)(placeholder || isSelected()),
    _useState18 = Misc_slicedToArray(_useState17, 2),
    selected = _useState18[0],
    setSelected = _useState18[1];
  (0,external_react_.useEffect)(function () {
    if (placeholder) {
      return;
    }
    setSelected(isSelected());
  }, [historyObject && historyObject.ref]);
  var _useState19 = (0,external_react_.useState)(false),
    _useState20 = Misc_slicedToArray(_useState19, 2),
    isPosting = _useState20[0],
    setPosting = _useState20[1];
  var style = placeholder ? {
    visibility: 'hidden'
  } : {};
  var classes = external_classnames_default()({
    saveButton: 1,
    "tooltip-toggle": tooltip
  });
  var altText = placeholder ? '' : "".concat(sefaria._(selected ? "Remove" : "Save"), " \"").concat(historyObject.sheet_title ? historyObject.sheet_title.stripHtml() : sefaria._r(historyObject.ref), "\"");
  function onClick(event) {
    if (isPosting) {
      return;
    }
    event.preventDefault();
    setPosting(true);
    sefaria.track.event("Saved", "saving", historyObject.ref);
    sefaria.toggleSavedItem(historyObject).then(function () {
      setSelected(isSelected());
    }) // since request is async, check if it's selected from data
    ["catch"](function (e) {
      if (e == 'notSignedIn') {
        toggleSignUpModal(SignUpModalKind.Save);
      }
    })["finally"](function () {
      setPosting(false);
    });
  }
  return /*#__PURE__*/external_react_default().createElement(ToolTipped, {
    altText: altText,
    classes: classes,
    style: style,
    onClick: onClick
  }, selected ? /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/bookmark-filled.svg",
    alt: altText
  }) : /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/bookmark.svg",
    alt: altText
  }));
}
SaveButton.propTypes = {
  historyObject: external_prop_types_default().shape({
    ref: (external_prop_types_default()).string,
    versions: (external_prop_types_default()).object
  }),
  placeholder: (external_prop_types_default()).bool,
  tooltip: (external_prop_types_default()).bool,
  toggleSignUpModal: (external_prop_types_default()).func
};
var ToolTipped = function ToolTipped(_ref23) {
  var altText = _ref23.altText,
    classes = _ref23.classes,
    style = _ref23.style,
    _onClick = _ref23.onClick,
    children = _ref23.children;
  var analyticsContext = (0,external_react_.useContext)(AdContext);
  return /*#__PURE__*/external_react_default().createElement("div", {
    "aria-label": altText,
    tabIndex: "0",
    className: classes,
    role: "button",
    style: style,
    onClick: function onClick(e) {
      return trackG4.gtagClick(e, _onClick, "ToolTipped", {
        "classes": classes
      }, analyticsContext);
    },
    onKeyPress: function onKeyPress(e) {
      e.charCode == 13 ? _onClick(e) : null;
    }
  }, children);
};
var FollowButton = /*#__PURE__*/function (_Component16) {
  Misc_inherits(FollowButton, _Component16);
  var _super16 = Misc_createSuper(FollowButton);
  function FollowButton(props) {
    var _this8;
    Misc_classCallCheck(this, FollowButton);
    _this8 = _super16.call(this, props);
    _this8.state = {
      following: props.following,
      // Deal w/ case where we don't know?
      hovering: false
    };
    return _this8;
  }
  Misc_createClass(FollowButton, [{
    key: "_postFollow",
    value: function _postFollow() {
      var _this9 = this;
      sefariaJquery.post("/api/follow/" + this.props.uid, {}, function (data) {
        sefaria.following.push(_this9.props.uid); // keep local following list up-to-date
        sefaria.track.event("Following", "New Follow", _this9.props.uid);
      });
    }
  }, {
    key: "_postUnfollow",
    value: function _postUnfollow() {
      var _this10 = this;
      sefariaJquery.post("/api/unfollow/" + this.props.uid, {}, function (data) {
        sefaria.following = sefaria.following.filter(function (i) {
          return i !== _this10.props.uid;
        }); // keep local following list up-to-date
        sefaria.track.event("Following", "Unfollow", _this10.props.uid);
      });
    }
  }, {
    key: "onMouseEnter",
    value: function onMouseEnter() {
      if (this.props.disableUnfollow) {
        return;
      }
      this.setState({
        hovering: true
      });
    }
  }, {
    key: "onMouseLeave",
    value: function onMouseLeave() {
      this.setState({
        hovering: false
      });
    }
  }, {
    key: "onClick",
    value: function onClick(e) {
      e.stopPropagation();
      if (!sefaria._uid) {
        this.props.toggleSignUpModal(SignUpModalKind.Follow);
        return;
      }
      if (this.state.following && !this.props.disableUnfollow) {
        this._postUnfollow();
        this.setState({
          following: false
        });
      } else {
        this._postFollow();
        this.setState({
          following: true,
          hovering: false
        }); // hovering:false keeps the "unfollow" from flashing.
      }
    }
  }, {
    key: "render",
    value: function render() {
      var classes = this.props.classes ? this.props.classes : external_classnames_default()({
        largeFollowButton: this.props.large,
        smallFollowButton: !this.props.large,
        following: this.state.following,
        hovering: this.state.hovering,
        smallText: !this.props.large
      });
      var buttonText = this.state.following ? this.state.hovering ? "Unfollow" : "Following" : "Follow";
      buttonText = buttonText === "Follow" && this.props.followBack ? "Follow Back" : buttonText;
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes,
        onMouseEnter: this.onMouseEnter,
        onMouseLeave: this.onMouseLeave,
        onClick: this.onClick
      }, this.props.icon ? /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/".concat(this.state.following ? this.state.hovering ? "checkmark" : "checkmark" : "follow", ".svg"),
        "aria-hidden": "true"
      }) : null, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        context: "FollowButton"
      }, buttonText));
    }
  }]);
  return FollowButton;
}((external_react_class_default()));
FollowButton.propTypes = {
  uid: (external_prop_types_default()).number.isRequired,
  following: (external_prop_types_default()).bool,
  // is this person followed already?
  large: (external_prop_types_default()).bool,
  disableUnfollow: (external_prop_types_default()).bool,
  followBack: (external_prop_types_default()).bool,
  toggleSignUpModal: (external_prop_types_default()).func
};
var CategoryColorLine = function CategoryColorLine(_ref24) {
  var category = _ref24.category;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "categoryColorLine",
    style: {
      background: sefaria.palette.categoryColor(category)
    }
  });
};
var ProfileListing = /*#__PURE__*/function (_Component17) {
  Misc_inherits(ProfileListing, _Component17);
  var _super17 = Misc_createSuper(ProfileListing);
  function ProfileListing() {
    Misc_classCallCheck(this, ProfileListing);
    return _super17.apply(this, arguments);
  }
  Misc_createClass(ProfileListing, [{
    key: "render",
    value: function render() {
      var _this$props4 = this.props,
        url = _this$props4.url,
        image = _this$props4.image,
        name = _this$props4.name,
        uid = _this$props4.uid,
        is_followed = _this$props4.is_followed,
        toggleSignUpModal = _this$props4.toggleSignUpModal,
        smallfonts = _this$props4.smallfonts,
        organization = _this$props4.organization;
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "authorByLine sans-serif" + (smallfonts ? " small" : "")
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "authorByLineImage"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: url
      }, /*#__PURE__*/external_react_default().createElement(ProfilePic, {
        len: smallfonts ? 30 : 40,
        url: image,
        name: name
      }))), /*#__PURE__*/external_react_default().createElement("div", {
        className: "authorByLineText ".concat(smallfonts ? "small" : "")
      }, /*#__PURE__*/external_react_default().createElement(SimpleLinkedBlock, {
        classes: "authorName",
        url: url,
        en: name,
        he: name
      }, /*#__PURE__*/external_react_default().createElement(FollowButton, {
        large: false,
        uid: uid,
        following: is_followed,
        disableUnfollow: true,
        toggleSignUpModal: toggleSignUpModal
      })), !!organization ? /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
        classes: "authorOrganization",
        en: organization,
        he: organization
      }) : null));
    }
  }]);
  return ProfileListing;
}((external_react_class_default()));
ProfileListing.propTypes = {
  uid: (external_prop_types_default()).number.isRequired,
  url: (external_prop_types_default()).string.isRequired,
  image: (external_prop_types_default()).string.isRequired,
  name: (external_prop_types_default()).string.isRequired,
  is_followed: (external_prop_types_default()).bool,
  toggleSignUpModal: (external_prop_types_default()).func
};
var SheetListing = function SheetListing(_ref25) {
  var sheet = _ref25.sheet,
    connectedRefs = _ref25.connectedRefs,
    handleSheetClick = _ref25.handleSheetClick,
    handleSheetDelete = _ref25.handleSheetDelete,
    handleCollectionsChange = _ref25.handleCollectionsChange,
    editable = _ref25.editable,
    deletable = _ref25.deletable,
    saveable = _ref25.saveable,
    collectable = _ref25.collectable,
    pinnable = _ref25.pinnable,
    pinned = _ref25.pinned,
    pinSheet = _ref25.pinSheet,
    hideAuthor = _ref25.hideAuthor,
    showAuthorUnderneath = _ref25.showAuthorUnderneath,
    infoUnderneath = _ref25.infoUnderneath,
    hideCollection = _ref25.hideCollection,
    openInNewTab = _ref25.openInNewTab,
    toggleSignUpModal = _ref25.toggleSignUpModal,
    showSheetSummary = _ref25.showSheetSummary;
  // A source sheet presented in lists, like sidebar or profile page
  var _useState21 = (0,external_react_.useState)(false),
    _useState22 = Misc_slicedToArray(_useState21, 2),
    showCollectionsModal = _useState22[0],
    setShowCollectionsModal = _useState22[1];
  var handleSheetClickLocal = function handleSheetClickLocal(e) {
    //console.log("Sheet Click Handled");
    // TODO: There more contexts to distinguish / track. Profile, collections, search
    if (sefaria._uid == sheet.owner) {
      sefaria.track.event("Tools", "My Sheet Click", sheet.sheetUrl);
    } else {
      sefaria.track.event("Tools", "Sheet Click", sheet.sheetUrl);
    }
    if (handleSheetClick) {
      sefaria.track.sheets("Opened via Connections Panel", connectedRefs.toString());
      handleSheetClick(e, sheet, null, connectedRefs);
      e.preventDefault();
    }
  };
  var handleSheetOwnerClick = function handleSheetOwnerClick(e) {
    sefaria.track.event("Tools", "Sheet Owner Click", sheet.ownerProfileUrl);
  };
  var handleTopicClick = function handleTopicClick(topic) {
    sefaria.track.event("Tools", "Topic Click", topic);
  };
  var handleSheetDeleteClick = function handleSheetDeleteClick() {
    if (confirm(sefaria._("Are you sure you want to delete this sheet? There is no way to undo this action."))) {
      sefaria.sheets.deleteSheetById(sheet.id).then(handleSheetDelete);
    }
  };
  var toggleCollectionsModal = function toggleCollectionsModal() {
    if (sefaria._uid) {
      setShowCollectionsModal(!showCollectionsModal);
    } else {
      toggleSignUpModal(SignUpModalKind.AddToSheet);
    }
  };
  var title = sheet.title ? sheet.title.stripHtmlConvertLineBreaks() : "Untitled Source Sheet";
  var viewsIcon = sheet["public"] ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "sheetViews sans-serif"
  }, /*#__PURE__*/external_react_default().createElement("i", {
    className: "fa fa-eye",
    title: sheet.views + " views"
  }), " ", sheet.views) : /*#__PURE__*/external_react_default().createElement("div", {
    className: "sheetViews sans-serif"
  }, /*#__PURE__*/external_react_default().createElement("i", {
    className: "fa fa-lock",
    title: "Private"
  }));
  var views = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, sheet.views, "\xA0", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Views"));
  var sheetSummary = showSheetSummary && sheet.summary ? /*#__PURE__*/external_react_default().createElement(DangerousInterfaceBlock, {
    classes: "smallText sheetSummary",
    en: sheet.summary,
    he: sheet.sheet_summary
  }) : null;
  var sheetInfo = hideAuthor ? null : /*#__PURE__*/external_react_default().createElement("div", {
    className: "sheetInfo"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sheetUser"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: sheet.ownerProfileUrl,
    target: openInNewTab ? "_blank" : "_self"
  }, /*#__PURE__*/external_react_default().createElement(ProfilePic, {
    outerStyle: {
      display: "inline-block"
    },
    name: sheet.ownerName,
    url: sheet.ownerImageUrl,
    len: 26
  })), /*#__PURE__*/external_react_default().createElement("a", {
    href: sheet.ownerProfileUrl,
    target: openInNewTab ? "_blank" : "_self",
    className: "sheetAuthor",
    onClick: handleSheetOwnerClick
  }, sheet.ownerName)), viewsIcon);
  var collectionsList = "collections" in sheet ? sheet.collections.slice() : [];
  if (sheet.displayedCollectionName) {
    collectionsList.unshift({
      name: sheet.displayedCollectionName,
      slug: sheet.displayedCollection
    });
  }
  var collections = collectionsList.map(function (collection, i) {
    var separator = i == collectionsList.length - 1 ? null : /*#__PURE__*/external_react_default().createElement("span", {
      className: "separator"
    }, ",");
    return /*#__PURE__*/external_react_default().createElement("a", {
      href: "/collections/".concat(collection.slug),
      target: openInNewTab ? "_blank" : "_self",
      className: "sheetTag",
      key: i
    }, collection.name, separator);
  });
  var topics = sheet.topics.map(function (topic, i) {
    var separator = i == sheet.topics.length - 1 ? null : /*#__PURE__*/external_react_default().createElement("span", {
      className: "separator"
    }, ",");
    return /*#__PURE__*/external_react_default().createElement("a", {
      href: "/topics/".concat(topic.slug),
      target: openInNewTab ? "_blank" : "_self",
      className: "sheetTag",
      key: i,
      onClick: handleTopicClick.bind(null, topic.slug)
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: topic
    }), separator);
  });
  var created = sefaria.util.localeDate(sheet.created);
  var underInfo = infoUnderneath ? [sheet.status !== 'public' ? /*#__PURE__*/external_react_default().createElement("span", {
    className: "unlisted"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/eye-slash.svg"
  }), /*#__PURE__*/external_react_default().createElement("span", null, sefaria._("Not Published"))) : undefined, showAuthorUnderneath ? /*#__PURE__*/external_react_default().createElement("a", {
    href: sheet.ownerProfileUrl,
    target: openInNewTab ? "_blank" : "_self"
  }, sheet.ownerName) : undefined, views, created, collections.length ? collections : undefined, sheet.topics.length ? topics : undefined].filter(function (x) {
    return x !== undefined;
  }) : [topics];
  var pinButtonClasses = external_classnames_default()({
    sheetListingPinButton: 1,
    pinned: pinned,
    active: pinnable
  });
  var pinMessage = pinned && pinnable ? sefaria._("Pinned Sheet - click to unpin") : pinned ? sefaria._("Pinned Sheet") : sefaria._("Pin Sheet");
  var pinButton = /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/pin.svg",
    className: pinButtonClasses,
    title: pinMessage,
    onClick: pinnable ? pinSheet : null
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "sheet",
    key: sheet.sheetUrl
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sheetLeft"
  }, sheetInfo, /*#__PURE__*/external_react_default().createElement("a", {
    href: sheet.sheetUrl,
    target: openInNewTab ? "_blank" : "_self",
    className: "sheetTitle",
    onClick: handleSheetClickLocal
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/sheet.svg",
    className: "sheetIcon"
  }), /*#__PURE__*/external_react_default().createElement("span", {
    className: "sheetTitleText"
  }, title)), sheetSummary, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sheetTags sans-serif"
  }, underInfo.map(function (item, i) {
    return /*#__PURE__*/external_react_default().createElement("span", {
      key: i
    }, i !== 0 ? /*#__PURE__*/external_react_default().createElement("span", {
      className: "bullet"
    }, "\u2022") : null, item);
  }))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "sheetRight"
  }, editable && !sefaria._uses_new_editor ? /*#__PURE__*/external_react_default().createElement("a", {
    target: "_blank",
    href: "/sheets/".concat(sheet.id, "?editor=1")
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/tools-write-note.svg",
    title: sefaria._("Edit")
  })) : null, collectable ? /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/collection.svg",
    onClick: toggleCollectionsModal,
    title: sefaria._("Add to Collection")
  }) : null, deletable ? /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/circled-x.svg",
    onClick: handleSheetDeleteClick,
    title: sefaria._("Delete")
  }) : null, saveable ? /*#__PURE__*/external_react_default().createElement(SaveButton, {
    historyObject: {
      ref: "Sheet ".concat(sheet.id),
      versions: {}
    },
    toggleSignUpModal: toggleSignUpModal
  }) : null, pinnable || pinned ? pinButton : null), showCollectionsModal ? /*#__PURE__*/external_react_default().createElement(CollectionsModal, {
    sheetID: sheet.id,
    close: toggleCollectionsModal,
    handleCollectionsChange: handleCollectionsChange
  }) : null);
};
var CollectionListing = function CollectionListing(_ref26) {
  var data = _ref26.data;
  var imageUrl = "/static/icons/collection.svg";
  var collectionUrl = "/collections/" + data.slug;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionListing"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "left-content"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionListingText"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: collectionUrl,
    className: "collectionListingName"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    className: "collectionListingImage",
    src: imageUrl,
    alt: "Collection Icon"
  }), data.name), /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionListingDetails"
  }, data.listed ? null : /*#__PURE__*/external_react_default().createElement("span", {
    className: "unlisted"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/eye-slash.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Unlisted")), data.listed ? null : /*#__PURE__*/external_react_default().createElement("span", {
    className: "collectionListingDetailSeparator"
  }, "\u2022"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "collectionListingDetail collectionListingSheetCount"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "".concat(data.sheetCount, " ")), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sheets")), data.memberCount > 1 ? /*#__PURE__*/external_react_default().createElement("span", {
    className: "collectionListingDetailSeparator"
  }, "\u2022") : null, data.memberCount > 1 ? /*#__PURE__*/external_react_default().createElement("span", {
    className: "collectionListingDetail collectionListingMemberCount"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "".concat(data.memberCount, " ")), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Editors")) : null))));
};
var Note = /*#__PURE__*/function (_Component18) {
  Misc_inherits(Note, _Component18);
  var _super18 = Misc_createSuper(Note);
  function Note() {
    Misc_classCallCheck(this, Note);
    return _super18.apply(this, arguments);
  }
  Misc_createClass(Note, [{
    key: "render",
    value:
    // Public or private note in the Sidebar.
    function render() {
      var authorInfo = this.props.ownerName && !this.props.isMyNote ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "noteAuthorInfo"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: this.props.ownerProfileUrl
      }, /*#__PURE__*/external_react_default().createElement("img", {
        className: "noteAuthorImg",
        src: this.props.ownerImageUrl
      })), /*#__PURE__*/external_react_default().createElement("a", {
        href: this.props.ownerProfileUrl,
        className: "noteAuthor"
      }, this.props.ownerName)) : null;
      var buttons = this.props.isMyNote ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "noteButtons"
      }, /*#__PURE__*/external_react_default().createElement("i", {
        className: "editNoteButton fa fa-pencil",
        title: "Edit Note",
        onClick: this.props.editNote
      })) : null;
      var text = sefaria.util.linkify(this.props.text);
      text = text.replace(/\n/g, "<br />");
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "note"
      }, buttons, authorInfo, /*#__PURE__*/external_react_default().createElement("div", {
        className: "noteContent"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "noteText",
        dangerouslySetInnerHTML: {
          __html: text
        }
      })));
    }
  }]);
  return Note;
}((external_react_class_default()));
Note.propTypes = {
  text: (external_prop_types_default()).string.isRequired,
  ownerName: (external_prop_types_default()).string,
  ownerImageUrl: (external_prop_types_default()).string,
  ownerProfileUrl: (external_prop_types_default()).string,
  isPrivate: (external_prop_types_default()).bool,
  isMyNote: (external_prop_types_default()).bool,
  editNote: (external_prop_types_default()).func
};
function NewsletterSignUpForm(props) {
  var contextName = props.contextName,
    includeEducatorOption = props.includeEducatorOption;
  var _useState23 = (0,external_react_.useState)(''),
    _useState24 = Misc_slicedToArray(_useState23, 2),
    email = _useState24[0],
    setEmail = _useState24[1];
  var _useState25 = (0,external_react_.useState)(''),
    _useState26 = Misc_slicedToArray(_useState25, 2),
    firstName = _useState26[0],
    setFirstName = _useState26[1];
  var _useState27 = (0,external_react_.useState)(''),
    _useState28 = Misc_slicedToArray(_useState27, 2),
    lastName = _useState28[0],
    setLastName = _useState28[1];
  var _useState29 = (0,external_react_.useState)(false),
    _useState30 = Misc_slicedToArray(_useState29, 2),
    educatorCheck = _useState30[0],
    setEducatorCheck = _useState30[1];
  var _useState31 = (0,external_react_.useState)(null),
    _useState32 = Misc_slicedToArray(_useState31, 2),
    subscribeMessage = _useState32[0],
    setSubscribeMessage = _useState32[1];
  var _useState33 = (0,external_react_.useState)(false),
    _useState34 = Misc_slicedToArray(_useState33, 2),
    showNameInputs = _useState34[0],
    setShowNameInputs = _useState34[1];
  function handleSubscribeKeyUp(e) {
    if (e.keyCode === 13) {
      handleSubscribe();
    }
  }
  function handleSubscribe() {
    if (showNameInputs === true) {
      // submit
      if (firstName.length > 0 & lastName.length > 0) {
        setSubscribeMessage("Subscribing...");
        var request = new Request('/api/subscribe/' + email, {
          headers: {
            'X-CSRFToken': external_js_cookie_default().get('csrftoken')
          },
          'Content-Type': 'application/json'
        });
        fetch(request, {
          method: "POST",
          mode: 'same-origin',
          credentials: 'same-origin',
          body: JSON.stringify({
            language: sefaria.interfaceLang === "hebrew" ? "he" : "en",
            educator: educatorCheck,
            firstName: firstName,
            lastName: lastName
          })
        }).then(function (res) {
          if ("error" in res) {
            setSubscribeMessage(res.error);
            setShowNameInputs(false);
          } else {
            setSubscribeMessage("Subscribed! Welcome to our list.");
            sefaria.track.event("Newsletter", "Subscribe from " + contextName, "");
          }
        })["catch"](function (data) {
          setSubscribeMessage("Sorry, there was an error.");
          setShowNameInputs(false);
        });
      } else {
        setSubscribeMessage("Please enter a valid first and last name"); // get he copy
      }
    } else if (sefaria.util.isValidEmailAddress(email)) {
      setShowNameInputs(true);
    } else {
      setShowNameInputs(false);
      setSubscribeMessage("Please enter a valid email address.");
    }
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "newsletterSignUpBox"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, /*#__PURE__*/external_react_default().createElement("input", {
    className: "newsletterInput",
    placeholder: "Sign up for Newsletter",
    value: email,
    onChange: function onChange(e) {
      return setEmail(e.target.value);
    },
    onKeyUp: handleSubscribeKeyUp
  })), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, /*#__PURE__*/external_react_default().createElement("input", {
    className: "newsletterInput",
    placeholder: "\u05D4\u05E8\u05E9\u05DE\u05D5 \u05DC\u05E0\u05D9\u05D5\u05D6\u05DC\u05D8\u05E8",
    value: email,
    onChange: function onChange(e) {
      return setEmail(e.target.value);
    },
    onKeyUp: handleSubscribeKeyUp
  })), !showNameInputs ? /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/circled-arrow-right.svg",
    onClick: handleSubscribe
  }) : null, showNameInputs ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, /*#__PURE__*/external_react_default().createElement("input", {
    className: "newsletterInput firstNameInput",
    placeholder: "First Name",
    value: firstName,
    autoFocus: true,
    onChange: function onChange(e) {
      return setFirstName(e.target.value);
    },
    onKeyUp: handleSubscribeKeyUp
  })), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, /*#__PURE__*/external_react_default().createElement("input", {
    className: "newsletterInput firstNameInput",
    placeholder: "\u05E9\u05DD \u05E4\u05E8\u05D8\u05D9",
    value: firstName,
    onChange: function onChange(e) {
      return setFirstName(e.target.value);
    },
    onKeyUp: handleSubscribeKeyUp
  })), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, /*#__PURE__*/external_react_default().createElement("input", {
    className: "newsletterInput",
    placeholder: "Last Name",
    value: lastName,
    onChange: function onChange(e) {
      return setLastName(e.target.value);
    },
    onKeyUp: handleSubscribeKeyUp
  })), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, /*#__PURE__*/external_react_default().createElement("input", {
    className: "newsletterInput",
    placeholder: "\u05E9\u05DD \u05DE\u05E9\u05E4\u05D7\u05D4",
    value: lastName,
    onChange: function onChange(e) {
      return setLastName(e.target.value);
    },
    onKeyUp: handleSubscribeKeyUp
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "newsletterEducatorOption"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, /*#__PURE__*/external_react_default().createElement("input", {
    type: "checkbox",
    className: "educatorNewsletterInput",
    checked: educatorCheck,
    onChange: function onChange(e) {
      return setEducatorCheck(!!e.target.checked);
    }
  }), /*#__PURE__*/external_react_default().createElement("span", null, " I am an educator")), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, /*#__PURE__*/external_react_default().createElement("input", {
    type: "checkbox",
    className: "educatorNewsletterInput",
    checked: educatorCheck,
    onChange: function onChange(e) {
      return setEducatorCheck(!!e.target.checked);
    }
  }), /*#__PURE__*/external_react_default().createElement("span", null, " \u05DE\u05D5\u05E8\u05D9\u05DD/ \u05D0\u05E0\u05E9\u05D9 \u05D4\u05D5\u05E8\u05D0\u05D4")), /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/circled-arrow-right.svg",
    onClick: handleSubscribe
  }))) : null, subscribeMessage ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "subscribeMessage"
  }, sefaria._(subscribeMessage)) : null);
}
var LoginPrompt = /*#__PURE__*/function (_Component19) {
  Misc_inherits(LoginPrompt, _Component19);
  var _super19 = Misc_createSuper(LoginPrompt);
  function LoginPrompt() {
    Misc_classCallCheck(this, LoginPrompt);
    return _super19.apply(this, arguments);
  }
  Misc_createClass(LoginPrompt, [{
    key: "render",
    value: function render() {
      var nextParam = "?next=" + sefaria.util.currentPath();
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "loginPrompt"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "loginPromptMessage"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Please log in to use this feature."), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05E2\u05DC\u05D9\u05DA \u05DC\u05D4\u05D9\u05D5\u05EA \u05DE\u05D7\u05D5\u05D1\u05E8 \u05D1\u05DB\u05D3\u05D9 \u05DC\u05D4\u05E9\u05EA\u05DE\u05E9 \u05D1\u05D0\u05E4\u05E9\u05E8\u05D5\u05EA \u05D6\u05D5.")), /*#__PURE__*/external_react_default().createElement("a", {
        className: "button",
        href: "/login" + nextParam
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Log In"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D4\u05EA\u05D7\u05D1\u05E8\u05D5\u05EA")), /*#__PURE__*/external_react_default().createElement("a", {
        className: "button",
        href: "/register" + nextParam
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Sign Up"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D4\u05E8\u05E9\u05DE\u05D4")));
    }
  }]);
  return LoginPrompt;
}((external_react_class_default()));
LoginPrompt.propTypes = {
  fullPanel: (external_prop_types_default()).bool
};
var SignUpModal = /*#__PURE__*/function (_Component20) {
  Misc_inherits(SignUpModal, _Component20);
  var _super20 = Misc_createSuper(SignUpModal);
  function SignUpModal() {
    Misc_classCallCheck(this, SignUpModal);
    return _super20.apply(this, arguments);
  }
  Misc_createClass(SignUpModal, [{
    key: "render",
    value: function render() {
      var modalContent = !this.props.modalContentKind ? generateContentForModal() : generateContentForModal(this.props.modalContentKind);
      var innerContent = modalContent.contentList.map(function (bullet) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          key: bullet.icon
        }, /*#__PURE__*/external_react_default().createElement("img", {
          src: "/static/img/".concat(bullet.icon),
          alt: bullet.bulletContent.en
        }), /*#__PURE__*/external_react_default().createElement(InterfaceText, {
          text: bullet.bulletContent
        }));
      });
      var nextParam = "?next=" + encodeURIComponent(sefaria.util.currentPath());
      return this.props.show ? /*#__PURE__*/external_react_default().createElement("div", {
        id: "interruptingMessageBox",
        className: "sefariaModalBox"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        id: "interruptingMessageOverlay",
        onClick: this.props.onClose
      }), /*#__PURE__*/external_react_default().createElement("div", {
        id: "interruptingMessage",
        className: "sefariaModalContentBox"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        id: "interruptingMessageClose",
        className: "sefariaModalClose",
        onClick: this.props.onClose
      }, "\xD7"), /*#__PURE__*/external_react_default().createElement("div", {
        className: "sefariaModalContent"
      }, /*#__PURE__*/external_react_default().createElement("h2", {
        className: "serif sans-serif-in-hebrew"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: modalContent.h2
      })), /*#__PURE__*/external_react_default().createElement("h3", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: modalContent.h3
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "sefariaModalInnerContent"
      }, innerContent), /*#__PURE__*/external_react_default().createElement("a", {
        className: "button white control-elem",
        href: "/register" + nextParam
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sign Up")), /*#__PURE__*/external_react_default().createElement("div", {
        className: "sefariaModalBottomContent"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Already have an account?"), "\xA0", /*#__PURE__*/external_react_default().createElement("a", {
        href: "/login" + nextParam
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sign in")))))) : null;
    }
  }]);
  return SignUpModal;
}((external_react_class_default()));
SignUpModal.propTypes = {
  show: (external_prop_types_default()).bool,
  onClose: (external_prop_types_default()).func.isRequired,
  modalContent: (external_prop_types_default()).object.isRequired
};
var InterruptingMessage = /*#__PURE__*/function (_Component21) {
  Misc_inherits(InterruptingMessage, _Component21);
  var _super21 = Misc_createSuper(InterruptingMessage);
  function InterruptingMessage(props) {
    var _this11;
    Misc_classCallCheck(this, InterruptingMessage);
    _this11 = _super21.call(this, props);
    _this11.displayName = 'InterruptingMessage';
    _this11.state = {
      timesUp: false,
      animationStarted: false
    };
    _this11.settings = {
      "modal": {
        "trackingName": "Interrupting Message",
        "showDelay": 1000
      },
      "banner": {
        "trackingName": "Banner Message",
        "showDelay": 1
      }
    }[_this11.props.style];
    return _this11;
  }
  Misc_createClass(InterruptingMessage, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      if (this.shouldShow()) {
        this.delayedShow();
      }
    }
  }, {
    key: "shouldShow",
    value: function shouldShow() {
      var excludedPaths = ["/donate", "/mobile", "/app", "/ways-to-give"];
      return excludedPaths.indexOf(window.location.pathname) === -1;
    }
  }, {
    key: "delayedShow",
    value: function delayedShow() {
      setTimeout(function () {
        this.setState({
          timesUp: true
        });
        sefariaJquery("#interruptingMessage .button").click(this.close);
        sefariaJquery("#interruptingMessage .trackedAction").click(this.trackAction);
        this.showAorB();
        this.animateOpen();
      }.bind(this), this.settings.showDelay);
    }
  }, {
    key: "animateOpen",
    value: function animateOpen() {
      setTimeout(function () {
        if (this.props.style === "banner" && sefariaJquery("#s2").hasClass("headerOnly")) {
          sefariaJquery("body").addClass("hasBannerMessage");
        }
        this.setState({
          animationStarted: true
        });
        this.trackOpen();
      }.bind(this), 50);
    }
  }, {
    key: "showAorB",
    value: function showAorB() {
      // Allow random A/B testing if items are tagged ".optionA", ".optionB"
      var $message = sefariaJquery(external_react_dom_default().findDOMNode(this));
      if ($message.find(".optionA").length) {
        console.log("rand show");
        Math.random() > 0.5 ? sefariaJquery(".optionA").show() : sefariaJquery(".optionB").show();
      }
    }
  }, {
    key: "close",
    value: function close() {
      this.markAsRead();
      this.props.onClose();
      if (this.props.style === "banner" && sefariaJquery("#s2").hasClass("headerOnly")) {
        sefariaJquery("body").removeClass("hasBannerMessage");
      }
    }
  }, {
    key: "trackOpen",
    value: function trackOpen() {
      sefaria.track.event(this.settings.trackingName, "open", this.props.messageName, {
        nonInteraction: true
      });
    }
  }, {
    key: "trackAction",
    value: function trackAction() {
      sefaria.track.event(this.settings.trackingName, "action", this.props.messageName, {
        nonInteraction: true
      });
    }
  }, {
    key: "markAsRead",
    value: function markAsRead() {
      sefaria._api("/api/interrupting-messages/read/" + this.props.messageName, function (data) {});
      var cookieName = this.props.messageName + "_" + this.props.repetition;
      sefariaJquery.cookie(cookieName, true, {
        path: "/",
        expires: 14
      });
      sefaria.track.event(this.settings.trackingName, "read", this.props.messageName, {
        nonInteraction: true
      });
      sefaria.interruptingMessage = null;
    }
  }, {
    key: "render",
    value: function render() {
      if (!this.state.timesUp) {
        return null;
      }
      if (this.props.style === "banner") {
        return /*#__PURE__*/external_react_default().createElement("div", {
          id: "bannerMessage",
          className: this.state.animationStarted ? "" : "hidden"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          id: "bannerMessageContent",
          dangerouslySetInnerHTML: {
            __html: this.props.messageHTML
          }
        }), /*#__PURE__*/external_react_default().createElement("div", {
          id: "bannerMessageClose",
          onClick: this.close
        }, "\xD7"));
      } else if (this.props.style === "modal") {
        return /*#__PURE__*/external_react_default().createElement("div", {
          id: "interruptingMessageBox",
          className: this.state.animationStarted ? "" : "hidden"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          id: "interruptingMessageOverlay"
        }), /*#__PURE__*/external_react_default().createElement("div", {
          id: "interruptingMessage"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "colorLine"
        }), /*#__PURE__*/external_react_default().createElement("div", {
          id: "interruptingMessageContentBox",
          className: "hasColorLine"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          id: "interruptingMessageClose",
          onClick: this.close
        }, "\xD7"), /*#__PURE__*/external_react_default().createElement("div", {
          id: "interruptingMessageContent",
          dangerouslySetInnerHTML: {
            __html: this.props.messageHTML
          }
        }), /*#__PURE__*/external_react_default().createElement("div", {
          className: "colorLine"
        }))));
      }
      return null;
    }
  }]);
  return InterruptingMessage;
}((external_react_class_default()));
InterruptingMessage.propTypes = {
  messageName: (external_prop_types_default()).string.isRequired,
  messageHTML: (external_prop_types_default()).string.isRequired,
  style: (external_prop_types_default()).string.isRequired,
  repetition: (external_prop_types_default()).number.isRequired,
  // manual toggle to refresh an existing message
  onClose: (external_prop_types_default()).func.isRequired
};
var NBox = function NBox(_ref27) {
  var content = _ref27.content,
    n = _ref27.n,
    stretch = _ref27.stretch,
    _ref27$gap = _ref27.gap,
    gap = _ref27$gap === void 0 ? 0 : _ref27$gap;
  // Wrap a list of elements into an n-column flexbox
  // If `stretch`, extend the final row into any remaining empty columns
  var length = content.length;
  var rows = [];
  for (var i = 0; i < length; i += n) {
    rows.push(content.slice(i, i + n));
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "gridBox"
  }, rows.map(function (row, i) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "gridBoxRow",
      key: i,
      style: {
        "gap": gap,
        "marginTop": gap
      }
    }, row.pad(stretch ? row.length : n, "").map(function (item, j) {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: external_classnames_default()({
          gridBoxItem: 1,
          placeholder: !item
        }),
        key: "gridItem|".concat(j)
      }, item);
    }));
  }));
};
var TwoOrThreeBox = /*#__PURE__*/function (_Component22) {
  Misc_inherits(TwoOrThreeBox, _Component22);
  var _super22 = Misc_createSuper(TwoOrThreeBox);
  function TwoOrThreeBox() {
    Misc_classCallCheck(this, TwoOrThreeBox);
    return _super22.apply(this, arguments);
  }
  Misc_createClass(TwoOrThreeBox, [{
    key: "render",
    value:
    // Wrap a list of elements into a two or three column table, depending on window width
    function render() {
      var threshhold = this.props.threshhold;
      if (this.props.width > threshhold) {
        return /*#__PURE__*/external_react_default().createElement(NBox, {
          content: this.props.content,
          n: 3
        });
      } else {
        return /*#__PURE__*/external_react_default().createElement(NBox, {
          content: this.props.content,
          n: 2
        });
      }
    }
  }]);
  return TwoOrThreeBox;
}((external_react_class_default()));
TwoOrThreeBox.propTypes = {
  content: (external_prop_types_default()).array.isRequired,
  width: (external_prop_types_default()).number.isRequired,
  threshhold: (external_prop_types_default()).number
};
TwoOrThreeBox.defaultProps = {
  threshhold: 500
};
var ResponsiveNBox = function ResponsiveNBox(_ref28) {
  var content = _ref28.content,
    stretch = _ref28.stretch,
    initialWidth = _ref28.initialWidth,
    _ref28$threshold = _ref28.threshold2,
    threshold2 = _ref28$threshold === void 0 ? 500 : _ref28$threshold,
    _ref28$threshold2 = _ref28.threshold3,
    threshold3 = _ref28$threshold2 === void 0 ? 1500 : _ref28$threshold2,
    _ref28$gap = _ref28.gap,
    gap = _ref28$gap === void 0 ? 0 : _ref28$gap;
  //above threshold2, there will be 2 columns
  //above threshold3, there will be 3 columns
  initialWidth = initialWidth || (window ? window.innerWidth : 1000);
  var _useState35 = (0,external_react_.useState)(initialWidth),
    _useState36 = Misc_slicedToArray(_useState35, 2),
    width = _useState36[0],
    setWidth = _useState36[1];
  var ref = (0,external_react_.useRef)(null);
  (0,external_react_.useEffect)(function () {
    deriveAndSetWidth();
    window.addEventListener("resize", deriveAndSetWidth);
    return function () {
      window.removeEventListener("resize", deriveAndSetWidth);
    };
  }, []);
  var deriveAndSetWidth = function deriveAndSetWidth() {
    return setWidth(ref.current ? ref.current.offsetWidth : initialWidth);
  };
  var n = width > threshold3 ? 3 : width > threshold2 ? 2 : 1;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "responsiveNBox",
    ref: ref
  }, /*#__PURE__*/external_react_default().createElement(NBox, {
    content: content,
    n: n,
    stretch: stretch,
    gap: gap
  }));
};
var Dropdown = /*#__PURE__*/function (_Component23) {
  Misc_inherits(Dropdown, _Component23);
  var _super23 = Misc_createSuper(Dropdown);
  function Dropdown(props) {
    var _this12;
    Misc_classCallCheck(this, Dropdown);
    _this12 = _super23.call(this, props);
    _this12.state = {
      optionsOpen: false,
      selected: null
    };
    return _this12;
  }
  Misc_createClass(Dropdown, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this13 = this;
      if (this.props.preselected) {
        var selected = this.props.options.filter(function (o) {
          return o.value == _this13.props.preselected;
        });
        this.select(selected[0]);
      }
    }
  }, {
    key: "select",
    value: function select(option) {
      this.setState({
        selected: option,
        optionsOpen: false
      });
      var event = {
        target: {
          name: this.props.name,
          value: option.value
        }
      };
      this.props.onChange && this.props.onChange(event);
    }
  }, {
    key: "toggle",
    value: function toggle() {
      this.setState({
        optionsOpen: !this.state.optionsOpen
      });
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "dropdown sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "dropdownMain noselect".concat(this.state.selected ? " selected" : ""),
        onClick: this.toggle
      }, /*#__PURE__*/external_react_default().createElement("span", null, this.state.selected ? this.state.selected.label : this.props.placeholder), /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/chevron-down.svg",
        className: "dropdownOpenButton noselect fa fa-caret-down"
      })), this.state.optionsOpen ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "dropdownListBox noselect"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "dropdownList noselect"
      }, this.props.options.map(function (option) {
        var onClick = this.select.bind(null, option);
        var classes = external_classnames_default()({
          dropdownOption: 1,
          selected: this.state.selected && this.state.selected.value == option.value
        });
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: classes,
          onClick: onClick,
          key: option.value
        }, option.label);
      }.bind(this)))) : null);
    }
  }]);
  return Dropdown;
}((external_react_class_default()));
Dropdown.propTypes = {
  options: (external_prop_types_default()).array.isRequired,
  // Array of {label, value}
  name: (external_prop_types_default()).string.isRequired,
  onChange: (external_prop_types_default()).func,
  placeholder: (external_prop_types_default()).string,
  selected: (external_prop_types_default()).string
};
var LoadingMessage = /*#__PURE__*/function (_Component24) {
  Misc_inherits(LoadingMessage, _Component24);
  var _super24 = Misc_createSuper(LoadingMessage);
  function LoadingMessage() {
    Misc_classCallCheck(this, LoadingMessage);
    return _super24.apply(this, arguments);
  }
  Misc_createClass(LoadingMessage, [{
    key: "render",
    value: function render() {
      var message = this.props.message || "Loading...";
      var heMessage = this.props.heMessage || "טוען מידע...";
      var classes = "loadingMessage sans-serif " + (this.props.className || "");
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, message), /*#__PURE__*/external_react_default().createElement(HebrewText, null, heMessage)));
    }
  }]);
  return LoadingMessage;
}((external_react_class_default()));
LoadingMessage.propTypes = {
  message: (external_prop_types_default()).string,
  heMessage: (external_prop_types_default()).string,
  className: (external_prop_types_default()).string
};
var CategoryAttribution = function CategoryAttribution(_ref29) {
  var categories = _ref29.categories,
    _ref29$linked = _ref29.linked,
    linked = _ref29$linked === void 0 ? true : _ref29$linked,
    asEdition = _ref29.asEdition;
  var attribution = sefaria.categoryAttribution(categories);
  if (!attribution) {
    return null;
  }
  var en = asEdition ? attribution.englishAsEdition : attribution.english;
  var he = asEdition ? attribution.hebrewAsEdition : attribution.hebrew;
  var str = /*#__PURE__*/external_react_default().createElement(ContentText, {
    text: {
      en: en,
      he: he
    },
    defaultToInterfaceOnBilingual: true
  });
  var content = linked ? /*#__PURE__*/external_react_default().createElement("a", {
    href: attribution.link
  }, str) : str;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "categoryAttribution"
  }, content);
};
var SheetTopicLink = /*#__PURE__*/function (_Component25) {
  Misc_inherits(SheetTopicLink, _Component25);
  var _super25 = Misc_createSuper(SheetTopicLink);
  function SheetTopicLink() {
    Misc_classCallCheck(this, SheetTopicLink);
    return _super25.apply(this, arguments);
  }
  Misc_createClass(SheetTopicLink, [{
    key: "handleTagClick",
    value: function handleTagClick(e) {
      e.preventDefault();
      this.props.setSheetTag(this.props.topic.slug);
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props$topic = this.props.topic,
        slug = _this$props$topic.slug,
        en = _this$props$topic.en,
        he = _this$props$topic.he;
      return /*#__PURE__*/external_react_default().createElement("a", {
        href: "/topics/".concat(slug),
        onClick: this.handleTagClick
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: {
          en: en,
          he: he
        }
      }));
    }
  }]);
  return SheetTopicLink;
}((external_react_class_default()));
SheetTopicLink.propTypes = {
  topic: external_prop_types_default().shape({
    en: (external_prop_types_default()).string.isRequired,
    he: (external_prop_types_default()).string.isRequired,
    slug: (external_prop_types_default()).string.isRequired
  }).isRequired,
  setSheetTag: (external_prop_types_default()).func.isRequired
};
var SheetAccessIcon = /*#__PURE__*/function (_Component26) {
  Misc_inherits(SheetAccessIcon, _Component26);
  var _super26 = Misc_createSuper(SheetAccessIcon);
  function SheetAccessIcon() {
    Misc_classCallCheck(this, SheetAccessIcon);
    return _super26.apply(this, arguments);
  }
  Misc_createClass(SheetAccessIcon, [{
    key: "render",
    value: function render() {
      var sheet = this.props.sheet;
      return sheet.status == "unlisted" ? /*#__PURE__*/external_react_default().createElement("i", {
        className: "fa fa-lock",
        title: msg
      }) : null;
    }
  }]);
  return SheetAccessIcon;
}((external_react_class_default()));
SheetAccessIcon.propTypes = {
  sheet: (external_prop_types_default()).object.isRequired
};
var FeedbackBox = /*#__PURE__*/function (_Component27) {
  Misc_inherits(FeedbackBox, _Component27);
  var _super27 = Misc_createSuper(FeedbackBox);
  function FeedbackBox(props) {
    var _this14;
    Misc_classCallCheck(this, FeedbackBox);
    _this14 = _super27.call(this, props);
    _this14.state = {
      type: null,
      alertmsg: null,
      feedbackSent: false
    };
    return _this14;
  }
  Misc_createClass(FeedbackBox, [{
    key: "sendFeedback",
    value: function sendFeedback() {
      if (!this.state.type) {
        this.setState({
          alertmsg: sefaria._("Please select a feedback type")
        });
        return;
      }
      if (!sefaria._uid && !this.validateEmail(sefariaJquery("#feedbackEmail").val())) {
        this.setState({
          alertmsg: sefaria._("Please enter a valid email address")
        });
        return;
      }
      var feedback = {
        refs: this.props.srefs || null,
        type: this.state.type,
        url: this.props.url || null,
        currVersions: this.props.currVersions,
        email: sefariaJquery("#feedbackEmail").val() || null,
        msg: sefariaJquery("#feedbackText").val(),
        uid: sefaria._uid || null
      };
      var postData = {
        json: JSON.stringify(feedback)
      };
      var url = "/api/send_feedback";
      this.setState({
        feedbackSent: true
      });
      sefariaJquery.post(url, postData, function (data) {
        if (data.error) {
          alert(data.error);
        } else {
          console.log(data);
          sefaria.track.event("Tools", "Send Feedback", this.props.url);
        }
      }.bind(this)).fail(function (xhr, textStatus, errorThrown) {
        alert(sefaria._("Unfortunately, there was an error sending this feedback. Please try again or try reloading this page."));
        this.setState({
          feedbackSent: true
        });
      });
    }
  }, {
    key: "validateEmail",
    value: function validateEmail(email) {
      var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      return re.test(email);
    }
  }, {
    key: "setType",
    value: function setType(event) {
      this.setState({
        type: event.target.value
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this15 = this;
      if (this.state.feedbackSent) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "feedbackBox sans-serif"
        }, /*#__PURE__*/external_react_default().createElement("p", {
          className: "int-en"
        }, "Feedback sent!"), /*#__PURE__*/external_react_default().createElement("p", {
          className: "int-he"
        }, "\u05DE\u05E9\u05D5\u05D1 \u05E0\u05E9\u05DC\u05D7!"));
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "feedbackBox sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("p", {
        className: "int-en"
      }, "Have some feedback? We would love to hear it."), /*#__PURE__*/external_react_default().createElement("p", {
        className: "int-he"
      }, "\u05D0\u05E0\u05D7\u05E0\u05D5 \u05DE\u05E2\u05D5\u05E0\u05D9\u05D9\u05E0\u05D9\u05DD \u05D1\u05DE\u05E9\u05D5\u05D1 \u05DE\u05DE\u05DA"), this.state.alertmsg ? /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("p", {
        className: "int-en"
      }, this.state.alertmsg), /*#__PURE__*/external_react_default().createElement("p", {
        className: "int-he"
      }, this.state.alertmsg)) : null, /*#__PURE__*/external_react_default().createElement(Dropdown, {
        name: "feedbackType",
        options: [{
          value: "content_issue",
          label: sefaria._("Report an issue with the text")
        }, {
          value: "translation_request",
          label: sefaria._("Request translation")
        }, {
          value: "bug_report",
          label: sefaria._("Report a bug")
        }, {
          value: "help_request",
          label: sefaria._("Get help")
        }, {
          value: "feature_request",
          label: sefaria._("Request a feature")
        }, {
          value: "good_vibes",
          label: sefaria._("Give thanks")
        }, {
          value: "other",
          label: sefaria._("Other")
        }],
        placeholder: sefaria._("Select Type"),
        onChange: this.setType
      }), /*#__PURE__*/external_react_default().createElement("textarea", {
        className: "feedbackText",
        placeholder: sefaria._("Describe the issue..."),
        id: "feedbackText"
      }), !sefaria._uid ? /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("input", {
        className: "sidebarInput noselect",
        placeholder: sefaria._("Email Address"),
        id: "feedbackEmail"
      })) : null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "button",
        role: "button",
        onClick: function onClick() {
          return _this15.sendFeedback();
        }
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Submit"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05E9\u05DC\u05D9\u05D7\u05D4")));
    }
  }]);
  return FeedbackBox;
}((external_react_class_default()));
var ReaderMessage = /*#__PURE__*/function (_Component28) {
  Misc_inherits(ReaderMessage, _Component28);
  var _super28 = Misc_createSuper(ReaderMessage);
  // Component for determining user feedback on new element
  function ReaderMessage(props) {
    var _this16;
    Misc_classCallCheck(this, ReaderMessage);
    _this16 = _super28.call(this, props);
    var showNotification = sefaria._inBrowser && !document.cookie.includes(_this16.props.messageName + "Accepted");
    _this16.state = {
      showNotification: showNotification
    };
    return _this16;
  }
  Misc_createClass(ReaderMessage, [{
    key: "setFeedback",
    value: function setFeedback(status) {
      sefaria.track.uiFeedback(this.props.messageName + "Accepted", status);
      sefariaJquery.cookie(this.props.messageName + "Accepted", 1, {
        path: "/"
      });
      this.setState({
        showNotification: false
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this17 = this;
      if (!this.state.showNotification) {
        return null;
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerMessageBox"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerMessage"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "int-en"
      }, this.props.message), /*#__PURE__*/external_react_default().createElement("div", {
        className: "button small",
        role: "button",
        onClick: function onClick() {
          return _this17.setFeedback('Like');
        }
      }, this.props.buttonLikeText), /*#__PURE__*/external_react_default().createElement("div", {
        className: "button small",
        role: "button",
        onClick: function onClick() {
          return _this17.setFeedback('Dislike');
        }
      }, this.props.buttonDislikeText)));
    }
  }]);
  return ReaderMessage;
}((external_react_class_default()));
ReaderMessage.propTypes = {
  messageName: (external_prop_types_default()).string.isRequired,
  message: (external_prop_types_default()).string.isRequired,
  buttonLikeText: (external_prop_types_default()).string.isRequired,
  buttonDislikeText: (external_prop_types_default()).string.isRequired
};
var CookiesNotification = /*#__PURE__*/function (_Component29) {
  Misc_inherits(CookiesNotification, _Component29);
  var _super29 = Misc_createSuper(CookiesNotification);
  function CookiesNotification(props) {
    var _this18;
    Misc_classCallCheck(this, CookiesNotification);
    _this18 = _super29.call(this, props);
    var showNotification = /*!Sefaria._debug && */sefaria._inBrowser && !document.cookie.includes("cookiesNotificationAccepted");
    _this18.state = {
      showNotification: showNotification
    };
    return _this18;
  }
  Misc_createClass(CookiesNotification, [{
    key: "setCookie",
    value: function setCookie() {
      sefariaJquery.cookie("cookiesNotificationAccepted", 1, {
        path: "/",
        expires: 20 * 365
      });
      this.setState({
        showNotification: false
      });
    }
  }, {
    key: "render",
    value: function render() {
      if (!this.state.showNotification) {
        return null;
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "cookiesNotification"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, /*#__PURE__*/external_react_default().createElement("span", null, "We use cookies to give you the best experience possible on our site. Click OK to continue using Sefaria. ", /*#__PURE__*/external_react_default().createElement("a", {
        href: "/privacy-policy"
      }, "Learn More"), "."), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en button small white",
        onClick: this.setCookie
      }, "OK")), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, /*#__PURE__*/external_react_default().createElement("span", null, "\u05D0\u05E0\u05D7\u05E0\u05D5 \u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05D1\"\u05E2\u05D5\u05D2\u05D9\u05D5\u05EA\" \u05DB\u05D3\u05D9 \u05DC\u05EA\u05EA \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05D0\u05EA \u05D7\u05D5\u05D5\u05D9\u05D9\u05EA \u05D4\u05E9\u05D9\u05DE\u05D5\u05E9 \u05D4\u05D8\u05D5\u05D1\u05D4 \u05D1\u05D9\u05D5\u05EA\u05E8.", /*#__PURE__*/external_react_default().createElement("a", {
        href: "/privacy-policy"
      }, "\u05E7\u05E8\u05D0\u05D5 \u05E2\u05D5\u05D3 \u05D1\u05E0\u05D5\u05E9\u05D0")), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he button small white",
        onClick: this.setCookie
      }, "\u05DC\u05D7\u05E6\u05D5 \u05DB\u05D0\u05DF \u05DC\u05D0\u05D9\u05E9\u05D5\u05E8")));
    }
  }]);
  return CookiesNotification;
}((external_react_class_default()));
var CommunityPagePreviewControls = function CommunityPagePreviewControls(_ref30) {
  var date = _ref30.date;
  var dateStr = function dateStr(date, offset) {
    var d = new Date(date);
    d.setDate(d.getDate() + offset);
    return d.getMonth() + 1 + "/" + d.getDate() + "/" + d.getFullYear().toString().slice(2);
  };
  var tomorrow = dateStr(date, 1);
  var yesterday = dateStr(date, -1);
  return /*#__PURE__*/external_react_default().createElement("div", {
    id: "communityPagePreviewControls"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "You are previewing the Community page for "), /*#__PURE__*/external_react_default().createElement("a", {
    className: "date",
    href: "/admin/community-preview?date=" + date
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, date)), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/admin/community-preview?date=" + yesterday
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "« " + yesterday)), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/admin/community-preview?date=" + tomorrow
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, tomorrow + " »"))), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/admin/reset/community?next=" + date
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Refresh Cache"))));
};
var SheetTitle = function SheetTitle(props) {
  return /*#__PURE__*/external_react_default().createElement("span", {
    className: "title",
    role: "heading",
    "aria-level": "1",
    contentEditable: props.editable,
    suppressContentEditableWarning: true,
    onBlur: props.editable ? props.blurCallback : null,
    style: {
      "direction": sefaria.hebrew.isHebrew(props.title.stripHtml()) ? "rtl" : "ltr"
    }
  }, props.title ? props.title.stripHtmlConvertLineBreaks() : "");
};
SheetTitle.propTypes = {
  title: (external_prop_types_default()).string
};
var SheetAuthorStatement = function SheetAuthorStatement(props) {
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "authorStatement sans-serif",
    contentEditable: false,
    style: {
      userSelect: 'none'
    }
  }, props.children);
};
SheetAuthorStatement.propTypes = {
  authorImage: (external_prop_types_default()).string,
  authorStatement: (external_prop_types_default()).string,
  authorUrl: (external_prop_types_default()).string
};
var CollectionStatement = function CollectionStatement(_ref31) {
  var name = _ref31.name,
    slug = _ref31.slug,
    image = _ref31.image,
    children = _ref31.children;
  return slug ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionStatement sans-serif",
    contentEditable: false,
    style: {
      userSelect: 'none'
    }
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionListingImageBox imageBox"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/collections/" + slug
  }, /*#__PURE__*/external_react_default().createElement("img", {
    className: external_classnames_default()({
      collectionListingImage: 1,
      "img-circle": 1,
      "default": !image
    }),
    src: image || "/static/icons/collection.svg",
    alt: "Collection Logo"
  }))), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/collections/" + slug
  }, children ? children : name)) : /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionStatement sans-serif",
    contentEditable: false,
    style: {
      userSelect: 'none',
      display: 'none'
    }
  }, children);
};
var AdminToolHeader = function AdminToolHeader(_ref32) {
  var title = _ref32.title,
    validate = _ref32.validate,
    close = _ref32.close;
  /*
  Save and Cancel buttons with a header using the `title` text.  Save button calls 'validate' and cancel button calls 'close'.
   */
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "headerWithButtons"
  }, /*#__PURE__*/external_react_default().createElement("h1", {
    className: "pageTitle"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, title)), /*#__PURE__*/external_react_default().createElement("div", {
    className: "end"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    onClick: close,
    id: "cancel",
    className: "button small transparent control-elem"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Cancel")), /*#__PURE__*/external_react_default().createElement("div", {
    onClick: validate,
    id: "saveAccountSettings",
    className: "button small blue control-elem",
    tabIndex: "0",
    role: "button"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Save"))));
};
var CategoryChooser = function CategoryChooser(_ref33) {
  var categories = _ref33.categories,
    update = _ref33.update;
  /*
  Allows user to start from the top of the TOC and select a precise path through the category TOC using option menus.
  'categories' is initial list of categories specifying a path and 'update' is called with new categories after the user changes selection
   */
  var categoryMenu = (0,external_react_.useRef)();
  var handleChange = function handleChange(e) {
    var newCategories = [];
    for (var i = 0; i < categoryMenu.current.children.length; i++) {
      var el = categoryMenu.current.children[i].children[0];
      var elValue = el.options[el.selectedIndex].value;
      var possCategories = newCategories.concat([elValue]);
      if (!sefaria.tocObjectByCategories(possCategories)) {
        // if possCategories are ["Talmud", "Prophets"], break out and leave newCategories as ["Talmud"]
        break;
      }
      newCategories.push(elValue);
    }
    update(newCategories); //tell parent of new values
  };

  var menus = [];

  //create a menu of first level categories
  var options = sefaria.toc.map(function (child, key) {
    if (categories.length > 0 && categories[0] === child.category) {
      return /*#__PURE__*/external_react_default().createElement("option", {
        key: key + 1,
        value: categories[0],
        selected: true
      }, categories[0]);
    } else {
      return /*#__PURE__*/external_react_default().createElement("option", {
        key: key + 1,
        value: child.category
      }, child.category);
    }
  });
  menus.push(options);

  //now add to menu second and/or third level categories found in categories
  for (var i = 0; i < categories.length; i++) {
    var _options = [];
    var tocObject = sefaria.tocObjectByCategories(categories.slice(0, i + 1));
    var subcats = !(tocObject !== null && tocObject !== void 0 && tocObject.contents) ? [] : tocObject.contents.filter(function (x) {
      return x.hasOwnProperty("category");
    }); //Indices have 'categories' field and Categories have 'category' field which is their lastPath
    for (var j = 0; j < subcats.length; j++) {
      var selected = categories.length >= i && categories[i + 1] === subcats[j].category;
      _options.push( /*#__PURE__*/external_react_default().createElement("option", {
        key: j,
        value: subcats[j].category,
        selected: selected
      }, subcats[j].category));
    }
    if (_options.length > 0) {
      menus.push(_options);
    }
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    ref: categoryMenu
  }, menus.map(function (menu, index) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      id: "categoryChooserMenu"
    }, /*#__PURE__*/external_react_default().createElement("select", {
      key: "subcats-".concat(index),
      id: "subcats-".concat(index),
      onChange: handleChange
    }, /*#__PURE__*/external_react_default().createElement("option", {
      key: "chooseCategory",
      value: "Choose a category"
    }, "Table of Contents"), menu));
  }));
};
var TitleVariants = function TitleVariants(_ref34) {
  var titles = _ref34.titles,
    update = _ref34.update,
    options = _ref34.options;
  /*
  Wrapper for ReactTags component.  `titles` is initial list of strings to populate ReactTags component
  and `update` is method to call after deleting or adding to titles. `options` is an object that can have
  the fields `onTitleDelete`, `onTitleAddition`, and `onTitleValidate` allowing overloading of TitleVariant's methods
   */
  var onTitleDelete = function onTitleDelete(i) {
    var newTitles = titles.filter(function (t) {
      return t !== titles[i];
    });
    update(newTitles);
  };
  var onTitleAddition = function onTitleAddition(title) {
    var newTitles = [].concat(titles, title);
    update(newTitles);
  };
  var onTitleValidate = function onTitleValidate(title) {
    var validTitle = titles.every(function (item) {
      return item.name !== title.name;
    });
    if (!validTitle) {
      alert(title.name + " already exists.");
    }
    return validTitle;
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "publishBox"
  }, /*#__PURE__*/external_react_default().createElement((external_react_tag_autocomplete_default()), {
    allowNew: true,
    tags: titles,
    onDelete: options !== null && options !== void 0 && options.onTitleDelete ? options.onTitleDelete : onTitleDelete,
    placeholderText: sefaria._("Add a title..."),
    delimiters: ["Enter", "Tab"],
    onAddition: options !== null && options !== void 0 && options.onTitleAddition ? options.onTitleAddition : onTitleAddition,
    onValidate: options !== null && options !== void 0 && options.onTitleValidate ? options.onTitleValidate : onTitleValidate
  }));
};
var SheetMetaDataBox = function SheetMetaDataBox(props) {
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "sheetMetaDataBox"
  }, props.children);
};
var DivineNameReplacer = function DivineNameReplacer(_ref35) {
  var setDivineNameReplacement = _ref35.setDivineNameReplacement,
    divineNameReplacement = _ref35.divineNameReplacement;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "divineNameReplacer"
  }, /*#__PURE__*/external_react_default().createElement("p", {
    className: "sans-serif"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Select how you would like to display the divine name in this sheet:")), /*#__PURE__*/external_react_default().createElement(Dropdown, {
    name: "divinename",
    options: [{
      value: "noSub",
      label: sefaria._("No Substitution")
    }, {
      value: "yy",
      label: 'יי'
    }, {
      value: "h",
      label: 'ה׳'
    }, {
      value: "ykvk",
      label: 'יקוק'
    }],
    placeholder: sefaria._("Select Type"),
    onChange: function onChange(e) {
      return setDivineNameReplacement(e.target.value);
    },
    preselected: divineNameReplacement
  }));
};
var Autocompleter = function Autocompleter(_ref36) {
  var getSuggestions = _ref36.getSuggestions,
    showSuggestionsOnSelect = _ref36.showSuggestionsOnSelect,
    inputPlaceholder = _ref36.inputPlaceholder,
    inputValue = _ref36.inputValue,
    changeInputValue = _ref36.changeInputValue,
    selectedCallback = _ref36.selectedCallback,
    buttonTitle = _ref36.buttonTitle,
    autocompleteClassNames = _ref36.autocompleteClassNames;
  /*
  Autocompleter component used in AddInterfaceInput and TopicSearch components.  Component contains an input box, a
  select menu that shows autcomplete suggestions, and a button.  To submit an autocomplete suggestion, user can press enter in the input box, or click on the button.
  `getSuggestions` is a callback function that is called whenever the user types in the input box, which causes the select menu to be populated.
  It returns an object with the necessary props of "currentSuggestions" and "showAddButton" and optional props "previewText" and "helperPromptText" (latter are used in Editor.jsx)
  `showSuggestionsOnSelect` is a boolean; if true, when the user selects an option from the suggestions,`getSuggestions` will be called. Useful when autocompleting a Ref in AddInterfaceInput.
  `inputPlaceholder` is the placeholder for the input component.
  `inputValue` and `changeInputValue` are passed from the parent so that when there is a change in the input box, the parent knows about it.  Useful in TopicSearch for the case "Create new topic: [new topic]"
  `selectedCallback` is a callback function called when the user submits an autocomplete suggestion.
  `autocompleteClassNames` are styling options
   */
  var _useState37 = (0,external_react_.useState)(null),
    _useState38 = Misc_slicedToArray(_useState37, 2),
    currentSuggestions = _useState38[0],
    setCurrentSuggestions = _useState38[1];
  var _useState39 = (0,external_react_.useState)(null),
    _useState40 = Misc_slicedToArray(_useState39, 2),
    previewText = _useState40[0],
    setPreviewText = _useState40[1];
  var _useState41 = (0,external_react_.useState)(null),
    _useState42 = Misc_slicedToArray(_useState41, 2),
    helperPromptText = _useState42[0],
    setHelperPromptText = _useState42[1];
  var _useState43 = (0,external_react_.useState)(false),
    _useState44 = Misc_slicedToArray(_useState43, 2),
    showAddButton = _useState44[0],
    setShowAddButton = _useState44[1];
  var _useState45 = (0,external_react_.useState)(true),
    _useState46 = Misc_slicedToArray(_useState45, 2),
    showCurrentSuggestions = _useState46[0],
    setShowCurrentSuggestions = _useState46[1];
  var _useState47 = (0,external_react_.useState)(external_classnames_default()({
      selected: 0
    })),
    _useState48 = Misc_slicedToArray(_useState47, 2),
    inputClassNames = _useState48[0],
    setInputClassNames = _useState48[1];
  var suggestionEl = (0,external_react_.useRef)(null);
  var inputEl = (0,external_react_.useRef)(null);
  var buttonClassNames = external_classnames_default()({
    button: 1,
    small: 1
  });
  var getWidthOfInput = function getWidthOfInput() {
    //Create a temporary div w/ all of the same styles as the input since we can't measure the input
    var tmp = document.createElement("div");
    var inputEl = document.querySelector('.addInterfaceInput input');
    var styles = window.getComputedStyle(inputEl);
    //Reduce function required b/c cssText returns "" on Firefox
    var cssText = Object.values(styles).reduce(function (css, propertyName) {
      return "".concat(css).concat(propertyName, ":").concat(styles.getPropertyValue(propertyName), ";");
    });
    tmp.style.cssText = cssText;

    //otherwise it will always return the width of container instead of the content
    tmp.style.removeProperty('width');
    tmp.style.removeProperty('min-width');
    tmp.style.removeProperty('min-inline-size');
    tmp.style.removeProperty('inline-size');
    tmp.innerHTML = inputEl.value.trim().replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    document.body.appendChild(tmp);
    var theWidth = tmp.getBoundingClientRect().width;
    document.body.removeChild(tmp);
    return theWidth;
  };
  (0,external_react_.useEffect)(function () {
    var element = document.querySelector('.textPreviewSegment.highlight');
    if (element) {
      element.scrollIntoView({
        behavior: 'smooth',
        block: 'nearest',
        inline: 'start'
      });
    }
  }, [previewText]);
  var resizeInputIfNeeded = function resizeInputIfNeeded() {
    var currentWidth = getWidthOfInput();
    if (currentWidth > 350) {
      document.querySelector('.addInterfaceInput input').style.width = "".concat(currentWidth + 20, "px");
    }
  };
  var processSuggestions = function processSuggestions(resultsPromise) {
    resultsPromise.then(function (results) {
      setCurrentSuggestions(results.currentSuggestions);
      setShowAddButton(results.showAddButton);
      setHelperPromptText(results.helperPromptText);
      if (!!results.previewText) {
        generatePreviewText(results.previewText);
      }
      if (!!results.helperPromptText) {
        document.querySelector('.addInterfaceInput input+span.helperCompletionText').style.insetInlineStart = "".concat(getWidthOfInput(), "px");
      }
    });
  };
  var _onChange = function onChange(input) {
    setInputClassNames(external_classnames_default()({
      selected: 0
    }));
    setShowCurrentSuggestions(true);
    processSuggestions(getSuggestions(input));
    resizeInputIfNeeded();
  };
  var handleOnClickSuggestion = function handleOnClickSuggestion(title) {
    changeInputValue(title);
    setShowCurrentSuggestions(showSuggestionsOnSelect);
    if (showSuggestionsOnSelect) {
      processSuggestions(getSuggestions(title));
    }
    setInputClassNames(external_classnames_default()({
      selected: 1
    }));
    resizeInputIfNeeded();
    inputEl.current.focus();
  };
  var Suggestion = function Suggestion(_ref37) {
    var title = _ref37.title,
      color = _ref37.color;
    return /*#__PURE__*/external_react_default().createElement("option", {
      className: "suggestion",
      onClick: function onClick(e) {
        e.stopPropagation();
        handleOnClickSuggestion(title);
      },
      style: {
        "borderInlineStartColor": color
      }
    }, title);
  };
  var mapSuggestions = function mapSuggestions(suggestions) {
    var div = suggestions.map(function (suggestion, index) {
      return /*#__PURE__*/external_react_default().createElement(Suggestion, {
        title: suggestion.name,
        color: suggestion.border_color,
        key: index
      });
    });
    return div;
  };
  var handleSelection = function handleSelection() {
    selectedCallback(inputValue, currentSuggestions);
    setPreviewText(null);
    setShowAddButton(false);
  };
  var _onKeyDown = function onKeyDown(e) {
    if (e.key === 'Enter' && showAddButton) {
      handleSelection(inputValue, currentSuggestions);
    } else if (e.key === 'ArrowDown' && currentSuggestions && currentSuggestions.length > 0) {
      suggestionEl.current.focus();
      suggestionEl.current.firstChild.selected = 'selected';
    } else {
      changeInputValue(inputEl.current.value);
    }
  };
  var generatePreviewText = function generatePreviewText(ref) {
    sefaria.getText(ref, {
      context: 1,
      stripItags: 1
    }).then(function (text) {
      var segments = sefaria.makeSegments(text, true);
      segments = sefaria.stripImagesFromSegments(segments);
      var previewHTML = segments.map(function (segment, i) {
        {
          var heOnly = !segment.en;
          var enOnly = !segment.he;
          var overrideLanguage = enOnly || heOnly ? heOnly ? "hebrew" : "english" : null;
          return /*#__PURE__*/external_react_default().createElement("div", {
            className: external_classnames_default()({
              'textPreviewSegment': 1,
              highlight: segment.highlight,
              heOnly: heOnly,
              enOnly: enOnly
            }),
            key: segment.ref
          }, /*#__PURE__*/external_react_default().createElement("sup", null, /*#__PURE__*/external_react_default().createElement(ContentText, {
            text: {
              "en": segment.number,
              "he": sefaria.hebrew.encodeHebrewNumeral(segment.number)
            },
            defaultToInterfaceOnBilingual: true
          })), " ", /*#__PURE__*/external_react_default().createElement(ContentText, {
            html: {
              "he": segment.he + " ",
              "en": segment.en + " "
            },
            defaultToInterfaceOnBilingual: !overrideLanguage,
            overrideLanguage: overrideLanguage,
            bilingualOrder: ["en", "he"]
          }));
        }
      });
      setPreviewText(previewHTML);
    });
  };
  var checkEnterOnSelect = function checkEnterOnSelect(e) {
    if (e.key === 'Enter') {
      handleOnClickSuggestion(e.target.value);
    }
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: autocompleteClassNames,
    onClick: function onClick(e) {
      e.stopPropagation();
    },
    title: sefaria._(buttonTitle)
  }, /*#__PURE__*/external_react_default().createElement("input", {
    type: "text",
    placeholder: sefaria._(inputPlaceholder),
    onKeyDown: function onKeyDown(e) {
      return _onKeyDown(e);
    },
    onClick: function onClick(e) {
      e.stopPropagation();
    },
    onChange: function onChange(e) {
      return _onChange(e.target.value);
    },
    onBlur: function onBlur(e) {
      return setPreviewText(null);
    },
    value: inputValue,
    ref: inputEl,
    className: inputClassNames
  }), /*#__PURE__*/external_react_default().createElement("span", {
    className: "helperCompletionText sans-serif-in-hebrew"
  }, helperPromptText), showAddButton ? /*#__PURE__*/external_react_default().createElement("button", {
    className: buttonClassNames,
    onClick: function onClick(e) {
      handleSelection(inputValue, currentSuggestions);
    }
  }, buttonTitle) : null, showCurrentSuggestions && currentSuggestions && currentSuggestions.length > 0 ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "suggestionBoxContainer"
  }, /*#__PURE__*/external_react_default().createElement("select", {
    ref: suggestionEl,
    className: "suggestionBox",
    size: currentSuggestions.length,
    multiple: true,
    onKeyDown: function onKeyDown(e) {
      return checkEnterOnSelect(e);
    }
  }, mapSuggestions(currentSuggestions))) : null, previewText ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "textPreviewContainer"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "textPreview"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "inner"
  }, previewText))) : null);
};

;// CONCATENATED MODULE: ../static/js/Header.jsx
function Header_typeof(obj) { "@babel/helpers - typeof"; return Header_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, Header_typeof(obj); }
function Header_slicedToArray(arr, i) { return Header_arrayWithHoles(arr) || Header_iterableToArrayLimit(arr, i) || Header_unsupportedIterableToArray(arr, i) || Header_nonIterableRest(); }
function Header_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function Header_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return Header_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return Header_arrayLikeToArray(o, minLen); }
function Header_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function Header_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function Header_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function Header_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function Header_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? Header_ownKeys(Object(source), !0).forEach(function (key) { Header_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : Header_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function Header_defineProperty(obj, key, value) { key = Header_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function Header_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function Header_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, Header_toPropertyKey(descriptor.key), descriptor); } }
function Header_createClass(Constructor, protoProps, staticProps) { if (protoProps) Header_defineProperties(Constructor.prototype, protoProps); if (staticProps) Header_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function Header_toPropertyKey(arg) { var key = Header_toPrimitive(arg, "string"); return Header_typeof(key) === "symbol" ? key : String(key); }
function Header_toPrimitive(input, hint) { if (Header_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (Header_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function Header_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) Header_setPrototypeOf(subClass, superClass); }
function Header_setPrototypeOf(o, p) { Header_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return Header_setPrototypeOf(o, p); }
function Header_createSuper(Derived) { var hasNativeReflectConstruct = Header_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = Header_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = Header_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return Header_possibleConstructorReturn(this, result); }; }
function Header_possibleConstructorReturn(self, call) { if (call && (Header_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return Header_assertThisInitialized(self); }
function Header_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function Header_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function Header_getPrototypeOf(o) { Header_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return Header_getPrototypeOf(o); }








var Header = /*#__PURE__*/function (_Component) {
  Header_inherits(Header, _Component);
  var _super = Header_createSuper(Header);
  function Header(props) {
    var _this;
    Header_classCallCheck(this, Header);
    _this = _super.call(this, props);
    _this.state = {
      mobileNavMenuOpen: false
    };
    return _this;
  }
  Header_createClass(Header, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      window.addEventListener('keydown', this.handleFirstTab);
    }
  }, {
    key: "handleFirstTab",
    value: function handleFirstTab(e) {
      if (e.keyCode === 9) {
        // tab (i.e. I'm using a keyboard)
        document.body.classList.add('user-is-tabbing');
        window.removeEventListener('keydown', this.handleFirstTab);
      }
    }
  }, {
    key: "toggleMobileNavMenu",
    value: function toggleMobileNavMenu() {
      this.setState({
        mobileNavMenuOpen: !this.state.mobileNavMenuOpen
      });
    }
  }, {
    key: "render",
    value: function render() {
      if (this.props.hidden && !this.props.mobileNavMenuOpen) {
        return null;
      }
      var logo = sefaria.interfaceLang == "hebrew" ? /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/img/logo-hebrew.png",
        alt: "Sefaria Logo"
      }) : /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/img/logo.svg",
        alt: "Sefaria Logo"
      });
      var headerContent = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "headerNavSection"
      }, sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement("a", {
        className: "home",
        href: "/"
      }, logo) : null, /*#__PURE__*/external_react_default().createElement("a", {
        href: "/texts",
        className: "textLink"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        context: "Header"
      }, "Texts")), /*#__PURE__*/external_react_default().createElement("a", {
        href: "/topics",
        className: "textLink"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Topics")), /*#__PURE__*/external_react_default().createElement("a", {
        href: "/community",
        className: "textLink"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Community")), /*#__PURE__*/external_react_default().createElement(DonateLink, {
        classes: "textLink donate",
        source: "Header"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Donate"))), /*#__PURE__*/external_react_default().createElement("div", {
        className: "headerLinksSection"
      }, /*#__PURE__*/external_react_default().createElement(SearchBar, {
        onRefClick: this.props.onRefClick,
        showSearch: this.props.showSearch,
        openTopic: this.props.openTopic,
        openURL: this.props.openURL
      }), sefaria._uid ? /*#__PURE__*/external_react_default().createElement(LoggedInButtons, {
        headerMode: this.props.headerMode
      }) : /*#__PURE__*/external_react_default().createElement(LoggedOutButtons, {
        headerMode: this.props.headerMode
      }), !sefaria._uid && sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement(InterfaceLanguageMenu, {
        currentLang: sefaria.interfaceLang,
        translationLanguagePreference: this.props.translationLanguagePreference,
        setTranslationLanguagePreference: this.props.setTranslationLanguagePreference
      }) : null));
      var mobileHeaderContent = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("button", {
        onClick: this.props.onMobileMenuButtonClick,
        "aria-label": sefaria._("Menu"),
        className: "menuButton"
      }, /*#__PURE__*/external_react_default().createElement("i", {
        className: "fa fa-bars"
      }))), /*#__PURE__*/external_react_default().createElement("div", {
        className: "mobileHeaderCenter"
      }, sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement("a", {
        className: "home",
        href: "/texts"
      }, logo) : null), this.props.hasLanguageToggle ? /*#__PURE__*/external_react_default().createElement("div", {
        className: this.props.firstPanelLanguage + " mobileHeaderLanguageToggle"
      }, /*#__PURE__*/external_react_default().createElement(LanguageToggleButton, {
        toggleLanguage: this.props.toggleLanguage
      })) : /*#__PURE__*/external_react_default().createElement("div", null));
      var headerClasses = external_classnames_default()({
        header: 1,
        mobile: !this.props.multiPanel
      });
      var headerInnerClasses = external_classnames_default()({
        headerInner: 1,
        boxShadow: this.props.hasBoxShadow,
        mobile: !this.props.multiPanel
      });
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: headerClasses,
        role: "banner"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: headerInnerClasses
      }, this.props.multiPanel ? headerContent : mobileHeaderContent), this.props.multiPanel ? null : /*#__PURE__*/external_react_default().createElement(MobileNavMenu, {
        visible: this.props.mobileNavMenuOpen,
        onRefClick: this.props.onRefClick,
        showSearch: this.props.showSearch,
        openTopic: this.props.openTopic,
        openURL: this.props.openURL,
        close: this.props.onMobileMenuButtonClick
      }), /*#__PURE__*/external_react_default().createElement(GlobalWarningMessage, null));
    }
  }]);
  return Header;
}((external_react_class_default()));
Header.propTypes = {
  multiPanel: (external_prop_types_default()).bool.isRequired,
  headerMode: (external_prop_types_default()).bool.isRequired,
  onRefClick: (external_prop_types_default()).func.isRequired,
  showSearch: (external_prop_types_default()).func.isRequired,
  openTopic: (external_prop_types_default()).func.isRequired,
  openURL: (external_prop_types_default()).func.isRequired,
  hasBoxShadow: (external_prop_types_default()).bool.isRequired
};
var SearchBar = /*#__PURE__*/function (_Component2) {
  Header_inherits(SearchBar, _Component2);
  var _super2 = Header_createSuper(SearchBar);
  function SearchBar(props) {
    var _this2;
    Header_classCallCheck(this, SearchBar);
    _this2 = _super2.call(this, props);
    _this2.state = {
      searchFocused: false
    };
    _this2._searchOverridePre = sefaria._('Search for') + ': "';
    _this2._searchOverridePost = '"';
    _this2._type_icon_map = {
      "Collection": "collection.svg",
      "AuthorTopic": "iconmonstr-pen-17.svg",
      "TocCategory": "iconmonstr-view-6.svg",
      "PersonTopic": "iconmonstr-hashtag-1.svg",
      "Topic": "iconmonstr-hashtag-1.svg",
      "ref": "iconmonstr-book-15.svg",
      "search": "iconmonstr-magnifier-2.svg",
      "Term": "iconmonstr-script-2.svg",
      "User": "iconmonstr-user-2%20%281%29.svg"
    };
    return _this2;
  }
  Header_createClass(SearchBar, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.initAutocomplete();
      window.addEventListener('keydown', this.handleFirstTab);
    }
  }, {
    key: "_type_icon",
    value: function _type_icon(item) {
      if (item.type === "User" && item.pic !== "") {
        return item.pic;
      } else {
        return "/static/icons/".concat(this._type_icon_map[item.type]);
      }
    }
  }, {
    key: "_searchOverrideRegex",
    value: function _searchOverrideRegex() {
      return RegExp("^".concat(RegExp.escape(this._searchOverridePre), "(.*)").concat(RegExp.escape(this._searchOverridePost)));
    }
    // Returns true if override is caught.
  }, {
    key: "catchSearchOverride",
    value: function catchSearchOverride(query) {
      var override = query.match(this._searchOverrideRegex());
      if (override) {
        if (sefaria.site) {
          sefaria.track.event("Search", "Search Box Navigation - Book Override", override[1]);
        }
        this.closeSearchAutocomplete();
        this.showSearch(override[1]);
        sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").val(override[1]);
        return true;
      }
      return false;
    }
  }, {
    key: "initAutocomplete",
    value: function initAutocomplete() {
      var _this3 = this;
      sefariaJquery.widget("custom.sefariaAutocomplete", sefariaJquery.ui.autocomplete, {
        _renderItem: function (ul, item) {
          var override = item.label.match(this._searchOverrideRegex());
          var is_hebrew = sefaria.hebrew.isHebrew(item.label);
          return sefariaJquery("<li></li>").addClass('ui-menu-item').data("item.autocomplete", item).toggleClass("search-override", !!override).toggleClass("hebrew-result", !!is_hebrew).toggleClass("english-result", !is_hebrew).append("<img alt=\"".concat(item.type, "\" class=\"ac-img-").concat(item.type === "User" && item.pic === "" ? "UserPlaceholder" : item.type, "\" src=\"").concat(this._type_icon(item), "\">")).append(sefariaJquery("<a href=\"".concat(this.getURLForObject(item.type, item.key), "\" role='option' data-type-key=\"").concat(item.type, "-").concat(item.key, "\"></a>")).text(item.label)).appendTo(ul);
        }.bind(this)
      });
      var anchorSide = sefaria.interfaceLang === "hebrew" ? "right+" : "left-";
      var sideGap = this.props.fullWidth ? 55 : sefaria.interfaceLang === "hebrew" ? 38 : 40;
      sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").sefariaAutocomplete({
        position: {
          my: anchorSide + sideGap + " top+18",
          at: anchorSide + "0 bottom"
        },
        minLength: 3,
        open: function open($event, ui) {
          var $widget = sefariaJquery("ul.ui-autocomplete");
          sefariaJquery(".readerApp > .header").append($widget);
        },
        select: function select(event, ui) {
          event.preventDefault();
          if (_this3.catchSearchOverride(ui.item.label)) {
            return false;
          }
          _this3.redirectToObject(ui.item.type, ui.item.key);
          sefariaJquery(".ui-state-focus").removeClass("ui-state-focus");
          return false;
        },
        focus: function focus(event, ui) {
          event.preventDefault();
          sefariaJquery(external_react_dom_default().findDOMNode(_this3)).find("input.search").val(ui.item.label);
          sefariaJquery(".ui-state-focus").removeClass("ui-state-focus");
          sefariaJquery(".ui-menu-item a[data-type-key=\"".concat(ui.item.type, "-").concat(ui.item.key, "\"]")).parent().addClass("ui-state-focus");
        },
        source: function source(request, response) {
          return sefaria.getName(request.term).then(function (d) {
            var comps = d["completion_objects"].map(function (o) {
              var c = Header_objectSpread({}, o);
              c["value"] = "".concat(o['title']).concat(o["type"] === "ref" ? "" : " (".concat(o["type"], ")"));
              c["label"] = o["title"];
              return c;
            });
            if (comps.length > 0) {
              var q = "".concat(_this3._searchOverridePre).concat(request.term).concat(_this3._searchOverridePost);
              response(comps.concat([{
                value: "SEARCH_OVERRIDE",
                label: q,
                type: "search"
              }]));
            } else {
              response([]);
            }
          }, function (e) {
            return response([]);
          });
        }
      });
    }
  }, {
    key: "showVirtualKeyboardIcon",
    value: function showVirtualKeyboardIcon(show) {
      if (document.getElementById('keyboardInputMaster')) {
        //if keyboard is open, ignore.
        return; //this prevents the icon from flashing on every key stroke.
      }

      if (sefaria.interfaceLang === 'english' && !this.props.hideHebrewKeyboard) {
        sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".keyboardInputInitiator").css({
          "display": show ? "inline" : "none"
        });
      }
    }
  }, {
    key: "focusSearch",
    value: function focusSearch(e) {
      var parent = document.getElementById('searchBox');
      this.setState({
        searchFocused: true
      });
      this.showVirtualKeyboardIcon(true);
    }
  }, {
    key: "blurSearch",
    value: function blurSearch(e) {
      // check that you're actually focusing in on element outside of searchBox
      // see 2nd answer https://stackoverflow.com/questions/12092261/prevent-firing-the-blur-event-if-any-one-of-its-children-receives-focus/47563344
      var parent = document.getElementById('searchBox');
      if (!parent.contains(e.relatedTarget)) {
        if (!document.getElementById('keyboardInputMaster')) {
          // if keyboard is open, don't just close it and don't close search
          this.setState({
            searchFocused: false
          });
        }
        this.showVirtualKeyboardIcon(false);
      }
    }
  }, {
    key: "showSearch",
    value: function showSearch(query) {
      query = query.trim();
      if (typeof sjs !== "undefined") {
        query = encodeURIComponent(query);
        window.location = "/search?q=".concat(query);
        return;
      }
      this.props.showSearch(query);
      sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").sefariaAutocomplete("close");
      this.props.onNavigate && this.props.onNavigate();
    }
  }, {
    key: "getURLForObject",
    value: function getURLForObject(type, key) {
      if (type === "Collection") {
        return "/collections/".concat(key);
      } else if (type === "TocCategory") {
        return "/texts/".concat(key.join('/'));
      } else if (type in {
        "Topic": 1,
        "PersonTopic": 1,
        "AuthorTopic": 1
      }) {
        return "/topics/".concat(key);
      } else if (type === "ref") {
        return "/".concat(key.replace(/ /g, '_'));
      } else if (type === "User") {
        return "/profile/".concat(key);
      }
    }
  }, {
    key: "redirectToObject",
    value: function redirectToObject(type, key) {
      sefaria.track.event("Search", "Search Box Navigation - ".concat(type), key);
      this.closeSearchAutocomplete();
      this.clearSearchBox();
      var url = this.getURLForObject(type, key);
      var handled = this.props.openURL(url);
      if (!handled) {
        window.location = url;
      }
      this.props.onNavigate && this.props.onNavigate();
    }
  }, {
    key: "submitSearch",
    value: function submitSearch(query) {
      var _this4 = this;
      sefaria.getName(query).then(function (d) {
        // If the query isn't recognized as a ref, but only for reasons of capitalization. Resubmit with recognizable caps.
        if (sefaria.isACaseVariant(query, d)) {
          _this4.submitSearch(sefaria.repairCaseVariant(query, d));
          return;
        }
        if (d["is_ref"]) {
          var action = d["is_book"] ? "Search Box Navigation - Book" : "Search Box Navigation - Citation";
          sefaria.track.event("Search", action, query);
          _this4.clearSearchBox();
          _this4.props.onRefClick(d["ref"]); //todo: pass an onError function through here to the panel onError function which redirects to search
          _this4.props.onNavigate && _this4.props.onNavigate();
        } else if (!!d["topic_slug"]) {
          sefaria.track.event("Search", "Search Box Navigation - Topic", query);
          _this4.clearSearchBox();
          _this4.props.openTopic(d["topic_slug"]);
          _this4.props.onNavigate && _this4.props.onNavigate();
        } else if (d["type"] === "Person" || d["type"] === "Collection" || d["type"] === "TocCategory") {
          _this4.redirectToObject(d["type"], d["key"]);
        } else {
          sefaria.track.event("Search", "Search Box Search", query);
          _this4.closeSearchAutocomplete();
          _this4.showSearch(query);
        }
      });
    }
  }, {
    key: "closeSearchAutocomplete",
    value: function closeSearchAutocomplete() {
      sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").sefariaAutocomplete("close");
    }
  }, {
    key: "clearSearchBox",
    value: function clearSearchBox() {
      sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input.search").val("").sefariaAutocomplete("close");
    }
  }, {
    key: "handleSearchKeyUp",
    value: function handleSearchKeyUp(event) {
      if (event.keyCode !== 13 || sefariaJquery(".ui-state-focus").length > 0) {
        return;
      }
      var query = sefariaJquery(event.target).val();
      if (!query) {
        return;
      }
      if (this.catchSearchOverride(query)) {
        return;
      }
      this.submitSearch(query);
    }
  }, {
    key: "handleSearchButtonClick",
    value: function handleSearchButtonClick(event) {
      var query = sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".search").val();
      if (query) {
        this.submitSearch(query);
      } else {
        sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".search").focus();
      }
    }
  }, {
    key: "render",
    value: function render() {
      var inputClasses = external_classnames_default()({
        search: 1,
        serif: 1,
        keyboardInput: sefaria.interfaceLang === "english",
        hebrewSearch: sefaria.interfaceLang === "hebrew"
      });
      var searchBoxClasses = external_classnames_default()({
        searchBox: 1,
        searchFocused: this.state.searchFocused
      });
      return /*#__PURE__*/external_react_default().createElement("div", {
        id: "searchBox",
        className: searchBoxClasses
      }, /*#__PURE__*/external_react_default().createElement(SearchButton, {
        onClick: this.handleSearchButtonClick
      }), /*#__PURE__*/external_react_default().createElement("input", {
        className: inputClasses,
        id: "searchInput",
        placeholder: sefaria._("Search"),
        onKeyUp: this.handleSearchKeyUp,
        onFocus: this.focusSearch,
        onBlur: this.blurSearch,
        maxLength: 75,
        title: sefaria._("Search for Texts or Keywords Here")
      }));
    }
  }]);
  return SearchBar;
}((external_react_class_default()));
SearchBar.propTypes = {
  onRefClick: (external_prop_types_default()).func.isRequired,
  showSearch: (external_prop_types_default()).func.isRequired,
  openTopic: (external_prop_types_default()).func.isRequired,
  openURL: (external_prop_types_default()).func.isRequired,
  fullWidth: (external_prop_types_default()).bool,
  hideHebrewKeyboard: (external_prop_types_default()).bool
};
var LoggedOutButtons = function LoggedOutButtons(_ref) {
  var mobile = _ref.mobile,
    loginOnly = _ref.loginOnly;
  var _useState = (0,external_react_.useState)(false),
    _useState2 = Header_slicedToArray(_useState, 2),
    isClient = _useState2[0],
    setIsClient = _useState2[1];
  var _useState3 = (0,external_react_.useState)("/"),
    _useState4 = Header_slicedToArray(_useState3, 2),
    next = _useState4[0],
    setNext = _useState4[1];
  var _useState5 = (0,external_react_.useState)("/login?next=/"),
    _useState6 = Header_slicedToArray(_useState5, 2),
    loginLink = _useState6[0],
    setLoginLink = _useState6[1];
  var _useState7 = (0,external_react_.useState)("/register?next=/"),
    _useState8 = Header_slicedToArray(_useState7, 2),
    registerLink = _useState8[0],
    setRegisterLink = _useState8[1];
  (0,external_react_.useEffect)(function () {
    setIsClient(true);
  }, []);
  (0,external_react_.useEffect)(function () {
    if (isClient) {
      setNext(encodeURIComponent(sefaria.util.currentPath()));
      setLoginLink("/login?next=" + next);
      setRegisterLink("/register?next=" + next);
    }
  });
  var classes = external_classnames_default()({
    accountLinks: !mobile,
    anon: !mobile
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: classes
  }, /*#__PURE__*/external_react_default().createElement("a", {
    className: "login loginLink",
    href: loginLink,
    key: "login".concat(isClient)
  }, mobile ? /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/login.svg"
  }) : null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Log in")), loginOnly ? null : /*#__PURE__*/external_react_default().createElement("a", {
    className: "login signupLink",
    href: registerLink,
    key: "register".concat(isClient)
  }, mobile ? /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/register.svg"
  }) : null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sign up")), sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement(HelpButton, null) : null);
};
var LoggedInButtons = function LoggedInButtons(_ref2) {
  var headerMode = _ref2.headerMode;
  var _useState9 = (0,external_react_.useState)(false),
    _useState10 = Header_slicedToArray(_useState9, 2),
    isClient = _useState10[0],
    setIsClient = _useState10[1];
  (0,external_react_.useEffect)(function () {
    if (headerMode) {
      setIsClient(true);
    }
  }, []);
  var unread = headerMode ? isClient && sefaria.notificationCount > 0 ? 1 : 0 : sefaria.notificationCount > 0 ? 1 : 0;
  var notificationsClasses = external_classnames_default()({
    notifications: 1,
    unread: unread
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "loggedIn accountLinks"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/texts/saved",
    "aria-label": "See My Saved Texts"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/bookmarks.svg"
  })), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/notifications",
    "aria-label": "See New Notifications",
    key: "notificationCount-C-".concat(unread),
    className: notificationsClasses
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/notification.svg"
  })), sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement(HelpButton, null) : null, /*#__PURE__*/external_react_default().createElement(ProfilePicMenu, {
    len: 24,
    url: sefaria.profile_pic_url,
    name: sefaria.full_name,
    key: "profile-".concat(isClient, "-").concat(sefaria.full_name)
  }));
};
var MobileNavMenu = function MobileNavMenu(_ref3) {
  var onRefClick = _ref3.onRefClick,
    showSearch = _ref3.showSearch,
    openTopic = _ref3.openTopic,
    openURL = _ref3.openURL,
    close = _ref3.close,
    visible = _ref3.visible;
  var classes = external_classnames_default()({
    mobileNavMenu: 1,
    closed: !visible
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: classes
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "searchLine"
  }, /*#__PURE__*/external_react_default().createElement(SearchBar, {
    onRefClick: onRefClick,
    showSearch: showSearch,
    openTopic: openTopic,
    openURL: openURL,
    onNavigate: close,
    fullWidth: true,
    hideHebrewKeyboard: true
  })), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/texts",
    onClick: close,
    className: "textsPageLink"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/book.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    context: "Header"
  }, "Texts")), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/topics",
    onClick: close
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/topic.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Topics")), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/community",
    onClick: close
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/community.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Community")), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/calendars",
    onClick: close
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/calendar.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Learning Schedules")), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/collections",
    onClick: close
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/collection.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Collections")), /*#__PURE__*/external_react_default().createElement(DonateLink, {
    classes: "blue",
    source: "MobileNavMenu"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/heart.png",
    alt: "donation icon"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Donate")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "mobileAccountLinks"
  }, sefaria._uid ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/my/profile",
    onClick: close
  }, /*#__PURE__*/external_react_default().createElement(ProfilePic, {
    len: 22,
    url: sefaria.profile_pic_url,
    name: sefaria.full_name
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Profile")), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/texts/saved",
    onClick: close
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/bookmarks.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Saved & History")), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/notifications",
    onClick: close
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/notification.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Notifications"))) : null, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/about"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/info.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "About Sefaria")), sefaria._uid ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/settings/account"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/settings.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Account Settings"))) : null, /*#__PURE__*/external_react_default().createElement(MobileInterfaceLanguageToggle, null), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/help"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/help.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Get Help")), sefaria._uid ? /*#__PURE__*/external_react_default().createElement("a", {
    href: "/logout",
    className: "logout"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/logout.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Logout")) : /*#__PURE__*/external_react_default().createElement(LoggedOutButtons, {
    mobile: true,
    loginOnly: true
  })));
};
var ProfilePicMenu = function ProfilePicMenu(_ref4) {
  var len = _ref4.len,
    url = _ref4.url,
    name = _ref4.name;
  var _useState11 = (0,external_react_.useState)(false),
    _useState12 = Header_slicedToArray(_useState11, 2),
    isOpen = _useState12[0],
    setIsOpen = _useState12[1];
  var wrapperRef = (0,external_react_.useRef)(null);
  var menuClick = function menuClick(e) {
    var el = e.target;
    while (el && el.nodeName !== 'A') {
      el = el.parentNode;
    }
    if (el) {
      resetOpen();
    }
  };
  var profilePicClick = function profilePicClick(e) {
    e.preventDefault();
    resetOpen();
  };
  var resetOpen = function resetOpen() {
    setIsOpen(function (isOpen) {
      return !isOpen;
    });
  };
  var handleHideDropdown = function handleHideDropdown(event) {
    if (event.key === 'Escape') {
      setIsOpen(false);
    }
  };
  var handleClickOutside = function handleClickOutside(event) {
    if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {
      setIsOpen(false);
    }
  };
  (0,external_react_.useEffect)(function () {
    document.addEventListener('keydown', handleHideDropdown, true);
    document.addEventListener('click', handleClickOutside, true);
    return function () {
      document.removeEventListener('keydown', handleHideDropdown, true);
      document.removeEventListener('click', handleClickOutside, true);
    };
  }, []);
  var getCurrentPage = function getCurrentPage() {
    return encodeURIComponent(sefaria.util.currentPath());
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "myProfileBox",
    ref: wrapperRef
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/my/profile",
    className: "my-profile",
    onClick: profilePicClick
  }, /*#__PURE__*/external_react_default().createElement(ProfilePic, {
    len: len,
    url: url,
    name: name
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "interfaceLinks"
  }, isOpen ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "interfaceLinks-menu profile-menu",
    onClick: menuClick
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "interfaceLinks-header profile-menu"
  }, name), /*#__PURE__*/external_react_default().createElement("div", {
    className: "profile-menu-middle"
  }, /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "interfaceLinks-row",
    id: "my-profile-link",
    href: "/my/profile"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Profile"))), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "interfaceLinks-row",
    id: "new-sheet-link",
    href: "/sheets/new"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Create a New Sheet"))), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "interfaceLinks-row",
    id: "account-settings-link",
    href: "/settings/account"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Account Settings"))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "interfaceLinks-row languages"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    className: "".concat(sefaria.interfaceLang == 'hebrew' ? 'active' : ''),
    href: "/interface/hebrew?next=".concat(getCurrentPage()),
    id: "select-hebrew-interface-link"
  }, "\u05E2\u05D1\u05E8\u05D9\u05EA"), /*#__PURE__*/external_react_default().createElement("a", {
    className: "".concat(sefaria.interfaceLang == 'english' ? 'active' : ''),
    href: "/interface/english?next=".concat(getCurrentPage()),
    id: "select-english-interface-link"
  }, "English")), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "interfaceLinks-row bottom",
    id: "help-link",
    href: "/help"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Help")))), /*#__PURE__*/external_react_default().createElement("hr", {
    className: "interfaceLinks-hr"
  }), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "interfaceLinks-row logout",
    id: "logout-link",
    href: "/logout"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Logout")))) : null));
};
var MobileInterfaceLanguageToggle = function MobileInterfaceLanguageToggle() {
  var currentURL = encodeURIComponent(sefaria.util.currentPath());
  var links = sefaria.interfaceLang == "hebrew" ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/interface/hebrew?next=" + currentURL,
    className: "int-he"
  }, "\u05E2\u05D1\u05E8\u05D9\u05EA"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "separator"
  }, "\u2022"), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/interface/english?next=" + currentURL,
    className: "int-en inactive"
  }, "English")) : /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/interface/english?next=" + currentURL,
    className: "int-en"
  }, "English"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "separator"
  }, "\u2022"), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/interface/hebrew?next=" + currentURL,
    className: "int-he inactive"
  }, "\u05E2\u05D1\u05E8\u05D9\u05EA"));
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "mobileInterfaceLanguageToggle"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/globe-wire.svg"
  }), links);
};
var HelpButton = function HelpButton() {
  var url = sefaria._v({
    he: "/collections/%D7%A9%D7%90%D7%9C%D7%95%D7%AA-%D7%A0%D7%A4%D7%95%D7%A6%D7%95%D7%AA-%D7%91%D7%A1%D7%A4%D7%A8%D7%99%D7%90",
    en: "/collections/sefaria-faqs"
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "help"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: url
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/help.svg",
    alt: sefaria._("Help")
  })));
};
/* harmony default export */ const js_Header = (Header);
;// CONCATENATED MODULE: ../static/js/TextRange.jsx
function TextRange_typeof(obj) { "@babel/helpers - typeof"; return TextRange_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, TextRange_typeof(obj); }
function TextRange_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function TextRange_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, TextRange_toPropertyKey(descriptor.key), descriptor); } }
function TextRange_createClass(Constructor, protoProps, staticProps) { if (protoProps) TextRange_defineProperties(Constructor.prototype, protoProps); if (staticProps) TextRange_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function TextRange_toPropertyKey(arg) { var key = TextRange_toPrimitive(arg, "string"); return TextRange_typeof(key) === "symbol" ? key : String(key); }
function TextRange_toPrimitive(input, hint) { if (TextRange_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (TextRange_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function TextRange_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) TextRange_setPrototypeOf(subClass, superClass); }
function TextRange_setPrototypeOf(o, p) { TextRange_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return TextRange_setPrototypeOf(o, p); }
function TextRange_createSuper(Derived) { var hasNativeReflectConstruct = TextRange_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = TextRange_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = TextRange_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return TextRange_possibleConstructorReturn(this, result); }; }
function TextRange_possibleConstructorReturn(self, call) { if (call && (TextRange_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return TextRange_assertThisInitialized(self); }
function TextRange_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function TextRange_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function TextRange_getPrototypeOf(o) { TextRange_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return TextRange_getPrototypeOf(o); }










var TextRange = /*#__PURE__*/function (_Component) {
  TextRange_inherits(TextRange, _Component);
  var _super = TextRange_createSuper(TextRange);
  function TextRange() {
    TextRange_classCallCheck(this, TextRange);
    return _super.apply(this, arguments);
  }
  TextRange_createClass(TextRange, [{
    key: "componentDidMount",
    value:
    // A Range or text defined a by a single Ref. Specially treated when set as 'basetext'.
    // This component is responsible for retrieving data from `Sefaria` for the ref that defines it.
    function componentDidMount() {
      this._isMounted = true;
      var data = this.getText();
      if (data && !this.dataPrefetched) {
        // If data was populated server side, onTextLoad was never called
        this.onTextLoad(data);
      } else if (this.props.basetext || this.props.segmentNumber) {
        this.placeSegmentNumbers();
      }
      window.addEventListener('resize', this.handleResize);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this._isMounted = false;
      window.removeEventListener('resize', this.handleResize);
    }
  }, {
    key: "shouldComponentUpdate",
    value: function shouldComponentUpdate(nextProps) {
      if (this.props.sref !== nextProps.sref) {
        return true;
      }
      if (!!this.props.filter !== !!nextProps.filter) {
        return true;
      }
      if (this.props.filter && nextProps.filter && !this.props.filter.compare(nextProps.filter)) {
        return true;
      }
      if (this.props.highlightedRefs && nextProps.highlightedRefs && !this.props.highlightedRefs.compare(nextProps.highlightedRefs)) {
        return true;
      }
      if (this.props.currVersions.en !== nextProps.currVersions.en) {
        return true;
      }
      if (this.props.currVersions.he !== nextProps.currVersions.he) {
        return true;
      }
      if (this.props.translationLanguagePreference !== nextProps.translationLanguagePreference) {
        return true;
      }
      if (this.props.showHighlight !== nextProps.showHighlight) {
        return true;
      }
      // todo: figure out when and if this component receives settings at all
      if (nextProps.settings && this.props.settings && (nextProps.settings.language !== this.props.settings.language || nextProps.settings.layoutDefault !== this.props.settings.layoutDefault || nextProps.settings.layoutTanakh !== this.props.settings.layoutTanakh || nextProps.settings.aliyotTorah !== this.props.settings.aliyotTorah || nextProps.settings.vowels !== this.props.settings.vowels || nextProps.settings.layoutTalmud !== this.props.settings.layoutTalmud || nextProps.settings.biLayout !== this.props.settings.biLayout || nextProps.settings.fontSize !== this.props.settings.fontSize || nextProps.settings.punctuationTalmud !== this.props.settings.punctuationTalmud || nextProps.layoutWidth !== this.props.layoutWidth)) {
        return true;
      }
      // lowlight ?

      return false;
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      // Place segment numbers again if update affected layout
      if (this.props.basetext || this.props.segmentNumber) {
        if (prevProps.currVersions.en !== this.props.currVersions.en || prevProps.currVersions.he !== this.props.currVersions.he || prevProps.settings.language !== this.props.settings.language || prevProps.settings.layoutDefault !== this.props.settings.layoutDefault || prevProps.settings.layoutTanakh !== this.props.settings.layoutTanakh || prevProps.settings.aliyotTorah !== this.props.settings.aliyotTorah || prevProps.settings.layoutTalmud !== this.props.settings.layoutTalmud || prevProps.settings.biLayout !== this.props.settings.biLayout || prevProps.settings.fontSize !== this.props.settings.fontSize || prevProps.layoutWidth !== this.props.layoutWidth || prevProps.settings.punctuationTalmud !== this.props.settings.punctuationTalmud || !!prevProps.filter !== !!this.props.filter || !!prevProps.filter && !prevProps.filter.compare(this.props.filter)) {
          // Rerender in case version has changed
          this.forceUpdate(function () {
            this.placeSegmentNumbers();
          }.bind(this));
        }
      }
    }
  }, {
    key: "handleResize",
    value: function handleResize() {
      if (this.props.basetext || this.props.segmentNumber) {
        this.placeSegmentNumbers();
      }
    }
  }, {
    key: "handleClick",
    value: function handleClick(event) {
      if (window.getSelection().type === "Range") {
        // Don't do anything if this click is part of a selection
        return;
      }
      if (this.props.onRangeClick) {
        //Click on the body of the TextRange itself from TextList
        this.props.onRangeClick(this.props.sref);
        sefaria.track.event("Reader", "Click Text from TextList", this.props.sref);
      }
    }
  }, {
    key: "handleKeyPress",
    value: function handleKeyPress(event) {
      if (event.charCode == 13) {
        this.handleClick(event);
      }
    }
  }, {
    key: "getText",
    value: function getText() {
      var settings = {
        context: this.props.withContext ? 1 : 0,
        enVersion: this.props.currVersions.en || null,
        heVersion: this.props.currVersions.he || null,
        // Support redirect of basetext for schema node refs.  Don't rewrite refs on sidebar to avoid infinite loop of cache misses.
        firstAvailableRef: this.props.basetext ? 1 : 0,
        translationLanguagePreference: this.props.translationLanguagePreference,
        versionPref: sefaria.versionPreferences.getVersionPref(this.props.sref)
      };
      var data = sefaria.getTextFromCache(this.props.sref, settings);
      if ((!data || "updateFromAPI" in data) && !this.textLoading) {
        // If we don't have data yet, call trigger an API call
        this.textLoading = true;
        sefaria.getText(this.props.sref, settings).then(this.onTextLoad);
      } else if (!!data && this.props.isCurrentlyVisible) {
        this._updateCurrVersions(data.versionTitle, data.heVersionTitle);
      }
      return data;
    }
  }, {
    key: "onTextLoad",
    value: function onTextLoad(data) {
      // Initiate additional API calls when text data first loads
      this.textLoading = false;
      if (this.props.basetext && this.props.sref !== data.ref) {
        // Replace ReaderPanel contents ref with the normalized form of the ref, if they differ.
        // Pass parameter to showBaseText to replaceHistory - normalization should't add a step to history
        this.props.showBaseText(data.ref, true, this.props.currVersions);
        return;
      } else if (this.props.basetext && data.spanning) {
        // Replace ReaderPanel contents with split refs if ref is spanning
        // Pass parameter to showBaseText to replaceHistory - normalization should't add a step to history
        // console.log("Re-rewriting spanning ref")
        this.props.showBaseText(data.spanningRefs, true, this.props.currVersions, this.props.versionLanguage);
        return;
      }
      this._updateCurrVersions(data.versionTitle, data.heVersionTitle);

      // If this is a ref to a super-section, rewrite it to first available section
      if (this.props.basetext && data.textDepth - data.sections.length > 1 && data.firstAvailableSectionRef) {
        this.props.showBaseText(data.firstAvailableSectionRef, true, this.props.currVersions);
        return;
      }
      this.prefetchData();
      if (this._isMounted) {
        this.forceUpdate(function () {
          this.placeSegmentNumbers();
          this.props.onTextLoad && this.props.onTextLoad(data.ref); // Don't call until the text is actually rendered
        }.bind(this));
      }
    }
  }, {
    key: "_updateCurrVersions",
    value: function _updateCurrVersions(enVTitle, heVTitle) {
      // make sure currVersions matches versions returned, due to translationLanguagePreference and versionPreferences
      if (!this.props.updateCurrVersionsToMatchAPIResult) {
        return;
      }
      this.props.updateCurrVersionsToMatchAPIResult(enVTitle, heVTitle);
    }
  }, {
    key: "_prefetchLinksAndNotes",
    value: function _prefetchLinksAndNotes(data) {
      var sectionRefs = data.isSpanning ? data.spanningRefs : [data.sectionRef];
      sectionRefs = sectionRefs.map(function (ref) {
        if (ref.indexOf("-") > -1) {
          ref = ref.split("-")[0];
          ref = ref.slice(0, ref.lastIndexOf(":"));
        }
        return ref;
      });
      if (this.props.loadLinks && !sefaria.linksLoaded(sectionRefs)) {
        for (var i = 0; i < sectionRefs.length; i++) {
          sefaria.related(sectionRefs[i], function () {
            if (this._isMounted) {
              this.forceUpdate();
            }
          }.bind(this));
          if (sefaria._uid) {
            sefaria.relatedPrivate(sectionRefs[i], function () {
              if (this._isMounted) {
                this.forceUpdate();
              }
            }.bind(this));
          }
        }
      }
    }
  }, {
    key: "prefetchData",
    value: function prefetchData() {
      var _this = this;
      // Prefetch additional data (next, prev, links, notes etc) for this ref
      if (this.dataPrefetched) {
        return;
      }
      var data = this.getText();
      if (!data) {
        return;
      }

      // Load links at section level if spanning, so that cache is properly primed with section level refs
      this._prefetchLinksAndNotes(data);
      if (this.props.prefetchNextPrev) {
        if (data.next) {
          sefaria.getText(data.next, {
            context: 1,
            multiple: this.props.prefetchMultiple,
            enVersion: this.props.currVersions.en || null,
            heVersion: this.props.currVersions.he || null,
            translationLanguagePreference: this.props.translationLanguagePreference,
            versionPref: sefaria.versionPreferences.getVersionPref(data.next)
          }).then(function (ds) {
            return Array.isArray(ds) ? ds.map(function (d) {
              return _this._prefetchLinksAndNotes(d);
            }) : _this._prefetchLinksAndNotes(ds);
          });
        }
        if (data.prev) {
          sefaria.getText(data.prev, {
            context: 1,
            multiple: -this.props.prefetchMultiple,
            enVersion: this.props.currVersions.en || null,
            heVersion: this.props.currVersions.he || null,
            translationLanguagePreference: this.props.translationLanguagePreference,
            versionPref: sefaria.versionPreferences.getVersionPref(data.prev)
          }).then(function (ds) {
            return Array.isArray(ds) ? ds.map(function (d) {
              return _this._prefetchLinksAndNotes(d);
            }) : _this._prefetchLinksAndNotes(ds);
          });
        }
        if (data.indexTitle) {
          // Preload data that is used on Text TOC page
          sefaria.getIndexDetails(data.indexTitle);
        }
      }
      this.dataPrefetched = true;
    }
  }, {
    key: "placeSegmentNumbers",
    value: function placeSegmentNumbers() {
      // console.log("placeSegmentNumbers", this.props.sref);
      // Set the vertical offsets for segment numbers and link counts, which are dependent
      // on the rendered height of the text of each segment.
      if (!this.props.basetext) {
        return;
      }
      var $text = sefariaJquery(external_react_dom_default().findDOMNode(this));
      var elemsAtPosition = {}; // Keyed by top position, an array of elements found there
      var setTop = function setTop() {
        var $elem = sefariaJquery(this);
        var top = $elem.parent().position().top;
        $elem.css({
          top: top,
          left: '',
          right: ''
        });
        var list = elemsAtPosition[top] || [];
        list.push($elem);
        elemsAtPosition[top] = list;
      };
      $text.find(".linkCount").each(setTop);
      elemsAtPosition = {}; // resetting because we only want it to track segmentNumbers
      $text.find(".segmentNumber").each(setTop).show();
      var side = this.props.settings.language == "hebrew" ? "right" : "left";
      var selector = this.props.settings.language == "hebrew" ? ".he" : ".en";
      var fixCollision = function fixCollision($elems) {
        // Takes an array of jQuery elements that all currently appear at the same top position
        if ($elems.length == 1) {
          return;
        }
        if ($elems.length == 2) {
          var adjust1 = $elems[0].find(".segmentNumberInner").width();
          var adjust2 = $elems[1].find(".segmentNumberInner").width();
          $elems[0].css(side, "-=" + adjust1);
          $elems[1].css(side, "+=" + adjust2);
        }
      };
      for (var top in elemsAtPosition) {
        if (elemsAtPosition.hasOwnProperty(top)) {
          fixCollision(elemsAtPosition[top]);
        }
      }
      $text.find(".segmentNumber").show();
      $text.find(".linkCount").show();
    }
  }, {
    key: "onFootnoteClick",
    value: function onFootnoteClick(event) {
      event.preventDefault();
      sefariaJquery(event.target).closest("sup").next("i.footnote").toggle();
      this.placeSegmentNumbers();
    }
  }, {
    key: "parashahHeader",
    value: function parashahHeader(data, segment) {
      var includeAliyout = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
      // Returns the English/Hebrew title of a Parasha, if `ref` is the beginning of a new parahsah
      // returns null otherwise.
      //let data = this.getText();
      if (!data) {
        return null;
      }
      if ("alts" in data && data.alts.length && (data.categories[1] == "Torah" && !data["isDependant"] || data.categories[2] == "Onkelos")) {
        var curRef = segment.ref;
        if ("alt" in segment && segment.alt != null) {
          if (includeAliyout || "whole" in segment.alt) {
            return {
              "en": segment.alt["en"][0],
              "he": segment.alt["he"][0],
              "parashaTitle": "whole" in segment.alt
            };
          }
        }
      }
      return null;
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props$settings,
        _this$props$settings2,
        _this$props$settings3,
        _this2 = this;
      var data = this.getText();
      var title, heTitle, ref;
      if (data && this.props.basetext) {
        ref = this.props.withContext ? data.sectionRef : data.ref;
        var sectionStrings = sefaria.sectionString(ref);
        var oref = sefaria.ref(ref);
        var useShortString = oref && sefaria.util.inArray(oref.primary_category, ["Tanakh", "Mishnah", "Talmud", "Tanaitic", "Commentary"]) !== -1;
        title = useShortString ? sectionStrings.en.numbered : sectionStrings.en.named;
        heTitle = useShortString ? sectionStrings.he.numbered : sectionStrings.he.named;
      } else if (data && !this.props.basetext) {
        title = data.ref;
        heTitle = data.heRef;
        ref = data.ref;
      } else if (!data) {
        title = "Loading...";
        heTitle = "טעינה...";
        ref = null;
      }
      var formatEnAsPoetry = data && data.formatEnAsPoetry;
      var formatHeAsPoetry = data && data.formatHeAsPoetry;
      var showNumberLabel = data && data.categories && data.categories[0] !== "Liturgy" && data.categories[0] !== "Reference";
      var showSegmentNumbers = showNumberLabel && this.props.basetext;

      // [\.\!\?\:\,\u05F4]+                                                                      # Match (and remove) one or more punctuation or gershayim
      //    (?![\u0591-\u05bd\u05bf-\u05c5\u05c7\u200d\u05d0-\u05eA](?:[\.\!\?\:\,\u05F4\s]|$))   # So long as it's not immediately followed by one letter (followed by space, punctuation, endline, etc.)
      // |—\s;                                                                                    # OR match (and remove) an mdash followed by a space
      var punctuationre = /[\.\!\?\:\,\u05F4]+(?![\u0591-\u05bd\u05bf-\u05c5\u05c7\u200d\u05d0-\u05eA](?:[\.\!\?\:\,\u05F4\s]|$))|—\s/g;
      var strip_punctuation_re = (((_this$props$settings = this.props.settings) === null || _this$props$settings === void 0 ? void 0 : _this$props$settings.language) === "hebrew" || ((_this$props$settings2 = this.props.settings) === null || _this$props$settings2 === void 0 ? void 0 : _this$props$settings2.language) === "bilingual") && ((_this$props$settings3 = this.props.settings) === null || _this$props$settings3 === void 0 ? void 0 : _this$props$settings3.punctuationTalmud) === "punctuationOff" && (data === null || data === void 0 ? void 0 : data.type) === "Talmud" ? punctuationre : null;
      var nre = /[\u0591-\u05af\u05bd\u05bf\u05c0\u05c4\u05c5\u200d]/g; // cantillation
      var cnre = /[\u0591-\u05bd\u05bf-\u05c5\u05c7\u200d]/g; // cantillation and nikud

      var strip_vowels_re = null;
      if (this.props.settings && this.props.settings.language !== "english" && this.props.settings.vowels !== "all") {
        strip_vowels_re = this.props.settings.vowels == "partial" ? nre : cnre;
      }
      var segments = sefaria.makeSegments(data, this.props.withContext);
      if (segments.length > 0 && strip_vowels_re && !strip_vowels_re.test(segments[0].he)) {
        strip_vowels_re = null; //if the first segment doesnt even match as containing vowels or cantillation- stop
      }

      var textSegments = segments.map(function (segment, i) {
        var highlight = _this2.props.highlightedRefs && _this2.props.highlightedRefs.length ?
        // if highlighted refs are explicitly set
        sefaria.util.inArray(segment.ref, _this2.props.highlightedRefs) !== -1 ||
        // highlight if this ref is in highlighted refs prop
        sefaria.util.inArray(sefaria.sectionRef(segment.ref), _this2.props.highlightedRefs) !== -1 :
        // or if the highlighted refs include a section level ref including this ref
        _this2.props.basetext && segment.highlight; // otherwise highlight if this a basetext and the ref is specific
        var textHighlights = (highlight || !_this2.props.basetext) && !!_this2.props.textHighlights ? _this2.props.textHighlights : null; // apply textHighlights in a base text only when the segment is hightlights
        var parashahHeader = null;
        if (_this2.props.showParashahHeaders) {
          var parashahNames = _this2.parashahHeader(data, segment, _this2.props.settings.aliyotTorah == 'aliyotOn');
          if (parashahNames) {
            var pclasses = external_classnames_default()({
              parashahHeader: 1,
              aliyah: !parashahNames.parashaTitle
            });
            parashahHeader = /*#__PURE__*/external_react_default().createElement("div", {
              className: pclasses
            }, /*#__PURE__*/external_react_default().createElement(ContentText, {
              text: {
                en: parashahNames.en,
                he: parashahNames.he
              },
              defaultToInterfaceOnBilingual: true
            }));
          }
        }
        segment.he = strip_vowels_re ? segment.he.replace(strip_vowels_re, "") : segment.he;
        segment.he = strip_punctuation_re ? segment.he.replace(strip_punctuation_re, "") : segment.he;
        return /*#__PURE__*/external_react_default().createElement("span", {
          className: "rangeSpan",
          key: i + segment.ref
        }, parashahHeader, /*#__PURE__*/external_react_default().createElement(TextSegment, {
          sref: segment.ref,
          enLangCode: _this2.props.currVersions.en && /\[([a-z][a-z][a-z]?)\]$/.test(_this2.props.currVersions.en) ? /\[([a-z][a-z][a-z]?)\]$/.exec(_this2.props.currVersions.en)[1] : 'en',
          heLangCode: _this2.props.currVersions.he && /\[([a-z][a-z][a-z]?)\]$/.test(_this2.props.currVersions.he) ? /\[([a-z][a-z][a-z]?)\]$/.exec(_this2.props.currVersions.he)[1] : 'he',
          en: !_this2.props.useVersionLanguage || _this2.props.currVersions.en ? segment.en : null,
          he: !_this2.props.useVersionLanguage || _this2.props.currVersions.he ? segment.he : null,
          highlight: highlight,
          showHighlight: _this2.props.showHighlight,
          textHighlights: textHighlights,
          segmentNumber: showSegmentNumbers ? segment.number : 0,
          showLinkCount: _this2.props.basetext,
          linkCount: sefaria.linkCount(segment.ref, _this2.props.filter),
          filter: _this2.props.filter,
          panelPosition: _this2.props.panelPosition,
          onSegmentClick: _this2.props.onSegmentClick,
          onCitationClick: _this2.props.onCitationClick,
          onFootnoteClick: _this2.onFootnoteClick,
          onNamedEntityClick: _this2.props.onNamedEntityClick,
          unsetTextHighlight: _this2.props.unsetTextHighlight,
          formatEnAsPoetry: formatEnAsPoetry,
          formatHeAsPoetry: formatHeAsPoetry,
          placeSegmentNumbers: _this2.placeSegmentNumbers
        }));
      });
      textSegments = textSegments.length ? textSegments : null;
      var classes = external_classnames_default()({
        textRange: 1,
        basetext: this.props.basetext,
        loading: !data,
        lowlight: this.props.lowlight
      });

      // configure number display for inline references
      var sidebarNum;
      var displaySidebarNumber = this.props.inlineReference && this.props.inlineReference['data-commentator'] === sefaria.index(sefaria.parseRef(this.props.sref).index).collectiveTitle;
      if (displaySidebarNumber) {
        var enDisplayValue, heDisplayValue;
        if (this.props.inlineReference['data-label']) {
          enDisplayValue = this.props.inlineReference['data-label'];
          heDisplayValue = this.props.inlineReference['data-label'];
        } else {
          enDisplayValue = this.props.inlineReference['data-order'];
          heDisplayValue = sefaria.hebrew.encodeHebrewNumeral(enDisplayValue);
        }
        if (heDisplayValue === undefined) {
          heDisplayValue = enDisplayValue;
        }
        sidebarNum = /*#__PURE__*/external_react_default().createElement("div", {
          className: "numberLabel sans-serif itag"
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "numberLabelInner"
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: enDisplayValue,
            he: heDisplayValue
          },
          defaultToInterfaceOnBilingual: true
        })));
      } else if (showNumberLabel && this.props.numberLabel) {
        sidebarNum = /*#__PURE__*/external_react_default().createElement("div", {
          className: "numberLabel sans-serif"
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "numberLabelInner"
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: this.props.numberLabel,
            he: sefaria.hebrew.encodeHebrewNumeral(this.props.numberLabel)
          },
          defaultToInterfaceOnBilingual: true
        })));
      } else {
        sidebarNum = null;
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes,
        onClick: this.handleClick,
        onKeyPress: this.handleKeyPress,
        "data-ref": ref
      }, sidebarNum, this.props.hideTitle ? null : /*#__PURE__*/external_react_default().createElement("div", {
        className: "title"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "titleBox",
        role: "heading",
        "aria-level": "2"
      }, /*#__PURE__*/external_react_default().createElement(ContentText, {
        text: {
          en: title,
          he: heTitle
        },
        defaultToInterfaceOnBilingual: true
      })), this.props.titleButtons ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "buttons",
        onClick: function onClick(e) {
          return e.stopPropagation();
        }
      }, this.props.titleButtons) : null), /*#__PURE__*/external_react_default().createElement("div", {
        className: "text"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "textInner"
      }, textSegments, this.props.showActionLinks ? actionLinks : null)));
    }
  }]);
  return TextRange;
}((external_react_class_default()));
TextRange.propTypes = {
  sref: (external_prop_types_default()).string.isRequired,
  currVersions: (external_prop_types_default()).object.isRequired,
  useVersionLanguage: (external_prop_types_default()).bool,
  highlightedRefs: (external_prop_types_default()).array,
  showHighlight: (external_prop_types_default()).bool,
  basetext: (external_prop_types_default()).bool,
  withContext: (external_prop_types_default()).bool,
  hideTitle: (external_prop_types_default()).bool,
  loadLinks: (external_prop_types_default()).bool,
  prefetchNextPrev: (external_prop_types_default()).bool,
  prefetchMultiple: (external_prop_types_default()).number,
  lowlight: (external_prop_types_default()).bool,
  numberLabel: (external_prop_types_default()).number,
  settings: (external_prop_types_default()).object,
  filter: (external_prop_types_default()).array,
  titleButtons: (external_prop_types_default()).object,
  showParashahHeaders: (external_prop_types_default()).bool,
  onTextLoad: (external_prop_types_default()).func,
  onRangeClick: (external_prop_types_default()).func,
  onSegmentClick: (external_prop_types_default()).func,
  onCitationClick: (external_prop_types_default()).func,
  onNamedEntityClick: (external_prop_types_default()).func,
  showBaseText: (external_prop_types_default()).func,
  unsetTextHighlight: (external_prop_types_default()).func,
  panelsOpen: (external_prop_types_default()).number,
  // used?
  layoutWidth: (external_prop_types_default()).number,
  showActionLinks: (external_prop_types_default()).bool,
  inlineReference: (external_prop_types_default()).object,
  textHighlights: (external_prop_types_default()).array,
  translationLanguagePreference: (external_prop_types_default()).string
};
TextRange.defaultProps = {
  currVersions: {
    en: null,
    he: null
  }
};
var TextSegment = /*#__PURE__*/function (_Component2) {
  TextRange_inherits(TextSegment, _Component2);
  var _super2 = TextRange_createSuper(TextSegment);
  function TextSegment() {
    TextRange_classCallCheck(this, TextSegment);
    return _super2.apply(this, arguments);
  }
  TextRange_createClass(TextSegment, [{
    key: "shouldComponentUpdate",
    value: function shouldComponentUpdate(nextProps) {
      if (this.props.highlight !== nextProps.highlight) {
        return true;
      }
      if (this.props.showHighlight !== nextProps.showHighlight) {
        return true;
      }
      if (this.props.textHighlights !== nextProps.textHighlights) {
        return true;
      }
      if (this.props.showLinkCount !== nextProps.showLinkCount) {
        return true;
      }
      if (this.props.linkCount !== nextProps.linkCount) {
        return true;
      }
      if (!!this.props.filter !== !!nextProps.filter) {
        return true;
      }
      if (this.props.filter && nextProps.filter && !this.props.filter.compare(nextProps.filter)) {
        return true;
      }
      if (this.props.en !== nextProps.en || this.props.he !== nextProps.he) {
        return true;
      }
      return false;
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      if (this.props.highlight !== prevProps.highlight && !!this.props.textHighlights) {
        this.props.unsetTextHighlight();
      }
    }
  }, {
    key: "handleClick",
    value: function handleClick(event) {
      // grab refLink from target or parent (sometimes there is an <i> within refLink forcing us to look for the parent)
      var refLink = sefariaJquery(event.target).hasClass("refLink") ? sefariaJquery(event.target) : sefariaJquery(event.target.parentElement).hasClass("refLink") ? sefariaJquery(event.target.parentElement) : null;
      var namedEntityLink = sefariaJquery(event.target).closest("a.namedEntityLink");
      var footnoteLink = sefariaJquery(event.target).is("sup") || sefariaJquery(event.target).parents("sup").size();
      if (refLink) {
        //Click of citation
        event.preventDefault();
        var ref = sefaria.humanRef(refLink.attr("data-ref"));
        var ven = refLink.attr("data-ven") ? refLink.attr("data-ven") : null;
        var vhe = refLink.attr("data-vhe") ? refLink.attr("data-vhe") : null;
        var currVersions = {
          "en": ven,
          "he": vhe
        };
        this.props.onCitationClick(ref, this.props.sref, true, currVersions);
        event.stopPropagation();
        sefaria.track.event("Reader", "Citation Link Click", ref);
      } else if (footnoteLink) {
        this.props.onFootnoteClick(event);
        event.stopPropagation();
      } else if (namedEntityLink.length > 0) {
        //Click of named entity
        event.preventDefault();
        if (!this.props.onNamedEntityClick) {
          return;
        }
        var topicSlug = namedEntityLink.attr("data-slug");
        sefaria.util.selectElementContents(namedEntityLink[0]);
        this.props.onNamedEntityClick(topicSlug, this.props.sref, namedEntityLink[0].innerText);
        event.stopPropagation();
        sefaria.track.event("Reader", "Named Entity Link Click", topicSlug);
      } else if (this.props.onSegmentClick) {
        this.props.onSegmentClick(this.props.sref);
        sefaria.track.event("Reader", "Text Segment Click", this.props.sref);
      }
    }
  }, {
    key: "handleKeyPress",
    value: function handleKeyPress(event) {
      if (event.charCode == 13) {
        this.handleClick(event);
      }
    }
  }, {
    key: "formatItag",
    value: function formatItag(lang, text) {
      var $newElement = sefariaJquery("<div>" + text + "</div>");
      var textValue = function textValue(i) {
        var value;
        if (sefariaJquery(i).attr('data-label')) {
          return sefariaJquery(i).attr('data-label');
        } else {
          if (lang === "he") {
            value = sefaria.hebrew.encodeHebrewNumeral(sefariaJquery(i).attr('data-order'));
          } else if (lang === "en") {
            value = sefariaJquery(i).attr('data-order');
          }
        }
        if (value === undefined) {
          value = sefariaJquery(i).attr('data-order');
        }
        return value;
      };
      //Since our list of commentaries has titles both with single quotes and double quotes in it, because reasons, we need to escape at least one so this function doest go down in flames.
      var escapedFilter = this.props.filter[0].replace(/["]/g, '\\"'); //we know filter is defined at this point, so no need to check if its there first.
      $newElement.find("i[data-commentator=\"".concat(escapedFilter, "\"]")).each(function () {
        sefariaJquery(this).replaceWith('<sup class="itag">' + textValue(this) + "</sup>");
      });
      return $newElement.html();
    }
  }, {
    key: "wrapWordsInGenericHTMLRegex",
    value: function wrapWordsInGenericHTMLRegex(text) {
      var arbitraryHTMLTagsRegex = '(?:<\/?[^>]+>){0,}';
      return text.replace(/(\S+)/g, "".concat(arbitraryHTMLTagsRegex, "$1").concat(arbitraryHTMLTagsRegex));
    }
  }, {
    key: "addHighlights",
    value: function addHighlights(text) {
      var _this3 = this;
      // for adding in highlights to query results in Reader
      if (!!this.props.textHighlights) {
        var highList = this.props.textHighlights.map(function (h) {
          return _this3.wrapWordsInGenericHTMLRegex(h);
        });
        var reg = new RegExp("(".concat(highList.join("|"), ")"), 'g');
        return text.replace(reg, '<span class="queryTextHighlight">$1</span>');
      }
      return text;
    }
  }, {
    key: "addPoetrySpans",
    value: function addPoetrySpans(text) {
      var textArray = text.split("<br>").map(function (t) {
        return "<span class='poetry indentWhenWrap'>".concat(t, "</span>");
      }).join("<br>");
      return textArray;
    }
  }, {
    key: "render",
    value: function render() {
      var linkCountElement = null;
      var he = this.props.he || "";
      var en = this.props.en || "";
      // render itags
      if (this.props.filter && this.props.filter.length > 0) {
        he = this.formatItag("he", he);
        en = this.formatItag("en", en);
      }
      he = this.addHighlights(he);
      en = this.addHighlights(en);
      en = this.props.formatEnAsPoetry ? this.addPoetrySpans(en) : en;
      he = this.props.formatHeAsPoetry ? this.addPoetrySpans(he) : he;
      var heOnly = !this.props.en;
      var enOnly = !this.props.he;
      var overrideLanguage = enOnly || heOnly ? heOnly ? "hebrew" : "english" : null;
      if (this.props.showLinkCount) {
        var linkCount = this.props.linkCount;
        var minOpacity = 20,
          maxOpacity = 70;
        var linkScore = linkCount ? Math.min(linkCount + minOpacity, maxOpacity) / 100.0 : 0;
        var style = {
          opacity: linkScore
        };
        linkCountElement = this.props.showLinkCount ? /*#__PURE__*/external_react_default().createElement("div", {
          className: "linkCount sans-serif",
          title: linkCount + " Connections Available"
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "linkCountDot",
          style: style
        })) : null;
      } else {
        linkCountElement = "";
      }
      var segmentNumber = this.props.segmentNumber ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "segmentNumber sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "segmentNumberInner"
      }, /*#__PURE__*/external_react_default().createElement(ContentText, {
        text: {
          "en": this.props.segmentNumber,
          "he": sefaria.hebrew.encodeHebrewNumeral(this.props.segmentNumber)
        },
        defaultToInterfaceOnBilingual: true
      }))) : null;
      var classes = external_classnames_default()({
        segment: 1,
        highlight: this.props.highlight && this.props.showHighlight,
        invisibleHighlight: this.props.highlight,
        heOnly: heOnly,
        enOnly: enOnly,
        showNamedEntityLinks: !!this.props.onNamedEntityClick
      });
      if (!this.props.en && !this.props.he) {
        return false;
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        tabIndex: "0",
        className: classes,
        onClick: this.handleClick,
        onKeyPress: this.handleKeyPress,
        "data-ref": this.props.sref,
        "aria-controls": "panel-" + (this.props.panelPosition + 1),
        "aria-label": "Click to see links to " + this.props.sref
      }, segmentNumber, linkCountElement, /*#__PURE__*/external_react_default().createElement("p", {
        className: "segmentText"
      }, /*#__PURE__*/external_react_default().createElement(VersionContent, {
        overrideLanguage: overrideLanguage,
        html: {
          "he": he + " ",
          "en": en + " "
        },
        bilingualOrder: ["he", "en"],
        imageLoadCallback: this.props.placeSegmentNumbers
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "clearFix"
      }));
    }
  }]);
  return TextSegment;
}((external_react_class_default()));
TextSegment.propTypes = {
  sref: (external_prop_types_default()).string,
  en: (external_prop_types_default()).string,
  he: (external_prop_types_default()).string,
  highlight: (external_prop_types_default()).bool,
  showHighlight: (external_prop_types_default()).bool,
  textHighlights: (external_prop_types_default()).array,
  segmentNumber: (external_prop_types_default()).number,
  showLinkCount: (external_prop_types_default()).bool,
  linkCount: (external_prop_types_default()).number,
  filter: (external_prop_types_default()).array,
  onCitationClick: (external_prop_types_default()).func,
  onSegmentClick: (external_prop_types_default()).func,
  onFootnoteClick: (external_prop_types_default()).func,
  onNamedEntityClick: (external_prop_types_default()).func,
  unsetTextHighlight: (external_prop_types_default()).func
};
/* harmony default export */ const js_TextRange = (TextRange);
;// CONCATENATED MODULE: ../static/js/TextColumn.jsx
function TextColumn_typeof(obj) { "@babel/helpers - typeof"; return TextColumn_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, TextColumn_typeof(obj); }
function TextColumn_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function TextColumn_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, TextColumn_toPropertyKey(descriptor.key), descriptor); } }
function TextColumn_createClass(Constructor, protoProps, staticProps) { if (protoProps) TextColumn_defineProperties(Constructor.prototype, protoProps); if (staticProps) TextColumn_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function TextColumn_toPropertyKey(arg) { var key = TextColumn_toPrimitive(arg, "string"); return TextColumn_typeof(key) === "symbol" ? key : String(key); }
function TextColumn_toPrimitive(input, hint) { if (TextColumn_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (TextColumn_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function TextColumn_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) TextColumn_setPrototypeOf(subClass, superClass); }
function TextColumn_setPrototypeOf(o, p) { TextColumn_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return TextColumn_setPrototypeOf(o, p); }
function TextColumn_createSuper(Derived) { var hasNativeReflectConstruct = TextColumn_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = TextColumn_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = TextColumn_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return TextColumn_possibleConstructorReturn(this, result); }; }
function TextColumn_possibleConstructorReturn(self, call) { if (call && (TextColumn_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return TextColumn_assertThisInitialized(self); }
function TextColumn_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function TextColumn_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function TextColumn_getPrototypeOf(o) { TextColumn_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return TextColumn_getPrototypeOf(o); }










var TextColumn = /*#__PURE__*/function (_Component) {
  TextColumn_inherits(TextColumn, _Component);
  var _super = TextColumn_createSuper(TextColumn);
  // An infinitely scrollable column of text, composed of TextRanges for each section.
  function TextColumn(props) {
    var _this;
    TextColumn_classCallCheck(this, TextColumn);
    _this = _super.call(this, props);
    _this.state = {
      showScrollPlaceholders: false
    };
    _this.debouncedAdjustHighlightedAndVisible = sefaria.util.debounce(_this.adjustHighlightedAndVisible, 100);
    _this.scrollPlaceholderHeight = 90;
    _this.scrollPlaceholderMargin = 30;
    _this.highlightThreshhold = props.multiPanel ? 140 : 70;
    return _this;
  }
  TextColumn_createClass(TextColumn, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this._isMounted = true;
      this.node = external_react_dom_default().findDOMNode(this);
      this.$container = sefariaJquery(this.node);
      this.initialScrollTopSet = false;
      this.windowMiddle = sefariaJquery(window).outerHeight() / (this.props.mode === "TextAndConnections" ? 4 : 2);

      // Set on mount, so placeholders aren't rendered server side to prevent intial layout shift
      this.setState({
        showScrollPlaceholders: true
      });
      var params = {
        content_type: sefaria.index(this.props.bookTitle).primary_category,
        item_id: this.props.bookTitle
      };
      console.log(params);
      gtag("event", "select_content", params);
      this.node.addEventListener("scroll", this.handleScroll);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this._isMounted = false;
      this.node.removeEventListener("scroll", this.handleScroll);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      var _this2 = this;
      var layoutWidth = this.$container.find(".textInner").width();
      var layoutWidthChanged = this.prevLayoutWidth && this.prevLayoutWidth !== layoutWidth;
      this.prevLayoutWidth = layoutWidth;
      if (prevProps.mode === "Text" && this.props.mode === "TextAndConnections") {
        // When opening mobile connections panel, scroll to highlighted
        // console.log("scroll to highlight for mobile connections open")
        this.scrollToHighlighted();
      } else if (this.state.showScrollPlaceholders && !prevState.showScrollPlaceholders && !this.initialScrollTopSet) {
        // After scroll placeholders are first rendered, scroll down so top placeholder
        // is out of view and scrolling up is possible.
        // console.log("scrolling for ScrollPlaceholders first render")
        this.setInitialScrollPosition();
      } else if (this.props.srefs.length === 1 && sefaria.util.inArray(this.props.srefs[0], prevProps.srefs) === -1 && !prevProps.srefs.some(function (r) {
        return sefaria.refContains(_this2.props.srefs[0], r);
      })) {
        // If we are switching to a single ref not in the current TextColumn,
        // treat it as a fresh open.
        // console.log("setting initialScroll for brand new ref")
        this.setInitialScrollPosition();
      } else if (prevProps.srefs.length === this.props.srefs.length && !prevProps.srefs.compare(this.props.srefs)) {
        // When the highlighted segment has changed, scroll to it.
        // refs length should be equal so as not to scroll when infinite scroll changes refs
        this.scrollToHighlighted();
      } else if (this.props.settings.language !== prevProps.settings.language || prevProps.currVersions.en !== this.props.currVersions.en || prevProps.currVersions.he !== this.props.currVersions.he) {
        // When the content the changes but we are anchored on a line, scroll to it
        // console.log("scroll to highlighted on text content change")
        this.scrollToHighlighted();
      } else if (layoutWidthChanged) {
        // When the width of the text column changes, keep highlighted text in place
        // console.log("restore scroll by percentage for layout Width Change")
        this.restoreScrollPositionByPercentage();
      }
    }
  }, {
    key: "handleScroll",
    value: function handleScroll(event) {
      // console.log("scroll");
      if (this.justScrolled) {
        // console.log("passed scroll");
        this.justScrolled = false;
        return;
      }
      // console.log("handled Scroll");
      this.debouncedAdjustHighlightedAndVisible();
      this.adjustInfiniteScroll();
    }
  }, {
    key: "calculatePositionWithinElement",
    value: function calculatePositionWithinElement(event) {
      var rect = event.target.getBoundingClientRect();
      var x = event.clientX - rect.left; //x position within the element.
      var y = event.clientY - rect.top; //y position within the element.
      return [x, y];
    }
  }, {
    key: "handleClick",
    value: function handleClick(event) {
      var pos = this.calculatePositionWithinElement(event);
      this.setState({
        lastClickXY: pos
      });
    }
  }, {
    key: "handleDoubleClick",
    value: function handleDoubleClick(event) {
      if (event.detail > 1) {
        var pos = this.calculatePositionWithinElement(event);
        // might be problematic if there is a slight move in the double-click shaky hands. can be fixed with an error of a few px on both axes.
        if (this.state.lastClickXY[0] !== pos[0] || this.state.lastClickXY[1] !== pos[1]) {
          event.preventDefault();
        }
      }
    }
  }, {
    key: "handleTextSelection",
    value: function handleTextSelection() {
      //Please note that because this function is triggered by an event listener on the document object, that will always be the event target
      // (should someone choose to add reference to the event itself in the future in this function) and not a more specific element.
      var selection = window.getSelection();
      var refs = [];
      if (selection.type === "Range") {
        //console.log("handling range");
        var $start = sefariaJquery(sefaria.util.getSelectionBoundaryElement(true)).closest(".segment");
        var $end = sefariaJquery(sefaria.util.getSelectionBoundaryElement(false)).closest(".segment");
        var $segments = this.$container.find(".segment");
        var start = $segments.index($start);
        var end = $segments.index($end);
        //if one of the endpoints isn't actually in a segment node (for example its in a title), adjust selection endpoints
        start = start === -1 ? end : start;
        end = end === -1 ? start : end;
        $segments = $segments.slice(start, end + 1);
        $segments.each(function () {
          refs.push(sefariaJquery(this).attr("data-ref"));
        });

        //console.log("Setting highlights by Text Selection");
        //console.log(refs);
        if (refs.length > 0) {
          this.props.setTextListHighlight(refs);
        }
      }
      //const selectedWords = selection.toString(); //this doesnt work in Chrome, as it does not skip elements marked with css `user-select: none` as it should.
      var selectedWords = sefaria.util.getNormalizedSelectionString(); //this gets around the above issue
      if (selectedWords !== this.props.selectedWords) {
        //console.log("setting selecting words")
        this.props.setSelectedWords(selectedWords);
      }
    }
  }, {
    key: "handleTextLoad",
    value: function handleTextLoad(ref) {
      // TextRanges in the column may be initial rendered in "loading" state without data.
      // When the data loads we may need to change scroll position or render addition ranges.
      // console.log("handle text load: ", ref);
      if (this.$container.find(".basetext.loading").length) {
        // Don't mess with scroll positions until all sections of text have loaded,
        // prevent race conditions when mutliple section may load out of order.
        return;
      }
      if (!this.initialScrollTopSet) {
        this.setInitialScrollPosition();
        this.initialScrollTopSet = true;
      }

      // When content loads check if we already need to load another section below, which
      // occurs when the loaded section is very short and whitespace is already visible below it.
      // Only check down, a text load should never trigger an infinite scroll up
      // console.log("Checking infinite scroll down");
      this.adjustInfiniteScroll(true);
      if (this.loadingContentAtTop) {
        // If the text that was just loaded was at the top of the page, restore the scroll
        // position to keep what the user was looking at in place.
        this.restoreScrollPositionAfterTopLoad();
      }
      var $texts = this.$container.find(".basetext");
      if ($texts.length == 1) {
        this.scrollToHighlighted();
      }
    }
  }, {
    key: "setInitialScrollPosition",
    value: function setInitialScrollPosition() {
      // Sets scroll initial scroll position when a text is loaded which is either down to
      // the highlighted segments, or is just down far enough to hide the scroll placeholder above.

      if (this.node.scrollHeight < this.node.clientHeight) {
        return;
      }
      if (this.$container.find(".segment.invisibleHighlight").length) {
        // If there is a highlight the initial position scrolls to it.
        this.scrollToHighlighted();
      } else {
        // When a text is first loaded, scroll it down a small amount so that it is
        // possible to scroll up and trigginer infinites scroll up. This also hides
        // "Loading..." div which sit above the text.
        var top = this.scrollPlaceholderHeight;
        // console.log("set Initial Scroll Postion: ", top);
        this.setScrollTop(top);
      }
    }
  }, {
    key: "scrollToHighlighted",
    value: function scrollToHighlighted() {
      // Scroll to the first highlighted segment
      if (!this._isMounted) {
        return;
      }
      var $container = this.$container;
      var $readerPanel = $container.closest(".readerPanel");
      var $highlighted = $container.find(".segment.invisibleHighlight").first();
      if ($highlighted.length) {
        var adjust = this.scrollPlaceholderHeight + this.scrollPlaceholderMargin;
        var top = $highlighted.position().top + adjust - this.highlightThreshhold;
        top = top > this.scrollPlaceholderHeight ? top : this.scrollPlaceholderHeight;
        this.setScrollTop(top);
        // console.log("scroll to highlighted: ", top);
        if ($readerPanel.attr("id") == sefariaJquery(".readerPanel:last").attr("id")) {
          $highlighted.focus();
        }
      }
    }
  }, {
    key: "restoreScrollPositionAfterTopLoad",
    value: function restoreScrollPositionAfterTopLoad() {
      // After one or more new TextRanges have just loaded in the first position, scroll
      // down to the TextRange that was visible before, so the TextColumn doesn't jump.
      // console.log("checking restore scroll after up");
      var $texts = this.$container.find(".basetext");
      if ($texts.length < 2 || $texts.eq(0).hasClass("loading")) {
        return;
      }
      this.loadingContentAtTop = false;
      var targetTop = $texts.eq(this.numSectionsLoadedAtTop).position().top;
      var adjust = this.scrollPlaceholderHeight + this.scrollPlaceholderMargin;
      var top = targetTop + 2 * this.node.scrollTop - adjust;
      this.setScrollTop(top);
      // console.log("scroll to restore after infinite up: " + top)
    }
  }, {
    key: "restoreScrollPositionByPercentage",
    value: function restoreScrollPositionByPercentage() {
      // After the layout width of the column changes, restore the scroll to the same percentage
      // of it's scroll position it had before. This approximates keeping the currently visible
      // content in place, even thought its scroll position has changed due to the new layout.
      if (!this.prevScrollPercentage) {
        return;
      }
      var target = this.node.scrollHeight * this.prevScrollPercentage;
      this.setScrollTop(target);
    }
  }, {
    key: "setScrollTop",
    value: function setScrollTop(top) {
      // Set the scroll top of the column, including the flag to prevent extra handling
      // of scroll event.
      this.justScrolled = true;
      this.node.scrollTop = top;
    }
  }, {
    key: "adjustInfiniteScroll",
    value: function adjustInfiniteScroll() {
      var downOnly = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      // Add or remove TextRanges from the top or bottom, depending on scroll position
      // console.log("adjust Infinite Scroll");
      if (!this._isMounted) {
        return;
      }
      if (this.node.scrollHeight <= this.node.clientHeight) {
        return;
      }
      var $node = this.$container;
      var refs = this.props.srefs.slice();
      var $lastText = $node.find(".textRange.basetext").last();
      if (!$lastText.length) {
        console.log("no last basetext");
        return;
      }
      var lastTop = $lastText.position().top;
      var lastBottom = lastTop + $lastText.outerHeight();
      var windowHeight = $node.outerHeight();
      var windowTop = this.node.scrollTop;
      var data;
      if (windowTop < 75 && !this.loadingContentAtTop && !downOnly) {
        // UP: add the previous section above then adjust scroll position so page doesn't jump
        // console.log("Inifite Scroll UP");
        var topRef = refs[0];
        data = sefaria.ref(topRef); // data for current ref
        if (data && data.prev) {
          refs.splice(refs, 0, data.prev); // Splice in at least the previous one (-1)
          this.numSectionsLoadedAtTop = 1;
          var prevData, earlierData;

          // Now, only add sources if we have data for them
          if (prevData = sefaria.ref(data.prev)) {
            earlierData = sefaria.ref(prevData.prev);
          }
          while (earlierData && this.numSectionsLoadedAtTop < 10) {
            refs.splice(refs, 0, earlierData.ref);
            this.numSectionsLoadedAtTop += 1;
            earlierData = sefaria.ref(earlierData.prev);
          }

          //console.log("Up! Add previous section. Windowtop is: " + windowTop);
          this.loadingContentAtTop = true;
          this.props.updateTextColumn(refs);
        }
      } else if (lastBottom < windowHeight + 80) {
        // DOWN: add the next section to bottom
        if ($lastText.hasClass("loading")) {
          //console.log("last text is loading - don't add next section");
          return;
        }
        //console.log("Down! Add next section");
        var currentRef = refs.slice(-1)[0];
        data = sefaria.ref(currentRef);
        if (data && data.next) {
          refs.push(data.next); // Append at least the next one
          var numSectionsAddToBottom = 1;
          var nextData, laterData;

          // Now, only add sources if we have data for them
          if (nextData = sefaria.ref(data.next)) {
            laterData = sefaria.ref(nextData.next);
          }
          while (laterData && numSectionsAddToBottom < 10) {
            refs.push(laterData.ref);
            laterData = sefaria.ref(laterData.next);
            numSectionsAddToBottom += 1;
          }
          this.props.updateTextColumn(refs);
        }
      }
    }
  }, {
    key: "adjustHighlightedAndVisible",
    value: function adjustHighlightedAndVisible() {
      //console.log("adjustHighlightedAndVisible");
      // Adjust which ref is currently consider visible for header and URL,
      // and while the TextList is open, update which segment should be highlighted.
      // Keeping the highlightedRefs value in the panel ensures it will return
      // to the right location after closing other panels.
      if (!this._isMounted) {
        return;
      }
      this.prevScrollPercentage = this.node.scrollTop / this.node.scrollHeight;

      // When using tab to navigate (i.e. a11y) set ref to currently focused ref
      var $segment = null;
      if (sefariaJquery("body").hasClass("user-is-tabbing") && sefariaJquery(".segment:focus").length > 0) {
        $segment = sefariaJquery(".segment:focus").eq(0);
      } else {
        var $container = this.$container;
        $container.find(".basetext .segment").each(function (i, segment) {
          var top = sefariaJquery(segment).offset().top - $container.offset().top;
          var bottom = sefariaJquery(segment).outerHeight() + top;
          if (bottom > this.windowMiddle || top >= this.highlightThreshhold) {
            $segment = sefariaJquery(segment);
            return false;
          }
        }.bind(this));
      }
      if (!$segment) {
        return;
      }
      var $section = $segment.closest(".textRange");
      var sectionRef = $section.attr("data-ref");
      this.props.setCurrentlyVisibleRef(sectionRef);

      // don't move around highlighted segment when scrolling a single panel,
      var shouldShowHighlight = this.props.hasSidebar || this.props.mode === "TextAndConnections";
      var ref = $segment.attr("data-ref");
      this.props.setTextListHighlight(ref, shouldShowHighlight);
    }
  }, {
    key: "render",
    value: function render() {
      var _this3 = this;
      var classes = external_classnames_default()({
        textColumn: 1,
        connectionsOpen: this.props.mode === "TextAndConnections"
      });
      var index = sefaria.index(sefaria.parseRef(this.props.srefs[0]).index);
      var isDictionary = index && index.categories[0] === "Reference";
      var content = this.props.srefs.map(function (sref) {
        var oref = sefaria.getRefFromCache(sref);
        var isCurrentlyVisible = oref && _this3.props.currentlyVisibleRef === oref.sectionRef;
        return /*#__PURE__*/external_react_default().createElement(js_TextRange, {
          panelPosition: _this3.props.panelPosition,
          sref: sref,
          isCurrentlyVisible: isCurrentlyVisible,
          currVersions: _this3.props.currVersions,
          highlightedRefs: _this3.props.highlightedRefs,
          showHighlight: _this3.props.showHighlight,
          textHighlights: _this3.props.textHighlights,
          hideTitle: isDictionary,
          basetext: true,
          withContext: true,
          loadLinks: true,
          prefetchNextPrev: true,
          prefetchMultiple: isDictionary ? 20 : 0,
          showParashahHeaders: true,
          settings: _this3.props.settings,
          setOption: _this3.props.setOption,
          showBaseText: _this3.props.showBaseText,
          onSegmentClick: _this3.props.onSegmentClick,
          onCitationClick: _this3.props.onCitationClick,
          onNamedEntityClick: _this3.props.onNamedEntityClick,
          onTextLoad: _this3.handleTextLoad,
          filter: _this3.props.filter,
          panelsOpen: _this3.props.panelsOpen,
          layoutWidth: _this3.props.layoutWidth,
          unsetTextHighlight: _this3.props.unsetTextHighlight,
          translationLanguagePreference: _this3.props.translationLanguagePreference,
          updateCurrVersionsToMatchAPIResult: _this3.props.updateCurrVersionsToMatchAPIResult,
          key: sref
        });
      });
      var pre, post, bookTitle;
      if (content.length) {
        // Add Next and Previous loading indicators
        var first = sefaria.ref(this.props.srefs[0]);
        var last = sefaria.ref(this.props.srefs.slice(-1)[0]);
        var hasPrev = first && first.prev;
        var noPrev = first && !first.prev; // first is loaded, so we actually know there's nothing prev
        var hasNext = last && last.next;
        bookTitle = noPrev ? /*#__PURE__*/external_react_default().createElement("div", {
          className: "bookMetaDataBox",
          key: "bookTitle"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "title",
          role: "heading",
          "aria-level": "1"
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: this.props.bookTitle,
            he: this.props.heBookTitle
          },
          defaultToInterfaceOnBilingual: true
        }))) : null;
        pre = this.state.showScrollPlaceholders ? noPrev ? bookTitle : /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
          className: "base prev",
          key: "prev"
        }) : null;
        post = hasNext && this.state.showScrollPlaceholders ? /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
          className: "base next",
          key: "next"
        }) : /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
          message: " ",
          heMessage: " ",
          className: "base next final",
          key: "next"
        });
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes,
        onMouseUp: this.handleTextSelection,
        onClick: this.handleClick,
        onMouseDown: this.handleDoubleClick
      }, pre, content, post);
    }
  }]);
  return TextColumn;
}((external_react_class_default()));
TextColumn.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  currVersions: (external_prop_types_default()).object.isRequired,
  highlightedRefs: (external_prop_types_default()).array,
  basetext: (external_prop_types_default()).bool,
  withContext: (external_prop_types_default()).bool,
  loadLinks: (external_prop_types_default()).bool,
  prefetchNextPrev: (external_prop_types_default()).bool,
  openOnClick: (external_prop_types_default()).bool,
  lowlight: (external_prop_types_default()).bool,
  multiPanel: (external_prop_types_default()).bool,
  mode: (external_prop_types_default()).string,
  settings: (external_prop_types_default()).object,
  interfaceLang: (external_prop_types_default()).string,
  showBaseText: (external_prop_types_default()).func,
  updateTextColumn: (external_prop_types_default()).func,
  onSegmentClick: (external_prop_types_default()).func,
  onCitationClick: (external_prop_types_default()).func,
  onNamedEntityClick: (external_prop_types_default()).func,
  setTextListHighlight: (external_prop_types_default()).func,
  setCurrentlyVisibleRef: (external_prop_types_default()).func,
  setSelectedWords: (external_prop_types_default()).func,
  onTextLoad: (external_prop_types_default()).func,
  panelsOpen: (external_prop_types_default()).number,
  hasSidebar: (external_prop_types_default()).bool,
  textHighlights: (external_prop_types_default()).array,
  unsetTextHighlight: (external_prop_types_default()).func,
  translationLanguagePreference: (external_prop_types_default()).string
};
/* harmony default export */ const js_TextColumn = (TextColumn);
;// CONCATENATED MODULE: ../static/js/ComparePanelHeader.jsx
function ComparePanelHeader_slicedToArray(arr, i) { return ComparePanelHeader_arrayWithHoles(arr) || ComparePanelHeader_iterableToArrayLimit(arr, i) || ComparePanelHeader_unsupportedIterableToArray(arr, i) || ComparePanelHeader_nonIterableRest(); }
function ComparePanelHeader_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function ComparePanelHeader_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return ComparePanelHeader_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return ComparePanelHeader_arrayLikeToArray(o, minLen); }
function ComparePanelHeader_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function ComparePanelHeader_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function ComparePanelHeader_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }






var ComparePanelHeader = function ComparePanelHeader(_ref) {
  var search = _ref.search,
    category = _ref.category,
    openDisplaySettings = _ref.openDisplaySettings,
    navHome = _ref.navHome,
    catTitle = _ref.catTitle,
    heCatTitle = _ref.heCatTitle,
    onBack = _ref.onBack,
    openSearch = _ref.openSearch;
  if (search) {
    var _React$useState = external_react_default().useState(""),
      _React$useState2 = ComparePanelHeader_slicedToArray(_React$useState, 2),
      query = _React$useState2[0],
      setQuery = _React$useState2[1];
    var handleSearchKeyUp = function handleSearchKeyUp(event) {
      if (event.keyCode === 13 && query) {
        openSearch(query);
      }
    };
    var handleSearchButtonClick = function handleSearchButtonClick() {
      if (query) {
        openSearch(query);
      }
    };
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "readerNavTop search"
    }, /*#__PURE__*/external_react_default().createElement(CategoryColorLine, {
      category: "System"
    }), /*#__PURE__*/external_react_default().createElement("div", {
      className: "readerNavTopStart"
    }, /*#__PURE__*/external_react_default().createElement(MenuButton, {
      onClick: onBack,
      compare: true
    }), /*#__PURE__*/external_react_default().createElement("div", {
      className: "searchBox"
    }, /*#__PURE__*/external_react_default().createElement(SearchButton, {
      onClick: handleSearchButtonClick
    }), /*#__PURE__*/external_react_default().createElement("input", {
      id: "searchInput",
      className: "readerSearch",
      title: sefaria._("Search for Texts or Keywords Here"),
      placeholder: sefaria._("Search"),
      onChange: function onChange(e) {
        return setQuery(e.target.value);
      },
      value: query,
      onKeyUp: handleSearchKeyUp
    }))), sefaria.interfaceLang !== "hebrew" ? /*#__PURE__*/external_react_default().createElement(DisplaySettingsButton, {
      onClick: openDisplaySettings
    }) : null);
  } else {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: external_classnames_default()({
        readerNavTop: 1,
        searchOnly: 1
      })
    }, /*#__PURE__*/external_react_default().createElement(CategoryColorLine, {
      category: category
    }), /*#__PURE__*/external_react_default().createElement(MenuButton, {
      onClick: onBack,
      compare: true
    }), /*#__PURE__*/external_react_default().createElement("h2", {
      className: "readerNavTopCategory"
    }, /*#__PURE__*/external_react_default().createElement(ContentText, {
      text: {
        en: catTitle,
        he: heCatTitle
      }
    })), sefaria.interfaceLang === "hebrew" || !openDisplaySettings ? /*#__PURE__*/external_react_default().createElement(DisplaySettingsButton, {
      placeholder: true
    }) : /*#__PURE__*/external_react_default().createElement(DisplaySettingsButton, {
      onClick: openDisplaySettings
    }));
  }
};
/* harmony default export */ const js_ComparePanelHeader = (ComparePanelHeader);
;// CONCATENATED MODULE: ../static/js/TextCategoryPage.jsx
function TextCategoryPage_slicedToArray(arr, i) { return TextCategoryPage_arrayWithHoles(arr) || TextCategoryPage_iterableToArrayLimit(arr, i) || TextCategoryPage_unsupportedIterableToArray(arr, i) || TextCategoryPage_nonIterableRest(); }
function TextCategoryPage_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function TextCategoryPage_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function TextCategoryPage_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function TextCategoryPage_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = TextCategoryPage_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function TextCategoryPage_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return TextCategoryPage_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TextCategoryPage_arrayLikeToArray(o, minLen); }
function TextCategoryPage_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }











// Navigation Menu for a single category of texts (e.g., "Tanakh", "Bavli")
var TextCategoryPage = function TextCategoryPage(_ref) {
  var category = _ref.category,
    categories = _ref.categories,
    setCategories = _ref.setCategories,
    toggleLanguage = _ref.toggleLanguage,
    openDisplaySettings = _ref.openDisplaySettings,
    onCompareBack = _ref.onCompareBack,
    openTextTOC = _ref.openTextTOC,
    multiPanel = _ref.multiPanel,
    initialWidth = _ref.initialWidth,
    compare = _ref.compare;
  var contentLang = (0,external_react_.useContext)(ContentLanguageContext).language;
  // Show Talmud with Toggles
  var cats = categories[0] === "Talmud" && categories.length === 1 ? ["Talmud", "Bavli"] : categories[0] === "Tosefta" && categories.length === 1 ? ["Tosefta", "Vilna Edition"] : categories;
  var aboutCats = categories[0] === "Talmud" && categories.length === 2 ? ["Talmud"] : categories;
  var catTitle = '',
    heCatTitle = '';
  if ((cats[0] === "Talmud" || cats[0] === "Tosefta") && cats.length === 2) {
    category = cats[0];
    catTitle = cats[0];
    heCatTitle = sefaria.hebrewTerm(cats[0]);
  } else {
    if (category === "Commentary") {
      var onCat = cats.slice(-2)[0];
      catTitle = onCat + " Commentary";
      heCatTitle = sefaria.hebrewTerm(onCat) + " " + sefaria.hebrewTerm("Commentary");
    } else {
      catTitle = category;
      heCatTitle = sefaria.hebrewTerm(category);
    }
  }
  var tocObject = sefaria.tocObjectByCategories(cats);
  var catContents = sefaria.tocItemsByCategories(cats);
  var nestLevel = category === "Commentary" ? 1 : 0;
  var aboutModule = [multiPanel ? {
    type: "AboutTextCategory",
    props: {
      cats: aboutCats
    }
  } : {
    type: null
  }];
  var sidebarModules = aboutModule.concat(getSidebarModules(cats));
  var categoryToggle = /*#__PURE__*/external_react_default().createElement(SubCategoryToggle, {
    categories: cats,
    setCategories: setCategories
  });
  var title = compare ? categoryToggle : /*#__PURE__*/external_react_default().createElement("div", {
    className: "navTitle"
  }, /*#__PURE__*/external_react_default().createElement(CategoryHeader, {
    data: cats,
    type: "cats"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(ContentText, {
    text: {
      en: catTitle,
      he: heCatTitle
    },
    defaultToInterfaceOnBilingual: true
  }))), categoryToggle, multiPanel && sefaria.interfaceLang !== "hebrew" && sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement(LanguageToggleButton, {
    toggleLanguage: toggleLanguage
  }) : null);
  var comparePanelHeader = compare ? /*#__PURE__*/external_react_default().createElement(js_ComparePanelHeader, {
    category: cats[0],
    openDisplaySettings: openDisplaySettings,
    onBack: function onBack() {
      return setCategories(aboutCats.slice(0, -1));
    },
    catTitle: catTitle,
    heCatTitle: heCatTitle
  }) : null;
  var footer = compare ? null : /*#__PURE__*/external_react_default().createElement(js_Footer, null);
  var navMenuClasses = external_classnames_default()({
    readerNavCategoryMenu: 1,
    readerNavMenu: 1,
    noLangToggleInHebrew: 1,
    compare: compare
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: navMenuClasses
  }, /*#__PURE__*/external_react_default().createElement(CategoryColorLine, {
    category: categories[0]
  }), comparePanelHeader, /*#__PURE__*/external_react_default().createElement("div", {
    className: "content"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sidebarLayout"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "contentInner followsContentLang"
  }, title, !multiPanel ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "categoryDescription top sans-serif"
  }, /*#__PURE__*/external_react_default().createElement(ContentText, {
    text: {
      en: tocObject.enDesc,
      he: tocObject.heDesc
    },
    defaultToInterfaceOnBilingual: true
  })) : null, /*#__PURE__*/external_react_default().createElement(CategoryAttribution, {
    categories: cats,
    asEdition: true
  }), /*#__PURE__*/external_react_default().createElement(TextCategoryContents, {
    contents: catContents,
    categories: cats,
    category: category,
    setCategories: setCategories,
    openTextTOC: openTextTOC,
    initialWidth: initialWidth,
    nestLevel: nestLevel
  })), !compare ? /*#__PURE__*/external_react_default().createElement(NavSidebar, {
    modules: sidebarModules
  }) : null), footer));
};
TextCategoryPage.propTypes = {
  category: (external_prop_types_default()).string.isRequired,
  categories: (external_prop_types_default()).array.isRequired,
  setCategories: (external_prop_types_default()).func.isRequired,
  toggleLanguage: (external_prop_types_default()).func.isRequired,
  openDisplaySettings: (external_prop_types_default()).func.isRequired,
  initialWidth: (external_prop_types_default()).number,
  compare: (external_prop_types_default()).bool
};

// Recursive content of text category listing (including category title and lists of texts/subcategories)
var TextCategoryContents = function TextCategoryContents(_ref2) {
  var category = _ref2.category,
    contents = _ref2.contents,
    categories = _ref2.categories,
    setCategories = _ref2.setCategories,
    openTextTOC = _ref2.openTextTOC,
    initialWidth = _ref2.initialWidth,
    nestLevel = _ref2.nestLevel;
  var content = [];
  var cats = categories || [];
  var contentLang = (0,external_react_.useContext)(ContentLanguageContext).language;
  var sortedContents = contentLang === "hebrew" ? hebrewContentSort(contents) : contents;
  var _iterator = TextCategoryPage_createForOfIteratorHelper(sortedContents),
    _step;
  try {
    var _loop = function _loop() {
      var item = _step.value;
      if (item.category) {
        // Category
        var newCats = cats.concat(item.category);

        // Special Case categories which should nest but normally wouldn't given their depth   ["Mishneh Torah", "Shulchan Arukh", "Tur"]
        if (item.isPrimary || nestLevel > 0) {
          // There's just one text in this category, render the text.
          if (item.contents && item.contents.length === 1 && !("category" in item.contents[0])) {
            var chItem = item.contents[0];
            if (chItem.hidden) {
              return "continue";
            }
            var onClick = function onClick(e) {
              if (openTextTOC) {
                e.preventDefault();
                openTextTOC(chItem.title);
              }
            };
            content.push( /*#__PURE__*/external_react_default().createElement(TextMenuItem, {
              item: chItem,
              categories: categories,
              onClick: onClick,
              nestLevel: nestLevel
            }));

            // Create a link to a subcategory
          } else {
            content.push( /*#__PURE__*/external_react_default().createElement(MenuItem, {
              href: "/texts/" + newCats.join("/"),
              onClick: function onClick(e) {
                e.preventDefault();
                setCategories(newCats);
              },
              cats: newCats,
              title: item.category,
              heTitle: item.heCategory,
              enDesc: item.enShortDesc,
              heDesc: item.heShortDesc
            }));
          }

          // Add a nested subcategory
        } else {
          var shortDesc = contentLang === "hebrew" ? item.heShortDesc : item.enShortDesc;
          var hasDesc = !!shortDesc;
          var longDesc = hasDesc && shortDesc.split(" ").length > 5;
          shortDesc = hasDesc && !longDesc ? "(".concat(shortDesc, ")") : shortDesc;
          content.push( /*#__PURE__*/external_react_default().createElement("div", {
            className: "category",
            key: "cat." + nestLevel + "." + item.category
          }, /*#__PURE__*/external_react_default().createElement(CategoryHeader, {
            data: newCats,
            type: "cats"
          }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement(ContentText, {
            text: {
              en: item.category,
              he: item.heCategory
            },
            defaultToInterfaceOnBilingual: true
          }), hasDesc && !longDesc ? /*#__PURE__*/external_react_default().createElement("span", {
            className: "categoryDescription"
          }, /*#__PURE__*/external_react_default().createElement(ContentText, {
            text: {
              en: shortDesc,
              he: shortDesc
            },
            defaultToInterfaceOnBilingual: true
          })) : null)), hasDesc && longDesc ? /*#__PURE__*/external_react_default().createElement("div", {
            className: "categoryDescription long sans-serif"
          }, /*#__PURE__*/external_react_default().createElement(ContentText, {
            text: {
              en: shortDesc,
              he: shortDesc
            },
            defaultToInterfaceOnBilingual: true
          })) : null, /*#__PURE__*/external_react_default().createElement(TextCategoryContents, {
            contents: item.contents,
            categories: newCats,
            category: item.category,
            setCategories: setCategories,
            openTextTOC: openTextTOC,
            initialWidth: initialWidth,
            nestLevel: nestLevel + 1
          })));
        }

        // Add a Collection
      } else if (item.isCollection) {
        content.push( /*#__PURE__*/external_react_default().createElement(MenuItem, {
          href: "/collections/" + item.slug,
          nestLevel: nestLevel,
          title: item.title,
          heTitle: item.heTitle,
          enDesc: item.enShortDesc,
          heDesc: item.heShortDesc
        }));

        // Skip hidden texts
      } else if (item.hidden) {
        return "continue"; // Add a Text
      } else {
        var _onClick = function _onClick(e) {
          if (openTextTOC) {
            e.preventDefault();
            openTextTOC(item.title);
          }
        };
        content.push( /*#__PURE__*/external_react_default().createElement(TextMenuItem, {
          item: item,
          categories: categories,
          onClick: _onClick,
          nestLevel: nestLevel
        }));
      }
    };
    for (_iterator.s(); !(_step = _iterator.n()).done;) {
      var _ret = _loop();
      if (_ret === "continue") continue;
    }
  } catch (err) {
    _iterator.e(err);
  } finally {
    _iterator.f();
  }
  var boxedContent = [];
  var currentRun = [];
  var i;
  for (i = 0; i < content.length; i++) {
    // Walk through content looking for runs of texts/subcats to group together into a table
    if (content[i].type === "div") {
      // this is a subcategory
      if (currentRun.length) {
        boxedContent.push( /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
          content: currentRun,
          intialWidth: initialWidth,
          key: i
        }));
        currentRun = [];
      }
      boxedContent.push(content[i]);
    } else {
      // this is a single text
      currentRun.push(content[i]);
    }
  }
  if (currentRun.length) {
    boxedContent.push( /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
      content: currentRun,
      initialWidth: initialWidth,
      key: i
    }));
  }
  return /*#__PURE__*/external_react_default().createElement("div", null, boxedContent);
};
TextCategoryContents.propTypes = {
  category: (external_prop_types_default()).string.isRequired,
  contents: (external_prop_types_default()).array.isRequired,
  categories: (external_prop_types_default()).array.isRequired,
  initialWidth: (external_prop_types_default()).number,
  nestLevel: (external_prop_types_default()).number
};
TextCategoryContents.defaultProps = {
  contents: []
};
var MenuItem = function MenuItem(_ref3) {
  var href = _ref3.href,
    nestLevel = _ref3.nestLevel,
    title = _ref3.title,
    heTitle = _ref3.heTitle,
    cats = _ref3.cats,
    onClick = _ref3.onClick,
    enDesc = _ref3.enDesc,
    heDesc = _ref3.heDesc;
  var keytype = !!cats ? "cat" : "text";
  var classes = external_classnames_default()({
    navBlockTitle: 1
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "navBlock"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: href,
    className: classes,
    onClick: onClick,
    "data-cat": cats ? cats.slice(-1) : null // This is only used for Selenium test, would like to get rid of it
    ,
    key: keytype + "." + nestLevel + "." + title
  }, /*#__PURE__*/external_react_default().createElement(ContentText, {
    text: {
      en: title,
      he: heTitle
    }
  })), enDesc || heDesc ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "navBlockDescription"
  }, /*#__PURE__*/external_react_default().createElement(ContentText, {
    text: {
      en: enDesc,
      he: heDesc
    }
  })) : null);
};
var TextMenuItem = function TextMenuItem(_ref4) {
  var item = _ref4.item,
    categories = _ref4.categories,
    nestLevel = _ref4.nestLevel,
    onClick = _ref4.onClick;
  var _getRenderedTextTitle = getRenderedTextTitleString(item.title, item.heTitle, categories),
    _getRenderedTextTitle2 = TextCategoryPage_slicedToArray(_getRenderedTextTitle, 2),
    title = _getRenderedTextTitle2[0],
    heTitle = _getRenderedTextTitle2[1];
  return /*#__PURE__*/external_react_default().createElement(MenuItem, {
    href: "/" + sefaria.normRef(item.title),
    onClick: onClick,
    nestLevel: nestLevel,
    title: title,
    heTitle: heTitle,
    enDesc: item.enShortDesc,
    heDesc: item.heShortDesc
  });
};
var SubCategoryToggle = function SubCategoryToggle(_ref5) {
  var categories = _ref5.categories,
    setCategories = _ref5.setCategories;
  var toggleEnableMap = {
    "Talmud": {
      categoryPathDepth: 2,
      subCategories: ["Bavli", "Yerushalmi"],
      subCategoriesDisplay: [{
        en: "Babylonian",
        he: "בבלי"
      }, {
        en: "Jerusalem",
        he: "ירושלמי"
      }]
    },
    "Tosefta": {
      categoryPathDepth: 2,
      subCategories: ["Vilna Edition", "Lieberman Edition"],
      subCategoriesDisplay: [{
        en: "Vilna",
        he: "דפוס וילנא"
      }, {
        en: "Lieberman",
        he: "מהדורת ליברמן"
      }]
    }
  };
  if (!categories.length || !(categories[0] in toggleEnableMap) || categories.length !== toggleEnableMap[categories[0]]["categoryPathDepth"]) {
    return null;
  }
  var options = toggleEnableMap[categories[0]]["subCategories"].map(function (element, index) {
    var oClasses = external_classnames_default()({
      navToggle: 1,
      active: categories[1] === element
    });
    var toggleFunc = function toggleFunc() {
      return setCategories([categories[0], element]);
    }; //this may need some adjustment if there ever was another toggle not at dpeth 2
    return /*#__PURE__*/external_react_default().createElement("span", {
      className: oClasses,
      onClick: toggleFunc
    }, /*#__PURE__*/external_react_default().createElement(ContentText, {
      text: toggleEnableMap[categories[0]]["subCategoriesDisplay"][index]
    }));
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "navToggles"
  }, options);
};
var getRenderedTextTitleString = function getRenderedTextTitleString(title, heTitle, categories) {
  if (title === "Pesach Haggadah") {
    return ["Pesach Haggadah Ashkenaz", "הגדה של פסח אשכנז"];
  }

  // Don't remove category strings at the beginning of these titles
  var whiteList = ['Imrei Yosher on Ruth', 'Duties of the Heart (abridged)', 'Midrash Mishlei', 'Midrash Tehillim', 'Midrash Tanchuma', 'Midrash Aggadah', 'Pesach Haggadah Edot Hamizrah', "Baal HaSulam's Preface to Zohar", "Baal HaSulam's Introduction to Zohar", 'Zohar Chadash', 'Midrash Shmuel', 'Midrash Tannaim on Deuteronomy'];
  if (whiteList.indexOf(title) > -1 || categories.slice(-1)[0] === "Siddur") {
    return [title, heTitle];
  }
  var replaceTitles = {
    "en": ['Jerusalem Talmud', 'Tosefta Kifshutah'].concat(categories),
    "he": ['תלמוד ירושלמי', 'תוספתא כפשוטה'].concat(categories.map(sefaria.hebrewTerm))
  };
  var replaceOther = {
    "en": [", ", "; ", " on ", " to ", " of "],
    "he": [", ", " על "]
  };
  var replaceSuffixes = {
    "en": [" (Lieberman)"],
    "he": [" (ליברמן)"]
  };

  //this will replace a category name at the beginning of the title string and any connector strings (0 or 1) that follow.
  var titleRe = new RegExp("^(".concat(replaceTitles['en'].join("|"), ")(").concat(replaceOther['en'].join("|"), ")?"));
  var heTitleRe = new RegExp("^(".concat(replaceTitles['he'].join("|"), ")(").concat(replaceOther['he'].join("|"), ")?"));
  title = categories.indexOf(title) > -1 ? title : title.replace(titleRe, "");
  var heCategories = categories.map(function (c) {
    return sefaria.hebrewTerm(c);
  });
  heTitle = heCategories.indexOf(heTitle) > -1 ? heTitle : heTitle.replace(heTitleRe, "");

  //couldnt get this to work in one regex (eliminating both prefix stuff above and the suffix stuff below),
  // any engineer seeing this feel free to try and streamline
  var suffixTitleRe = new RegExp("(".concat(replaceSuffixes['en'].join("|").replace(/[()]/g, '\\$&'), ")$"));
  var suffixHeTitleRe = new RegExp("(".concat(replaceSuffixes['he'].join("|").replace(/[()]/g, '\\$&'), ")$"));
  title = title.replace(suffixTitleRe, "");
  heTitle = heTitle.replace(suffixHeTitleRe, "");
  return [title, heTitle];
};
var hebrewContentSort = function hebrewContentSort(enCats) {
  // Sorts contents of this category by Hebrew Alphabetical
  //console.log(cats);
  var heCats = enCats.slice().map(function (item, indx) {
    item.enOrder = indx;
    return item;
  });

  // If all of the cats have a base_text_order, don't re-sort.
  if (heCats.every(function (c) {
    return !!c.base_text_order;
  })) {
    return heCats;
  }
  heCats.sort(function (a, b) {
    if ("order" in a || "order" in b) {
      //positive order first, then no order, negative order last
      var aOrder = "order" in a ? -1 / a.order : 0;
      var bOrder = "order" in b ? -1 / b.order : 0;
      return aOrder > bOrder ? 1 : -1;
    } else if ("category" in a !== "category" in b) {
      return a.enOrder > b.enOrder ? 1 : -1;

      //} else if (a.heComplete !== b.heComplete) {
      //  return a.heComplete ? -1 : 1;
    } else if (a.heTitle && b.heTitle) {
      return a.heTitle > b.heTitle ? 1 : -1;
    }
    return a.enOrder > b.enOrder ? 1 : -1;
  });
  //console.log(heCats)
  return heCats;
};
var getSidebarModules = function getSidebarModules(categories) {
  var path = categories.join("|");
  var modules = {
    "Tanakh": [{
      type: "WeeklyTorahPortion"
    }],
    "Talmud|Bavli": [{
      type: "DafYomi"
    }]
  };
  var customModules = path in modules ? modules[path] : [];
  var defaultModules = [{
    type: "Promo"
  }, {
    type: "Visualizations",
    props: {
      categories: categories
    }
  }, {
    type: "SupportSefaria"
  }];
  return customModules.concat(defaultModules);
};
/* harmony default export */ const js_TextCategoryPage = (TextCategoryPage);
;// CONCATENATED MODULE: ../static/js/TextsPage.jsx
function TextsPage_slicedToArray(arr, i) { return TextsPage_arrayWithHoles(arr) || TextsPage_iterableToArrayLimit(arr, i) || TextsPage_unsupportedIterableToArray(arr, i) || TextsPage_nonIterableRest(); }
function TextsPage_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function TextsPage_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return TextsPage_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TextsPage_arrayLikeToArray(o, minLen); }
function TextsPage_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function TextsPage_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function TextsPage_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }











var TextsPage = function TextsPage(_ref) {
  var categories = _ref.categories,
    settings = _ref.settings,
    setCategories = _ref.setCategories,
    onCompareBack = _ref.onCompareBack,
    openSearch = _ref.openSearch,
    toggleLanguage = _ref.toggleLanguage,
    openTextTOC = _ref.openTextTOC,
    openDisplaySettings = _ref.openDisplaySettings,
    multiPanel = _ref.multiPanel,
    initialWidth = _ref.initialWidth,
    compare = _ref.compare;
  // List of Texts in a Category
  if (categories.length) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "readerNavMenu"
    }, /*#__PURE__*/external_react_default().createElement(js_TextCategoryPage, {
      categories: categories,
      category: categories.slice(-1)[0],
      setCategories: setCategories,
      openTextTOC: openTextTOC,
      toggleLanguage: toggleLanguage,
      openDisplaySettings: openDisplaySettings,
      compare: compare,
      multiPanel: multiPanel,
      initialWidth: initialWidth
    }));
  }

  // Root Library Menu
  var categoryListings = sefaria.toc.map(function (cat) {
    var style = {
      "borderColor": sefaria.palette.categoryColor(cat.category)
    };
    var openCat = function openCat(e) {
      e.preventDefault();
      setCategories([cat.category]);
    };
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "navBlock withColorLine",
      style: style
    }, /*#__PURE__*/external_react_default().createElement("a", {
      href: "/texts/".concat(cat.category),
      className: "navBlockTitle",
      "data-cat": cat.category,
      onClick: openCat
    }, /*#__PURE__*/external_react_default().createElement(ContentText, {
      text: {
        en: cat.category,
        he: cat.heCategory
      },
      defaultToInterfaceOnBilingual: true
    })), /*#__PURE__*/external_react_default().createElement("div", {
      className: "navBlockDescription"
    }, /*#__PURE__*/external_react_default().createElement(ContentText, {
      text: {
        en: cat.enShortDesc,
        he: cat.heShortDesc
      },
      defaultToInterfaceOnBilingual: true
    })));
  });
  categoryListings = /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerNavCategories"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    content: categoryListings,
    initialWidth: initialWidth
  }));
  var comparePanelHeader = compare ? /*#__PURE__*/external_react_default().createElement(js_ComparePanelHeader, {
    search: true,
    onBack: onCompareBack,
    openDisplaySettings: openDisplaySettings,
    openSearch: openSearch
  }) : null;
  var title = compare ? null : /*#__PURE__*/external_react_default().createElement("div", {
    className: "navTitle tight sans-serif"
  }, /*#__PURE__*/external_react_default().createElement(CategoryHeader, {
    type: "cats",
    buttonsToDisplay: ["subcategory", "reorder"]
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Browse the Library"))), multiPanel && sefaria.interfaceLang !== "hebrew" && sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement(LanguageToggleButton, {
    toggleLanguage: toggleLanguage
  }) : null);
  var about = compare || multiPanel ? null : /*#__PURE__*/external_react_default().createElement(Modules, {
    type: "AboutSefaria",
    props: {
      hideTitle: true
    }
  });
  var dedication = sefaria._siteSettings.TORAH_SPECIFIC && !compare ? /*#__PURE__*/external_react_default().createElement(Dedication, null) : null;
  var libraryMessage = sefaria._siteSettings.LIBRARY_MESSAGE && !compare ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "libraryMessage",
    dangerouslySetInnerHTML: {
      __html: sefaria._siteSettings.LIBRARY_MESSAGE
    }
  }) : null;
  var sidebarModules = [multiPanel ? {
    type: "AboutSefaria"
  } : {
    type: null
  }, {
    type: "Promo"
  }, {
    type: "Translations"
  }, {
    type: "LearningSchedules"
  }, {
    type: "JoinTheCommunity"
  }, {
    type: "Resources"
  }];
  var footer = compare ? null : /*#__PURE__*/external_react_default().createElement(js_Footer, null);
  var classes = external_classnames_default()({
    readerNavMenu: 1,
    compare: compare,
    noLangToggleInHebrew: 1
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: classes,
    key: "0"
  }, comparePanelHeader, /*#__PURE__*/external_react_default().createElement("div", {
    className: "content"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sidebarLayout"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "contentInner"
  }, title, about, dedication, libraryMessage, categoryListings), !compare ? /*#__PURE__*/external_react_default().createElement(NavSidebar, {
    modules: sidebarModules
  }) : null), footer));
};
TextsPage.propTypes = {
  categories: (external_prop_types_default()).array.isRequired,
  settings: (external_prop_types_default()).object.isRequired,
  setCategories: (external_prop_types_default()).func.isRequired,
  openSearch: (external_prop_types_default()).func.isRequired,
  openDisplaySettings: (external_prop_types_default()).func,
  toggleLanguage: (external_prop_types_default()).func,
  multiPanel: (external_prop_types_default()).bool,
  compare: (external_prop_types_default()).bool
};
var Dedication = function Dedication() {
  //Get the local date 6 hours from now (so that dedication changes at 6pm local time
  var dedDate = new Date();
  dedDate.setHours(dedDate.getHours() + 6);
  var tzoffset = new Date().getTimezoneOffset() * 60000;
  var date = new Date(dedDate - tzoffset).toISOString().substring(0, 10);
  var _useState = (0,external_react_.useState)(sefaria._tableOfContentsDedications[date]),
    _useState2 = TextsPage_slicedToArray(_useState, 2),
    dedicationData = _useState2[0],
    setDedicationData = _useState2[1];
  function get_google_sheet_data() {
    var url = 'https://docs.google.com/spreadsheets/d/11c9Yw9FdfLnfbIWqvUztCt-QICW5790dfFGgXH7IB1k/edit#gid=0';
    var query = new google.visualization.Query(url);
    query.setQuery('select A, B, C');
    query.send(processSheetsData);
  }
  function processSheetsData(response) {
    var data = response.getDataTable();
    var columns = data.getNumberOfColumns();
    var rows = data.getNumberOfRows();
    for (var r = 0; r < rows; r++) {
      var row = [];
      for (var c = 0; c < columns; c++) {
        row.push(data.getFormattedValue(r, c));
      }
      sefaria._tableOfContentsDedications[row[0]] = {
        "en": row[1],
        "he": row[2]
      };
    }
    setDedicationData(sefaria._tableOfContentsDedications[date]);
  }
  (0,external_react_.useEffect)(function () {
    if (!dedicationData) {
      google.charts.load('current');
      google.charts.setOnLoadCallback(get_google_sheet_data);
    }
  }, []);
  return dedicationData && (dedicationData.en || dedicationData.he) ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "dedication"
  }, /*#__PURE__*/external_react_default().createElement("span", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    markdown: {
      en: dedicationData === null || dedicationData === void 0 ? void 0 : dedicationData.en,
      he: dedicationData === null || dedicationData === void 0 ? void 0 : dedicationData.he
    }
  }))) : null;
};
/* harmony default export */ const js_TextsPage = (TextsPage);
;// CONCATENATED MODULE: ../static/js/Media.jsx
function Media_typeof(obj) { "@babel/helpers - typeof"; return Media_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, Media_typeof(obj); }
function Media_slicedToArray(arr, i) { return Media_arrayWithHoles(arr) || Media_iterableToArrayLimit(arr, i) || Media_unsupportedIterableToArray(arr, i) || Media_nonIterableRest(); }
function Media_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function Media_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return Media_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return Media_arrayLikeToArray(o, minLen); }
function Media_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function Media_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function Media_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function Media_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function Media_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, Media_toPropertyKey(descriptor.key), descriptor); } }
function Media_createClass(Constructor, protoProps, staticProps) { if (protoProps) Media_defineProperties(Constructor.prototype, protoProps); if (staticProps) Media_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function Media_toPropertyKey(arg) { var key = Media_toPrimitive(arg, "string"); return Media_typeof(key) === "symbol" ? key : String(key); }
function Media_toPrimitive(input, hint) { if (Media_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (Media_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function Media_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) Media_setPrototypeOf(subClass, superClass); }
function Media_setPrototypeOf(o, p) { Media_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return Media_setPrototypeOf(o, p); }
function Media_createSuper(Derived) { var hasNativeReflectConstruct = Media_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = Media_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = Media_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return Media_possibleConstructorReturn(this, result); }; }
function Media_possibleConstructorReturn(self, call) { if (call && (Media_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return Media_assertThisInitialized(self); }
function Media_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function Media_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function Media_getPrototypeOf(o) { Media_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return Media_getPrototypeOf(o); }








var MediaList = /*#__PURE__*/function (_Component) {
  Media_inherits(MediaList, _Component);
  var _super = Media_createSuper(MediaList);
  function MediaList() {
    Media_classCallCheck(this, MediaList);
    return _super.apply(this, arguments);
  }
  Media_createClass(MediaList, [{
    key: "render",
    value: function render() {
      var audios = sefaria.mediaByRef(this.props.srefs);
      var content = [];
      content = audios.map(function (audio) {
        return /*#__PURE__*/external_react_default().createElement(Audio, {
          audioUrl: audio.media_url,
          startTime: audio.start_time,
          endTime: audio.end_time,
          source: audio.source,
          source_he: audio.source_he,
          license: audio.license,
          source_site: audio.source_site,
          description: audio.description,
          description_he: audio.description_he,
          anchor: audio.anchorRef,
          key: audio.anchorRef
        });
      });
      if (!content.length) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "mediaList empty"
        }, /*#__PURE__*/external_react_default().createElement(LoadingMessage, null));
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "mediaList"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "mediaTitle"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "en"
      }, "Torah Reading "), /*#__PURE__*/external_react_default().createElement("div", {
        className: "he"
      }, "\u05E7\u05E8\u05D9\u05D0\u05D4 \u05D1\u05EA\u05D5\u05E8\u05D4")), content);
    }
  }]);
  return MediaList;
}((external_react_class_default()));
MediaList.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired
};
var Audio = function Audio(_ref) {
  var audioUrl = _ref.audioUrl,
    startTime = _ref.startTime,
    endTime = _ref.endTime,
    source = _ref.source,
    source_he = _ref.source_he,
    license = _ref.license,
    source_site = _ref.source_site,
    description = _ref.description,
    description_he = _ref.description_he,
    anchor = _ref.anchor;
  var audioElement = (0,external_react_.useRef)();
  var _useState = (0,external_react_.useState)(startTime),
    _useState2 = Media_slicedToArray(_useState, 2),
    currTime = _useState2[0],
    setCurrTime = _useState2[1];
  var _useState3 = (0,external_react_.useState)(false),
    _useState4 = Media_slicedToArray(_useState3, 2),
    playing = _useState4[0],
    setPlaying = _useState4[1];
  var _useState5 = (0,external_react_.useState)(endTime),
    _useState6 = Media_slicedToArray(_useState5, 2),
    clipEndTime = _useState6[0],
    setClipEndTime = _useState6[1];
  var _useState7 = (0,external_react_.useState)(startTime),
    _useState8 = Media_slicedToArray(_useState7, 2),
    clipStartTime = _useState8[0],
    setClipStartTime = _useState8[1];
  var _useState9 = (0,external_react_.useState)("".concat(audioUrl, "#t=").concat(startTime, ",").concat(endTime)),
    _useState10 = Media_slicedToArray(_useState9, 2),
    audioUrlWithTime = _useState10[0],
    setAudioUrlWithTime = _useState10[1];
  var handleChange = function handleChange(value) {
    setCurrTime(value.currentTarget.value);
    audioElement.current.currentTime = value.currentTarget.value;
  };
  function formatTime(totalSeconds) {
    if (totalSeconds == "NaN" || totalSeconds < 0) {
      return "0:00";
    }
    var seconds = Math.floor(totalSeconds % 60);
    var minutes = Math.floor(totalSeconds / 60);
    var padWithZero = function padWithZero(number) {
      var string = number.toString();
      if (number < 10) {
        return "0" + string;
      }
      return string;
    };
    return minutes + ":" + padWithZero(seconds);
  }
  (0,external_react_.useEffect)(function () {
    var setAudioTime = function setAudioTime() {
      setCurrTime(audioElement.current.currentTime);
    };
    var setAudioData = function setAudioData() {
      audioElement.current.currentTime = startTime;
    };
    audioElement.current.load();
    audioElement.current.addEventListener("loadeddata", setAudioData);
    audioElement.current.addEventListener("timeupdate", setAudioTime);
    return function () {
      audioElement.current.removeEventListener("timeupdate", setAudioTime);
      audioElement.current.removeEventListener("loadeddata", setAudioData);
    };
  }, [clipStartTime, clipEndTime]);
  (0,external_react_.useEffect)(function () {
    playing ? audioElement.current.play() : audioElement.current.pause();
  }, [playing]);
  (0,external_react_.useEffect)(function () {
    if (currTime > clipEndTime) {
      setPlaying(false);
      setCurrTime(startTime);
      audioElement.current.currentTime = startTime;
    }
  }, [currTime]);
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "media",
    key: anchor + "_" + "audio"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "title en"
  }, source), /*#__PURE__*/external_react_default().createElement("div", {
    className: "title he"
  }, source_he), /*#__PURE__*/external_react_default().createElement("div", {
    className: "description int-en"
  }, description), /*#__PURE__*/external_react_default().createElement("div", {
    className: "description int-he"
  }, description_he), /*#__PURE__*/external_react_default().createElement("div", {
    className: "panel"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "playTimeContainer"
  }, /*#__PURE__*/external_react_default().createElement("input", {
    type: "image",
    src: playing ? "static/img/pause.svg" : "static/img/play.svg",
    alt: playing ? "Pause Audio" : "Play Audio",
    onClick: function onClick() {
      return setPlaying(!playing);
    },
    id: "pause"
  }), /*#__PURE__*/external_react_default().createElement("span", null, formatTime(clipEndTime - clipStartTime - (clipEndTime - currTime)) + " / " + formatTime(clipEndTime - clipStartTime))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "sliderContainer"
  }, /*#__PURE__*/external_react_default().createElement("input", {
    type: "range",
    min: startTime,
    max: endTime,
    value: currTime,
    step: "any",
    className: "slider",
    onChange: function onChange(value) {
      handleChange(value);
    }
  }))), /*#__PURE__*/external_react_default().createElement("audio", {
    id: "my-audio",
    ref: audioElement,
    preload: "metadata"
  }, /*#__PURE__*/external_react_default().createElement("source", {
    src: audioUrlWithTime,
    type: "audio/mpeg"
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "meta"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "License: ", license), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05E2\u05E1\u05E7 \u05E8\u05E9\u05D9\u05D5\u05DF: ", license), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Source: ", /*#__PURE__*/external_react_default().createElement("a", {
    href: source_site,
    target: "_blank"
  }, source)), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05DE\u05E7\u05D5\u05E8: ", /*#__PURE__*/external_react_default().createElement("a", {
    href: source_site,
    target: "_blank"
  }, source_he))));
};

;// CONCATENATED MODULE: ../static/js/ConnectionFilters.jsx
function ConnectionFilters_typeof(obj) { "@babel/helpers - typeof"; return ConnectionFilters_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, ConnectionFilters_typeof(obj); }
function ConnectionFilters_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function ConnectionFilters_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, ConnectionFilters_toPropertyKey(descriptor.key), descriptor); } }
function ConnectionFilters_createClass(Constructor, protoProps, staticProps) { if (protoProps) ConnectionFilters_defineProperties(Constructor.prototype, protoProps); if (staticProps) ConnectionFilters_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function ConnectionFilters_toPropertyKey(arg) { var key = ConnectionFilters_toPrimitive(arg, "string"); return ConnectionFilters_typeof(key) === "symbol" ? key : String(key); }
function ConnectionFilters_toPrimitive(input, hint) { if (ConnectionFilters_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (ConnectionFilters_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function ConnectionFilters_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) ConnectionFilters_setPrototypeOf(subClass, superClass); }
function ConnectionFilters_setPrototypeOf(o, p) { ConnectionFilters_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return ConnectionFilters_setPrototypeOf(o, p); }
function ConnectionFilters_createSuper(Derived) { var hasNativeReflectConstruct = ConnectionFilters_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = ConnectionFilters_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = ConnectionFilters_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return ConnectionFilters_possibleConstructorReturn(this, result); }; }
function ConnectionFilters_possibleConstructorReturn(self, call) { if (call && (ConnectionFilters_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return ConnectionFilters_assertThisInitialized(self); }
function ConnectionFilters_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function ConnectionFilters_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function ConnectionFilters_getPrototypeOf(o) { ConnectionFilters_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return ConnectionFilters_getPrototypeOf(o); }






var CategoryFilter = /*#__PURE__*/function (_Component) {
  ConnectionFilters_inherits(CategoryFilter, _Component);
  var _super = ConnectionFilters_createSuper(CategoryFilter);
  function CategoryFilter() {
    ConnectionFilters_classCallCheck(this, CategoryFilter);
    return _super.apply(this, arguments);
  }
  ConnectionFilters_createClass(CategoryFilter, [{
    key: "handleClick",
    value:
    // A clickable representation of category of connections, include counts.
    // If `showBooks` list connections broken down by book as well.
    function handleClick(e) {
      e.preventDefault();
      if (this.props.showBooks) {
        // 2nd level
        this.props.setFilter(this.props.category, this.props.updateRecent);
        if (sefaria.site) {
          sefaria.track.event("Reader", "Category Filter Click", this.props.category);
        }
      } else {
        // top level
        this.props.setConnectionsCategory(this.props.category);
        if (sefaria.site) {
          sefaria.track.event("Reader", "Connections Category Click", this.props.category);
        }
      }
    }
  }, {
    key: "render",
    value: function render() {
      var filterSuffix = this.props.category === "Quoting Commentary" ? "Quoting" : null;
      var textMissingDescription = null; //"missing description"
      var textFilters = this.props.showBooks ? this.props.books.map(function (book, i) {
        return /*#__PURE__*/external_react_default().createElement(TextFilter, {
          srefs: this.props.srefs,
          key: i,
          book: book.book,
          heBook: book.heBook,
          count: book.count,
          hasEnglish: book.hasEnglish,
          category: this.props.category,
          hideColors: true,
          updateRecent: true,
          filterSuffix: filterSuffix,
          setFilter: this.props.setFilter,
          description: book.enShortDesc ? book.enShortDesc : textMissingDescription,
          heDescription: book.heShortDesc ? book.heShortDesc : textMissingDescription,
          on: sefaria.util.inArray(book.book, this.props.filter) !== -1
        });
      }.bind(this)) : null;
      var color = sefaria.palette.categoryColor(this.props.category);
      var style = {
        "--category-color": color
      };
      var innerClasses = external_classnames_default()({
        categoryFilter: 1,
        withBooks: this.props.showBooks,
        on: this.props.on
      });
      var handleClick = this.handleClick;
      var categoryForUrl = !this.props.showBooks ? this.props.category + " ConnectionsList" : this.props.category;
      var url = this.props.srefs && this.props.srefs.length > 0 ? "/" + sefaria.normRef(this.props.srefs[0]) + "?with=" + categoryForUrl : "";
      var classesDesc = external_classnames_default()({
        sidebarDescription: 1,
        lowlight: this.props.count === 0,
        title: 1
      });
      var outerClasses = external_classnames_default()({
        categoryFilterGroup: 1,
        withBooks: this.props.showBooks
      });
      var catDesc = sefaria.getDescriptionDict(this.props.category, []);
      var catEnDesc = catDesc[0];
      var catHeDesc = catDesc[1];
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: outerClasses,
        style: style
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: url,
        onClick: handleClick
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: innerClasses,
        "data-name": this.props.category
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "filterInner"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "filterText"
      }, /*#__PURE__*/external_react_default().createElement(ContentText, {
        text: {
          en: this.props.showBooks ? "All ".concat(this.props.category) : this.props.category,
          he: this.props.showBooks ? "\u05DB\u05DC \u05D4\u05E7\u05D9\u05E9\u05D5\u05E8\u05D9\u05DD \u05DC".concat(this.props.heCategory) : this.props.heCategory
        }
      }), /*#__PURE__*/external_react_default().createElement("span", {
        className: "connectionsCount"
      }, " (", this.props.count, ")")), /*#__PURE__*/external_react_default().createElement("span", {
        className: "en"
      }, this.props.hasEnglish && sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement(EnglishAvailableTag, null) : null)), /*#__PURE__*/external_react_default().createElement("div", {
        className: classesDesc
      }, catEnDesc || catHeDesc ? /*#__PURE__*/external_react_default().createElement(ContentText, {
        text: {
          en: catEnDesc,
          he: catHeDesc
        }
      }) : null), "          ")), textFilters);
    }
  }]);
  return CategoryFilter;
}((external_react_class_default()));
CategoryFilter.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  category: (external_prop_types_default()).string.isRequired,
  heCategory: (external_prop_types_default()).string.isRequired,
  showBooks: (external_prop_types_default()).bool.isRequired,
  count: (external_prop_types_default()).number.isRequired,
  hasEnglish: (external_prop_types_default()).bool,
  books: (external_prop_types_default()).array.isRequired,
  filter: (external_prop_types_default()).array.isRequired,
  updateRecent: (external_prop_types_default()).bool.isRequired,
  setFilter: (external_prop_types_default()).func.isRequired,
  setConnectionsCategory: (external_prop_types_default()).func.isRequired,
  on: (external_prop_types_default()).bool
};
var TextFilter = /*#__PURE__*/function (_Component2) {
  ConnectionFilters_inherits(TextFilter, _Component2);
  var _super2 = ConnectionFilters_createSuper(TextFilter);
  function TextFilter() {
    ConnectionFilters_classCallCheck(this, TextFilter);
    return _super2.apply(this, arguments);
  }
  ConnectionFilters_createClass(TextFilter, [{
    key: "handleClick",
    value:
    // A clickable representation of connections by Text or Commentator
    function handleClick(e) {
      e.preventDefault();
      var name = "enDisplayText" in this.props ? this.props["enDisplayText"] : this.props.book;
      var filter = this.props.filterSuffix ? name + "|" + this.props.filterSuffix : name;
      this.props.setFilter(filter, this.props.updateRecent);
      if (sefaria.site) {
        if (this.props.inRecentFilters) {
          sefaria.track.event("Reader", "Text Filter in Recent Click", filter);
        } else {
          sefaria.track.event("Reader", "Text Filter Click", filter);
        }
      }
    }
  }, {
    key: "render",
    value: function render() {
      var classes = external_classnames_default()({
        textFilter: 1,
        on: this.props.on,
        lowlight: this.props.count == 0
      });
      var classesDesc = external_classnames_default()({
        sidebarDescription: 1,
        lowlight: this.props.count == 0
      });
      var color = this.props.filterSuffix === "Essay" ? "var(--essay-links-green)" : sefaria.palette.categoryColor(this.props.category);
      var style = {
        "--category-color": color
      };
      var enBook = this.props.book == this.props.category ? this.props.book.toUpperCase() : this.props.book;
      var showCount = !this.props.hideCounts && !!this.props.count;
      var url = this.props.srefs && this.props.srefs.length > 0 ? "/" + sefaria.normRef(this.props.srefs[0]) + "?with=" + enBook : "";
      var upperClass = external_classnames_default()({
        uppercase: this.props.book === this.props.category
      });
      var name = "enDisplayText" in this.props ? this.props["enDisplayText"] : enBook;
      var heName = "heDisplayText" in this.props ? this.props["heDisplayText"] : this.props.heBook;
      var enDesc = this.props.description;
      var heDesc = this.props.heDescription;
      var showDescription = true; //showCount;//
      return /*#__PURE__*/external_react_default().createElement("a", {
        href: url,
        onClick: this.handleClick
      }, /*#__PURE__*/external_react_default().createElement("div", {
        "data-name": enBook,
        className: classes,
        style: style
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: upperClass
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "filterInner"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "filterText"
      }, /*#__PURE__*/external_react_default().createElement(ContentText, {
        text: {
          en: name,
          he: heName
        }
      }), showCount ? /*#__PURE__*/external_react_default().createElement("span", {
        className: "connectionsCount"
      }, "\xA0(", this.props.count, ")") : null), /*#__PURE__*/external_react_default().createElement("span", {
        className: "en"
      }, this.props.hasEnglish && sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement(EnglishAvailableTag, null) : null)), showDescription ? /*#__PURE__*/external_react_default().createElement("div", {
        className: classesDesc
      }, enDesc || heDesc ? /*#__PURE__*/external_react_default().createElement(ContentText, {
        text: {
          en: enDesc,
          he: heDesc
        }
      }) : null) : null)));
    }
  }]);
  return TextFilter;
}((external_react_class_default()));
TextFilter.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  book: (external_prop_types_default()).string.isRequired,
  heBook: (external_prop_types_default()).string.isRequired,
  on: (external_prop_types_default()).bool.isRequired,
  setFilter: (external_prop_types_default()).func.isRequired,
  updateRecent: (external_prop_types_default()).bool,
  inRecentFilters: (external_prop_types_default()).bool,
  filterSuffix: (external_prop_types_default()).string,
  // Optionally add a string to the filter parameter set (but not displayed)
  enDisplayedText: (external_prop_types_default()).string,
  // displayedText fields used when link is 'essay' and we don't want to show the book title
  heDisplayedText: (external_prop_types_default()).string
};
var EnglishAvailableTag = /*#__PURE__*/function (_Component3) {
  ConnectionFilters_inherits(EnglishAvailableTag, _Component3);
  var _super3 = ConnectionFilters_createSuper(EnglishAvailableTag);
  function EnglishAvailableTag() {
    ConnectionFilters_classCallCheck(this, EnglishAvailableTag);
    return _super3.apply(this, arguments);
  }
  ConnectionFilters_createClass(EnglishAvailableTag, [{
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("span", {
        className: "englishAvailableTag"
      }, "EN");
    }
  }]);
  return EnglishAvailableTag;
}((external_react_class_default()));
var RecentFilterSet = /*#__PURE__*/function (_Component4) {
  ConnectionFilters_inherits(RecentFilterSet, _Component4);
  var _super4 = ConnectionFilters_createSuper(RecentFilterSet);
  function RecentFilterSet() {
    ConnectionFilters_classCallCheck(this, RecentFilterSet);
    return _super4.apply(this, arguments);
  }
  ConnectionFilters_createClass(RecentFilterSet, [{
    key: "toggleAllFilterView",
    value:
    // A toggle-able listing of currently and recently used text filters.
    function toggleAllFilterView() {
      this.setState({
        showAllFilters: !this.state.showAllFilters
      });
    }
  }, {
    key: "render",
    value: function render() {
      // Annotate filter texts with category
      var recentFilters;
      recentFilters = this.props.recentFilters.map(function (filter) {
        var filterAndSuffix = filter.split("|");
        filter = filterAndSuffix[0];
        var filterSuffix = filterAndSuffix.length == 2 ? filterAndSuffix[1] : null;
        var index = sefaria.index(filter);
        var filterKey = filter + (filterSuffix ? "|".concat(filterSuffix) : '');
        return {
          book: filter,
          filterSuffix: filterSuffix,
          heBook: index ? index.heTitle : sefaria.hebrewTerm(filter),
          category: index ? index.primary_category ? index.primary_category : index.categories[0] : filter,
          filterKey: filterKey
        };
      });
      var topLinks = [];
      // If the current filter is not already in the top set, put it first
      if (this.props.filter.length) {
        var filter = this.props.filter[0];
        var i = 0;
        for (i; i < topLinks.length; i++) {
          if (recentFilters[i].book === filter || recentFilters[i].category == filter) {
            break;
          }
        }
        if (i == recentFilters.length) {
          var index = sefaria.index(filter);
          var annotatedFilter;
          if (index) {
            annotatedFilter = {
              book: filter,
              heBook: index.heTitle,
              category: index.primary_category
            };
          } else {
            annotatedFilter = {
              book: filter,
              heBook: filter.en,
              category: "Other"
            };
          }
          recentFilters = [annotatedFilter].concat(topLinks).slice(0, 5);
        } else {
          // topLinks.move(i, 0);
        }
      }
      recentFilters = recentFilters.map(function (book) {
        return /*#__PURE__*/external_react_default().createElement(TextFilter, {
          srefs: this.props.srefs,
          key: book.filterKey,
          book: book.book,
          heBook: book.heBook,
          category: book.category,
          hideCounts: true,
          hideColors: true,
          count: book.count,
          filterSuffix: book.filterSuffix,
          updateRecent: false,
          inRecentFilters: true,
          setFilter: this.props.setFilter,
          on: sefaria.util.inArray(book.filterKey, this.props.filter) !== -1
        });
      }.bind(this));
      var classes = external_classnames_default()({
        recentFilterSet: 1,
        topFilters: this.props.asHeader,
        filterSet: 1
      });
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "topFiltersInner"
      }, recentFilters));
    }
  }]);
  return RecentFilterSet;
}((external_react_class_default()));
RecentFilterSet.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  filter: (external_prop_types_default()).array.isRequired,
  recentFilters: (external_prop_types_default()).array.isRequired,
  inHeader: (external_prop_types_default()).bool,
  setFilter: (external_prop_types_default()).func.isRequired
};

;// CONCATENATED MODULE: ../static/js/AboutSheet.jsx
function AboutSheet_typeof(obj) { "@babel/helpers - typeof"; return AboutSheet_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, AboutSheet_typeof(obj); }
function AboutSheet_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ AboutSheet_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == AboutSheet_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function AboutSheet_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function AboutSheet_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { AboutSheet_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { AboutSheet_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function AboutSheet_toConsumableArray(arr) { return AboutSheet_arrayWithoutHoles(arr) || AboutSheet_iterableToArray(arr) || AboutSheet_unsupportedIterableToArray(arr) || AboutSheet_nonIterableSpread(); }
function AboutSheet_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function AboutSheet_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function AboutSheet_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return AboutSheet_arrayLikeToArray(arr); }
function AboutSheet_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = AboutSheet_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function AboutSheet_slicedToArray(arr, i) { return AboutSheet_arrayWithHoles(arr) || AboutSheet_iterableToArrayLimit(arr, i) || AboutSheet_unsupportedIterableToArray(arr, i) || AboutSheet_nonIterableRest(); }
function AboutSheet_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function AboutSheet_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return AboutSheet_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return AboutSheet_arrayLikeToArray(o, minLen); }
function AboutSheet_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function AboutSheet_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function AboutSheet_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }





var AboutSheet = function AboutSheet(_ref) {
  var masterPanelSheetId = _ref.masterPanelSheetId,
    toggleSignUpModal = _ref.toggleSignUpModal;
  var sheet = sefaria.sheets.loadSheetByID(masterPanelSheetId);
  var canEdit = sheet.owner === sefaria._uid;
  var reactTags = React.createRef();
  var title = sheet.title.stripHtmlConvertLineBreaks();
  var _useState = (0,external_react_.useState)(sheet.topics.map(function (topic, i) {
      return {
        id: i,
        name: topic["asTyped"],
        slug: topic["slug"]
      };
    })),
    _useState2 = AboutSheet_slicedToArray(_useState, 2),
    tags = _useState2[0],
    setTags = _useState2[1];
  var _useState3 = (0,external_react_.useState)([]),
    _useState4 = AboutSheet_slicedToArray(_useState3, 2),
    sheetSaves = _useState4[0],
    setSheetSaves = _useState4[1];
  var _useState5 = (0,external_react_.useState)([]),
    _useState6 = AboutSheet_slicedToArray(_useState5, 2),
    suggestions = _useState6[0],
    setSuggestions = _useState6[1];
  var _useState7 = (0,external_react_.useState)(sheet.dateModified),
    _useState8 = AboutSheet_slicedToArray(_useState7, 2),
    lastModified = _useState8[0],
    setLastModified = _useState8[1];
  var _useState9 = (0,external_react_.useState)(sheet.status === "public"),
    _useState10 = AboutSheet_slicedToArray(_useState9, 2),
    isPublished = _useState10[0],
    setIsPublished = _useState10[1];
  var _useState11 = (0,external_react_.useState)({
      validationMsg: "",
      validationFailed: "none"
    }),
    _useState12 = AboutSheet_slicedToArray(_useState11, 2),
    validation = _useState12[0],
    setValidation = _useState12[1];
  var _useState13 = (0,external_react_.useState)(sheet.summary),
    _useState14 = AboutSheet_slicedToArray(_useState13, 2),
    summary = _useState14[0],
    setSummary = _useState14[1];
  var getRefSavedHistory = sefaria.makeCancelable(sefaria.getRefSavedHistory("Sheet " + masterPanelSheetId));
  var debouncedSummary = sefaria._uid == sheet.owner ? useDebounce(summary, 250) : null;
  (0,external_react_.useEffect)(function () {
    getRefSavedHistory.promise.then(function (data) {
      var _iterator = AboutSheet_createForOfIteratorHelper(data),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var hist = _step.value;
          setSheetSaves([].concat(AboutSheet_toConsumableArray(sheetSaves), [hist["uid"]]));
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
    })["catch"](function (reason) {
      console.log('Error', reason.isCanceled ? 'canceled' : reason);
    });
    return function () {
      getRefSavedHistory.cancel();
    };
  }, [masterPanelSheetId]);
  (0,external_react_.useEffect)(function () {
    if (debouncedSummary == null) {
      return;
    }
    saveSummary();
  }, [debouncedSummary]);
  var handleSummaryChange = function handleSummaryChange(event) {
    var newSummary = event.target.value;
    if (event.target.value.length > 280) {
      setValidation({
        validationMsg: sefaria._("The summary description is limited to 280 characters."),
        validationFailed: "summary"
      });
    } else {
      setValidation({
        validationMsg: "",
        validationFailed: "none"
      });
    }
    setSummary(newSummary);
  };
  var updateSuggestedTags = function updateSuggestedTags(input) {
    if (input == "") return;
    sefaria.getName(input, false, 0).then(function (d) {
      var topics = d.completion_objects.filter(function (obj) {
        return obj.type === "Topic";
      }).map(function (filteredObj, index) {
        return {
          id: index,
          name: filteredObj.title,
          slug: filteredObj.key
        };
      });
      return topics;
    }).then(function (topics) {
      return setSuggestions(topics);
    });
  };
  var updateTopics = /*#__PURE__*/function () {
    var _ref2 = AboutSheet_asyncToGenerator( /*#__PURE__*/AboutSheet_regeneratorRuntime().mark(function _callee(newTags) {
      var updatedSheet, topics, postJSON;
      return AboutSheet_regeneratorRuntime().wrap(function _callee$(_context) {
        while (1) switch (_context.prev = _context.next) {
          case 0:
            _context.next = 2;
            return new Promise(function (resolve, reject) {
              return sefaria.sheets.loadSheetByID(sheet.id, function (sheet) {
                return resolve(sheet);
              });
            });
          case 2:
            updatedSheet = _context.sent;
            topics = newTags.map(function (tag) {
              return {
                asTyped: tag.name,
                slug: tag.slug
              };
            });
            updatedSheet.topics = topics;
            updatedSheet.lastModified = lastModified;
            delete updatedSheet._id;
            delete updatedSheet.error;
            postJSON = JSON.stringify(updatedSheet);
            postSheet(postJSON);
          case 10:
          case "end":
            return _context.stop();
        }
      }, _callee);
    }));
    return function updateTopics(_x2) {
      return _ref2.apply(this, arguments);
    };
  }();
  var saveSummary = /*#__PURE__*/function () {
    var _ref3 = AboutSheet_asyncToGenerator( /*#__PURE__*/AboutSheet_regeneratorRuntime().mark(function _callee2() {
      var updatedSheet, postJSON;
      return AboutSheet_regeneratorRuntime().wrap(function _callee2$(_context2) {
        while (1) switch (_context2.prev = _context2.next) {
          case 0:
            _context2.next = 2;
            return new Promise(function (resolve, reject) {
              return sefaria.sheets.loadSheetByID(sheet.id, function (sheet) {
                return resolve(sheet);
              });
            });
          case 2:
            updatedSheet = _context2.sent;
            updatedSheet.summary = summary;
            updatedSheet.lastModified = lastModified;
            delete updatedSheet._id;
            postJSON = JSON.stringify(updatedSheet);
            postSheet(postJSON);
          case 8:
          case "end":
            return _context2.stop();
        }
      }, _callee2);
    }));
    return function saveSummary() {
      return _ref3.apply(this, arguments);
    };
  }();
  var isFormValidated = function isFormValidated() {
    if ((!summary || summary.trim() == '') && tags.length == 0) {
      setValidation({
        validationMsg: sefaria._("Please add a description and topics to publish your sheet."),
        validationFailed: "both"
      });
      return false;
    } else if (!summary || summary.trim() == '') {
      setValidation({
        validationMsg: sefaria._("Please add a description to publish your sheet."),
        validationFailed: "summary"
      });
      return false;
    } else if (tags.length == 0) {
      setValidation({
        validationMsg: sefaria._("Please add topics to publish your sheet."),
        validationFailed: "topics"
      });
      return false;
    } else {
      setValidation({
        validationMsg: "",
        validationFailed: "none"
      });
      return true;
    }
  };
  var togglePublish = /*#__PURE__*/function () {
    var _ref4 = AboutSheet_asyncToGenerator( /*#__PURE__*/AboutSheet_regeneratorRuntime().mark(function _callee3() {
      var newPublishState, updatedSheet, postJSON;
      return AboutSheet_regeneratorRuntime().wrap(function _callee3$(_context3) {
        while (1) switch (_context3.prev = _context3.next) {
          case 0:
            if (isPublished) {
              _context3.next = 3;
              break;
            }
            if (isFormValidated()) {
              _context3.next = 3;
              break;
            }
            return _context3.abrupt("return");
          case 3:
            newPublishState = isPublished ? "unlisted" : "public";
            _context3.next = 6;
            return new Promise(function (resolve, reject) {
              return sefaria.sheets.loadSheetByID(sheet.id, function (sheet) {
                return resolve(sheet);
              });
            });
          case 6:
            updatedSheet = _context3.sent;
            updatedSheet.status = newPublishState;
            updatedSheet.lastModified = lastModified;
            delete updatedSheet._id;
            setIsPublished(!isPublished);
            postJSON = JSON.stringify(updatedSheet);
            postSheet(postJSON);
          case 13:
          case "end":
            return _context3.stop();
        }
      }, _callee3);
    }));
    return function togglePublish() {
      return _ref4.apply(this, arguments);
    };
  }();
  var onTagDelete = function onTagDelete(i) {
    var newTags = tags.slice(0);
    newTags.splice(i, 1);
    setTags(newTags);
    updateTopics(newTags);
  };
  var onTagAddition = function onTagAddition(tag) {
    var newTags = [].concat(tags, tag);
    setTags(newTags);
    updateTopics(newTags);
  };
  var onTagValidate = function onTagValidate(tag) {
    return tags.every(function (item) {
      return item.name !== tag.name;
    });
  };
  var postSheet = function postSheet(postJSON) {
    $.post("/api/sheets/", {
      "json": postJSON
    }, function (data) {
      if (data.id) {
        console.log('saved...');
        setLastModified(data.dateModified);
        sefaria.sheets._loadSheetByID[data.id] = data;
      } else {
        console.log(data);
      }
    });
  };
  var publishSettingsReadOnly = /*#__PURE__*/React.createElement("div", null, " ", sheet.summary ? /*#__PURE__*/React.createElement("div", {
    className: "description",
    dangerouslySetInnerHTML: {
      __html: sheet.summary
    }
  }) : null, sheet.collections.length > 0 ? /*#__PURE__*/React.createElement("div", {
    className: "aboutLinks"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "aboutSheetHeader"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "Public Collections")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("ul", {
    className: "aboutSheetLinks"
  }, sheet.collections.map(function (collection, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i
    }, /*#__PURE__*/React.createElement("a", {
      href: "/collections/" + collection.slug
    }, /*#__PURE__*/React.createElement(InterfaceText, null, collection.name)));
  })))) : null, !!sefaria._uid ? /*#__PURE__*/React.createElement(CollectionsEditor, {
    sheetId: sheet.id
  }) : null, sheet.topics && sheet.topics.length > 0 ? /*#__PURE__*/React.createElement("div", {
    className: "readings"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "aboutSheetHeader"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "Topics")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("ul", {
    className: "aboutSheetLinks"
  }, sheet.topics.map(function (topic, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i
    }, /*#__PURE__*/React.createElement("a", {
      href: "/topics/" + topic.slug,
      target: "_blank"
    }, /*#__PURE__*/React.createElement(InterfaceText, {
      text: {
        en: topic.en,
        he: topic.he
      }
    })));
  })))) : null);
  var publishSettingsEditMode = /*#__PURE__*/React.createElement("div", {
    className: "publishSettingsEditMode"
  }, /*#__PURE__*/React.createElement("div", {
    className: isPublished ? "publishBox transparentBackground sans-serif" : "publishBox sans-serif"
  }, !isPublished ? /*#__PURE__*/React.createElement("p", null, /*#__PURE__*/React.createElement(InterfaceText, null, "Publish your sheet on Sefaria for others to discover.")) : null, /*#__PURE__*/React.createElement("h3", {
    className: "aboutSheetHeader"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "Summary")), /*#__PURE__*/React.createElement("textarea", {
    className: validation.validationFailed === "both" || validation.validationFailed === "summary" ? "error" : "",
    rows: "3",
    maxLength: "281",
    placeholder: sefaria._("Write a short description of your sheet..."),
    value: summary,
    onChange: handleSummaryChange
  }), /*#__PURE__*/React.createElement("h3", {
    className: "aboutSheetHeader"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "Topics")), /*#__PURE__*/React.createElement("div", {
    className: validation.validationFailed == "both" || validation.validationFailed == "topics" ? "error" : ""
  }, /*#__PURE__*/React.createElement((external_react_tag_autocomplete_default()), {
    ref: reactTags,
    allowNew: true,
    tags: tags,
    suggestions: suggestions,
    onDelete: onTagDelete,
    placeholderText: sefaria._("Add a topic..."),
    delimiters: ["Enter", "Tab", ","],
    onAddition: onTagAddition,
    onValidate: onTagValidate,
    onInput: updateSuggestedTags
  })), validation.validationFailed == "none" ? null : /*#__PURE__*/React.createElement("p", {
    className: "error"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, validation.validationMsg)), !isPublished ? /*#__PURE__*/React.createElement("div", {
    className: "publishButton"
  }, /*#__PURE__*/React.createElement("button", {
    className: "button notPublished",
    onClick: togglePublish
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "Publish"))) : null), /*#__PURE__*/React.createElement(CollectionsEditor, {
    sheetId: sheet.id
  }), isPublished ? /*#__PURE__*/React.createElement("div", {
    className: "publishButton"
  }, /*#__PURE__*/React.createElement("div", {
    className: "publishedText"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, /*#__PURE__*/React.createElement(EnglishText, null, "Your Sheet is ", /*#__PURE__*/React.createElement("span", {
    className: "publishedTextBold"
  }, "published"), " on Sefaria and visible to others."), /*#__PURE__*/React.createElement(HebrewText, null, "\u05D3\u05E3 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05DC\u05DA ", /*#__PURE__*/React.createElement("span", {
    className: "publishedTextBold"
  }, "\u05DE\u05E4\u05D5\u05E8\u05E1\u05DD"), " \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0 \u05D5\u05D2\u05DC\u05D5\u05D9 \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05D0\u05D7\u05E8\u05D9\u05DD"))), /*#__PURE__*/React.createElement("button", {
    className: "button published",
    onClick: togglePublish
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "Unpublish"))) : null);
  return /*#__PURE__*/React.createElement("div", {
    className: "aboutSheetPanel"
  }, /*#__PURE__*/React.createElement("div", {
    className: "aboutSheetTopHeaders"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "aboutHeader"
  }, title), /*#__PURE__*/React.createElement("h3", {
    className: "aboutSheetSubtitle"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "Sheet"))), /*#__PURE__*/React.createElement(SheetAuthorStatement, {
    authorUrl: sheet.ownerProfileUrl,
    authorStatement: sheet.ownerName
  }, /*#__PURE__*/React.createElement(ProfilePic, {
    url: sheet.ownerImageUrl,
    len: 30,
    name: sheet.ownerName,
    outerStyle: {
      width: "30px",
      height: "30px",
      display: "inline-block",
      verticalAlign: "middle",
      marginInlineEnd: "10px"
    }
  }), /*#__PURE__*/React.createElement("a", {
    href: sheet.ownerProfileUrl
  }, /*#__PURE__*/React.createElement(InterfaceText, null, sheet.ownerName))), /*#__PURE__*/React.createElement("div", {
    className: "aboutSheetMetadata"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", null, sefaria.util.localeDate(sheet.dateCreated)), /*#__PURE__*/React.createElement("span", null, sheet.views, " ", sefaria._("Views")), /*#__PURE__*/React.createElement("span", null, sheetSaves.length, " ", sefaria._("Saves")))), canEdit ? publishSettingsEditMode : publishSettingsReadOnly);
};
var CollectionsEditor = function CollectionsEditor(_ref5) {
  var sheetId = _ref5.sheetId;
  // A box that lets you control which of your collections `sheetId` belongs to

  var initialCollectionsSort = function initialCollectionsSort(cs, csSelected) {
    // When first opened, sort checked collections to top, but don't reshuffle when user clicks check of open modal
    if (!cs || !csSelected) {
      return null;
    }
    return cs.sort(function (a, b) {
      var aSel, bSel;
      var _map = [a, b].map(function (x) {
        return !!csSelected.filter(function (y) {
          return y.slug === x.slug;
        }).length;
      });
      var _map2 = AboutSheet_slicedToArray(_map, 2);
      aSel = _map2[0];
      bSel = _map2[1];
      if (aSel == bSel) {
        return a.lastModified > b.lastModified ? -1 : 1;
      } else {
        return aSel ? -1 : 1;
      }
    });
  };
  var _useState15 = (0,external_react_.useState)(sefaria.getUserCollectionsForSheetFromCache(sheetId)),
    _useState16 = AboutSheet_slicedToArray(_useState15, 2),
    collectionsSelected = _useState16[0],
    setCollectionsSelected = _useState16[1];
  var initialCollections = sefaria.getUserCollectionsFromCache(sefaria._uid);
  initialCollections = initialCollections ? initialCollectionsSort(initialCollections.slice(), collectionsSelected) : null;
  var _useState17 = (0,external_react_.useState)(initialCollections),
    _useState18 = AboutSheet_slicedToArray(_useState17, 2),
    collections = _useState18[0],
    setCollections = _useState18[1];
  var _useState19 = (0,external_react_.useState)(!!collections && !!collectionsSelected),
    _useState20 = AboutSheet_slicedToArray(_useState19, 2),
    dataLoaded = _useState20[0],
    setDataLoaded = _useState20[1];
  var _useState21 = (0,external_react_.useState)(""),
    _useState22 = AboutSheet_slicedToArray(_useState21, 2),
    newName = _useState22[0],
    setNewName = _useState22[1];
  var _useState23 = (0,external_react_.useState)(false),
    _useState24 = AboutSheet_slicedToArray(_useState23, 2),
    changed = _useState24[0],
    setChanged = _useState24[1];

  // Make sure we have loaded the user's list of collections, 
  // and which collections this sheet belongs to for this user
  (0,external_react_.useEffect)(function () {
    if (!dataLoaded) {
      Promise.all([sefaria.getUserCollections(sefaria._uid), sefaria.getUserCollectionsForSheet(sheetId)]).then(function () {
        var initialCollectionsSelected = sefaria.getUserCollectionsForSheetFromCache(sheetId);
        var initialSortedCollections = initialCollectionsSort(sefaria.getUserCollectionsFromCache(sefaria._uid), initialCollectionsSelected);
        setCollections(initialSortedCollections);
        setCollectionsSelected(initialCollectionsSelected);
        setDataLoaded(true);
      });
    }
  }, []);
  var onCheckChange = function onCheckChange(collection, checked) {
    // When a checkmark changes, add or remove this sheet from that collection
    var url, newCollectionsSelected;
    if (checked) {
      newCollectionsSelected = [].concat(AboutSheet_toConsumableArray(collectionsSelected), [collection]);
      url = "/api/collections/".concat(collection.slug, "/add/").concat(sheetId);
    } else {
      newCollectionsSelected = collectionsSelected.filter(function (x) {
        return x.slug !== collection.slug;
      });
      url = "/api/collections/".concat(collection.slug, "/remove/").concat(sheetId);
    }
    $.post(url, function (data) {
      return handleCollectionInclusionChange(data);
    });
    sefaria._userCollectionsForSheet[sheetId] = newCollectionsSelected;
    setCollectionsSelected(newCollectionsSelected);
  };
  var handleCollectionInclusionChange = function handleCollectionInclusionChange(data) {
    // When a sheet has been added or removed, update collections list data in cache
    var newCollections = sefaria.getUserCollectionsFromCache(sefaria._uid).filter(function (c) {
      return c.slug != data.collection.slug;
    });
    // Put the new collection first since it's just been modified
    newCollections = [data.collectionListing].concat(AboutSheet_toConsumableArray(newCollections));
    // Update in cache, but not in Component state -- prevents the list from jumping around
    // while you're looking at it, but show this collection first next time you see the list.
    sefaria._userCollections[sefaria._uid] = newCollections;
    // Update cache for this collection's full listing, which has now changed
    sefaria._collections[data.collection.slug] = data.collection;
    // Update sheet cache
    sefaria.sheets._loadSheetByID[sheetId] = data.sheet;
    sefaria.sheets.updateUserSheets(data.sheetListing, sefaria._uid, true, true);
    setChanged(true);
  };
  var onNameChange = function onNameChange(event) {
    return setNewName(event.target.value);
  };
  var onCreateClick = function onCreateClick() {
    var collection = {
      name: newName
    };
    $.post("/api/collections", {
      json: JSON.stringify(collection)
    }, function (data) {
      if ("error" in data) {
        alert(data.error);
        return;
      }
      setNewName("");
      var newCollections = [data.collection].concat(AboutSheet_toConsumableArray(collections));
      sefaria._userCollections[sefaria._uid] = newCollections;
      setCollections(newCollections);
      onCheckChange(data.collection, true);
    });
  };
  return /*#__PURE__*/React.createElement("div", null, "      ", /*#__PURE__*/React.createElement("div", {
    className: "collectionsEditorTop"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "aboutSheetHeader"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "My Collections"))), /*#__PURE__*/React.createElement("div", {
    className: "collectionsWidget"
  }, /*#__PURE__*/React.createElement("div", {
    className: "collectionsWidgetList serif"
  }, !dataLoaded ? null : collections.map(function (collection, i) {
    return /*#__PURE__*/React.createElement("label", {
      className: "checkmarkLabel",
      key: i + collection.name
    }, /*#__PURE__*/React.createElement("input", {
      type: "checkbox",
      onChange: function onChange(event) {
        return onCheckChange(collection, event.target.checked);
      },
      checked: collectionsSelected.filter(function (x) {
        return x.slug === collection.slug;
      }).length ? "checked" : ""
    }), /*#__PURE__*/React.createElement("span", {
      className: "checkmark"
    }), collection.name);
  }), dataLoaded && collections.length == 0 ? /*#__PURE__*/React.createElement("span", {
    className: "emptyMessage"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "You can use collections to organize your sheets or public sheets you like. Collections can shared privately or made public on Sefaria.")) : null), /*#__PURE__*/React.createElement("div", {
    className: "collectionsEditorCreate"
  }, /*#__PURE__*/React.createElement("span", {
    className: "collectionsWidgetPlus"
  }, "+"), /*#__PURE__*/React.createElement("div", {
    className: "collectionsWidgetCreateInputBox"
  }, /*#__PURE__*/React.createElement("input", {
    className: "collectionsWidgetCreateInput",
    placeholder: sefaria._("Create new collection"),
    value: newName,
    onChange: onNameChange
  })), newName.length ? /*#__PURE__*/React.createElement("div", {
    className: "button extraSmall white collectionsWidgetCreateButton",
    onClick: onCreateClick
  }, /*#__PURE__*/React.createElement(InterfaceText, null, "Create")) : null)));
};
/* harmony default export */ const js_AboutSheet = (AboutSheet);
;// CONCATENATED MODULE: ../static/js/SearchTextResult.jsx
function SearchTextResult_typeof(obj) { "@babel/helpers - typeof"; return SearchTextResult_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, SearchTextResult_typeof(obj); }
function SearchTextResult_defineProperty(obj, key, value) { key = SearchTextResult_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function SearchTextResult_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = SearchTextResult_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function SearchTextResult_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return SearchTextResult_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return SearchTextResult_arrayLikeToArray(o, minLen); }
function SearchTextResult_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function SearchTextResult_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function SearchTextResult_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, SearchTextResult_toPropertyKey(descriptor.key), descriptor); } }
function SearchTextResult_createClass(Constructor, protoProps, staticProps) { if (protoProps) SearchTextResult_defineProperties(Constructor.prototype, protoProps); if (staticProps) SearchTextResult_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function SearchTextResult_toPropertyKey(arg) { var key = SearchTextResult_toPrimitive(arg, "string"); return SearchTextResult_typeof(key) === "symbol" ? key : String(key); }
function SearchTextResult_toPrimitive(input, hint) { if (SearchTextResult_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (SearchTextResult_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function SearchTextResult_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) SearchTextResult_setPrototypeOf(subClass, superClass); }
function SearchTextResult_setPrototypeOf(o, p) { SearchTextResult_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return SearchTextResult_setPrototypeOf(o, p); }
function SearchTextResult_createSuper(Derived) { var hasNativeReflectConstruct = SearchTextResult_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = SearchTextResult_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = SearchTextResult_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return SearchTextResult_possibleConstructorReturn(this, result); }; }
function SearchTextResult_possibleConstructorReturn(self, call) { if (call && (SearchTextResult_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return SearchTextResult_assertThisInitialized(self); }
function SearchTextResult_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function SearchTextResult_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function SearchTextResult_getPrototypeOf(o) { SearchTextResult_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return SearchTextResult_getPrototypeOf(o); }






var SearchTextResult = /*#__PURE__*/function (_Component) {
  SearchTextResult_inherits(SearchTextResult, _Component);
  var _super = SearchTextResult_createSuper(SearchTextResult);
  function SearchTextResult(props) {
    var _this;
    SearchTextResult_classCallCheck(this, SearchTextResult);
    _this = _super.call(this, props);
    _this.state = {
      duplicatesShown: false
    };
    return _this;
  }
  SearchTextResult_createClass(SearchTextResult, [{
    key: "toggleDuplicates",
    value: function toggleDuplicates(event) {
      this.setState({
        duplicatesShown: !this.state.duplicatesShown
      });
    }
  }, {
    key: "getHighlights",
    value: function getHighlights() {
      // Gets list of highlights (text in <b> tags) in the current match
      // Returns list of strings
      var highlights = [];
      var longestLength = 0;
      var highlightReg = /((?:[\s,.?!:;]){0,}<b>[^<]+<\/b>[\s,.?!:;]{0,})+/g; // capture consecutive <b> tags in one match
      if (!this.props.data.highlight) {
        return [];
      }
      var vals = Object.values(this.props.data.highlight);
      if (vals.length === 0) {
        return [];
      }
      // vals should have only one entry. either 'naive_lemmatizer' or 'exact'
      var _iterator = SearchTextResult_createForOfIteratorHelper(vals[0]),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var h = _step.value;
          var matches = null;
          while ((matches = highlightReg.exec(h)) !== null) {
            var matchText = matches[0].replace(/<\/?b>/g, '');
            if (matchText.length > longestLength) {
              longestLength = matchText.length;
            }
            highlights.push(matchText);
          }
        }
        // in order to decrease spurious highlights (e.g. for a lone "The") we only take the longest match
        // commenting out for now. Not sure we want this.
        // highlights = highlights.filter(h => h.length === longestLength);
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return highlights;
    }
  }, {
    key: "handleResultClick",
    value: function handleResultClick(event) {
      if (this.props.onResultClick) {
        event.preventDefault();
        var s = this.props.data._source;
        var textHighlights = this.getHighlights();
        //console.log(textHighlights);
        if (this.props.searchInBook) {
          sefaria.track.event("Search", "Sidebar Search Result Click", "".concat(this.props.query, " - ").concat(s.ref, "/").concat(s.version, "/").concat(s.lang));
        } else {
          sefaria.track.event("Search", "Search Result Text Click", "".concat(this.props.query, " - ").concat(s.ref, "/").concat(s.version, "/").concat(s.lang));
        }
        this.props.onResultClick(s.ref, SearchTextResult_defineProperty({}, s.lang, s.version), {
          textHighlights: textHighlights
        });
      }
    }
  }, {
    key: "get_snippet_markup",
    value: function get_snippet_markup(data) {
      var snippet;
      var field;
      if (data.highlight) {
        field = Object.keys(data.highlight)[0]; //there should only be one key
        snippet = data.highlight[field].join("...");
      } else {
        field = "exact";
        snippet = data._source[field];
      }
      // if (data.highlight && data.highlight[field]) {

      // } else {
      //     snippet = s[field];  // We're filtering out content, because it's *huge*, especially on Sheets
      // }
      var lang = sefaria.hebrew.isHebrew(snippet) ? "he" : "en";
      snippet = snippet.replace(/^[ .,;:!-)\]]+/, "");
      return {
        markup: {
          __html: snippet
        },
        lang: lang
      };
    }
  }, {
    key: "render",
    value: function render() {
      var data = this.props.data;
      var s = this.props.data._source;
      var href = "/".concat(sefaria.normRef(s.ref), "?v").concat(s.lang, "=").concat(sefaria.util.encodeVtitle(s.version), "&qh=").concat(this.props.query);
      var more_results_caret = this.state.duplicatesShown ? /*#__PURE__*/external_react_default().createElement("i", {
        className: "fa fa-caret-down fa-angle-down"
      }) : /*#__PURE__*/external_react_default().createElement("i", {
        className: "fa fa-caret-down"
      });
      var more_results_indicator = !data.duplicates ? "" : /*#__PURE__*/external_react_default().createElement("div", {
        className: "similar-trigger-box",
        onClick: this.toggleDuplicates
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "similar-title int-he"
      }, data.duplicates.length, " ", data.duplicates.length > 1 ? " גרסאות נוספות" : " גרסה נוספת"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "similar-title int-en"
      }, data.duplicates.length, " more version", data.duplicates.length > 1 ? "s" : null), more_results_caret);
      var shown_duplicates = data.duplicates && this.state.duplicatesShown ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "similar-results"
      }, data.duplicates.filter(function (result) {
        return !!result._source.version;
      }).map(function (result) {
        var key = result._source.ref + "-" + result._source.version;
        return /*#__PURE__*/external_react_default().createElement(SearchTextResult, {
          data: result,
          key: key,
          query: this.props.query,
          onResultClick: this.props.onResultClick
        });
      }.bind(this))) : null;
      var snippetMarkup = this.get_snippet_markup(data);
      var snippetClasses = external_classnames_default()({
        snippet: 1,
        en: snippetMarkup.lang == "en",
        he: snippetMarkup.lang == "he"
      });
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "result textResult"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: href,
        onClick: this.handleResultClick
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "result-title"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: {
          en: s.ref,
          he: s.heRef
        }
      }))), /*#__PURE__*/external_react_default().createElement(ColorBarBox, {
        tref: s.ref
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: snippetClasses,
        dangerouslySetInnerHTML: snippetMarkup.markup
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "version"
      }, sefaria.interfaceLang === 'hebrew' && s.hebrew_version_title || s.version), more_results_indicator, shown_duplicates);
    }
  }]);
  return SearchTextResult;
}((external_react_class_default()));
SearchTextResult.propTypes = {
  query: (external_prop_types_default()).string,
  data: (external_prop_types_default()).object,
  onResultClick: (external_prop_types_default()).func
};
/* harmony default export */ const js_SearchTextResult = (SearchTextResult);
;// CONCATENATED MODULE: ../static/js/SearchSheetResult.jsx
function SearchSheetResult_typeof(obj) { "@babel/helpers - typeof"; return SearchSheetResult_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, SearchSheetResult_typeof(obj); }
function SearchSheetResult_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function SearchSheetResult_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, SearchSheetResult_toPropertyKey(descriptor.key), descriptor); } }
function SearchSheetResult_createClass(Constructor, protoProps, staticProps) { if (protoProps) SearchSheetResult_defineProperties(Constructor.prototype, protoProps); if (staticProps) SearchSheetResult_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function SearchSheetResult_toPropertyKey(arg) { var key = SearchSheetResult_toPrimitive(arg, "string"); return SearchSheetResult_typeof(key) === "symbol" ? key : String(key); }
function SearchSheetResult_toPrimitive(input, hint) { if (SearchSheetResult_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (SearchSheetResult_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function SearchSheetResult_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) SearchSheetResult_setPrototypeOf(subClass, superClass); }
function SearchSheetResult_setPrototypeOf(o, p) { SearchSheetResult_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return SearchSheetResult_setPrototypeOf(o, p); }
function SearchSheetResult_createSuper(Derived) { var hasNativeReflectConstruct = SearchSheetResult_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = SearchSheetResult_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = SearchSheetResult_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return SearchSheetResult_possibleConstructorReturn(this, result); }; }
function SearchSheetResult_possibleConstructorReturn(self, call) { if (call && (SearchSheetResult_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return SearchSheetResult_assertThisInitialized(self); }
function SearchSheetResult_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function SearchSheetResult_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function SearchSheetResult_getPrototypeOf(o) { SearchSheetResult_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return SearchSheetResult_getPrototypeOf(o); }







var SearchSheetResult = /*#__PURE__*/function (_Component) {
  SearchSheetResult_inherits(SearchSheetResult, _Component);
  var _super = SearchSheetResult_createSuper(SearchSheetResult);
  function SearchSheetResult() {
    SearchSheetResult_classCallCheck(this, SearchSheetResult);
    return _super.apply(this, arguments);
  }
  SearchSheetResult_createClass(SearchSheetResult, [{
    key: "handleSheetClick",
    value: function handleSheetClick(e) {
      var s = this.props.data._source;
      if (this.props.onResultClick) {
        e.preventDefault();
        this.props.onResultClick("Sheet " + s.sheetId);
      }
      sefaria.track.event("Search", "Search Result Sheet Click", "".concat(this.props.query, " - ").concat(s.sheetId));
    }
  }, {
    key: "handleProfileClick",
    value: function handleProfileClick(e) {
      var s = this.props.data._source;
      sefaria.track.event("Search", "Search Result Sheet Owner Click", "".concat(this.props.query, " - ").concat(s.sheetId, " - ").concat(s.owner_name));
    }
  }, {
    key: "get_snippet_markup",
    value: function get_snippet_markup(data) {
      var snippet = data.highlight.content.join("..."); // data.highlight ? data.highlight.content.join("...") : s.content;
      snippet = snippet.replace(/^[ .,;:!-)\]]+/, "");
      var lang = sefaria.hebrew.isHebrew(snippet) ? "he" : "en";
      return {
        markup: {
          __html: snippet
        },
        lang: lang
      };
    }
  }, {
    key: "render",
    value: function render() {
      var data = this.props.data;
      var s = data._source;
      var clean_title = sefariaJquery("<span>" + s.title + "</span>").text();
      var href = "/sheets/" + s.sheetId;
      var snippetMarkup = this.get_snippet_markup(data);
      var snippetClasses = external_classnames_default()({
        snippet: 1,
        en: snippetMarkup.lang == "en",
        he: snippetMarkup.lang == "he"
      });
      var ownerIsHe = sefaria.hebrew.isHebrew(s.owner_name);
      var titleIsHe = sefaria.hebrew.isHebrew(clean_title);
      var tags = s.tags && s.tags.length ? sefaria.util.zip(s.tags, s.topic_slugs, s.topics_he) : [];
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "result sheetResult"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: href,
        onClick: this.handleSheetClick
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: external_classnames_default()({
          'result-title': 1,
          'in-en': !titleIsHe,
          'in-he': titleIsHe
        })
      }, /*#__PURE__*/external_react_default().createElement("span", {
        dir: titleIsHe ? "rtl" : "ltr"
      }, clean_title)), /*#__PURE__*/external_react_default().createElement(ColorBarBox, {
        tref: "Sheet 1"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: snippetClasses
      }, /*#__PURE__*/external_react_default().createElement("span", {
        dir: snippetMarkup.lang === 'he' ? "rtl" : "ltr",
        dangerouslySetInnerHTML: snippetMarkup.markup
      })))), /*#__PURE__*/external_react_default().createElement("div", {
        className: "sheetData sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        className: "ownerData sans-serif",
        href: s.profile_url,
        onClick: this.handleProfileClick
      }, /*#__PURE__*/external_react_default().createElement(ProfilePic, {
        url: s.owner_image,
        name: s.owner_name,
        len: 30
      }), /*#__PURE__*/external_react_default().createElement("span", {
        className: external_classnames_default()({
          'ownerName': 1,
          'in-en': !ownerIsHe,
          'in-he': ownerIsHe
        })
      }, s.owner_name)), /*#__PURE__*/external_react_default().createElement("span", {
        className: "tagsViews"
      }, tags.map(function (topic, i) {
        return /*#__PURE__*/external_react_default().createElement("a", {
          href: "/topics/".concat(topic[1]),
          target: "_blank",
          key: "link".concat(topic[1]).concat(i)
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
          text: {
            en: topic[0],
            he: topic[2]
          }
        }));
      }))));
    }
  }]);
  return SearchSheetResult;
}((external_react_class_default()));
SearchSheetResult.propTypes = {
  query: (external_prop_types_default()).string,
  data: (external_prop_types_default()).object,
  onResultClick: (external_prop_types_default()).func
};
/* harmony default export */ const js_SearchSheetResult = (SearchSheetResult);
;// CONCATENATED MODULE: ../static/js/SearchFilters.jsx
function SearchFilters_typeof(obj) { "@babel/helpers - typeof"; return SearchFilters_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, SearchFilters_typeof(obj); }
function SearchFilters_slicedToArray(arr, i) { return SearchFilters_arrayWithHoles(arr) || SearchFilters_iterableToArrayLimit(arr, i) || SearchFilters_unsupportedIterableToArray(arr, i) || SearchFilters_nonIterableRest(); }
function SearchFilters_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function SearchFilters_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return SearchFilters_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return SearchFilters_arrayLikeToArray(o, minLen); }
function SearchFilters_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function SearchFilters_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function SearchFilters_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function SearchFilters_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function SearchFilters_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, SearchFilters_toPropertyKey(descriptor.key), descriptor); } }
function SearchFilters_createClass(Constructor, protoProps, staticProps) { if (protoProps) SearchFilters_defineProperties(Constructor.prototype, protoProps); if (staticProps) SearchFilters_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function SearchFilters_toPropertyKey(arg) { var key = SearchFilters_toPrimitive(arg, "string"); return SearchFilters_typeof(key) === "symbol" ? key : String(key); }
function SearchFilters_toPrimitive(input, hint) { if (SearchFilters_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (SearchFilters_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function SearchFilters_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) SearchFilters_setPrototypeOf(subClass, superClass); }
function SearchFilters_setPrototypeOf(o, p) { SearchFilters_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return SearchFilters_setPrototypeOf(o, p); }
function SearchFilters_createSuper(Derived) { var hasNativeReflectConstruct = SearchFilters_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = SearchFilters_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = SearchFilters_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return SearchFilters_possibleConstructorReturn(this, result); }; }
function SearchFilters_possibleConstructorReturn(self, call) { if (call && (SearchFilters_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return SearchFilters_assertThisInitialized(self); }
function SearchFilters_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function SearchFilters_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function SearchFilters_getPrototypeOf(o) { SearchFilters_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return SearchFilters_getPrototypeOf(o); }









var SearchFilters = /*#__PURE__*/function (_Component) {
  SearchFilters_inherits(SearchFilters, _Component);
  var _super = SearchFilters_createSuper(SearchFilters);
  function SearchFilters(props) {
    var _this;
    SearchFilters_classCallCheck(this, SearchFilters);
    _this = _super.call(this, props);
    _this.state = {
      isExactSearch: props.searchState.field === props.searchState.fieldExact
    };
    return _this;
  }
  SearchFilters_createClass(SearchFilters, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(newProps) {
      // Save current filters
      // todo: check for cases when we want to rebuild / not
      var _this$props$searchSta = this.props.searchState,
        field = _this$props$searchSta.field,
        fieldExact = _this$props$searchSta.fieldExact;
      if (newProps.query != this.props.query || newProps.searchState.availableFilters.length !== this.props.searchState.availableFilters.length) {
        this.setState({
          isExactSearch: field === fieldExact
        });
      }
    }
  }, {
    key: "getSelectedTitles",
    value: function getSelectedTitles(lang) {
      var results = [];
      for (var i = 0; i < this.props.searchState.availableFilters.length; i++) {
        var tempSelected = this.props.searchState.availableFilters[i].getSelectedTitles(lang);
        results = results.concat(tempSelected);
      }
      return results;
    }
  }, {
    key: "toggleExactSearch",
    value: function toggleExactSearch() {
      var newExactSearch = !this.state.isExactSearch;
      if (newExactSearch) {
        this.props.updateAppliedOptionField(this.props.searchState.fieldExact);
      } else {
        this.props.updateAppliedOptionField(this.props.searchState.fieldBroad);
      }
      this.setState({
        isExactSearch: newExactSearch
      });
    }
  }, {
    key: "render",
    value: function render() {
      var filters = this.props.type === 'text' ? /*#__PURE__*/external_react_default().createElement(TextSearchFilters, {
        toggleExactSearch: this.toggleExactSearch,
        openedCategory: this.state.openedCategory,
        openedCategoryBooks: this.state.openedCategoryBooks,
        updateAppliedFilter: this.props.updateAppliedFilter,
        availableFilters: this.props.searchState.availableFilters,
        isExactSearch: this.props.searchState.fieldExact === this.props.searchState.field
      }) : /*#__PURE__*/external_react_default().createElement(SheetSearchFilters, {
        updateAppliedFilter: this.props.updateAppliedFilter,
        availableFilters: this.props.searchState.availableFilters
      });
      var _this$props = this.props,
        searchState = _this$props.searchState,
        type = _this$props.type,
        updateAppliedOptionSort = _this$props.updateAppliedOptionSort;
      var sortOptions = sefaria_searchState.metadataByType[type].sortTypeArray.map(function (data) {
        return {
          name: data.type,
          content: /*#__PURE__*/external_react_default().createElement(InterfaceText, null, data.name),
          role: "radio",
          ariaLabel: sefaria._("Sort by") + " " + sefaria._(data.name)
        };
      });
      return sefaria.multiPanel && !this.props.compare ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchFilters navSidebarModule"
      }, filters) : /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "mobileSearchFiltersHeader sans-serif"
      }, /*#__PURE__*/external_react_default().createElement(CloseButton, {
        onClick: this.props.closeMobileFilters
      }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Filters"), /*#__PURE__*/external_react_default().createElement("div", null)), /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchFilters navSidebarModule"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchFilterGroup"
      }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sort by")), /*#__PURE__*/external_react_default().createElement(ToggleSet, {
        ariaLabel: "Sort by",
        name: "sortBy",
        options: sortOptions,
        setOption: function setOption(set, sortType) {
          return updateAppliedOptionSort(sortType);
        },
        currentValue: searchState.sortType,
        blueStyle: true
      })), filters), /*#__PURE__*/external_react_default().createElement("div", {
        className: "mobileSearchFiltersFooter"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "button fillWidth",
        onClick: this.props.closeMobileFilters
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Show Results"))));
    }
  }]);
  return SearchFilters;
}((external_react_class_default()));
SearchFilters.propTypes = {
  query: (external_prop_types_default()).string,
  searchState: (external_prop_types_default()).object,
  total: (external_prop_types_default()).number,
  updateAppliedFilter: (external_prop_types_default()).func,
  updateAppliedOptionField: (external_prop_types_default()).func,
  updateAppliedOptionSort: (external_prop_types_default()).func,
  isQueryRunning: (external_prop_types_default()).bool,
  type: (external_prop_types_default()).string
};
var TextSearchFilters = /*#__PURE__*/function (_Component2) {
  SearchFilters_inherits(TextSearchFilters, _Component2);
  var _super2 = SearchFilters_createSuper(TextSearchFilters);
  function TextSearchFilters() {
    SearchFilters_classCallCheck(this, TextSearchFilters);
    return _super2.apply(this, arguments);
  }
  SearchFilters_createClass(TextSearchFilters, [{
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchFilterBoxes"
      }, /*#__PURE__*/external_react_default().createElement(SearchFilterGroup, {
        name: "Texts",
        searchable: true,
        filters: this.props.availableFilters,
        updateSelected: this.props.updateAppliedFilter,
        expandable: true
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchFilterGroup"
      }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Options")), /*#__PURE__*/external_react_default().createElement(SearchFilterExactBox, {
        selected: this.props.isExactSearch,
        checkBoxClick: this.props.toggleExactSearch
      })));
    }
  }]);
  return TextSearchFilters;
}((external_react_class_default()));
TextSearchFilters.propTypes = {
  availableFilters: (external_prop_types_default()).array,
  openedCategory: (external_prop_types_default()).object,
  updateAppliedFilter: (external_prop_types_default()).func,
  openedCategoryBooks: (external_prop_types_default()).array,
  isExactSearch: (external_prop_types_default()).bool,
  toggleExactSearch: (external_prop_types_default()).func
};
var SearchFilterGroup = function SearchFilterGroup(_ref) {
  var name = _ref.name,
    filters = _ref.filters,
    updateSelected = _ref.updateSelected,
    expandable = _ref.expandable,
    paged = _ref.paged,
    searchable = _ref.searchable;
  if (!filters || !filters.length) {
    return null;
  }
  (0,external_react_.useEffect)(function () {
    var _document$getElementB, _document$getElementB2;
    var filterValue = (_document$getElementB = document.getElementById("filter".concat(name))) !== null && _document$getElementB !== void 0 && _document$getElementB.value ? (_document$getElementB2 = document.getElementById("filter".concat(name))) === null || _document$getElementB2 === void 0 ? void 0 : _document$getElementB2.value : "";
    updateFilters(filterValue);
  }, [filters]);
  var _useState = (0,external_react_.useState)(filters),
    _useState2 = SearchFilters_slicedToArray(_useState, 2),
    displayedFilters = _useState2[0],
    setFilters = _useState2[1];
  var _useState3 = (0,external_react_.useState)(false),
    _useState4 = SearchFilters_slicedToArray(_useState3, 2),
    showClearInputButton = _useState4[0],
    setShowClearInputButton = _useState4[1];
  var content = displayedFilters.map(function (filter) {
    var _document$getElementB3;
    return /*#__PURE__*/external_react_default().createElement(SearchFilter, {
      filter: filter,
      updateSelected: updateSelected,
      expandable: expandable,
      filterSearchValue: (_document$getElementB3 = document.getElementById("filter".concat(name))) === null || _document$getElementB3 === void 0 ? void 0 : _document$getElementB3.value,
      key: filter.aggKey
    });
  });
  if (name === 'Collections') {
    content.sort(function (a, b) {
      var title = sefaria.interfaceLang === 'english' ? 'title' : 'heTitle';
      return !a.props.filter[title] - !b.props.filter[title]; //first the collections with title in the interface's language
    });
  }

  if (paged) {
    content = /*#__PURE__*/external_react_default().createElement(PagedList, {
      items: content
    });
  }
  var hasWordStartingWithOrSelected = function hasWordStartingWithOrSelected(item, filterValue) {
    var escapedFilterValue = filterValue.replace("-", "\-");
    escapedFilterValue = escapedFilterValue.replace(/[^\w\s\-]/g, "");
    if (item.selected || item.title.match(new RegExp("(?:^|.+\\s)".concat(escapedFilterValue, ".*"), "i")) || item.heTitle.match(new RegExp("(?:^|.+\\s)".concat(escapedFilterValue, ".*"), "i"))) {
      return true;
    } else if (item.children.filter(function (x) {
      return hasWordStartingWithOrSelected(x, escapedFilterValue);
    }).length > 0) {
      return true;
    } else {
      return false;
    }
  };
  var wordSelected = function wordSelected(item) {
    if (item.selected) {
      return -1;
    } else {
      return 1;
    }
  };
  var updateFilters = function updateFilters(text) {
    if (text && text != "") {
      if (!expandable) {
        setFilters(filters.filter(function (x) {
          return hasWordStartingWithOrSelected(x, text);
        }).sort(function (x) {
          return wordSelected(x);
        }));
      } else {
        // don't sort
        setFilters(filters.filter(function (x) {
          return hasWordStartingWithOrSelected(x, text);
        }));
      }
      setShowClearInputButton(true);
    } else {
      if (!expandable) {
        setFilters(filters.sort(function (x) {
          return wordSelected(x);
        }));
      } else {
        setFilters(filters);
      }
      setShowClearInputButton(false);
    }
  };
  var clearInput = function clearInput() {
    document.getElementById("filter".concat(name)).value = "";
    updateFilters("");
  };
  // need hebrew for placeholder/title
  var clearInputButton = /*#__PURE__*/external_react_default().createElement("button", {
    "aria-label": "Clear input",
    onClick: clearInput
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/heavy-x.svg",
    className: "searchFilterIcon",
    "aria-hidden": "true",
    tabIndex: "0"
  }));
  var search = searchable ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "searchBox"
  }, /*#__PURE__*/external_react_default().createElement("input", {
    id: "filter".concat(name),
    className: "searchFiltersInput",
    placeholder: sefaria._("Search ".concat(name)),
    title: "Type to Filter ".concat(name, " Shown"),
    onChange: function onChange(e) {
      return updateFilters(e.target.value);
    }
  }), showClearInputButton ? clearInputButton : null) : null;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "searchFilterGroup"
  }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    context: "SearchFilters"
  }, name)), search, content);
};
var SearchFilterExactBox = /*#__PURE__*/function (_Component3) {
  SearchFilters_inherits(SearchFilterExactBox, _Component3);
  var _super3 = SearchFilters_createSuper(SearchFilterExactBox);
  function SearchFilterExactBox() {
    SearchFilters_classCallCheck(this, SearchFilterExactBox);
    return _super3.apply(this, arguments);
  }
  SearchFilters_createClass(SearchFilterExactBox, [{
    key: "handleClick",
    value: function handleClick() {
      this.props.checkBoxClick();
    }
  }, {
    key: "handleKeyPress",
    value: function handleKeyPress(e) {
      if (e.charCode == 13) {
        // enter
        this.handleClick(e);
      }
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("li", null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "checkboxAndText"
      }, /*#__PURE__*/external_react_default().createElement("input", {
        type: "checkbox",
        id: "searchFilterExactBox",
        className: "filter",
        checked: this.props.selected,
        onChange: this.handleClick
      }), /*#__PURE__*/external_react_default().createElement("label", {
        tabIndex: "0",
        onClick: this.handleClick,
        onKeyDown: this.handleKeyDown,
        onKeyPress: this.handleKeyPress
      }, /*#__PURE__*/external_react_default().createElement("span", null)), /*#__PURE__*/external_react_default().createElement("span", {
        className: "filter-title"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Exact Matches Only"))));
    }
  }]);
  return SearchFilterExactBox;
}((external_react_class_default()));
SearchFilterExactBox.propTypes = {
  selected: (external_prop_types_default()).bool,
  checkBoxClick: (external_prop_types_default()).func
};
var SearchFilter = /*#__PURE__*/function (_Component4) {
  SearchFilters_inherits(SearchFilter, _Component4);
  var _super4 = SearchFilters_createSuper(SearchFilter);
  function SearchFilter(props) {
    var _this2;
    SearchFilters_classCallCheck(this, SearchFilter);
    _this2 = _super4.call(this, props);
    _this2.state = {
      expanded: false,
      selected: props.filter.selected
    };
    return _this2;
  }
  SearchFilters_createClass(SearchFilter, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(newProps) {
      if (newProps.filter.selected != this.state.selected) {
        this.setState({
          selected: newProps.filter.selected
        });
      }
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      // Can't set indeterminate in the render phase.  https://github.com/facebook/react/issues/1798
      external_react_dom_default().findDOMNode(this).querySelector("input").indeterminate = this.props.filter.isPartial();
      if (this.props.filter.isPartial()) {
        external_react_dom_default().findDOMNode(this).querySelector("label").setAttribute("aria-checked", "mixed");
      } else {
        external_react_dom_default().findDOMNode(this).querySelector("label").setAttribute("aria-checked", this.state.selected == 1);
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      external_react_dom_default().findDOMNode(this).querySelector("input").indeterminate = this.props.filter.isPartial();
      if (this.props.filter.isPartial()) {
        external_react_dom_default().findDOMNode(this).querySelector("label").setAttribute("aria-checked", "mixed");
      } else {
        external_react_dom_default().findDOMNode(this).querySelector("label").setAttribute("aria-checked", this.state.selected == 1);
      }
    }
  }, {
    key: "handleFilterClick",
    value: function handleFilterClick(evt) {
      this.props.updateSelected(this.props.filter);
    }
  }, {
    key: "toggleExpanded",
    value: function toggleExpanded() {
      this.props.expandable && this.setState({
        expanded: !this.state.expanded
      });
    }
  }, {
    key: "handleKeyPress",
    value: function handleKeyPress(e) {
      if (e.charCode == 13) {
        // enter
        this.handleFilterClick(e);
      }
    }
  }, {
    key: "handleExpandKeyPress",
    value: function handleExpandKeyPress(e) {
      if (e.charCode == 13) {
        // enter
        this.toggleExpanded();
      }
    }
  }, {
    key: "autoExpand",
    value: function autoExpand(filter) {
      return this.props.filterSearchValue !== undefined && this.props.filterSearchValue !== null && this.props.filterSearchValue !== "" && this.props.expandable && filter.getLeafNodes(this.props.filterSearchValue).length > 0;
    }
  }, {
    key: "render",
    value: function render() {
      var _this3 = this;
      var _this$props2 = this.props,
        filter = _this$props2.filter,
        expandable = _this$props2.expandable;
      var toggleMessage = "Press enter to toggle search filter for " + filter.title + ".";
      var expandMessage = "Press enter to toggle the list of specific books within " + filter.title + " to filter by.";
      return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("li", null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "checkboxAndText"
      }, /*#__PURE__*/external_react_default().createElement("input", {
        type: "checkbox",
        id: filter.aggKey,
        className: "filter",
        checked: this.state.selected == 1,
        onChange: this.handleFilterClick
      }), /*#__PURE__*/external_react_default().createElement("label", {
        onClick: this.handleFilterClick,
        id: "label-for-" + this.props.filter.aggKey,
        tabIndex: "0",
        onKeyDown: this.handleKeyDown,
        onKeyPress: this.handleKeyPress,
        "aria-label": toggleMessage
      }, /*#__PURE__*/external_react_default().createElement("span", null)), /*#__PURE__*/external_react_default().createElement("span", {
        className: "searchFilterTitle",
        onClick: expandable ? this.toggleExpanded : this.handleFilterClick,
        onKeyPress: expandable ? this.handleExpandKeyPress : this.handleKeyPress,
        tabIndex: expandable ? "0" : null,
        "aria-label": expandable ? expandMessage : toggleMessage
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: {
          en: filter.title,
          he: filter.heTitle
        }
      }), "\xA0", /*#__PURE__*/external_react_default().createElement("span", {
        className: "filter-count"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "(".concat(filter.docCount, ")"))))), this.props.expandable ? /*#__PURE__*/external_react_default().createElement("i", {
        className: "fa fa-angle-down",
        onClick: this.toggleExpanded
      }) : null), this.state.expanded || this.autoExpand(filter) ? /*#__PURE__*/external_react_default().createElement("li", null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchFilterBooks"
      }, filter.getLeafNodes(this.props.filterSearchValue).map(function (subFilter) {
        return /*#__PURE__*/external_react_default().createElement(SearchFilter, {
          filter: subFilter,
          updateSelected: _this3.props.updateSelected,
          key: subFilter.aggKey
        });
      }))) : null);
    }
  }]);
  return SearchFilter;
}((external_react_class_default()));
SearchFilter.propTypes = {
  filter: (external_prop_types_default()).object.isRequired,
  expandable: (external_prop_types_default()).bool,
  updateSelected: (external_prop_types_default()).func.isRequired
};
var SheetSearchFilters = /*#__PURE__*/function (_Component5) {
  SearchFilters_inherits(SheetSearchFilters, _Component5);
  var _super5 = SearchFilters_createSuper(SheetSearchFilters);
  function SheetSearchFilters() {
    SearchFilters_classCallCheck(this, SheetSearchFilters);
    return _super5.apply(this, arguments);
  }
  SearchFilters_createClass(SheetSearchFilters, [{
    key: "render",
    value: function render() {
      var collectionFilters = this.props.availableFilters.filter(function (filter) {
        return filter.aggType === 'collections' && (filter.title || filter.heTitle);
      });
      var tagFilters = this.props.availableFilters.filter(function (filter) {
        return filter.aggType.match(/^topics/) && (filter.title || filter.heTitle);
      });
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchFilterBoxes",
        role: "dialog"
      }, /*#__PURE__*/external_react_default().createElement(SearchFilterGroup, {
        name: "Topics",
        filters: tagFilters,
        updateSelected: this.props.updateAppliedFilter,
        paged: true,
        searchable: true
      }), /*#__PURE__*/external_react_default().createElement(SearchFilterGroup, {
        name: "Collections",
        filters: collectionFilters,
        updateSelected: this.props.updateAppliedFilter,
        paged: true
      }));
    }
  }]);
  return SheetSearchFilters;
}((external_react_class_default()));
SheetSearchFilters.propTypes = {
  updateAppliedFilter: (external_prop_types_default()).func.isRequired,
  availableFilters: (external_prop_types_default()).array.isRequired
};
var PagedList = function PagedList(_ref2) {
  var items = _ref2.items,
    _ref2$initial = _ref2.initial,
    initial = _ref2$initial === void 0 ? 8 : _ref2$initial,
    _ref2$pageSize = _ref2.pageSize,
    pageSize = _ref2$pageSize === void 0 ? 20 : _ref2$pageSize;
  var _useState5 = (0,external_react_.useState)(initial),
    _useState6 = SearchFilters_slicedToArray(_useState5, 2),
    cutoff = _useState6[0],
    setCutoff = _useState6[1];
  return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, items.slice(0, cutoff), items.length > cutoff ? /*#__PURE__*/external_react_default().createElement("button", {
    className: "showMore sans-serif",
    onClick: function onClick() {
      setCutoff(cutoff + pageSize);
    }
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    context: "SearchFilters"
  }, "See More")) : null);
};
/* harmony default export */ const js_SearchFilters = (SearchFilters);
;// CONCATENATED MODULE: ../static/js/SearchResultList.jsx
function SearchResultList_typeof(obj) { "@babel/helpers - typeof"; return SearchResultList_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, SearchResultList_typeof(obj); }
function SearchResultList_toConsumableArray(arr) { return SearchResultList_arrayWithoutHoles(arr) || SearchResultList_iterableToArray(arr) || SearchResultList_unsupportedIterableToArray(arr) || SearchResultList_nonIterableSpread(); }
function SearchResultList_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function SearchResultList_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function SearchResultList_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return SearchResultList_arrayLikeToArray(arr); }
function SearchResultList_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = SearchResultList_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function SearchResultList_slicedToArray(arr, i) { return SearchResultList_arrayWithHoles(arr) || SearchResultList_iterableToArrayLimit(arr, i) || SearchResultList_unsupportedIterableToArray(arr, i) || SearchResultList_nonIterableRest(); }
function SearchResultList_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function SearchResultList_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return SearchResultList_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return SearchResultList_arrayLikeToArray(o, minLen); }
function SearchResultList_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function SearchResultList_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function SearchResultList_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function SearchResultList_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ SearchResultList_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == SearchResultList_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function SearchResultList_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function SearchResultList_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { SearchResultList_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { SearchResultList_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function SearchResultList_defineProperty(obj, key, value) { key = SearchResultList_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function SearchResultList_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function SearchResultList_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, SearchResultList_toPropertyKey(descriptor.key), descriptor); } }
function SearchResultList_createClass(Constructor, protoProps, staticProps) { if (protoProps) SearchResultList_defineProperties(Constructor.prototype, protoProps); if (staticProps) SearchResultList_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function SearchResultList_toPropertyKey(arg) { var key = SearchResultList_toPrimitive(arg, "string"); return SearchResultList_typeof(key) === "symbol" ? key : String(key); }
function SearchResultList_toPrimitive(input, hint) { if (SearchResultList_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (SearchResultList_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function SearchResultList_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) SearchResultList_setPrototypeOf(subClass, superClass); }
function SearchResultList_setPrototypeOf(o, p) { SearchResultList_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return SearchResultList_setPrototypeOf(o, p); }
function SearchResultList_createSuper(Derived) { var hasNativeReflectConstruct = SearchResultList_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = SearchResultList_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = SearchResultList_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return SearchResultList_possibleConstructorReturn(this, result); }; }
function SearchResultList_possibleConstructorReturn(self, call) { if (call && (SearchResultList_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return SearchResultList_assertThisInitialized(self); }
function SearchResultList_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function SearchResultList_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function SearchResultList_getPrototypeOf(o) { SearchResultList_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return SearchResultList_getPrototypeOf(o); }















var SourcesSheetsDiv = function SourcesSheetsDiv(props) {
  var sourcesSheetsCounts = [];
  var sheetsURL, sourcesURL;
  if ((props === null || props === void 0 ? void 0 : props.numSources) > 0 && (props === null || props === void 0 ? void 0 : props.numSheets) > 0) {
    // if there's both, we need to specify two different URLs
    sheetsURL = props.url + "?tab=sheets";
    sourcesURL = props.url + "?tab=sources";
  } else {
    sheetsURL = props.url;
    sourcesURL = props.url;
  }
  if ((props === null || props === void 0 ? void 0 : props.numSources) > 0) {
    var sourcesDiv = /*#__PURE__*/external_react_default().createElement("span", null, /*#__PURE__*/external_react_default().createElement("a", {
      href: sourcesURL
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, props.numSources), " ", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sources")));
    sourcesSheetsCounts.push(sourcesDiv);
  }
  if ((props === null || props === void 0 ? void 0 : props.numSheets) > 0) {
    var sheetsDiv = /*#__PURE__*/external_react_default().createElement("span", null, /*#__PURE__*/external_react_default().createElement("a", {
      href: sheetsURL
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, props.numSheets), " ", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sheets")));
    sourcesSheetsCounts.push(sheetsDiv);
  }
  if (sourcesSheetsCounts.length === 0) {
    return null;
  } else {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "topicSourcesSheets systemText"
    }, sourcesSheetsCounts.reduce(function (prev, curr) {
      return [prev, " ∙ ", curr];
    }));
  }
};
var SearchTopic = function SearchTopic(props) {
  var sourcesSheetsDiv = /*#__PURE__*/external_react_default().createElement(SourcesSheetsDiv, {
    url: props.topic.url,
    numSheets: props.topic.numSheets,
    numSources: props.topic.numSources
  });
  var topicTitle = /*#__PURE__*/external_react_default().createElement("div", {
    className: "topicTitle"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement("a", {
    href: props.topic.url,
    onClick: function onClick() {
      return sefaria.track.event("Search", "topic in search click", props.topic.analyticCat + "|" + props.topic.title);
    }
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: props.topic.title,
      he: props.topic.heTitle
    }
  }))));
  var topicCategory = /*#__PURE__*/external_react_default().createElement("div", {
    className: "topicCategory sectionTitleText"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: props.topic.topicCat,
      he: props.topic.heTopicCat
    }
  }));
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "searchTopic"
  }, topicTitle, topicCategory, "enDesc" in props.topic ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "topicDescSearchResult systemText"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: props.topic.enDesc,
      he: props.topic.heDesc
    }
  })) : null, sourcesSheetsDiv);
};
var SearchResultList = /*#__PURE__*/function (_Component) {
  SearchResultList_inherits(SearchResultList, _Component);
  var _super = SearchResultList_createSuper(SearchResultList);
  function SearchResultList(props) {
    var _this;
    SearchResultList_classCallCheck(this, SearchResultList);
    _this = _super.call(this, props);
    _this.types = _this.props.types || ['text', 'sheet'];
    _this.querySize = {
      "text": 50,
      "sheet": 20
    };
    _this.state = {
      runningQueries: _this._typeObjDefault(null),
      isQueryRunning: _this._typeObjDefault(false),
      moreToLoad: _this._typeObjDefault(true),
      totals: _this._typeObjDefault(0),
      pagesLoaded: _this._typeObjDefault(0),
      hits: _this._typeObjDefault([]),
      error: false,
      topics: []
    };

    // Load search results from cache so they are available for immediate render
    _this.types.map(function (t) {
      var args = _this._getQueryArgs(props, t);
      var cachedQuery = sefaria.search.getCachedQuery(args);
      while (cachedQuery) {
        // Load all pages of results that are available in cache, so if page X was
        // previously loaded it will be returned.
        //console.log("Loaded cached query for")
        //console.log(args);
        _this.state.hits[t] = _this.state.hits[t].concat(cachedQuery.hits.hits);
        _this.state.totals[t] = cachedQuery.hits.total;
        _this.state.pagesLoaded[t] += 1;
        args.start = _this.state.pagesLoaded[t] * _this.querySize[t];
        if (t === "text") {
          // Since texts only have one filter type, aggregations are only requested once on first page
          args.aggregationsToUpdate = [];
        }
        cachedQuery = sefaria.search.getCachedQuery(args);
      }
    });
    _this.updateTotalResults();
    return _this;
  }
  SearchResultList_createClass(SearchResultList, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this._executeAllQueries();
      sefariaJquery(external_react_dom_default().findDOMNode(this)).closest(".content").on("scroll.infiteScroll", this.handleScroll);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this._abortRunningQueries(); // todo: make this work w/ promises
      sefariaJquery(external_react_dom_default().findDOMNode(this)).closest(".content").off("scroll.infiniteScroll", this.handleScroll);
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(newProps) {
      var _this2 = this;
      if (this.props.query !== newProps.query) {
        this.setState({
          totals: this._typeObjDefault(0),
          hits: this._typeObjDefault([]),
          moreToLoad: this._typeObjDefault(true)
        });
        this._executeAllQueries(newProps);
      } else {
        this.types.forEach(function (t) {
          if (_this2._shouldUpdateQuery(_this2.props, newProps, t)) {
            var state = {
              hits: external_extend_default()(_this2.state.hits, SearchResultList_defineProperty({}, t, [])),
              pagesLoaded: external_extend_default()(_this2.state.pagesLoaded, SearchResultList_defineProperty({}, t, 0)),
              moreToLoad: external_extend_default()(_this2.state.moreToLoad, SearchResultList_defineProperty({}, t, true))
            };
            _this2.setState(state);
            _this2._executeQuery(newProps, t);
          }
        });
      }
    }
  }, {
    key: "addRefTopic",
    value: function () {
      var _addRefTopic = SearchResultList_asyncToGenerator( /*#__PURE__*/SearchResultList_regeneratorRuntime().mark(function _callee(topic) {
        var book;
        return SearchResultList_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return sefaria.getIndexDetails(topic.key);
            case 2:
              book = _context.sent;
              return _context.abrupt("return", {
                enDesc: book.enDesc || book.enShortDesc,
                heDesc: book.heDesc || book.heShortDesc,
                title: book.title,
                heTitle: book.heTitle,
                topicCat: book.categories[0],
                heTopicCat: sefaria.toc.filter(function (cat) {
                  return cat.category === book.categories[0];
                })[0].heCategory,
                url: "/" + book.title,
                analyticCat: "Book"
              });
            case 4:
            case "end":
              return _context.stop();
          }
        }, _callee);
      }));
      function addRefTopic(_x) {
        return _addRefTopic.apply(this, arguments);
      }
      return addRefTopic;
    }()
  }, {
    key: "addTOCCategoryTopic",
    value: function addTOCCategoryTopic(topic) {
      var topicKeyArr = topic.key.slice();
      var lastCat = topicKeyArr.pop(topicKeyArr - 1); //go up one level in order to get the bottom level's description
      var relevantCats = topicKeyArr.length === 0 ? sefaria.toc : sefaria.tocItemsByCategories(topicKeyArr);
      var relevantSubCat = relevantCats.filter(function (cat) {
        return "category" in cat && cat.category === lastCat;
      })[0];
      return {
        analyticCat: "Category",
        url: "/texts/" + topic.key.join("/"),
        topicCat: "Texts",
        heTopicCat: sefaria.hebrewTerm("Texts"),
        enDesc: relevantSubCat.enDesc,
        heDesc: relevantSubCat.heDesc,
        title: relevantSubCat.category,
        heTitle: relevantSubCat.heCategory
      };
    }
  }, {
    key: "addGeneralTopic",
    value: function () {
      var _addGeneralTopic = SearchResultList_asyncToGenerator( /*#__PURE__*/SearchResultList_regeneratorRuntime().mark(function _callee2(topic) {
        var _d$tabs, _d$tabs2;
        var d, searchTopic, typeObj;
        return SearchResultList_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              _context2.next = 2;
              return sefaria.getTopic(topic.key, {
                annotated: false
              });
            case 2:
              d = _context2.sent;
              searchTopic = {
                analyticCat: "Topic",
                title: d.primaryTitle["en"],
                heTitle: d.primaryTitle["he"],
                numSources: 0,
                numSheets: 0,
                url: "/topics/" + topic.key
              };
              typeObj = sefaria.topicTocCategory(topic.key);
              if (!typeObj) {
                searchTopic.topicCat = "Topics";
                searchTopic.heTopicCat = sefaria.hebrewTranslation("Topics");
              } else {
                searchTopic.topicCat = typeObj["en"];
                searchTopic.heTopicCat = typeObj["he"];
              }
              if ("description" in d) {
                searchTopic.enDesc = d.description["en"];
                searchTopic.heDesc = d.description["he"];
              }
              if ((_d$tabs = d.tabs) !== null && _d$tabs !== void 0 && _d$tabs.sources) {
                searchTopic.numSources = d.tabs.sources.refs.length;
              }
              if ((_d$tabs2 = d.tabs) !== null && _d$tabs2 !== void 0 && _d$tabs2.sheets) {
                searchTopic.numSheets = d.tabs.sheets.refs.length;
              }
              return _context2.abrupt("return", searchTopic);
            case 10:
            case "end":
              return _context2.stop();
          }
        }, _callee2);
      }));
      function addGeneralTopic(_x2) {
        return _addGeneralTopic.apply(this, arguments);
      }
      return addGeneralTopic;
    }()
  }, {
    key: "addCollection",
    value: function () {
      var _addCollection = SearchResultList_asyncToGenerator( /*#__PURE__*/SearchResultList_regeneratorRuntime().mark(function _callee3(collection) {
        var d;
        return SearchResultList_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              _context3.next = 2;
              return sefaria.getCollection(collection.key);
            case 2:
              d = _context3.sent;
              return _context3.abrupt("return", {
                analyticCat: "Collection",
                title: d.name,
                heTitle: d.name,
                url: "/collections/" + collection.key,
                topicCat: "Collections",
                heTopicCat: sefaria.hebrewTranslation("Collections"),
                enDesc: d.description,
                heDesc: d.description,
                numSheets: d.sheets.length
              });
            case 4:
            case "end":
              return _context3.stop();
          }
        }, _callee3);
      }));
      function addCollection(_x3) {
        return _addCollection.apply(this, arguments);
      }
      return addCollection;
    }()
  }, {
    key: "_executeTopicQuery",
    value: function () {
      var _executeTopicQuery2 = SearchResultList_asyncToGenerator( /*#__PURE__*/SearchResultList_regeneratorRuntime().mark(function _callee5() {
        var _this3 = this;
        var d, topics, hasAuthor, searchTopics;
        return SearchResultList_regeneratorRuntime().wrap(function _callee5$(_context5) {
          while (1) switch (_context5.prev = _context5.next) {
            case 0:
              _context5.next = 2;
              return sefaria.getName(this.props.query);
            case 2:
              d = _context5.sent;
              topics = d.completion_objects.filter(function (obj) {
                return obj.title.toUpperCase() === _this3.props.query.toUpperCase();
              });
              hasAuthor = topics.some(function (obj) {
                return obj.type === "AuthorTopic";
              });
              if (hasAuthor) {
                topics = topics.filter(function (obj) {
                  return obj.type !== "TocCategory";
                }); //TocCategory is unhelpful if we have author
              }
              _context5.next = 8;
              return Promise.all(topics.map( /*#__PURE__*/function () {
                var _ref = SearchResultList_asyncToGenerator( /*#__PURE__*/SearchResultList_regeneratorRuntime().mark(function _callee4(t) {
                  return SearchResultList_regeneratorRuntime().wrap(function _callee4$(_context4) {
                    while (1) switch (_context4.prev = _context4.next) {
                      case 0:
                        if (!(t.type === 'ref')) {
                          _context4.next = 6;
                          break;
                        }
                        _context4.next = 3;
                        return _this3.addRefTopic(t);
                      case 3:
                        return _context4.abrupt("return", _context4.sent);
                      case 6:
                        if (!(t.type === 'TocCategory')) {
                          _context4.next = 10;
                          break;
                        }
                        return _context4.abrupt("return", _this3.addTOCCategoryTopic(t));
                      case 10:
                        if (!(t.type === 'Collection')) {
                          _context4.next = 16;
                          break;
                        }
                        _context4.next = 13;
                        return _this3.addCollection(t);
                      case 13:
                        return _context4.abrupt("return", _context4.sent);
                      case 16:
                        _context4.next = 18;
                        return _this3.addGeneralTopic(t);
                      case 18:
                        return _context4.abrupt("return", _context4.sent);
                      case 19:
                      case "end":
                        return _context4.stop();
                    }
                  }, _callee4);
                }));
                return function (_x4) {
                  return _ref.apply(this, arguments);
                };
              }()));
            case 8:
              searchTopics = _context5.sent;
              this.setState({
                topics: searchTopics
              });
            case 10:
            case "end":
              return _context5.stop();
          }
        }, _callee5, this);
      }));
      function _executeTopicQuery() {
        return _executeTopicQuery2.apply(this, arguments);
      }
      return _executeTopicQuery;
    }()
  }, {
    key: "updateRunningQuery",
    value: function updateRunningQuery(type, ajax) {
      this.state.runningQueries[type] = ajax;
      this.state.isQueryRunning[type] = !!ajax;
      this.setState(this.state);
    }
  }, {
    key: "totalResults",
    value: function totalResults() {
      var _this4 = this;
      return this.types.reduce(function (accum, type) {
        return _this4.state.totals[type] + accum;
      }, 0);
    }
  }, {
    key: "updateTotalResults",
    value: function updateTotalResults() {
      this.props.updateTotalResults(this.totalResults());
    }
  }, {
    key: "_typeObjDefault",
    value: function _typeObjDefault(defaultValue) {
      // es6 version of dict comprehension...
      return this.types.reduce(function (obj, k) {
        obj[k] = defaultValue;
        return obj;
      }, {});
    }
  }, {
    key: "_abortRunningQueries",
    value: function _abortRunningQueries() {
      var _this5 = this;
      this.types.forEach(function (t) {
        return _this5._abortRunningQuery(t);
      });
    }
  }, {
    key: "_abortRunningQuery",
    value: function _abortRunningQuery(type) {
      if (this.state.runningQueries[type]) {
        this.state.runningQueries[type].abort(); //todo: make work with promises
      }

      this.updateRunningQuery(type, null);
    }
  }, {
    key: "handleScroll",
    value: function handleScroll() {
      var tab = this.props.tab;
      if (!this.state.moreToLoad[tab]) {
        return;
      }
      if (this.state.runningQueries[tab]) {
        return;
      }
      var $scrollable = sefariaJquery(external_react_dom_default().findDOMNode(this)).closest(".content");
      var margin = 300;
      if ($scrollable.scrollTop() + $scrollable.innerHeight() + margin >= $scrollable[0].scrollHeight) {
        this._loadNextPage(tab);
      }
    }
  }, {
    key: "_shouldUpdateQuery",
    value: function _shouldUpdateQuery(oldProps, newProps, type) {
      var oldSearchState = this._getSearchState(type, oldProps);
      var newSearchState = this._getSearchState(type, newProps);
      return !oldSearchState.isEqual({
        other: newSearchState,
        fields: ['appliedFilters', 'field', 'sortType']
      }) || oldSearchState.filtersValid !== newSearchState.filtersValid && oldSearchState.appliedFilters.length > 0; // Execute a second query to apply filters after an initial query which got available filters
    }
  }, {
    key: "_getSearchState",
    value: function _getSearchState(type, props) {
      props = props || this.props;
      if (!props.query) {
        return;
      }
      return props["".concat(type, "SearchState")];
    }
  }, {
    key: "_executeAllQueries",
    value: function _executeAllQueries(props) {
      var _this6 = this;
      this._executeTopicQuery();
      this.types.forEach(function (t) {
        return _this6._executeQuery(props, t);
      });
    }
  }, {
    key: "_getAggsToUpdate",
    value: function _getAggsToUpdate(filtersValid, aggregation_field_array, aggregation_field_lang_suffix_array, appliedFilterAggTypes, type) {
      // Returns a list of aggregations type which we should request from the server.

      // If there is only on possible filter (i.e. path for text) and filters are valid, no need to request again for any filter interactions
      if (filtersValid && aggregation_field_array.length === 1) {
        return [];
      }
      return sefaria.util.zip(aggregation_field_array, aggregation_field_lang_suffix_array).map(function (_ref2) {
        var _ref3 = SearchResultList_slicedToArray(_ref2, 2),
          agg = _ref3[0],
          suffix_map = _ref3[1];
        return "".concat(agg).concat(suffix_map ? suffix_map[sefaria.interfaceLang] : '');
      }); // add suffix based on interfaceLang to filter, if present in suffix_map
    }
  }, {
    key: "_executeQuery",
    value: function _executeQuery(props, type) {
      var _this7 = this;
      //This takes a props object, so as to be able to handle being called from componentWillReceiveProps with newProps
      props = props || this.props;
      if (!props.query) {
        return;
      }
      this._abortRunningQuery(type);
      var args = this._getQueryArgs(props, type);

      // If there are no available filters yet, don't apply filters.  Split into two queries:
      // 1) Get all potential filters and counts
      // 2) Apply filters (Triggered from componentWillReceiveProps)

      var request_applied = args.applied_filters;
      var searchState = this._getSearchState(type, props);
      var appliedFilters = searchState.appliedFilters,
        appliedFilterAggTypes = searchState.appliedFilterAggTypes;
      var _SearchState$metadata = sefaria_searchState.metadataByType[type],
        aggregation_field_array = _SearchState$metadata.aggregation_field_array,
        build_and_apply_filters = _SearchState$metadata.build_and_apply_filters;
      args.success = function (data) {
        _this7.updateRunningQuery(type, null);
        if (_this7.state.pagesLoaded[type] === 0) {
          // Skip if pages have already been loaded from cache, but let aggregation processing below occur
          var state = {
            hits: external_extend_default()(_this7.state.hits, SearchResultList_defineProperty({}, type, data.hits.hits)),
            totals: external_extend_default()(_this7.state.totals, SearchResultList_defineProperty({}, type, data.hits.total)),
            pagesLoaded: external_extend_default()(_this7.state.pagesLoaded, SearchResultList_defineProperty({}, type, 1)),
            moreToLoad: external_extend_default()(_this7.state.moreToLoad, SearchResultList_defineProperty({}, type, data.hits.total > _this7.querySize[type]))
          };
          _this7.setState(state, function () {
            _this7.updateTotalResults();
            _this7.handleScroll();
          });
          var filter_label = request_applied && request_applied.length > 0 ? ' - ' + request_applied.join('|') : '';
          var query_label = props.query + filter_label;
          sefaria.track.event("Search", "".concat(_this7.props.searchInBook ? "SidebarSearch " : "", "Query: ").concat(type), query_label, data.hits.total);
        }
        if (data.aggregations) {
          var availableFilters = [];
          var registry = {};
          var orphans = [];
          var _iterator = SearchResultList_createForOfIteratorHelper(args.aggregationsToUpdate),
            _step;
          try {
            for (_iterator.s(); !(_step = _iterator.n()).done;) {
              var aggregation = _step.value;
              if (!!data.aggregations[aggregation]) {
                var buckets = data.aggregations[aggregation].buckets;
                var _Sefaria$search$build = sefaria.search[build_and_apply_filters](buckets, appliedFilters, appliedFilterAggTypes, aggregation),
                  tempAvailable = _Sefaria$search$build.availableFilters,
                  tempRegistry = _Sefaria$search$build.registry,
                  tempOrphans = _Sefaria$search$build.orphans;
                availableFilters.push.apply(availableFilters, SearchResultList_toConsumableArray(tempAvailable)); // array concat
                registry = external_extend_default()(registry, tempRegistry);
                orphans.push.apply(orphans, SearchResultList_toConsumableArray(tempOrphans));
              }
            }
          } catch (err) {
            _iterator.e(err);
          } finally {
            _iterator.f();
          }
          _this7.props.registerAvailableFilters(type, availableFilters, registry, orphans, args.aggregationsToUpdate);
        }
      };
      args.error = this._handleError;
      var runningQuery = sefaria.search.execute_query(args);
      this.updateRunningQuery(type, runningQuery);
    }
  }, {
    key: "_getQueryArgs",
    value: function _getQueryArgs(props, type) {
      props = props || this.props;
      var searchState = this._getSearchState(type, props);
      var field = searchState.field,
        fieldExact = searchState.fieldExact,
        sortType = searchState.sortType,
        filtersValid = searchState.filtersValid,
        appliedFilters = searchState.appliedFilters,
        appliedFilterAggTypes = searchState.appliedFilterAggTypes;
      var request_applied = filtersValid && appliedFilters;
      var _SearchState$metadata2 = sefaria_searchState.metadataByType[type],
        aggregation_field_array = _SearchState$metadata2.aggregation_field_array,
        aggregation_field_lang_suffix_array = _SearchState$metadata2.aggregation_field_lang_suffix_array;
      var aggregationsToUpdate = this._getAggsToUpdate(filtersValid, aggregation_field_array, aggregation_field_lang_suffix_array, appliedFilterAggTypes, type);
      return {
        query: props.query,
        type: type,
        applied_filters: request_applied,
        appliedFilterAggTypes: appliedFilterAggTypes,
        aggregationsToUpdate: aggregationsToUpdate,
        size: this.querySize[type],
        field: field,
        sort_type: sortType,
        exact: fieldExact === field
      };
    }
  }, {
    key: "_loadNextPage",
    value: function _loadNextPage(type) {
      var _this8 = this;
      console.log("load next page");
      var args = this._getQueryArgs(this.props, type);
      args.start = this.state.pagesLoaded[type] * this.querySize[type];
      args.error = function () {
        return console.log("Failure in SearchResultList._loadNextPage");
      };
      args.success = function (data) {
        var nextHits = _this8.state.hits[type].concat(data.hits.hits);
        _this8.state.hits[type] = nextHits;
        _this8.state.pagesLoaded[type] += 1;
        if (_this8.state.pagesLoaded[type] * _this8.querySize[type] >= _this8.state.totals[type]) {
          _this8.state.moreToLoad[type] = false;
        }
        _this8.setState(_this8.state);
        _this8.updateRunningQuery(type, null);
      };
      var runningNextPageQuery = sefaria.search.execute_query(args);
      this.updateRunningQuery(type, runningNextPageQuery, false);
    }
  }, {
    key: "_handleError",
    value: function _handleError(jqXHR, textStatus, errorThrown) {
      if (textStatus == "abort") {
        // Abort is immediately followed by new query, above.  Worried there would be a race if we call updateCurrentQuery(null) from here
        //this.updateCurrentQuery(null);
        return;
      }
      this.setState({
        error: true
      });
      this.updateRunningQuery(null, null);
    }
  }, {
    key: "showSheets",
    value: function showSheets() {
      this.props.updateTab('sheet');
    }
  }, {
    key: "showTexts",
    value: function showTexts() {
      this.props.updateTab('text');
    }
  }, {
    key: "render",
    value: function render() {
      var _this9 = this;
      if (!this.props.query) {
        // Push this up? Thought is to choose on the SearchPage level whether to show a ResultList or an EmptySearchMessage.
        return null;
      }
      var tab = this.props.tab;
      var searchState = this._getSearchState(tab);
      var results = [];
      if (tab == "text") {
        results = sefaria.search.mergeTextResultsVersions(this.state.hits.text);
        results = results.filter(function (result) {
          return !!result._source.version;
        }).map(function (result) {
          return /*#__PURE__*/external_react_default().createElement(js_SearchTextResult, {
            data: result,
            query: _this9.props.query,
            key: result._id,
            searchInBook: _this9.props.searchInBook,
            onResultClick: _this9.props.onResultClick
          });
        });
        if (this.state.topics.length > 0) {
          var topics = this.state.topics.map(function (t) {
            sefaria.track.event("Search", "topic in search display", t.analyticCat + "|" + t.title);
            return /*#__PURE__*/external_react_default().createElement(SearchTopic, {
              topic: t
            });
          });
          if (results.length > 0) {
            topics = /*#__PURE__*/external_react_default().createElement("div", {
              id: "searchTopics"
            }, topics);
            results.splice(2, 0, topics);
          } else {
            results = topics;
          }
        }
      } else if (tab == "sheet") {
        results = this.state.hits.sheet.map(function (result) {
          return /*#__PURE__*/external_react_default().createElement(js_SearchSheetResult, {
            data: result,
            query: _this9.props.query,
            key: result._id,
            onResultClick: _this9.props.onResultClick
          });
        });
      }
      var loadingMessage = /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
        message: "Searching...",
        heMessage: "\u05DE\u05D1\u05E6\u05E2 \u05D7\u05D9\u05E4\u05D5\u05E9..."
      });
      var noResultsMessage = /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
        message: "0 results.",
        heMessage: "0 \u05EA\u05D5\u05E6\u05D0\u05D5\u05EA."
      });
      var queryFullyLoaded = !this.state.moreToLoad[tab] && !this.state.isQueryRunning[tab];
      var haveResults = !!results.length;
      results = haveResults ? results : noResultsMessage;
      return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchTopMatter"
      }, !this.props.searchInBook ? /*#__PURE__*/external_react_default().createElement(SearchTabs, {
        clickTextButton: this.showTexts,
        clickSheetButton: this.showSheets,
        textTotal: this.state.totals["text"],
        sheetTotal: this.state.totals["sheet"],
        currentTab: tab
      }) : null, sefaria.multiPanel && !this.props.compare ? /*#__PURE__*/external_react_default().createElement(SearchSortBox, {
        type: tab,
        updateAppliedOptionSort: this.props.updateAppliedOptionSort,
        sortType: searchState.sortType
      }) : /*#__PURE__*/external_react_default().createElement(SearchFilterButton, {
        openMobileFilters: this.props.openMobileFilters,
        nFilters: searchState.appliedFilters.length
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchResultList"
      }, queryFullyLoaded || haveResults ? results : null, this.state.isQueryRunning[tab] ? loadingMessage : null));
    }
  }]);
  return SearchResultList;
}((external_react_class_default()));
SearchResultList.propTypes = {
  query: (external_prop_types_default()).string,
  tab: external_prop_types_default().oneOf(["text", "sheet"]),
  textSearchState: (external_prop_types_default()).object,
  sheetSearchState: (external_prop_types_default()).object,
  onResultClick: (external_prop_types_default()).func,
  updateTab: (external_prop_types_default()).func,
  updateAppliedOptionSort: (external_prop_types_default()).func,
  registerAvailableFilters: (external_prop_types_default()).func
};
var SearchTabs = function SearchTabs(_ref4) {
  var clickTextButton = _ref4.clickTextButton,
    clickSheetButton = _ref4.clickSheetButton,
    textTotal = _ref4.textTotal,
    sheetTotal = _ref4.sheetTotal,
    currentTab = _ref4.currentTab;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "type-buttons sans-serif"
  }, /*#__PURE__*/external_react_default().createElement(SearchTab, {
    label: "Sources",
    total: textTotal,
    onClick: clickTextButton,
    active: currentTab === "text"
  }), /*#__PURE__*/external_react_default().createElement(SearchTab, {
    label: "Sheets",
    total: sheetTotal,
    onClick: clickSheetButton,
    active: currentTab === "sheet"
  }));
};
var SearchTab = function SearchTab(_ref5) {
  var label = _ref5.label,
    total = _ref5.total,
    onClick = _ref5.onClick,
    active = _ref5.active;
  total = total.addCommas();
  var classes = external_classnames_default()({
    "search-dropdown-button": 1,
    active: active
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: classes,
    onClick: onClick,
    onKeyPress: function onKeyPress(e) {
      e.charCode === 13 ? onClick(e) : null;
    },
    role: "button",
    tabIndex: "0"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "type-button-title"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, label), "\xA0", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "(".concat(total, ")"))));
};
var SearchSortBox = function SearchSortBox(_ref6) {
  var type = _ref6.type,
    updateAppliedOptionSort = _ref6.updateAppliedOptionSort,
    sortType = _ref6.sortType;
  var _useState = (0,external_react_.useState)(false),
    _useState2 = SearchResultList_slicedToArray(_useState, 2),
    isOpen = _useState2[0],
    setIsOpen = _useState2[1];
  var handleClick = function handleClick(newSortType) {
    if (sortType === newSortType) {
      return;
    }
    updateAppliedOptionSort(type, newSortType);
    setIsOpen(false);
  };
  var filterTextClasses = external_classnames_default()({
    searchFilterToggle: 1,
    active: isOpen
  });
  return /*#__PURE__*/external_react_default().createElement(DropdownModal, {
    close: function close() {
      setIsOpen(false);
    },
    isOpen: isOpen
  }, /*#__PURE__*/external_react_default().createElement(DropdownButton, {
    isOpen: isOpen,
    toggle: function toggle() {
      setIsOpen(!isOpen);
    },
    enText: "Sort",
    heText: "מיון",
    buttonStyle: true
  }), /*#__PURE__*/external_react_default().createElement(DropdownOptionList, {
    isOpen: isOpen,
    options: sefaria_searchState.metadataByType[type].sortTypeArray,
    currOptionSelected: sortType,
    handleClick: handleClick
  }));
};
SearchSortBox.propTypes = {
  type: (external_prop_types_default()).string.isRequired,
  updateAppliedOptionSort: (external_prop_types_default()).func,
  sortType: (external_prop_types_default()).string
};
var SearchFilterButton = function SearchFilterButton(_ref7) {
  var openMobileFilters = _ref7.openMobileFilters,
    nFilters = _ref7.nFilters;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: external_classnames_default()({
      button: 1,
      extraSmall: 1,
      grey: !nFilters
    }),
    onClick: openMobileFilters
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Filter"), !!nFilters ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, "\xA0(", nFilters.toString(), ")") : null);
};
/* harmony default export */ const js_SearchResultList = (SearchResultList);
;// CONCATENATED MODULE: ../static/js/SidebarSearch.jsx
function SidebarSearch_slicedToArray(arr, i) { return SidebarSearch_arrayWithHoles(arr) || SidebarSearch_iterableToArrayLimit(arr, i) || SidebarSearch_unsupportedIterableToArray(arr, i) || SidebarSearch_nonIterableRest(); }
function SidebarSearch_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function SidebarSearch_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return SidebarSearch_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return SidebarSearch_arrayLikeToArray(o, minLen); }
function SidebarSearch_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function SidebarSearch_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function SidebarSearch_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }








var SidebarSearch = function SidebarSearch(_ref) {
  var _Sefaria$getIndexDeta;
  var title = _ref.title,
    updateAppliedOptionSort = _ref.updateAppliedOptionSort,
    navigatePanel = _ref.navigatePanel,
    sidebarSearchQuery = _ref.sidebarSearchQuery,
    setSidebarSearchQuery = _ref.setSidebarSearchQuery,
    onSidebarSearchClick = _ref.onSidebarSearchClick;
  var _useState = (0,external_react_.useState)((_Sefaria$getIndexDeta = sefaria.getIndexDetailsFromCache(title)) === null || _Sefaria$getIndexDeta === void 0 ? void 0 : _Sefaria$getIndexDeta.lexiconName),
    _useState2 = SidebarSearch_slicedToArray(_useState, 2),
    lexiconName = _useState2[0],
    setLexiconName = _useState2[1];
  var _useState3 = (0,external_react_.useState)(''),
    _useState4 = SidebarSearch_slicedToArray(_useState3, 2),
    searchFilterPathForBook = _useState4[0],
    setSearchFilterPathForBook = _useState4[1];
  var _useState5 = (0,external_react_.useState)(sidebarSearchQuery || ''),
    _useState6 = SidebarSearch_slicedToArray(_useState5, 2),
    query = _useState6[0],
    setQuery = _useState6[1];
  var isDictionary = !!lexiconName;
  var _useState7 = (0,external_react_.useState)(new sefaria_searchState({
      type: 'text',
      appliedFilters: [searchFilterPathForBook],
      field: "naive_lemmatizer",
      appliedFilterAggTypes: ["path"],
      sortType: "chronological"
    })),
    _useState8 = SidebarSearch_slicedToArray(_useState7, 2),
    searchState = _useState8[0],
    setSearchState = _useState8[1];
  (0,external_react_.useEffect)(function () {
    attachKeyboard();
    var searchInput = document.getElementById('searchQueryInput');
    if (searchInput) {
      searchInput.value = query;
    }
  }, []);
  (0,external_react_.useEffect)(function () {
    sefaria.bookSearchPathFilterAPI(title).then(function (path) {
      setSearchFilterPathForBook(path);
    });
    setSidebarSearchQuery(query);
  }, [query]);
  (0,external_react_.useEffect)(function () {
    setSearchState(new sefaria_searchState({
      type: 'text',
      appliedFilters: [searchFilterPathForBook],
      field: "naive_lemmatizer",
      appliedFilterAggTypes: ["path"],
      sortType: "chronological",
      filtersValid: true
    }));
  }, [searchFilterPathForBook]);
  var attachKeyboard = function attachKeyboard() {
    var inputElement = document.querySelector('.sidebarSearch input');
    if (inputElement && !inputElement.VKI_attached) {
      VKI_attach(inputElement);
    }
  };
  var inputClasses = external_classnames_default()({
    search: 1,
    serif: 1,
    keyboardInput: sefaria.interfaceLang === "english",
    hebrewSearch: sefaria.interfaceLang === "hebrew"
  });
  // const searchBoxClasses = classNames({searchBox: 1, searchFocused: this.state.searchFocused});
  var searchBoxClasses = external_classnames_default()({
    searchBox: 1
  });
  var handleSearchButtonClick = function handleSearchButtonClick() {
    var searchBoxValue = document.getElementById('searchQueryInput').value;
    if (searchBoxValue !== query) {
      setSearchFilterPathForBook('');
      setQuery(document.getElementById('searchQueryInput').value);
    }
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "sidebarSearch lexicon-content"
  }, /*#__PURE__*/React.createElement("div", {
    className: searchBoxClasses
  }, isDictionary ? /*#__PURE__*/React.createElement(js_DictionarySearch, {
    lexiconName: lexiconName,
    title: title,
    navigatePanel: navigatePanel,
    contextSelector: ".lexicon-content"
  }) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(SearchButton, {
    onClick: handleSearchButtonClick
  }), /*#__PURE__*/React.createElement("input", {
    className: inputClasses,
    placeholder: sefaria._("Search in this text"),
    id: "searchQueryInput",
    maxLength: 75,
    onKeyUp: function onKeyUp(event) {
      if (event.keyCode === 13) {
        handleSearchButtonClick();
      }
    },
    title: sefaria._("Search in this text")
  }))), query ? /*#__PURE__*/React.createElement(js_SearchResultList, {
    query: query,
    compare: false,
    searchInBook: true,
    tab: "text",
    types: ["text"],
    textSearchState: searchState,
    updateTotalResults: function updateTotalResults(n) {
      return console.log(n);
    },
    registerAvailableFilters: function registerAvailableFilters(n) {
      return console.log(n);
    },
    updateAppliedOptionSort: updateAppliedOptionSort,
    onResultClick: onSidebarSearchClick
  }) : null);
};
/* harmony default export */ const js_SidebarSearch = (SidebarSearch);
;// CONCATENATED MODULE: ../static/js/TextList.jsx
function TextList_typeof(obj) { "@babel/helpers - typeof"; return TextList_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, TextList_typeof(obj); }
var _this2 = undefined;
function TextList_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function TextList_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, TextList_toPropertyKey(descriptor.key), descriptor); } }
function TextList_createClass(Constructor, protoProps, staticProps) { if (protoProps) TextList_defineProperties(Constructor.prototype, protoProps); if (staticProps) TextList_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function TextList_toPropertyKey(arg) { var key = TextList_toPrimitive(arg, "string"); return TextList_typeof(key) === "symbol" ? key : String(key); }
function TextList_toPrimitive(input, hint) { if (TextList_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (TextList_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function TextList_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) TextList_setPrototypeOf(subClass, superClass); }
function TextList_setPrototypeOf(o, p) { TextList_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return TextList_setPrototypeOf(o, p); }
function TextList_createSuper(Derived) { var hasNativeReflectConstruct = TextList_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = TextList_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = TextList_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return TextList_possibleConstructorReturn(this, result); }; }
function TextList_possibleConstructorReturn(self, call) { if (call && (TextList_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return TextList_assertThisInitialized(self); }
function TextList_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function TextList_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function TextList_getPrototypeOf(o) { TextList_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return TextList_getPrototypeOf(o); }









var TextList = /*#__PURE__*/function (_Component) {
  TextList_inherits(TextList, _Component);
  var _super = TextList_createSuper(TextList);
  function TextList(props) {
    var _this;
    TextList_classCallCheck(this, TextList);
    _this = _super.call(this, props);
    _this.state = {
      linksLoaded: false,
      // has the list of refs been loaded
      textLoaded: false,
      // has the text of those refs been loaded
      waitForText: true // should we delay rendering texts until preload is finished
    };
    return _this;
  }
  TextList_createClass(TextList, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this._isMounted = true;
      this.loadConnections();
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this._isMounted = false;
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if (!sefaria.util.object_equals(this.props.filter, nextProps.filter)) {
        this.preloadText(nextProps.filter);
      }
    }
  }, {
    key: "componentWillUpdate",
    value: function componentWillUpdate(nextProps) {}
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (!prevProps.srefs.compare(this.props.srefs)) {
        this.loadConnections();
      }
      var didRender = prevState.linksLoaded && (!prevState.waitForText || prevState.textLoaded);
      var willRender = this.state.linksLoaded && (!this.state.waitForText || this.state.textLoaded);
      if (!didRender && willRender) {
        // links text just loaded
        this.props.checkVisibleSegments();
      }
    }
  }, {
    key: "getSectionRef",
    value: function getSectionRef() {
      var ref = this.props.srefs[0]; // TODO account for selections spanning sections
      var sectionRef = sefaria.sectionRef(ref) || ref;
      return sectionRef;
    }
  }, {
    key: "loadConnections",
    value: function loadConnections() {
      // Load connections data from server for this section
      var sectionRef = this.getSectionRef();
      if (!sectionRef) {
        return;
      }
      sefaria.related(sectionRef, function (data) {
        if (this._isMounted) {
          this.preloadText(this.props.filter);
          this.setState({
            linksLoaded: true
          });
        }
      }.bind(this));
    }
  }, {
    key: "onDataChange",
    value: function onDataChange() {
      sefaria.clearLinks();
      this.setState({
        linksLoaded: false
      });
      this.loadConnections();
    }
  }, {
    key: "preloadText",
    value: function preloadText(filter) {
      // Preload text of links if `filter` is a single commentary, or all commentary
      if (filter.length == 1 && sefaria.index(filter[0]) && (
      // filterSuffix for quoting commmentary prevents this path for QC
      sefaria.index(filter[0]).categories[0] == "Commentary" || sefaria.index(filter[0]).primary_category == "Commentary")) {
        // Individual commentator names ("Rashi") are put into Sefaria.index with "Commentary" as first category
        // Intentionally fails when looking up "Rashi on Genesis", which indicates we're looking at a quoting commentary.
        this.preloadSingleCommentaryText(filter);
      } else if (filter.length == 1 && filter[0] == "Commentary") {
        this.preloadAllCommentaryText(filter);
      } else {
        this.setState({
          waitForText: false,
          textLoaded: false
        });
      }
    }
  }, {
    key: "preloadSingleCommentaryText",
    value: function preloadSingleCommentaryText(filter) {
      //console.log('preloading single commentary')
      // Preload commentary for an entire section of text.
      this.setState({
        textLoaded: false
      });
      var commentator = filter[0];
      var basetext = this.getSectionRef();
      var commentarySection = sefaria.commentarySectionRef(commentator, basetext);
      if (!commentarySection) {
        this.setState({
          waitForText: false
        });
        return;
      }
      this.setState({
        waitForText: true
      });
      sefaria.text(commentarySection, {}, function () {
        if (this._isMounted) {
          this.setState({
            textLoaded: true
          });
        }
      }.bind(this));
    }
  }, {
    key: "preloadAllCommentaryText",
    value: function preloadAllCommentaryText() {
      var basetext = this.getSectionRef();
      var summary = sefaria.linkSummary(basetext);
      if (summary.length && summary[0].category == "Commentary") {
        this.setState({
          textLoaded: false,
          waitForText: true
        });
        // Get a list of commentators on this section that we need don't have in the cache
        var commentators = summary[0].books.map(function (item) {
          return item.book;
        });
        if (commentators.length) {
          var commentarySections = commentators.map(function (commentator) {
            return sefaria.commentarySectionRef(commentator, basetext);
          }).filter(function (commentarySection) {
            return !!commentarySection;
          });
          this.waitingFor = sefaria.util.clone(commentarySections);
          this.target = 0;
          for (var i = 0; i < commentarySections.length; i++) {
            sefaria.text(commentarySections[i], {}, function (data) {
              var index = this.waitingFor.indexOf(data.commentator);
              if (index == -1) {
                // console.log("Failed to clear commentator:");
                // console.log(data);
                this.target += 1;
              }
              if (index > -1) {
                this.waitingFor.splice(index, 1);
              }
              if (this.waitingFor.length == this.target) {
                if (this._isMounted) {
                  this.setState({
                    textLoaded: true
                  });
                }
              }
            }.bind(this));
          }
        } else {
          // All commentaries have been loaded already
          this.setState({
            textLoaded: true
          });
        }
      } else {
        // There were no commentaries to load
        this.setState({
          textLoaded: true
        });
      }
    }
  }, {
    key: "getLinks",
    value: function getLinks() {
      var refs = this.props.srefs;
      var filter = this.props.filter;
      var excludedSheet = this.props.nodeRef ? this.props.nodeRef.split(".")[0] : null;
      var sectionRef = this.getSectionRef();
      var sortConnections = function (a, b) {
        // Sort according this which verse the link connects to
        if (a.anchorVerse !== b.anchorVerse) {
          return a.anchorVerse - b.anchorVerse;
        }
        if (a.index_title == b.index_title) {
          // For Sheet links of the same group sort by title
          if (a.isSheet && b.isSheet) {
            return a.title > b.title ? 1 : -1;
          }
          // For text links of same text/commentary use content order, set by server
          return a.commentaryNum - b.commentaryNum;
        }
        if (this.props.contentLang == "hebrew") {
          return a.sourceHeRef > b.sourceHeRef ? 1 : -1;
        } else {
          return a.sourceRef > b.sourceRef ? 1 : -1;
        }
      }.bind(this);
      var sectionLinks = sefaria.getLinksFromCache(sectionRef);
      sectionLinks.map(function (link) {
        if (!("anchorRefExpanded" in link)) {
          link.anchorRefExpanded = sefaria.splitRangingRef(link.anchorRef);
        }
      });
      var overlaps = function overlaps(link) {
        return !link.anchorRefExpanded.every(function (aref) {
          return sefaria.util.inArray(aref, refs) === -1;
        });
      };
      var links = sefaria._filterLinks(sectionLinks, filter).filter(overlaps).sort(sortConnections);
      if (excludedSheet) {
        links = sefaria._filterSheetFromLinks(links, excludedSheet);
      }
      return links;
    }
  }, {
    key: "render",
    value: function render() {
      var refs = this.props.srefs;
      var oref = sefaria.ref(refs[0]);
      var filter = this.props.filter; // Remove filterSuffix for display
      var displayFilter = filter.map(function (filter) {
        return filter.split("|")[0];
      }); // Remove filterSuffix for display
      var links = this.getLinks();
      var en = "No connections known" + (filter.length ? " for " + displayFilter.join(", ") + " here" : "") + ".";
      var he = "אין קשרים ידועים" + (filter.length ? " ל" + displayFilter.map(function (f) {
        return sefaria.hebrewTerm(f);
      }).join(", ") : "") + ".";
      var noResultsMessage = /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
        message: en,
        heMessage: he
      });
      var message = !this.state.linksLoaded ? /*#__PURE__*/external_react_default().createElement(LoadingMessage, null) : links.length === 0 ? noResultsMessage : null;
      var content = links.length === 0 ? message : this.state.waitForText && !this.state.textLoaded ? /*#__PURE__*/external_react_default().createElement(LoadingMessage, null) : links.map(function (link, i) {
        if (link.isSheet) {
          var hideAuthor = link.index_title == this.props.filter[0];
          return /*#__PURE__*/external_react_default().createElement(SheetListing, {
            sheet: link,
            handleSheetClick: this.props.handleSheetClick,
            connectedRefs: this.props.srefs,
            hideAuthor: hideAuthor,
            openInNewTab: true,
            key: i + link.anchorRef
          });
        } else {
          var hideTitle = link.category === "Commentary" && this.props.filter[0] !== "Commentary";
          var classes = external_classnames_default()({
            textListTextRangeBox: 1,
            typeQF: link.type.startsWith('quotation_auto')
          });
          return /*#__PURE__*/external_react_default().createElement("div", {
            className: classes,
            key: i + link.sourceRef
          }, /*#__PURE__*/external_react_default().createElement(js_TextRange, {
            panelPosition: this.props.panelPosition,
            sref: link.sourceRef,
            hideTitle: hideTitle,
            numberLabel: link.category === "Commentary" ? link.anchorVerse : 0,
            basetext: false,
            textHighlights: link.highlightedWords || null,
            inlineReference: link.inline_reference || null,
            onCitationClick: this.props.onCitationClick,
            translationLanguagePreference: this.props.translationLanguagePreference
          }), /*#__PURE__*/external_react_default().createElement(ConnectionButtons, null, /*#__PURE__*/external_react_default().createElement(OpenConnectionTabButton, {
            srefs: [link.sourceRef],
            openInTabCallback: this.props.onTextClick
          }), /*#__PURE__*/external_react_default().createElement(AddConnectionToSheetButton, {
            srefs: [link.sourceRef],
            addToSheetCallback: this.props.setConnectionsMode
          }), sefaria.is_moderator ? /*#__PURE__*/external_react_default().createElement(DeleteConnectionButton, {
            delUrl: "/api/links/" + link._id,
            connectionDeleteCallback: this.onDataChange
          }) : null));
        }
      }, this);
      return /*#__PURE__*/external_react_default().createElement("div", null, this.props.fullPanel ? /*#__PURE__*/external_react_default().createElement(RecentFilterSet, {
        srefs: this.props.srefs,
        asHeader: false,
        filter: this.props.filter,
        recentFilters: this.props.recentFilters,
        textCategory: oref ? oref.primary_category : null,
        setFilter: this.props.setFilter,
        showAllFilters: this.showAllFilters
      }) : null, content);
    }
  }]);
  return TextList;
}((external_react_class_default()));
TextList.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  // an array of ref strings
  filter: (external_prop_types_default()).array.isRequired,
  recentFilters: (external_prop_types_default()).array.isRequired,
  fullPanel: (external_prop_types_default()).bool,
  multiPanel: (external_prop_types_default()).bool,
  contentLang: (external_prop_types_default()).string,
  setFilter: (external_prop_types_default()).func,
  setConnectionsMode: (external_prop_types_default()).func,
  onTextClick: (external_prop_types_default()).func,
  onCitationClick: (external_prop_types_default()).func,
  onDataChange: (external_prop_types_default()).func,
  handleSheetClick: (external_prop_types_default()).func,
  openNav: (external_prop_types_default()).func,
  openDisplaySettings: (external_prop_types_default()).func,
  closePanel: (external_prop_types_default()).func,
  selectedWords: (external_prop_types_default()).string,
  checkVisibleSegments: (external_prop_types_default()).func.isRequired,
  translationLanguagePreference: (external_prop_types_default()).string
};
var DeleteConnectionButton = function DeleteConnectionButton(_ref) {
  var delUrl = _ref.delUrl,
    connectionDeleteCallback = _ref.connectionDeleteCallback;
  /*
  ConnectionButton composite element. Goes inside a ConnectionButtons
  Takes a url for a delete api (with the full URI of a specific object) and callback
   */
  var deleteLink = function deleteLink() {
    if (!sefaria.is_moderator) return;
    if (confirm("Are you sure you want to delete this connection?")) {
      var url = delUrl;
      $.ajax({
        type: "delete",
        url: url,
        success: function () {
          connectionDeleteCallback();
          alert("Connection deleted.");
        }.bind(_this2),
        error: function error() {
          alert("There was an error deleting this connection. Please reload the page or try again later.");
        }
      });
    }
  };
  return sefaria.is_moderator ? /*#__PURE__*/external_react_default().createElement(SimpleLinkedBlock, {
    aclasses: "connection-button delete-link",
    onClick: deleteLink,
    en: "Remove",
    he: "מחיקת קישור"
  }) : null;
};
var OpenConnectionTabButton = function OpenConnectionTabButton(_ref2) {
  var srefs = _ref2.srefs,
    openInTabCallback = _ref2.openInTabCallback;
  /*
  ConnectionButton composite element. Goes inside a ConnectionButtons
  Takes a ref(s) for opening as a link and callback for opening in-app
   */
  var sref = Array.isArray(srefs) ? sefaria.normRefList(srefs) : srefs;
  var openLinkInTab = function openLinkInTab(event) {
    if (openInTabCallback) {
      event.preventDefault();
      //Click on the body of the TextRange itself from TextList
      openInTabCallback(srefs);
      sefaria.track.event("Reader", "Click Text from TextList", sref);
    }
  };
  return /*#__PURE__*/external_react_default().createElement(SimpleLinkedBlock, {
    aclasses: "connection-button panel-open-link",
    onClick: openLinkInTab,
    en: "Open",
    he: "פתיחה",
    url: "/".concat(sref)
  });
};
var AddConnectionToSheetButton = function AddConnectionToSheetButton(_ref3) {
  var srefs = _ref3.srefs,
    addToSheetCallback = _ref3.addToSheetCallback,
    _ref3$versions = _ref3.versions,
    versions = _ref3$versions === void 0 ? {
      "en": null,
      "he": null
    } : _ref3$versions;
  /*
  ConnectionButton composite element. Goes inside a ConnectionButtons
  Takes a ref(s) for opening an AddToSourceSheet element and callback for passing data to said element - refs and versions object
   */
  var addToSheet = function addToSheet() {
    addToSheetCallback("Add To Sheet", {
      "addSource": "connectionsPanel",
      "connectionRefs": srefs,
      "versions": versions
    });
  };
  return /*#__PURE__*/external_react_default().createElement(SimpleLinkedBlock, {
    aclasses: "connection-button add-to-sheet-link",
    onClick: addToSheet,
    en: "Add to Sheet",
    he: "הוספה לדף מקורות"
  });
};
var ConnectionButtons = function ConnectionButtons(_ref4) {
  var children = _ref4.children;
  /* This is basically just a composition container, and allows to apply css rules to a container for connection buttons.
    can also be expanded to use a default set of connection buttons, if not children are present?
   */
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "connection-buttons"
  }, children);
};

;// CONCATENATED MODULE: ../static/js/ConnectionsPanelHeader.jsx
function ConnectionsPanelHeader_typeof(obj) { "@babel/helpers - typeof"; return ConnectionsPanelHeader_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, ConnectionsPanelHeader_typeof(obj); }
function ConnectionsPanelHeader_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function ConnectionsPanelHeader_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, ConnectionsPanelHeader_toPropertyKey(descriptor.key), descriptor); } }
function ConnectionsPanelHeader_createClass(Constructor, protoProps, staticProps) { if (protoProps) ConnectionsPanelHeader_defineProperties(Constructor.prototype, protoProps); if (staticProps) ConnectionsPanelHeader_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function ConnectionsPanelHeader_toPropertyKey(arg) { var key = ConnectionsPanelHeader_toPrimitive(arg, "string"); return ConnectionsPanelHeader_typeof(key) === "symbol" ? key : String(key); }
function ConnectionsPanelHeader_toPrimitive(input, hint) { if (ConnectionsPanelHeader_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (ConnectionsPanelHeader_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function ConnectionsPanelHeader_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) ConnectionsPanelHeader_setPrototypeOf(subClass, superClass); }
function ConnectionsPanelHeader_setPrototypeOf(o, p) { ConnectionsPanelHeader_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return ConnectionsPanelHeader_setPrototypeOf(o, p); }
function ConnectionsPanelHeader_createSuper(Derived) { var hasNativeReflectConstruct = ConnectionsPanelHeader_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = ConnectionsPanelHeader_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = ConnectionsPanelHeader_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return ConnectionsPanelHeader_possibleConstructorReturn(this, result); }; }
function ConnectionsPanelHeader_possibleConstructorReturn(self, call) { if (call && (ConnectionsPanelHeader_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return ConnectionsPanelHeader_assertThisInitialized(self); }
function ConnectionsPanelHeader_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function ConnectionsPanelHeader_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function ConnectionsPanelHeader_getPrototypeOf(o) { ConnectionsPanelHeader_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return ConnectionsPanelHeader_getPrototypeOf(o); }









var ConnectionsPanelHeader = /*#__PURE__*/function (_Component) {
  ConnectionsPanelHeader_inherits(ConnectionsPanelHeader, _Component);
  var _super = ConnectionsPanelHeader_createSuper(ConnectionsPanelHeader);
  function ConnectionsPanelHeader(props) {
    var _this;
    ConnectionsPanelHeader_classCallCheck(this, ConnectionsPanelHeader);
    _this = _super.call(this, props);
    _this.previousModes = {
      // mapping from modes to previous modes
      "Translation Open": "Translations",
      "extended notes": "Translations",
      "WebPagesList": "WebPages"
    };
    return _this;
  }
  ConnectionsPanelHeader_createClass(ConnectionsPanelHeader, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.setMarginForScrollbar();
    }
  }, {
    key: "getPreviousMode",
    value: function getPreviousMode() {
      return !!this.props.previousMode ? this.props.previousMode : this.previousModes[this.props.connectionsMode];
    }
  }, {
    key: "setMarginForScrollbar",
    value: function setMarginForScrollbar() {
      // Scrollbars take up spacing, causing the centering of ConnectsionPanel to be slightly off center
      // compared to the header. This functions sets appropriate margin to compensate.
      var width = sefaria.util.getScrollbarWidth();
      var $container = sefariaJquery(external_react_dom_default().findDOMNode(this));
      if (this.props.interfaceLang === "hebrew") {
        $container.css({
          marginRight: 0,
          marginLeft: width
        });
      } else {
        $container.css({
          marginRight: width,
          marginLeft: 0
        });
      }
    }
  }, {
    key: "onClick",
    value: function onClick(e) {
      e.preventDefault();
      var previousMode = this.getPreviousMode();
      if (previousMode) {
        this.props.setConnectionsMode(previousMode);
      } else {
        this.props.setConnectionsCategory(this.props.previousCategory);
      }
    }
  }, {
    key: "render",
    value: function render() {
      /** TODO: fix for interfacetext */
      var previousMode = this.getPreviousMode();
      var title;
      if (this.props.connectionsMode === "Resources") {
        // Top Level Menu
        title = /*#__PURE__*/external_react_default().createElement("div", {
          className: "connectionsHeaderTitle sans-serif"
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
          text: {
            en: "Resources",
            he: "קישורים וכלים"
          }
        }));
      } else if (this.props.previousCategory && this.props.connectionsMode === "TextList" || previousMode) {
        // In a text list, back to Previous Category
        var prev = previousMode ? previousMode.splitCamelCase() : this.props.previousCategory;
        var prevHe = previousMode ? sefaria._(prev) : sefaria._(this.props.previousCategory);
        var url = sefaria.util.replaceUrlParam("with", prev);
        title = /*#__PURE__*/external_react_default().createElement("a", {
          href: url,
          className: "connectionsHeaderTitle sans-serif active",
          onClick: this.onClick
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, /*#__PURE__*/external_react_default().createElement("i", {
          className: "fa fa-chevron-left"
        }), this.props.multiPanel ? prev : null), /*#__PURE__*/external_react_default().createElement(HebrewText, null, /*#__PURE__*/external_react_default().createElement("i", {
          className: "fa fa-chevron-right"
        }), this.props.multiPanel ? prevHe : null)));
      } else {
        // Anywhere else, back to Top Level
        var _url = sefaria.util.replaceUrlParam("with", "all");
        var onClick = function (e) {
          e.preventDefault();
          this.props.setConnectionsMode("Resources");
        }.bind(this);
        title = /*#__PURE__*/external_react_default().createElement("a", {
          href: _url,
          className: "connectionsHeaderTitle sans-serif active",
          onClick: onClick
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, /*#__PURE__*/external_react_default().createElement("i", {
          className: "fa fa-chevron-left"
        }), "Resources"), /*#__PURE__*/external_react_default().createElement(HebrewText, null, /*#__PURE__*/external_react_default().createElement("i", {
          className: "fa fa-chevron-right"
        }), "\u05E7\u05D9\u05E9\u05D5\u05E8\u05D9\u05DD \u05D5\u05DB\u05DC\u05D9\u05DD")));
      }
      if (this.props.multiPanel) {
        var toggleLang = sefaria.util.getUrlVars()["lang2"] === "en" ? "he" : "en";
        var langUrl = sefaria.util.replaceUrlParam("lang2", toggleLang);
        var closeUrl = sefaria.util.removeUrlParam("with");
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "connectionsPanelHeader"
        }, title, /*#__PURE__*/external_react_default().createElement("div", {
          className: "rightButtons"
        }, sefaria.interfaceLang !== "hebrew" && sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement(LanguageToggleButton, {
          toggleLanguage: this.props.toggleLanguage,
          url: langUrl
        }) : null, /*#__PURE__*/external_react_default().createElement(CloseButton, {
          icon: "circledX",
          onClick: this.props.closePanel,
          url: closeUrl
        })));
      } else {
        var style = !this.props.multiPanel && this.props.connectionsMode === "TextList" ? {
          "borderTopColor": sefaria.palette.categoryColor(this.props.previousCategory)
        } : {};
        var cStyle = !this.props.multiPanel && this.props.connectionsMode === "Resources" ? {
          "justifyContent": "center"
        } : style;
        // Modeling the class structure when ConnectionsPanelHeader is created inside ReaderControls in the multiPanel case
        var classes = external_classnames_default()({
          readerControls: 1,
          connectionsHeader: 1,
          fullPanel: this.props.multiPanel
        });
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: classes,
          style: style
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "readerControlsInner"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "readerTextToc"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "connectionsPanelHeader",
          style: cStyle
        }, title, !this.props.multiPanel && this.props.previousCategory && this.props.connectionsMode === "TextList" ? /*#__PURE__*/external_react_default().createElement(RecentFilterSet, {
          srefs: this.props.baseRefs,
          asHeader: true,
          filter: this.props.filter,
          recentFilters: this.props.recentFilters,
          textCategory: this.props.previousCategory,
          setFilter: this.props.setFilter
        }) : null))));
      }
    }
  }]);
  return ConnectionsPanelHeader;
}((external_react_class_default()));
ConnectionsPanelHeader.propTypes = {
  connectionsMode: (external_prop_types_default()).string.isRequired,
  // "Resources", "ConnectionsList", "TextList" etc
  previousCategory: (external_prop_types_default()).string,
  multiPanel: (external_prop_types_default()).bool,
  filter: (external_prop_types_default()).array,
  recentFilters: (external_prop_types_default()).array,
  baseRefs: (external_prop_types_default()).array,
  setFilter: (external_prop_types_default()).func,
  setConnectionsMode: (external_prop_types_default()).func.isRequired,
  setConnectionsCategory: (external_prop_types_default()).func.isRequired,
  closePanel: (external_prop_types_default()).func.isRequired,
  toggleLanguage: (external_prop_types_default()).func,
  interfaceLang: (external_prop_types_default()).string.isRequired
};
/* harmony default export */ const js_ConnectionsPanelHeader = (ConnectionsPanelHeader);
;// CONCATENATED MODULE: ../static/js/AddToSourceSheet.jsx
function AddToSourceSheet_typeof(obj) { "@babel/helpers - typeof"; return AddToSourceSheet_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, AddToSourceSheet_typeof(obj); }
function AddToSourceSheet_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function AddToSourceSheet_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, AddToSourceSheet_toPropertyKey(descriptor.key), descriptor); } }
function AddToSourceSheet_createClass(Constructor, protoProps, staticProps) { if (protoProps) AddToSourceSheet_defineProperties(Constructor.prototype, protoProps); if (staticProps) AddToSourceSheet_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function AddToSourceSheet_toPropertyKey(arg) { var key = AddToSourceSheet_toPrimitive(arg, "string"); return AddToSourceSheet_typeof(key) === "symbol" ? key : String(key); }
function AddToSourceSheet_toPrimitive(input, hint) { if (AddToSourceSheet_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (AddToSourceSheet_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function AddToSourceSheet_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) AddToSourceSheet_setPrototypeOf(subClass, superClass); }
function AddToSourceSheet_setPrototypeOf(o, p) { AddToSourceSheet_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return AddToSourceSheet_setPrototypeOf(o, p); }
function AddToSourceSheet_createSuper(Derived) { var hasNativeReflectConstruct = AddToSourceSheet_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = AddToSourceSheet_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = AddToSourceSheet_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return AddToSourceSheet_possibleConstructorReturn(this, result); }; }
function AddToSourceSheet_possibleConstructorReturn(self, call) { if (call && (AddToSourceSheet_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return AddToSourceSheet_assertThisInitialized(self); }
function AddToSourceSheet_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function AddToSourceSheet_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function AddToSourceSheet_getPrototypeOf(o) { AddToSourceSheet_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return AddToSourceSheet_getPrototypeOf(o); }










var AddToSourceSheetBox = /*#__PURE__*/function (_Component) {
  AddToSourceSheet_inherits(AddToSourceSheetBox, _Component);
  var _super = AddToSourceSheet_createSuper(AddToSourceSheetBox);
  // In the main app, the function `addToSourceSheet` is executed in the ReaderApp,
  // and collects the needed data from highlights and app state.
  // It is used in external apps, liked gardens.  In those cases, it's wrapped in AddToSourceSheetWindow,
  // refs and text are passed directly, and the add to source sheets API is invoked from within this object.
  function AddToSourceSheetBox(props) {
    var _this;
    AddToSourceSheet_classCallCheck(this, AddToSourceSheetBox);
    _this = _super.call(this, props);
    _this.state = {
      sheetsLoaded: false,
      selectedSheet: null,
      sheetListOpen: false,
      showConfirm: false,
      showLogin: false
    };
    return _this;
  }
  AddToSourceSheet_createClass(AddToSourceSheetBox, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.loadSheets();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (!prevProps.srefs.compare(this.props.srefs) || prevProps.nodeRef != this.props.nodeRef) {
        this.setState({
          showConfirm: false
        });
      }
    }
  }, {
    key: "loadSheets",
    value: function loadSheets() {
      if (!sefaria._uid) {
        this.onSheetsLoad();
      } else {
        sefaria.sheets.userSheets(sefaria._uid, this.onSheetsLoad);
      }
    }
  }, {
    key: "onSheetsLoad",
    value: function onSheetsLoad() {
      this.setDefaultSheet();
      this.setState({
        sheetsLoaded: true
      });
    }
  }, {
    key: "setDefaultSheet",
    value: function setDefaultSheet() {
      if (this.state.selectedSheet) {
        return;
      }
      if (!sefaria._uid) {
        this.setState({
          selectedSheet: {
            title: "Your Sheet"
          }
        });
      } else {
        var sheets = sefaria.sheets.userSheets(sefaria._uid);
        if (!sheets.length) {
          this.setState({
            selectedSheet: {
              title: "Create a New Sheet"
            }
          });
        } else {
          this.setState({
            selectedSheet: sheets[0]
          });
        }
      }
    }
  }, {
    key: "toggleSheetList",
    value: function toggleSheetList() {
      if (!sefaria._uid) {
        this.props.toggleSignUpModal(SignUpModalKind.AddToSheet);
      } else {
        this.setState({
          sheetListOpen: !this.state.sheetListOpen
        });
      }
    }
  }, {
    key: "selectSheet",
    value: function selectSheet(sheet) {
      this.setState({
        selectedSheet: sheet,
        sheetListOpen: false
      });
    }
  }, {
    key: "copyNodeToSourceSheet",
    value: function copyNodeToSourceSheet() {
      if (!sefaria._uid) {
        this.props.toggleSignUpModal(SignUpModalKind.AddToSheet);
      }
      if (!this.state.selectedSheet || !this.state.selectedSheet.id) {
        return;
      }
      if (!this.props.nodeRef) {
        this.props.addToSourceSheet(this.state.selectedSheet.id, this.confirmAdd);
      } else {
        var url = "/api/sheets/" + this.state.selectedSheet.id + "/copy_source";
        sefariaJquery.post(url, {
          sheetID: this.props.nodeRef.split(".")[0],
          nodeID: this.props.nodeRef.split(".")[1]
        }, this.confirmAdd);
      }
    }
  }, {
    key: "addToSourceSheet",
    value: function addToSourceSheet() {
      if (!sefaria._uid) {
        this.props.toggleSignUpModal(SignUpModalKind.AddToSheet);
      }
      if (!this.state.selectedSheet || !this.state.selectedSheet.id) {
        return;
      }
      var url = "/api/sheets/" + this.state.selectedSheet.id + "/add";
      var language = this.props.contentLanguage;
      var source = {};
      if (this.props.en || this.props.he) {
        // legacy code to support a call to this component in Gardens.
        if (this.props.srefs) {
          //we are saving a ref + ref's text, generally all fields should be present.
          source.refs = this.props.srefs;
          source.en = this.props.en;
          source.he = this.props.he;
        } else {
          // an outside free text is being passed in. theoretically supports any interface that passes this in. In practice only legacy Gardens code.
          if (this.props.en && this.props.he) {
            source.outsideBiText = {
              he: this.props.he,
              en: this.props.en
            };
          } else {
            source.outsideText = this.props.en || this.props.he;
          }
        }
      } else if (this.props.srefs) {
        //regular use - this is currently the case when the component is loaded in the sidepanel or in the modal component via profiles and notes pages
        source.refs = this.props.srefs;
        var _ref = this.props.currVersions ? this.props.currVersions : {
            "en": null,
            "he": null
          },
          en = _ref.en,
          he = _ref.he; //the text we are adding may be non-default version
        if (he) {
          source["version-he"] = he;
        }
        if (en) {
          source["version-en"] = en;
        }

        // If something is highlighted and main panel language is not bilingual:
        // Use passed in language to determine which version this highlight covers.
        var selectedWords = this.props.selectedWords; //if there was highlighted single panel
        if (selectedWords && language != "bilingual") {
          source[language.slice(0, 2)] = selectedWords;
        }
      }
      if (this.checkContentForImages(source.refs)) {
        var postData = {
          source: JSON.stringify(source)
        };
        if (this.props.note) {
          postData.note = this.props.note;
        }
        sefariaJquery.post(url, postData, this.confirmAdd);
      }
    }
  }, {
    key: "checkContentForImages",
    value: function checkContentForImages(refs) {
      // validate texts corresponding to refs have no images before posting them to sheet
      for (var i = 0; i < refs.length; i++) {
        var ref = sefaria.getRefFromCache(refs[i]);
        if (ref && (sefaria.isFullSegmentImage(ref.he) || sefaria.isFullSegmentImage(ref.text))) {
          alert("We do not currently support adding images to source sheets.");
          return false;
        }
      }
      return true;
    }
  }, {
    key: "createSheet",
    value: function createSheet(refs) {
      var title = sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input").val();
      if (!title) {
        return;
      }
      var sheet = {
        title: title,
        options: {
          numbered: 0
        },
        sources: []
      };
      var postJSON = JSON.stringify(sheet);
      sefariaJquery.post("/api/sheets/", {
        "json": postJSON
      }, function (data) {
        sefaria.sheets.updateUserSheets(data, sefaria._uid, false);
        this.selectSheet(data);
      }.bind(this));
    }
  }, {
    key: "confirmAdd",
    value: function confirmAdd() {
      if (this.props.srefs) {
        sefaria.track.event("Tools", "Add to Source Sheet Save", this.props.srefs.join("/"));
      } else {
        sefaria.track.event("Tools", "Add to Source Sheet Save", "Outside Source");
      }
      sefaria.sheets.updateUserSheets(this.state.selectedSheet, sefaria._uid, true);
      this.setState({
        showConfirm: true
      });
      var channel = new BroadcastChannel('refresh-editor');
      channel.postMessage("refresh");
    }
  }, {
    key: "makeTitleRef",
    value: function makeTitleRef() {
      var refTitles = this.props.srefs.length > 0 && !this.props.srefs[0].startsWith("Sheet") ? {
        "en": sefaria.joinRefList(this.props.srefs, "en"),
        "he": sefaria.joinRefList(this.props.srefs, "he")
      } : null;
      if (this.props.nodeRef) {
        //this whole if clause is ust to make sure that when a sheet is in the main panel, a human readable citation regarding the sheet is shown in the sheet box.
        var sheetID = parseInt(this.props.nodeRef.split(".")[0]);
        var nodeID = this.props.nodeRef.split(".")[1];
        var sheet = sefaria.sheets.loadSheetByID(sheetID);
        var sheetTitle = external_sanitize_html_default()(sheet.title, {
          allowedTags: [],
          disallowedTagsMode: 'discard'
        });
        var titleRetval = {
          "en": "".concat(sheetTitle, ", Section #").concat(nodeID),
          "he": "".concat(sheetTitle, ", \u05E1\u05E2\u05D9\u05E3 ").concat(nodeID)
        };
        if (refTitles) {
          //show the refs also of a source, just to be nice
          titleRetval["en"] += "(".concat(refTitles["en"], ")");
          titleRetval["he"] += "(".concat(refTitles["he"], ")");
        }
        return titleRetval;
      } else {
        return refTitles;
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this;
      if (this.state.showConfirm) {
        return /*#__PURE__*/external_react_default().createElement(ConfirmAddToSheet, {
          sheet: this.state.selectedSheet,
          srefs: this.props.srefs,
          nodeRef: this.props.nodeRef
        });
      } else if (this.state.showLogin) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "addToSourceSheetBox sans-serif"
        }, /*#__PURE__*/external_react_default().createElement(LoginPrompt, null));
      }
      var titleRef = this.makeTitleRef();
      var sheets = sefaria._uid ? sefaria.sheets.userSheets(sefaria._uid) : null;
      var sheetsList = sefaria._uid && sheets ? sheets.map(function (sheet) {
        var classes = external_classnames_default()({
          dropdownOption: 1,
          noselect: 1,
          selected: _this2.state.selectedSheet && _this2.state.selectedSheet.id == sheet.id
        });
        var title = sheet.title ? sheet.title.stripHtml() : sefaria._("Untitled Source Sheet");
        var selectSheet = _this2.selectSheet.bind(_this2, sheet);
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: classes,
          onClick: selectSheet,
          key: sheet.id
        }, title);
      }) : sefaria._uid ? /*#__PURE__*/external_react_default().createElement(LoadingMessage, null) : null;

      // Uses
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "addToSourceSheetBox noselect"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "addToSourceSheetBoxTitle sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Selected Citation"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05DE\u05E7\u05D5\u05E8 \u05DC\u05D4\u05D5\u05E1\u05E4\u05D4")), /*#__PURE__*/external_react_default().createElement("div", {
        className: "selectedRef"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "en"
      }, titleRef["en"]), /*#__PURE__*/external_react_default().createElement("span", {
        className: "he"
      }, titleRef["he"])), /*#__PURE__*/external_react_default().createElement("div", {
        className: "addToSourceSheetBoxTitle sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Add to"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D9\u05E2\u05D3 \u05DC\u05D4\u05D5\u05E1\u05E4\u05D4")), /*#__PURE__*/external_react_default().createElement("div", {
        className: "dropdown"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "dropdownMain noselect ".concat(this.state.sheetListOpen ? "open" : ""),
        onClick: this.toggleSheetList
      }, this.state.sheetsLoaded ? this.state.selectedSheet.title === null ? sefaria._("Untitled Source Sheet") : this.state.selectedSheet.title.stripHtml() : /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
        messsage: "Loading your sheets...",
        heMessage: "\u05D8\u05D5\u05E2\u05DF \u05D0\u05EA \u05D3\u05E4\u05D9 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05DC\u05DA"
      }), "          "), this.state.sheetListOpen ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "dropdownListBox noselect"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "dropdownList noselect"
      }, sheetsList), /*#__PURE__*/external_react_default().createElement("div", {
        className: "newSheet noselect"
      }, /*#__PURE__*/external_react_default().createElement("input", {
        className: "newSheetInput noselect",
        placeholder: sefaria._("Name New Sheet")
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "button small noselect",
        onClick: this.createSheet
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Create"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D9\u05E6\u05D9\u05E8\u05D4")))) : null), /*#__PURE__*/external_react_default().createElement("div", {
        className: "button noselect fillWidth",
        onClick: this.props.nodeRef ? this.copyNodeToSourceSheet : this.addToSourceSheet
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en noselect"
      }, "Add to Sheet"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he noselect"
      }, "\u05D4\u05D5\u05E1\u05E4\u05D4 \u05DC\u05D3\u05E3 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA")));
    }
  }]);
  return AddToSourceSheetBox;
}((external_react_class_default()));
AddToSourceSheetBox.propTypes = {
  srefs: (external_prop_types_default()).array,
  fullPanel: (external_prop_types_default()).bool,
  en: (external_prop_types_default()).string,
  he: (external_prop_types_default()).string,
  note: (external_prop_types_default()).string
};
var ConfirmAddToSheet = /*#__PURE__*/function (_Component2) {
  AddToSourceSheet_inherits(ConfirmAddToSheet, _Component2);
  var _super2 = AddToSourceSheet_createSuper(ConfirmAddToSheet);
  function ConfirmAddToSheet() {
    AddToSourceSheet_classCallCheck(this, ConfirmAddToSheet);
    return _super2.apply(this, arguments);
  }
  AddToSourceSheet_createClass(ConfirmAddToSheet, [{
    key: "render",
    value: function render() {
      var sref = null;
      var srefTitles = {};
      if (!this.props.nodeRef) {
        sref = "/".concat(sefaria.normRefList(this.props.srefs));
        srefTitles = {
          "en": sefaria.joinRefList(this.props.srefs, "en"),
          "he": sefaria.joinRefList(this.props.srefs, "he")
        };
      } else {
        sref = "/sheets/".concat(this.props.nodeRef);
        var sheetTitle = external_sanitize_html_default()(sefaria.sheets.loadSheetByID(this.props.nodeRef.split(".")[0]).title, {
          allowedTags: [],
          disallowedTagsMode: 'discard'
        });
        srefTitles = {
          "en": "Section from \"".concat(sheetTitle, "\""),
          "he": "\u05D4\u05E7\u05D8\u05E2 \u05DE\u05EA\u05D5\u05DA  \"".concat(sheetTitle, "\"")
        };
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "confirmAddToSheet addToSourceSheetBox"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "message"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: sref
      }, srefTitles["en"]), "\xA0has been added to\xA0", /*#__PURE__*/external_react_default().createElement("a", {
        href: "/sheets/" + this.props.sheet.id,
        target: "_blank"
      }, this.props.sheet.title), "."), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: sref
      }, srefTitles["he"]), "\xA0\u05E0\u05D5\u05E1\u05E3 \u05D1\u05D4\u05E6\u05DC\u05D7\u05D4 \u05DC\u05D3\u05E3 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA\xA0", /*#__PURE__*/external_react_default().createElement("a", {
        href: "/sheets/" + this.props.sheet.id,
        target: "_blank"
      }, this.props.sheet.title), ".")));
    }
  }]);
  return ConfirmAddToSheet;
}((external_react_class_default()));
ConfirmAddToSheet.propTypes = {
  srefs: (external_prop_types_default()).array,
  nodeRef: (external_prop_types_default()).string,
  sheet: (external_prop_types_default()).object.isRequired
};
var AddToSourceSheetWindow = /*#__PURE__*/function (_Component3) {
  AddToSourceSheet_inherits(AddToSourceSheetWindow, _Component3);
  var _super3 = AddToSourceSheet_createSuper(AddToSourceSheetWindow);
  function AddToSourceSheetWindow() {
    AddToSourceSheet_classCallCheck(this, AddToSourceSheetWindow);
    return _super3.apply(this, arguments);
  }
  AddToSourceSheet_createClass(AddToSourceSheetWindow, [{
    key: "close",
    value: function close() {
      if (this.props.close) {
        this.props.close();
      }
    }
  }, {
    key: "render",
    value: function render() {
      var nextParam = "?next=" + encodeURIComponent(sefaria.util.currentPath());
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "addToSourceSheetModal"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sourceSheetBoxTitle"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/circled-x.svg",
        className: "closeButton",
        "aria-hidden": "true",
        alt: "Close",
        onClick: this.close
      }), sefaria._uid ? null : /*#__PURE__*/external_react_default().createElement("span", null, "In order to add this source to a sheet, please ", /*#__PURE__*/external_react_default().createElement("a", {
        href: "/login" + nextParam
      }, "log in.")), /*#__PURE__*/external_react_default().createElement("div", {
        className: "clearFix"
      })), sefaria._uid ? /*#__PURE__*/external_react_default().createElement(AddToSourceSheetBox, {
        srefs: this.props.srefs,
        en: this.props.en,
        he: this.props.he,
        note: this.props.note
      }) : null);
    }
  }]);
  return AddToSourceSheetWindow;
}((external_react_class_default()));
AddToSourceSheetWindow.propTypes = {
  srefs: (external_prop_types_default()).array,
  close: (external_prop_types_default()).func,
  en: (external_prop_types_default()).string,
  he: (external_prop_types_default()).string,
  note: (external_prop_types_default()).string
};

sefaria.AddToSourceSheetWindow = AddToSourceSheetWindow;
;// CONCATENATED MODULE: ../static/js/LexiconBox.jsx
function LexiconBox_typeof(obj) { "@babel/helpers - typeof"; return LexiconBox_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, LexiconBox_typeof(obj); }
function LexiconBox_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function LexiconBox_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, LexiconBox_toPropertyKey(descriptor.key), descriptor); } }
function LexiconBox_createClass(Constructor, protoProps, staticProps) { if (protoProps) LexiconBox_defineProperties(Constructor.prototype, protoProps); if (staticProps) LexiconBox_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function LexiconBox_toPropertyKey(arg) { var key = LexiconBox_toPrimitive(arg, "string"); return LexiconBox_typeof(key) === "symbol" ? key : String(key); }
function LexiconBox_toPrimitive(input, hint) { if (LexiconBox_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (LexiconBox_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function LexiconBox_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) LexiconBox_setPrototypeOf(subClass, superClass); }
function LexiconBox_setPrototypeOf(o, p) { LexiconBox_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return LexiconBox_setPrototypeOf(o, p); }
function LexiconBox_createSuper(Derived) { var hasNativeReflectConstruct = LexiconBox_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = LexiconBox_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = LexiconBox_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return LexiconBox_possibleConstructorReturn(this, result); }; }
function LexiconBox_possibleConstructorReturn(self, call) { if (call && (LexiconBox_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return LexiconBox_assertThisInitialized(self); }
function LexiconBox_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function LexiconBox_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function LexiconBox_getPrototypeOf(o) { LexiconBox_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return LexiconBox_getPrototypeOf(o); }







var LexiconBox = /*#__PURE__*/function (_Component) {
  LexiconBox_inherits(LexiconBox, _Component);
  var _super = LexiconBox_createSuper(LexiconBox);
  function LexiconBox(props) {
    var _this;
    LexiconBox_classCallCheck(this, LexiconBox);
    _this = _super.call(this, props);
    _this.state = {
      searchedWord: null,
      // This is used only to counteract the influence of a ref, currently, but should really be show in the search box after search, and bubble up to state.
      entries: [],
      loaded: false
    };
    return _this;
  }
  LexiconBox_createClass(LexiconBox, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      if (this.props.selectedNamedEntity) {
        this.getNamedEntity(this.props.selectedNamedEntity);
      } else if (this.props.selectedWords) {
        this.getLookups(this.props.selectedWords, this.props.oref);
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (this.props.selectedWords && this.props.selectedWords !== prevProps.selectedWords) {
        this.clearLookups();
        this.props.clearNamedEntity();
        this.getLookups(this.props.selectedWords, this.props.oref);
      } else if (this.props.selectedNamedEntity && this.props.selectedNamedEntity !== prevProps.selectedNamedEntity) {
        this.clearLookups();
        this.props.clearSelectedWords();
        this.getNamedEntity(this.props.selectedNamedEntity);
      }
    }
  }, {
    key: "clearLookups",
    value: function clearLookups() {
      this.setState({
        searchedWord: null,
        namedEntity: null,
        loaded: false,
        entries: []
      });
    }
  }, {
    key: "searchWord",
    value: function searchWord(word) {
      this.clearLookups();
      this.props.clearNamedEntity();
      this.setState({
        searchedWord: word
      });
      this.getLookups(word);
    }
  }, {
    key: "getLookups",
    value: function getLookups(words, oref) {
      var _this2 = this;
      if (this.shouldActivate(words)) {
        var ref = oref ? oref.ref : undefined;
        // console.log('getting data: ', words, oref.ref);
        sefaria.getLexiconWords(words, ref).then(function (data) {
          _this2.setState({
            loaded: true,
            entries: data
          });
          var action = data.length === 0 ? "Open No Result" : "Open";
          action += oref ? " / " + oref.categories.join("/") + "/" + oref.book : "";
          sefaria.track.event("Lexicon", action, words);

          // console.log('gotten data from Sefaria.js, state re-set: ', this, data);
        });
      }
    }
  }, {
    key: "getNamedEntity",
    value: function getNamedEntity(slug) {
      var _this3 = this;
      sefaria.getTopic(slug, {
        annotated: false
      }).then(function (data) {
        _this3.setState({
          loaded: true,
          namedEntity: data
        });
      });
    }
  }, {
    key: "shouldActivate",
    value: function shouldActivate(selectedWords) {
      if (this.state.searchedWord) {
        return true;
      }
      if (selectedWords && selectedWords.match(/[\s:\u0590-\u05ff.]+/)) {
        var wordList = selectedWords.split(/[\s:\u05c3\u05be\u05c0.]+/);
        var inputLength = wordList.length;
        return inputLength <= 3;
      } else {
        return null;
      }
    }
  }, {
    key: "render",
    value: function render() {
      /*
        if (!this.props.selectedWords) {
          return (
            <div className="lexicon-instructions">
              <span className="int-en">Highlight words to look up definitions.</span>
              <span className="int-he">סמן מילים כדי לחפש הגדרות</span>
            </div>);
        }
      */

      var refCats = this.props.oref && !this.state.searchedWord ? this.props.oref.categories.join(", ") : null; //TODO: the way to filter by categories is very limiting.
      var enEmpty = 'No definitions found for "' + this.props.selectedWords + '".';
      var heEmpty = 'לא נמצאו תוצאות "' + this.props.selectedWords + '".';
      var content = "";
      if (!!this.props.selectedNamedEntity) {
        if (!this.state.loaded || !this.state.namedEntity) {
          // not sure why I also need to check for this.state.namedEntity but I've seen situations where loaded is true and namedEntity is null
          content = /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
            message: "Looking up words...",
            heMessage: "\u05DE\u05D7\u05E4\u05E9 \u05DE\u05D9\u05DC\u05D9\u05DD..."
          });
        } else {
          // TODO. remove hard-coding
          var dataSourceText = "";
          if (this.props.srefs[0].indexOf("Jerusalem Talmud") !== -1) {
            dataSourceText = "".concat(sefaria._('This topic is connected to '), "\"").concat(sefaria._r(this.props.srefs[0]), "\" ").concat(sefaria._('by'), " ").concat(sefaria._('Sefaria'), ".");
          } else {
            dataSourceText = "".concat(sefaria._('This topic is connected to '), "\"").concat(sefaria._r(this.props.srefs[0]), "\" ").concat(sefaria._('based on'), " ").concat(sefaria._('research of Dr. Michael Sperling'), ".");
          }
          var neArray = this.state.namedEntity.possibilities || [this.state.namedEntity];
          var namedEntityContent = neArray.map(function (ne) {
            return /*#__PURE__*/external_react_default().createElement("div", {
              key: ne.slug,
              className: "named-entity-wrapper"
            }, /*#__PURE__*/external_react_default().createElement("div", {
              className: "named-entity-title-bar"
            }, /*#__PURE__*/external_react_default().createElement("a", {
              className: "contentText topicLexiconTitle",
              href: "/topics/".concat(ne.slug),
              target: "_blank"
            }, /*#__PURE__*/external_react_default().createElement("span", {
              className: "en"
            }, ne.primaryTitle.en), /*#__PURE__*/external_react_default().createElement("span", {
              className: "he"
            }, ne.primaryTitle.he)), /*#__PURE__*/external_react_default().createElement(ToolTipped, {
              altText: dataSourceText,
              classes: "saveButton tooltip-toggle three-dots-button"
            }, /*#__PURE__*/external_react_default().createElement("img", {
              src: "/static/img/three-dots.svg",
              alt: dataSourceText
            }))), ne.timePeriod ? /*#__PURE__*/external_react_default().createElement("div", {
              className: "named-entity-time-period"
            }, /*#__PURE__*/external_react_default().createElement("div", {
              className: "smallText"
            }, /*#__PURE__*/external_react_default().createElement("span", {
              className: "int-en"
            }, ne.timePeriod.name.en), /*#__PURE__*/external_react_default().createElement("span", {
              className: "int-he"
            }, ne.timePeriod.name.he)), /*#__PURE__*/external_react_default().createElement("div", {
              className: "smallText"
            }, /*#__PURE__*/external_react_default().createElement("span", {
              className: "int-en"
            }, ne.timePeriod.yearRange.en), /*#__PURE__*/external_react_default().createElement("span", {
              className: "int-he"
            }, ne.timePeriod.yearRange.he))) : null, /*#__PURE__*/external_react_default().createElement("div", {
              className: "contentText named-entity-description"
            }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
              markdown: {
                en: ne.description ? ne.description.en : "No description known for '".concat(ne.primaryTitle.en, "'"),
                he: ne.description ? ne.description.he : "\u05DC\u05D0 \u05E7\u05D9\u05D9\u05DD \u05DE\u05D9\u05D3\u05E2 \u05E2\u05D1\u05D5\u05E8 '".concat(ne.primaryTitle.he, "'")
              }
            })));
          });
          content = !!this.state.namedEntity.possibilities ? /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("div", {
            className: "named-entity-ambiguous"
          }, /*#__PURE__*/external_react_default().createElement("i", {
            className: "systemText"
          }, /*#__PURE__*/external_react_default().createElement("span", {
            className: "int-en"
          }, "\"".concat(this.props.selectedNamedEntityText, "\" could refer to one of the following rabbis:")), /*#__PURE__*/external_react_default().createElement("span", {
            className: "int-he"
          }, "\u05D9\u05D9\u05EA\u05DB\u05DF \u05E9-\"".concat(this.props.selectedNamedEntityText, "\" \u05DE\u05EA\u05D9\u05D9\u05D7\u05E1 \u05DC\u05D0\u05D7\u05D3 \u05D4\u05E8\u05D1\u05E0\u05D9\u05DD \u05D4\u05D1\u05D0\u05D9\u05DD:")))), namedEntityContent) : namedEntityContent;
        }
      } else if (this.shouldActivate(this.props.selectedWords)) {
        if (!this.state.loaded) {
          // console.log("lexicon not yet loaded");
          content = /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
            message: "Looking up words...",
            heMessage: "\u05DE\u05D7\u05E4\u05E9 \u05DE\u05D9\u05DC\u05D9\u05DD..."
          });
        } else if (this.state.entries.length === 0) {
          if (this.props.selectedWords.length > 0) {
            content = /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
              message: enEmpty,
              heMessage: heEmpty
            });
          }
        } else {
          var entries = this.state.entries;
          content = entries.filter(function (e) {
            return !refCats || e['parent_lexicon_details']['text_categories'].length === 0 || e['parent_lexicon_details']['text_categories'].indexOf(refCats) > -1;
          }).map(function (entry, i) {
            return /*#__PURE__*/external_react_default().createElement(LexiconEntry, {
              data: entry,
              onEntryClick: this.props.onEntryClick,
              onCitationClick: this.props.onCitationClick,
              key: i
            });
          }.bind(this));
          content = content.length ? content : /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
            message: enEmpty,
            heMessage: heEmpty
          });
        }
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "lexicon-content"
      }, /*#__PURE__*/external_react_default().createElement(js_DictionarySearch, {
        interfaceLang: this.props.interfaceLang,
        showWordList: this.searchWord,
        contextSelector: ".lexicon-content"
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "lexicon-results"
      }, content));
    }
  }]);
  return LexiconBox;
}((external_react_class_default()));
LexiconBox.propTypes = {
  interfaceLang: (external_prop_types_default()).string.isRequired,
  selectedWords: (external_prop_types_default()).string,
  oref: (external_prop_types_default()).object,
  srefs: (external_prop_types_default()).array,
  onEntryClick: (external_prop_types_default()).func,
  onCitationClick: (external_prop_types_default()).func
};
var LexiconEntry = /*#__PURE__*/function (_Component2) {
  LexiconBox_inherits(LexiconEntry, _Component2);
  var _super2 = LexiconBox_createSuper(LexiconEntry);
  function LexiconEntry() {
    LexiconBox_classCallCheck(this, LexiconEntry);
    return _super2.apply(this, arguments);
  }
  LexiconBox_createClass(LexiconEntry, [{
    key: "isBDB",
    value: function isBDB(entry) {
      return RegExp(/^BDB.*?Dict/).test(entry['parent_lexicon']);
    }
  }, {
    key: "defaultHeadwordString",
    value: function defaultHeadwordString(entry) {
      var headwords = [entry['headword']];
      if ('alt_headwords' in entry) {
        headwords = headwords.concat(entry['alt_headwords']);
      }
      return headwords.map(function (e, i) {
        return /*#__PURE__*/external_react_default().createElement("span", {
          className: "headword",
          key: i,
          dir: "rtl"
        }, e);
      }).reduce(function (prev, curr) {
        return [prev, ', ', curr];
      });
    }
  }, {
    key: "bdbHeadwordString",
    value: function bdbHeadwordString(entry) {
      var peculiar = entry.peculiar ? '‡ ' : '';
      var allCited = entry.all_cited ? '† ' : '';
      var ordinal = entry.ordinal ? "".concat(entry["ordinal"], " ") : '';
      var hw = /*#__PURE__*/external_react_default().createElement("span", {
        dir: "rtl"
      }, entry['headword'].replace(/[⁰¹²³⁴⁵⁶⁷⁸⁹]*$/, ''));
      var occurrences = entry.occurrence ? /*#__PURE__*/external_react_default().createElement("sub", null, entry['occurrences']) : '';
      var alts = entry.alt_headwords ? entry['alt_headwords'].map(function (alt) {
        var ahw = /*#__PURE__*/external_react_default().createElement("span", {
          dir: "rtl"
        }, alt['word']);
        var aocc = 'occurrences' in alt ? /*#__PURE__*/external_react_default().createElement("sub", null, alt['occurrences']) : '';
        return /*#__PURE__*/external_react_default().createElement("span", null, ", ", ahw, aocc);
      }).reduce(function (prev, curr) {
        return [prev, curr];
      }) : '';
      var allHeadwords = entry.headword_suffix ? /*#__PURE__*/external_react_default().createElement("span", null, "[", hw, /*#__PURE__*/external_react_default().createElement("span", {
        className: "headword-suffix",
        dangerouslySetInnerHTML: {
          __html: entry['headword_suffix']
        }
      }), "]", occurrences) : entry['brackets'] == 'all' ? /*#__PURE__*/external_react_default().createElement("span", null, "[", hw, occurrences, alts, "]") : entry['brackets'] == 'first_word' ? /*#__PURE__*/external_react_default().createElement("span", null, "[", hw, occurrences, "]", alts) : /*#__PURE__*/external_react_default().createElement("span", null, hw, occurrences, alts);
      return /*#__PURE__*/external_react_default().createElement("span", {
        className: "headword"
      }, peculiar, allCited, ordinal, /*#__PURE__*/external_react_default().createElement("span", {
        className: "headword"
      }, allHeadwords));
    }
  }, {
    key: "renderLexiconEntrySenses",
    value: function renderLexiconEntrySenses(content) {
      var _this4 = this;
      var grammar = 'grammar' in content ? '(' + content['grammar']['verbal_stem'] + ')' : "";
      var def = 'definition' in content ? /*#__PURE__*/external_react_default().createElement("span", {
        className: "def",
        dangerouslySetInnerHTML: {
          __html: content['definition']
        }
      }) : "";
      var alternative = 'alternative' in content ? /*#__PURE__*/external_react_default().createElement("span", {
        className: "alternative",
        dangerouslySetInnerHTML: {
          __html: content['alternative']
        }
      }) : "";
      var notes = 'notes' in content ? /*#__PURE__*/external_react_default().createElement("span", {
        className: "notes",
        dangerouslySetInnerHTML: {
          __html: content['notes']
        }
      }) : "";
      var sensesElems = 'senses' in content ? content['senses'].map(function (sense, i) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          key: i
        }, _this4.renderLexiconEntrySenses(sense));
      }) : "";
      var senses = sensesElems.length ? /*#__PURE__*/external_react_default().createElement("ol", {
        className: "senses"
      }, sensesElems) : "";
      return /*#__PURE__*/external_react_default().createElement("li", {
        className: "sense"
      }, grammar, def, alternative, notes, senses);
    }
  }, {
    key: "renderBDBEntrySenses",
    value: function renderBDBEntrySenses(content) {
      var _this5 = this;
      var note = content.note ? /*#__PURE__*/external_react_default().createElement("em", null, "Note.") : '';
      var preNun = content.pre_num || '';
      var allCited = content.all_cited ? '†' : '';
      var num = content.num || '';
      var form = content.form || '';
      var occurrences = content.occurrences || '';
      var def = content.definition || '';
      if (content.definition) {
        var text = "".concat(note, " ").concat(preNun, " ").concat(allCited, "<b>").concat(num).concat(form, "</b><sub>").concat(occurrences, "</sub> ").concat(def);
        return /*#__PURE__*/external_react_default().createElement("span", {
          className: "def",
          dangerouslySetInnerHTML: {
            __html: text
          }
        });
      }
      var pre = "".concat(note, " ").concat(preNun, " ").concat(allCited);
      var sensesElems = content.senses ? content.senses.map(function (sense, i) {
        return /*#__PURE__*/external_react_default().createElement("div", null, i == 0 && pre, i == 0 && /*#__PURE__*/external_react_default().createElement("b", null, num, form), i == 0 && /*#__PURE__*/external_react_default().createElement("sub", null, occurrences), _this5.renderBDBEntrySenses(sense));
      }) : "";
      var senses = sensesElems.length ? /*#__PURE__*/external_react_default().createElement("div", null, sensesElems) : "";
      return /*#__PURE__*/external_react_default().createElement("div", null, senses);
    }
  }, {
    key: "getRef",
    value: function getRef() {
      var ind = this.props.data.parent_lexicon_details.index_title;
      return ind ? "".concat(ind, ", ").concat(this.props.data.headword) : "";
    }
  }, {
    key: "handleClick",
    value: function handleClick(event) {
      if ($(event.target).hasClass("refLink")) {
        //Click of citation
        event.preventDefault();
        var ref = sefaria.humanRef($(event.target).attr("data-ref"));
        this.props.onCitationClick(ref, this.props.sref);
        event.stopPropagation();
        sefaria.track.event("Reader", "Citation Link Click", ref);
      } else if (this.props.onEntryClick) {
        //Click on the body of the TextRange itself from TextList
        this.props.onEntryClick(this.getRef());
        sefaria.track.event("Reader", "Click Dictionary Entry from Lookup", this.getRef());
      }
    }
  }, {
    key: "handleKeyPress",
    value: function handleKeyPress(event) {
      if (event.charCode == 13) {
        this.handleClick(event);
      }
    }
  }, {
    key: "renderLexiconAttribution",
    value: function renderLexiconAttribution() {
      var entry = this.props.data;
      var lexicon_dtls = entry['parent_lexicon_details'];
      var sourceContent = /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Source: "), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05DE\u05E7\u05D5\u05E8: "), 'source' in lexicon_dtls ? lexicon_dtls['source'] : lexicon_dtls['source_url']);
      var attributionContent = /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Creator: "), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D9\u05D5\u05E6\u05E8: "), 'attribution' in lexicon_dtls ? lexicon_dtls['attribution'] : lexicon_dtls['attribution_url']);
      return /*#__PURE__*/external_react_default().createElement("div", null, 'source_url' in lexicon_dtls ? /*#__PURE__*/external_react_default().createElement("a", {
        target: "_blank",
        href: lexicon_dtls['source_url']
      }, sourceContent) : sourceContent, 'attribution_url' in lexicon_dtls ? /*#__PURE__*/external_react_default().createElement("a", {
        target: "_blank",
        href: lexicon_dtls['attribution_url']
      }, attributionContent) : attributionContent);
    }
  }, {
    key: "render",
    value: function render() {
      var entry = this.props.data;
      var headwordClassNames = external_classnames_default()('headword', entry['parent_lexicon_details']["to_language"].slice(0, 2));
      var definitionClassNames = external_classnames_default()('definition-content', entry['parent_lexicon_details']["to_language"].slice(0, 2));
      var headwordString = this.isBDB(entry) ? this.bdbHeadwordString(entry) : this.defaultHeadwordString(entry);
      var morphologyHtml = 'morphology' in entry['content'] ? /*#__PURE__*/external_react_default().createElement("span", {
        className: "morphology"
      }, "\xA0(", entry['content']['morphology'], ")") : "";
      var langHtml = "";
      if ('language_code' in entry || 'language_reference' in entry) {
        langHtml = /*#__PURE__*/external_react_default().createElement("span", {
          className: "lang-ref"
        }, "\xA0", 'language_code' in entry ? entry['language_code'] : "", 'language_reference' in entry ? /*#__PURE__*/external_react_default().createElement("span", {
          className: "language_reference",
          dangerouslySetInnerHTML: {
            __html: entry['language_reference']
          }
        }) : "");
      }
      var entryHeadHtml = /*#__PURE__*/external_react_default().createElement("span", {
        className: "headline",
        dir: "ltr"
      }, headwordString, morphologyHtml, langHtml);
      var endnotes = 'notes' in entry ? /*#__PURE__*/external_react_default().createElement("span", {
        className: "notes",
        dangerouslySetInnerHTML: {
          __html: entry['notes']
        }
      }) : "";
      var derivatives = 'derivatives' in entry ? /*#__PURE__*/external_react_default().createElement("span", {
        className: "derivatives",
        dangerouslySetInnerHTML: {
          __html: entry['derivatives']
        }
      }) : "";
      var senses = this.isBDB(entry) ? this.renderBDBEntrySenses(entry['content']) : this.renderLexiconEntrySenses(entry['content']);
      var attribution = this.renderLexiconAttribution();
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "entry",
        onClick: this.handleClick,
        onKeyPress: this.handleKeyPress,
        "data-ref": this.getRef()
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: headwordClassNames
      }, entryHeadHtml), /*#__PURE__*/external_react_default().createElement("div", {
        className: definitionClassNames
      }, /*#__PURE__*/external_react_default().createElement("ol", {
        className: "definition"
      }, senses, endnotes, derivatives)), /*#__PURE__*/external_react_default().createElement("div", {
        className: "attribution"
      }, attribution));
    }
  }]);
  return LexiconEntry;
}((external_react_class_default()));
LexiconEntry.propTypes = {
  data: (external_prop_types_default()).object.isRequired,
  onEntryClick: (external_prop_types_default()).func,
  onCitationClick: (external_prop_types_default()).func
};
/* harmony default export */ const js_LexiconBox = (LexiconBox);
;// CONCATENATED MODULE: ../static/js/AboutBox.jsx
function AboutBox_typeof(obj) { "@babel/helpers - typeof"; return AboutBox_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, AboutBox_typeof(obj); }
function AboutBox_slicedToArray(arr, i) { return AboutBox_arrayWithHoles(arr) || AboutBox_iterableToArrayLimit(arr, i) || AboutBox_unsupportedIterableToArray(arr, i) || AboutBox_nonIterableRest(); }
function AboutBox_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function AboutBox_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return AboutBox_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return AboutBox_arrayLikeToArray(o, minLen); }
function AboutBox_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function AboutBox_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function AboutBox_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function AboutBox_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function AboutBox_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, AboutBox_toPropertyKey(descriptor.key), descriptor); } }
function AboutBox_createClass(Constructor, protoProps, staticProps) { if (protoProps) AboutBox_defineProperties(Constructor.prototype, protoProps); if (staticProps) AboutBox_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function AboutBox_toPropertyKey(arg) { var key = AboutBox_toPrimitive(arg, "string"); return AboutBox_typeof(key) === "symbol" ? key : String(key); }
function AboutBox_toPrimitive(input, hint) { if (AboutBox_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (AboutBox_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function AboutBox_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) AboutBox_setPrototypeOf(subClass, superClass); }
function AboutBox_setPrototypeOf(o, p) { AboutBox_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return AboutBox_setPrototypeOf(o, p); }
function AboutBox_createSuper(Derived) { var hasNativeReflectConstruct = AboutBox_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = AboutBox_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = AboutBox_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return AboutBox_possibleConstructorReturn(this, result); }; }
function AboutBox_possibleConstructorReturn(self, call) { if (call && (AboutBox_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return AboutBox_assertThisInitialized(self); }
function AboutBox_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function AboutBox_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function AboutBox_getPrototypeOf(o) { AboutBox_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return AboutBox_getPrototypeOf(o); }








var AboutBox = /*#__PURE__*/function (_Component) {
  AboutBox_inherits(AboutBox, _Component);
  var _super = AboutBox_createSuper(AboutBox);
  function AboutBox(props) {
    var _this;
    AboutBox_classCallCheck(this, AboutBox);
    _this = _super.call(this, props);
    _this._includeOtherVersionsLangs = ["he"];
    _this.state = {
      versionLangMap: null,
      currentVersionsByActualLangs: sefaria.transformVersionObjectsToByActualLanguageKeys(_this.props.currObjectVersions),
      details: sefaria.getIndexDetailsFromCache(props.title)
    };
    return _this;
  }
  AboutBox_createClass(AboutBox, [{
    key: "setTextMetaData",
    value: function setTextMetaData() {
      var _this2 = this;
      if (this.props.title == "Sheet") {
        var sheetID = sefaria.sheets.extractIdFromSheetRef(this.props.srefs);
        if (!sefaria.sheets.loadSheetByID(sheetID)) {
          sefaria.sheets.loadSheetByID(sheetID, function (data) {
            this.setState({
              details: data
            });
          }.bind(this));
        } else {
          this.setState({
            details: sefaria.sheets.loadSheetByID(sheetID)
          });
        }
      } else {
        sefaria.getIndexDetails(this.props.title).then(function (data) {
          _this2.setState({
            details: data
          });
        });
      }
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      this.setTextMetaData();
      sefaria.getSourceVersions(this.props.sectionRef).then(this.onVersionsLoad);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (prevProps.title !== this.props.title || prevProps.masterPanelLanguage !== this.props.masterPanelLanguage || !sefaria.util.object_equals(prevProps.currObjectVersions, this.props.currObjectVersions)) {
        this.setState({
          details: null
        });
        this.setTextMetaData();
        sefaria.getSourceVersions(this.props.sectionRef).then(this.onVersionsLoad);
      }
    }
  }, {
    key: "onVersionsLoad",
    value: function onVersionsLoad(versions) {
      var _this3 = this;
      //rearrange the current selected versions to be mapped by their real language,
      // then sort the current version to the top of its language list
      var versionsByLang = versions;
      var currentVersionsByActualLangs = sefaria.transformVersionObjectsToByActualLanguageKeys(this.props.currObjectVersions);
      var _loop = function _loop() {
        var _ref = _Object$entries[_i2];
        _ref2 = AboutBox_slicedToArray(_ref, 2);
        var lang = _ref2[0];
        var ver = _ref2[1];
        if (_this3._includeOtherVersionsLangs.includes(lang)) {
          //remove current version if its "he"
          versionsByLang[lang] = versionsByLang[lang].filter(function (v) {
            return v.versionTitle != ver.versionTitle;
          });
        }
      };
      for (var _i2 = 0, _Object$entries = Object.entries(currentVersionsByActualLangs); _i2 < _Object$entries.length; _i2++) {
        var _ref2;
        _loop();
      }
      this.setState({
        versionLangMap: versionsByLang,
        currentVersionsByActualLangs: currentVersionsByActualLangs
      });
    }
  }, {
    key: "openVersionInSidebar",
    value: function openVersionInSidebar(versionTitle, versionLanguage) {
      this.props.setConnectionsMode("Translation Open", {
        previousMode: "About"
      });
      this.props.setFilter(sefaria.getTranslateVersionsKey(versionTitle, versionLanguage));
    }
  }, {
    key: "isSheet",
    value: function isSheet() {
      return this.props.srefs[0].startsWith("Sheet");
    }
  }, {
    key: "render",
    value: function render() {
      var _Sefaria$index,
        _this$state,
        _this$state$details,
        _this$state$currentVe,
        _this4 = this,
        _this$state$versionLa,
        _this$state$versionLa2;
      var d = this.state.details;
      var detailsSection = null;
      if (this.isSheet()) {
        if (d) {
          detailSection = /*#__PURE__*/external_react_default().createElement("div", {
            className: "detailsSection"
          }, /*#__PURE__*/external_react_default().createElement("h2", {
            className: "aboutHeader"
          }, /*#__PURE__*/external_react_default().createElement("span", {
            className: "int-en"
          }, "About This Text"), /*#__PURE__*/external_react_default().createElement("span", {
            className: "int-he"
          }, "\u05D0\u05D5\u05D3\u05D5\u05EA \u05E1\u05E4\u05E8 \u05D6\u05D4")), /*#__PURE__*/external_react_default().createElement("div", {
            className: "aboutTitle"
          }, d.title.stripHtml()), /*#__PURE__*/external_react_default().createElement("div", {
            className: "aboutSubtitle"
          }, "By: ", /*#__PURE__*/external_react_default().createElement("a", {
            href: d.ownerProfileUrl
          }, d.ownerName)), /*#__PURE__*/external_react_default().createElement("div", {
            className: "aboutDesc"
          }, /*#__PURE__*/external_react_default().createElement("span", {
            dangerouslySetInnerHTML: {
              __html: d.summary
            }
          })));
        }
        return /*#__PURE__*/external_react_default().createElement("section", {
          className: "aboutBox"
        }, detailSection);
      }
      var category = (_Sefaria$index = sefaria.index((_this$state = this.state) === null || _this$state === void 0 ? void 0 : (_this$state$details = _this$state.details) === null || _this$state$details === void 0 ? void 0 : _this$state$details.title)) === null || _Sefaria$index === void 0 ? void 0 : _Sefaria$index.primary_category;
      var isDictionary = d === null || d === void 0 ? void 0 : d.lexiconName;
      var sourceVersion = (_this$state$currentVe = this.state.currentVersionsByActualLangs) === null || _this$state$currentVe === void 0 ? void 0 : _this$state$currentVe.he;
      var translationVersions = Object.entries(this.state.currentVersionsByActualLangs).filter(function (_ref3) {
        var _ref4 = AboutBox_slicedToArray(_ref3, 2),
          lang = _ref4[0],
          version = _ref4[1];
        return lang != "he";
      }).map(function (_ref5) {
        var _ref6 = AboutBox_slicedToArray(_ref5, 2),
          lang = _ref6[0],
          version = _ref6[1];
        return version;
      });
      var multiple_translations = (translationVersions === null || translationVersions === void 0 ? void 0 : translationVersions.length) > 1;
      var no_source_versions = multiple_translations || (translationVersions === null || translationVersions === void 0 ? void 0 : translationVersions.length) == 1 && !sourceVersion;
      var sourceVersionSectionTitle = {
        en: "Current Version",
        he: "מהדורה נוכחית"
      };
      var translationVersionsSectionTitle = multiple_translations ? {
        en: "Current Translations",
        he: "תרגומים נוכחיים"
      } : {
        en: "Current Translation",
        he: "תרגום נוכחי"
      };
      var alternateVersionsSectionTitle = no_source_versions ? {
        en: "Source Versions",
        he: "מהדורות בשפת המקור"
      } : {
        en: "Alternate Source Versions",
        he: "מהדורות נוספות בשפת המקור"
      };
      var detailSection = null;
      if (d) {
        var _authorsElems$en;
        var authorsElems = {};
        if (d.authors && d.authors.length) {
          var _loop2 = function _loop2() {
            var lang = _arr2[_i3];
            var authorArray = d.authors.filter(function (elem) {
              return !!elem[lang];
            });
            authorsElems[lang] = authorArray.map(function (author, iauthor) {
              return /*#__PURE__*/external_react_default().createElement("span", null, iauthor > 0 ? ", " : "", /*#__PURE__*/external_react_default().createElement("a", {
                key: author.slug,
                href: "/topics/".concat(author.slug)
              }, author[lang]));
            });
          };
          for (var _i3 = 0, _arr2 = ['en', 'he']; _i3 < _arr2.length; _i3++) {
            _loop2();
          }
        }
        // use compPlaceString and compDateString if available. then use compPlace o/w use pubPlace o/w nothing
        var placeTextEn, placeTextHe;
        if (d.compPlaceString) {
          placeTextEn = d.compPlaceString.en;
          placeTextHe = d.compPlaceString.he;
        } else if (d.compPlace) {
          placeTextEn = d.compPlace;
          placeTextHe = d.compPlace;
        } else if (d.pubPlace) {
          placeTextEn = d.pubPlace;
          placeTextHe = d.pubPlace;
        }
        var dateTextEn, dateTextHe;
        if (d.compDateString) {
          dateTextEn = d.compDateString.en;
          dateTextHe = d.compDateString.he;
        } else if (d.compDate) {
          if (d.errorMargin !== 0) {
            //I don't think there are any texts which are mixed BCE/CE
            var lowerDate = Math.abs(d.compDate - d.errorMargin);
            var upperDate = Math.abs(d.compDate - d.errorMargin);
            dateTextEn = "(c.".concat(lowerDate, " - c.").concat(upperDate, " ").concat(d.compDate < 0 ? "BCE" : "CE", ")");
            dateTextHe = "(".concat(lowerDate, " - ").concat(upperDate, " ").concat(d.compDate < 0 ? 'לפנה"ס בקירוב' : 'לספירה בקירוב', ")");
          } else {
            dateTextEn = "(".concat(Math.abs(d.compDate), " ").concat(d.compDate < 0 ? "BCE" : "CE", ")");
            dateTextHe = "(".concat(Math.abs(d.compDate), " ").concat(d.compDate < 0 ? 'לפנה"ס בקירוב' : 'לספירה בקירוב', ")");
          }
        } else if (d.pubDate) {
          dateTextEn = "(".concat(Math.abs(d.pubDate), " ").concat(d.pubDate < 0 ? "BCE" : "CE", ")");
          dateTextHe = "(".concat(Math.abs(d.pubDate), " ").concat(d.pubDate < 0 ? 'לפנה"ס בקירוב' : 'לספירה בקירוב', ")");
        }
        var bookPageUrl = "/" + sefaria.normRef(d.title);
        detailSection = /*#__PURE__*/external_react_default().createElement("div", {
          className: "detailsSection sans-serif"
        }, /*#__PURE__*/external_react_default().createElement("h2", {
          className: "aboutHeader"
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "About This Text")), /*#__PURE__*/external_react_default().createElement("a", {
          href: bookPageUrl,
          className: "aboutTitle serif"
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: d.title,
            he: d.heTitle
          }
        })), /*#__PURE__*/external_react_default().createElement("span", {
          className: "tocCategory"
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: category,
            he: sefaria.hebrewTerm(category)
          }
        })), authorsElems !== null && authorsElems !== void 0 && (_authorsElems$en = authorsElems.en) !== null && _authorsElems$en !== void 0 && _authorsElems$en.length ? /*#__PURE__*/external_react_default().createElement("div", {
          className: "aboutAuthor"
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "aboutAuthorInner"
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "authorLabel"
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: {
            en: "Author:",
            he: "מחבר:"
          }
        })), /*#__PURE__*/external_react_default().createElement("span", {
          className: "authorName"
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          text: authorsElems
        })))) : null, /*#__PURE__*/external_react_default().createElement("div", {
          className: "aboutDesc"
        }, /*#__PURE__*/external_react_default().createElement(ContentText, {
          markdown: {
            en: d === null || d === void 0 ? void 0 : d.enDesc,
            he: (d === null || d === void 0 ? void 0 : d.heDesc) || (d === null || d === void 0 ? void 0 : d.heShortDesc)
          }
        })), !!placeTextEn || !!dateTextEn ? /*#__PURE__*/external_react_default().createElement("div", {
          className: "aboutComposed"
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "en"
        }, "Composed: ".concat(!!placeTextEn ? placeTextEn : "", " ").concat(!!dateTextEn ? dateTextEn : "")), /*#__PURE__*/external_react_default().createElement("span", {
          className: "he"
        }, "\u05E0\u05D5\u05E6\u05E8/\u05E0\u05E2\u05E8\u05DA: ".concat(!!placeTextHe ? placeTextHe : "", " ").concat(!!dateTextHe ? dateTextHe : ""))) : null);
      }
      var versionSectionHe = !!sourceVersion ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "currVersionSection"
      }, /*#__PURE__*/external_react_default().createElement("h2", {
        className: "aboutHeader"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: sourceVersionSectionTitle
      })), /*#__PURE__*/external_react_default().createElement(VersionBlock, {
        key: "".concat(sourceVersion.versionTitle, "|").concat(sourceVersion.actualLanguage),
        rendermode: "about-box",
        sidebarDisplay: true,
        version: sourceVersion,
        currObjectVersions: this.props.currObjectVersions,
        currentRef: this.props.srefs[0],
        firstSectionRef: "firstSectionRef" in sourceVersion ? sourceVersion.firstSectionRef : null
      })) : null;
      var versionSectionEn = !!(translationVersions !== null && translationVersions !== void 0 && translationVersions.length) ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "currVersionSection"
      }, /*#__PURE__*/external_react_default().createElement("h2", {
        className: "aboutHeader"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: translationVersionsSectionTitle
      })), translationVersions.map(function (ve) {
        return /*#__PURE__*/external_react_default().createElement(VersionBlock, {
          key: "".concat(ve.versionTitle, "|").concat(ve.actualLanguage),
          rendermode: "about-box",
          sidebarDisplay: true,
          version: ve,
          currObjectVersions: _this4.props.currObjectVersions,
          currentRef: _this4.props.srefs[0],
          firstSectionRef: "firstSectionRef" in ve ? ve.firstSectionRef : null,
          viewExtendedNotes: _this4.props.viewExtendedNotes
        });
      })) : null;
      var alternateSectionHe = ((_this$state$versionLa = this.state.versionLangMap) === null || _this$state$versionLa === void 0 ? void 0 : (_this$state$versionLa2 = _this$state$versionLa.he) === null || _this$state$versionLa2 === void 0 ? void 0 : _this$state$versionLa2.length) > 0 ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "alternateVersionsSection"
      }, /*#__PURE__*/external_react_default().createElement("h2", {
        className: "aboutHeader"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: alternateVersionsSectionTitle
      })), /*#__PURE__*/external_react_default().createElement(VersionsBlocksList, {
        key: "versions-".concat(Object.values(this.props.currObjectVersions).map(function (v) {
          var _v$versionTitle;
          return (_v$versionTitle = v === null || v === void 0 ? void 0 : v.versionTitle) !== null && _v$versionTitle !== void 0 ? _v$versionTitle : "";
        }).join("|")),
        versionsByLanguages: this.state.versionLangMap,
        currObjectVersions: this.props.currObjectVersions,
        showLanguageHeaders: false,
        currentRef: this.props.srefs[0],
        openVersionInReader: this.props.openVersionInReader,
        openVersionInSidebar: this.openVersionInSidebar,
        viewExtendedNotes: this.props.viewExtendedNotes
      })) : null;
      return /*#__PURE__*/external_react_default().createElement("section", {
        className: "aboutBox"
      }, detailSection, this.props.masterPanelLanguage === "english" ? /*#__PURE__*/external_react_default().createElement("div", null, versionSectionEn, versionSectionHe, alternateSectionHe) : /*#__PURE__*/external_react_default().createElement("div", null, versionSectionHe, versionSectionEn, alternateSectionHe), /*#__PURE__*/external_react_default().createElement(Modules, {
        type: "RelatedTopics",
        props: {
          title: this.props.title
        }
      }), !isDictionary ? /*#__PURE__*/external_react_default().createElement(Modules, {
        type: "DownloadVersions",
        props: {
          sref: this.props.title
        }
      }) : null);
    }
  }]);
  return AboutBox;
}((external_react_class_default()));
AboutBox.propTypes = {
  currObjectVersions: (external_prop_types_default()).object.isRequired,
  masterPanelLanguage: external_prop_types_default().oneOf(["english", "hebrew", "bilingual"]),
  title: (external_prop_types_default()).string.isRequired,
  srefs: (external_prop_types_default()).array.isRequired
};
/* harmony default export */ const js_AboutBox = (AboutBox);
;// CONCATENATED MODULE: ../static/js/TranslationsBox.jsx
function TranslationsBox_typeof(obj) { "@babel/helpers - typeof"; return TranslationsBox_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, TranslationsBox_typeof(obj); }
function TranslationsBox_defineProperty(obj, key, value) { key = TranslationsBox_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function TranslationsBox_slicedToArray(arr, i) { return TranslationsBox_arrayWithHoles(arr) || TranslationsBox_iterableToArrayLimit(arr, i) || TranslationsBox_unsupportedIterableToArray(arr, i) || TranslationsBox_nonIterableRest(); }
function TranslationsBox_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function TranslationsBox_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return TranslationsBox_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TranslationsBox_arrayLikeToArray(o, minLen); }
function TranslationsBox_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function TranslationsBox_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function TranslationsBox_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function TranslationsBox_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function TranslationsBox_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, TranslationsBox_toPropertyKey(descriptor.key), descriptor); } }
function TranslationsBox_createClass(Constructor, protoProps, staticProps) { if (protoProps) TranslationsBox_defineProperties(Constructor.prototype, protoProps); if (staticProps) TranslationsBox_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function TranslationsBox_toPropertyKey(arg) { var key = TranslationsBox_toPrimitive(arg, "string"); return TranslationsBox_typeof(key) === "symbol" ? key : String(key); }
function TranslationsBox_toPrimitive(input, hint) { if (TranslationsBox_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (TranslationsBox_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function TranslationsBox_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) TranslationsBox_setPrototypeOf(subClass, superClass); }
function TranslationsBox_setPrototypeOf(o, p) { TranslationsBox_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return TranslationsBox_setPrototypeOf(o, p); }
function TranslationsBox_createSuper(Derived) { var hasNativeReflectConstruct = TranslationsBox_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = TranslationsBox_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = TranslationsBox_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return TranslationsBox_possibleConstructorReturn(this, result); }; }
function TranslationsBox_possibleConstructorReturn(self, call) { if (call && (TranslationsBox_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return TranslationsBox_assertThisInitialized(self); }
function TranslationsBox_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function TranslationsBox_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function TranslationsBox_getPrototypeOf(o) { TranslationsBox_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return TranslationsBox_getPrototypeOf(o); }









var TranslationsBox = /*#__PURE__*/function (_Component) {
  TranslationsBox_inherits(TranslationsBox, _Component);
  var _super = TranslationsBox_createSuper(TranslationsBox);
  function TranslationsBox(props) {
    var _this;
    TranslationsBox_classCallCheck(this, TranslationsBox);
    _this = _super.call(this, props);
    _this._excludedLangs = ["he"];
    _this.state = {
      versionLangMap: null,
      // object with version languages as keys and array of versions in that lang as values
      currentVersionsByActualLangs: sefaria.transformVersionObjectsToByActualLanguageKeys(_this.props.currObjectVersions)
    };
    return _this;
  }
  TranslationsBox_createClass(TranslationsBox, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      if (!this.isSheet()) {
        sefaria.getTranslations(this.props.sectionRef).then(this.onVersionsLoad);
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (!this.isSheet() && prevProps.sectionRef !== this.props.sectionRef) {
        sefaria.getTranslations(this.props.sectionRef).then(this.onVersionsLoad);
      }
    }
  }, {
    key: "onVersionsLoad",
    value: function onVersionsLoad(versions) {
      var _this2 = this;
      //rearrange the current selected versions to be mapped by their real language,
      // then sort the current version to the top of its language list
      var versionsByLang = versions;
      var currentVersionsByActualLangs = sefaria.transformVersionObjectsToByActualLanguageKeys(this.props.currObjectVersions);
      var _loop = function _loop() {
        var _ref = _Object$entries[_i2];
        _ref2 = TranslationsBox_slicedToArray(_ref, 2);
        var lang = _ref2[0];
        var ver = _ref2[1];
        if (!_this2._excludedLangs.includes(lang)) {
          versionsByLang[lang].sort(function (a, b) {
            return a.versionTitle === ver.versionTitle ? -1 : b.versionTitle === ver.versionTitle ? 1 : 0;
          });
        }
      };
      for (var _i2 = 0, _Object$entries = Object.entries(currentVersionsByActualLangs); _i2 < _Object$entries.length; _i2++) {
        var _ref2;
        _loop();
      }
      this.setState({
        versionLangMap: versionsByLang,
        currentVersionsByActualLangs: currentVersionsByActualLangs
      });
    }
  }, {
    key: "openVersionInSidebar",
    value: function openVersionInSidebar(versionTitle, versionLanguage) {
      this.props.setConnectionsMode("Translation Open");
      this.props.setFilter(sefaria.getTranslateVersionsKey(versionTitle, versionLanguage));
    }
  }, {
    key: "isSheet",
    value: function isSheet() {
      return this.props.srefs[0].startsWith("Sheet");
    }
  }, {
    key: "render",
    value: function render() {
      if (this.isSheet()) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "versionsBox"
        }, /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
          message: "There are no Translations for this sheet source",
          heMessage: "\u05DC\u05DE\u05E7\u05D5\u05E8 \u05D6\u05D4 \u05D0\u05D9\u05DF \u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD"
        }));
      }
      if (this.props.mode === "Translation Open") {
        // A single translation open in the sidebar
        return /*#__PURE__*/external_react_default().createElement(VersionsTextList, {
          srefs: this.props.srefs,
          vFilter: this.props.vFilter,
          recentVFilters: this.props.recentVFilters,
          setFilter: this.props.setFilter,
          onRangeClick: this.props.onRangeClick,
          setConnectionsMode: this.props.setConnectionsMode,
          onCitationClick: this.props.onCitationClick,
          translationLanguagePreference: this.props.translationLanguagePreference
        });
      } else if (this.props.mode === "Translations") {
        if (!this.state.versionLangMap) {
          return /*#__PURE__*/external_react_default().createElement("div", {
            className: "versionsBox"
          }, /*#__PURE__*/external_react_default().createElement(LoadingMessage, null));
        }
        return /*#__PURE__*/external_react_default().createElement(VersionsBlocksList, {
          versionsByLanguages: this.state.versionLangMap,
          currObjectVersions: this.props.currObjectVersions,
          sortPrioritizeLanugage: "en",
          currentRef: this.props.srefs[0],
          openVersionInReader: this.props.openVersionInReader,
          openVersionInSidebar: this.openVersionInSidebar,
          viewExtendedNotes: this.props.viewExtendedNotes,
          inTranslationBox: true
        });
      }
    }
  }]);
  return TranslationsBox;
}((external_react_class_default()));
TranslationsBox.propTypes = {
  currObjectVersions: (external_prop_types_default()).object.isRequired,
  mode: external_prop_types_default().oneOf(["Translations", "Translation Open"]),
  vFilter: (external_prop_types_default()).array,
  recentVFilters: (external_prop_types_default()).array,
  srefs: (external_prop_types_default()).array.isRequired,
  setConnectionsMode: (external_prop_types_default()).func.isRequired,
  setFilter: (external_prop_types_default()).func.isRequired,
  openVersionInReader: (external_prop_types_default()).func.isRequired,
  sectionRef: (external_prop_types_default()).string.isRequired,
  onRangeClick: (external_prop_types_default()).func.isRequired,
  onCitationClick: (external_prop_types_default()).func.isRequired,
  translationLanguagePreference: (external_prop_types_default()).string,
  inTranslationBox: (external_prop_types_default()).bool
};
var VersionsTextList = /*#__PURE__*/function (_Component2) {
  TranslationsBox_inherits(VersionsTextList, _Component2);
  var _super2 = TranslationsBox_createSuper(VersionsTextList);
  function VersionsTextList(props) {
    var _this3;
    TranslationsBox_classCallCheck(this, VersionsTextList);
    _this3 = _super2.call(this, props);
    _this3.state = {
      loaded: false
    };
    return _this3;
  }
  TranslationsBox_createClass(VersionsTextList, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.preloadText(this.props.vFilter);
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      this.preloadText(nextProps.vFilter);
    }
  }, {
    key: "preloadText",
    value: function preloadText(filter) {
      var _this4 = this;
      if (filter.length) {
        this.setState({
          loaded: false
        });
        var sectionRef = this.getSectionRef();
        var _Sefaria$deconstructV = sefaria.deconstructVersionsKey(filter[0]),
          _Sefaria$deconstructV2 = TranslationsBox_slicedToArray(_Sefaria$deconstructV, 2),
          vTitle = _Sefaria$deconstructV2[0],
          language = _Sefaria$deconstructV2[1];
        var enVersion = null,
          heVersion = null;
        if (language === "en") {
          enVersion = vTitle;
        } else {
          heVersion = vTitle;
        }
        sefaria.getText(sectionRef, {
          enVersion: enVersion,
          heVersion: heVersion
        }).then(function () {
          _this4.setState({
            loaded: true
          });
        });
      }
    }
  }, {
    key: "getSectionRef",
    value: function getSectionRef() {
      var ref = this.props.srefs[0]; // TODO account for selections spanning sections
      var sectionRef = sefaria.sectionRef(ref) || ref;
      return sectionRef;
    }
  }, {
    key: "render",
    value: function render() {
      var _this5 = this;
      var _Sefaria$deconstructV3 = sefaria.deconstructVersionsKey(this.props.vFilter[0]),
        _Sefaria$deconstructV4 = TranslationsBox_slicedToArray(_Sefaria$deconstructV3, 2),
        vTitle = _Sefaria$deconstructV4[0],
        language = _Sefaria$deconstructV4[1];
      var currSelectedVersions = TranslationsBox_defineProperty({}, language, vTitle);
      var onRangeClick = function onRangeClick(sref) {
        _this5.props.onRangeClick(sref, false, currSelectedVersions);
      };
      return !this.state.loaded || !this.props.vFilter.length ? /*#__PURE__*/external_react_default().createElement(LoadingMessage, null) : /*#__PURE__*/external_react_default().createElement("div", {
        className: "versionsTextList"
      }, /*#__PURE__*/external_react_default().createElement(RecentFilterSet, {
        srefs: this.props.srefs,
        asHeader: false,
        filter: this.props.vFilter,
        recentFilters: this.props.recentVFilters,
        setFilter: this.props.setFilter
      }), /*#__PURE__*/external_react_default().createElement(js_TextRange, {
        sref: sefaria.humanRef(this.props.srefs),
        currVersions: currSelectedVersions,
        useVersionLanguage: true,
        hideTitle: true,
        numberLabel: 0,
        basetext: false,
        onCitationClick: this.props.onCitationClick,
        translationLanguagePreference: this.props.translationLanguagePreference
      }), /*#__PURE__*/external_react_default().createElement(ConnectionButtons, null, /*#__PURE__*/external_react_default().createElement(OpenConnectionTabButton, {
        srefs: this.props.srefs,
        openInTabCallback: onRangeClick
      }), /*#__PURE__*/external_react_default().createElement(AddConnectionToSheetButton, {
        srefs: this.props.srefs,
        versions: TranslationsBox_defineProperty({}, language, vTitle),
        addToSheetCallback: this.props.setConnectionsMode
      })));
    }
  }]);
  return VersionsTextList;
}((external_react_class_default()));
VersionsTextList.propTypes = {
  srefs: (external_prop_types_default()).array,
  vFilter: (external_prop_types_default()).array,
  recentVFilters: (external_prop_types_default()).array,
  setFilter: (external_prop_types_default()).func.isRequired,
  onRangeClick: (external_prop_types_default()).func.isRequired,
  onCitationClick: (external_prop_types_default()).func.isRequired,
  translationLanguagePreference: (external_prop_types_default()).string
};

// EXTERNAL MODULE: external "jquery"
var external_jquery_ = __webpack_require__("jquery");
;// CONCATENATED MODULE: ../static/js/TopicSearch.jsx
function TopicSearch_typeof(obj) { "@babel/helpers - typeof"; return TopicSearch_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, TopicSearch_typeof(obj); }
function TopicSearch_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ TopicSearch_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == TopicSearch_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function TopicSearch_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function TopicSearch_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { TopicSearch_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { TopicSearch_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function TopicSearch_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function TopicSearch_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, TopicSearch_toPropertyKey(descriptor.key), descriptor); } }
function TopicSearch_createClass(Constructor, protoProps, staticProps) { if (protoProps) TopicSearch_defineProperties(Constructor.prototype, protoProps); if (staticProps) TopicSearch_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function TopicSearch_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) TopicSearch_setPrototypeOf(subClass, superClass); }
function TopicSearch_setPrototypeOf(o, p) { TopicSearch_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return TopicSearch_setPrototypeOf(o, p); }
function TopicSearch_createSuper(Derived) { var hasNativeReflectConstruct = TopicSearch_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = TopicSearch_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = TopicSearch_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return TopicSearch_possibleConstructorReturn(this, result); }; }
function TopicSearch_possibleConstructorReturn(self, call) { if (call && (TopicSearch_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return TopicSearch_assertThisInitialized(self); }
function TopicSearch_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function TopicSearch_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function TopicSearch_getPrototypeOf(o) { TopicSearch_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return TopicSearch_getPrototypeOf(o); }
function TopicSearch_defineProperty(obj, key, value) { key = TopicSearch_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function TopicSearch_toPropertyKey(arg) { var key = TopicSearch_toPrimitive(arg, "string"); return TopicSearch_typeof(key) === "symbol" ? key : String(key); }
function TopicSearch_toPrimitive(input, hint) { if (TopicSearch_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (TopicSearch_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }









var TopicSearch = /*#__PURE__*/function (_Component) {
  TopicSearch_inherits(TopicSearch, _Component);
  var _super = TopicSearch_createSuper(TopicSearch);
  function TopicSearch(props) {
    var _this;
    TopicSearch_classCallCheck(this, TopicSearch);
    _this = _super.call(this, props);
    TopicSearch_defineProperty(TopicSearch_assertThisInitialized(_this), "getSuggestions", /*#__PURE__*/function () {
      var _ref = TopicSearch_asyncToGenerator( /*#__PURE__*/TopicSearch_regeneratorRuntime().mark(function _callee(input) {
        var results, word, callback, completion_objects;
        return TopicSearch_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              results = {
                "currentSuggestions": null,
                "showAddButton": false
              };
              _this.changeInputValue(input);
              if (!(input === "")) {
                _context.next = 4;
                break;
              }
              return _context.abrupt("return", results);
            case 4:
              word = input.trim();
              callback = function callback(d) {
                var topics = [];
                if (d[1].length > 0) {
                  topics = d[1].slice(0, 4).map(function (e) {
                    return {
                      title: e.title,
                      key: e.key
                    };
                  });
                }
                topics.push({
                  title: _this.props.createNewTopicStr + word,
                  key: ""
                });
                return topics;
              };
              _context.next = 8;
              return sefaria.getTopicCompletions(word, callback);
            case 8:
              completion_objects = _context.sent;
              results.currentSuggestions = completion_objects.map(function (suggestion) {
                return {
                  name: suggestion.title,
                  key: suggestion.key,
                  type: suggestion.type,
                  border_color: "#ffffff"
                };
              });
              results.showAddButton = true;
              return _context.abrupt("return", results);
            case 12:
            case "end":
              return _context.stop();
          }
        }, _callee);
      }));
      return function (_x) {
        return _ref.apply(this, arguments);
      };
    }());
    TopicSearch_defineProperty(TopicSearch_assertThisInitialized(_this), "changeInputValue", function (newValue) {
      if (newValue.startsWith(_this.props.createNewTopicStr)) {
        _this.setState({
          showAdminEditor: true,
          value: newValue.replace(_this.props.createNewTopicStr, "")
        });
      } else {
        _this.setState({
          value: newValue
        });
      }
    });
    TopicSearch_defineProperty(TopicSearch_assertThisInitialized(_this), "reset", function () {
      _this.setState({
        showAdminEditor: false,
        value: ""
      });
    });
    _this.state = {
      showAdminEditor: false,
      value: ""
    };
    return _this;
  }
  TopicSearch_createClass(TopicSearch, [{
    key: "validate",
    value: function validate(input, suggestions) {
      var _this2 = this;
      var match = false;
      suggestions.map(function (topic) {
        if (topic.name.toLowerCase() === input.toLowerCase()) {
          _this2.post(topic.key);
          match = true;
          _this2.changeInputValue("");
        }
      });
      if (!match) {
        alert("Please select an option through the dropdown menu.");
      }
    }
  }, {
    key: "post",
    value: function post(slug) {
      var postJSON = JSON.stringify({
        "topic": slug,
        'interface_lang': sefaria.interfaceLang
      });
      var srefs = this.props.srefs;
      var update = this.props.update;
      var reset = this.reset;
      sefariaJquery.post("/api/ref-topic-links/" + sefaria.normRef(this.props.srefs), {
        "json": postJSON
      }, /*#__PURE__*/function () {
        var _ref2 = TopicSearch_asyncToGenerator( /*#__PURE__*/TopicSearch_regeneratorRuntime().mark(function _callee2(data) {
          var sectionRef;
          return TopicSearch_regeneratorRuntime().wrap(function _callee2$(_context2) {
            while (1) switch (_context2.prev = _context2.next) {
              case 0:
                if (!data.error) {
                  _context2.next = 4;
                  break;
                }
                alert(data.error);
                _context2.next = 13;
                break;
              case 4:
                _context2.next = 6;
                return sefaria.getRef(sefaria.normRef(srefs)).sectionRef;
              case 6:
                sectionRef = _context2.sent;
                srefs.map(function (sref) {
                  if (!sefaria._refTopicLinks[sref]) {
                    sefaria._refTopicLinks[sref] = [];
                  }
                  sefaria._refTopicLinks[sref].push(data);
                });
                if (!sefaria._refTopicLinks[sectionRef]) {
                  sefaria._refTopicLinks[sectionRef] = [];
                }
                sefaria._refTopicLinks[sectionRef].push(data);
                update();
                reset();
                alert("Topic added.");
              case 13:
              case "end":
                return _context2.stop();
            }
          }, _callee2);
        }));
        return function (_x2) {
          return _ref2.apply(this, arguments);
        };
      }()).fail(function (xhr, status, errorThrown) {
        alert("Unfortunately, there may have been an error saving this topic information: " + errorThrown);
      });
    }
  }, {
    key: "render",
    value: function render() {
      if (this.state.showAdminEditor) {
        var topicData = {
          origEn: this.state.value
        };
        return /*#__PURE__*/external_react_default().createElement(TopicEditor, {
          origData: topicData,
          close: this.reset,
          onCreateSuccess: this.post
        });
      } else {
        return /*#__PURE__*/external_react_default().createElement(Autocompleter, {
          selectedCallback: this.validate,
          getSuggestions: this.getSuggestions,
          inputPlaceholder: sefaria.translation(this.props.contentLang, "Search for a Topic"),
          buttonTitle: sefaria.translation(this.props.contentLang, "Add Topic"),
          inputValue: this.state.value,
          changeInputValue: this.changeInputValue,
          showSuggestionsOnSelect: false,
          autocompleteClassNames: "topicSearch addInterfaceInput"
        });
      }
    }
  }]);
  return TopicSearch;
}((external_react_class_default()));
TopicSearch.propTypes = {
  contextSelector: (external_prop_types_default()).string.isRequired,
  // CSS Selector for uniquely identifiable context that this is in.
  srefs: (external_prop_types_default()).array.isRequired,
  //srefs of TopicList
  update: (external_prop_types_default()).func.isRequired,
  //used to add topic to TopicList
  createNewTopicStr: (external_prop_types_default()).string.isRequired,
  // string that should be displayed when there's an option to create new topic
  contentLang: (external_prop_types_default()).string.isRequired //
};

/* harmony default export */ const js_TopicSearch = (TopicSearch);
;// CONCATENATED MODULE: ../static/js/WebPage.jsx




function arrangeAuthorName(authorName) {
  return authorName.split(', ').reverse().join(' ');
}
function addAuthorToString(finalJoiner, accumulator, author, i, authors) {
  var authorsNum = authors === null || authors === void 0 ? void 0 : authors.length;
  var joiner = i === 0 ? '' : i === authorsNum - 1 ? finalJoiner : ', ';
  return "".concat(accumulator).concat(joiner).concat(arrangeAuthorName(author));
}
function getAuthorsAsString(isHebrew, authors) {
  var finalJoiner = isHebrew ? ' ו' : ' and ';
  return authors === null || authors === void 0 ? void 0 : authors.reduce(function () {
    for (var _len = arguments.length, reduceArgs = new Array(_len), _key = 0; _key < _len; _key++) {
      reduceArgs[_key] = arguments[_key];
    }
    return addAuthorToString.apply(void 0, [finalJoiner].concat(reduceArgs));
  }, '');
}
var AuthorString = function AuthorString(_ref) {
  var authors = _ref.authors,
    isHebrew = _ref.isHebrew;
  var authorsNum = authors === null || authors === void 0 ? void 0 : authors.length;
  var author = authorsNum > 1 ? 'Authors' : 'Author';
  var authorsNames = getAuthorsAsString(isHebrew, authors);
  return authorsNames ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "authors"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, author), ": ", authorsNames) : null;
};
AuthorString.propTypes = {
  authors: (external_prop_types_default()).array,
  //array of strings
  isHebrew: (external_prop_types_default()).bool
};
var WebPage = function WebPage(_ref2) {
  var authors = _ref2.authors,
    isHebrew = _ref2.isHebrew,
    favicon = _ref2.favicon,
    url = _ref2.url,
    domain = _ref2.domain,
    title = _ref2.title,
    description = _ref2.description,
    articleSource = _ref2.articleSource,
    anchorRef = _ref2.anchorRef;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "webpage" + (isHebrew ? " hebrew" : ""),
    key: url
  }, /*#__PURE__*/external_react_default().createElement("img", {
    className: "icon",
    src: favicon
  }), /*#__PURE__*/external_react_default().createElement("a", {
    className: "title",
    href: url,
    target: "_blank"
  }, title), /*#__PURE__*/external_react_default().createElement("div", {
    className: "domain"
  }, domain), description ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "description"
  }, description) : null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "webpageMetadata"
  }, /*#__PURE__*/external_react_default().createElement(AuthorString, {
    authors: authors,
    isHebrew: isHebrew
  }), articleSource ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "articleSource"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Source"), ": ", articleSource.title, articleSource.related_parts ? " ".concat(articleSource.related_parts) : '') : null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "citing"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Citing"), ": ", sefaria._r(anchorRef))));
};
WebPage.propTypes = {
  authors: (external_prop_types_default()).array,
  //array of strings
  isHebrew: (external_prop_types_default()).bool,
  favicon: (external_prop_types_default()).string,
  url: (external_prop_types_default()).string,
  domain: (external_prop_types_default()).string,
  title: (external_prop_types_default()).string,
  articleSource: (external_prop_types_default()).object,
  anchorRef: (external_prop_types_default()).string
};
/* harmony default export */ const js_WebPage = (WebPage);
;// CONCATENATED MODULE: ../static/js/ConnectionsPanel.jsx
function ConnectionsPanel_extends() { ConnectionsPanel_extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return ConnectionsPanel_extends.apply(this, arguments); }
function ConnectionsPanel_slicedToArray(arr, i) { return ConnectionsPanel_arrayWithHoles(arr) || ConnectionsPanel_iterableToArrayLimit(arr, i) || ConnectionsPanel_unsupportedIterableToArray(arr, i) || ConnectionsPanel_nonIterableRest(); }
function ConnectionsPanel_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function ConnectionsPanel_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return ConnectionsPanel_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return ConnectionsPanel_arrayLikeToArray(o, minLen); }
function ConnectionsPanel_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function ConnectionsPanel_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function ConnectionsPanel_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function ConnectionsPanel_typeof(obj) { "@babel/helpers - typeof"; return ConnectionsPanel_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, ConnectionsPanel_typeof(obj); }
function ConnectionsPanel_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function ConnectionsPanel_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ConnectionsPanel_ownKeys(Object(source), !0).forEach(function (key) { ConnectionsPanel_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ConnectionsPanel_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function ConnectionsPanel_defineProperty(obj, key, value) { key = ConnectionsPanel_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function ConnectionsPanel_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function ConnectionsPanel_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, ConnectionsPanel_toPropertyKey(descriptor.key), descriptor); } }
function ConnectionsPanel_createClass(Constructor, protoProps, staticProps) { if (protoProps) ConnectionsPanel_defineProperties(Constructor.prototype, protoProps); if (staticProps) ConnectionsPanel_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function ConnectionsPanel_toPropertyKey(arg) { var key = ConnectionsPanel_toPrimitive(arg, "string"); return ConnectionsPanel_typeof(key) === "symbol" ? key : String(key); }
function ConnectionsPanel_toPrimitive(input, hint) { if (ConnectionsPanel_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (ConnectionsPanel_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function ConnectionsPanel_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) ConnectionsPanel_setPrototypeOf(subClass, superClass); }
function ConnectionsPanel_setPrototypeOf(o, p) { ConnectionsPanel_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return ConnectionsPanel_setPrototypeOf(o, p); }
function ConnectionsPanel_createSuper(Derived) { var hasNativeReflectConstruct = ConnectionsPanel_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = ConnectionsPanel_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = ConnectionsPanel_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return ConnectionsPanel_possibleConstructorReturn(this, result); }; }
function ConnectionsPanel_possibleConstructorReturn(self, call) { if (call && (ConnectionsPanel_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return ConnectionsPanel_assertThisInitialized(self); }
function ConnectionsPanel_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function ConnectionsPanel_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function ConnectionsPanel_getPrototypeOf(o) { ConnectionsPanel_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return ConnectionsPanel_getPrototypeOf(o); }


























var ConnectionsPanel = /*#__PURE__*/function (_Component) {
  ConnectionsPanel_inherits(ConnectionsPanel, _Component);
  var _super = ConnectionsPanel_createSuper(ConnectionsPanel);
  function ConnectionsPanel(props) {
    var _this;
    ConnectionsPanel_classCallCheck(this, ConnectionsPanel);
    _this = _super.call(this, props);
    _this._savedHistorySegments = new Set();
    _this.state = {
      flashMessage: null,
      currObjectVersions: {
        en: null,
        he: null
      },
      mainVersionLanguage: props.masterPanelLanguage === "bilingual" ? "hebrew" : props.masterPanelLanguage,
      availableTranslations: [],
      linksLoaded: false,
      // has the list of refs been loaded
      connectionSummaryCollapsed: true,
      currentlyVisibleSectionRef: sefaria.sectionRef(_this.props.currentlyVisibleRef)
    };
    return _this;
  }
  ConnectionsPanel_createClass(ConnectionsPanel, [{
    key: "toggleTopLevelCollapsed",
    value: function toggleTopLevelCollapsed() {
      this.setState({
        connectionSummaryCollapsed: !this.state.connectionSummaryCollapsed
      });
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      this._isMounted = true;
      this.loadData();
      this.getCurrentVersions();
      this.debouncedCheckVisibleSegments = sefaria.util.debounce(this.checkVisibleSegments, 100);
      this.addScrollListener();
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this._isMounted = false;
      this.removeScrollListener();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (!prevProps.srefs.compare(this.props.srefs)) {
        this.loadData();
      }
      // Turn on the lexicon when receiving new words if they are less than 3
      // and don't span refs.
      if (this.props.selectedWords && this.props.selectedWords !== prevProps.selectedWords && this.props.selectedWords.match(/[\s:\u0590-\u05ff.]+/) && this.props.selectedWords.split(" ").length < 3 && this.props.srefs.length === 1) {
        this.props.setConnectionsMode("Lexicon");
      }
      // Go back to main sidebar when words are unselected
      if (prevProps.selectedWords && prevProps.mode === "Lexicon" && !this.props.selectedWords && !this.props.selectedNamedEntity) {
        this.props.setConnectionsMode("Resources");
      }
      if (prevProps.currVersions.en !== this.props.currVersions.en || prevProps.currVersions.he !== this.props.currVersions.he || prevProps.masterPanelLanguage !== this.props.masterPanelLanguage || prevProps.srefs[0] !== this.props.srefs[0]) {
        this.getCurrentVersions();
      }
      if (prevProps.mode !== this.props.mode || prevProps.connectionsCategory !== this.props.connectionsCategory) {
        this.removeScrollListener();
        if (this.isScrollReset()) {
          this.props.setSideScrollPosition(null);
        } else if (this.props.scrollPosition && this.isScrollMonitored()) {
          sefariaJquery(".content").scrollTop(this.props.scrollPosition).trigger("scroll");
        }
        this.addScrollListener();
      }
    }
  }, {
    key: "isScrollMonitored",
    value: function isScrollMonitored() {
      return ["ConnectionsList", "WebPages", "Sheets"].includes(this.props.mode);
    }
  }, {
    key: "isScrollReset",
    value: function isScrollReset() {
      return ["Resources"].includes(this.props.mode);
    }
  }, {
    key: "addScrollListener",
    value: function addScrollListener() {
      this.$scrollView = sefariaJquery(".connectionsPanel .texts");
      if (this.$scrollView[0]) {
        this.$scrollView[0].addEventListener("scroll", this.handleScroll);
      }
    }
  }, {
    key: "removeScrollListener",
    value: function removeScrollListener() {
      if (!!this.$scrollView && this.$scrollView[0]) {
        this.$scrollView[0].removeEventListener("scroll", this.handleScroll);
      }
    }
  }, {
    key: "handleScroll",
    value: function handleScroll(event) {
      if (this.isScrollMonitored()) {
        this.props.setSideScrollPosition(sefariaJquery(event.target).scrollTop());
      } else if (this.props.mode === "TextList") {
        this.debouncedCheckVisibleSegments();
      }
    }
  }, {
    key: "checkVisibleSegments",
    value: function checkVisibleSegments() {
      var _this2 = this;
      if (!this._isMounted || !this.props.filter || !this.props.filter.length) {
        return;
      }
      var initialFilter = this.props.filter;
      var initialRefs = this.props.srefs;
      this.$scrollView.find(".textListTextRangeBox .textRange").each(function (i, element) {
        if (!_this2.isSegmentVisible(element)) {
          return;
        }
        var callback = _this2.onIntentTimer.bind(null, element, initialFilter, initialRefs);
        _this2.props.checkIntentTimer(null, callback); // instead of saving timer, we want to have multiple timers running because multiple segments can be on screen
      });
    }
  }, {
    key: "onIntentTimer",
    value: function onIntentTimer(element, initialFilter, initialRefs) {
      if (!this._isMounted || !this.isSegmentVisible(element) || this.didFilterChange(initialFilter, initialRefs, this.props.filter, this.props.srefs)) {
        return;
      }
      var ref = element.getAttribute('data-ref');
      if (this._savedHistorySegments.has(ref)) {
        return;
      }
      var parsedRef = sefaria.parseRef(ref);
      // TODO: add version info once we support that in links
      sefaria.saveUserHistory({
        ref: ref,
        versions: {
          en: null,
          he: null
        },
        book: parsedRef.book,
        language: this.props.contentLang,
        secondary: true
      });
      this._savedHistorySegments.add(ref);
    }
  }, {
    key: "isSheet",
    value: function isSheet() {
      return this.props.srefs[0].startsWith("Sheet");
    }
  }, {
    key: "isSegmentVisible",
    value: function isSegmentVisible(segment) {
      var threshold = 100;
      var $segment = sefariaJquery(segment);
      var top = $segment.offset().top - this.$scrollView.offset().top;
      var bottom = $segment.outerHeight() + top;
      return top < this.$scrollView.outerHeight() - threshold && bottom > threshold;
    }
  }, {
    key: "didFilterChange",
    value: function didFilterChange(prevFilter, prevRefs, nextFilter, nextRefs) {
      if (!prevFilter || !nextFilter || !prevFilter.length || !nextFilter.length || prevFilter[0] !== nextFilter[0]) {
        return true;
      }
      return !prevRefs.compare(nextRefs);
    }
  }, {
    key: "sectionRef",
    value: function sectionRef() {
      return sefaria.sectionRef(sefaria.humanRef(this.props.srefs)) || this.props.srefs;
    }
  }, {
    key: "loadData",
    value: function loadData() {
      var _this3 = this;
      var ref = this.sectionRef();
      if (!sefaria.related(ref)) {
        sefaria.related(ref, function (data) {
          if (this._isMounted) {
            this.setState({
              linksLoaded: true
            });
          }
        }.bind(this));
      } else {
        this.setState({
          linksLoaded: true
        });
      }
      if (!this.isSheet()) {
        sefaria.getTranslations(ref).then(function (versions) {
          return _this3.setState({
            availableTranslations: Object.values(versions).flat()
          });
        }); //for counting translations
        sefaria.getRef(this.props.currentlyVisibleRef).then(function (data) {
          //this does not properly return a secionRef for a spanning/ranged ref
          var currRef = typeof data == "string" ? sefaria.sectionRef(data) : data["sectionRef"]; //this is an annoying consequence of getRef not actually returning a
          // consistent response. Its either the ref from cache or the entire text api response if async.
          _this3.setState({
            currentlyVisibleSectionRef: currRef
          });
        });
        //this.setState({currentlyVisibleSectionRef: Sefaria.sectionRef(this.props.currentlyVisibleRef)});
      }
    }
  }, {
    key: "reloadData",
    value: function reloadData() {
      this.setState({
        linksLoaded: false
      });
      sefaria.clearLinks();
      this.loadData();
    }
  }, {
    key: "flashMessage",
    value: function flashMessage(msg) {
      this.setState({
        flashMessage: msg
      });
      setTimeout(function () {
        this.setState({
          flashMessage: null
        });
      }.bind(this), 3000);
    }
  }, {
    key: "onSave",
    value: function onSave() {
      this.reloadData();
      this.props.setConnectionsMode("Resources");
      this.flashMessage("Success! You've created a new connection.");
    }
  }, {
    key: "getData",
    value: function getData(cb) {
      // Gets data about this text from cache, which may be null.
      var versionPref = sefaria.versionPreferences.getVersionPref(this.props.srefs[0]);
      return sefaria.getText(this.props.srefs[0], {
        context: 1,
        enVersion: this.props.currVersions.en,
        heVersion: this.props.currVersions.he,
        translationLanguagePreference: this.props.translationLanguagePreference,
        versionPref: versionPref
      }).then(cb);
    }
  }, {
    key: "getVersionFromData",
    value: function getVersionFromData(d, lang) {
      //d - data received from this.getData()
      //language - the language of the version
      //console.log(d);
      var currentVersionTitle = lang === "he" ? d.heVersionTitle : d.versionTitle;
      return ConnectionsPanel_objectSpread(ConnectionsPanel_objectSpread({}, d.versions.find(function (v) {
        return v.versionTitle === currentVersionTitle && v.language === lang;
      })), {}, {
        title: d.indexTitle,
        heTitle: d.heIndexTitle,
        sources: lang === "he" ? d.heSources : d.sources,
        merged: lang === "he" ? !!d.heSources : !!d.sources
      });
    }
  }, {
    key: "getCurrentVersions",
    value: function getCurrentVersions() {
      var _this4 = this;
      var data = this.getData(function (data) {
        var currentLanguage = _this4.props.masterPanelLanguage;
        if (currentLanguage === "bilingual") {
          currentLanguage = "hebrew";
        }
        if (!data || data.error) {
          _this4.setState({
            currObjectVersions: {
              en: null,
              he: null
            },
            mainVersionLanguage: currentLanguage
          });
          return;
        }
        if (currentLanguage === "hebrew" && !data.he.length) {
          currentLanguage = "english";
        }
        if (currentLanguage === "english" && !data.text.length) {
          currentLanguage = "hebrew";
        }
        _this4.setState({
          currObjectVersions: {
            en: _this4.props.masterPanelLanguage !== "hebrew" && !!data.text.length || _this4.props.masterPanelLanguage === "hebrew" && !data.he.length ? _this4.getVersionFromData(data, "en") : null,
            he: _this4.props.masterPanelLanguage !== "english" && !!data.he.length || _this4.props.masterPanelLanguage === "english" && !data.text.length ? _this4.getVersionFromData(data, "he") : null
          },
          mainVersionLanguage: currentLanguage,
          sectionRef: data.sectionRef
        });
      });
    }
  }, {
    key: "checkSrefs",
    value: function checkSrefs(srefs) {
      // Mostly exists for properly displaying Ranging refs in TextList on page loads and on sheets
      if (ConnectionsPanel_typeof(srefs) == "object" && srefs.length === 1) {
        srefs = sefaria.splitRangingRef(srefs[0]);
      }
      if (srefs.length === 1 && sefaria.sectionRef(srefs[0]) === srefs[0]) {
        var oref = sefaria.ref(srefs[0]);
        srefs = sefaria.makeSegments(oref).map(function (segment) {
          return segment.ref;
        });
      }
      return srefs;
    }
  }, {
    key: "showSheetNodeConnectionTools",
    value: function showSheetNodeConnectionTools(ref, mode) {
      var dontShowModes = ["Share", "Feedback", "Sheets"];
      if (ref.indexOf("Sheet") !== -1 && !dontShowModes.includes(mode)) {
        return true;
      } else {
        return false;
      }
    }
  }, {
    key: "openVersionInSidebar",
    value: function openVersionInSidebar(versionTitle, versionLanguage) {
      this.props.setConnectionsMode("Translation Open");
      this.props.setFilter(sefaria.getTranslateVersionsKey(versionTitle, versionLanguage));
    }
  }, {
    key: "render",
    value: function render() {
      var _this5 = this,
        _this$props$connectio;
      var content = null;
      if (!this.state.linksLoaded) {
        content = /*#__PURE__*/external_react_default().createElement(LoadingMessage, null);
      } else if (this.showSheetNodeConnectionTools(this.props.srefs, this.props.mode)) {
        content = /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(SheetNodeConnectionTools, {
          multiPanel: this.props.multiPanel,
          setConnectionsMode: this.props.setConnectionsMode,
          openComparePanel: this.props.openComparePanel,
          srefs: this.props.srefs,
          nodeRef: this.props.nodeRef
        }));
      } else if (this.props.mode === "Resources") {
        var summary = sefaria.linkSummary(this.props.srefs, this.props.nodeRef ? this.props.nodeRef.split(".")[0] : null);
        var showConnectionSummary = summary.length > 0 || sefaria.hasEssayLinks(this.props.srefs);
        var resourcesButtonCounts = {
          sheets: sefaria.sheets.sheetsTotalCount(this.props.srefs),
          webpages: sefaria.webPagesByRef(this.props.srefs).length,
          audio: sefaria.mediaByRef(this.props.srefs).length,
          topics: sefaria.topicsByRefCount(this.props.srefs) || 0,
          manuscripts: sefaria.manuscriptsByRef(this.props.srefs).length,
          translations: this.state.availableTranslations.length //versions dont come from the related api, so this one looks a bit different than the others.
        };

        var showResourceButtons = sefaria.is_moderator || Object.values(resourcesButtonCounts).some(function (elem) {
          return elem > 0;
        });
        var toolsButtonsCounts = {
          notes: sefaria.notesTotalCount(this.props.srefs)
        };
        content = /*#__PURE__*/external_react_default().createElement("div", null, this.state.flashMessage ? /*#__PURE__*/external_react_default().createElement("div", {
          className: "flashMessage sans-serif"
        }, this.state.flashMessage) : null, this.props.masterPanelMode === "Sheet" ? /*#__PURE__*/external_react_default().createElement(AboutSheetButtons, {
          setConnectionsMode: this.props.setConnectionsMode,
          masterPanelSheetId: this.props.masterPanelSheetId
        }) : /*#__PURE__*/external_react_default().createElement("div", {
          className: "topToolsButtons"
        }, /*#__PURE__*/external_react_default().createElement(ToolsButton, {
          en: "About this Text",
          he: "\u05D0\u05D5\u05D3\u05D5\u05EA \u05D4\u05D8\u05E7\u05E1\u05D8",
          image: "about-text.svg",
          urlConnectionsMode: "About",
          onClick: function onClick() {
            return _this5.props.setConnectionsMode("About");
          }
        }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
          en: "Table of Contents",
          he: "\u05EA\u05D5\u05DB\u05DF \u05D4\u05E2\u05E0\u05D9\u05D9\u05E0\u05D9\u05DD",
          image: "text-navigation.svg",
          urlConnectionsMode: "Navigation",
          onClick: function onClick() {
            return _this5.props.setConnectionsMode("Navigation");
          }
        }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
          en: "Search in this Text",
          he: "\u05D7\u05E4\u05E9 \u05D1\u05D8\u05E7\u05E1\u05D8",
          image: "compare.svg",
          urlConnectionsMode: "SidebarSearch",
          onClick: function onClick() {
            return _this5.props.setConnectionsMode("SidebarSearch");
          }
        }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
          en: "Translations",
          he: "\u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD",
          image: "translation.svg",
          urlConnectionsMode: "Translations",
          onClick: function onClick() {
            return _this5.props.setConnectionsMode("Translations");
          },
          count: resourcesButtonCounts.translations
        })), showConnectionSummary ? /*#__PURE__*/external_react_default().createElement(ConnectionsPanelSection, {
          title: "Related Texts"
        }, /*#__PURE__*/external_react_default().createElement(ConnectionsSummary, {
          currObjectVersions: this.state.currObjectVersions,
          srefs: this.props.srefs,
          showBooks: false,
          multiPanel: this.props.multiPanel,
          filter: this.props.filter,
          nodeRef: this.props.nodeRef,
          contentLang: this.props.contentLang,
          setFilter: this.props.setFilter,
          setConnectionsMode: this.props.setConnectionsMode,
          setConnectionsCategory: this.props.setConnectionsCategory,
          collapsed: this.state.connectionSummaryCollapsed,
          toggleTopLevelCollapsed: this.toggleTopLevelCollapsed
        })) : null, showResourceButtons ? /*#__PURE__*/external_react_default().createElement(ConnectionsPanelSection, {
          title: "Resources"
        },
        //ironically we need the masterpanel mode to be sheet to indicate a sheet is loaded, but the
        // title prop to be something other than "Sheet" to indicate that a real source is being
        // looked at
        this.props.masterPanelMode == "Sheet" && this.props.title !== "Sheet" ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement(ToolsButton, {
          en: "About this Source",
          he: "\u05D0\u05D5\u05D3\u05D5\u05EA \u05DE\u05E7\u05D5\u05E8 \u05D6\u05D4",
          image: "about-text.svg",
          urlConnectionsMode: "About",
          onClick: function onClick() {
            return _this5.props.setConnectionsMode("About");
          }
        }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
          en: "Translations",
          he: "\u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD",
          image: "translation.svg",
          count: resourcesButtonCounts["translations"],
          urlConnectionsMode: "Translations",
          onClick: function onClick() {
            return _this5.props.setConnectionsMode("Translations");
          }
        })) : null, /*#__PURE__*/external_react_default().createElement(ResourcesList, {
          setConnectionsMode: this.props.setConnectionsMode,
          counts: resourcesButtonCounts
        })) : null, /*#__PURE__*/external_react_default().createElement(ConnectionsPanelSection, {
          title: "Tools"
        }, this.props.masterPanelMode === "Sheet" ? /*#__PURE__*/external_react_default().createElement(SheetToolsList, {
          toggleSignUpModal: this.props.toggleSignUpModal,
          setConnectionsMode: this.props.setConnectionsMode,
          masterPanelSheetId: this.props.masterPanelSheetId
        }) : null, /*#__PURE__*/external_react_default().createElement(ToolsList, {
          setConnectionsMode: this.props.setConnectionsMode,
          masterPanelMode: this.props.masterPanelMode,
          toggleSignUpModal: this.props.toggleSignUpModal,
          openComparePanel: this.props.multiPanel ? this.props.openComparePanel : null,
          counts: toolsButtonsCounts
        })));
      } else if (this.props.mode == "Navigation") {
        content = /*#__PURE__*/external_react_default().createElement(TextTableOfContents, {
          narrowPanel: this.props.narrowPanel,
          title: this.props.title,
          close: this.props.close,
          currVersions: this.props.currVersions,
          navigatePanel: this.props.navigatePanel,
          currentlyVisibleRef: this.props.currentlyVisibleRef,
          currentlyVisibleSectionRef: this.state.currentlyVisibleSectionRef
        });
      } else if (this.props.mode === "ConnectionsList") {
        content = /*#__PURE__*/external_react_default().createElement(ConnectionsSummary, {
          srefs: this.props.srefs,
          category: this.props.connectionsCategory,
          showBooks: true,
          multiPanel: this.props.multiPanel,
          nodeRef: this.props.nodeRef,
          contentLang: this.props.contentLang,
          filter: this.props.filter,
          setFilter: this.props.setFilter,
          setConnectionsMode: this.props.setConnectionsMode,
          setConnectionsCategory: this.props.setConnectionsCategory
        });
      } else if (this.props.mode === "TextList" || this.props.mode === "EssayList") {
        content = /*#__PURE__*/external_react_default().createElement(TextList, {
          panelPosition: this.props.panelPosition,
          srefs: this.checkSrefs(this.props.srefs),
          filter: this.props.filter,
          recentFilters: this.props.recentFilters,
          nodeRef: this.props.nodeRef,
          fullPanel: this.props.fullPanel,
          multiPanel: this.props.multiPanel,
          contentLang: this.props.contentLang,
          setFilter: this.props.setFilter,
          setConnectionsMode: this.props.setConnectionsMode,
          onTextClick: this.props.onTextClick,
          onCitationClick: this.props.onCitationClick,
          handleSheetClick: this.props.handleSheetClick,
          openNav: this.props.openNav,
          openDisplaySettings: this.props.openDisplaySettings,
          closePanel: this.props.closePanel,
          selectedWords: this.props.selectedWords,
          checkVisibleSegments: this.checkVisibleSegments,
          translationLanguagePreference: this.props.translationLanguagePreference
        });
      } else if (this.props.mode === "Sheets") {
        var connectedSheet = this.props.nodeRef ? this.props.nodeRef.split(".")[0] : null;
        content = /*#__PURE__*/external_react_default().createElement("div", null, this.props.srefs[0].indexOf("Sheet") === -1 ? /*#__PURE__*/external_react_default().createElement(MySheetsList, {
          srefs: this.props.srefs,
          connectedSheet: connectedSheet,
          fullPanel: this.props.fullPanel,
          handleSheetClick: this.props.handleSheetClick
        }) : null, this.props.srefs[0].indexOf("Sheet") === -1 ? /*#__PURE__*/external_react_default().createElement(PublicSheetsList, {
          srefs: this.props.srefs,
          connectedSheet: connectedSheet,
          fullPanel: this.props.fullPanel,
          handleSheetClick: this.props.handleSheetClick
        }) : null);
      } else if (this.props.mode == "Add To Sheet") {
        var refForSheet, versionsForSheet, selectedWordsForSheet, nodeRef;
        // add source from connections
        if (this.props.connectionData && this.props.connectionData.hasOwnProperty("addSource") && this.props.connectionData["addSource"] == 'connectionsPanel') {
          refForSheet = this.props.connectionData.hasOwnProperty("connectionRefs") ? this.props.connectionData["connectionRefs"] : this.props.srefs;
          versionsForSheet = this.props.connectionData.hasOwnProperty("versions") ? this.props.connectionData["versions"] : {
            "en": null,
            "he": null
          };
          selectedWordsForSheet = null;
        } else {
          // add source from sheet itself
          refForSheet = this.props.srefs;
          versionsForSheet = this.props.currVersions;
          selectedWordsForSheet = this.props.selectedWords;
          nodeRef = this.props.nodeRef;
        }
        content = /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(AddToSourceSheetBox, {
          srefs: refForSheet,
          currVersions: versionsForSheet //sidebar doesn't actually do versions
          ,
          contentLanguage: this.props.masterPanelLanguage,
          selectedWords: selectedWordsForSheet,
          nodeRef: nodeRef,
          fullPanel: this.props.fullPanel,
          toggleSignUpModal: this.props.toggleSignUpModal,
          setConnectionsMode: this.props.setConnectionsMode
        }));
      } else if (this.props.mode === "Notes") {
        content = /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(AddNoteBox, {
          srefs: this.props.srefs,
          fullPanel: this.props.fullPanel,
          closePanel: this.props.closePanel,
          onSave: function onSave() {
            return _this5.props.setConnectionsMode("Notes");
          },
          onCancel: function onCancel() {
            return _this5.props.setConnectionsMode("Notes");
          }
        }), sefaria._uid ? /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
          href: "/my/profile?tab=notes",
          className: "allNotesLink button white transparent bordered fillWidth"
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "int-en"
        }, "Go to My Notes"), /*#__PURE__*/external_react_default().createElement("span", {
          className: "int-he"
        }, "\u05D4\u05E8\u05E9\u05D5\u05DE\u05D5\u05EA \u05E9\u05DC\u05D9")), /*#__PURE__*/external_react_default().createElement(MyNotes, {
          srefs: this.props.srefs,
          editNote: this.props.editNote
        })) : null);
      } else if (this.props.mode === "Lexicon") {
        content = /*#__PURE__*/external_react_default().createElement(js_LexiconBox, {
          selectedWords: this.props.selectedWords,
          selectedNamedEntity: this.props.selectedNamedEntity,
          selectedNamedEntityText: this.props.selectedNamedEntityText,
          oref: sefaria.ref(this.props.srefs[0]),
          srefs: this.props.srefs,
          onEntryClick: this.props.onTextClick,
          onCitationClick: this.props.onCitationClick,
          clearSelectedWords: this.props.clearSelectedWords,
          clearNamedEntity: this.props.clearNamedEntity,
          interfaceLang: this.props.interfaceLang
        });
      } else if (this.props.mode === "Topics") {
        content = /*#__PURE__*/external_react_default().createElement(TopicList, {
          masterPanelMode: this.props.masterPanelMode,
          contentLang: this.props.contentLang,
          srefs: this.props.srefs,
          interfaceLang: this.props.interfaceLang,
          key: "Topics-".concat(this.props.srefs.join("|"))
        });
      } else if (this.props.mode === "WebPages" || this.props.mode === "WebPagesList") {
        content = /*#__PURE__*/external_react_default().createElement(WebPagesList, {
          srefs: this.props.srefs,
          filter: this.props.mode == "WebPages" ? null : this.props.webPagesFilter,
          setWebPagesFilter: this.props.setWebPagesFilter,
          interfaceLang: this.props.interfaceLang,
          key: "WebPages"
        });
      } else if (this.props.mode === "Torah Readings") {
        content = /*#__PURE__*/external_react_default().createElement(MediaList, {
          srefs: this.props.srefs,
          interfaceLang: this.props.interfaceLang,
          key: "Media"
        });
      } else if (this.props.mode === "Advanced Tools") {
        content = /*#__PURE__*/external_react_default().createElement(AdvancedToolsList, {
          srefs: this.props.srefs,
          toggleSignUpModal: this.props.toggleSignUpModal,
          canEditText: this.props.canEditText,
          setConnectionsMode: this.props.setConnectionsMode,
          currVersions: this.props.currVersions,
          masterPanelLanguage: this.props.masterPanelLanguage
        });
      } else if (this.props.mode === "Share") {
        content = /*#__PURE__*/external_react_default().createElement(ShareBox, {
          masterPanelSheetId: this.props.masterPanelSheetId,
          url: window.location.href,
          fullPanel: this.props.fullPanel,
          closePanel: this.props.closePanel,
          setConnectionsMode: this.props.setConnectionsMode
        });
      } else if (this.props.mode === "Feedback") {
        content = /*#__PURE__*/external_react_default().createElement(FeedbackBox, {
          srefs: this.props.srefs,
          url: window.location.href,
          currVersions: this.props.currVersions
        });
      } else if (this.props.mode === "Edit Note") {
        content = /*#__PURE__*/external_react_default().createElement(AddNoteBox, {
          srefs: this.props.srefs,
          noteId: this.props.noteBeingEdited._id,
          noteText: this.props.noteBeingEdited.text,
          noteTitle: this.props.noteBeingEdited.title,
          noteIsPublic: this.props.noteBeingEdited.isPublic,
          fullPanel: this.props.fullPanel,
          closePanel: this.props.closePanel,
          onSave: function onSave() {
            return _this5.props.setConnectionsMode("Notes");
          },
          onCancel: function onCancel() {
            return _this5.props.setConnectionsMode("Notes");
          },
          onDelete: function onDelete() {
            return _this5.props.setConnectionsMode("Notes");
          }
        });
      } else if (this.props.mode === "Add Connection") {
        content = /*#__PURE__*/external_react_default().createElement(AddConnectionBox, {
          srefs: this.props.allOpenRefs,
          openComparePanel: this.props.openComparePanel,
          onSave: this.onSave,
          onCancel: function onCancel() {
            return _this5.props.setConnectionsMode("Resources");
          }
        });
      } else if (this.props.mode === "Login") {
        content = /*#__PURE__*/external_react_default().createElement(LoginPrompt, {
          fullPanel: this.props.fullPanel
        });
      } else if (this.props.mode === "About") {
        content = /*#__PURE__*/external_react_default().createElement(js_AboutBox, {
          currObjectVersions: this.state.currObjectVersions,
          masterPanelLanguage: this.props.masterPanelLanguage,
          setConnectionsMode: this.props.setConnectionsMode,
          mode: this.props.mode,
          setFilter: this.props.setVersionFilter,
          title: this.props.title,
          srefs: this.props.srefs,
          sectionRef: this.state.sectionRef,
          openVersionInReader: this.props.selectVersion,
          viewExtendedNotes: this.props.viewExtendedNotes
        });
      } else if (this.props.mode === "Translations" || this.props.mode === "Translation Open") {
        content = /*#__PURE__*/external_react_default().createElement(TranslationsBox, {
          key: "Translations",
          currObjectVersions: this.state.currObjectVersions,
          setConnectionsMode: this.props.setConnectionsMode,
          mode: this.props.mode,
          setFilter: this.props.setVersionFilter,
          vFilter: this.props.versionFilter,
          recentVFilters: this.props.recentVersionFilters,
          srefs: this.props.srefs,
          sectionRef: this.state.sectionRef,
          onRangeClick: this.props.onTextClick,
          openVersionInReader: this.props.selectVersion,
          viewExtendedNotes: this.props.viewExtendedNotes,
          onCitationClick: this.props.onCitationClick,
          translationLanguagePreference: this.props.translationLanguagePreference
        });
      } else if (this.props.mode === "extended notes") {
        content = /*#__PURE__*/external_react_default().createElement(js_ExtendedNotes, {
          currVersions: this.props.currVersions,
          title: this.props.title
        });
      } else if (this.props.mode === "manuscripts") {
        content = /*#__PURE__*/external_react_default().createElement(ManuscriptImageList, {
          manuscriptList: sefaria.manuscriptsByRef(this.props.srefs),
          interfaceLang: this.props.interfaceLang,
          contentLang: this.props.contentLang
        });
      } else if (this.props.mode === "AboutSheet") {
        content = /*#__PURE__*/external_react_default().createElement(js_AboutSheet, {
          masterPanelSheetId: this.props.masterPanelSheetId,
          toggleSignUpModal: this.props.toggleSignUpModal
        });
      } else if (this.props.mode === "DivineName") {
        content = /*#__PURE__*/external_react_default().createElement(DivineNameReplacer, {
          setDivineNameReplacement: this.props.setDivineNameReplacement,
          divineNameReplacement: this.props.divineNameReplacement
        });
      } else if (this.props.mode === "SidebarSearch") {
        content = /*#__PURE__*/external_react_default().createElement(js_SidebarSearch, {
          title: this.props.title,
          navigatePanel: this.props.navigatePanel,
          sidebarSearchQuery: this.props.sidebarSearchQuery,
          setSidebarSearchQuery: this.props.setSidebarSearchQuery,
          onSidebarSearchClick: this.props.onSidebarSearchClick
        });
      }
      var marginless = ["Resources", "ConnectionsList", "Advanced Tools", "Share", "WebPages", "Topics", "manuscripts"].indexOf(this.props.mode) != -1;
      var classes = external_classnames_default()({
        connectionsPanel: 1,
        textList: 1,
        marginless: marginless,
        fullPanel: this.props.fullPanel,
        singlePanel: !this.props.fullPanel
      });
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes,
        key: this.props.mode
      }, this.props.fullPanel ? null : /*#__PURE__*/external_react_default().createElement(js_ConnectionsPanelHeader, {
        connectionsMode: this.props.mode,
        previousCategory: this.props.connectionsCategory,
        previousMode: (_this$props$connectio = this.props.connectionData) === null || _this$props$connectio === void 0 ? void 0 : _this$props$connectio.previousMode,
        setConnectionsMode: this.props.setConnectionsMode,
        setConnectionsCategory: this.props.setConnectionsCategory,
        multiPanel: this.props.multiPanel,
        filter: this.props.filter,
        recentFilters: this.props.recentFilters,
        baseRefs: this.props.srefs,
        setFilter: this.props.setFilter,
        closePanel: this.props.closePanel,
        toggleLanguage: this.props.toggleLanguage,
        interfaceLang: this.props.interfaceLang
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "texts content"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "contentInner"
      }, content)));
    }
  }]);
  return ConnectionsPanel;
}((external_react_class_default()));
ConnectionsPanel.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  // an array of ref strings
  filter: (external_prop_types_default()).array.isRequired,
  recentFilters: (external_prop_types_default()).array.isRequired,
  mode: (external_prop_types_default()).string.isRequired,
  // "Resources", "ConnectionsList", "TextList" etc., called `connectionsMode` above
  connectionsCategory: (external_prop_types_default()).string,
  // with mode:"ConnectionsList", which category of connections to show
  setFilter: (external_prop_types_default()).func.isRequired,
  setConnectionsMode: (external_prop_types_default()).func.isRequired,
  setConnectionsCategory: (external_prop_types_default()).func.isRequired,
  editNote: (external_prop_types_default()).func.isRequired,
  openComparePanel: (external_prop_types_default()).func.isRequired,
  title: (external_prop_types_default()).string.isRequired,
  currVersions: (external_prop_types_default()).object.isRequired,
  selectVersion: (external_prop_types_default()).func.isRequired,
  noteBeingEdited: (external_prop_types_default()).object,
  fullPanel: (external_prop_types_default()).bool,
  multiPanel: (external_prop_types_default()).bool,
  canEditText: (external_prop_types_default()).bool,
  onTextClick: (external_prop_types_default()).func,
  onCitationClick: (external_prop_types_default()).func,
  openNav: (external_prop_types_default()).func,
  openDisplaySettings: (external_prop_types_default()).func,
  closePanel: (external_prop_types_default()).func,
  toggleLanguage: (external_prop_types_default()).func,
  selectedWords: (external_prop_types_default()).string,
  selectedNamedEntity: (external_prop_types_default()).string,
  selectedNamedEntityText: (external_prop_types_default()).string,
  interfaceLang: (external_prop_types_default()).string,
  contentLang: (external_prop_types_default()).string,
  masterPanelLanguage: external_prop_types_default().oneOf(["english", "bilingual", "hebrew"]),
  masterPanelMode: (external_prop_types_default()).string,
  masterPanelSheetId: (external_prop_types_default()).number,
  versionFilter: (external_prop_types_default()).array,
  recentVersionFilters: (external_prop_types_default()).array,
  setVersionFilter: (external_prop_types_default()).func.isRequired,
  checkIntentTimer: (external_prop_types_default()).func.isRequired,
  clearSelectedWords: (external_prop_types_default()).func.isRequired,
  clearNamedEntity: (external_prop_types_default()).func.isRequired,
  translationLanguagePreference: (external_prop_types_default()).string,
  scrollPosition: (external_prop_types_default()).number,
  setSideScrollPosition: (external_prop_types_default()).func.isRequired
};
var ResourcesList = function ResourcesList(_ref) {
  var masterPanelMode = _ref.masterPanelMode,
    setConnectionsMode = _ref.setConnectionsMode,
    counts = _ref.counts;
  // A list of Resources in addition to connection
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "toolButtonsList"
  }, /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Sheets",
    he: "\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA",
    image: "sheet.svg",
    count: counts["sheets"],
    urlConnectionsMode: "Sheets",
    onClick: function onClick() {
      return setConnectionsMode("Sheets");
    }
  }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Web Pages",
    he: "\u05D3\u05E4\u05D9 \u05D0\u05D9\u05E0\u05D8\u05E8\u05E0\u05D8",
    image: "webpages.svg",
    count: counts["webpages"],
    urlConnectionsMode: "WebPages",
    onClick: function onClick() {
      return setConnectionsMode("WebPages");
    }
  }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Topics",
    he: "\u05E0\u05D5\u05E9\u05D0\u05D9\u05DD",
    image: "hashtag-icon.svg",
    count: counts["topics"],
    urlConnectionsMode: "Topics",
    onClick: function onClick() {
      return setConnectionsMode("Topics");
    },
    alwaysShow: sefaria.is_moderator
  }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Manuscripts",
    he: "\u05DB\u05EA\u05D1\u05D9 \u05D9\u05D3",
    image: "manuscripts.svg",
    count: counts["manuscripts"],
    urlConnectionsMode: "manuscripts",
    onClick: function onClick() {
      return setConnectionsMode("manuscripts");
    }
  }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Torah Readings",
    he: "\u05E7\u05E8\u05D9\u05D0\u05D4 \u05D1\u05EA\u05D5\u05E8\u05D4",
    image: "torahreadings.svg",
    count: counts["audio"],
    urlConnectionsMode: "Torah Readings",
    onClick: function onClick() {
      return setConnectionsMode("Torah Readings");
    }
  }));
};
ResourcesList.propTypes = {
  setConnectionsMode: (external_prop_types_default()).func.isRequired,
  counts: (external_prop_types_default()).object.isRequired
};
var ToolsList = function ToolsList(_ref2) {
  var setConnectionsMode = _ref2.setConnectionsMode,
    toggleSignUpModal = _ref2.toggleSignUpModal,
    openComparePanel = _ref2.openComparePanel,
    counts = _ref2.counts,
    masterPanelMode = _ref2.masterPanelMode;
  // A list of Resources in addition to connection
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "toolButtonsList"
  }, /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Add to Sheet",
    he: "\u05D4\u05D5\u05E1\u05E4\u05D4 \u05DC\u05D3\u05E3 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA",
    image: "sheetsplus.svg",
    onClick: function onClick() {
      return !sefaria._uid ? toggleSignUpModal(SignUpModalKind.AddToSheet) : setConnectionsMode("Add To Sheet", {
        "addSource": "mainPanel"
      });
    }
  }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Dictionaries",
    he: "\u05DE\u05D9\u05DC\u05D5\u05E0\u05D9\u05DD",
    image: "dictionaries.svg",
    urlConnectionsMode: "Lexicon",
    onClick: function onClick() {
      return setConnectionsMode("Lexicon");
    }
  }), openComparePanel ? /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Compare Text",
    he: "\u05D8\u05E7\u05E1\u05D8 \u05DC\u05D4\u05E9\u05D5\u05D5\u05D0\u05D4",
    image: "compare-panel.svg",
    onClick: openComparePanel
  }) : null, /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Notes",
    he: "\u05D4\u05E2\u05E8\u05D5\u05EA",
    image: "notes.svg",
    alwaysShow: true,
    count: counts["notes"],
    urlConnectionsMode: "Notes",
    onClick: function onClick() {
      return !sefaria._uid ? toggleSignUpModal(SignUpModalKind.Notes) : setConnectionsMode("Notes");
    }
  }), masterPanelMode !== "Sheet" ? /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Share",
    he: "\u05E9\u05D9\u05EA\u05D5\u05E3",
    image: "share.svg",
    onClick: function onClick() {
      return setConnectionsMode("Share");
    }
  }) : null, /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Feedback",
    he: "\u05DE\u05E9\u05D5\u05D1",
    image: "feedback.svg",
    onClick: function onClick() {
      return setConnectionsMode("Feedback");
    }
  }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Advanced",
    he: "\u05DB\u05DC\u05D9\u05DD \u05DE\u05EA\u05E7\u05D3\u05DE\u05D9\u05DD",
    image: "advancedtools.svg",
    onClick: function onClick() {
      return setConnectionsMode("Advanced Tools");
    }
  }));
};
ToolsList.propTypes = {
  setConnectionsMode: (external_prop_types_default()).func.isRequired,
  toggleSignUpModal: (external_prop_types_default()).func.isRequired,
  counts: (external_prop_types_default()).object.isRequired
};
var AboutSheetButtons = function AboutSheetButtons(_ref3) {
  var setConnectionsMode = _ref3.setConnectionsMode,
    masterPanelSheetId = _ref3.masterPanelSheetId;
  var _useState = (0,external_react_.useState)(false),
    _useState2 = ConnectionsPanel_slicedToArray(_useState, 2),
    isOwner = _useState2[0],
    setIsOwner = _useState2[1];
  var _useState3 = (0,external_react_.useState)(false),
    _useState4 = ConnectionsPanel_slicedToArray(_useState3, 2),
    showEditButton = _useState4[0],
    setShowEditButton = _useState4[1];
  (0,external_react_.useEffect)(function () {
    var sheet = sefaria.sheets.loadSheetByID(masterPanelSheetId);
    setIsOwner(sheet.owner === sefaria._uid);
    setShowEditButton(!sefaria._uses_new_editor && sefaria._uid && (sheet.owner === sefaria._uid || sheet.options.collaboration == "anyone-can-edit" || sheet.options.collaboration == "anyone-can-add"));
    console.log(sheet);
  }, []);
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "topToolsButtons"
  }, isOwner ? /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Publish Settings",
    he: "\u05D4\u05D2\u05D3\u05E8\u05D5\u05EA \u05E4\u05E8\u05E1\u05D5\u05DD",
    image: "about-text.svg",
    urlConnectionsMode: "AboutSheet",
    onClick: function onClick() {
      return setConnectionsMode("AboutSheet");
    }
  }) : /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "About this Sheet",
    he: "\u05D0\u05D5\u05D3\u05D5\u05EA \u05D3\u05E3 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA",
    image: "about-text.svg",
    urlConnectionsMode: "AboutSheet",
    onClick: function onClick() {
      return setConnectionsMode("AboutSheet");
    }
  }), showEditButton ? /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Edit",
    he: "\u05E2\u05E8\u05D9\u05DB\u05D4",
    image: "note.svg",
    onClick: function onClick() {
      window.location = "//".concat(window.location.host, "/sheets/").concat(masterPanelSheetId, "?editor=1");
    }
  }) : null, /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Share",
    he: "\u05E9\u05D9\u05EA\u05D5\u05E3",
    image: "share.svg",
    onClick: function onClick() {
      return setConnectionsMode("Share");
    }
  }));
};
var SheetToolsList = function SheetToolsList(_ref4) {
  var toggleSignUpModal = _ref4.toggleSignUpModal,
    masterPanelSheetId = _ref4.masterPanelSheetId,
    setConnectionsMode = _ref4.setConnectionsMode;
  // const [isOwner, setIsOwner] = useState(false);
  // const [isPublished, setIsPublished] = useState(false);
  var googleDriveState = {
    "export": {
      en: "Export to Google Docs",
      he: "ייצוא לגוגל דוקס"
    },
    exporting: {
      en: "Exporting to Google Docs...",
      he: "מייצא לגוגל דוקס...",
      greyColor: true
    },
    exportComplete: {
      en: "Export Complete",
      he: "ייצוא הסתיים",
      secondaryEn: "Open in Google",
      secondaryHe: "לפתיחה בגוגל דוקס",
      greyColor: true
    }
  };
  var copyState = {
    copy: {
      en: "Copy",
      he: "העתקה"
    },
    copying: {
      en: "Copying...",
      he: "מעתיק...",
      greyColor: true
    },
    copied: {
      en: "Sheet Copied",
      he: "הדף מועתק",
      secondaryHe: "צפייה בדף המקורות",
      secondaryEn: "View Copy",
      greyColor: true
    },
    error: {
      en: "Sorry, there was an error.",
      he: "סליחה, ארעה שגיאה"
    }
  };
  var _useState5 = (0,external_react_.useState)(copyState.copy),
    _useState6 = ConnectionsPanel_slicedToArray(_useState5, 2),
    copyText = _useState6[0],
    setCopyText = _useState6[1];
  var urlHashObject = sefaria.util.parseHash(sefaria.util.parseUrl(window.location).hash).afterLoading;
  var _ref5 = urlHashObject === "exportToDrive" ? (0,external_react_.useState)(googleDriveState.exporting) : (0,external_react_.useState)(googleDriveState["export"]),
    _ref6 = ConnectionsPanel_slicedToArray(_ref5, 2),
    googleDriveText = _ref6[0],
    setGoogleDriveText = _ref6[1];
  var _useState7 = (0,external_react_.useState)(""),
    _useState8 = ConnectionsPanel_slicedToArray(_useState7, 2),
    googleDriveLink = _useState8[0],
    setGoogleDriveLink = _useState8[1];
  var _useState9 = (0,external_react_.useState)(0),
    _useState10 = ConnectionsPanel_slicedToArray(_useState9, 2),
    copiedSheetId = _useState10[0],
    setCopiedSheetId = _useState10[1];
  var sheet = sefaria.sheets.loadSheetByID(masterPanelSheetId);
  var _useState11 = (0,external_react_.useState)(false),
    _useState12 = ConnectionsPanel_slicedToArray(_useState11, 2),
    showCollectionsModal = _useState12[0],
    setShowCollectionsModal = _useState12[1];
  (0,external_react_.useEffect)(function () {
    if (googleDriveText.en == googleDriveState.exporting.en) {
      history.replaceState("", document.title, window.location.pathname + window.location.search); // remove exportToDrive hash once it's used to trigger export
      sefariaJquery.ajax({
        type: "POST",
        url: "/api/sheets/" + sheet.id + "/export_to_drive",
        success: function success(data) {
          if ("error" in data) {
            console.log(data.error.message);
            // Export Failed
          } else {
            // Export succeeded
            setGoogleDriveLink(data.webViewLink);
            setGoogleDriveText(googleDriveState.exportComplete);
          }
        },
        statusCode: {
          401: function _() {
            window.location.href = "/gauth?next=" + encodeURIComponent(window.location.protocol + '//' + window.location.host + window.location.pathname + window.location.search + "#afterLoading=exportToDrive");
          }
        }
      });
    }
  }, [googleDriveText]);

  // const toggleCollectionsModal = () => {
  //   if (!Sefaria._uid) {
  //     toggleSignUpModal();
  //   } else {
  //     setShowCollectionsModal(!showCollectionsModal)
  //   }
  // }

  var filterAndSaveCopiedSheetData = function filterAndSaveCopiedSheetData(data) {
    var newSheet = sefaria.util.clone(data);
    newSheet.status = "unlisted";
    newSheet.title = newSheet.title + " (Copy)";
    if (sefaria._uid != newSheet.owner) {
      newSheet.via = newSheet.id;
      newSheet.viaOwner = newSheet.owner;
      newSheet.owner = sefaria._uid;
    }
    delete newSheet.id;
    delete newSheet.ownerName;
    delete newSheet.views;
    delete newSheet.dateCreated;
    delete newSheet.dateModified;
    delete newSheet.displayedCollection;
    delete newSheet.collectionName;
    delete newSheet.collectionImage;
    delete newSheet.likes;
    delete newSheet.promptedToPublish;
    delete newSheet._id;
    var postJSON = JSON.stringify(newSheet);
    sefariaJquery.post("/api/sheets/", {
      "json": postJSON
    }, function (data) {
      if (data.id) {
        setCopiedSheetId(data.id);
        setCopyText(copyState.copied);
      } else if ("error" in data) {
        setCopyText(copyState.error);
        console.log(data.error);
      }
    });
  };
  var copySheet = function copySheet() {
    if (!sefaria._uid) {
      toggleSignUpModal(SignUpModalKind.AddToSheet);
    } else if (copyText.en === copyState.copy.en) {
      setCopyText(copyState.copying);
      filterAndSaveCopiedSheetData(sheet);
    } else if (copyText.en === copyState.copied.en) {
      window.location.href = "/sheets/".concat(copiedSheetId);
      // TODO: open copied sheet
    }
  };

  var googleDriveExport = function googleDriveExport() {
    // $("#overlay").show();
    // sjs.alert.message('<span class="int-en">Syncing with Google Docs...</span><span class="int-he">מייצא לגוגל דרייב...</span>');
    if (!sefaria._uid) {
      toggleSignUpModal();
    } else if (googleDriveText.en === googleDriveState.exportComplete.en) {
      sefaria.util.openInNewTab(googleDriveLink);
    } else {
      sefaria.track.sheets("Export to Google Docs");
      setGoogleDriveText(googleDriveState.exporting);
    }
  };
  return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: copyText.en,
    he: copyText.he,
    secondaryEn: copyText.secondaryEn,
    secondaryHe: copyText.secondaryHe,
    image: "copy.png",
    greyColor: !!copyText.secondaryEn || copyText.greyColor,
    onClick: function onClick() {
      return copySheet();
    }
  }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Print",
    he: "\u05D4\u05D3\u05E4\u05E1\u05D4",
    image: "print.svg",
    onClick: function onClick() {
      return window.print();
    }
  }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: googleDriveText.en,
    he: googleDriveText.he,
    greyColor: !!googleDriveText.secondaryEn || googleDriveText.greyColor,
    secondaryEn: googleDriveText.secondaryEn,
    secondaryHe: googleDriveText.secondaryHe,
    image: "googledrive.svg",
    onClick: function onClick() {
      return googleDriveExport();
    }
  }), sefaria._uses_new_editor && sefaria._uid && (sheet.owner === sefaria._uid || sheet.options.collaboration == "anyone-can-edit") ? /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Divine Name",
    he: "\u05E9\u05DE\u05D5\u05EA \u05E7\u05D5\u05D3\u05E9",
    image: "tools-translate.svg",
    onClick: function onClick() {
      return setConnectionsMode("DivineName");
    }
  }) : null);
};
var SheetNodeConnectionTools = /*#__PURE__*/function (_Component2) {
  ConnectionsPanel_inherits(SheetNodeConnectionTools, _Component2);
  var _super2 = ConnectionsPanel_createSuper(SheetNodeConnectionTools);
  function SheetNodeConnectionTools() {
    ConnectionsPanel_classCallCheck(this, SheetNodeConnectionTools);
    return _super2.apply(this, arguments);
  }
  ConnectionsPanel_createClass(SheetNodeConnectionTools, [{
    key: "render",
    value:
    // A list of Resources in addition to connections
    function render() {
      var _this6 = this;
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "toolButtonsList"
      }, this.props.multiPanel ? /*#__PURE__*/external_react_default().createElement(ToolsButton, {
        en: "Other Text",
        he: "\u05D8\u05E7\u05E1\u05D8 \u05E0\u05D5\u05E1\u05E3",
        icon: "search",
        onClick: this.props.openComparePanel
      }) : null, /*#__PURE__*/external_react_default().createElement(ToolsButton, {
        en: "Sheets",
        he: "\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA",
        image: "sheet.svg",
        urlConnectionsMode: "Sheets",
        count: this.props.sheetsCount,
        onClick: function onClick() {
          return _this6.props.setConnectionsMode("Sheets");
        }
      }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
        en: "Feedback",
        he: "\u05DE\u05E9\u05D5\u05D1",
        icon: "comment",
        onClick: function onClick() {
          return _this6.props.setConnectionsMode("Feedback");
        }
      }));
    }
  }]);
  return SheetNodeConnectionTools;
}((external_react_class_default()));
SheetNodeConnectionTools.propTypes = {
  multiPanel: (external_prop_types_default()).bool.isRequired,
  setConnectionsMode: (external_prop_types_default()).func.isRequired,
  openComparePanel: (external_prop_types_default()).func.isRequired
};
var ConnectionsSummary = /*#__PURE__*/function (_Component3) {
  ConnectionsPanel_inherits(ConnectionsSummary, _Component3);
  var _super3 = ConnectionsPanel_createSuper(ConnectionsSummary);
  function ConnectionsSummary() {
    ConnectionsPanel_classCallCheck(this, ConnectionsSummary);
    return _super3.apply(this, arguments);
  }
  ConnectionsPanel_createClass(ConnectionsSummary, [{
    key: "render",
    value:
    // A summary of available connections on `srefs`.
    // If `category` is present, shows a single category, otherwise all categories.
    // If `showBooks`, show specific text counts beneath each category.

    function render() {
      var collapsedTopLevelLimit = 4;
      var refs = this.props.srefs;
      var excludedSheet = this.props.nodeRef ? this.props.nodeRef.split(".")[0] : null;
      var oref = sefaria.ref(refs[0]);
      var isTopLevel = !this.props.category;
      var baseCat = oref ? oref["categories"][0] : null;
      var summary = sefaria.linkSummary(refs, excludedSheet);
      var essaySummary = [];
      if (!summary) {
        return null;
      }
      if (this.props.category === "Commentary") {
        // Show Quoting Commentary together with Commentary
        summary = summary.filter(function (cat) {
          return cat.category.indexOf("Commentary") !== -1;
        });
        var order = ["Commentary", "Quoting Commentary"];
        summary.sort(function (a, b) {
          var ia = order.indexOf(a.category);
          var ib = order.indexOf(b.category);
          return ia - ib;
        });
      } else if (this.props.category) {
        // Single Category Summary
        summary = summary.filter(function (cat) {
          return cat.category === this.props.category;
        }.bind(this));
        if (summary.length === 0) {
          summary = [{
            category: this.props.category,
            books: [],
            count: 0,
            hasEnglish: false
          }];
        }
      } else if (isTopLevel) {
        // Hide Quoting Commentary from the top level view
        var topSummary = summary.filter(function (cat) {
          return cat.category.indexOf("Commentary") < 1;
        });
        // But include Quoting Commentary counts and english mark in top level Commentary section
        var subCommentaryCats = summary.filter(function (cat) {
          return cat.category.indexOf("Commentary") > 1;
        });
        if (subCommentaryCats.length && summary[0].category !== "Commentary") {
          // handle case of having Modern/Quoting Commentary, but no Commentary
          topSummary = [{
            category: "Commentary",
            count: 0,
            books: [],
            hasEnglish: false
          }].concat(topSummary);
        } else if (subCommentaryCats.length && summary[0].category === "Commentary") {
          // If Commentary object is present and we have sub commentary counts to add, replace the object
          // so we can add to the count without changing the underlying object.
          topSummary = [{
            category: "Commentary",
            count: summary[0].count,
            books: [],
            hasEnglish: summary[0].hasEnglish
          }].concat(topSummary.slice(1));
        }
        subCommentaryCats.map(function (cat) {
          topSummary[0].count += cat.count;
          topSummary[0].hasEnglish = cat.hasEnglish || summary[0].hasEnglish;
        });
        summary = topSummary;
        var essayLinks = this.props.currObjectVersions ? sefaria.essayLinks(refs, this.props.currObjectVersions) : [];
        if (essayLinks.length > 0) {
          essayLinks.forEach(function (link, i) {
            var essayTextFilter = /*#__PURE__*/external_react_default().createElement(TextFilter, {
              setConnectionsMode: this.props.setConnectionsMode,
              srefs: this.props.srefs,
              key: i,
              book: link.index_title,
              heBook: link.heTitle,
              hasEnglish: link.sourceHasEn,
              category: link.category,
              updateRecent: true,
              setFilter: this.props.setFilter,
              hideCounts: true,
              enDisplayText: link.displayedText["en"],
              heDisplayText: link.displayedText["he"],
              filterSuffix: "Essay",
              on: false
            });
            essaySummary.push(essayTextFilter);
          }.bind(this));
          essaySummary = /*#__PURE__*/external_react_default().createElement("div", {
            className: "essayGroup"
          }, essaySummary);
        }
      }
      var connectionsSummary = summary.map(function (cat, i) {
        var books = this.props.contentLang === "hebrew" ? cat.books.concat().sort(sefaria.linkSummaryBookSortHebrew.bind(null, baseCat)) : cat.books;
        return /*#__PURE__*/external_react_default().createElement(CategoryFilter, {
          srefs: this.props.srefs,
          category: cat.category,
          heCategory: sefaria.hebrewTerm(cat.category),
          showBooks: this.props.showBooks,
          count: cat.count,
          books: books,
          hasEnglish: cat.hasEnglish,
          filter: this.props.filter,
          updateRecent: true,
          setFilter: this.props.setFilter,
          setConnectionsCategory: this.props.setConnectionsCategory,
          on: sefaria.util.inArray(cat.category, this.props.filter) !== -1,
          key: cat.category
        });
      }.bind(this));
      var summaryToggle = null;
      if (isTopLevel && connectionsSummary.length > collapsedTopLevelLimit) {
        if (this.props.collapsed) {
          connectionsSummary = connectionsSummary.slice(0, collapsedTopLevelLimit); //get the first x items
          summaryToggle = /*#__PURE__*/external_react_default().createElement(ToolsButton, {
            en: "More",
            he: "\u05E2\u05D5\u05D3",
            image: "more.svg",
            onClick: this.props.toggleTopLevelCollapsed,
            control: "interface",
            typeface: "system"
          });
        } else {
          summaryToggle = /*#__PURE__*/external_react_default().createElement(ToolsButton, {
            en: "See Less",
            he: "\u05E4\u05D7\u05D5\u05EA",
            image: "less.svg",
            onClick: this.props.toggleTopLevelCollapsed,
            control: "interface",
            typeface: "system"
          });
        }
      }
      return /*#__PURE__*/external_react_default().createElement("div", null, isTopLevel ? essaySummary : null, connectionsSummary, summaryToggle);
    }
  }]);
  return ConnectionsSummary;
}((external_react_class_default()));
ConnectionsSummary.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  // an array of ref strings
  category: (external_prop_types_default()).string,
  // if present show connections for category, if null show category summary
  filter: (external_prop_types_default()).array,
  fullPanel: (external_prop_types_default()).bool,
  multiPanel: (external_prop_types_default()).bool,
  contentLang: (external_prop_types_default()).string,
  showBooks: (external_prop_types_default()).bool,
  setConnectionsMode: (external_prop_types_default()).func,
  setFilter: (external_prop_types_default()).func,
  setConnectionsCategory: (external_prop_types_default()).func.isRequired,
  currObjectVersions: (external_prop_types_default()).object
};
var MySheetsList = /*#__PURE__*/function (_Component4) {
  ConnectionsPanel_inherits(MySheetsList, _Component4);
  var _super4 = ConnectionsPanel_createSuper(MySheetsList);
  function MySheetsList() {
    ConnectionsPanel_classCallCheck(this, MySheetsList);
    return _super4.apply(this, arguments);
  }
  ConnectionsPanel_createClass(MySheetsList, [{
    key: "render",
    value:
    // List of my sheets for a ref in the Sidebar
    function render() {
      var _this7 = this;
      var sheets = sefaria.sheets.userSheetsByRef(this.props.srefs);
      var content = sheets.length ? sheets.filter(function (sheet) {
        // Don't show sheets as connections to themselves
        return sheet.id !== _this7.props.connectedSheet;
      }).filter(
      // filters out duplicate sheets by sheet ID number
      function (sheet, index, self) {
        return index === self.findIndex(function (s) {
          return s.id === sheet.id;
        });
      }).map(function (sheet) {
        return /*#__PURE__*/external_react_default().createElement(SheetListing, {
          sheet: sheet,
          key: sheet.sheetUrl,
          handleSheetClick: _this7.props.handleSheetClick,
          connectedRefs: _this7.props.srefs
        });
      }, this) : null;
      return content && content.length ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "sheetList"
      }, content) : null;
    }
  }]);
  return MySheetsList;
}((external_react_class_default()));
MySheetsList.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  connectedSheet: (external_prop_types_default()).string
};
var PublicSheetsList = /*#__PURE__*/function (_Component5) {
  ConnectionsPanel_inherits(PublicSheetsList, _Component5);
  var _super5 = ConnectionsPanel_createSuper(PublicSheetsList);
  function PublicSheetsList() {
    ConnectionsPanel_classCallCheck(this, PublicSheetsList);
    return _super5.apply(this, arguments);
  }
  ConnectionsPanel_createClass(PublicSheetsList, [{
    key: "render",
    value:
    // List of public sheets for a ref in the sidebar
    function render() {
      var _this8 = this;
      var sheets = sefaria.sheets.sheetsByRef(this.props.srefs);
      var content = sheets.length ? sheets.filter(function (sheet) {
        // My sheets are shown already in MySheetList
        return sheet.owner !== sefaria._uid && sheet.id !== _this8.props.connectedSheet;
      }).sort(function (a, b) {
        // First sort by language / interface language
        var aHe, bHe;
        var _map = [a.title, b.title].map(sefaria.hebrew.isHebrew);
        var _map2 = ConnectionsPanel_slicedToArray(_map, 2);
        aHe = _map2[0];
        bHe = _map2[1];
        if (aHe !== bHe) {
          return (bHe ? -1 : 1) * (sefaria.interfaceLang === "hebrew" ? -1 : 1);
        }
        // Then by number of views
        return b.views - a.views;
      }).map(function (sheet) {
        return /*#__PURE__*/external_react_default().createElement(SheetListing, {
          sheet: sheet,
          key: sheet.sheetUrl,
          handleSheetClick: _this8.props.handleSheetClick,
          connectedRefs: _this8.props.srefs
        });
      }, this) : null;
      return content && content.length ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "sheetList"
      }, content) : null;
    }
  }]);
  return PublicSheetsList;
}((external_react_class_default()));
PublicSheetsList.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  connectedSheet: (external_prop_types_default()).string
};
var TopicList = function TopicList(_ref7) {
  var masterPanelMode = _ref7.masterPanelMode,
    srefs = _ref7.srefs,
    interfaceLang = _ref7.interfaceLang,
    contentLang = _ref7.contentLang;
  // segment ref topicList can be undefined even if loaded
  // but section ref topicList is null when loading and array when loaded
  var _useState13 = (0,external_react_.useState)(sefaria.topicsByRef(srefs)),
    _useState14 = ConnectionsPanel_slicedToArray(_useState13, 2),
    topics = _useState14[0],
    setTopics = _useState14[1];
  var updateTopics = function updateTopics() {
    setTopics(sefaria.topicsByRef(srefs));
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "topicList ".concat(contentLang === 'hebrew' ? 'topicsHe' : 'topicsEn')
  }, sefaria.is_moderator && masterPanelMode === "Text" ? /*#__PURE__*/external_react_default().createElement(js_TopicSearch, {
    contentLang: contentLang,
    contextSelector: ".topicList",
    srefs: srefs,
    update: updateTopics,
    createNewTopicStr: sefaria.translation(contentLang, "Create a new topic: ")
  }) : null, !topics || !topics.length ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "webpageList empty"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "loadingMessage sans-serif"
  }, /*#__PURE__*/external_react_default().createElement(ContentText, {
    text: {
      en: "No known Topics Here.",
      he: "אין קשרים ידועים."
    }
  }))) : topics.map(function (topic, i) {
    return /*#__PURE__*/external_react_default().createElement(TopicListItem, {
      key: topic.topic,
      id: i,
      topic: topic,
      interfaceLang: interfaceLang,
      srefs: srefs
    });
  }));
};
var TopicListItem = function TopicListItem(_ref8) {
  var id = _ref8.id,
    topic = _ref8.topic,
    interfaceLang = _ref8.interfaceLang,
    srefs = _ref8.srefs;
  var dataSourceText = '';
  var langKey = interfaceLang === 'english' ? 'en' : 'he';
  if (!!topic.dataSources && Object.values(topic.dataSources).length > 0) {
    dataSourceText = "".concat(sefaria._('This topic is connected to '), "\"").concat(sefaria._r(srefs[0]), "\" ").concat(sefaria._('by'), " ").concat(Object.values(topic.dataSources).map(function (d) {
      return d[langKey];
    }).join(' & '), ".");
  }
  return /*#__PURE__*/external_react_default().createElement("a", {
    href: "/topics/".concat(topic.topic),
    className: "topicButton",
    target: "_blank",
    id: "topicItem-".concat(id)
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "topicButtonTitle"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "contentText"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "en"
  }, topic.title.en), /*#__PURE__*/external_react_default().createElement("span", {
    className: "he"
  }, topic.title.he)), /*#__PURE__*/external_react_default().createElement(ToolTipped, {
    altText: dataSourceText,
    classes: "saveButton tooltip-toggle three-dots-button"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/three-dots.svg",
    alt: dataSourceText
  }))), topic.description && (topic.description.en || topic.description.he) ? /*#__PURE__*/external_react_default().createElement("span", {
    className: "smallText"
  }, /*#__PURE__*/external_react_default().createElement(ContentText, {
    markdown: {
      en: topic.description.en,
      he: topic.description.he
    }
  })) : null);
};
var WebPagesList = /*#__PURE__*/function (_Component6) {
  ConnectionsPanel_inherits(WebPagesList, _Component6);
  var _super6 = ConnectionsPanel_createSuper(WebPagesList);
  function WebPagesList() {
    ConnectionsPanel_classCallCheck(this, WebPagesList);
    return _super6.apply(this, arguments);
  }
  ConnectionsPanel_createClass(WebPagesList, [{
    key: "setFilter",
    value:
    // List of web pages for a ref in the sidebar
    function setFilter(filter) {
      this.props.setWebPagesFilter(filter);
    }
  }, {
    key: "webSitesSort",
    value: function webSitesSort(a, b) {
      // First sort by site language / interface language
      var aHe, bHe;
      var _map3 = [a.name, b.name].map(sefaria.hebrew.isHebrew);
      var _map4 = ConnectionsPanel_slicedToArray(_map3, 2);
      aHe = _map4[0];
      bHe = _map4[1];
      if (aHe !== bHe) {
        return (bHe ? -1 : 1) * (sefaria.interfaceLang === "hebrew" ? -1 : 1);
      }
      // Then by number of pages
      return b.count - a.count;
    }
  }, {
    key: "render",
    value: function render() {
      var _this9 = this;
      var webpages = sefaria.webPagesByRef(this.props.srefs);
      var content = [];
      if (!this.props.filter) {
        var sites = {};
        webpages.map(function (page) {
          if (page.siteName in sites) {
            sites[page.siteName].count++;
          } else {
            sites[page.siteName] = {
              name: page.siteName,
              faviconUrl: page.favicon,
              count: 1
            };
          }
        });
        sites = Object.values(sites).sort(this.webSitesSort);
        content = sites.map(function (site) {
          return /*#__PURE__*/external_react_default().createElement("div", {
            className: "website",
            role: "button",
            tabindex: "0",
            onKeyUp: function onKeyUp(event) {
              return event.key === 'Enter' && _this9.setFilter(site.name);
            },
            onClick: function onClick() {
              return _this9.setFilter(site.name);
            },
            key: site.name
          }, /*#__PURE__*/external_react_default().createElement("img", {
            className: "icon",
            src: site.faviconUrl
          }), /*#__PURE__*/external_react_default().createElement("span", {
            className: "siteName"
          }, site.name, " ", /*#__PURE__*/external_react_default().createElement("span", {
            className: "connectionsCount"
          }, "(", site.count, ")")));
        });
      } else {
        webpages = webpages.filter(function (page) {
          return _this9.props.filter == "all" || page.siteName == _this9.props.filter;
        });
        content = webpages.map(function (webpage, i) {
          return /*#__PURE__*/external_react_default().createElement(js_WebPage, ConnectionsPanel_extends({}, webpage, {
            key: i
          }));
        });
      }
      if (!content.length) {
        var filterName = this.props.filter !== "all" ? this.props.filter : null;
        var en = "No web pages known" + (filterName ? " from " + filterName : "") + " here.";
        var he = "אין דפי אינטרנט ידועים" + (filterName ? " מ" + filterName : "") + ".";
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "webpageList empty"
        }, /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
          message: en,
          heMessage: he
        }));
      }
      var linkerMessage = sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "webpagesLinkerMessage sans-serif"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sites that are listed here use the"), " ", /*#__PURE__*/external_react_default().createElement("a", {
        href: "/linker"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Sefaria Linker"))) : null;
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "webpageList"
      }, content, linkerMessage);
    }
  }]);
  return WebPagesList;
}((external_react_class_default()));
WebPagesList.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired
};
var AdvancedToolsList = function AdvancedToolsList(_ref9) {
  var srefs = _ref9.srefs,
    canEditText = _ref9.canEditText,
    currVersions = _ref9.currVersions,
    setConnectionsMode = _ref9.setConnectionsMode,
    masterPanelLanguage = _ref9.masterPanelLanguage,
    toggleSignUpModal = _ref9.toggleSignUpModal;
  var editText = canEditText ? function () {
    var refString = srefs[0];
    var currentPath = sefaria.util.currentPath();
    var currentLangParam;
    var langCode = masterPanelLanguage.slice(0, 2);
    if (currVersions[langCode]) {
      refString += "/" + encodeURIComponent(langCode) + "/" + encodeURIComponent(currVersions[langCode]);
    }
    var path = "/edit/" + refString;
    var nextParam = "?next=" + encodeURIComponent(currentPath);
    path += nextParam;
    //console.log(path);
    sefaria.track.event("Tools", "Edit Text Click", refString, {
      hitCallback: function hitCallback() {
        return window.location = path;
      }
    });
  } : null;
  var addTranslation = function addTranslation() {
    if (!sefaria._uid) {
      toggleSignUpModal(SignUpModalKind.AddTranslation);
    } else {
      var nextParam = "?next=" + sefaria.util.currentPath();
      sefaria.track.event("Tools", "Add Translation Click", srefs[0], {
        hitCallback: function hitCallback() {
          window.location = "/translate/" + srefs[0] + nextParam;
        }
      });
    }
  };
  return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Add Translation",
    he: "\u05D4\u05D5\u05E1\u05E4\u05EA \u05EA\u05E8\u05D2\u05D5\u05DD",
    image: "tools-translate.svg",
    onClick: addTranslation
  }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Add Connection",
    he: "\u05D4\u05D5\u05E1\u05E4\u05EA \u05E7\u05D9\u05E9\u05D5\u05E8 \u05DC\u05D8\u05E7\u05E1\u05D8 \u05D0\u05D7\u05E8",
    image: "tools-add-connection.svg",
    onClick: function onClick() {
      return !sefaria._uid ? toggleSignUpModal(SignUpModalKind.AddConnection) : setConnectionsMode("Add Connection");
    }
  }), editText ? /*#__PURE__*/external_react_default().createElement(ToolsButton, {
    en: "Edit Text",
    he: "\u05E2\u05E8\u05D9\u05DB\u05EA \u05D8\u05E7\u05E1\u05D8",
    image: "tools-edit-text.svg",
    onClick: editText
  }) : null);
};
AdvancedToolsList.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  // an array of ref strings
  canEditText: (external_prop_types_default()).bool,
  currVersions: (external_prop_types_default()).object,
  setConnectionsMode: (external_prop_types_default()).func.isRequired,
  masterPanelLanguage: external_prop_types_default().oneOf(["english", "hebrew", "bilingual"]),
  toggleSignUpModal: (external_prop_types_default()).func
};
var ToolsButton = function ToolsButton(_ref10) {
  var _classNames;
  var en = _ref10.en,
    he = _ref10.he,
    onClick = _ref10.onClick,
    _ref10$urlConnections = _ref10.urlConnectionsMode,
    urlConnectionsMode = _ref10$urlConnections === void 0 ? null : _ref10$urlConnections,
    icon = _ref10.icon,
    image = _ref10.image,
    _ref10$count = _ref10.count,
    count = _ref10$count === void 0 ? null : _ref10$count,
    _ref10$control = _ref10.control,
    control = _ref10$control === void 0 ? "interface" : _ref10$control,
    _ref10$typeface = _ref10.typeface,
    typeface = _ref10$typeface === void 0 ? "system" : _ref10$typeface,
    _ref10$alwaysShow = _ref10.alwaysShow,
    alwaysShow = _ref10$alwaysShow === void 0 ? false : _ref10$alwaysShow,
    secondaryHe = _ref10.secondaryHe,
    secondaryEn = _ref10.secondaryEn,
    _ref10$greyColor = _ref10.greyColor,
    greyColor = _ref10$greyColor === void 0 ? false : _ref10$greyColor;
  var clickHandler = function clickHandler(e) {
    e.preventDefault();
    gtag("event", "feature_clicked", {
      name: "tools_button_".concat(en)
    });
    onClick();
  };
  var iconElem = null;
  if (icon) {
    var iconName = "fa-" + icon;
    var classes = {
      fa: 1,
      toolsButtonIcon: 1
    };
    classes[iconName] = 1;
    iconElem = /*#__PURE__*/external_react_default().createElement("i", {
      className: external_classnames_default()(classes)
    });
  } else if (image) {
    iconElem = /*#__PURE__*/external_react_default().createElement("img", {
      src: "/static/img/" + image,
      className: "toolsButtonIcon",
      alt: ""
    });
  }
  //We only want to generate reloadable urls for states where we actually respond to said url. See ReaderApp.makeHistoryState()- sidebarModes.
  var url = urlConnectionsMode ? sefaria.util.replaceUrlParam("with", urlConnectionsMode) : null;
  var nameClass = en.camelize();
  var wrapperClasses = external_classnames_default()((_classNames = {
    toolsButton: 1
  }, ConnectionsPanel_defineProperty(_classNames, nameClass, 1), ConnectionsPanel_defineProperty(_classNames, control + "Control", 1), ConnectionsPanel_defineProperty(_classNames, typeface + "Typeface", 1), ConnectionsPanel_defineProperty(_classNames, "noselect", 1), ConnectionsPanel_defineProperty(_classNames, "greyColor", greyColor), _classNames));
  return count == null || count > 0 || alwaysShow ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "toolsButtonContainer"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: url,
    className: wrapperClasses,
    "data-name": en,
    onClick: clickHandler
  }, iconElem, /*#__PURE__*/external_react_default().createElement("span", {
    className: "toolsButtonText"
  }, control == "interface" ? /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: en,
      he: he
    }
  }) : /*#__PURE__*/external_react_default().createElement(ContentText, {
    text: {
      en: en,
      he: he
    }
  }), count ? /*#__PURE__*/external_react_default().createElement("span", {
    className: "connectionsCount"
  }, "(", count, ")") : null)), secondaryEn && secondaryHe ? /*#__PURE__*/external_react_default().createElement("a", {
    className: "toolsSecondaryButton",
    onClick: clickHandler
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: secondaryEn,
      he: secondaryHe
    }
  }), " ", /*#__PURE__*/external_react_default().createElement("img", {
    className: "linkArrow",
    src: "/static/img/".concat(sefaria.interfaceLang === "hebrew" ? "arrow-left-bold" : "arrow-right-bold", ".svg"),
    "aria-hidden": "true"
  })) : null) : null;
};
ToolsButton.propTypes = {
  en: (external_prop_types_default()).string.isRequired,
  he: (external_prop_types_default()).string.isRequired,
  icon: (external_prop_types_default()).string,
  image: (external_prop_types_default()).string,
  count: (external_prop_types_default()).number,
  onClick: (external_prop_types_default()).func,
  greyColor: (external_prop_types_default()).bool,
  secondaryEn: (external_prop_types_default()).string,
  secondaryHe: (external_prop_types_default()).string
};
var ShareBox = /*#__PURE__*/function (_Component7) {
  ConnectionsPanel_inherits(ShareBox, _Component7);
  var _super7 = ConnectionsPanel_createSuper(ShareBox);
  function ShareBox(props) {
    var _this10;
    ConnectionsPanel_classCallCheck(this, ShareBox);
    _this10 = _super7.call(this, props);
    if (_this10.props.masterPanelSheetId) {
      var sheet = sefaria.sheets.loadSheetByID(_this10.props.masterPanelSheetId);
      _this10.state = {
        sheet: sheet,
        shareValue: sheet.options.collaboration ? sheet.options.collaboration : "none"
      };
    } else {
      _this10.state = {
        sheet: null,
        shareValue: null
      };
    }
    return _this10;
  }
  ConnectionsPanel_createClass(ShareBox, [{
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      var _this11 = this;
      if (this.state.shareValue != prevState.shareValue) {
        new Promise(function (resolve, reject) {
          return sefaria.sheets.loadSheetByID(_this11.props.masterPanelSheetId, function (sheet) {
            return resolve(sheet);
          });
        }).then(function (updatedSheet) {
          updatedSheet.options.collaboration = _this11.state.shareValue;
          updatedSheet.lastModified = updatedSheet.dateModified;
          delete updatedSheet._id;
          delete updatedSheet.error;
          var postJSON = JSON.stringify(updatedSheet);
          _this11.postSheet(postJSON);
        });
      }
    }
  }, {
    key: "focusInput",
    value: function focusInput() {
      sefariaJquery(external_react_dom_default().findDOMNode(this)).find("input").select();
    }
  }, {
    key: "postSheet",
    value: function postSheet(postJSON) {
      sefariaJquery.post("/api/sheets/", {
        "json": postJSON
      }, function (data) {
        if (data.id) {
          console.log('saved...');
          sefaria.sheets._loadSheetByID[data.id] = data;
        } else {
          console.log(data);
        }
      });
    }
  }, {
    key: "updateShareOptions",
    value: function updateShareOptions(event) {
      this.setState({
        shareValue: event.target.value
      });
    }
  }, {
    key: "copySheetLink",
    value: function copySheetLink() {
      var copyText = document.getElementById("sheetShareLink");
      copyText.select();
      copyText.setSelectionRange(0, 99999); // For mobile devices

      if (!navigator.clipboard) {
        // fallback if navigator.clipboard does not work
        document.execCommand('copy');
      } else {
        navigator.clipboard.writeText(copyText.value);
      }
    }
  }, {
    key: "render",
    value: function render() {
      var url = this.props.url;
      var shareFacebook = function shareFacebook() {
        sefaria.util.openInNewTab("https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(url));
      };
      var shareTwitter = function shareTwitter() {
        sefaria.util.openInNewTab("https://twitter.com/share?url=" + encodeURIComponent(url));
      };
      var shareEmail = function shareEmail() {
        sefaria.util.openInNewTab("mailto:?&subject=Text on Sefaria&body=" + url);
      };
      var classes = external_classnames_default()({
        textList: 1,
        fullPanel: this.props.fullPanel
      });
      return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(ConnectionsPanelSection, {
        title: "Share Link"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "shareInputBox"
      }, /*#__PURE__*/external_react_default().createElement("button", {
        tabindex: "0",
        className: "shareInputButton",
        "aria-label": "Copy Link to Sheet",
        onClick: this.copySheetLink.bind(this)
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/copy.svg",
        className: "copyLinkIcon",
        "aria-hidden": "true"
      })), /*#__PURE__*/external_react_default().createElement("input", {
        tabindex: "0",
        className: "shareInput",
        id: "sheetShareLink",
        value: this.props.url
      })), this.state.sheet && sefaria._uid === this.state.sheet.owner ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "shareSettingsBox"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "People with this link can"), /*#__PURE__*/external_react_default().createElement("select", {
        className: "shareDropdown",
        name: "Share",
        onChange: this.updateShareOptions.bind(this),
        value: this.state.shareValue
      }, /*#__PURE__*/external_react_default().createElement("option", {
        value: "none"
      }, sefaria._("View", "Sheet Share")), /*#__PURE__*/external_react_default().createElement("option", {
        value: "anyone-can-add"
      }, sefaria._("Add", "Sheet Share")), /*#__PURE__*/external_react_default().createElement("option", {
        value: "anyone-can-edit"
      }, sefaria._("Edit", "Sheet Share")))) : null), /*#__PURE__*/external_react_default().createElement(ConnectionsPanelSection, {
        title: "More Options"
      }, /*#__PURE__*/external_react_default().createElement(ToolsButton, {
        en: "Share on Facebook",
        he: "\u05E4\u05D9\u05D9\u05E1\u05D1\u05D5\u05E7",
        icon: "facebook-official",
        onClick: shareFacebook
      }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
        en: "Share on Twitter",
        he: "\u05D8\u05D5\u05D5\u05D9\u05D8\u05E8",
        icon: "twitter",
        onClick: shareTwitter
      }), /*#__PURE__*/external_react_default().createElement(ToolsButton, {
        en: "Share by Email",
        he: "\u05D0\u05D9\u05DE\u05D9\u05D9\u05DC",
        icon: "envelope-o",
        onClick: shareEmail
      })));
    }
  }]);
  return ShareBox;
}((external_react_class_default()));
ShareBox.propTypes = {
  url: (external_prop_types_default()).string.isRequired,
  setConnectionsMode: (external_prop_types_default()).func.isRequired,
  closePanel: (external_prop_types_default()).func.isRequired,
  fullPanel: (external_prop_types_default()).bool,
  masterPanelSheetId: (external_prop_types_default()).number
};
var AddNoteBox = /*#__PURE__*/function (_Component8) {
  ConnectionsPanel_inherits(AddNoteBox, _Component8);
  var _super8 = ConnectionsPanel_createSuper(AddNoteBox);
  function AddNoteBox(props) {
    var _this12;
    ConnectionsPanel_classCallCheck(this, AddNoteBox);
    _this12 = _super8.call(this, props);
    _this12.state = {
      isPrivate: !props.noteIsPublic,
      saving: false
    };
    return _this12;
  }
  ConnectionsPanel_createClass(AddNoteBox, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.focusNoteText();
    }
  }, {
    key: "focusNoteText",
    value: function focusNoteText() {
      sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".noteText").focus();
    }
  }, {
    key: "saveNote",
    value: function saveNote() {
      var text = sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".noteText").val();
      if (!text) {
        return;
      }
      var note = {
        text: text,
        refs: this.props.srefs,
        type: "note",
        "public": !this.state.isPrivate
      };
      if (this.props.noteId) {
        note._id = this.props.noteId;
      }
      var postData = {
        json: JSON.stringify(note)
      };
      var url = "/api/notes/";
      sefariaJquery.post(url, postData, function (data) {
        if (data.error) {
          alert(data.error);
        } else if (data) {
          if (this.props.noteId) {
            sefaria.clearPrivateNotes(data);
          } else {
            sefaria.addPrivateNote(data);
          }
          sefaria.track.event("Tools", "Note Save " + (this.state.isPrivate ? "Private" : "Public"), this.props.srefs.join("/"));
          sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".noteText").val("");
          this.props.onSave();
        } else {
          alert(sefaria._("Sorry, there was a problem saving your note."));
        }
      }.bind(this)).fail(function (xhr, textStatus, errorThrown) {
        alert(sefaria._("Unfortunately, there was an error saving this note. Please try again or try reloading this page."));
      });
      this.setState({
        saving: true
      });
    }
  }, {
    key: "setPrivate",
    value: function setPrivate() {
      this.setState({
        isPrivate: true
      });
    }
  }, {
    key: "setPublic",
    value: function setPublic() {
      this.setState({
        isPrivate: false
      });
    }
  }, {
    key: "deleteNote",
    value: function deleteNote() {
      alert(sefaria._("Something went wrong (that's all I know)."));
      if (!confirm(sefaria._("Are you sure you want to delete this note?"))) {
        return;
      }
      sefaria.deleteNote(this.props.noteId).then(this.props.onDelete);
    }
  }, {
    key: "render",
    value: function render() {
      if (!sefaria._uid) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "addNoteBox"
        }, /*#__PURE__*/external_react_default().createElement(LoginPrompt, null));
      }
      //const privateClasses = classNames({ notePrivateButton: 1, active: this.state.isPrivate });
      //const publicClasses = classNames({ notePublicButton: 1, active: !this.state.isPrivate });
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "addNoteBox"
      }, /*#__PURE__*/external_react_default().createElement("textarea", {
        className: "noteText",
        placeholder: sefaria._("Write a note..."),
        defaultValue: this.props.noteText
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "button fillWidth",
        onClick: this.saveNote
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, this.props.noteId ? "Save" : "Add Note"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, this.props.noteId ? "שמירה" : "הוספת הערה")), this.props.noteId ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "button white fillWidth",
        onClick: this.props.onCancel
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Cancel"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D1\u05D8\u05DC")) : null, this.props.noteId ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "deleteNote",
        onClick: this.deleteNote
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Delete Note"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05DE\u05D7\u05D9\u05E7\u05EA \u05D4\u05E2\u05E8\u05D4")) : null);

      /* Leaving out public / private toggle until public notes are reintroduced
      <div className="noteSharingToggle">
        <div className={privateClasses} onClick={this.setPrivate}>
          <span className="int-en"><i className="fa fa-lock"></i> Private</span>
          <span className="int-he"><i className="fa fa-lock"></i>רשומה פרטית</span>
        </div>
        <div className={publicClasses} onClick={this.setPublic}>
          <span className="int-en">Public</span>
          <span className="int-he">רשומה כללית</span>
        </div>
      </div>
      */
    }
  }]);
  return AddNoteBox;
}((external_react_class_default()));
AddNoteBox.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  onSave: (external_prop_types_default()).func.isRequired,
  onCancel: (external_prop_types_default()).func.isRequired,
  onDelete: (external_prop_types_default()).func,
  noteId: (external_prop_types_default()).string,
  noteText: (external_prop_types_default()).string,
  noteTitle: (external_prop_types_default()).string,
  noteIsPublic: (external_prop_types_default()).bool
};
var MyNotes = /*#__PURE__*/function (_Component9) {
  ConnectionsPanel_inherits(MyNotes, _Component9);
  var _super9 = ConnectionsPanel_createSuper(MyNotes);
  function MyNotes() {
    ConnectionsPanel_classCallCheck(this, MyNotes);
    return _super9.apply(this, arguments);
  }
  ConnectionsPanel_createClass(MyNotes, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.loadNotes();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (!prevProps.srefs.compare(this.props.srefs)) {
        this.loadNotes();
      }
    }
  }, {
    key: "loadNotes",
    value: function loadNotes() {
      // Rerender this component when privateNotes arrive.
      sefaria.privateNotes(this.props.srefs, this.rerender);
    }
  }, {
    key: "rerender",
    value: function rerender() {
      this.forceUpdate();
    }
  }, {
    key: "render",
    value: function render() {
      var myNotesData = sefaria.privateNotes(this.props.srefs);
      var myNotes = myNotesData ? myNotesData.map(function (note) {
        var editNote = function () {
          this.props.editNote(note);
        }.bind(this);
        return /*#__PURE__*/external_react_default().createElement(Note, {
          text: note.text,
          isPrivate: !note["public"],
          isMyNote: true,
          ownerName: note.ownerName,
          ownerProfileUrl: note.ownerProfileUrl,
          ownerImageUrl: note.ownerImageUrl,
          editNote: editNote,
          key: note._id
        });
      }.bind(this)) : null;
      return myNotes ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "noteList myNoteList"
      }, myNotes) : null;
    }
  }]);
  return MyNotes;
}((external_react_class_default()));
MyNotes.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  editNote: (external_prop_types_default()).func.isRequired
};
var PublicNotes = /*#__PURE__*/function (_Component10) {
  ConnectionsPanel_inherits(PublicNotes, _Component10);
  var _super10 = ConnectionsPanel_createSuper(PublicNotes);
  function PublicNotes() {
    ConnectionsPanel_classCallCheck(this, PublicNotes);
    return _super10.apply(this, arguments);
  }
  ConnectionsPanel_createClass(PublicNotes, [{
    key: "render",
    value:
    // List of Publc notes a ref or range or refs.
    function render() {
      var notes = sefaria.notes(this.props.srefs);
      var content = notes ? notes.filter(function (note) {
        // Exlude my notes, shown already in MyNotes.
        return note.owner !== sefaria._uid;
      }).map(function (note) {
        return /*#__PURE__*/external_react_default().createElement(Note, {
          text: note.text,
          ownerName: note.ownerName,
          ownerProfileUrl: note.ownerProfileUrl,
          ownerImageUrl: note.ownerImageUrl,
          isPrivate: false,
          key: note._id
        });
      }) : null;
      return content && content.length ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "noteList publicNoteList"
      }, content) : null;
    }
  }]);
  return PublicNotes;
}((external_react_class_default()));
PublicNotes.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired
};
var AddConnectionBox = /*#__PURE__*/function (_Component11) {
  ConnectionsPanel_inherits(AddConnectionBox, _Component11);
  var _super11 = ConnectionsPanel_createSuper(AddConnectionBox);
  function AddConnectionBox(props) {
    var _this13;
    ConnectionsPanel_classCallCheck(this, AddConnectionBox);
    _this13 = _super11.call(this, props);
    _this13.state = {
      refs: _this13.props.srefs,
      heRefs: _this13.getHeRefs(_this13.props.srefs),
      type: ""
    };
    return _this13;
  }
  ConnectionsPanel_createClass(AddConnectionBox, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if (!this.props.srefs.compare(nextProps.srefs)) {
        this.setState({
          refs: nextProps.srefs,
          heRefs: this.getHeRefs(nextProps.srefs)
        });
      }
    }
  }, {
    key: "getHeRefs",
    value: function getHeRefs(refs) {
      var _this14 = this;
      var heRefs = refs.map(function (ref) {
        var oRef = sefaria.ref(ref);
        if (!oRef) {
          // If a range was selected, the ref cache may not have a Hebrew ref for us, so ask the API
          sefaria.getRef(ref).then(_this14.setHeRefs);
          return "...";
        }
        return oRef.heRef;
      });
      return heRefs;
    }
  }, {
    key: "setHeRefs",
    value: function setHeRefs() {
      this.setState({
        heRefs: this.getHeRefs(this.state.refs)
      });
    }
  }, {
    key: "setType",
    value: function setType(event) {
      this.setState({
        type: event.target.value
      });
    }
  }, {
    key: "addConnection",
    value: function addConnection() {
      var connection = {
        refs: this.props.srefs,
        type: this.state.type
      };
      var postData = {
        json: JSON.stringify(connection)
      };
      var url = "/api/links/";
      sefariaJquery.post(url, postData, function (data) {
        if (data.error) {
          alert(data.error);
        } else {
          sefaria.track.event("Tools", "Add Connection", this.props.srefs.join("/"));
          sefaria.clearLinks();
          this.props.onSave();
        }
      }.bind(this)).fail(function (xhr, textStatus, errorThrown) {
        alert("Unfortunately, there was an error saving this connection. Please try again or try reloading this page.");
      });
      this.setState({
        saving: true
      });
    }
  }, {
    key: "render",
    value: function render() {
      var refs = this.state.refs;
      var heRefs = this.state.heRefs;
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "addConnectionBox"
      }, this.props.srefs.length == 1 ? /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Choose a text to connect."), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D1\u05D7\u05E8 \u05D8\u05E7\u05E1\u05D8 \u05DC\u05E7\u05D9\u05E9\u05D5\u05E8"), /*#__PURE__*/external_react_default().createElement("div", {
        className: "button fillWidth",
        onClick: this.props.openComparePanel
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Browse"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05E1\u05D9\u05D9\u05E8"))) : null, this.props.srefs.length > 2 ? /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "We currently only understand connections between two texts."), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05E0\u05D9\u05EA\u05DF \u05DC\u05E7\u05E9\u05E8 \u05E8\u05E7 \u05D1\u05D9\u05DF 2 \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD")) : null, this.props.srefs.length == 2 ? /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "addConnectionSummary"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "en"
      }, refs[0], /*#__PURE__*/external_react_default().createElement("br", null), "&", /*#__PURE__*/external_react_default().createElement("br", null), refs[1]), /*#__PURE__*/external_react_default().createElement("span", {
        className: "he"
      }, heRefs[0], /*#__PURE__*/external_react_default().createElement("br", null), "&", /*#__PURE__*/external_react_default().createElement("br", null), heRefs[1])), /*#__PURE__*/external_react_default().createElement(Dropdown, {
        name: "connectionType",
        options: [{
          value: "",
          label: sefaria._("None", "AddConnectionBox")
        }, {
          value: "commentary",
          label: sefaria._("Commentary", "AddConnectionBox")
        }, {
          value: "quotation",
          label: sefaria._("Quotation", "AddConnectionBox")
        }, {
          value: "midrash",
          label: sefaria._("Midrash", "AddConnectionBox")
        }, {
          value: "ein mishpat",
          label: sefaria._("Ein Mishpat / Ner Mitsvah", "AddConnectionBox")
        }, {
          value: "mesorat hashas",
          label: sefaria._("Mesorat HaShas", "AddConnectionBox")
        }, {
          value: "reference",
          label: sefaria._("Reference", "AddConnectionBox")
        }, {
          value: "related",
          label: sefaria._("Related Passage", "AddConnectionBox")
        }],
        placeholder: sefaria._("Select Type", "AddConnectionBox"),
        onChange: this.setType
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "button fillWidth",
        onClick: this.addConnection
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Add Connection"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D4\u05D5\u05E1\u05E3 \u05E7\u05D9\u05E9\u05D5\u05E8"))) : null);
    }
  }]);
  return AddConnectionBox;
}((external_react_class_default()));
AddConnectionBox.propTypes = {
  srefs: (external_prop_types_default()).array.isRequired,
  onSave: (external_prop_types_default()).func.isRequired,
  onCancel: (external_prop_types_default()).func.isRequired
};
function ManuscriptImageList(props) {
  var content = props.manuscriptList.map(function (x) {
    return /*#__PURE__*/external_react_default().createElement(ManuscriptImage, {
      manuscript: x,
      interfaceLang: props.interfaceLang,
      contentLang: props.contentLang,
      key: "".concat(x['manuscript_slug'], "-").concat(x['page_id'])
    });
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "manuscriptList"
  }, content);
}
function ManuscriptImage(props) {
  var manuscript = props.manuscript;
  var _ref11 = props.interfaceLang === 'hebrew' ? ['int-he', 'he_description'] : ['int-en', 'description'],
    _ref12 = ConnectionsPanel_slicedToArray(_ref11, 2),
    cls = _ref12[0],
    description = _ref12[1];
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "manuscript"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: manuscript['image_url'],
    target: "_blank"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    className: "manuscriptImage",
    src: manuscript["thumbnail_url"],
    alt: "Ancient Manuscript"
  })), props.interfaceLang === 'hebrew' ? /*#__PURE__*/external_react_default().createElement("p", {
    className: "hebrew manuscriptCaptionHe"
  }, manuscript.manuscript.he_title) : /*#__PURE__*/external_react_default().createElement("p", {
    className: "english manuscriptCaption"
  }, manuscript.manuscript.title), /*#__PURE__*/external_react_default().createElement("div", {
    className: "meta"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Location: "), /*#__PURE__*/external_react_default().createElement("span", null, manuscript['page_id'].replace(/_/g, ' ')), /*#__PURE__*/external_react_default().createElement("br", null), manuscript.manuscript[description] ? /*#__PURE__*/external_react_default().createElement("span", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: 'Courtesy of: ',
      he: 'הודות ל'
    }
  }), /*#__PURE__*/external_react_default().createElement("span", {
    className: cls
  }, manuscript.manuscript[description], /*#__PURE__*/external_react_default().createElement("br", null))) : '', manuscript.manuscript['license'] ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "manuscriptLicense"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "License"), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, ":"), /*#__PURE__*/external_react_default().createElement("a", {
    className: "manuscriptLicenseLink",
    href: sefaria.getLicenseMap()[manuscript.manuscript['license']],
    target: "_blank"
  }, sefaria._(manuscript.manuscript['license']))) : '', /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: 'Source: ',
      he: 'מקור: '
    }
  }), /*#__PURE__*/external_react_default().createElement("a", {
    className: "versionDetailsLink",
    href: manuscript.manuscript['source'],
    target: "_blank"
  }, sefaria.util.parseUrl(manuscript.manuscript['source']).host.replace("www.", ""))));
}
ManuscriptImage.propTypes = {
  manuscript: (external_prop_types_default()).object.isRequired,
  interfaceLang: (external_prop_types_default()).string.isRequired,
  contentLang: (external_prop_types_default()).string.isRequired
};
ManuscriptImageList.propTypes = {
  manuscriptList: (external_prop_types_default()).array.isRequired,
  interfaceLang: (external_prop_types_default()).string.isRequired,
  contentLang: (external_prop_types_default()).string.isRequired
};
var ConnectionsPanelSection = function ConnectionsPanelSection(_ref13) {
  var title = _ref13.title,
    children = _ref13.children;
  return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "connectionPanelSectionHeader sans-serif"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "connectionPanelSectionHeaderInner"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    context: "ConnectionPanelSection"
  }, title))), children);
};

;// CONCATENATED MODULE: ../static/js/SearchPage.jsx
function SearchPage_typeof(obj) { "@babel/helpers - typeof"; return SearchPage_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, SearchPage_typeof(obj); }
function SearchPage_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function SearchPage_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, SearchPage_toPropertyKey(descriptor.key), descriptor); } }
function SearchPage_createClass(Constructor, protoProps, staticProps) { if (protoProps) SearchPage_defineProperties(Constructor.prototype, protoProps); if (staticProps) SearchPage_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function SearchPage_toPropertyKey(arg) { var key = SearchPage_toPrimitive(arg, "string"); return SearchPage_typeof(key) === "symbol" ? key : String(key); }
function SearchPage_toPrimitive(input, hint) { if (SearchPage_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (SearchPage_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function SearchPage_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) SearchPage_setPrototypeOf(subClass, superClass); }
function SearchPage_setPrototypeOf(o, p) { SearchPage_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return SearchPage_setPrototypeOf(o, p); }
function SearchPage_createSuper(Derived) { var hasNativeReflectConstruct = SearchPage_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = SearchPage_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = SearchPage_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return SearchPage_possibleConstructorReturn(this, result); }; }
function SearchPage_possibleConstructorReturn(self, call) { if (call && (SearchPage_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return SearchPage_assertThisInitialized(self); }
function SearchPage_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function SearchPage_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function SearchPage_getPrototypeOf(o) { SearchPage_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return SearchPage_getPrototypeOf(o); }












var SearchPage = /*#__PURE__*/function (_Component) {
  SearchPage_inherits(SearchPage, _Component);
  var _super = SearchPage_createSuper(SearchPage);
  function SearchPage(props) {
    var _this;
    SearchPage_classCallCheck(this, SearchPage);
    _this = _super.call(this, props);
    _this.state = {
      totalResults: null,
      mobileFiltersOpen: false
    };
    return _this;
  }
  SearchPage_createClass(SearchPage, [{
    key: "render",
    value: function render() {
      var _this2 = this;
      var classes = external_classnames_default()({
        readerNavMenu: 1,
        compare: this.props.compare
      });
      var isQueryHebrew = sefaria.hebrew.isHebrew(this.props.query);
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes,
        key: this.props.query
      }, this.props.compare ? /*#__PURE__*/external_react_default().createElement(js_ComparePanelHeader, {
        search: true,
        showDisplaySettings: false,
        onBack: this.props.close,
        openSearch: this.props.onQueryChange
      }) : null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "content searchContent"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sidebarLayout"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "contentInner"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchTopLine"
      }, /*#__PURE__*/external_react_default().createElement("h1", {
        className: external_classnames_default()({
          "hebrewQuery": isQueryHebrew,
          "englishQuery": !isQueryHebrew
        })
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Results for"), "\xA0", /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        html: {
          en: "&ldquo;",
          he: "&#1524;"
        }
      }), this.props.query, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        html: {
          en: "&rdquo;",
          he: "&#1524;"
        }
      })), this.state.totalResults ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "searchResultCount sans-serif"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, this.state.totalResults.addCommas()), "\xA0", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Results")) : null), /*#__PURE__*/external_react_default().createElement(js_SearchResultList, {
        query: this.props.query,
        tab: this.props.tab,
        compare: this.props.compare,
        textSearchState: this.props.textSearchState,
        sheetSearchState: this.props.sheetSearchState,
        onResultClick: this.props.onResultClick,
        updateTab: this.props.updateTab,
        updateAppliedOptionSort: this.props.updateAppliedOptionSort,
        registerAvailableFilters: this.props.registerAvailableFilters,
        updateTotalResults: function updateTotalResults(n) {
          return _this2.setState({
            totalResults: n
          });
        },
        openMobileFilters: function openMobileFilters() {
          return _this2.setState({
            mobileFiltersOpen: true
          });
        }
      })), sefaria.multiPanel && !this.props.compare || this.state.mobileFiltersOpen ? /*#__PURE__*/external_react_default().createElement("div", {
        className: sefaria.multiPanel && !this.props.compare ? "navSidebar" : "mobileSearchFilters"
      }, this.state.totalResults ? /*#__PURE__*/external_react_default().createElement(js_SearchFilters, {
        query: this.props.query,
        searchState: this.props["".concat(this.props.tab, "SearchState")],
        updateAppliedFilter: this.props.updateAppliedFilter.bind(null, this.props.tab, this.props["".concat(this.props.tab, "SearchState")]),
        updateAppliedOptionField: this.props.updateAppliedOptionField.bind(null, this.props.tab),
        updateAppliedOptionSort: this.props.updateAppliedOptionSort.bind(null, this.props.tab),
        closeMobileFilters: function closeMobileFilters() {
          return _this2.setState({
            mobileFiltersOpen: false
          });
        },
        compare: this.props.compare,
        type: this.props.tab
      }) : null) : null), this.props.panelsOpen === 1 ? /*#__PURE__*/external_react_default().createElement(js_Footer, null) : null));
    }
  }]);
  return SearchPage;
}((external_react_class_default()));
SearchPage.propTypes = {
  interfaceLang: external_prop_types_default().oneOf(["english", "hebrew"]),
  query: (external_prop_types_default()).string,
  tab: external_prop_types_default().oneOf(["text", "sheet"]),
  textSearchState: (external_prop_types_default()).object,
  sheetSearchState: (external_prop_types_default()).object,
  settings: (external_prop_types_default()).object,
  panelsOpen: (external_prop_types_default()).number,
  close: (external_prop_types_default()).func,
  onResultClick: (external_prop_types_default()).func,
  onQueryChange: (external_prop_types_default()).func,
  updateTab: (external_prop_types_default()).func,
  updateAppliedFilter: (external_prop_types_default()).func,
  updateAppliedOptionField: (external_prop_types_default()).func,
  updateAppliedOptionSort: (external_prop_types_default()).func,
  registerAvailableFilters: (external_prop_types_default()).func
};
/* harmony default export */ const js_SearchPage = (SearchPage);
;// CONCATENATED MODULE: external "slate-hyperscript"
const external_slate_hyperscript_namespaceObject = require("slate-hyperscript");
;// CONCATENATED MODULE: external "slate-history"
const external_slate_history_namespaceObject = require("slate-history");
;// CONCATENATED MODULE: external "slate"
const external_slate_namespaceObject = require("slate");
;// CONCATENATED MODULE: external "slate-react"
const external_slate_react_namespaceObject = require("slate-react");
;// CONCATENATED MODULE: external "is-hotkey"
const external_is_hotkey_namespaceObject = require("is-hotkey");
var external_is_hotkey_default = /*#__PURE__*/__webpack_require__.n(external_is_hotkey_namespaceObject);
;// CONCATENATED MODULE: ../static/js/Editor.jsx
var _this = undefined;
function Editor_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ Editor_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == Editor_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function Editor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function Editor_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { Editor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { Editor_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function Editor_extends() { Editor_extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return Editor_extends.apply(this, arguments); }
function Editor_slicedToArray(arr, i) { return Editor_arrayWithHoles(arr) || Editor_iterableToArrayLimit(arr, i) || Editor_unsupportedIterableToArray(arr, i) || Editor_nonIterableRest(); }
function Editor_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function Editor_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function Editor_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function Editor_typeof(obj) { "@babel/helpers - typeof"; return Editor_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, Editor_typeof(obj); }
function Editor_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function Editor_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? Editor_ownKeys(Object(source), !0).forEach(function (key) { Editor_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : Editor_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function Editor_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = Editor_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function Editor_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return Editor_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return Editor_arrayLikeToArray(o, minLen); }
function Editor_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function Editor_defineProperty(obj, key, value) { key = Editor_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function Editor_toPropertyKey(arg) { var key = Editor_toPrimitive(arg, "string"); return Editor_typeof(key) === "symbol" ? key : String(key); }
function Editor_toPrimitive(input, hint) { if (Editor_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (Editor_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }












// Mapping from Sheet doc format source types to Slate block element types
var sheet_item_els = {
  ref: 'SheetSource',
  comment: 'SheetOutsideText',
  outsideText: 'SheetOutsideText',
  outsideBiText: 'SheetOutsideBiText',
  media: 'SheetMedia'
};
var voidElements = ["ProfilePic", "SheetMedia", "SheetSource", "SheetOutsideBiText", "horizontal-line"];
var HOTKEYS = {
  'mod+b': 'bold',
  'mod+i': 'italic',
  'mod+u': 'underline'
};
var LIST_TYPES = ['numbered-list', 'bulleted-list'];
var NO_SPACER_NEEDED_TYPES = ["SheetOutsideText", "header", "SheetComment", "list-item", "numbered-list", "bulleted-list"];
var ELEMENT_TAGS = {
  A: function A(el) {
    return {
      type: 'link',
      url: el.getAttribute('href'),
      ref: el.getAttribute('data-ref'),
      target: el.getAttribute('target')
    };
  },
  BLOCKQUOTE: function BLOCKQUOTE() {
    return {
      type: 'quote'
    };
  },
  H1: function H1() {
    return {
      type: 'header'
    };
  },
  H2: function H2() {
    return {
      type: 'heading-two'
    };
  },
  H3: function H3() {
    return {
      type: 'heading-three'
    };
  },
  H4: function H4() {
    return {
      type: 'heading-four'
    };
  },
  H5: function H5() {
    return {
      type: 'heading-five'
    };
  },
  H6: function H6() {
    return {
      type: 'heading-six'
    };
  },
  IMG: function IMG(el) {
    return {
      type: 'image',
      url: el.getAttribute('src')
    };
  },
  LI: function LI() {
    return {
      type: 'list-item'
    };
  },
  OL: function OL() {
    return {
      type: 'numbered-list'
    };
  },
  P: function P() {
    return {
      type: 'paragraph'
    };
  },
  DIV: function DIV() {
    return {
      type: 'paragraph'
    };
  },
  PRE: function PRE() {
    return {
      type: 'code'
    };
  },
  UL: function UL() {
    return {
      type: 'bulleted-list'
    };
  },
  TABLE: function TABLE() {
    return {
      type: 'table'
    };
  },
  TR: function TR() {
    return {
      type: 'table-row'
    };
  },
  TD: function TD() {
    return {
      type: 'table-cell'
    };
  },
  HR: function HR() {
    return {
      type: 'horizontal-line'
    };
  }
};
var format_tag_pairs = [{
  tag: "EM",
  format: "italic"
}, {
  tag: "I",
  format: "italic"
}, {
  tag: "STRONG",
  format: "bold"
}, {
  tag: "SUP",
  format: "superscript"
}, {
  tag: "B",
  format: "bold"
}, {
  tag: "U",
  format: "underline"
}, {
  tag: "BIG",
  format: "big"
}, {
  tag: "SMALL",
  format: "small"
}];
var special_styles_to_care_about = ["background-color", "color", "text-align"];
var TEXT_TAGS = format_tag_pairs.reduce(function (obj, item) {
  obj[item.tag] = function () {
    return Editor_defineProperty({}, item.format, true);
  };
  return obj;
}, {});
var format_to_html_lookup = format_tag_pairs.reduce(function (obj, item) {
  obj[item.format] = item.tag;
  return obj;
}, {});
var getNodeAbove = function getNodeAbove(curPath, editor) {
  var top = null;
  var topPath = null;
  try {
    topPath = external_slate_namespaceObject.Path.previous(curPath);
    top = external_slate_namespaceObject.Node.get(editor, topPath);
  } catch (err) {}
  return {
    node: top,
    path: topPath
  };
};
var getNodeBelow = function getNodeBelow(curPath, editor) {
  var bottom = null;
  var bottomPath = null;
  try {
    bottomPath = external_slate_namespaceObject.Path.next(curPath);
    bottom = external_slate_namespaceObject.Node.get(editor, bottomPath);
  } catch (err) {}
  return {
    node: bottom,
    path: bottomPath
  };
};
var deserialize = function deserialize(el) {
  if (el.nodeType === 3) {
    return el.textContent;
  } else if (el.nodeType !== 1) {
    return null;
  } else if (el.nodeName === 'BR') {
    return null;
  }
  var checkForStyles = function checkForStyles() {
    if (el.getAttribute("style")) {
      var elStyles = el.getAttribute("style").split(';');
      var addlAttrs = {};
      var _iterator = Editor_createForOfIteratorHelper(elStyles),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var elStyle = _step.value;
          console.log(elStyle);
          var styleArray = elStyle.split(":");
          if (styleArray.length == 2) {
            var styleType = styleArray[0].trim();
            var styleValue = styleArray[1].trim();
            addlAttrs[styleType] = styleValue;
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return addlAttrs;
    }
  };
  var nodeName = el.nodeName;
  var parent = el;
  if (el.nodeNode === 'PRE' && el.childNodes[0] && el.childNodes[0].nodeName === 'CODE') {
    parent = el.childNodes[0];
  }
  var children = Array.from(parent.childNodes).map(deserialize).flat();
  if (el.nodeName === 'BODY') {
    return (0,external_slate_hyperscript_namespaceObject.jsx)('fragment', {}, children);
  }
  if (ELEMENT_TAGS[nodeName]) {
    var new_children = children;
    if (!children[0]) {
      new_children = [{
        'text': ''
      }];
    }
    var attrs = Editor_objectSpread(Editor_objectSpread({}, ELEMENT_TAGS[nodeName](el)), checkForStyles());
    return (0,external_slate_hyperscript_namespaceObject.jsx)('element', attrs, new_children);
  }
  if (TEXT_TAGS[nodeName]) {
    var _attrs = TEXT_TAGS[nodeName](el);
    return children.map(function (child) {
      if (!child) {
        return null;
      }
      return (0,external_slate_hyperscript_namespaceObject.jsx)('text', _attrs, typeof child === "string" || external_slate_namespaceObject.Text.isText(child) ? child : external_slate_namespaceObject.Node.string(child));
    });
  }
  if (el.getAttribute("style")) {
    var elStyles = el.getAttribute("style").split(';');
    var _iterator2 = Editor_createForOfIteratorHelper(elStyles),
      _step2;
    try {
      var _loop = function _loop() {
        var elStyle = _step2.value;
        var styleArray = elStyle.split(":");
        if (styleArray.length == 2) {
          var styleType = styleArray[0].trim();
          var styleValue = styleArray[1].trim();
          var _attrs2 = {};
          _attrs2[styleType] = styleValue;
          return {
            v: children.map(function (child) {
              return child ? (0,external_slate_hyperscript_namespaceObject.jsx)('text', _attrs2, typeof child === "string" || external_slate_namespaceObject.Text.isText(child) ? child : external_slate_namespaceObject.Node.string(child)) : {
                'text': ''
              };
            })
          };
        }
      };
      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
        var _ret = _loop();
        if (Editor_typeof(_ret) === "object") return _ret.v;
      }
    } catch (err) {
      _iterator2.e(err);
    } finally {
      _iterator2.f();
    }
  }
  return children;
};
var serialize = function serialize(content) {
  //serialize formatting to html
  if (content.text) {
    var tagStringObj = Object.keys(content).reduce(function (tagString, key) {
      if (content[key] == true) {
        var htmlTag = format_to_html_lookup[key];
        var preTag = tagString.preTags + "<" + htmlTag + ">";
        var postTag = "</" + htmlTag + ">" + tagString.postTags;
        return {
          preTags: preTag.toLowerCase(),
          postTags: postTag.toLowerCase()
        };
      } else if (special_styles_to_care_about.includes(key)) {
        var _preTag = tagString.preTags + "<span style=".concat(key, ":").concat(content[key], ">");
        var _postTag = "</span>" + tagString.postTags;
        return {
          preTags: _preTag.toLowerCase(),
          postTags: _postTag.toLowerCase()
        };
      }
      return {
        preTags: tagString.preTags,
        postTags: tagString.postTags
      };
    }, {
      preTags: "",
      postTags: ""
    });
    return "".concat(tagStringObj.preTags).concat(content.text.replace(/(\n)+/g, '<br>')).concat(tagStringObj.postTags);
  }
  if (content.type) {
    switch (content.type) {
      case 'link':
        {
          var linkHTML = content.children.reduce(function (acc, text) {
            return acc + serialize(text);
          }, "");
          return content.ref ? "<a href=\"".concat(content.url, "\" class=\"refLink\" data-ref=\"").concat(content.ref, "\">").concat(linkHTML, "</a>") : "<a href=\"".concat(content.url, "\">").concat(linkHTML, "</a>");
        }
      case 'paragraph':
        {
          var paragraphHTML = content.children.reduce(function (acc, text) {
            return acc + serialize(text);
          }, "");
          if (content["text-align"] == "center") {
            return "<div style='text-align: center'>".concat(paragraphHTML, "</div>");
          }
          return "<div>".concat(paragraphHTML, "</div>");
        }
      case 'list-item':
        {
          var liHtml = content.children.reduce(function (acc, text) {
            return acc + serialize(text);
          }, "");
          return "<li>".concat(liHtml, "</li>");
        }
      case 'numbered-list':
        {
          var olHtml = content.children.reduce(function (acc, text) {
            return acc + serialize(text);
          }, "");
          return "<ol>".concat(olHtml, "</ol>");
        }
      case 'bulleted-list':
        {
          var ulHtml = content.children.reduce(function (acc, text) {
            return acc + serialize(text);
          }, "");
          return "<ul>".concat(ulHtml, "</ul>");
        }
      case 'table':
        var tableHtml = content.children.reduce(function (acc, text) {
          return acc + serialize(text);
        }, "");
        return "<table><tbody>".concat(tableHtml, "</tbody></table>");
      case 'table-row':
        var trHtml = content.children.reduce(function (acc, text) {
          return acc + serialize(text);
        }, "");
        return "<tr>".concat(trHtml, "</tr>");
      case 'table-cell':
        var tdHtml = content.children.reduce(function (acc, text) {
          return acc + serialize(text);
        }, "");
        return "<td>".concat(tdHtml, "</td>");
      case 'horizontal-line':
        return "<hr>";
    }
  }
  var children = content.children ? content.children.map(serialize) : [];
  return children.join('');
};
var replaceDivineNames = function replaceDivineNames(str, divineName) {
  // Regexes for identifying divine names with or without nikkud / trop
  // Currently ignores אֵל & צְבָאוֹת & שדי
  var divineRE = /([\s.,\u05BE;:'"\-]|^)([ו]?[\u0591-\u05C7]*[משהוכלב]?[\u0591-\u05C7]*)(י[\u0591-\u05C7]*ה[\u0591-\u05C7]*ו[\u0591-\u05C7]*ה[\u0591-\u05C2\u05C4-\u05C7]*|יְיָ|יי|יקוק|ה\'|ה׳)(?=[/(/[<//.,;:׃'"\-\s]|$)/g;

  // don't match אֲדֹנִי
  var adoshemRE = /([\s.,\u05BE;:'"\-]|^)([ו]?[\u0591-\u05C7]*[משהוכלב]?[\u0591-\u05C7]*)(א[\u0591-\u05C7]*ד[\u0591-\u05C7]*נ[\u0591-\u05B3\u05B5-\u05C7]*י[\u0591-\u05B3\u05B5-\u05C2\u05C4-\u05C7]*|אדושם)(?=[<\[\(\s.,;:׃'"\-]|$)/g;

  // only allow segol or tzere nikkud, so doesn't match אֲלֵהֶ֖ם or the like
  var elokaiRE = /([\s.,\u05BE;:'"\-]|^)([ו]?[\u0591-\u05C7]*[משהוכלב]?[\u0591-\u05C7]*)(א[\u0591-\u05AF\u05B1\u05B5\u05B6\u05BC-\u05C7]*ל[\u0591-\u05C7]*ו?[\u0591-\u05C7]*)([הק])([\u0591-\u05C7]*)((י[\u0591-\u05C2\u05C4-\u05C7]*)?[ךיוהםן][\u0591-\u05C2\u05C4-\u05C7]*|(י[\u0591-\u05C7]*)?נ[\u0591-\u05C7]*ו[\u0591-\u05C7]*|(י[\u0591-\u05C7]*)?כ[[\u0591-\u05C2\u05C4-\u05C7]*[םן])(?=[\s<\[\(.,;׃:'"\-]|$)/g;
  var elokaRE = /([\s.,\u05BE;:'"\-]|^)([ו]?[\u0591-\u05C7]*[משהוכלב]?[\u0591-\u05C7]*)(א[\u0591-\u05AF\u05B1\u05B5\u05B6\u05BC-\u05C7]*ל[\u0591-\u05C7]*ו[\u0591-\u05C7]*)([הק])([\u0591-\u05C2\u05C4-\u05C7]*)(?=[)(?=[\s<\[\(.,;:׃'"\-]|$)/g;

  // const shadaiRE  = /([\s.,\u05BE;:'"\-]|^)([משהוכלב]?[\u0591-\u05C7]*)(ש[\u0591-\u05C7]*[דק][\u0591-\u05C7]*י[\u0591-\u05C7]*)(?=[\s.,;׃:'"\-]|$)/g;

  var divineSubs = {
    "noSub": "יהוה",
    "yy": "יי",
    "ykvk": "יקוק",
    "h": "ה׳"
  };
  var adoshemSub = divineName == "noSub" ? "אדני" : "אדושם";
  var elokaiSub = divineName == "noSub" ? "ה" : "ק";
  var newStr = str.replace(divineRE, "$1$2" + divineSubs[divineName]).replace(adoshemRE, "$1$2" + adoshemSub).replace(elokaiRE, "$1$2$3" + elokaiSub + "$5$6").replace(elokaRE, "$1$2$3" + elokaiSub + "$5");
  return newStr;
};
function renderSheetItem(source) {
  var sheetItemType = Object.keys(sheet_item_els).filter(function (key) {
    return Object.keys(source).includes(key);
  })[0];
  switch (sheetItemType) {
    case 'ref':
      {
        var content = {
          type: sheet_item_els[sheetItemType],
          ref: source.ref,
          heRef: source.heRef,
          title: source.title || null,
          node: source.node,
          heText: parseSheetItemHTML(source.text.he),
          enText: parseSheetItemHTML(source.text.en),
          options: source.options,
          children: [{
            text: ""
          }]
        };
        return content;
      }
    case 'comment':
      {
        var commentLang = sefaria.hebrew.isHebrew(source.comment) ? 'he' : 'en';
        var _content = {
          type: sheet_item_els[sheetItemType],
          options: source.options,
          children: parseSheetItemHTML(source.comment),
          node: source.node,
          lang: commentLang
        };
        return _content;
      }
    case 'outsideText':
      {
        var lang = sefaria.hebrew.isHebrew(source.outsideText) ? 'he' : 'en';
        var _content2 = {
          type: sheet_item_els[sheetItemType],
          options: source.options,
          children: parseSheetItemHTML(source.outsideText),
          node: source.node,
          lang: lang
        };
        return _content2;
      }
    case 'outsideBiText':
      {
        var _content3 = {
          type: sheet_item_els[sheetItemType],
          heText: parseSheetItemHTML(source.outsideBiText.he),
          enText: parseSheetItemHTML(source.outsideBiText.en),
          options: source.options,
          children: [{
            text: ""
          }],
          node: source.node
        };
        return _content3;
      }
    case 'media':
      {
        var _content4 = {
          type: sheet_item_els[sheetItemType],
          mediaUrl: source.media,
          node: source.node,
          options: source.options,
          children: [{
            text: source.media
          }]
        };
        return _content4;
      }
    default:
      {
        console.log(source);
        return {
          text: ""
        };
      }
  }
}
function parseSheetItemHTML(rawhtml) {
  var preparseHtml = rawhtml.replace(/\u00A0/g, ' ').replace(/(\r\n|\n|\r|\t)/gm, "");
  var parsed = new DOMParser().parseFromString(preparseHtml, 'text/html');
  var fragment = deserialize(parsed.body);
  var slateJSON = fragment.length > 0 ? fragment : [{
    text: ''
  }];
  return slateJSON[0].type === 'paragraph' ? slateJSON : [{
    type: 'paragraph',
    children: slateJSON
  }];
}
var defaultSheetTitle = function defaultSheetTitle(title) {
  return {
    type: 'SheetTitle',
    title: title ? title : "",
    children: [{
      text: title ? title : ""
    }]
  };
};
var defaultEmptyOutsideText = function defaultEmptyOutsideText(sheetNodeNumber, textFragment) {
  return {
    type: "SheetOutsideText",
    node: sheetNodeNumber,
    children: [{
      type: "paragraph",
      children: [{
        text: textFragment
      }]
    }]
  };
};
function transformSheetJsonToSlate(sheet) {
  var sheetTitle = sheet.title.stripHtmlConvertLineBreaks();
  var curNextNode = sheet.nextNode;
  var sourceNodes = [];
  sheet.sources.forEach(function (source, i) {
    // this snippet of code exists to create placeholder spacers in between elements to allow for easier editing
    // and to preserve spacing.
    //
    // A spacer is added:
    // 1. If the source is not the first source and it's not an outside text or adjacent to an outside text, and
    // 2. In between outside texts.

    // needed for now b/c headers are saved as OutsideTexts for backwards compatability w/ old sheets
    var sourceIsHeader = source["outsideText"] && source["outsideText"].startsWith("<h1>");
    var prevSourceIsHeader = i > 0 && sheet.sources[i - 1]["outsideText"] && sheet.sources[i - 1]["outsideText"].startsWith("<h1>");
    var isCurrentSourceAnOutsideText = !!source["outsideText"];
    var isPrevSourceAnOutsideText = !!(i > 0 && sheet.sources[i - 1]["outsideText"]);
    if (!(isPrevSourceAnOutsideText || isCurrentSourceAnOutsideText) || isPrevSourceAnOutsideText && isCurrentSourceAnOutsideText && !sourceIsHeader && !prevSourceIsHeader) {
      sourceNodes.push({
        type: "spacer",
        children: [{
          text: ""
        }]
      });
    }

    //-------//

    sourceNodes.push(renderSheetItem(source));
  });

  // Ensure there's always something to edit at bottom of sheet.
  if (sourceNodes.length == 0 || sourceNodes[sourceNodes.length - 1]["children"] && sourceNodes[sourceNodes.length - 1]["children"][0]["type"] != "SheetOutsideText") {
    sourceNodes.push({
      type: "spacer",
      children: [{
        text: ""
      }]
    });
  }
  var initValue = [{
    type: 'Sheet',
    status: sheet.status,
    views: sheet.views,
    tags: sheet.tags || [],
    includedRefs: sheet.includedRefs,
    owner: sheet.owner,
    summary: sheet.summary || "",
    id: sheet.id,
    dateModified: sheet.dateModified,
    datePublished: sheet.datePublished,
    dateCreated: sheet.dateCreated,
    promptedToPublish: sheet.promptedToPublish,
    options: sheet.options,
    nextNode: curNextNode,
    authorUrl: sheet.ownerProfileUrl,
    authorStatement: sheet.ownerName,
    authorImage: sheet.ownerImageUrl,
    title: sheet.title,
    displayedCollection: sheet.displayedCollection || "",
    collectionName: sheet.collectionName || "",
    collectionImage: sheet.collectionImage || "",
    likes: sheet.likes || [],
    children: [{
      type: 'SheetContent',
      children: sourceNodes
    }]
  }];
  return initValue;
}
function isSourceEditable(e, editor) {
  if (editor.edittingSource) {
    return true;
  }
  var isEditable = external_slate_namespaceObject.Range.isRange(editor.selection) && !external_slate_namespaceObject.Range.isCollapsed(editor.selection);
  editor.edittingSource = isEditable;
  return isEditable;
}
var BoxedSheetElement = function BoxedSheetElement(_ref2) {
  var attributes = _ref2.attributes,
    children = _ref2.children,
    element = _ref2.element,
    divineName = _ref2.divineName;
  var parentEditor = (0,external_slate_react_namespaceObject.useSlate)();
  var sheetSourceEnEditor = (0,external_react_.useMemo)(function () {
    return withLinks((0,external_slate_history_namespaceObject.withHistory)((0,external_slate_react_namespaceObject.withReact)((0,external_slate_namespaceObject.createEditor)())));
  }, []);
  var sheetSourceHeEditor = (0,external_react_.useMemo)(function () {
    return withLinks((0,external_slate_history_namespaceObject.withHistory)((0,external_slate_react_namespaceObject.withReact)((0,external_slate_namespaceObject.createEditor)())));
  }, []);
  var _useState = (0,external_react_.useState)(element.enText),
    _useState2 = Editor_slicedToArray(_useState, 2),
    sheetEnSourceValue = _useState2[0],
    sheetEnSourceSetValue = _useState2[1];
  var _useState3 = (0,external_react_.useState)(element.heText),
    _useState4 = Editor_slicedToArray(_useState3, 2),
    sheetHeSourceValue = _useState4[0],
    sheetHeSourceSetValue = _useState4[1];
  var _useState5 = (0,external_react_.useState)(false),
    _useState6 = Editor_slicedToArray(_useState5, 2),
    unsavedChanges = _useState6[0],
    setUnsavedChanges = _useState6[1];
  var _useState7 = (0,external_react_.useState)(false),
    _useState8 = Editor_slicedToArray(_useState7, 2),
    sourceActive = _useState8[0],
    setSourceActive = _useState8[1];
  var _useState9 = (0,external_react_.useState)(null),
    _useState10 = Editor_slicedToArray(_useState9, 2),
    activeSourceLangContent = _useState10[0],
    setActiveSourceLangContent = _useState10[1];
  var _useState11 = (0,external_react_.useState)(false),
    _useState12 = Editor_slicedToArray(_useState11, 2),
    isDragging = _useState12[0],
    setIsDragging = _useState12[1];
  var _useState13 = (0,external_react_.useState)(false),
    _useState14 = Editor_slicedToArray(_useState13, 2),
    canUseDOM = _useState14[0],
    setCanUseDOM = _useState14[1];
  var selected = (0,external_slate_react_namespaceObject.useSelected)();
  var focused = (0,external_slate_react_namespaceObject.useFocused)();
  var cancelEvent = function cancelEvent(event) {
    return event.preventDefault();
  };
  (0,external_react_.useEffect)(function () {
    var replacement = divineName || "noSub";
    var editors = [sheetSourceHeEditor, sheetSourceEnEditor];
    for (var _i2 = 0, _editors = editors; _i2 < _editors.length; _i2++) {
      var editor = _editors[_i2];
      var nodes = external_slate_namespaceObject.Editor.nodes(editor, {
        at: [],
        match: external_slate_namespaceObject.Text.isText
      });
      var _iterator3 = Editor_createForOfIteratorHelper(nodes),
        _step3;
      try {
        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
          var _ref3 = _step3.value;
          var _ref4 = Editor_slicedToArray(_ref3, 2);
          var node = _ref4[0];
          var path = _ref4[1];
          if (node.text) {
            var newStr = replaceDivineNames(node.text, replacement);
            if (newStr != node.text) {
              external_slate_namespaceObject.Transforms.insertText(editor, newStr, {
                at: path
              });
            }
          }
        }
      } catch (err) {
        _iterator3.e(err);
      } finally {
        _iterator3.f();
      }
    }
  }, [divineName]);
  var onHeChange = function onHeChange(value) {
    sheetHeSourceSetValue(value);
  };
  var onEnChange = function onEnChange(value) {
    sheetEnSourceSetValue(value);
  };
  (0,external_react_.useEffect)(function () {
    external_slate_namespaceObject.Transforms.setNodes(parentEditor, {
      heText: sheetHeSourceValue,
      enText: sheetEnSourceValue
    }, {
      at: external_slate_react_namespaceObject.ReactEditor.findPath(parentEditor, element)
    });
  }, [sourceActive]);
  (0,external_react_.useEffect)(function () {
    if (!selected) {
      setSourceActive(false);
      setActiveSourceLangContent(null);
    }
  }, [selected]);
  (0,external_react_.useEffect)(function () {
    setCanUseDOM(true);
  }, []);
  var _onMouseDown = function onMouseDown(e) {
    //Slate tries to auto position the cursor, but on long boxed sources this leads to jumping. This hack should fix it.
    var elementTop = e.currentTarget.offsetTop;
    var divTop = document.querySelector(".sheetsInPanel").offsetTop;
    var elementRelativeTop = elementTop - divTop;
    var rect = e.currentTarget.getBoundingClientRect();
    var clickOffset = e.clientY - rect.top;
    e.currentTarget.querySelector(".boxedSourceChildren").style.top = "".concat(elementRelativeTop + clickOffset, "px");
  };
  var suppressParentContentEditable = function suppressParentContentEditable(toggle) {
    // Chrome treats nested contenteditables as one giant editor so keyboard shortcuts like `Control + A` or `Alt + Up`
    // Don't work as expected -- this hack fixes that
    document.querySelector('[role="textbox"]').setAttribute("contenteditable", toggle);
  };
  var _onClick = function onClick(e) {
    if (e.target.closest('.he') && sourceActive) {
      setActiveSourceLangContent('he');
      if (window.chrome) {
        suppressParentContentEditable(false);
      }
    } else if (e.target.closest('.en') && sourceActive) {
      setActiveSourceLangContent('en');
      if (window.chrome) {
        suppressParentContentEditable(false);
      }
    } else {
      setActiveSourceLangContent(null);
      if (window.chrome) {
        suppressParentContentEditable(true);
      }
    }
    setSourceActive(true);
  };
  var _onBlur = function onBlur(e) {
    if (window.chrome) {
      suppressParentContentEditable(true);
    }
    setSourceActive(false);
    setActiveSourceLangContent(null);
  };
  var _onKeyDown = function onKeyDown(event, editor) {
    for (var hotkey in HOTKEYS) {
      if (external_is_hotkey_default()(hotkey, event)) {
        event.preventDefault();
        var format = HOTKEYS[hotkey];
        console.log(format);
        toggleFormat(editor, format);
      }
    }
  };
  var isActive = selected;
  var sheetItemClasses = {
    sheetItem: 1,
    highlight: parentEditor.highlightedNode === (element.node ? element.node.toString() : null)
  };
  var classes = {
    SheetSource: element.ref ? 1 : 0,
    SheetOutsideBiText: element.ref ? 0 : 1,
    segment: 1,
    selected: isActive
  };
  var heClasses = {
    he: 1,
    selected: isActive,
    editable: activeSourceLangContent == "he" ? true : false
  };
  var enClasses = {
    en: 1,
    selected: isActive,
    editable: activeSourceLangContent == "en" ? true : false
  };
  var dragStart = function dragStart(e) {
    var slateRange = external_slate_react_namespaceObject.ReactEditor.findEventRange(parentEditor, e);
    parentEditor.dragging = true;
    var fragment = external_slate_namespaceObject.Node.fragment(parentEditor, slateRange);
    external_slate_react_namespaceObject.ReactEditor.deselect(parentEditor);
    var string = JSON.stringify(fragment);
    var encoded = window.btoa(encodeURIComponent(string));
    e.dataTransfer.setData('application/x-slate-fragment', encoded);
    e.dataTransfer.setData('text/html', e.target.innerHTML);
    e.dataTransfer.setData('text/plain', e.target.text);
    e.dataTransfer.effectAllowed = 'move';
    var dragIcon = document.createElement('div');
    dragIcon.classList.add("dragIcon");
    dragIcon.classList.add("serif");
    dragIcon.style.borderInlineStartColor = sefaria.palette.refColor(element.ref);
    dragIcon.innerHTML = sefaria.interfaceLang === "hebrew" ? element.heRef : element.ref;
    document.body.appendChild(dragIcon);
    e.dataTransfer.setDragImage(dragIcon, 0, 15);
    external_slate_react_namespaceObject.ReactEditor.setFragmentData(parentEditor, e.dataTransfer, "drag");
    setIsDragging(true);
  };
  var dragEnd = function dragEnd(e) {
    setIsDragging(false);
  };
  var dragOver = function dragOver(e) {
    if (parentEditor.dragging) {
      e.preventDefault();
      e.dataTransfer.dropEffect = "move";
    }
  };
  var drop = function drop(e) {
    e.preventDefault();
    e.stopPropagation();
    parentEditor.dragging = false;
  };
  return /*#__PURE__*/external_react_default().createElement("div", Editor_extends({
    draggable: true,
    className: isDragging ? "boxedSheetItem dragged" : "boxedSheetItem",
    onMouseDown: function onMouseDown(e) {
      return _onMouseDown(e);
    },
    onDragStart: function onDragStart(e) {
      dragStart(e);
    },
    onDragEnd: function onDragEnd(e) {
      dragEnd(e);
    },
    onDragEnter: function onDragEnter(e) {
      e.preventDefault();
    },
    onDragOver: function onDragOver(e) {
      dragOver(e);
    },
    onDrop: function onDrop(e) {
      drop(e);
    }
  }, attributes), /*#__PURE__*/external_react_default().createElement("div", {
    className: external_classnames_default()(sheetItemClasses),
    "data-sheet-node": element.node,
    "data-sefaria-ref": element.ref,
    style: {
      pointerEvents: isActive ? 'none' : 'auto'
    }
  }, /*#__PURE__*/external_react_default().createElement("div", {
    contentEditable: false,
    onBlur: function onBlur(e) {
      return _onBlur(e);
    },
    onClick: function onClick(e) {
      return _onClick(e);
    },
    className: external_classnames_default()(classes),
    style: {
      "borderInlineStartColor": sefaria.palette.refColor(element.ref)
    }
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: external_classnames_default()(heClasses),
    style: {
      pointerEvents: isActive ? 'auto' : 'none'
    }
  }, element.heRef ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "ref",
    contentEditable: false
  }, /*#__PURE__*/external_react_default().createElement("a", {
    style: {
      userSelect: 'none',
      pointerEvents: 'auto'
    },
    href: "/".concat(element.ref)
  }, element.heRef)) : null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sourceContentText"
  }, /*#__PURE__*/external_react_default().createElement(external_slate_react_namespaceObject.Slate, {
    editor: sheetSourceHeEditor,
    value: sheetHeSourceValue,
    onChange: function onChange(value) {
      return onHeChange(value);
    }
  }, canUseDOM ? /*#__PURE__*/external_react_default().createElement(HoverMenu, {
    buttons: "basic"
  }) : null, /*#__PURE__*/external_react_default().createElement(external_slate_react_namespaceObject.Editable, {
    readOnly: !sourceActive,
    renderLeaf: function renderLeaf(props) {
      return /*#__PURE__*/external_react_default().createElement(Leaf, props);
    },
    onKeyDown: function onKeyDown(e) {
      return _onKeyDown(e, sheetSourceHeEditor);
    }
  })))), /*#__PURE__*/external_react_default().createElement("div", {
    className: external_classnames_default()(enClasses),
    style: {
      pointerEvents: isActive ? 'auto' : 'none'
    }
  }, element.ref ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "ref",
    contentEditable: false
  }, /*#__PURE__*/external_react_default().createElement("a", {
    style: {
      userSelect: 'none',
      pointerEvents: 'auto'
    },
    href: "/".concat(element.ref)
  }, element.ref)) : null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sourceContentText"
  }, /*#__PURE__*/external_react_default().createElement(external_slate_react_namespaceObject.Slate, {
    editor: sheetSourceEnEditor,
    value: sheetEnSourceValue,
    onChange: function onChange(value) {
      return onEnChange(value);
    }
  }, canUseDOM ? /*#__PURE__*/external_react_default().createElement(HoverMenu, {
    buttons: "basic"
  }) : null, /*#__PURE__*/external_react_default().createElement(external_slate_react_namespaceObject.Editable, {
    readOnly: !sourceActive,
    renderLeaf: function renderLeaf(props) {
      return /*#__PURE__*/external_react_default().createElement(Leaf, props);
    },
    onKeyDown: function onKeyDown(e) {
      return _onKeyDown(e, sheetSourceEnEditor);
    }
  }))))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "clearFix"
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "boxedSourceChildren"
  }, children));
};
var AddInterfaceInput = function AddInterfaceInput(_ref5) {
  var inputType = _ref5.inputType,
    resetInterface = _ref5.resetInterface;
  var editor = (0,external_slate_react_namespaceObject.useSlate)();
  var _useState15 = (0,external_react_.useState)(""),
    _useState16 = Editor_slicedToArray(_useState15, 2),
    inputValue = _useState16[0],
    setInputValue = _useState16[1];
  var _useState17 = (0,external_react_.useState)(false),
    _useState18 = Editor_slicedToArray(_useState17, 2),
    showAddMediaButton = _useState18[0],
    setShowAddMediaButton = _useState18[1];
  var isMediaLink = function isMediaLink(url) {
    console.log(url);
    if (url.match(/^https?/i) == null) {
      return null;
    }
    var youtube_re = /https?:\/\/(www\.)?(youtu(?:\.be|be\.com)\/(?:.*v(?:\/|=)|(?:.*\/)?)([\w'-]+))/i;
    var vimeo_re = /^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/)|(video\/))?([0-9]+)/;
    var m;
    if ((m = youtube_re.exec(url)) !== null) {
      if (m.index === youtube_re.lastIndex) {
        youtube_re.lastIndex++;
      }
      if (m.length > 0) {
        return "https://www.youtube.com/embed/" + m[m.length - 1] + "?rel=0&amp;showinfo=0";
      }
    } else if ((m = vimeo_re.exec(url)) !== null) {
      if (m.index === vimeo_re.lastIndex) {
        vimeo_re.lastIndex++;
      }
      if (m.length > 0) {
        return "https://player.vimeo.com/video/" + m[6];
      }
    } else if (url.match(/^https?:\/\/(www\.)?.+\.(jpeg|jpg|gif|png)$/i) != null) {
      return url;
    } else if (url.match(/^https?:\/\/(www\.)?.+\.(mp3)$/i) != null) {
      return url;
    } else if (url.match(/^https?:\/\/(www\.|m\.)?soundcloud\.com\/[\w\-\.]+\/[\w\-\.]+\/?/i) != null) {
      return 'https://w.soundcloud.com/player/?url=' + url + '&amp;color=ff5500&amp;auto_play=false&amp;hide_related=true&amp;show_comments=false&amp;show_user=true&amp;show_reposts=false';
    } else if ((m = /^https?:\/\/open\.spotify\.com\/(?:embed\/)?(\w+)\/(\w+)\/?/i.exec(url)) != null) {
      return "https://open.spotify.com/embed/".concat(m[1], "/").concat(m[2]);
    } else if ((m = /^https?:\/\/bandcamp.com\/EmbeddedPlayer(\/\w+\=\w+)+(\/)?/i.exec(url)) != null) {
      if (!url.includes("artwork=small")) {
        // force small artwork because height calculation for large artwork depends on width
        return m[2] ? url + "artwork=small" : url + "/artwork=small";
      } else {
        return url;
      }
    } else {
      return false;
    }
  };
  var onMediaChange = function onMediaChange(e) {
    var newValue = e.target.value;
    setInputValue(newValue);
    setShowAddMediaButton(isMediaLink(newValue));
  };
  var addMedia = function addMedia() {
    var fragment = {
      type: "SheetMedia",
      mediaUrl: isMediaLink(inputValue),
      node: editor.children[0].nextNode,
      children: [{
        text: ""
      }]
    };
    incrementNextSheetNode(editor);
    external_slate_namespaceObject.Transforms.insertNodes(editor, fragment);
    external_slate_namespaceObject.Editor.normalize(editor, {
      force: true
    });
    external_slate_namespaceObject.Transforms.move(editor);
  };
  var getSuggestions = /*#__PURE__*/function () {
    var _ref6 = Editor_asyncToGenerator( /*#__PURE__*/Editor_regeneratorRuntime().mark(function _callee(input) {
      var results, d;
      return Editor_regeneratorRuntime().wrap(function _callee$(_context) {
        while (1) switch (_context.prev = _context.next) {
          case 0:
            results = {
              "previewText": null,
              "helperPromptText": null,
              "currentSuggestions": null,
              "showAddButton": false
            };
            setInputValue(input);
            if (!(input === "")) {
              _context.next = 4;
              break;
            }
            return _context.abrupt("return", results);
          case 4:
            _context.next = 6;
            return sefaria.getName(input, true, 5);
          case 6:
            d = _context.sent;
            if (!(d.is_section || d.is_segment)) {
              _context.next = 15;
              break;
            }
            results.helperPromptText = null;
            results.currentSuggestions = null;
            results.previewText = input;
            results.showAddButton = true;
            return _context.abrupt("return", results);
          case 15:
            results.showAddButton = false;
            results.previewText = null;
          case 17:
            //We want to show address completions when book exists but not once we start typing further
            if (d.is_book && isNaN(input.trim().slice(-1)) && !!(d !== null && d !== void 0 && d.addressExamples)) {
              results.helperPromptText = /*#__PURE__*/external_react_default().createElement(InterfaceText, {
                text: {
                  en: d.addressExamples[0],
                  he: d.heAddressExamples[0]
                }
              });
            } else {
              results.helperPromptText = null;
            }
            results.currentSuggestions = d.completion_objects.map(function (suggestion) {
              return {
                name: suggestion.title,
                key: suggestion.key,
                border_color: sefaria.palette.refColor(suggestion.key)
              };
            });
            return _context.abrupt("return", results);
          case 20:
          case "end":
            return _context.stop();
        }
      }, _callee);
    }));
    return function getSuggestions(_x2) {
      return _ref6.apply(this, arguments);
    };
  }();
  var selectedCallback = function selectedCallback() {
    insertSource(editor, inputValue);
  };
  if (inputType == "media") {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "addInterfaceInput mediaInput",
      title: "We can process YouTube and SoundCloud links, and hosted mp3's and images",
      onClick: function onClick(e) {
        e.stopPropagation();
      }
    }, /*#__PURE__*/external_react_default().createElement("input", {
      type: "text",
      placeholder: sefaria._("Paste a link to an image, video, or audio"),
      className: "serif",
      onClick: function onClick(e) {
        e.stopPropagation();
      },
      onChange: function onChange(e) {
        return onMediaChange(e);
      },
      value: inputValue,
      size: 100
    }), showAddMediaButton ? /*#__PURE__*/external_react_default().createElement("button", {
      className: "button small",
      onClick: function onClick(e) {
        addMedia();
      }
    }, "Add Media") : null);
  } else if (inputType === "source") {
    return /*#__PURE__*/external_react_default().createElement(Autocompleter, {
      selectedCallback: selectedCallback,
      getSuggestions: getSuggestions,
      inputValue: inputValue,
      changeInputValue: setInputValue,
      inputPlaceholder: "Search for a Text or Commentator.",
      buttonTitle: "Add Source",
      autocompleteClassNames: "addInterfaceInput",
      showSuggestionsOnSelect: true
    });
  } else {
    return null;
  }
};
var AddInterface = function AddInterface(_ref7) {
  var attributes = _ref7.attributes,
    children = _ref7.children,
    element = _ref7.element;
  var editor = (0,external_slate_react_namespaceObject.useSlate)();
  var _useState19 = (0,external_react_.useState)(false),
    _useState20 = Editor_slicedToArray(_useState19, 2),
    active = _useState20[0],
    setActive = _useState20[1];
  var _useState21 = (0,external_react_.useState)(null),
    _useState22 = Editor_slicedToArray(_useState21, 2),
    itemToAdd = _useState22[0],
    setItemToAdd = _useState22[1];
  var resetInterface = function resetInterface() {
    setActive(false);
    setItemToAdd(null);
  };
  var toggleEditorAddInterface = function toggleEditorAddInterface(e) {
    setActive(!active);
    setItemToAdd(null);
  };
  var addInterfaceClasses = {
    active: active,
    editorAddInterface: 1
  };
  var addSourceClicked = function addSourceClicked(e) {
    e.stopPropagation();
    setItemToAdd('source');
    // Timeout required b/c it takes a moment for react to rerender before focusing on the new input
    setTimeout(function () {
      document.querySelector(".addInterfaceInput input").focus();
    }, 100);
  };
  var addMediaClicked = function addMediaClicked(e) {
    e.stopPropagation();
    setItemToAdd("media");
    // Timeout required b/c it takes a moment for react to rerender before focusing on the new input
    setTimeout(function () {
      document.querySelector(".addInterfaceInput input").focus();
    }, 100);
  };
  var addImageClicked = function addImageClicked(e) {
    e.stopPropagation();
    setItemToAdd(null);
    setActive(!active);
  };
  var fileInput = (0,external_react_.useRef)(null);
  var uploadImage = function uploadImage(imageData) {
    var formData = new FormData();
    formData.append('file', imageData.replace(/data:image\/(jpe?g|png|gif);base64,/, ""));
    // formData.append('file', imageData);

    sefariaJquery.ajax({
      url: sefaria.apiHost + "/api/sheets/upload-image",
      type: 'POST',
      data: formData,
      contentType: false,
      processData: false,
      success: function success(data) {
        console.log(data.url);
        insertMedia(editor, data.url);
      },
      error: function error(e) {
        console.log("photo upload ERROR", e);
      }
    });
  };
  var onFileSelect = function onFileSelect(e) {
    var file = fileInput.current.files[0];
    if (file == null) return;
    if (/\.(jpe?g|png|gif)$/i.test(file.name)) {
      var reader = new FileReader();
      reader.addEventListener("load", function () {
        uploadImage(reader.result);
      }, false);
      reader.addEventListener("onerror", function () {
        alert(reader.error);
      }, false);
      reader.readAsDataURL(file);
    } else {
      alert('not an image');
    }
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    role: "button",
    title: active ? "Close menu" : "Add a source, image, or other media",
    contentEditable: !active,
    suppressContentEditableWarning: true,
    "aria-label": active ? "Close menu" : "Add a source, image, or other media",
    className: external_classnames_default()(addInterfaceClasses),
    onClick: function onClick(e) {
      return toggleEditorAddInterface(e);
    }
  }, itemToAdd == null ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("div", {
    role: "button",
    title: sefaria._("Add a source"),
    "aria-label": "Add a source",
    className: "editorAddInterfaceButton",
    contentEditable: false,
    onClick: function onClick(e) {
      return addSourceClicked(e);
    },
    id: "addSourceButton"
  }), /*#__PURE__*/external_react_default().createElement("div", {
    role: "button",
    title: sefaria._("Add an image"),
    "aria-label": "Add an image",
    className: "editorAddInterfaceButton",
    contentEditable: false,
    onClick: function onClick(e) {
      return addImageClicked(e);
    },
    id: "addImageButton"
  }, /*#__PURE__*/external_react_default().createElement("label", {
    htmlFor: "addImageFileSelector",
    id: "addImageFileSelectorLabel"
  })), /*#__PURE__*/external_react_default().createElement("input", {
    id: "addImageFileSelector",
    type: "file",
    style: {
      display: "none"
    },
    onChange: onFileSelect,
    ref: fileInput
  }), /*#__PURE__*/external_react_default().createElement("div", {
    role: "button",
    title: sefaria._("Add media"),
    "aria-label": "Add media",
    className: "editorAddInterfaceButton",
    contentEditable: false,
    onClick: function onClick(e) {
      return addMediaClicked(e);
    },
    id: "addMediaButton"
  })) : /*#__PURE__*/external_react_default().createElement(AddInterfaceInput, {
    inputType: itemToAdd,
    resetInterface: resetInterface
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "cursorHolder",
    contentEditable: true,
    suppressContentEditableWarning: true
  }, children));
};
var Element = function Element(props) {
  var attributes = props.attributes,
    children = props.children,
    element = props.element;
  var sheetItemClasses = {
    sheetItem: 1,
    empty: !external_slate_namespaceObject.Node.string(element),
    highlight: (0,external_slate_react_namespaceObject.useSlate)().highlightedNode === (element.node ? element.node.toString() : null)
  };
  switch (element.type) {
    case 'spacer':
      var spacerSelected = (0,external_slate_react_namespaceObject.useSelected)();
      var spacerClasses = {
        spacerSelected: spacerSelected,
        spacer: 1,
        empty: 1
      };
      return /*#__PURE__*/external_react_default().createElement("div", Editor_extends({
        className: external_classnames_default()(spacerClasses)
      }, attributes), spacerSelected && document.getSelection().isCollapsed ? /*#__PURE__*/external_react_default().createElement(AddInterface, props) : /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, children));
    case 'SheetSource':
      return /*#__PURE__*/external_react_default().createElement(BoxedSheetElement, Editor_extends({}, props, {
        divineName: (0,external_slate_react_namespaceObject.useSlate)().divineNames
      }));
    case 'SheetOutsideBiText':
      return /*#__PURE__*/external_react_default().createElement(BoxedSheetElement, Editor_extends({}, props, attributes, {
        divineName: (0,external_slate_react_namespaceObject.useSlate)().divineNames
      }));
    case 'SheetComment':
      return /*#__PURE__*/external_react_default().createElement("div", Editor_extends({
        className: external_classnames_default()(sheetItemClasses)
      }, attributes, {
        "data-sheet-node": element.node
      }), /*#__PURE__*/external_react_default().createElement("div", Editor_extends({
        className: "SheetComment segment"
      }, attributes), children), /*#__PURE__*/external_react_default().createElement("div", {
        className: "clearFix"
      }));
    case 'SheetOutsideText':
      var SheetOutsideTextClasses = "SheetOutsideText segment ".concat(element.lang);
      return /*#__PURE__*/external_react_default().createElement("div", Editor_extends({
        className: external_classnames_default()(sheetItemClasses)
      }, attributes, {
        "data-sheet-node": element.node
      }), /*#__PURE__*/external_react_default().createElement("div", Editor_extends({
        className: SheetOutsideTextClasses
      }, attributes), children), /*#__PURE__*/external_react_default().createElement("div", {
        className: "clearFix"
      }));
    case 'SheetMedia':
      var mediaComponent;
      var vimeoRe = /^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/)|(video\/))?([0-9]+)/;
      if (element.mediaUrl.match(/\.(jpeg|jpg|gif|png)$/i) != null) {
        mediaComponent = /*#__PURE__*/external_react_default().createElement("div", {
          className: "SheetMedia media"
        }, /*#__PURE__*/external_react_default().createElement("img", {
          className: "addedMedia",
          src: element.mediaUrl
        }), children);
      } else if (element.mediaUrl.match(/https?:\/\/www\.youtube\.com\/embed\/.+?rel=0(&amp;|&)showinfo=0$/i) != null) {
        mediaComponent = /*#__PURE__*/external_react_default().createElement("div", {
          className: "media fullWidth SheetMedia"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "youTubeContainer"
        }, /*#__PURE__*/external_react_default().createElement("iframe", {
          width: "100%",
          height: "100%",
          src: element.mediaUrl,
          frameBorder: "0",
          allowFullScreen: true
        }), children));
      } else if (vimeoRe.exec(element.mediaUrl) !== null) {
        mediaComponent = /*#__PURE__*/external_react_default().createElement("div", {
          className: "SheetMedia media fullWidth"
        }, /*#__PURE__*/external_react_default().createElement("iframe", {
          width: "100%",
          height: "315",
          src: element.mediaUrl,
          frameborder: "0",
          allow: "autoplay; fullscreen",
          allowfullscreen: true
        }, children));
      } else if (element.mediaUrl.match(/^https?:\/\/open\.spotify\.com\/embed\/\w+\/\w+/i) != null) {
        mediaComponent = /*#__PURE__*/external_react_default().createElement("div", {
          className: "SheetMedia media fullWidth"
        }, /*#__PURE__*/external_react_default().createElement("iframe", {
          width: "100%",
          height: "380",
          scrolling: "no",
          frameBorder: "no",
          src: element.mediaUrl
        }), children);
      } else if (element.mediaUrl.match(/https?:\/\/w\.soundcloud\.com\/player\/\?url=.*/i) != null) {
        mediaComponent = /*#__PURE__*/external_react_default().createElement("div", {
          className: "SheetMedia media fullWidth"
        }, /*#__PURE__*/external_react_default().createElement("iframe", {
          style: {
            border: '0',
            width: '100%',
            height: '120px'
          },
          scrolling: "no",
          frameBorder: "no",
          src: element.mediaUrl
        }), children);
      } else if (element.mediaUrl.match(/^https?:\/\/bandcamp.com\/EmbeddedPlayer(\/\w+\=\w+)+\/?/i)) {
        mediaComponent = /*#__PURE__*/external_react_default().createElement("div", {
          className: "SheetMedia media fullWidth"
        }, /*#__PURE__*/external_react_default().createElement("iframe", {
          width: "100%",
          height: "120",
          scrolling: "no",
          frameBorder: "no",
          src: element.mediaUrl
        }), children);
      } else if (element.mediaUrl.match(/\.(mp3)$/i) != null) {
        mediaComponent = /*#__PURE__*/external_react_default().createElement("div", {
          className: "SheetMedia media fullWidth"
        }, /*#__PURE__*/external_react_default().createElement("audio", {
          src: element.mediaUrl,
          type: "audio/mpeg",
          controls: true
        }, "Your browser does not support the audio element."), children);
      } else {
        mediaComponent = /*#__PURE__*/external_react_default().createElement("div", {
          className: "SheetMedia media fullWidth"
        }, children);
      }
      return /*#__PURE__*/external_react_default().createElement("div", Editor_extends({
        className: external_classnames_default()(sheetItemClasses)
      }, attributes, {
        "data-sheet-node": element.node
      }), mediaComponent, /*#__PURE__*/external_react_default().createElement("div", {
        className: "clearFix"
      }));
    case 'he':
      var heSelected = (0,external_slate_react_namespaceObject.useSelected)();
      var heEditable = (0,external_slate_react_namespaceObject.useSlate)().edittingSource;
      var heClasses = {
        he: 1,
        editable: heEditable,
        selected: heSelected
      };
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: external_classnames_default()(heClasses)
      }, children);
    case 'en':
      var enSelected = (0,external_slate_react_namespaceObject.useSelected)();
      var enEditable = (0,external_slate_react_namespaceObject.useSlate)().edittingSource;
      var enClasses = {
        en: 1,
        editable: enEditable,
        selected: enSelected
      };
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: external_classnames_default()(enClasses)
      }, children);
    case 'SheetContent':
      return /*#__PURE__*/external_react_default().createElement("div", Editor_extends({
        className: "text editorContent"
      }, attributes), children);
    case 'TextRef':
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "ref",
        contentEditable: false,
        style: {
          userSelect: 'none'
        }
      }, children);
    case 'SourceContentText':
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "sourceContentText"
      }, children);
    case 'paragraph':
      var pClasses = {
        center: element["text-align"] == "center"
      };
      return /*#__PURE__*/external_react_default().createElement("div", Editor_extends({
        className: external_classnames_default()(pClasses)
      }, attributes), element.loading ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "sourceLoader"
      }) : null, children);
    case 'bulleted-list':
      return /*#__PURE__*/external_react_default().createElement("ul", null, children);
    case 'numbered-list':
      return /*#__PURE__*/external_react_default().createElement("ol", null, children);
    case 'list-item':
      return /*#__PURE__*/external_react_default().createElement("li", null, children);
    case 'header':
      {
        return /*#__PURE__*/external_react_default().createElement("h1", Editor_extends({
          className: "serif"
        }, attributes), /*#__PURE__*/external_react_default().createElement("span", null, children));
      }
    case 'link':
      return /*#__PURE__*/external_react_default().createElement(Editor_Link, props);
    case 'table':
      return /*#__PURE__*/external_react_default().createElement("table", null, /*#__PURE__*/external_react_default().createElement("tbody", attributes, children));
    case 'table-row':
      return /*#__PURE__*/external_react_default().createElement("tr", attributes, children);
    case 'table-cell':
      return /*#__PURE__*/external_react_default().createElement("td", attributes, children);
    case 'horizontal-line':
      return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, children, /*#__PURE__*/external_react_default().createElement("hr", {
        contentEditable: false,
        style: {
          userSelect: 'none'
        }
      }));
    default:
      return /*#__PURE__*/external_react_default().createElement("div", null, children);
  }
};
var getClosestSheetElement = function getClosestSheetElement(editor, path, elementType) {
  var _iterator4 = Editor_createForOfIteratorHelper(external_slate_namespaceObject.Node.ancestors(editor, path)),
    _step4;
  try {
    for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {
      var node = _step4.value;
      if (node[0].type == elementType) {
        return node;
        break;
      }
    }
  } catch (err) {
    _iterator4.e(err);
  } finally {
    _iterator4.f();
  }
  return null;
};
var activeSheetSources = function activeSheetSources(editor) {
  return Array.from(external_slate_namespaceObject.Editor.nodes(editor, {
    at: editor.selection,
    match: function match(n) {
      return n.type === "SheetSource";
    }
  }));
};
var getNextSheetItemPath = function getNextSheetItemPath(SheetItemPath) {
  var path = SheetItemPath;
  var newLastNode = path.pop() + 1;
  path.push(newLastNode);
  return path;
};
function getRefInText(_x3, _x4) {
  return _getRefInText.apply(this, arguments);
}
function _getRefInText() {
  _getRefInText = Editor_asyncToGenerator( /*#__PURE__*/Editor_regeneratorRuntime().mark(function _callee2(editor, returnSourceIfFound) {
    var closestSheetOutsideText, paragraphsToCheck, _i4, _paragraphsToCheck, i, initQuery, paragraphPath, match, _iterator12, _step12, query, ref, selectDistance, _iterator13, _step13, _ref22, _ref23, node, path, _iterator14, _step14, _ref24, _ref25, _node, _path;
    return Editor_regeneratorRuntime().wrap(function _callee2$(_context2) {
      while (1) switch (_context2.prev = _context2.next) {
        case 0:
          closestSheetOutsideText = getClosestSheetElement(editor, editor.selection.focus.path, "SheetOutsideText");
          if (closestSheetOutsideText) {
            _context2.next = 3;
            break;
          }
          return _context2.abrupt("return", {});
        case 3:
          paragraphsToCheck = Array.from(external_slate_namespaceObject.Editor.nodes(editor, {
            at: closestSheetOutsideText[1],
            match: function match(n) {
              return n.type === "paragraph";
            }
          }));
          _i4 = 0, _paragraphsToCheck = paragraphsToCheck;
        case 5:
          if (!(_i4 < _paragraphsToCheck.length)) {
            _context2.next = 45;
            break;
          }
          i = _paragraphsToCheck[_i4];
          initQuery = external_slate_namespaceObject.Node.string(i[0]);
          paragraphPath = i[1];
          match = initQuery.match(/^.+|\n.+|^$/g);
          if (match) {
            _context2.next = 12;
            break;
          }
          return _context2.abrupt("continue", 42);
        case 12:
          _iterator12 = Editor_createForOfIteratorHelper(match);
          _context2.prev = 13;
          _iterator12.s();
        case 15:
          if ((_step12 = _iterator12.n()).done) {
            _context2.next = 34;
            break;
          }
          query = _step12.value;
          if (!(query.length > 50 || query.trim() == "")) {
            _context2.next = 19;
            break;
          }
          return _context2.abrupt("continue", 32);
        case 19:
          _context2.next = 21;
          return sefaria.getName(query.replace(/[\.:]$/, "")).then(function (d) {
            return d;
          });
        case 21:
          ref = _context2.sent;
          selectDistance = query.replace("\n", "").length;
          if (!ref["is_ref"]) {
            _context2.next = 30;
            break;
          }
          _iterator13 = Editor_createForOfIteratorHelper(external_slate_namespaceObject.Node.texts(i[0]));
          try {
            for (_iterator13.s(); !(_step13 = _iterator13.n()).done;) {
              _ref22 = _step13.value;
              _ref23 = Editor_slicedToArray(_ref22, 2);
              node = _ref23[0];
              path = _ref23[1];
              external_slate_namespaceObject.Transforms.setNodes(editor, {
                isRef: true
              }, {
                at: i[1].concat(path)
              });
            }
          } catch (err) {
            _iterator13.e(err);
          } finally {
            _iterator13.f();
          }
          if (returnSourceIfFound && (ref["is_segment"] || ref["is_section"])) {
            external_slate_namespaceObject.Transforms.select(editor, external_slate_namespaceObject.Editor.end(editor, paragraphPath));
            external_slate_namespaceObject.Transforms.move(editor, {
              distance: selectDistance,
              unit: 'character',
              reverse: true,
              edge: 'anchor'
            });
            external_slate_namespaceObject.Editor.removeMark(editor, "isRef");
            external_slate_namespaceObject.Transforms["delete"](editor);
            insertSource(editor, ref["ref"]);
          }
          return _context2.abrupt("return", ref);
        case 30:
          _iterator14 = Editor_createForOfIteratorHelper(external_slate_namespaceObject.Node.texts(i[0]));
          try {
            for (_iterator14.s(); !(_step14 = _iterator14.n()).done;) {
              _ref24 = _step14.value;
              _ref25 = Editor_slicedToArray(_ref24, 2);
              _node = _ref25[0];
              _path = _ref25[1];
              external_slate_namespaceObject.Transforms.setNodes(editor, {
                isRef: false
              }, {
                at: i[1].concat(_path)
              });
            }
          } catch (err) {
            _iterator14.e(err);
          } finally {
            _iterator14.f();
          }
        case 32:
          _context2.next = 15;
          break;
        case 34:
          _context2.next = 39;
          break;
        case 36:
          _context2.prev = 36;
          _context2.t0 = _context2["catch"](13);
          _iterator12.e(_context2.t0);
        case 39:
          _context2.prev = 39;
          _iterator12.f();
          return _context2.finish(39);
        case 42:
          _i4++;
          _context2.next = 5;
          break;
        case 45:
          return _context2.abrupt("return", {});
        case 46:
        case "end":
          return _context2.stop();
      }
    }, _callee2, null, [[13, 36, 39, 42]]);
  }));
  return _getRefInText.apply(this, arguments);
}
var withSefariaSheet = function withSefariaSheet(editor) {
  var insertData = editor.insertData,
    insertText = editor.insertText,
    insertBreak = editor.insertBreak,
    isVoid = editor.isVoid,
    normalizeNode = editor.normalizeNode,
    deleteBackward = editor.deleteBackward,
    deleteForward = editor.deleteForward,
    setFragmentData = editor.setFragmentData;

  //Hack to override this built-in which often returns null when programmatically selecting the whole SheetSource
  external_slate_namespaceObject.Transforms.deselect = function () {};
  editor.isVoid = function (element) {
    return voidElements.includes(element.type) ? true : isVoid(element);
  };
  editor.deleteForward = function () {
    deleteForward(editor);
  };
  editor.deleteBackward = function () {
    var atStartOfDoc = external_slate_namespaceObject.Point.equals(editor.selection.focus, external_slate_namespaceObject.Editor.start(editor, [0, 0]));
    var atEndOfDoc = external_slate_namespaceObject.Point.equals(editor.selection.focus, external_slate_namespaceObject.Editor.end(editor, [0, 0]));
    if (atStartOfDoc) {
      return;
    }

    //if selected element is sheet source, delete it as normal
    if (getClosestSheetElement(editor, editor.selection.focus.path, "SheetSource")) {
      deleteBackward();
      return;
    } else {
      //check to see if we're in a spacer to apply special delete rules
      var inSpacer = false;
      if (getClosestSheetElement(editor, editor.selection.focus.path, "spacer")) {
        inSpacer = true;
      }
      if (atEndOfDoc && inSpacer) {
        external_slate_namespaceObject.Transforms.move(editor, {
          reverse: true
        });
        return;
      }

      //we do a dance to see if we'll accidently delete a sheetsource and select it instead if we will
      external_slate_namespaceObject.Transforms.move(editor, {
        reverse: true
      });
      if (getClosestSheetElement(editor, editor.selection.focus.path, "SheetSource")) {
        //deletes the extra spacer space that would otherwise be left behind
        if (inSpacer) {
          external_slate_namespaceObject.Transforms.move(editor, {
            distance: 2
          });
          if (getClosestSheetElement(editor, editor.selection.focus.path, "SheetSource")) {
            external_slate_namespaceObject.Transforms.move(editor, {
              reverse: true,
              distance: 2
            });
          } else {
            deleteBackward();
          }
        }
        return;
      } else {
        deleteForward(editor);
        return;
      }
    }
  };
  editor.setFragmentData = function (data) {
    setFragmentData(data);
    //dance required to ensure a cut source is properly deleted when the delete part of cut is fired
    if (editor.cuttingSource) {
      external_slate_namespaceObject.Transforms.move(editor, {
        distance: 1,
        unit: 'character',
        edge: 'anchor'
      });
      external_slate_namespaceObject.Transforms.move(editor, {
        distance: 1,
        unit: 'character',
        reverse: true,
        edge: 'focus'
      });
      editor.cuttingSource = false;
    }
  };
  editor.insertBreak = function () {
    // if enter in middle of line in SheetOutsideText insert soft break
    if (getClosestSheetElement(editor, editor.selection.focus.path, "SheetOutsideText") && !external_slate_namespaceObject.Point.equals(editor.selection.focus, external_slate_namespaceObject.Editor.end(editor, editor.selection.focus.path))) {
      insertBreak();
      return;
    }
    if (getClosestSheetElement(editor, editor.selection.focus.path, "header")) {
      insertBreak();
      var curHeaderPath = getClosestSheetElement(editor, editor.selection.focus.path, "header")[1];
      external_slate_namespaceObject.Transforms.setNodes(editor, {
        type: "SheetOutsideText"
      }, {
        at: curHeaderPath
      });
      return;
    }
    var isListItem = function isListItem(editor) {
      var _Editor$nodes = external_slate_namespaceObject.Editor.nodes(editor, {
          match: function match(n) {
            return LIST_TYPES.includes(!external_slate_namespaceObject.Editor.isEditor(n) && external_slate_namespaceObject.Element.isElement(n) && n.type);
          }
        }),
        _Editor$nodes2 = Editor_slicedToArray(_Editor$nodes, 1),
        list = _Editor$nodes2[0];
      return list;
    };
    var isEmpty = function isEmpty(editor) {
      var curNode = external_slate_namespaceObject.Node.get(editor, editor.selection.focus.path);
      return external_slate_namespaceObject.Node.string(curNode) === "";
    };
    if (isListItem(editor)) {
      if (isEmpty(editor)) {
        external_slate_namespaceObject.Transforms.insertNodes(editor, {
          type: 'spacer',
          children: [{
            text: ""
          }]
        });
        deleteBackward();
      } else if (isLinkActive(editor)) {
        // insert an extra space on an active link before creating new line. It prevents link from continuing to next li
        editor.insertText(' ');
        insertBreak();
        editor.removeLink();
      } else {
        insertBreak();
      }
      removeMarks(editor);
      return;
    }
    getRefInText(editor, true).then(function (query) {
      if (query["is_segment"] || query["is_section"]) {
        return;
      }
      external_slate_namespaceObject.Transforms.insertNodes(editor, {
        type: 'spacer',
        children: [{
          text: ""
        }]
      });
      checkAndFixDuplicateSheetNodeNumbers(editor);
      return;
    });
  };
  editor.insertData = function (data) {
    if (editor.dragging && getClosestSheetElement(editor, editor.selection.focus.path, "spacer")) {
      editor.insertText(' '); // this is start of dance that's required to ensure that dnd data gets moved properly
      insertData(data);
      external_slate_namespaceObject.Transforms.move(editor, {
        reverse: true
      }); // dance part ii
      deleteBackward(); // dance finale.
      external_slate_namespaceObject.Editor.normalize(editor, {
        force: true
      });
    } else if (data.getData('text/plain').startsWith('http')) {
      var url;
      try {
        url = new URL(data.getData('text/plain'));
        if (url.hostname.indexOf("www.sefaria.org") === 0) {
          sefariaJquery.ajax({
            url: url,
            async: true,
            success: function success(data) {
              var matches = data.match(/<title>(.*?)<\/title>/);
              if (!matches) {
                console.log('no matches');
                console.log(url);
                external_slate_namespaceObject.Transforms.insertText(editor, url.href);
                return;
              }
              var link = editor.createLinkNode(url.href, matches[1]);
              external_slate_namespaceObject.Transforms.insertText(editor, " "); // this is start of dance that's required to ensure that link gets inserted properly
              var initLoc = editor.selection;
              external_slate_namespaceObject.Transforms.insertNodes(editor, link);
              external_slate_namespaceObject.Transforms.select(editor, initLoc); // dance ii
              external_slate_namespaceObject.Transforms.move(editor, {
                distance: 1,
                unit: 'character',
                reverse: true
              }); // dance dance dance
              external_slate_namespaceObject.Transforms["delete"](editor); // end of dance
            },

            error: function error(e) {
              external_slate_namespaceObject.Transforms.insertText(editor, url.href);
            }
          });
        } else {
          console.log('not sef link');
          insertData(data);
        }
      } catch (_unused) {
        insertData(data);
      }
    } else {
      insertData(data);
    }
    editor.dragging = false;
    checkAndFixDuplicateSheetNodeNumbers(editor);
  };
  editor.normalizeNode = function (entry) {
    var _entry = Editor_slicedToArray(entry, 2),
      node = _entry[0],
      path = _entry[1];
    var normalizers = [{
      name: "ensureNoNestedSheetsinSheet",
      "function": editor.ensureNoNestedSheetsinSheet
    }, {
      name: "ensureNoNestedSheetContents",
      "function": editor.ensureNoNestedSheetContents
    }, {
      name: "decorateSheetOutsideText",
      "function": editor.decorateSheetOutsideText
    }, {
      name: "wrapSheetOutsideTextChildren",
      "function": editor.wrapSheetOutsideTextChildren
    }, {
      name: "mergeSheetOutsideTextBlocks",
      "function": editor.mergeSheetOutsideTextBlocks
    }, {
      name: "convertEmptyOutsideTextIntoSpacer",
      "function": editor.convertEmptyOutsideTextIntoSpacer
    }, {
      name: "convertEmptyParagraphToSpacer",
      "function": editor.convertEmptyParagraphToSpacer
    }, {
      name: "wrapSheetContentElements",
      "function": editor.wrapSheetContentElements
    }, {
      name: "ensureEditableSpaceAtTopAndBottom",
      "function": editor.ensureEditableSpaceAtTopAndBottom
    }, {
      name: "replaceSpacerWithOutsideText",
      "function": editor.replaceSpacerWithOutsideText
    }, {
      name: "liftSpacer",
      "function": editor.liftSpacer
    }, {
      name: "ensureNodeId",
      "function": editor.ensureNodeId
    }, {
      name: "liftSheetElement",
      "function": editor.liftSheetElement
    }, {
      name: "ensureEditableSpaceBeforeAndAfterBoxedElements",
      "function": editor.ensureEditableSpaceBeforeAndAfterBoxedElements
    }, {
      name: "onlyTextAndRefsInBoxedElements",
      "function": editor.onlyTextAndRefsInBoxedElements
    }, {
      name: "addPlaceholdersForEmptyText",
      "function": editor.addPlaceholdersForEmptyText
    }, {
      name: "liftHeader",
      "function": editor.liftHeader
    }, {
      name: "ensureSingleSpacerBetweenBoxedSources",
      "function": editor.ensureSingleSpacerBetweenBoxedSources
    }];
    for (var _i3 = 0, _normalizers = normalizers; _i3 < _normalizers.length; _i3++) {
      var normalizer = _normalizers[_i3];
      try {
        var changeWasMade = normalizer["function"](node, path);
        if (changeWasMade) return;
      } catch (e) {
        console.log("Error at ".concat(normalizer["name"]), e);
        console.log(editor.children[(0, 0)]);
      }
    }
    // Fall back to the original `normalizeNode` to enforce other constraints.
    normalizeNode(entry);
  };

  // Normalization functions take (node, path) and return true if they make a change.
  // They are registered in editor.normalizeNode

  editor.ensureNoNestedSheetsinSheet = function (node, path) {
    if (node.type === "Sheet" && external_slate_namespaceObject.Path.parent(path).length > 0) {
      external_slate_namespaceObject.Transforms.unwrapNodes(editor, {
        at: path
      });
      return true;
    }
  };
  editor.ensureNoNestedSheetContents = function (node, path) {
    if (node.type === "SheetContent" && external_slate_namespaceObject.Node.parent(editor, path).type !== "Sheet") {
      external_slate_namespaceObject.Transforms.unwrapNodes(editor, {
        at: path
      });
    }
  };
  editor.liftHeader = function (node, path) {
    if (node.type === "header") {
      if (external_slate_namespaceObject.Node.parent(editor, path).type !== "SheetContent") {
        external_slate_namespaceObject.Transforms.setNodes(editor, {
          node: editor.children[0].nextNode
        }, {
          at: path
        });
        incrementNextSheetNode(editor);
        external_slate_namespaceObject.Transforms.liftNodes(editor, {
          at: path
        });
        return true;
      }
    }
  };
  editor.decorateSheetOutsideText = function (node, path) {
    // Autoset language of an outside text for proper RTL/LTR handling
    if (node.type === "SheetOutsideText") {
      var content = external_slate_namespaceObject.Node.string(node);
      var lang = sefaria.hebrew.isHebrew(content) ? 'he' : 'en';
      external_slate_namespaceObject.Transforms.setNodes(editor, {
        lang: lang
      }, {
        at: path
      });
    }
  };
  editor.wrapSheetOutsideTextChildren = function (node, path) {
    // Ensure all texts in SheetOutsideText are wrapped in paragraph block
    if (node.type === "SheetOutsideText") {
      //solve issue of children content
      var _iterator5 = Editor_createForOfIteratorHelper(external_slate_namespaceObject.Node.children(editor, path)),
        _step5;
      try {
        for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {
          var _ref8 = _step5.value;
          var _ref9 = Editor_slicedToArray(_ref8, 2);
          var child = _ref9[0];
          var childPath = _ref9[1];
          //if there's raw text, wrap it in a paragraph
          if (child.text) {
            external_slate_namespaceObject.Transforms.wrapNodes(editor, {
              type: "paragraph",
              children: [child]
            }, {
              at: childPath
            });
            return true;
          }
        }
      } catch (err) {
        _iterator5.e(err);
      } finally {
        _iterator5.f();
      }
    }
  };
  editor.mergeSheetOutsideTextBlocks = function (node, path) {
    // Merge adjacent SheetOutsideText blocks into one
    if (node.type === "SheetOutsideText") {
      //merge with adjacent outside texts:
      var nodeAbove = getNodeAbove(path, editor);
      var nodeBelow = getNodeBelow(path, editor);
      if (nodeAbove.node && nodeAbove.node.type === "SheetOutsideText") {
        external_slate_namespaceObject.Transforms.mergeNodes(editor, {
          at: path
        });
        return true;
      }
      if (nodeBelow.node && nodeBelow.node.type === "SheetOutsideText") {
        external_slate_namespaceObject.Transforms.mergeNodes(editor, {
          at: nodeBelow.path
        });
        return true;
      }
    }
  };
  editor.convertEmptyParagraphToSpacer = function (node, path) {
    if (node.type === "paragraph") {
      if (external_slate_namespaceObject.Node.string(node) === "" && node.children.length <= 1) {
        external_slate_namespaceObject.Transforms.setNodes(editor, {
          type: "spacer"
        }, {
          at: path
        });
      }
    }
  };
  editor.convertEmptyOutsideTextIntoSpacer = function (node, path) {
    if (node.type === "SheetOutsideText") {
      if (external_slate_namespaceObject.Node.string(node) === "" && node.children.length <= 1) {
        external_slate_namespaceObject.Transforms.setNodes(editor, {
          type: "spacer"
        }, {
          at: path
        });
      }
    }
  };

  // If sheet elements are in sheetcontent and not wrapped in sheetItem, wrap it.
  editor.wrapSheetContentElements = function (node, path) {
    if (node.type === "SheetContent") {
      var _iterator6 = Editor_createForOfIteratorHelper(external_slate_namespaceObject.Node.children(editor, path)),
        _step6;
      try {
        for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {
          var _ref10 = _step6.value;
          var _ref11 = Editor_slicedToArray(_ref10, 2);
          var child = _ref11[0];
          var childPath = _ref11[1];
          // If it's raw text, covert to SheetOutsideText
          if (child.hasOwnProperty('text')) {
            var fragmentText = child.text;
            var fragment = defaultEmptyOutsideText(editor.children[0].nextNode, fragmentText);
            external_slate_namespaceObject.Transforms["delete"](editor, {
              at: childPath
            });
            external_slate_namespaceObject.Transforms.insertNodes(editor, fragment, {
              at: childPath
            });
            incrementNextSheetNode(editor);
            return true;
          }
          if (LIST_TYPES.includes(child.type)) {
            external_slate_namespaceObject.Transforms.wrapNodes(editor, {
              type: "paragraph",
              children: [child]
            }, {
              at: childPath
            });
            return true;
          }

          // If it's a paragraph, covert to SheetOutisdeText
          if (child.type === "paragraph") {
            if (external_slate_namespaceObject.Node.string(child) !== "") {
              external_slate_namespaceObject.Transforms.wrapNodes(editor, {
                type: "SheetOutsideText",
                children: [child]
              }, {
                at: childPath
              });
              return true;
            } else {
              // It's not text or paragraph.  It's probably a null element.  Nuke it.
              external_slate_namespaceObject.Transforms["delete"](editor, {
                at: childPath
              });
              return true;
            }
          }
        }
      } catch (err) {
        _iterator6.e(err);
      } finally {
        _iterator6.f();
      }
    }
  };
  editor.ensureEditableSpaceAtTopAndBottom = function (node, path) {
    if (node.type === "SheetContent") {
      //ensure there's always an editable space for a user to type at end and top of sheet
      var lastSheetItem = node.children[node.children.length - 1];
      if (lastSheetItem.type !== "spacer" && !NO_SPACER_NEEDED_TYPES.includes(lastSheetItem.type)) {
        external_slate_namespaceObject.Transforms.insertNodes(editor, {
          type: 'spacer',
          children: [{
            text: ""
          }]
        }, {
          at: external_slate_namespaceObject.Editor.end(editor, [0, 0])
        });
        return true;
      }
      var firstSheetItem = node.children[0];
      if (firstSheetItem.type !== "spacer" && !NO_SPACER_NEEDED_TYPES.includes(firstSheetItem.type)) {
        console.log(firstSheetItem);
        external_slate_namespaceObject.Transforms.insertNodes(editor, {
          type: 'spacer',
          children: [{
            text: ""
          }]
        }, {
          at: [0, 0, 0]
        });
        return true;
      }
    }
  };

  //Convert a spacer to an outside text if there's text inside it.
  editor.replaceSpacerWithOutsideText = function (node, path) {
    if (node.type === "spacer") {
      if (external_slate_namespaceObject.Node.string(node) !== "") {
        external_slate_namespaceObject.Transforms.setNodes(editor, {
          type: "SheetOutsideText",
          node: node.node
        }, {
          at: path
        });
      }
    }
  };

  //If a spacer gets stuck inside some other element, lift it up to top level
  editor.liftSpacer = function (node, path) {
    if (node.type === "spacer") {
      if (external_slate_namespaceObject.Node.parent(editor, path).type !== "SheetContent") {
        external_slate_namespaceObject.Transforms.liftNodes(editor, {
          at: path
        });
        return true;
      }
    }
  };

  // Ensure all SheetItems have node #
  editor.ensureNodeId = function (node, path) {
    var sheetElementTypes = Object.values(sheet_item_els);
    if (sheetElementTypes.includes(node.type)) {
      if (!node.node) {
        external_slate_namespaceObject.Transforms.setNodes(editor, {
          node: editor.children[0].nextNode
        }, {
          at: path
        });
        incrementNextSheetNode(editor);
      }
    }
  };

  // If a sheet element gets stuck inside some other element, lift it up to top level
  editor.liftSheetElement = function (node, path) {
    // SheetSource, SheetComment, SheetOutsideText, SheetOutsideBiText, SheetMedia
    var sheetElementTypes = Object.values(sheet_item_els);
    if (sheetElementTypes.includes(node.type)) {
      //Any nested sheet element should be lifted
      if (external_slate_namespaceObject.Node.parent(editor, path).type !== "SheetContent") {
        external_slate_namespaceObject.Transforms.liftNodes(editor, {
          at: path
        });
        return true;
      }
    }
  };
  editor.ensureEditableSpaceBeforeAndAfterBoxedElements = function (node, path) {
    if (["SheetSource", "SheetOutsideBiText"].includes(node.type)) {
      if (external_slate_namespaceObject.Node.parent(editor, path).children.length == 1) {
        return false;
      }
      var nextPath = external_slate_namespaceObject.Path.next(path);
      var prevPath = external_slate_namespaceObject.Path.previous(path);
      var nextNode = external_slate_namespaceObject.Node.get(editor, nextPath);
      var prevNode = external_slate_namespaceObject.Node.get(editor, prevPath);
      var addedSpacer = false;
      if (nextNode.type !== "spacer" && nextNode.type !== "SheetOutsideText") {
        external_slate_namespaceObject.Transforms.insertNodes(editor, {
          type: 'spacer',
          children: [{
            text: ""
          }]
        }, {
          at: nextPath
        });
        addedSpacer = true;
      }
      if (prevNode.type !== "spacer") {
        external_slate_namespaceObject.Transforms.insertNodes(editor, {
          type: 'spacer',
          children: [{
            text: ""
          }]
        }, {
          at: path
        });
        addedSpacer = true;
      }
      return addedSpacer;
    } else if (node.type === "SheetOutsideText") {
      try {
        var _nextNode = external_slate_namespaceObject.Node.get(editor, external_slate_namespaceObject.Path.next(path));
        if (["SheetSource", "SheetOutsideBiText"].includes(_nextNode.type)) {
          external_slate_namespaceObject.Transforms.insertNodes(editor, {
            type: 'spacer',
            children: [{
              text: ""
            }]
          }, {
            at: external_slate_namespaceObject.Path.next(path)
          });
          return true;
        }
      } catch (e) {
        return false;
      }
    }
  };
  editor.ensureSingleSpacerBetweenBoxedSources = function (node, path) {
    if (node.type === "spacer") {
      try {
        var nextPath = external_slate_namespaceObject.Path.next(path);
        var prevPath = external_slate_namespaceObject.Path.previous(path);
        var nextNode = external_slate_namespaceObject.Node.get(editor, nextPath);
        var prevNode = external_slate_namespaceObject.Node.get(editor, prevPath);
        var prevIsBoxed = ["SheetSource", "SheetOutsideBiText"].includes(prevNode.type);
        var nextIsBoxed = ["SheetSource", "SheetOutsideBiText"].includes(nextNode.type);
        if (nextNode.type === "spacer" && prevIsBoxed || prevNode === "spacer" && nextIsBoxed) {
          external_slate_namespaceObject.Transforms["delete"](editor, {
            at: path
          });
          return true;
        }
      } catch (_unused2) {
        return false;
      }
    }
  };
  editor.onlyTextAndRefsInBoxedElements = function (node, path) {
    if (node.type === "he" || node.type === "en") {
      //only allow TextRef & SourceContentText in he or en
      // if extra -- merge it with the previous element
      if (node.children && node.children.length > 2) {
        var _iterator7 = Editor_createForOfIteratorHelper(external_slate_namespaceObject.Node.children(editor, path)),
          _step7;
        try {
          for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {
            var _ref12 = _step7.value;
            var _ref13 = Editor_slicedToArray(_ref12, 2);
            var child = _ref13[0];
            var childPath = _ref13[1];
            if (!["SourceContentText", "TextRef"].includes(child.type)) {
              external_slate_namespaceObject.Transforms.mergeNodes(editor, {
                at: childPath
              });
              return true;
            }
          }
        } catch (err) {
          _iterator7.e(err);
        } finally {
          _iterator7.f();
        }
      }
    }
  };

  // for he's or en's in a SheetSource, make sure that SourceContentText exists
  editor.addPlaceholdersForEmptyText = function (node, path) {
    if (node.type === "he" || node.type === "en") {
      if (external_slate_namespaceObject.Node.parent(editor, path).type === "SheetSource") {
        if (node.children && node.children.length < 2) {
          var insertPath = path.concat([1]);
          external_slate_namespaceObject.Transforms.insertNodes(editor, {
            type: "SourceContentText",
            children: parseSheetItemHTML('...')
          }, {
            at: insertPath
          });
          return true;
        }
      }
    }
  };
  return editor;
};
var incrementNextSheetNode = function incrementNextSheetNode(editor) {
  external_slate_namespaceObject.Transforms.setNodes(editor, {
    nextNode: editor.children[0].nextNode + 1
  }, {
    at: [0]
  });
};
var addItemToSheet = function addItemToSheet(editor, fragment) {
  incrementNextSheetNode(editor);
  external_slate_namespaceObject.Transforms.insertNodes(editor, fragment);
  external_slate_namespaceObject.Editor.normalize(editor, {
    force: true
  });
};
var checkAndFixDuplicateSheetNodeNumbers = function checkAndFixDuplicateSheetNodeNumbers(editor) {
  var existingSheetNodes = [];
  var _iterator8 = Editor_createForOfIteratorHelper(external_slate_namespaceObject.Node.children(editor, [0, 0])),
    _step8;
  try {
    for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {
      var _ref14 = _step8.value;
      var _ref15 = Editor_slicedToArray(_ref14, 2);
      var child = _ref15[0];
      var childPath = _ref15[1];
      var sheetNode = child;
      if (existingSheetNodes.includes(sheetNode.node)) {
        external_slate_namespaceObject.Transforms.setNodes(editor, {
          node: editor.children[0].nextNode
        }, {
          at: childPath
        });
        existingSheetNodes.push(editor.children[0].nextNode);
        incrementNextSheetNode(editor);
      } else {
        existingSheetNodes.push(sheetNode.node);
      }
    }
  } catch (err) {
    _iterator8.e(err);
  } finally {
    _iterator8.f();
  }
};
var insertMedia = function insertMedia(editor, mediaUrl) {
  var fragment = {
    type: "SheetMedia",
    mediaUrl: mediaUrl,
    node: editor.children[0].nextNode,
    children: [{
      text: ""
    }]
  };
  addItemToSheet(editor, fragment);
  external_slate_namespaceObject.Transforms.move(editor);
};
function placed_segment_mapper(lang, segmented, includeNumbers, s) {
  if (!s[lang]) {
    return "";
  }
  var numStr = "";
  if (includeNumbers) {
    var num = lang == "he" ? sefaria.hebrew.encodeHebrewNumeral(s.number) : s.number;
    numStr = "<small>(" + num + ")</small> ";
  }
  var str = "<span class='segment'>" + numStr + s[lang] + "</span> ";
  if (segmented) {
    str = "<p>" + str + "</p>";
  }
  str = str.replace(/(<br\/>)+/g, ' ');
  return str;
}
var insertSource = function insertSource(editor, ref) {
  var path = editor.selection.anchor.path;
  external_slate_namespaceObject.Transforms.setNodes(editor, {
    loading: true
  }, {
    at: path
  });
  var nodeAbove = getNodeAbove(path, editor);
  var nodeBelow = getNodeBelow(path, editor);
  sefaria.getText(ref, {
    stripItags: 1
  }).then(function (text) {
    var segments = sefaria.makeSegments(text, false);
    segments = sefaria.stripImagesFromSegments(segments);
    var includeNumbers = sefariaJquery.inArray("Talmud", text.categories) == -1;
    includeNumbers = text.indexTitle === "Pesach Haggadah" ? false : includeNumbers;
    var segmented = !(text.categories[0] in {
      "Tanakh": 1,
      "Talmud": 1
    });
    var enText = segments.map(placed_segment_mapper.bind(_this, "en", segmented, includeNumbers)).filter(Boolean).join("");
    var heText = segments.map(placed_segment_mapper.bind(_this, "he", segmented, includeNumbers)).filter(Boolean).join("");
    var fragment = [{
      type: "SheetSource",
      node: editor.children[0].nextNode,
      ref: text.ref,
      heRef: text.heRef,
      heText: parseSheetItemHTML(heText),
      enText: parseSheetItemHTML(enText),
      title: null,
      children: [{
        text: ""
      }]
    }];
    if (!(nodeBelow.node && (nodeBelow.node.type == "SheetOutsideText" || nodeBelow.node.type == "paragraph"))) {
      fragment.push({
        type: 'spacer',
        children: [{
          text: ""
        }]
      });
    }
    external_slate_namespaceObject.Transforms.setNodes(editor, {
      loading: false
    }, {
      at: path
    });
    addItemToSheet(editor, fragment);
    checkAndFixDuplicateSheetNodeNumbers(editor);
    if (nodeAbove.node && (nodeAbove.node.type == "SheetOutsideText" || nodeAbove.node.type == "paragraph")) {
      external_slate_namespaceObject.Transforms["delete"](editor, {
        at: path
      });
    }
    external_slate_namespaceObject.Transforms.move(editor, {
      unit: 'block',
      distance: 1
    });
  });
};
var withTables = function withTables(editor) {
  var deleteBackward = editor.deleteBackward,
    deleteForward = editor.deleteForward,
    insertBreak = editor.insertBreak;
  editor.deleteBackward = function (unit) {
    var selection = editor.selection;
    if (selection && external_slate_namespaceObject.Range.isCollapsed(selection)) {
      var _Editor$nodes3 = external_slate_namespaceObject.Editor.nodes(editor, {
          match: function match(n) {
            return !external_slate_namespaceObject.Editor.isEditor(n) && external_slate_namespaceObject.Element.isElement(n) && n.type === 'table-cell';
          }
        }),
        _Editor$nodes4 = Editor_slicedToArray(_Editor$nodes3, 1),
        cell = _Editor$nodes4[0];
      if (cell) {
        var _cell = Editor_slicedToArray(cell, 2),
          cellPath = _cell[1];
        var start = external_slate_namespaceObject.Editor.start(editor, cellPath);
        if (external_slate_namespaceObject.Point.equals(selection.anchor, start)) {
          return;
        }
      }
    }
    deleteBackward(unit);
  };
  editor.deleteForward = function (unit) {
    var selection = editor.selection;
    if (selection && external_slate_namespaceObject.Range.isCollapsed(selection)) {
      var _Editor$nodes5 = external_slate_namespaceObject.Editor.nodes(editor, {
          match: function match(n) {
            return !external_slate_namespaceObject.Editor.isEditor(n) && external_slate_namespaceObject.Element.isElement(n) && n.type === 'table-cell';
          }
        }),
        _Editor$nodes6 = Editor_slicedToArray(_Editor$nodes5, 1),
        cell = _Editor$nodes6[0];
      if (cell) {
        var _cell2 = Editor_slicedToArray(cell, 2),
          cellPath = _cell2[1];
        var end = external_slate_namespaceObject.Editor.end(editor, cellPath);
        if (external_slate_namespaceObject.Point.equals(selection.anchor, end)) {
          return;
        }
      }
    }
    deleteForward(unit);
  };
  editor.insertBreak = function () {
    var selection = editor.selection;
    if (selection) {
      var _Editor$nodes7 = external_slate_namespaceObject.Editor.nodes(editor, {
          match: function match(n) {
            return !external_slate_namespaceObject.Editor.isEditor(n) && external_slate_namespaceObject.Element.isElement(n) && n.type === 'table';
          }
        }),
        _Editor$nodes8 = Editor_slicedToArray(_Editor$nodes7, 1),
        table = _Editor$nodes8[0];
      if (table) {
        return;
      }
    }
    insertBreak();
  };
  return editor;
};
var Editor_Link = function Link(_ref16) {
  var attributes = _ref16.attributes,
    children = _ref16.children,
    element = _ref16.element;
  var editor = (0,external_slate_react_namespaceObject.useSlate)();
  var selection = editor.selection;
  var focused = (0,external_slate_react_namespaceObject.useFocused)();
  var selected = (0,external_slate_react_namespaceObject.useSelected)();
  var _useState23 = (0,external_react_.useState)(false),
    _useState24 = Editor_slicedToArray(_useState23, 2),
    linkPopoverVisible = _useState24[0],
    setLinkPopoverVisible = _useState24[1];
  var _useState25 = (0,external_react_.useState)(element.url),
    _useState26 = Editor_slicedToArray(_useState25, 2),
    urlValue = _useState26[0],
    setUrlValue = _useState26[1];
  var _useState27 = (0,external_react_.useState)(false),
    _useState28 = Editor_slicedToArray(_useState27, 2),
    showLinkRemoveButton = _useState28[0],
    setShowLinkRemoveButton = _useState28[1];
  var _useState29 = (0,external_react_.useState)(editor.linkOverrideSelection),
    _useState30 = Editor_slicedToArray(_useState29, 2),
    currentSlateRange = _useState30[0],
    setCurrentSlateRange = _useState30[1];
  var _useState31 = (0,external_react_.useState)(false),
    _useState32 = Editor_slicedToArray(_useState31, 2),
    editingUrl = _useState32[0],
    setEditingUrl = _useState32[1];
  var showLinkHoverTimeout;
  var hideLinkHoverTimeout;
  var onHover = function onHover(e, url) {
    clearTimeout(hideLinkHoverTimeout);
    if (!editor.selection || editor.linkOverrideSelection) {
      return;
    }
    var range = document.createRange();
    range.selectNode(e.target);
    setCurrentSlateRange(external_slate_react_namespaceObject.ReactEditor.toSlateRange(editor, range, {
      exactMatch: false
    }));
    showLinkHoverTimeout = setTimeout(function () {
      external_slate_namespaceObject.Transforms.select(editor, currentSlateRange);
      setLinkPopoverVisible(true);
    }, 500, e);
  };
  var onBlur = function onBlur(e, url) {
    if (!editingUrl) {
      clearTimeout(showLinkHoverTimeout);
      hideLinkHoverTimeout = setTimeout(function () {
        setLinkPopoverVisible(false);
        setCurrentSlateRange(null);
      }, 500);
    }
  };
  var xClicked = function xClicked() {
    external_slate_namespaceObject.Transforms.select(editor, currentSlateRange);
    editor.removeLink();
    editor.showLinkOverride = false;
    editor.linkOverrideSelection = null;
    // Transforms.collapse(editor);
  };

  var closePopup = function closePopup(e) {
    setEditingUrl(false);
    setLinkPopoverVisible(false);
    if (e.target.value === "") {
      external_slate_namespaceObject.Transforms.select(editor, currentSlateRange);
      editor.removeLink();
    }
    editor.showLinkOverride = false;
    editor.linkOverrideSelection = null;
  };
  var fixUrl = function fixUrl(s) {
    if (s == "") return;
    try {
      var url = new URL(s);
      return url;
    } catch (_unused3) {
      if (sefaria.util.isValidEmailAddress(s)) {
        return "mailto:".concat(s);
      }
      return "http://".concat(s);
    }
  };
  var urlChange = function urlChange(e) {
    var newUrl = e.target.value;
    setUrlValue(newUrl);
    var _Editor$above = external_slate_namespaceObject.Editor.above(editor, {
        at: currentSlateRange,
        match: function match(n) {
          return n.type === "link";
        }
      }),
      _Editor$above2 = Editor_slicedToArray(_Editor$above, 2),
      node = _Editor$above2[0],
      linkPath = _Editor$above2[1];
    external_slate_namespaceObject.Transforms.setNodes(editor, {
      url: fixUrl(newUrl)
    }, {
      at: linkPath
    });
  };
  var linkPopoverOpen = linkPopoverVisible || editor.showLinkOverride && external_slate_namespaceObject.Path.isDescendant(editor.linkOverrideSelection.anchor.path, external_slate_react_namespaceObject.ReactEditor.findPath(editor, element));
  return /*#__PURE__*/external_react_default().createElement("div", Editor_extends({}, attributes, {
    className: "element-link",
    onMouseEnter: function onMouseEnter(e) {
      return onHover(e, element.url);
    },
    onMouseLeave: function onMouseLeave(e) {
      return onBlur(e, element.url);
    }
  }), /*#__PURE__*/external_react_default().createElement("a", {
    href: element.url,
    onMouseEnter: function onMouseEnter(e) {
      if (!linkPopoverOpen) {
        setShowLinkRemoveButton(true);
      }
    }
  }, children), linkPopoverOpen ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "popup",
    contentEditable: false,
    onFocus: function onFocus() {
      return setEditingUrl(true);
    },
    onBlur: function onBlur(e) {
      return closePopup(e);
    }
  }, /*#__PURE__*/external_react_default().createElement("input", {
    type: "text",
    value: urlValue,
    placeholder: sefaria._("Enter link URL"),
    className: "sans-serif",
    onChange: function onChange(e) {
      return urlChange(e);
    }
  }), showLinkRemoveButton ? /*#__PURE__*/external_react_default().createElement("button", {
    onClick: function onClick() {
      return xClicked();
    }
  }, "\u2715") : null) : null);
};
var withLinks = function withLinks(editor) {
  var isInline = editor.isInline;
  editor.isInline = function (element) {
    return element.type === 'link' ? true : isInline(element);
  };
  editor.createLinkNode = function (href, text) {
    return {
      type: "link",
      url: href,
      children: [{
        text: text
      }]
    };
  };
  editor.insertLink = function (url) {
    if (!url) return;
    var selection = editor.selection;
    var link = editor.createLinkNode(url, "New Link");
    external_slate_react_namespaceObject.ReactEditor.focus(editor);
    if (!!selection) {
      var _selection$focus;
      var _Editor$parent = external_slate_namespaceObject.Editor.parent(editor, (_selection$focus = selection.focus) === null || _selection$focus === void 0 ? void 0 : _selection$focus.path),
        _Editor$parent2 = Editor_slicedToArray(_Editor$parent, 2),
        parentNode = _Editor$parent2[0],
        parentPath = _Editor$parent2[1];
      // Remove the Link node if we're inserting a new link node inside of another
      // link.
      if (parentNode.type === "link") {
        editor.removeLink(editor);
      }
      if (editor.isVoid(parentNode)) {
        // Insert the new link after the void node
        external_slate_namespaceObject.Transforms.insertNodes(editor, createParagraphNode([link]), {
          at: external_slate_namespaceObject.Path.next(parentPath),
          select: true
        });
      } else if (external_slate_namespaceObject.Range.isCollapsed(selection)) {
        // Insert the new link in our last known location
        external_slate_namespaceObject.Transforms.insertNodes(editor, link, {
          select: true
        });
      } else {
        // Wrap the currently selected range of text into a Link
        external_slate_namespaceObject.Transforms.wrapNodes(editor, link, {
          split: true
        });
        external_slate_namespaceObject.Transforms.collapse(editor, {
          edge: "end"
        });
      }
    } else {
      return;
    }
  };
  editor.removeLink = function () {
    external_slate_namespaceObject.Transforms.unwrapNodes(editor, {
      match: function match(n) {
        return !external_slate_namespaceObject.Editor.isEditor(n) && external_slate_namespaceObject.Element.isElement(n) && n.type === "link";
      }
    });
  };
  return editor;
};
var isLinkActive = function isLinkActive(editor) {
  var _Editor$nodes9 = external_slate_namespaceObject.Editor.nodes(editor, {
      match: function match(n) {
        return n.type === 'link';
      }
    }),
    _Editor$nodes10 = Editor_slicedToArray(_Editor$nodes9, 1),
    link = _Editor$nodes10[0];
  return !!link;
};
var wrapLink = function wrapLink(editor, url) {
  if (isLinkActive(editor)) {
    unwrapLink(editor);
  }
  var selection = editor.selection;
  var isCollapsed = selection && external_slate_namespaceObject.Range.isCollapsed(selection);
  var link = {
    type: 'link',
    url: url,
    children: isCollapsed ? [{
      text: url
    }] : []
  };
  if (isCollapsed) {
    external_slate_namespaceObject.Transforms.insertNodes(editor, link);
  } else {
    external_slate_namespaceObject.Transforms.wrapNodes(editor, link, {
      split: true
    });
    external_slate_namespaceObject.Transforms.collapse(editor, {
      edge: 'end'
    });
  }
};
var toggleFormat = function toggleFormat(editor, format) {
  var isActive = isFormatActive(editor, format);
  if (isActive) {
    external_slate_namespaceObject.Editor.removeMark(editor, format);
  } else {
    external_slate_namespaceObject.Editor.addMark(editor, format, true);
  }
};
var isFormatActive = function isFormatActive(editor, format) {
  var value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
  var _Editor$nodes11 = external_slate_namespaceObject.Editor.nodes(editor, {
      match: function match(n) {
        return n[format] === (value ? value : true);
      },
      mode: 'all'
    }),
    _Editor$nodes12 = Editor_slicedToArray(_Editor$nodes11, 1),
    match = _Editor$nodes12[0];
  return !!match;
};
var removeMarks = function removeMarks(editor) {
  editor.removeMark('italic');
  editor.removeMark('bold');
  editor.removeMark('underline');
  editor.removeMark('big');
  editor.removeMark('small');
  editor.removeMark('superscript');
  editor.removeMark('isRef');
  editor.removeMark('color');
  editor.removeMark('background-color');
  editor.removeMark('text-align');
};
var toggleBlock = function toggleBlock(editor, format) {
  var isActive = isBlockActive(editor, format);
  var isList = LIST_TYPES.includes(format);
  external_slate_namespaceObject.Transforms.unwrapNodes(editor, {
    match: function match(n) {
      return LIST_TYPES.includes(!external_slate_namespaceObject.Editor.isEditor(n) && external_slate_namespaceObject.Element.isElement(n) && n.type);
    },
    split: true
  });
  var newProperties = {
    type: isActive ? 'paragraph' : isList ? 'list-item' : format
  };
  external_slate_namespaceObject.Transforms.setNodes(editor, newProperties);
  if (!isActive && isList) {
    var block = {
      type: format,
      children: []
    };
    external_slate_namespaceObject.Transforms.wrapNodes(editor, block);
  }
};
var isBlockActive = function isBlockActive(editor, format) {
  var _Editor$nodes13 = external_slate_namespaceObject.Editor.nodes(editor, {
      match: function match(n) {
        return !external_slate_namespaceObject.Editor.isEditor(n) && external_slate_namespaceObject.Element.isElement(n) && n.type === format;
      }
    }),
    _Editor$nodes14 = Editor_slicedToArray(_Editor$nodes13, 1),
    match = _Editor$nodes14[0];
  return !!match;
};
var Leaf = function Leaf(_ref17) {
  var attributes = _ref17.attributes,
    children = _ref17.children,
    leaf = _ref17.leaf;
  if (leaf.bold) {
    children = /*#__PURE__*/external_react_default().createElement("strong", null, children);
  }
  if (leaf.italic) {
    children = /*#__PURE__*/external_react_default().createElement("em", null, children);
  }
  if (leaf.underline) {
    children = /*#__PURE__*/external_react_default().createElement("u", null, children);
  }
  if (leaf.big) {
    children = /*#__PURE__*/external_react_default().createElement("big", null, children);
  }
  if (leaf.small) {
    children = /*#__PURE__*/external_react_default().createElement("small", null, children);
  }
  if (leaf.superscript) {
    children = /*#__PURE__*/external_react_default().createElement("sup", null, children);
  }
  if (leaf.isRef) {
    children = /*#__PURE__*/external_react_default().createElement("span", {
      className: "inlineTextRef"
    }, children);
  }
  if (leaf.color) {
    children = /*#__PURE__*/external_react_default().createElement("span", {
      style: {
        color: leaf.color
      }
    }, children);
  }
  if (leaf["background-color"]) {
    children = /*#__PURE__*/external_react_default().createElement("span", {
      style: {
        backgroundColor: leaf["background-color"]
      }
    }, children);
  }
  if (leaf["text-align"]) {
    children = /*#__PURE__*/external_react_default().createElement("span", {
      style: {
        textAlign: leaf["text-align"]
      }
    }, children);
  }
  return /*#__PURE__*/external_react_default().createElement("span", attributes, children);
};
var HoverMenu = function HoverMenu(opt) {
  var buttons = opt["buttons"];
  var ref = (0,external_react_.useRef)();
  var _useState33 = (0,external_react_.useState)(false),
    _useState34 = Editor_slicedToArray(_useState33, 2),
    showHighlightColors = _useState34[0],
    setShowHighlightColors = _useState34[1];
  var editor = (0,external_slate_react_namespaceObject.useSlate)();
  (0,external_react_.useEffect)(function () {
    var el = ref.current;
    var selection = editor.selection;
    if (!el) {
      return;
    }
    if (!selection || !external_slate_react_namespaceObject.ReactEditor.isFocused(editor) || external_slate_namespaceObject.Range.isCollapsed(selection) || external_slate_namespaceObject.Editor.string(editor, selection) === '' || isLinkActive(editor)) {
      el.removeAttribute('style');
      return;
    }
    var domSelection = window.getSelection();
    var domRange = domSelection.getRangeAt(0);
    var rect = domRange.getBoundingClientRect();
    el.style.opacity = 1;
    el.style.top = "".concat(rect.top + window.pageYOffset - el.offsetHeight, "px");
    el.style.left = "".concat(rect.left + window.pageXOffset - el.offsetWidth / 2 + rect.width / 2, "px");
  });
  var root = window.document.getElementById('s2');
  return /*#__PURE__*/external_react_dom_default().createPortal( /*#__PURE__*/external_react_default().createElement("div", {
    ref: ref,
    className: "hoverMenu"
  }, /*#__PURE__*/external_react_default().createElement(FormatButton, {
    editor: editor,
    format: "bold"
  }), /*#__PURE__*/external_react_default().createElement(FormatButton, {
    editor: editor,
    format: "italic"
  }), /*#__PURE__*/external_react_default().createElement(FormatButton, {
    editor: editor,
    format: "underline"
  }), buttons == "basic" ? null : /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement(HighlightButton, null), /*#__PURE__*/external_react_default().createElement(AddLinkButton, null), /*#__PURE__*/external_react_default().createElement(BlockButton, {
    editor: editor,
    format: "header",
    icon: "header"
  }), /*#__PURE__*/external_react_default().createElement(BlockButton, {
    editor: editor,
    format: "numbered-list",
    icon: "list-ol"
  }), /*#__PURE__*/external_react_default().createElement(BlockButton, {
    editor: editor,
    format: "bulleted-list",
    icon: "list-ul"
  }))), root);
};
var AddLinkButton = function AddLinkButton() {
  var editor = (0,external_slate_react_namespaceObject.useSlate)();
  var classes = {
    fa: 1
  };
  classes["fa-link"] = 1;
  return /*#__PURE__*/external_react_default().createElement("span", {
    className: "hoverButton",
    onMouseDown: function onMouseDown(event) {
      event.preventDefault();
      wrapLink(editor, "");
      editor.showLinkOverride = true;
      editor.linkOverrideSelection = editor.selection;
      // Timeout required b/c it takes a moment for react to rerender before focusing on the new input
      setTimeout(function () {
        document.querySelector(".popup input").focus();
      }, 200);
    }
  }, /*#__PURE__*/external_react_default().createElement("i", {
    className: external_classnames_default()(classes)
  }));
};
var FormatButton = function FormatButton(_ref18) {
  var format = _ref18.format;
  var editor = (0,external_slate_react_namespaceObject.useSlate)();
  var isActive = isFormatActive(editor, format);
  var iconName = "fa-" + format;
  var classes = {
    fa: 1,
    active: isActive
  };
  classes[iconName] = 1;
  return /*#__PURE__*/external_react_default().createElement("span", {
    className: "hoverButton",
    onMouseDown: function onMouseDown(event) {
      event.preventDefault();
      toggleFormat(editor, format);
    }
  }, /*#__PURE__*/external_react_default().createElement("i", {
    className: external_classnames_default()(classes)
  }));
};
var HighlightButton = function HighlightButton() {
  var editor = (0,external_slate_react_namespaceObject.useSlate)();
  var ref = (0,external_react_.useRef)();
  var _useState35 = (0,external_react_.useState)(false),
    _useState36 = Editor_slicedToArray(_useState35, 2),
    showPortal = _useState36[0],
    setShowPortal = _useState36[1];
  var isActive = isFormatActive(editor, "background-color");
  var classes = {
    fa: 1,
    active: isActive,
    "fa-pencil": 1
  };
  var colors = ["#E6DABC", "#EAC4B6", "#D5A7B3", "#AECAB7", "#ADCCDB"]; // 50% gold, orange, rose, green, blue 
  var colorButtons = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, colors.map(function (color) {
    return /*#__PURE__*/external_react_default().createElement("button", {
      key: "highlight-".concat(color.replace("#", "")),
      className: "highlightButton",
      onClick: function onClick(e) {
        var isActive = isFormatActive(editor, "background-color", color);
        if (isActive) {
          external_slate_namespaceObject.Editor.removeMark(editor, "background-color");
        } else {
          external_slate_namespaceObject.Editor.addMark(editor, "background-color", color);
        }
      }
    }, /*#__PURE__*/external_react_default().createElement("div", {
      className: "highlightDot",
      style: {
        "background-color": color
      }
    }));
  }));
  (0,external_react_.useEffect)(function () {
    var el = ref.current;
    if (el) {
      var checkIfClickedOutside = function checkIfClickedOutside(e) {
        if (showPortal && ref.current && !ref.current.contains(e.target)) {
          setShowPortal(false);
        }
      };
      document.addEventListener("mousedown", checkIfClickedOutside);
      return function () {
        // Cleanup the event listener
        document.removeEventListener("mousedown", checkIfClickedOutside);
      };
    }
  }, [showPortal]);
  return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "hoverButton",
    onMouseDown: function onMouseDown(event) {
      event.preventDefault();
      setShowPortal(true);
    }
  }, /*#__PURE__*/external_react_default().createElement("i", {
    className: external_classnames_default()(classes)
  })), showPortal ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "highlightMenu",
    ref: ref
  }, colorButtons, /*#__PURE__*/external_react_default().createElement("button", {
    className: "highlightButton",
    onClick: function onClick(e) {
      external_slate_namespaceObject.Editor.removeMark(editor, "background-color");
    }
  }, /*#__PURE__*/external_react_default().createElement("i", {
    className: "fa fa-ban highlightCancel"
  }))) : null);
};
var BlockButton = function BlockButton(_ref19) {
  var format = _ref19.format,
    icon = _ref19.icon;
  var editor = (0,external_slate_react_namespaceObject.useSlate)();
  var isActive = isBlockActive(editor, format);
  var iconName = "fa-" + icon;
  var classes = {
    fa: 1,
    active: isActive
  };
  classes[iconName] = 1;
  return /*#__PURE__*/external_react_default().createElement("span", {
    className: "hoverButton",
    onMouseDown: function onMouseDown(event) {
      event.preventDefault();
      toggleBlock(editor, format);
    }
  }, /*#__PURE__*/external_react_default().createElement("i", {
    className: external_classnames_default()(classes)
  }));
};
var SefariaEditor = function SefariaEditor(props) {
  var editorContainer = (0,external_react_.useRef)();
  var _useState37 = (0,external_react_.useState)(props.data),
    _useState38 = Editor_slicedToArray(_useState37, 2),
    sheet = _useState38[0],
    setSheet = _useState38[1];
  var initValue = [{
    type: "sheet",
    children: [{
      text: ""
    }]
  }];
  var renderElement = (0,external_react_.useCallback)(function (props) {
    return /*#__PURE__*/external_react_default().createElement(Element, props);
  }, []);
  var _useState39 = (0,external_react_.useState)(initValue),
    _useState40 = Editor_slicedToArray(_useState39, 2),
    value = _useState40[0],
    setValue = _useState40[1];
  var _useState41 = (0,external_react_.useState)(initValue),
    _useState42 = Editor_slicedToArray(_useState41, 2),
    currentDocument = _useState42[0],
    setCurrentDocument = _useState42[1];
  var _useState43 = (0,external_react_.useState)(false),
    _useState44 = Editor_slicedToArray(_useState43, 2),
    unsavedChanges = _useState44[0],
    setUnsavedChanges = _useState44[1];
  var _useState45 = (0,external_react_.useState)(props.data.dateModified),
    _useState46 = Editor_slicedToArray(_useState45, 2),
    lastModified = _useState46[0],
    setlastModified = _useState46[1];
  var _useState47 = (0,external_react_.useState)(false),
    _useState48 = Editor_slicedToArray(_useState47, 2),
    canUseDOM = _useState48[0],
    setCanUseDOM = _useState48[1];
  var _useState49 = (0,external_react_.useState)(null),
    _useState50 = Editor_slicedToArray(_useState49, 2),
    lastSelection = _useState50[0],
    setLastSelection = _useState50[1];
  var _useState51 = (0,external_react_.useState)(false),
    _useState52 = Editor_slicedToArray(_useState51, 2),
    readyForNormalize = _useState52[0],
    setReadyForNormalize = _useState52[1];
  (0,external_react_.useEffect)(function () {
    if (!canUseDOM) {
      return;
    }
    setUnsavedChanges(true);
    // Update debounced value after delay
    var handler = setTimeout(function () {
      saveDocument(currentDocument);
    }, 500);

    // Cancel the timeout if value changes (also on delay change or unmount)
    // This is how we prevent debounced value from updating if value is changed ...
    // .. within the delay period. Timeout gets cleared and restarted.
    return function () {
      clearTimeout(handler);
    };
  }, [currentDocument[0].children[0]] // Only re-call effect if value or delay changes
  );

  (0,external_react_.useEffect)(function () {
    /* normalize on load */
    setCanUseDOM(true);
    var channel = new BroadcastChannel('refresh-editor');
    channel.addEventListener('message', function (event) {
      reloadFromDb();
    });

    //TODO: Check that we still need/want this temporary analytics tracking code
    try {
      hj('event', 'using_new_editor');
    } catch (_unused4) {
      console.error('hj failed');
    }
  }, []);
  (0,external_react_.useEffect)(function () {
    setLastSelection(editor.selection);
    setValue(transformSheetJsonToSlate(sheet));
    editor.children = transformSheetJsonToSlate(sheet);
    editor.onChange();
    setReadyForNormalize(true);
  }, [sheet]);
  (0,external_react_.useEffect)(function () {
    if (readyForNormalize) {
      external_slate_namespaceObject.Editor.normalize(editor, {
        force: true
      });
      setReadyForNormalize(false);
    } else {
      //set cursor to previous location or top of doc
      var newSelect = !!lastSelection ? lastSelection : {
        anchor: {
          path: [0, 0],
          offset: 0
        },
        focus: {
          path: [0, 0],
          offset: 0
        }
      };
      external_slate_namespaceObject.Transforms.select(editor, newSelect);
    }
  }, [readyForNormalize]);
  (0,external_react_.useEffect)(function () {
    var nodes = external_slate_namespaceObject.Editor.nodes(editor, {
      at: [],
      match: external_slate_namespaceObject.Text.isText
    });
    var _iterator9 = Editor_createForOfIteratorHelper(nodes),
      _step9;
    try {
      for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {
        var _ref20 = _step9.value;
        var _ref21 = Editor_slicedToArray(_ref20, 2);
        var node = _ref21[0];
        var path = _ref21[1];
        if (node.text && props.divineNameReplacement) {
          var newStr = replaceDivineNames(node.text, props.divineNameReplacement);
          if (newStr != node.text) {
            external_slate_namespaceObject.Transforms.insertText(editor, newStr, {
              at: path
            });
          }
        }
      }
    } catch (err) {
      _iterator9.e(err);
    } finally {
      _iterator9.f();
    }
    editor.divineNames = props.divineNameReplacement;

    // some edit to the editor is required to show the replacement and save
    // -- this simply just moves the cursor to the top of the doc and then back to its previous spot
    var temp_select = editor.selection;
    external_slate_namespaceObject.Transforms.select(editor, {
      anchor: {
        path: [0, 0],
        offset: 0
      },
      focus: {
        path: [0, 0],
        offset: 0
      }
    });
    external_slate_namespaceObject.Transforms.select(editor, temp_select);
    saveDocument(currentDocument);
  }, [props.divineNameReplacement]);
  (0,external_react_.useEffect)(function () {
    if (!props.hasSidebar) {
      editor.highlightedNode = null;
    }
  }, [props.hasSidebar]);
  (0,external_react_.useEffect)(function () {
    var scrollTimeOutId = null;
    var onScrollListener = function onScrollListener() {
      clearTimeout(scrollTimeOutId);
      scrollTimeOutId = setTimeout(function () {
        if (props.hasSidebar) {
          onEditorSidebarToggleClick();
        }
      }, 200);
    };
    var clickTimeOutId = null;
    var onClickListener = function onClickListener(e) {
      clearTimeout(clickTimeOutId);
      clickTimeOutId = setTimeout(function () {
        if (props.hasSidebar) {
          var sheetElementTypes = Object.values(sheet_item_els);
          var _iterator10 = Editor_createForOfIteratorHelper(external_slate_namespaceObject.Node.ancestors(editor, editor.selection.focus.path)),
            _step10;
          try {
            for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {
              var node = _step10.value;
              if (sheetElementTypes.includes(node[0].type)) {
                if (node[0].node != editor.highlightedNode) {
                  updateSidebar(node[0].node, node[0].ref);
                  if (node[0].type != "SheetSource") {
                    external_slate_namespaceObject.Transforms.select(editor, editor.blurSelection);
                    external_slate_react_namespaceObject.ReactEditor.focus(editor);
                  }
                }
                break;
              }
            }
          } catch (err) {
            _iterator10.e(err);
          } finally {
            _iterator10.f();
          }
        }
      }, 20);
    };
    editorContainer.current.parentNode.parentNode.addEventListener("scroll", onScrollListener);
    editorContainer.current.parentNode.parentNode.addEventListener("click", onClickListener);
    return function () {
      editorContainer.current.parentNode.parentNode.removeEventListener("scroll", onScrollListener);
      editorContainer.current.parentNode.parentNode.removeEventListener("click", onClickListener);
    };
  }, [props.highlightedNode, props.hasSidebar]);
  (0,external_react_.useEffect)(function () {
    if (canUseDOM) {
      if (props.highlightedNode) {
        var $highlighted = document.querySelectorAll(".sheetItem[data-sheet-node='".concat(props.highlightedNode, "']"))[0];
        if ($highlighted) {
          var offset = props.multiPanel ? 200 : 70; // distance from the top of screen that we want highlighted segments to appear below.
          var top = $highlighted.getBoundingClientRect().top - offset;
          sefariaJquery('.sheetsInPanel')[0].scroll({
            top: top
          });
        }
      }
    }
  }, [canUseDOM]);
  function saveSheetContent(doc, lastModified) {
    var sheetTitle = editorContainer.current.querySelector(".sheetContent .sheetMetaDataBox .title") ? editorContainer.current.querySelector(".sheetContent .sheetMetaDataBox .title").textContent : "Untitled";
    var docContent = doc.children.find(function (el) {
      return el.type == "SheetContent";
    });
    if (!docContent) {
      return false;
    }
    var sheetContent = docContent.children;
    var sources = sheetContent.map(function (item) {
      var sheetItem = item;
      switch (sheetItem.type) {
        case 'SheetSource':
          var enSerializedSourceText = sheetItem.enText.reduce(function (concatenatedSegments, currentSegment) {
            return concatenatedSegments + serialize(currentSegment);
          }, "");
          var heSerializedSourceText = sheetItem.heText.reduce(function (concatenatedSegments, currentSegment) {
            return concatenatedSegments + serialize(currentSegment);
          }, "");
          var source = Editor_objectSpread(Editor_objectSpread({
            "ref": sheetItem.ref,
            "heRef": sheetItem.heRef,
            "text": {
              "en": enSerializedSourceText !== "" ? enSerializedSourceText : "...",
              "he": heSerializedSourceText !== "" ? heSerializedSourceText : "..."
            }
          }, sheetItem.options && {
            options: sheetItem.options
          }), {}, {
            "node": sheetItem.node
          });
          return source;
        case 'SheetOutsideBiText':
          var enSerializedOutsideText = sheetItem.enText.reduce(function (concatenatedSegments, currentSegment) {
            return concatenatedSegments + serialize(currentSegment);
          }, "");
          var heSerializedOutsideText = sheetItem.heText.reduce(function (concatenatedSegments, currentSegment) {
            return concatenatedSegments + serialize(currentSegment);
          }, "");
          var outsideBiText = Editor_objectSpread(Editor_objectSpread({
            "outsideBiText": {
              "en": enSerializedOutsideText !== "" ? enSerializedOutsideText : "...",
              "he": heSerializedOutsideText !== "" ? heSerializedOutsideText : "..."
            }
          }, sheetItem.options && {
            options: sheetItem.options
          }), {}, {
            "node": sheetItem.node
          });
          return outsideBiText;
        case 'SheetComment':
          return Editor_objectSpread(Editor_objectSpread({
            "comment": serialize(sheetItem)
          }, sheetItem.options && {
            options: sheetItem.options
          }), {}, {
            "node": sheetItem.node
          });
        case 'SheetOutsideText':
          var outsideTextText = serialize(sheetItem);
          //Add space to empty outside texts to preseve line breaks from old sheets.
          return Editor_objectSpread(Editor_objectSpread({
            "outsideText": outsideTextText == "<p></p>" || outsideTextText == "<div></div>" ? "<p> </p>" : outsideTextText
          }, sheetItem.options && {
            options: sheetItem.options
          }), {}, {
            "node": sheetItem.node
          });
        case 'SheetMedia':
          return Editor_objectSpread(Editor_objectSpread({
            "media": sheetItem.mediaUrl
          }, sheetItem.options && {
            options: sheetItem.options
          }), {}, {
            "node": sheetItem.node
          });
        case 'header':
          var headerContent = serialize(sheetItem);
          return Editor_objectSpread(Editor_objectSpread({
            "outsideText": "<h1>".concat(headerContent, "</h1>")
          }, sheetItem.options && {
            options: sheetItem.options
          }), {}, {
            "node": sheetItem.node
          });
        case 'spacer':
          return;
        default:
          // console.log("Error saving:")
          // console.log(sheetItem)
          return;
      }
    });
    var sheet = {
      status: doc.status,
      id: doc.id,
      promptedToPublish: doc.promptedToPublish,
      lastModified: lastModified,
      summary: doc.summary,
      options: Editor_objectSpread(Editor_objectSpread({}, doc.options), {}, {
        divineNames: props.divineNameReplacement
      }),
      tags: doc.tags,
      displayedCollection: doc.displayedCollection,
      title: sheetTitle === "" ? "Untitled" : sheetTitle,
      sources: sources.filter(function (x) {
        return !!x;
      }),
      nextNode: doc.nextNode
    };
    return JSON.stringify(sheet);
  }
  function saveDocument(doc) {
    var json = saveSheetContent(doc[0], lastModified);
    if (!json) {
      return;
    }
    // console.log('saving...');

    sefariaJquery.post("/api/sheets/", {
      "json": json
    }, function (res) {
      setlastModified(res.dateModified);
      // console.log("saved at: "+ res.dateModified);
      setUnsavedChanges(false);
      var updatedSheet = Editor_objectSpread(Editor_objectSpread({}, sefaria.sheets._loadSheetByID[doc[0].id]), res);
      sefaria.sheets._loadSheetByID[doc[0].id] = updatedSheet;
    });
  }
  function _onChange(value) {
    if (currentDocument !== value) {
      setCurrentDocument(value);
    }
    setValue(value);
  }
  var beforeInput = function beforeInput(event) {
    switch (event.inputType) {
      case 'formatBold':
        return toggleFormat(editor, 'bold');
      case 'formatItalic':
        return toggleFormat(editor, 'italic');
      case 'formatUnderline':
        return toggleFormat(editor, 'underline');
    }
  };
  var ensureInView = function ensureInView(e) {
    /*
      Slate doesn't always scroll to content beyond the viewport -- this should fix that.
     */
    if (editor.selection == null) return;
    try {
      /*
        Need a try/catch because sometimes you get an error like:
        Cannot resolve a DOM node from Slate node: {"type":"p","children":[{"text":"","by":-1,"at":-1}]}
       */
      var domPoint = external_slate_react_namespaceObject.ReactEditor.toDOMPoint(editor, editor.selection.focus);
      var node = domPoint[0];
      if (node == null) return;
      var element = node.parentElement;
      if (element == null) return;
      if (whereIsElementInViewport(element) == "in viewport") return;
      element.scrollIntoView({
        behavior: "auto",
        block: "end"
      });
    } catch (e) {
      //Do nothing if there is an error.
    }
  };
  var onCutorCopy = function onCutorCopy(event) {
    var nodeAbove = external_slate_namespaceObject.Editor.above(editor, {
      match: function match(n) {
        return external_slate_namespaceObject.Editor.isBlock(editor, n);
      }
    });
    if (nodeAbove && nodeAbove[0].type == "SheetSource") {
      editor.cuttingSource = true;
      //can't select an empty void -- so we select before and after as well
      external_slate_namespaceObject.Transforms.move(editor, {
        distance: 1,
        unit: 'character',
        reverse: true,
        edge: 'anchor'
      });
      external_slate_namespaceObject.Transforms.move(editor, {
        distance: 1,
        unit: 'character',
        edge: 'focus'
      });
    }
  };
  var onDragEnd = function onDragEnd(event) {
    if (editor.dragging) {
      editor.blurSelection;
      editor.dragging = false;
    }
  };
  var onDragCheck = function onDragCheck(event) {
    if (editor.dragging) {
      event.preventDefault();
    }
  };
  var onBlur = function onBlur(event) {
    editor.blurSelection = editor.selection;
  };
  var onKeyDown = function onKeyDown(event) {
    ensureInView(event);
    for (var hotkey in HOTKEYS) {
      if (external_is_hotkey_default()(hotkey, event)) {
        event.preventDefault();
        var format = HOTKEYS[hotkey];
        toggleFormat(editor, format);
      }
    }

    // Add or remove ref highlighting
    if (event.key === " " || external_slate_namespaceObject.Node.get(editor, editor.selection.focus.path).isRef) {
      getRefInText(editor, false);
    }
  };
  var whereIsElementInViewport = function whereIsElementInViewport(element) {
    var elementbbox = element.getBoundingClientRect();
    var vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
    if (elementbbox.top >= 200 && elementbbox.bottom < vh) {
      return "in viewport";
    }
    if (elementbbox.bottom >= vh / 2 && element) {
      return "past half";
    }
  };
  var getHighlightedByScrollPos = function getHighlightedByScrollPos() {
    var segmentToHighlight = null;
    var segments = editorContainer.current.querySelectorAll(".sheetItem");
    var _iterator11 = Editor_createForOfIteratorHelper(segments),
      _step11;
    try {
      for (_iterator11.s(); !(_step11 = _iterator11.n()).done;) {
        var segment = _step11.value;
        var elementLoc = whereIsElementInViewport(segment);
        if (elementLoc === "in viewport" || elementLoc === "past half") {
          segmentToHighlight = segment;
          break;
        }
      }
    } catch (err) {
      _iterator11.e(err);
    } finally {
      _iterator11.f();
    }
    return segmentToHighlight;
  };
  var reloadFromDb = function reloadFromDb() {
    console.log("Refreshing sheet from Db");
    sefaria.sheets.loadSheetByID(sheet.id, function (data) {
      setSheet(data);
    }, true);
  };
  var updateSidebar = function updateSidebar(sheetNode, sheetRef) {
    var source = {
      'node': sheetNode
    };
    if (!!sheetRef) {
      source["ref"] = sheetRef;
    }
    editor.highlightedNode = sheetNode;
    props.sheetSourceClick(source);
  };
  var onEditorSidebarToggleClick = function onEditorSidebarToggleClick(event) {
    var segmentToHighlight = getHighlightedByScrollPos();
    if (!segmentToHighlight) {
      updateSidebar(sheet.id, null);
    } else {
      var sheetNode = segmentToHighlight.getAttribute("data-sheet-node");
      var sheetRef = segmentToHighlight.getAttribute("data-sefaria-ref");
      updateSidebar(sheetNode, sheetRef);
    }
  };
  var editor = (0,external_react_.useMemo)(function () {
    return withTables(withSefariaSheet(withLinks((0,external_slate_history_namespaceObject.withHistory)((0,external_slate_react_namespaceObject.withReact)((0,external_slate_namespaceObject.createEditor)())))));
  }, []);
  return /*#__PURE__*/external_react_default().createElement("div", {
    ref: editorContainer,
    onClick: props.handleClick
  }, /*#__PURE__*/external_react_default().createElement("button", {
    className: "editorSidebarToggle",
    onClick: function onClick(e) {
      return onEditorSidebarToggleClick(e);
    },
    "aria-label": "Click to open the sidebar"
  }), /*#__PURE__*/external_react_default().createElement(SheetMetaDataBox, null, /*#__PURE__*/external_react_default().createElement(SheetTitle, {
    tabIndex: 0,
    title: sheet.title,
    editable: true,
    blurCallback: function blurCallback() {
      return saveDocument(currentDocument);
    }
  }), /*#__PURE__*/external_react_default().createElement(SheetAuthorStatement, {
    authorUrl: sheet.ownerProfileUrl,
    authorStatement: sheet.ownerName
  }, /*#__PURE__*/external_react_default().createElement(ProfilePic, {
    url: sheet.ownerImageUrl,
    len: 30,
    name: sheet.ownerName,
    outerStyle: {
      width: "30px",
      height: "30px",
      display: "inline-block",
      verticalAlign: "middle",
      marginRight: "10px"
    }
  }), /*#__PURE__*/external_react_default().createElement("a", {
    href: sheet.ownerProfileUrl
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, sheet.ownerName))), /*#__PURE__*/external_react_default().createElement(CollectionStatement, {
    name: sheet.collectionName,
    slug: sheet.displayedCollection,
    image: sheet.collectionImage
  })), canUseDOM ? /*#__PURE__*/external_react_default().createElement(external_slate_react_namespaceObject.Slate, {
    editor: editor,
    value: value,
    onChange: function onChange(value) {
      return _onChange(value);
    }
  }, /*#__PURE__*/external_react_default().createElement(HoverMenu, {
    buttons: "all"
  }), /*#__PURE__*/external_react_default().createElement(external_slate_react_namespaceObject.Editable, {
    renderLeaf: function renderLeaf(props) {
      return /*#__PURE__*/external_react_default().createElement(Leaf, props);
    },
    renderElement: renderElement,
    spellCheck: true,
    onKeyDown: onKeyDown,
    onCut: onCutorCopy,
    onDragOver: onDragCheck,
    onDragEnter: onDragCheck,
    onDragEnd: onDragEnd,
    onCopy: onCutorCopy,
    onBlur: onBlur,
    onDOMBeforeInput: beforeInput,
    autoFocus: true
  })) : null);
};
/* harmony default export */ const Editor = (SefariaEditor);
;// CONCATENATED MODULE: ../static/js/Sheet.jsx
function Sheet_typeof(obj) { "@babel/helpers - typeof"; return Sheet_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, Sheet_typeof(obj); }
function Sheet_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function Sheet_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, Sheet_toPropertyKey(descriptor.key), descriptor); } }
function Sheet_createClass(Constructor, protoProps, staticProps) { if (protoProps) Sheet_defineProperties(Constructor.prototype, protoProps); if (staticProps) Sheet_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function Sheet_toPropertyKey(arg) { var key = Sheet_toPrimitive(arg, "string"); return Sheet_typeof(key) === "symbol" ? key : String(key); }
function Sheet_toPrimitive(input, hint) { if (Sheet_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (Sheet_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function Sheet_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) Sheet_setPrototypeOf(subClass, superClass); }
function Sheet_setPrototypeOf(o, p) { Sheet_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return Sheet_setPrototypeOf(o, p); }
function Sheet_createSuper(Derived) { var hasNativeReflectConstruct = Sheet_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = Sheet_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = Sheet_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return Sheet_possibleConstructorReturn(this, result); }; }
function Sheet_possibleConstructorReturn(self, call) { if (call && (Sheet_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return Sheet_assertThisInitialized(self); }
function Sheet_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function Sheet_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function Sheet_getPrototypeOf(o) { Sheet_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return Sheet_getPrototypeOf(o); }










var Sheet = /*#__PURE__*/function (_Component) {
  Sheet_inherits(Sheet, _Component);
  var _super = Sheet_createSuper(Sheet);
  function Sheet(props) {
    Sheet_classCallCheck(this, Sheet);
    return _super.call(this, props);
  }
  Sheet_createClass(Sheet, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.$container = sefariaJquery(external_react_dom_default().findDOMNode(this));
      this.ensureData();
      var params = {
        content_type: "Sheet",
        item_id: this.props.id
      };
      gtag("event", "select_content", params);
    }
  }, {
    key: "getSheetFromCache",
    value: function getSheetFromCache() {
      return sefaria.sheets.loadSheetByID(this.props.id);
    }
  }, {
    key: "getSheetFromAPI",
    value: function getSheetFromAPI() {
      sefaria.sheets.loadSheetByID(this.props.id, this.onDataLoad);
    }
  }, {
    key: "onDataLoad",
    value: function onDataLoad(data) {
      var sheetRef = "Sheet " + data.id + (this.props.highlightedNode ? "." + this.props.highlightedNode : "");
      this.props.openSheet(sheetRef, true); // Replace state now that data is loaded so History can include sheet title
      this.forceUpdate();
      this.preloadConnections();
      this.updateDivineNameStateWithSheetValue();
    }
  }, {
    key: "ensureData",
    value: function ensureData() {
      if (!this.getSheetFromCache()) {
        this.getSheetFromAPI();
      } else {
        this.preloadConnections();
        this.updateDivineNameStateWithSheetValue();
      }
    }
  }, {
    key: "preloadConnections",
    value: function preloadConnections() {
      var _this = this;
      var data = this.getSheetFromCache();
      if (!data) {
        return;
      }
      for (var i = 0; i < data.sources.length; i++) {
        if ("ref" in data.sources[i]) {
          sefaria.related(data.sources[i].ref, function () {
            return _this.forceUpdate;
          });
        }
      }
    }
  }, {
    key: "updateDivineNameStateWithSheetValue",
    value: function updateDivineNameStateWithSheetValue() {
      var sheet = this.getSheetFromCache();
      this.props.setDivineNameReplacement(sheet.options.divineNames);
    }
  }, {
    key: "handleClick",
    value: function handleClick(e) {
      var target = e.target.closest('a');
      if (target) {
        var url;
        try {
          url = new URL(target.href);
        } catch (_unused) {
          return false;
        }
        var path = url.pathname;
        var params = url.searchParams;
        if (path.match(/^\/sheets\/\d+/)) {
          e.preventDefault();
          console.log();
          this.props.onCitationClick("Sheet ".concat(path.slice(8)), "Sheet ".concat(this.props.sheetID), true);
        } else if (sefaria.isRef(path.slice(1))) {
          e.preventDefault();
          var currVersions = {
            en: params.get("ven"),
            he: params.get("vhe")
          };
          var options = {
            showHighlight: path.slice(1).indexOf("-") !== -1
          }; // showHighlight when ref is ranged
          this.props.onCitationClick(path.slice(1), "Sheet ".concat(this.props.sheetID), true, currVersions);
        }
      }
    }
  }, {
    key: "render",
    value: function render() {
      var sheet = this.getSheetFromCache();
      var classes = external_classnames_default()({
        sheetsInPanel: 1
      });
      var content;
      if (!sheet) {
        content = /*#__PURE__*/external_react_default().createElement(LoadingMessage, null);
      } else {
        content = /*#__PURE__*/external_react_default().createElement(SheetContent, {
          sheetNotice: sheet.sheetNotice,
          sources: sheet.sources,
          title: sheet.title,
          onRefClick: this.props.onRefClick,
          handleClick: this.handleClick,
          sheetSourceClick: this.props.onSegmentClick,
          highlightedNode: this.props.highlightedNode,
          highlightedRefsInSheet: this.props.highlightedRefsInSheet,
          scrollToHighlighted: this.props.scrollToHighlighted,
          authorStatement: sheet.ownerName,
          authorUrl: sheet.ownerProfileUrl,
          authorImage: sheet.ownerImageUrl,
          collectionName: sheet.collectionName,
          collectionSlug: sheet.displayedCollection,
          collectionImage: sheet.collectionImage,
          editable: sefaria._uid === sheet.owner,
          hasSidebar: this.props.hasSidebar,
          setSelectedWords: this.props.setSelectedWords,
          sheetNumbered: sheet.options.numbered,
          hideImages: !!sheet.hideImages,
          sheetID: sheet.id
        });
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes
      }, sheet && sefaria._uid === sheet.owner && sefaria._uses_new_editor ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "sheetContent"
      }, /*#__PURE__*/external_react_default().createElement(Editor, {
        data: sheet,
        hasSidebar: this.props.hasSidebar,
        handleClick: this.handleClick,
        multiPanel: this.props.multiPanel,
        sheetSourceClick: this.props.onSegmentClick,
        highlightedNode: this.props.highlightedNode,
        highlightedRefsInSheet: this.props.highlightedRefsInSheet,
        setDivineNameReplacement: this.props.setDivineNameReplacement,
        divineNameReplacement: this.props.divineNameReplacement
      })) : content);
    }
  }]);
  return Sheet;
}((external_react_class_default()));
var SheetContent = /*#__PURE__*/function (_Component2) {
  Sheet_inherits(SheetContent, _Component2);
  var _super2 = Sheet_createSuper(SheetContent);
  function SheetContent() {
    Sheet_classCallCheck(this, SheetContent);
    return _super2.apply(this, arguments);
  }
  Sheet_createClass(SheetContent, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.$container = sefariaJquery(external_react_dom_default().findDOMNode(this).parentNode);
      this._isMounted = true;
      var node = external_react_dom_default().findDOMNode(this).parentNode;
      node.addEventListener("scroll", this.handleScroll);
      this.windowMiddle = sefariaJquery(window).outerHeight() / 2;
      this.highlightThreshhold = this.props.multiPanel ? 200 : 70; // distance from the top of screen that we want highlighted segments to appear below.
      this.debouncedAdjustHighlightedAndVisible = sefaria.util.debounce(this.adjustHighlightedAndVisible, 100);
      this.scrollToHighlighted();
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this._isMounted = false;
      var node = external_react_dom_default().findDOMNode(this).parentNode;
      node.removeEventListener("scroll", this.handleScroll);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (prevProps.highlightedNode !== this.props.highlightedNode && this.props.scrollToHighlighted) {
        this.scrollToHighlighted();
      }
    }
  }, {
    key: "handleScroll",
    value: function handleScroll(event) {
      if (this.justScrolled) {
        this.justScrolled = false;
        return;
      }
      this.debouncedAdjustHighlightedAndVisible();
    }
  }, {
    key: "handleTextSelection",
    value: function handleTextSelection() {
      var selectedWords = sefaria.util.getNormalizedSelectionString(); //this gets around the above issue
      if (selectedWords !== this.props.selectedWords) {
        //console.log("setting selecting words")
        this.props.setSelectedWords(selectedWords);
      }
    }
  }, {
    key: "adjustHighlightedAndVisible",
    value: function adjustHighlightedAndVisible() {
      //console.log("adjustHighlightedAndVisible");
      // Adjust which ref is current consider visible for header and URL,
      // and while the TextList is open, update which segment should be highlighted.
      // Keeping the highlightedRefs value in the panel ensures it will return
      // to the right location after closing other panels.
      if (!this._isMounted) {
        return;
      }

      // When using tab to navigate (i.e. a11y) set ref to currently focused ref
      var $segment = null;
      if (sefariaJquery("body").hasClass("user-is-tabbing") && sefariaJquery(".segment:focus").length > 0) {
        $segment = sefariaJquery(".segment:focus").eq(0);
      } else {
        var $container = this.$container;
        var topThreshhold = this.highlightThreshhold;
        $container.find("section .segment").each(function (i, segment) {
          var top = sefariaJquery(segment).offset().top - $container.offset().top;
          var bottom = sefariaJquery(segment).outerHeight() + top;
          if (bottom > this.windowMiddle || top >= topThreshhold) {
            $segment = sefariaJquery(segment);
            return false;
          }
        }.bind(this));
      }
      if (!$segment) {
        return;
      }

      // don't move around highlighted segment when scrolling a single panel,
      var shouldHighlight = this.props.hasSidebar || this.props.mode === "SheetAndConnections";
      if (shouldHighlight) {
        var node = parseInt($segment.attr("data-node"));
        if (!(this.props.highlightedNode === node)) {
          $segment.click();
        }
      }
    }
  }, {
    key: "scrollToHighlighted",
    value: function scrollToHighlighted() {
      if (!this._isMounted) {
        return;
      }
      var $container = this.$container;
      var $readerPanel = $container.closest(".readerPanel");
      var $highlighted = $container.find(".segment.highlight").first();
      if ($highlighted.length) {
        this.scrolledToHighlight = true;
        this.justScrolled = true;
        var offset = this.highlightThreshhold;
        var top = $highlighted.position().top - offset;
        $container[0].scrollTop = top;
        if ($readerPanel.attr("id") === sefariaJquery(".readerPanel:last").attr("id")) {
          $highlighted.focus();
        }
      }
    }
  }, {
    key: "render",
    value: function render() {
      var sources = this.props.sources.length ? this.props.sources.map(function (source, i) {
        var highlightedRef = this.props.highlightedRefsInSheet ? sefaria.normRefList(this.props.highlightedRefsInSheet) : null;
        if ("ref" in source) {
          var highlighted = this.props.highlightedNode ? this.props.highlightedNode === source.node : highlightedRef ? sefaria.refContains(source.ref, highlightedRef) : false;
          return /*#__PURE__*/external_react_default().createElement(SheetSource, {
            key: i,
            source: source,
            sourceNum: i + 1,
            cleanHTML: this.cleanHTML,
            sheetSourceClick: this.props.sheetSourceClick.bind(this, source),
            highlighted: highlighted,
            sheetNumbered: this.props.sheetNumbered
          });
        } else if ("comment" in source) {
          return /*#__PURE__*/external_react_default().createElement(SheetComment, {
            key: i,
            sourceNum: i + 1,
            source: source,
            cleanHTML: this.cleanHTML,
            sheetSourceClick: this.props.sheetSourceClick.bind(this, source),
            highlightedNode: this.props.highlightedNode,
            sheetNumbered: this.props.sheetNumbered
          });
        } else if ("outsideText" in source) {
          var sourceIsHeader = source["outsideText"].startsWith("<h1>");
          if (sourceIsHeader) {
            return /*#__PURE__*/external_react_default().createElement(SheetHeader, {
              key: i,
              sourceNum: i + 1,
              source: source,
              sheetSourceClick: this.props.sheetSourceClick.bind(this, source),
              highlightedNode: this.props.highlightedNode,
              sheetNumbered: this.props.sheetNumbered
            });
          } else {
            return /*#__PURE__*/external_react_default().createElement(SheetOutsideText, {
              key: i,
              sourceNum: i + 1,
              source: source,
              cleanHTML: this.cleanHTML,
              sheetSourceClick: this.props.sheetSourceClick.bind(this, source),
              highlightedNode: this.props.highlightedNode,
              sheetNumbered: this.props.sheetNumbered
            });
          }
        } else if ("outsideBiText" in source) {
          return /*#__PURE__*/external_react_default().createElement(SheetOutsideBiText, {
            key: i,
            sourceNum: i + 1,
            source: source,
            cleanHTML: this.cleanHTML,
            sheetSourceClick: this.props.sheetSourceClick.bind(this, source),
            highlightedNode: this.props.highlightedNode,
            sheetNumbered: this.props.sheetNumbered
          });
        } else if ("media" in source) {
          return /*#__PURE__*/external_react_default().createElement(SheetMedia, {
            key: i,
            sourceNum: i + 1,
            cleanHTML: this.cleanHTML,
            source: source,
            sheetSourceClick: this.props.sheetSourceClick.bind(this, source),
            highlightedNode: this.props.highlightedNode,
            sheetNumbered: this.props.sheetNumbered,
            hideImages: this.props.hideImages
          });
        }
      }, this) : null;
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "sheetContent"
      }, this.props.sheetNotice ? /*#__PURE__*/external_react_default().createElement(SheetNotice, null) : null, /*#__PURE__*/external_react_default().createElement(SheetMetaDataBox, null, /*#__PURE__*/external_react_default().createElement(SheetTitle, {
        title: this.props.title
      }), /*#__PURE__*/external_react_default().createElement(SheetAuthorStatement, {
        authorUrl: this.props.authorUrl,
        authorStatement: this.props.authorStatement
      }, /*#__PURE__*/external_react_default().createElement(ProfilePic, {
        url: this.props.authorImage,
        len: 30,
        name: this.props.authorStatement,
        outerStyle: {
          width: "30px",
          height: "30px",
          display: "inline-block",
          verticalAlign: "middle"
        }
      }), /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: {
          en: "By",
          he: "מאת"
        }
      }), /*#__PURE__*/external_react_default().createElement("a", {
        href: this.props.authorUrl,
        className: "sheetAuthorName"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, this.props.authorStatement))), /*#__PURE__*/external_react_default().createElement(CollectionStatement, {
        name: this.props.collectionName,
        slug: this.props.collectionSlug,
        image: this.props.collectionImage
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "text"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "textInner",
        onMouseUp: this.handleTextSelection,
        onClick: this.props.handleClick
      }, sources)), /*#__PURE__*/external_react_default().createElement("div", {
        id: "printFooter",
        style: {
          display: "none"
        }
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Created with ", /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/img/logo.svg"
      })), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, sefaria._("Created with"), " ", /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/img/logo.svg"
      }))));
    }
  }]);
  return SheetContent;
}((external_react_class_default()));
var SheetSource = /*#__PURE__*/function (_Component3) {
  Sheet_inherits(SheetSource, _Component3);
  var _super3 = Sheet_createSuper(SheetSource);
  function SheetSource() {
    Sheet_classCallCheck(this, SheetSource);
    return _super3.apply(this, arguments);
  }
  Sheet_createClass(SheetSource, [{
    key: "render",
    value: function render() {
      var sectionClasses = external_classnames_default()("SheetSource", this.props.highlighted ? "highlight" : null, this.props.source.options ? this.props.source.options.indented : null);
      var containerClasses = external_classnames_default()("sheetItem", "segment", this.props.highlighted ? "highlight" : null, this.props.source.text && this.props.source.text.en && this.props.source.text.en.stripHtml() === "..." || this.props.source.text && (!this.props.source.text.en || !this.props.source.text.en.stripHtml()) ? "heOnly" : null, this.props.source.text && this.props.source.text.he && this.props.source.text.he.stripHtml() === "..." || this.props.source.text && (!this.props.source.text.he || !this.props.source.text.he.stripHtml()) ? "enOnly" : null, this.props.source.options && this.props.source.options.refDisplayPosition ? "ref-display-" + this.props.source.options.refDisplayPosition : null);
      return /*#__PURE__*/external_react_default().createElement("section", {
        className: sectionClasses,
        style: {
          "borderColor": sefaria.palette.refColor(this.props.source.ref)
        }
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: containerClasses,
        onClick: this.props.sheetSourceClick,
        "data-node": this.props.source.node,
        "aria-label": "Click to see connections to this source",
        tabIndex: "0",
        onKeyPress: function (e) {
          e.charCode === 13 ? this.props.sheetSourceClick(e) : null;
        }.bind(this)
      }, this.props.source.title ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "customSourceTitle",
        role: "heading",
        "aria-level": "3"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "titleBox"
      }, this.props.source.title.stripHtml())) : null, this.props.source.text && this.props.source.text.he && this.props.source.text.he !== "" ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "he"
      }, this.props.source.options && this.props.source.options.sourcePrefix && this.props.source.options.sourcePrefix != "" ? /*#__PURE__*/external_react_default().createElement("sup", {
        className: "sourcePrefix"
      }, this.props.source.options.sourcePrefix) : null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "ref"
      }, this.props.source.options && this.props.source.options.PrependRefWithHe ? this.props.source.options.PrependRefWithHe : null, /*#__PURE__*/external_react_default().createElement("a", {
        href: "/" + sefaria.normRef(this.props.source.ref)
      }, this.props.source.heRef)), /*#__PURE__*/external_react_default().createElement("div", {
        className: "sourceContentText",
        dangerouslySetInnerHTML: {
          __html: sefaria.util.cleanHTML(this.props.source.text.he)
        }
      })) : null, this.props.source.text && this.props.source.text.en && this.props.source.text.en !== "" ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "en"
      }, this.props.source.options && this.props.source.options.sourcePrefix && this.props.source.options.sourcePrefix != "" ? /*#__PURE__*/external_react_default().createElement("sup", {
        className: "sourcePrefix"
      }, this.props.source.options.sourcePrefix) : null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "ref"
      }, this.props.source.options && this.props.source.options.PrependRefWithEn ? this.props.source.options.PrependRefWithEn : null, /*#__PURE__*/external_react_default().createElement("a", {
        href: "/" + sefaria.normRef(this.props.source.ref)
      }, this.props.source.ref)), /*#__PURE__*/external_react_default().createElement("div", {
        className: "sourceContentText",
        dangerouslySetInnerHTML: {
          __html: sefaria.util.cleanHTML(this.props.source.text.en)
        }
      })) : null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "clearFix"
      }), this.props.source.addedBy ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "addedBy"
      }, /*#__PURE__*/external_react_default().createElement("small", null, /*#__PURE__*/external_react_default().createElement("em", null, sefaria._("Added by"), ": ", /*#__PURE__*/external_react_default().createElement("span", {
        dangerouslySetInnerHTML: {
          __html: sefaria.util.cleanHTML(this.props.source.userLink)
        }
      })))) : null));
    }
  }]);
  return SheetSource;
}((external_react_class_default()));
var SheetComment = /*#__PURE__*/function (_Component4) {
  Sheet_inherits(SheetComment, _Component4);
  var _super4 = Sheet_createSuper(SheetComment);
  function SheetComment() {
    Sheet_classCallCheck(this, SheetComment);
    return _super4.apply(this, arguments);
  }
  Sheet_createClass(SheetComment, [{
    key: "render",
    value: function render() {
      var lang = sefaria.hebrew.isHebrew(this.props.source.comment.stripHtml().replace(/\s+/g, ' ')) ? "he" : "en";
      var containerClasses = external_classnames_default()("sheetItem", "segment", lang == "he" ? "heOnly" : "enOnly", this.props.highlightedNode == this.props.source.node ? "highlight" : null, this.props.source.options ? this.props.source.options.indented : null);
      return /*#__PURE__*/external_react_default().createElement("section", {
        className: "SheetComment"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: containerClasses,
        "data-node": this.props.source.node,
        onClick: this.props.sheetSourceClick,
        "aria-label": "Click to see " + this.props.linkCount + " connections to this source",
        tabIndex: "0",
        onKeyPress: function (e) {
          e.charCode == 13 ? this.props.sheetSourceClick(e) : null;
        }.bind(this)
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: lang
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sourceContentText",
        dangerouslySetInnerHTML: {
          __html: sefaria.util.cleanHTML(this.props.source.comment)
        }
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "clearFix"
      }), this.props.source.addedBy ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "addedBy"
      }, /*#__PURE__*/external_react_default().createElement("small", null, /*#__PURE__*/external_react_default().createElement("em", null, sefaria._("Added by"), ": ", /*#__PURE__*/external_react_default().createElement("span", {
        dangerouslySetInnerHTML: {
          __html: sefaria.util.cleanHTML(this.props.source.userLink)
        }
      })))) : null));
    }
  }]);
  return SheetComment;
}((external_react_class_default()));
var SheetHeader = /*#__PURE__*/function (_Component5) {
  Sheet_inherits(SheetHeader, _Component5);
  var _super5 = Sheet_createSuper(SheetHeader);
  function SheetHeader() {
    Sheet_classCallCheck(this, SheetHeader);
    return _super5.apply(this, arguments);
  }
  Sheet_createClass(SheetHeader, [{
    key: "render",
    value: function render() {
      var lang = sefaria.hebrew.isHebrew(this.props.source.outsideText.stripHtml().replace(/\s+/g, ' ')) ? "he" : "en";
      var containerClasses = external_classnames_default()("sheetItem", "segment", lang == "he" ? "heOnly" : "enOnly", this.props.highlightedNode === this.props.source.node ? "highlight" : null, this.props.source.options ? this.props.source.options.indented : null);
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: containerClasses,
        "data-node": this.props.source.node,
        onClick: this.props.sheetSourceClick,
        "aria-label": "Click to see " + this.props.linkCount + " connections to this source",
        tabIndex: "0",
        onKeyPress: function (e) {
          e.charCode == 13 ? this.props.sheetSourceClick(e) : null;
        }.bind(this)
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: lang
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sourceContentText"
      }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement("span", null, this.props.source.outsideText.stripHtml())))));
    }
  }]);
  return SheetHeader;
}((external_react_class_default()));
var SheetOutsideText = /*#__PURE__*/function (_Component6) {
  Sheet_inherits(SheetOutsideText, _Component6);
  var _super6 = Sheet_createSuper(SheetOutsideText);
  function SheetOutsideText() {
    Sheet_classCallCheck(this, SheetOutsideText);
    return _super6.apply(this, arguments);
  }
  Sheet_createClass(SheetOutsideText, [{
    key: "shouldPassClick",
    value: function shouldPassClick(e) {
      var target = e.target.closest('a');
      if (target) {
        return;
      } else {
        this.props.sheetSourceClick(this.props.source);
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this;
      var lang = sefaria.hebrew.isHebrew(this.props.source.outsideText.stripHtml().replace(/\s+/g, ' ')) ? "he" : "en";
      var containerClasses = external_classnames_default()("sheetItem", "segment", lang == "he" ? "heOnly" : "enOnly", this.props.highlightedNode === this.props.source.node ? "highlight" : null, this.props.source.options ? this.props.source.options.indented : null);
      return /*#__PURE__*/external_react_default().createElement("section", {
        className: "SheetOutsideText"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: containerClasses,
        "data-node": this.props.source.node,
        onClick: function onClick(e) {
          return _this2.shouldPassClick(e);
        },
        "aria-label": "Click to see " + this.props.linkCount + " connections to this source",
        tabIndex: "0",
        onKeyPress: function (e) {
          e.charCode == 13 ? this.props.sheetSourceClick(e) : null;
        }.bind(this)
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: lang
      }, this.props.source.options && this.props.source.options.sourcePrefix && this.props.source.options.sourcePrefix != "" ? /*#__PURE__*/external_react_default().createElement("sup", {
        className: "sourcePrefix"
      }, this.props.source.options.sourcePrefix) : null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sourceContentText",
        dangerouslySetInnerHTML: {
          __html: sefaria.util.cleanHTML(this.props.source.outsideText)
        }
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "clearFix"
      }), this.props.source.addedBy ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "addedBy"
      }, /*#__PURE__*/external_react_default().createElement("small", null, /*#__PURE__*/external_react_default().createElement("em", null, sefaria._("Added by"), ": ", /*#__PURE__*/external_react_default().createElement("span", {
        dangerouslySetInnerHTML: {
          __html: sefaria.util.cleanHTML(this.props.source.userLink)
        }
      })))) : null));
    }
  }]);
  return SheetOutsideText;
}((external_react_class_default()));
var SheetOutsideBiText = /*#__PURE__*/function (_Component7) {
  Sheet_inherits(SheetOutsideBiText, _Component7);
  var _super7 = Sheet_createSuper(SheetOutsideBiText);
  function SheetOutsideBiText() {
    Sheet_classCallCheck(this, SheetOutsideBiText);
    return _super7.apply(this, arguments);
  }
  Sheet_createClass(SheetOutsideBiText, [{
    key: "render",
    value: function render() {
      var containerClasses = external_classnames_default()("sheetItem", "segment", this.props.source.outsideBiText.en && this.props.source.outsideBiText.en.stripHtml() === "..." || !this.props.source.outsideBiText.en.stripHtml() ? "heOnly" : null, this.props.source.outsideBiText.he && this.props.source.outsideBiText.he.stripHtml() === "..." || !this.props.source.outsideBiText.he.stripHtml() ? "enOnly" : null, this.props.highlightedNode == this.props.source.node ? "highlight" : null);
      var sectionClasses = external_classnames_default()("SheetOutsideBiText", this.props.source.options ? this.props.source.options.indented : null);
      return /*#__PURE__*/external_react_default().createElement("section", {
        className: sectionClasses
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: containerClasses,
        "data-node": this.props.source.node,
        onClick: this.props.sheetSourceClick,
        "aria-label": "Click to see " + this.props.linkCount + " connections to this source",
        tabIndex: "0",
        onKeyPress: function (e) {
          e.charCode == 13 ? this.props.sheetSourceClick(e) : null;
        }.bind(this)
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "he"
      }, this.props.source.options && this.props.source.options.sourcePrefix && this.props.source.options.sourcePrefix != "" ? /*#__PURE__*/external_react_default().createElement("sup", {
        className: "sourcePrefix"
      }, this.props.source.options.sourcePrefix) : null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sourceContentText outsideBiText",
        dangerouslySetInnerHTML: {
          __html: sefaria.util.cleanHTML(this.props.source.outsideBiText.he)
        }
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "en"
      }, this.props.source.options && this.props.source.options.sourcePrefix && this.props.source.options.sourcePrefix != "" ? /*#__PURE__*/external_react_default().createElement("sup", {
        className: "sourcePrefix"
      }, this.props.source.options.sourcePrefix) : null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sourceContentText outsideBiText",
        dangerouslySetInnerHTML: {
          __html: sefaria.util.cleanHTML(this.props.source.outsideBiText.en)
        }
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "clearFix"
      }), this.props.source.addedBy ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "addedBy"
      }, /*#__PURE__*/external_react_default().createElement("small", null, /*#__PURE__*/external_react_default().createElement("em", null, sefaria._("Added by"), ": ", /*#__PURE__*/external_react_default().createElement("span", {
        dangerouslySetInnerHTML: {
          __html: sefaria.util.cleanHTML(this.props.source.userLink)
        }
      })))) : null));
    }
  }]);
  return SheetOutsideBiText;
}((external_react_class_default()));
var SheetMedia = /*#__PURE__*/function (_Component8) {
  Sheet_inherits(SheetMedia, _Component8);
  var _super8 = Sheet_createSuper(SheetMedia);
  function SheetMedia() {
    Sheet_classCallCheck(this, SheetMedia);
    return _super8.apply(this, arguments);
  }
  Sheet_createClass(SheetMedia, [{
    key: "makeMediaEmbedContent",
    value: function makeMediaEmbedContent() {
      var mediaLink;
      var mediaCaption = "";
      var mediaClass = "media fullWidth";
      var mediaURL = this.props.source.media;
      var caption = this.props.source.caption;
      if (this.isImage()) {
        mediaLink = '<img class="addedMedia" src="' + mediaURL + '" />';
      } else if (mediaURL.match(/https?:\/\/www\.youtube\.com\/embed\/.+?rel=0(&amp;|&)showinfo=0$/i) != null) {
        mediaLink = '<div class="youTubeContainer"><iframe width="100%" height="100%" src=' + mediaURL + ' frameborder="0" allowfullscreen></iframe></div>';
      } else if (mediaURL.toLowerCase().match(/https?:\/\/player\.vimeo\.com\/.*/i) != null) {
        mediaLink = '<div class="youTubeContainer"><iframe width="100%" height="100%" src=' + mediaURL + ' frameborder="0"  allow="autoplay; fullscreen" allowfullscreen></iframe></div>';
      } else if (mediaURL.match(/https?:\/\/w\.soundcloud\.com\/player\/\?url=.*/i) != null) {
        mediaLink = '<iframe width="100%" height="166" scrolling="no" frameborder="no" src="' + mediaURL + '"></iframe>';
      } else if (mediaURL.match(/\.(mp3)$/i) != null) {
        mediaLink = '<audio src="' + mediaURL + '" type="audio/mpeg" controls>Your browser does not support the audio element.</audio>';
      } else {
        mediaLink = 'Error loading media...';
      }
      if (caption && (caption.en || caption.he)) {
        var cls = caption.en && caption.he ? "" : caption.en ? "enOnly" : "heOnly";
        mediaCaption = "<div class='mediaCaption " + cls + "'><div class='mediaCaptionInner'>" + "<div class='en'>" + (caption.en || "") + "</div>" + "<div class='he'>" + (caption.he || "") + "</div>" + "</div></div>";
      }
      return "<div class='" + mediaClass + "'>" + mediaLink + mediaCaption + "</div>";
    }
  }, {
    key: "isImage",
    value: function isImage() {
      return this.props.source.media.match(/\.(jpeg|jpg|gif|png)$/i) != null;
    }
  }, {
    key: "render",
    value: function render() {
      if (this.props.hideImages && this.isImage()) {
        return null;
      }
      var containerClasses = external_classnames_default()("sheetItem", "segment", this.props.highlightedNode === this.props.source.node ? "highlight" : null, this.props.source.options ? this.props.source.options.indented : null);
      return /*#__PURE__*/external_react_default().createElement("section", {
        className: "SheetMedia"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: containerClasses,
        "data-node": this.props.source.node,
        onClick: this.props.sheetSourceClick,
        "aria-label": "Click to  " + this.props.linkCount + " connections to this source",
        tabIndex: "0",
        onKeyPress: function (e) {
          e.charCode == 13 ? this.props.sheetSourceClick(e) : null;
        }.bind(this)
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sourceContentText centeredSheetContent",
        dangerouslySetInnerHTML: {
          __html: this.makeMediaEmbedContent()
        }
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "clearFix"
      }), this.props.source.addedBy ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "addedBy"
      }, /*#__PURE__*/external_react_default().createElement("small", null, /*#__PURE__*/external_react_default().createElement("em", null, sefaria._("Added by"), ": ", /*#__PURE__*/external_react_default().createElement("span", {
        dangerouslySetInnerHTML: {
          __html: sefaria.util.cleanHTML(this.props.source.userLink)
        }
      })))) : null));
    }
  }]);
  return SheetMedia;
}((external_react_class_default()));
var SheetNotice = /*#__PURE__*/function (_Component9) {
  Sheet_inherits(SheetNotice, _Component9);
  var _super9 = Sheet_createSuper(SheetNotice);
  function SheetNotice() {
    Sheet_classCallCheck(this, SheetNotice);
    return _super9.apply(this, arguments);
  }
  Sheet_createClass(SheetNotice, [{
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "sheetNotice sans-serif"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam arcu felis, molestie sed mauris a, hendrerit vestibulum augue."));
    }
  }]);
  return SheetNotice;
}((external_react_class_default()));
/* harmony default export */ const js_Sheet = (Sheet);
;// CONCATENATED MODULE: ../static/js/SheetMetadata.jsx
function SheetMetadata_typeof(obj) { "@babel/helpers - typeof"; return SheetMetadata_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, SheetMetadata_typeof(obj); }
function SheetMetadata_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ SheetMetadata_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == SheetMetadata_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function SheetMetadata_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function SheetMetadata_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { SheetMetadata_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { SheetMetadata_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function SheetMetadata_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = SheetMetadata_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function SheetMetadata_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return SheetMetadata_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return SheetMetadata_arrayLikeToArray(o, minLen); }
function SheetMetadata_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function SheetMetadata_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function SheetMetadata_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, SheetMetadata_toPropertyKey(descriptor.key), descriptor); } }
function SheetMetadata_createClass(Constructor, protoProps, staticProps) { if (protoProps) SheetMetadata_defineProperties(Constructor.prototype, protoProps); if (staticProps) SheetMetadata_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function SheetMetadata_toPropertyKey(arg) { var key = SheetMetadata_toPrimitive(arg, "string"); return SheetMetadata_typeof(key) === "symbol" ? key : String(key); }
function SheetMetadata_toPrimitive(input, hint) { if (SheetMetadata_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (SheetMetadata_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function SheetMetadata_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) SheetMetadata_setPrototypeOf(subClass, superClass); }
function SheetMetadata_setPrototypeOf(o, p) { SheetMetadata_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return SheetMetadata_setPrototypeOf(o, p); }
function SheetMetadata_createSuper(Derived) { var hasNativeReflectConstruct = SheetMetadata_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = SheetMetadata_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = SheetMetadata_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return SheetMetadata_possibleConstructorReturn(this, result); }; }
function SheetMetadata_possibleConstructorReturn(self, call) { if (call && (SheetMetadata_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return SheetMetadata_assertThisInitialized(self); }
function SheetMetadata_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function SheetMetadata_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function SheetMetadata_getPrototypeOf(o) { SheetMetadata_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return SheetMetadata_getPrototypeOf(o); }












var SheetMetadata = /*#__PURE__*/function (_Component) {
  SheetMetadata_inherits(SheetMetadata, _Component);
  var _super = SheetMetadata_createSuper(SheetMetadata);
  // Menu for the Table of Contents for a single text
  function SheetMetadata(props) {
    var _this;
    SheetMetadata_classCallCheck(this, SheetMetadata);
    _this = _super.call(this, props);
    _this.loadSaved();
    _this.state = {
      sheetCopyStatus: "Copy",
      copiedSheetId: null,
      sheetSaves: null,
      sheetLikeAdjustment: 0,
      showCollectionsModal: false,
      tags: [],
      suggestions: [],
      summary: '',
      validationFailed: 'none',
      validationMsg: '',
      published: null,
      lastModified: null
    };
    _this.reactTags = /*#__PURE__*/external_react_default().createRef();
    _this.debouncedSaveSummary = sefaria.util.debounce(_this.saveSummary, 250);
    return _this;
  }
  SheetMetadata_createClass(SheetMetadata, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this._isMounted = true;
      var sheet = this.getSheetFromCache();
      var tags = sheet.topics.map(function (topic, i) {
        return {
          id: i,
          name: topic["asTyped"],
          slug: topic["slug"]
        };
      });
      this.setState({
        tags: tags,
        summary: sheet.summary,
        published: sheet.status == "public",
        lastModified: sheet.dateModified
      });
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this._isMounted = false;
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (this.props.settingsLanguage != prevProps.settingsLanguage) {
        this.forceUpdate();
      }
    }
  }, {
    key: "loadSaved",
    value: function loadSaved() {
      var _this2 = this;
      sefaria.getRefSavedHistory("Sheet " + this.props.id).then(function (data) {
        var sheetSaves = [];
        var _iterator = SheetMetadata_createForOfIteratorHelper(data),
          _step;
        try {
          for (_iterator.s(); !(_step = _iterator.n()).done;) {
            var hist = _step.value;
            sheetSaves.push(hist["uid"]);
          }
        } catch (err) {
          _iterator.e(err);
        } finally {
          _iterator.f();
        }
        if (_this2._isMounted) {
          _this2.setState({
            sheetSaves: sheetSaves
          });
        }
      });
    }
  }, {
    key: "getSheetFromCache",
    value: function getSheetFromCache() {
      return sefaria.sheets.loadSheetByID(this.props.id);
    }
  }, {
    key: "getSheetFromAPI",
    value: function getSheetFromAPI() {
      sefaria.sheets.loadSheetByID(this.props.id, this.onDataLoad);
    }
  }, {
    key: "onDataLoad",
    value: function onDataLoad(data) {
      this.forceUpdate();
    }
  }, {
    key: "updateSheetTags",
    value: function updateSheetTags() {}
  }, {
    key: "isFormValidated",
    value: function isFormValidated() {
      if ((!this.state.summary || this.state.summary.trim() == '') && this.state.tags.length == 0) {
        this.setState({
          validationMsg: sefaria._("Please add a description and topics to publish your sheet."),
          validationFailed: "both"
        });
        return false;
      } else if (!this.state.summary || this.state.summary.trim() == '') {
        this.setState({
          validationMsg: sefaria._("Please add a description to publish your sheet."),
          validationFailed: "summary"
        });
        return false;
      } else if (this.state.tags.length == 0) {
        this.setState({
          validationMsg: sefaria._("Please add topics to publish your sheet."),
          validationFailed: "topics"
        });
        return false;
      } else {
        this.setState({
          validationMsg: "",
          validationFailed: "none"
        });
        return true;
      }
    }
  }, {
    key: "togglePublish",
    value: function () {
      var _togglePublish = SheetMetadata_asyncToGenerator( /*#__PURE__*/SheetMetadata_regeneratorRuntime().mark(function _callee() {
        var _this3 = this;
        var newPublishState, updatedSheet, postJSON;
        return SheetMetadata_regeneratorRuntime().wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              if (this.state.published) {
                _context.next = 3;
                break;
              }
              if (this.isFormValidated()) {
                _context.next = 3;
                break;
              }
              return _context.abrupt("return");
            case 3:
              newPublishState = this.state.published ? "unlisted" : "public";
              _context.next = 6;
              return new Promise(function (resolve, reject) {
                return sefaria.sheets.loadSheetByID(_this3.props.id, function (sheet) {
                  return resolve(sheet);
                });
              });
            case 6:
              updatedSheet = _context.sent;
              updatedSheet.status = newPublishState;
              updatedSheet.lastModified = this.state.lastModified;
              delete updatedSheet._id;
              this.setState({
                published: !this.state.published
              });
              postJSON = JSON.stringify(updatedSheet);
              this.postSheet(postJSON);
            case 13:
            case "end":
              return _context.stop();
          }
        }, _callee, this);
      }));
      function togglePublish() {
        return _togglePublish.apply(this, arguments);
      }
      return togglePublish;
    }()
  }, {
    key: "loadSheetData",
    value: function loadSheetData(sheetID) {
      if (sefaria.sheets.loadSheetByID(sheetID)) {
        return sefaria.sheets.loadSheetByID(sheetID);
      } else {
        sefaria.sheets.loadSheetByID(sheetID, function (data) {
          return data;
        });
      }
    }
  }, {
    key: "copySheet",
    value: function copySheet() {
      if (!sefaria._uid) {
        this.props.toggleSignUpModal(SignUpModalKind.AddToSheet);
      } else if (this.state.sheetCopyStatus == "Copy") {
        this.setState({
          sheetCopyStatus: "Copying..."
        });
        this.filterAndSaveCopiedSheetData(this.loadSheetData(this.props.id));
      }
    }
  }, {
    key: "postSheet",
    value: function postSheet(postJSON) {
      var _this4 = this;
      sefariaJquery.post("/api/sheets/", {
        "json": postJSON
      }, function (data) {
        if (data.id) {
          console.log('saved...');
          _this4.setState({
            lastModified: data.dateModified
          });
          sefaria.sheets._loadSheetByID[data.id] = data;
        } else {
          console.log(data);
        }
      });
    }
  }, {
    key: "filterAndSaveCopiedSheetData",
    value: function filterAndSaveCopiedSheetData(data) {
      var _this5 = this;
      var newSheet = sefaria.util.clone(data);
      newSheet.status = "unlisted";
      newSheet.title = newSheet.title + " (Copy)";
      if (sefaria._uid != newSheet.owner) {
        newSheet.via = this.props.id;
        newSheet.viaOwner = newSheet.owner;
        newSheet.owner = sefaria._uid;
      }
      delete newSheet.id;
      delete newSheet.ownerName;
      delete newSheet.views;
      delete newSheet.dateCreated;
      delete newSheet.dateModified;
      delete newSheet.displayedCollection;
      delete newSheet.collectionName;
      delete newSheet.collectionImage;
      delete newSheet.likes;
      delete newSheet.promptedToPublish;
      delete newSheet._id;
      var postJSON = JSON.stringify(newSheet);
      sefariaJquery.post("/api/sheets/", {
        "json": postJSON
      }, function (data) {
        if (data.id) {
          _this5.setState({
            sheetCopyStatus: "Copied",
            copiedSheetId: data.id
          });
        } else if ("error" in data) {
          console.log(data.error);
        }
      });
    }
  }, {
    key: "toggleCollectionsModal",
    value: function toggleCollectionsModal() {
      if (!sefaria._uid) {
        this.props.toggleSignUpModal(SignUpModalKind.AddToSheet);
      } else {
        this.setState({
          showCollectionsModal: !this.state.showCollectionsModal
        });
      }
    }
  }, {
    key: "updateTopics",
    value: function () {
      var _updateTopics = SheetMetadata_asyncToGenerator( /*#__PURE__*/SheetMetadata_regeneratorRuntime().mark(function _callee2(tags) {
        var _this6 = this;
        var updatedSheet, topics, postJSON;
        return SheetMetadata_regeneratorRuntime().wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              _context2.next = 2;
              return new Promise(function (resolve, reject) {
                return sefaria.sheets.loadSheetByID(_this6.props.id, function (sheet) {
                  return resolve(sheet);
                });
              });
            case 2:
              updatedSheet = _context2.sent;
              topics = tags.map(function (tag) {
                return {
                  asTyped: tag.name,
                  slug: tag.slug
                };
              });
              updatedSheet.topics = topics;
              updatedSheet.lastModified = this.state.lastModified;
              delete updatedSheet._id;
              delete updatedSheet.error;
              postJSON = JSON.stringify(updatedSheet);
              this.postSheet(postJSON);
            case 10:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this);
      }));
      function updateTopics(_x) {
        return _updateTopics.apply(this, arguments);
      }
      return updateTopics;
    }()
  }, {
    key: "onTagDelete",
    value: function onTagDelete(i) {
      var tags = this.state.tags.slice(0);
      tags.splice(i, 1);
      this.setState({
        tags: tags
      });
      this.updateTopics(tags);
    }
  }, {
    key: "onTagAddition",
    value: function onTagAddition(tag) {
      var tags = [].concat(this.state.tags, tag);
      this.setState({
        tags: tags
      });
      this.updateTopics(tags);
    }
  }, {
    key: "onTagValidate",
    value: function onTagValidate(tag) {
      return this.state.tags.every(function (item) {
        return item.name !== tag.name;
      });
    }
  }, {
    key: "updateSuggestedTags",
    value: function updateSuggestedTags(input) {
      var _this7 = this;
      if (input == "") return;
      sefaria.getName(input, false, 0).then(function (d) {
        var topics = d.completion_objects.filter(function (obj) {
          return obj.type === "Topic";
        }).map(function (filteredObj, index) {
          return {
            id: index,
            name: filteredObj.title,
            slug: filteredObj.key
          };
        });
        return topics;
      }).then(function (topics) {
        return _this7.setState({
          suggestions: topics
        });
      });
    }
  }, {
    key: "saveSummary",
    value: function () {
      var _saveSummary = SheetMetadata_asyncToGenerator( /*#__PURE__*/SheetMetadata_regeneratorRuntime().mark(function _callee3() {
        var _this8 = this;
        var updatedSheet, postJSON;
        return SheetMetadata_regeneratorRuntime().wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              _context3.next = 2;
              return new Promise(function (resolve, reject) {
                return sefaria.sheets.loadSheetByID(_this8.props.id, function (sheet) {
                  return resolve(sheet);
                });
              });
            case 2:
              updatedSheet = _context3.sent;
              updatedSheet.summary = this.state.summary;
              updatedSheet.lastModified = this.state.lastModified;
              delete updatedSheet._id;
              postJSON = JSON.stringify(updatedSheet);
              this.postSheet(postJSON);
            case 8:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this);
      }));
      function saveSummary() {
        return _saveSummary.apply(this, arguments);
      }
      return saveSummary;
    }()
  }, {
    key: "handleSummaryChange",
    value: function handleSummaryChange(event) {
      var newSummary = event.target.value;
      if (event.target.value.length > 280) {
        this.setState({
          validationMsg: sefaria._("The summary description is limited to 280 characters."),
          validationFailed: "summary"
        });
      } else {
        this.setState({
          validationMsg: "",
          validationFailed: "none"
        });
      }
      this.setState({
        summary: newSummary
      });
      this.debouncedSaveSummary();
    }
  }, {
    key: "render",
    value: function render() {
      var sheet = this.getSheetFromCache();
      if (!sheet) {
        return /*#__PURE__*/external_react_default().createElement(LoadingMessage, null);
      }
      var timestampCreated = Date.parse(sheet.dateCreated) / 1000;
      var canEdit = sefaria._uid == sheet.owner;
      var title = sheet.title;

      // Text Details
      var details = sheet.summary;
      var closeClick = this.props.close;
      var classes = external_classnames_default()({
        bookPage: 1,
        sheetPage: 1,
        readerNavMenu: 1,
        narrowPanel: this.props.narrowPanel,
        noLangToggleInHebrew: this.props.interfaceLang == 'hebrew',
        "sans-serif": 1
      });
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: classes
      }, /*#__PURE__*/external_react_default().createElement(CategoryColorLine, {
        category: "Sheets"
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerControls"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerControlsInner"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "leftButtons"
      }, /*#__PURE__*/external_react_default().createElement(CloseButton, {
        onClick: closeClick
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerTextToc readerTextTocHeader"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerTextTocBox"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Table of Contents"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05EA\u05D5\u05DB\u05DF \u05D4\u05E2\u05E0\u05D9\u05D9\u05E0\u05D9\u05DD"))), /*#__PURE__*/external_react_default().createElement("div", {
        className: "rightButtons"
      }, this.props.interfaceLang !== "hebrew" ? /*#__PURE__*/external_react_default().createElement(DisplaySettingsButton, {
        onClick: this.props.openDisplaySettings
      }) : /*#__PURE__*/external_react_default().createElement(DisplaySettingsButton, {
        placeholder: true
      })))), /*#__PURE__*/external_react_default().createElement("div", {
        className: "content"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "contentInner"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocTop"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocTitle serif",
        role: "heading",
        "aria-level": "1"
      }, /*#__PURE__*/external_react_default().createElement("span", null, title.stripHtmlConvertLineBreaks())), /*#__PURE__*/external_react_default().createElement("a", {
        className: "tocCategory serif",
        href: "/sheets"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "en"
      }, "Sheet"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "he"
      }, sefaria.hebrewTerm("Sheets"))), /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocDetail authorStatement"
      }, /*#__PURE__*/external_react_default().createElement(SheetAuthorStatement, {
        authorUrl: sheet.ownerProfileUrl,
        authorStatement: sheet.ownerName
      }, /*#__PURE__*/external_react_default().createElement(ProfilePic, {
        url: sheet.ownerImageUrl,
        len: 30,
        name: sheet.ownerName,
        outerStyle: {
          width: "30px",
          height: "30px",
          display: "inline-block",
          verticalAlign: "middle",
          marginRight: "10px"
        }
      }), /*#__PURE__*/external_react_default().createElement("a", {
        href: sheet.ownerProfileUrl
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, sheet.ownerName)))), sheet.displayedCollection ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocDetail authorStatement"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionListingImageBox imageBox"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: "/collections/" + sheet.displayedCollection
      }, /*#__PURE__*/external_react_default().createElement("img", {
        className: external_classnames_default()({
          collectionListingImage: 1,
          "img-circle": 1,
          "default": !sheet.collectionImage
        }),
        src: sheet.collectionImage || "/static/icons/collection.svg",
        alt: "Collection Logo"
      }))), /*#__PURE__*/external_react_default().createElement("a", {
        href: "/collections/" + sheet.displayedCollection
      }, sheet.collectionName)) : null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sheetMeta"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "int-en"
      }, "Created ", sefaria.util.naturalTime(timestampCreated, "en"), " ago \xB7 ", sheet.views, " Views \xB7 ", !!this.state.sheetSaves ? this.state.sheetSaves.length + this.state.sheetLikeAdjustment : '--', " Saves ", this.state.published ? null : /*#__PURE__*/external_react_default().createElement("span", {
        className: "unlisted"
      }, "\xB7 ", /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/img/eye-slash.svg"
      }), /*#__PURE__*/external_react_default().createElement("span", null, sefaria._("Not Published")))), /*#__PURE__*/external_react_default().createElement("div", {
        className: "int-he"
      }, /*#__PURE__*/external_react_default().createElement("span", null, "\u05E0\u05D5\u05E6\u05E8 \u05DC\u05E4\u05E0\u05D9  ", sefaria.util.naturalTime(timestampCreated, "he"), " \xB7 "), /*#__PURE__*/external_react_default().createElement("span", null, sheet.views, " \u05E6\u05E4\u05D9\u05D5\u05EA \xB7 "), /*#__PURE__*/external_react_default().createElement("span", null, " ", !!this.state.sheetSaves ? this.state.sheetSaves.length + this.state.sheetLikeAdjustment : '--', " \u05E9\u05DE\u05D9\u05E8\u05D5\u05EA "), " ", this.state.published ? null : /*#__PURE__*/external_react_default().createElement("span", {
        className: "unlisted"
      }, "\xB7 ", /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/img/eye-slash.svg"
      }), /*#__PURE__*/external_react_default().createElement("span", null, sefaria._("Not Published"))), "                      ")), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sheetMetaButtons"
      }, sefaria._uid == sheet.owner && !sefaria._uses_new_editor ? /*#__PURE__*/external_react_default().createElement("a", {
        href: "/sheets/" + sheet.id + "?editor=1",
        className: "button white",
        role: "button"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/tools-write-note.svg",
        alt: "edit sheet"
      }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Edit")) : null, /*#__PURE__*/external_react_default().createElement("a", {
        href: "#",
        className: "button white",
        onClick: this.copySheet
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/copy.svg",
        alt: "copy sheet"
      }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, this.state.sheetCopyStatus)), /*#__PURE__*/external_react_default().createElement("a", {
        href: "#",
        className: "button white",
        onClick: this.toggleCollectionsModal
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/plus.svg",
        alt: "copy sheet"
      }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Add to Collection")), sefaria._uid !== sheet.owner && !sefaria._uses_new_editor ? /*#__PURE__*/external_react_default().createElement("a", {
        href: "/sheets/" + sheet.id + "?editor=1",
        className: "button white",
        role: "button"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "View in Editor")) : null), this.state.sheetCopyStatus == "Copied" ? /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
        href: "/sheets/" + this.state.copiedSheetId
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "View Copy \xBB"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05E6\u05E4\u05D9\u05D9\u05D4 \u05D1\u05D4\u05E2\u05EA\u05E7 \xBB"))) : null, sefaria._uses_new_editor ? /*#__PURE__*/external_react_default().createElement("a", {
        className: "smallText",
        href: "/sheets/" + sheet.id + "?editor=1"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "View in the old sheets experience"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05EA\u05E6\u05D5\u05D2\u05D4 \u05D1\u05E4\u05D5\u05E8\u05DE\u05D8 \u05D4\u05D9\u05E9\u05DF \u05E9\u05DC \u05D3\u05E4\u05D9 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA")) : null, this.state.showCollectionsModal ? /*#__PURE__*/external_react_default().createElement(CollectionsModal, {
        sheetID: sheet.id,
        close: this.toggleCollectionsModal
      }) : null), /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocDetails sheetSummary"
      }, /*#__PURE__*/external_react_default().createElement("h3", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "About this Sheet")), details && !canEdit ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "description",
        dangerouslySetInnerHTML: {
          __html: details
        }
      }) : null), sheet.topics && sheet.topics.length > 0 && !canEdit ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "tocDetails tagsSection"
      }, /*#__PURE__*/external_react_default().createElement("h3", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Tags")), /*#__PURE__*/external_react_default().createElement("div", {
        className: "sheetTags"
      }, sheet.topics.map(function (topic, i) {
        return /*#__PURE__*/external_react_default().createElement("a", {
          href: "/topics/" + topic.slug,
          target: "_blank",
          className: "sheetTag button",
          key: i
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
          text: {
            en: topic.en,
            he: topic.he
          }
        }));
      }))) : null, canEdit ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "publishBox sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("h3", {
        className: "header"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, this.state.published ? "Publish Settings" : "Publish Sheet")), this.state.published ? /*#__PURE__*/external_react_default().createElement("p", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Your sheet is"), " ", /*#__PURE__*/external_react_default().createElement("strong", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "published")), " ", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "on Sefaria and visible to others through search and topics.")) : /*#__PURE__*/external_react_default().createElement("p", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "List your sheet on Sefaria for others to discover.")), /*#__PURE__*/external_react_default().createElement("hr", null), this.state.validationFailed == "none" ? null : /*#__PURE__*/external_react_default().createElement("p", {
        className: "error"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, this.state.validationMsg)), /*#__PURE__*/external_react_default().createElement("p", {
        className: "smallText"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Summary")), /*#__PURE__*/external_react_default().createElement("textarea", {
        className: this.state.validationFailed == "both" || this.state.validationFailed == "summary" ? "error" : "",
        rows: "3",
        maxLength: "281",
        placeholder: sefaria._("Write a short description of your sheet..."),
        value: this.state.summary,
        onChange: this.handleSummaryChange
      }), /*#__PURE__*/external_react_default().createElement("p", {
        className: "smallText"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Topics")), /*#__PURE__*/external_react_default().createElement("div", {
        className: this.state.validationFailed == "both" || this.state.validationFailed == "topics" ? "error" : ""
      }, /*#__PURE__*/external_react_default().createElement((external_react_tag_autocomplete_default()), {
        ref: this.reactTags,
        allowNew: true,
        tags: this.state.tags,
        suggestions: this.state.suggestions,
        onDelete: this.onTagDelete.bind(this),
        placeholderText: sefaria._("Add a topic..."),
        delimiters: ["Enter", "Tab", ","],
        onAddition: this.onTagAddition.bind(this),
        onValidate: this.onTagValidate.bind(this),
        onInput: this.updateSuggestedTags.bind(this)
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "publishButton"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: "#",
        className: this.state.published ? "button published" : "button",
        onClick: this.togglePublish
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, this.state.published ? "Unpublish" : "Publish")))) : null))));
    }
  }]);
  return SheetMetadata;
}((external_react_class_default()));
SheetMetadata.propTypes = {
  id: (external_prop_types_default()).number.isRequired,
  mode: (external_prop_types_default()).string.isRequired,
  settingsLanguage: (external_prop_types_default()).string.isRequired,
  versionLanguage: (external_prop_types_default()).string,
  version: (external_prop_types_default()).string,
  narrowPanel: (external_prop_types_default()).bool,
  close: (external_prop_types_default()).func.isRequired,
  openNav: (external_prop_types_default()).func.isRequired,
  showBaseText: (external_prop_types_default()).func.isRequired,
  selectVersion: (external_prop_types_default()).func,
  interfaceLang: (external_prop_types_default()).string
};
/* harmony default export */ const js_SheetMetadata = (SheetMetadata);
;// CONCATENATED MODULE: ../static/js/TopicPageAll.jsx
function TopicPageAll_typeof(obj) { "@babel/helpers - typeof"; return TopicPageAll_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, TopicPageAll_typeof(obj); }
function TopicPageAll_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = TopicPageAll_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function TopicPageAll_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return TopicPageAll_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TopicPageAll_arrayLikeToArray(o, minLen); }
function TopicPageAll_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function TopicPageAll_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function TopicPageAll_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, TopicPageAll_toPropertyKey(descriptor.key), descriptor); } }
function TopicPageAll_createClass(Constructor, protoProps, staticProps) { if (protoProps) TopicPageAll_defineProperties(Constructor.prototype, protoProps); if (staticProps) TopicPageAll_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function TopicPageAll_toPropertyKey(arg) { var key = TopicPageAll_toPrimitive(arg, "string"); return TopicPageAll_typeof(key) === "symbol" ? key : String(key); }
function TopicPageAll_toPrimitive(input, hint) { if (TopicPageAll_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (TopicPageAll_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function TopicPageAll_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) TopicPageAll_setPrototypeOf(subClass, superClass); }
function TopicPageAll_setPrototypeOf(o, p) { TopicPageAll_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return TopicPageAll_setPrototypeOf(o, p); }
function TopicPageAll_createSuper(Derived) { var hasNativeReflectConstruct = TopicPageAll_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = TopicPageAll_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = TopicPageAll_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return TopicPageAll_possibleConstructorReturn(this, result); }; }
function TopicPageAll_possibleConstructorReturn(self, call) { if (call && (TopicPageAll_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return TopicPageAll_assertThisInitialized(self); }
function TopicPageAll_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function TopicPageAll_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function TopicPageAll_getPrototypeOf(o) { TopicPageAll_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return TopicPageAll_getPrototypeOf(o); }









var TopicPageAll = /*#__PURE__*/function (_Component) {
  TopicPageAll_inherits(TopicPageAll, _Component);
  var _super = TopicPageAll_createSuper(TopicPageAll);
  function TopicPageAll(props) {
    var _this;
    TopicPageAll_classCallCheck(this, TopicPageAll);
    _this = _super.call(this, props);
    _this.state = {
      filter: '',
      loading: true,
      topicList: null
    };
    return _this;
  }
  TopicPageAll_createClass(TopicPageAll, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this2 = this;
      sefaria.topicList().then(function (topicList) {
        _this2.setState({
          loading: false,
          topicList: topicList
        });
      });
    }
  }, {
    key: "normalizeFilter",
    value: function normalizeFilter(filter) {
      return filter.toLowerCase();
    }
  }, {
    key: "handleFilterChange",
    value: function handleFilterChange(e) {
      this.setState({
        filter: this.normalizeFilter(e.currentTarget.value)
      });
    }
  }, {
    key: "resetFilter",
    value: function resetFilter() {
      this.setState({
        filter: ''
      });
      sefariaJquery(".topicFilterInput").val("");
    }
  }, {
    key: "render",
    value: function render() {
      var _this3 = this;
      var sidebarModules = [{
        type: "Promo"
      }, {
        type: "TrendingTopics"
      }, {
        type: "JoinTheConversation"
      }, {
        type: "GetTheApp"
      }, {
        type: "SupportSefaria"
      }];
      var hasFilter = this.state.filter.length > 1; // dont filter by one letter. not useful
      var isHeInt = sefaria.interfaceLang == "hebrew";
      var topicList = this.state.topicList ? this.state.topicList.filter(function (item) {
        if (item.shouldDisplay === false || item.numSources == 0) {
          return false;
        }
        if (!hasFilter) {
          var sortTitle = isHeInt ? item.primaryTitle.he : item.primaryTitle.en;
          return sortTitle.toLowerCase().startsWith(_this3.props.topicLetter);
        }
        var _iterator = TopicPageAll_createForOfIteratorHelper(item.normTitles),
          _step;
        try {
          for (_iterator.s(); !(_step = _iterator.n()).done;) {
            var title = _step.value;
            if (title.indexOf(_this3.state.filter) !== -1) {
              return true;
            }
          }
        } catch (err) {
          _iterator.e(err);
        } finally {
          _iterator.f();
        }
        return false;
      }).sort(function (a, b) {
        var lang = sefaria.interfaceLang.slice(0, 2);
        if (!hasFilter) {
          return b.primaryTitle[lang].stripNikkud() > a.primaryTitle[lang].stripNikkud() ? -1 : 1; // Alphabetical if no filter
        } else {
          return 0 + !!b.primaryTitle[lang] - (0 + !!a.primaryTitle[lang]); // Keep original order (# source), but sort current interface lang first
        }
      }).map(function (topic) {
        var openTopic = function openTopic(e) {
          e.preventDefault();
          _this3.props.setTopic(topic.slug, topic.primaryTitle);
        };
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "navBlock"
        }, /*#__PURE__*/external_react_default().createElement("a", {
          href: "/topics/".concat(topic.slug),
          className: "navBlockTitle",
          onClick: openTopic
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
          text: topic.primaryTitle
        })));
      }) : null;
      var inputClasses = external_classnames_default()({
        topicFilterInput: 1,
        en: !isHeInt,
        he: isHeInt
      });
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerNavMenu"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "content",
        onScroll: this.onScroll
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sidebarLayout"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "contentInner"
      }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "All Topics")), /*#__PURE__*/external_react_default().createElement("div", {
        className: "topicFilterBox"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        className: "searchIcon",
        src: "/static/icons/iconmonstr-magnifier-2.svg"
      }), /*#__PURE__*/external_react_default().createElement("input", {
        className: inputClasses,
        placeholder: sefaria._("Search Topics"),
        onChange: this.handleFilterChange
      }), this.state.filter.length ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "topicsFilterReset sans-serif",
        onClick: this.resetFilter
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Reset"), /*#__PURE__*/external_react_default().createElement("img", {
        className: "topicsFilterResetIcon",
        src: "/static/icons/circled-x.svg"
      })) : null), /*#__PURE__*/external_react_default().createElement(AlphabeticalTopicsNav, null), /*#__PURE__*/external_react_default().createElement("div", {
        className: "allTopicsList"
      }, topicList ? topicList.length ? /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
        content: topicList,
        initialWidth: this.props.initialWidth
      })) : /*#__PURE__*/external_react_default().createElement(LoadingMessage, {
        message: "There are no topics here.",
        heMessage: ""
      }) : /*#__PURE__*/external_react_default().createElement(LoadingMessage, null))), /*#__PURE__*/external_react_default().createElement(NavSidebar, {
        modules: sidebarModules
      })), /*#__PURE__*/external_react_default().createElement(js_Footer, null)));
    }
  }]);
  return TopicPageAll;
}((external_react_class_default()));
TopicPageAll.propTypes = {
  interfaceLang: (external_prop_types_default()).string,
  initialWidth: (external_prop_types_default()).number,
  mutliPanel: (external_prop_types_default()).bool,
  navHome: (external_prop_types_default()).func,
  toggleLanguage: (external_prop_types_default()).func,
  openDisplaySettings: (external_prop_types_default()).func
};
TopicPageAll.defaultProps = {
  initialWidth: 1000
};
var AlphabeticalTopicsNav = function AlphabeticalTopicsNav() {
  var letterRange = function letterRange(start, stop) {
    var result = [];
    for (var idx = start.charCodeAt(0), end = stop.charCodeAt(0); idx <= end; ++idx) {
      if (["ך", "ן", "ף", "ץ"].indexOf(String.fromCharCode(idx)) === -1) {
        result.push(String.fromCharCode(idx));
      }
    }
    return result;
  };
  var letters = sefaria.interfaceLang === "hebrew" ? letterRange("א", "ת") : letterRange("A", "Z");
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "alphabeticalTopicsNav sans-serif"
  }, letters.map(function (letter) {
    return /*#__PURE__*/external_react_default().createElement("a", {
      href: "/topics/all/" + letter.toLowerCase(),
      key: letter
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, letter));
  }));
};
/* harmony default export */ const js_TopicPageAll = (TopicPageAll);
;// CONCATENATED MODULE: ../static/js/TopicsPage.jsx











// The root topics page listing topic categories to browse
var TopicsPage = function TopicsPage(_ref) {
  var setNavTopic = _ref.setNavTopic,
    multiPanel = _ref.multiPanel,
    initialWidth = _ref.initialWidth;
  var categoryListings = sefaria.topic_toc.map(function (cat) {
    var openCat = function openCat(e) {
      e.preventDefault();
      setNavTopic(cat.slug, {
        en: cat.en,
        he: cat.he
      });
    };
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "navBlock"
    }, /*#__PURE__*/external_react_default().createElement("a", {
      href: "/topics/category/".concat(cat.slug),
      className: "navBlockTitle",
      onClick: openCat
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: cat
    })), /*#__PURE__*/external_react_default().createElement("div", {
      className: "navBlockDescription"
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: cat.categoryDescription
    })));
  });
  var letter = sefaria.interfaceLang === "hebrew" ? "א" : "a";
  categoryListings.push( /*#__PURE__*/external_react_default().createElement("div", {
    className: "navBlock"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/topics/all/" + letter,
    className: "navBlockTitle"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "All Topics A-Z")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "navBlockDescription"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Browse or search our complete list of topics."))));
  categoryListings = /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerNavCategories"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    content: categoryListings,
    initialWidth: initialWidth
  }));
  var about = multiPanel ? null : /*#__PURE__*/external_react_default().createElement(Modules, {
    type: "AboutTopics",
    props: {
      hideTitle: true
    }
  });
  var sidebarModules = [multiPanel ? {
    type: "AboutTopics"
  } : {
    type: null
  }, {
    type: "TrendingTopics"
  }, {
    type: "JoinTheConversation"
  }, {
    type: "GetTheApp"
  }, {
    type: "SupportSefaria"
  }];
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerNavMenu noLangToggleInHebrew",
    key: "0"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "content"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sidebarLayout"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "contentInner"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "navTitle tight sans-serif"
  }, /*#__PURE__*/external_react_default().createElement(CategoryHeader, {
    type: "topics",
    buttonsToDisplay: ["subcategory", "reorder"]
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Explore by Topic")))), about, categoryListings), /*#__PURE__*/external_react_default().createElement(NavSidebar, {
    modules: sidebarModules
  })), /*#__PURE__*/external_react_default().createElement(js_Footer, null)));
};
/* harmony default export */ const js_TopicsPage = (TopicsPage);
;// CONCATENATED MODULE: ../static/js/CollectionPage.jsx
function CollectionPage_typeof(obj) { "@babel/helpers - typeof"; return CollectionPage_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, CollectionPage_typeof(obj); }
function CollectionPage_slicedToArray(arr, i) { return CollectionPage_arrayWithHoles(arr) || CollectionPage_iterableToArrayLimit(arr, i) || CollectionPage_unsupportedIterableToArray(arr, i) || CollectionPage_nonIterableRest(); }
function CollectionPage_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function CollectionPage_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return CollectionPage_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return CollectionPage_arrayLikeToArray(o, minLen); }
function CollectionPage_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function CollectionPage_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function CollectionPage_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function CollectionPage_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function CollectionPage_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, CollectionPage_toPropertyKey(descriptor.key), descriptor); } }
function CollectionPage_createClass(Constructor, protoProps, staticProps) { if (protoProps) CollectionPage_defineProperties(Constructor.prototype, protoProps); if (staticProps) CollectionPage_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function CollectionPage_toPropertyKey(arg) { var key = CollectionPage_toPrimitive(arg, "string"); return CollectionPage_typeof(key) === "symbol" ? key : String(key); }
function CollectionPage_toPrimitive(input, hint) { if (CollectionPage_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (CollectionPage_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function CollectionPage_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) CollectionPage_setPrototypeOf(subClass, superClass); }
function CollectionPage_setPrototypeOf(o, p) { CollectionPage_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return CollectionPage_setPrototypeOf(o, p); }
function CollectionPage_createSuper(Derived) { var hasNativeReflectConstruct = CollectionPage_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = CollectionPage_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = CollectionPage_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return CollectionPage_possibleConstructorReturn(this, result); }; }
function CollectionPage_possibleConstructorReturn(self, call) { if (call && (CollectionPage_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return CollectionPage_assertThisInitialized(self); }
function CollectionPage_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function CollectionPage_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function CollectionPage_getPrototypeOf(o) { CollectionPage_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return CollectionPage_getPrototypeOf(o); }










var CollectionPage = /*#__PURE__*/function (_Component) {
  CollectionPage_inherits(CollectionPage, _Component);
  var _super = CollectionPage_createSuper(CollectionPage);
  function CollectionPage(props) {
    var _this;
    CollectionPage_classCallCheck(this, CollectionPage);
    _this = _super.call(this, props);
    var collectionData = sefaria.getCollectionFromCache(props.slug);
    _this.state = {
      tab: props.tab,
      showFilterHeader: !!props.tag,
      sheetFilterTopic: props.tag || '',
      collectionData: collectionData
    };
    _this.scrollableRef = /*#__PURE__*/external_react_default().createRef();
    return _this;
  }
  CollectionPage_createClass(CollectionPage, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.loadData();
      if (!!this.props.tag & !this.props.tab) {
        this.props.setTab("sheets");
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (this.props.slug !== prevProps.slug) {
        this.setState({
          collectionData: null
        });
        this.loadData();
      }
      if (this.props.tab != prevProps.tab) {
        this.setState({
          tab: this.props.tab
        });
      }
      if (prevState.sheetFilterTopic !== this.state.sheetFilterTopic && sefariaJquery(".content").scrollTop() > 260) {
        sefariaJquery(".content").scrollTop(0);
      }
    }
  }, {
    key: "loadData",
    value: function loadData() {
      var _this2 = this;
      sefaria.getCollection(this.props.slug).then(function (collectionData) {
        _this2.setState({
          collectionData: collectionData
        });
        _this2.props.updateCollectionName(collectionData.name);
      });
    }
  }, {
    key: "onDataChange",
    value: function onDataChange() {
      this.setState({
        collectionData: sefaria._collections[this.props.slug]
      });
    }
  }, {
    key: "setFilter",
    value: function setFilter(filter) {
      this.setState({
        sheetFilterTopic: filter,
        showFilterHeader: true
      });
      this.props.setTab("sheets");
    }
  }, {
    key: "memberList",
    value: function memberList() {
      var collection = this.state.collectionData;
      if (!collection) {
        return null;
      }
      var admins = collection.admins.map(function (member) {
        member.role = "Owner";
        return member;
      });
      var members = collection.members.map(function (member) {
        member.role = "Editor";
        return member;
      });
      var invitations = collection.invitations.map(function (member) {
        member.role = "Invitation";
        return member;
      });
      return admins.concat(members, invitations);
    }
  }, {
    key: "isMember",
    value: function isMember() {
      var members = this.memberList();
      return members && members.filter(function (x) {
        return x.uid == sefaria._uid;
      }).length !== 0;
    }
  }, {
    key: "pinSheet",
    value: function pinSheet(sheetId) {
      if (this.pinning) {
        return;
      }
      sefariaJquery.post("/api/collections/" + this.props.slug + "/pin-sheet/" + sheetId, function (data) {
        if ("error" in data) {
          alert(data.error);
        } else {
          sefaria._collections[this.props.slug] = data.collection;
          this.setState({
            collectionData: data.collection
          });
        }
        this.pinning = false;
      }.bind(this)).fail(function () {
        alert(sefaria._("There was an error pinning your sheet."));
        this.pinning = false;
      }.bind(this));
      this.pinning = true;
    }
  }, {
    key: "sortSheets",
    value: function sortSheets(option, a, b) {
      var _this3 = this;
      // if x is not pinned, indexOf will return -1. Add 1 to make it zero and then convert to very high number so it will be sorted after pinned sheets
      var _map = [a, b].map(function (x) {
          return _this3.state.collectionData.pinnedSheets.indexOf(x.id) + 1 || 1e7;
        }),
        _map2 = CollectionPage_slicedToArray(_map, 2),
        ai = _map2[0],
        bi = _map2[1];
      if (ai !== bi) {
        return ai - bi;
      } else if (option == "Recent") {
        return Date.parse(b.modified) - Date.parse(a.modified);
      } else if (option === "Alphabetical") {
        return a.title.stripHtml().trim().toLowerCase() > b.title.stripHtml().trim().toLowerCase() ? 1 : -1;
      } else if (option === "Views") {
        return b.views - a.views;
      }
    }
  }, {
    key: "filterSheets",
    value: function filterSheets(filter, sheet) {
      //generally speaking we want to filter also by partial match of a tag, but there are cases where we want to load only sheets that match a passed in tag. |
      //one such case is someone clicked a tag in the pinned tags view for the collection. For example if someone wants פורים they shouldnt get סיפורים
      var exact = this.state.sheetFilterTopic == filter;
      var n = function n(text) {
        return text.toLowerCase();
      };
      filter = n(filter);

      //title and each topic in he and en
      var filterableData = sheet.topics.map(function (topic) {
        return [n(topic.en), n(topic.he), n(topic.asTyped)];
      }).flat();
      filterableData.push(n(sheet.title.stripHtml()));

      //this may be confusing- in the exact case, "includes" is an array func and returns if any of the above match filter exactly, 
      // if not "includes" is a string func and is testing for a substring, meaning the filter is a partial match to any of the above. 
      return exact ? filterableData.includes(filter) : filterableData.some(function (element) {
        return element.includes(filter);
      });
    }
  }, {
    key: "renderSheet",
    value: function renderSheet(sheet) {
      return /*#__PURE__*/external_react_default().createElement(SheetListing, {
        sheet: sheet,
        hideAuthor: true,
        infoUnderneath: true,
        showAuthorUnderneath: true,
        hideCollection: true,
        pinned: this.state.collectionData.pinnedSheets.indexOf(sheet.id) != -1,
        pinnable: this.isMember(),
        editable: sheet.author == sefaria._uid,
        saveable: sheet.author !== sefaria._uid && !this.isMember(),
        collectable: true,
        pinSheet: this.pinSheet.bind(null, sheet.id),
        handleCollectionsChange: this.onDataChange,
        toggleSignUpModal: this.props.toggleSignUpModal,
        showSheetSummary: true,
        key: sheet.id
      });
    }
  }, {
    key: "renderEmptyList",
    value: function renderEmptyList(_ref) {
      var filter = _ref.filter;
      if (filter) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "emptyMessage sans-serif"
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "No sheets matching "), "; \"", /*#__PURE__*/external_react_default().createElement(InterfaceText, {
          text: {
            en: filter,
            he: filter
          }
        }), "\".");
      } else if (this.isMember()) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "emptyMessage sans-serif"
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "You can add sheets to this collection on your profile."), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement("a", {
          className: "button",
          href: "/my/profile"
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Open Profile")));
      } else {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "emptyMessage sans-serif"
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "There are no sheets in this collection yet."));
      }
    }
  }, {
    key: "renderSearchLink",
    value: function renderSearchLink(_ref2) {
      var _this4 = this;
      var filter = _ref2.filter;
      if (!filter || !this.state.collectionData.listed) {
        return null;
      }
      return /*#__PURE__*/external_react_default().createElement("a", {
        className: "searchInCollectionLink sans-serif",
        href: "/search?q=".concat(filter, "&tab=sheet&scollectionsFilters=").concat(this.state.collectionData.name),
        onClick: function onClick(e) {
          e.preventDefault();
          _this4.props.searchInCollection(filter, _this4.state.collectionData.name);
        }
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Search the full text of this collection for"), "\xA0 \"", /*#__PURE__*/external_react_default().createElement(InterfaceText, {
        text: {
          en: filter,
          he: filter
        }
      }), "\" \xBB");
    }
  }, {
    key: "render",
    value: function render() {
      var _this5 = this;
      var collection = this.state.collectionData;
      var sidebarModules = [];
      var content;
      if (!collection) {
        content = /*#__PURE__*/external_react_default().createElement(LoadingMessage, null);
      } else {
        var sheets = collection.sheets;
        var isAdmin = collection.admins.filter(function (x) {
          return x.uid == sefaria._uid;
        }).length !== 0;
        if (collection.imageUrl) {
          sidebarModules.push({
            type: "Image",
            props: {
              url: collection.imageUrl
            }
          });
        }
        var editorsBlock = /*#__PURE__*/external_react_default().createElement("div", null, isAdmin ? /*#__PURE__*/external_react_default().createElement(CollectionInvitationBox, {
          slug: this.props.slug,
          onDataChange: this.onDataChange
        }) : null, this.memberList().map(function (member, i) {
          return /*#__PURE__*/external_react_default().createElement(CollectionMemberListing, {
            member: member,
            isAdmin: isAdmin,
            isSelf: member.uid == sefaria._uid,
            slug: _this5.props.slug,
            onDataChange: _this5.onDataChange,
            key: i
          });
        }));
        sidebarModules.push({
          type: "Wrapper",
          props: {
            title: "Editors",
            content: editorsBlock
          }
        });
        var hasContentsTab = collection.pinnedTags && collection.pinnedTags.length;
        var tabs = !hasContentsTab ? [] : [{
          id: "contents",
          title: {
            en: "Contents",
            he: sefaria._("Contents")
          }
        }];
        tabs.push({
          id: "sheets",
          title: {
            en: "Sheets",
            he: sefaria._("Sheets")
          }
        }, {
          id: 'filter',
          title: {
            en: "Filter",
            he: sefaria._("Filter")
          },
          icon: "/static/icons/arrow-".concat(this.state.showFilterHeader ? 'up' : 'down', "-bold.svg"),
          justifyright: true,
          clickTabOverride: function clickTabOverride() {
            _this5.setState({
              showFilterHeader: !_this5.state.showFilterHeader
            });
          }
        });
        var renderTab = function renderTab(t) {
          return /*#__PURE__*/external_react_default().createElement("div", {
            className: external_classnames_default()({
              tab: 1,
              noselect: 1,
              filter: t.justifyright,
              open: t.justifyright && _this5.state.showFilterHeader
            })
          }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
            text: t.title
          }), t.icon ? /*#__PURE__*/external_react_default().createElement("img", {
            src: t.icon,
            alt: "".concat(t.title.en, " icon")
          }) : null);
        };
        content = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement(CollectionAbout, {
          collection: collection,
          isAdmin: isAdmin,
          toggleLanguage: this.props.toggleLanguage
        }), /*#__PURE__*/external_react_default().createElement(TabView, {
          tabs: tabs,
          currTabName: this.state.tab,
          renderTab: renderTab,
          containerClasses: "largeTabs",
          setTab: this.props.setTab
        }, !hasContentsTab ? null : /*#__PURE__*/external_react_default().createElement(CollectionContentsTab, {
          collection: collection,
          setFilter: this.setFilter
        }), /*#__PURE__*/external_react_default().createElement(FilterableList, {
          pageSize: 20,
          filterFunc: this.filterSheets,
          sortFunc: this.sortSheets,
          renderItem: this.renderSheet,
          renderEmptyList: this.renderEmptyList,
          renderFooter: this.renderSearchLink,
          sortOptions: ["Recent", "Alphabetical", "Views"],
          data: sheets,
          containerClass: "sheetList",
          scrollableElement: this.scrollableRef,
          initialRenderSize: collection._sheetsDisplayed,
          onDisplayedDataChange: function onDisplayedDataChange(data) {
            collection._sheetsDisplayed = data.length;
          },
          initialFilter: this.state.sheetFilterTopic,
          showFilterHeader: this.state.showFilterHeader
        })));
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerNavMenu"
      }, /*#__PURE__*/external_react_default().createElement(CategoryColorLine, {
        category: "Sheets"
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "content collectionPage",
        ref: this.scrollableRef
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sidebarLayout"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "contentInner"
      }, content), /*#__PURE__*/external_react_default().createElement(NavSidebar, {
        modules: sidebarModules
      })), /*#__PURE__*/external_react_default().createElement(js_Footer, null)));
    }
  }]);
  return CollectionPage;
}((external_react_class_default()));
CollectionPage.propTypes = {
  setTab: (external_prop_types_default()).func.isRequired,
  tab: (external_prop_types_default()).string,
  name: (external_prop_types_default()).string,
  slug: (external_prop_types_default()).string,
  width: (external_prop_types_default()).number,
  multiPanel: (external_prop_types_default()).bool,
  tag: (external_prop_types_default()).string,
  interfaceLang: (external_prop_types_default()).string,
  searchInCollection: (external_prop_types_default()).func
};
var CollectionAbout = function CollectionAbout(_ref3) {
  var collection = _ref3.collection,
    isAdmin = _ref3.isAdmin,
    toggleLanguage = _ref3.toggleLanguage;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionInfo sans-serif"
  }, collection.toc ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "navTitle"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(ContentText, {
    text: {
      en: collection.toc.title,
      he: collection.toc.heTitle
    }
  })), isAdmin ? /*#__PURE__*/external_react_default().createElement(EditCollectionButton, {
    slug: collection.slug
  }) : null, sefaria.multiPanel && sefaria.interfaceLang !== "hebrew" ? /*#__PURE__*/external_react_default().createElement(LanguageToggleButton, {
    toggleLanguage: toggleLanguage
  }) : null) : /*#__PURE__*/external_react_default().createElement("div", {
    className: "navTitle"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, collection.name), isAdmin ? /*#__PURE__*/external_react_default().createElement(EditCollectionButton, {
    slug: collection.slug
  }) : null), /*#__PURE__*/external_react_default().createElement("a", {
    className: "collectionLabel",
    href: "/collections"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Collection")), collection.toc ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionDescription"
  }, /*#__PURE__*/external_react_default().createElement(ContentText, {
    html: {
      en: collection.toc.description,
      he: collection.toc.heDescription
    }
  })) : collection.description ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionDescription",
    dangerouslySetInnerHTML: {
      __html: collection.description
    }
  }) : null, collection.websiteUrl ? /*#__PURE__*/external_react_default().createElement("a", {
    className: "collectionWebsite",
    target: "_blank",
    href: collection.websiteUrl
  }, collection.websiteUrl.replace(/https?:\/\//, "")) : null);
};
var EditCollectionButton = function EditCollectionButton(_ref4) {
  var slug = _ref4.slug;
  return /*#__PURE__*/external_react_default().createElement("a", {
    className: "button small white",
    href: "/collections/".concat(slug, "/settings")
  }, /*#__PURE__*/external_react_default().createElement("img", {
    className: "buttonIcon",
    src: "/static/icons/tools-write-note.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Edit"));
};
var CollectionContentsTab = function CollectionContentsTab(_ref5) {
  var collection = _ref5.collection,
    setFilter = _ref5.setFilter;
  var pinnedTags = collection.pinnedTags;
  if (!pinnedTags || !pinnedTags.length) {
    return null;
  }
  if (collection.name === "גיליונות נחמה" && sefaria.interfaceLang === "english") {
    pinnedTags = ["English"].concat(pinnedTags);
  }

  // Tags may be grouped under labels which are represented as objects in `pinnedTags`, instead of strings.
  var groupedTags = pinnedTags.reduce(function (accum, tag) {
    if (CollectionPage_typeof(tag) === "object") {
      return accum.concat([{
        label: tag,
        contents: []
      }]);
    } else if (accum.length == 0) {
      return accum.concat([{
        label: null,
        contents: [tag]
      }]);
    } else {
      accum[accum.length - 1].contents.push(tag);
      return accum;
    }
  }, []);
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionContentsTab"
  }, groupedTags.map(function (tagGroup) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      key: tagGroup.label ? tagGroup.label.en : "contents"
    }, !tagGroup.label ? null : /*#__PURE__*/external_react_default().createElement("div", {
      className: "collectionContentsSectionLabel sans-serif"
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: tagGroup.label
    })), /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
      content: tagGroup.contents.map(function (tag) {
        return /*#__PURE__*/external_react_default().createElement("a", {
          href: "/collections/".concat(collection.slug, "?tag=").concat(tag),
          className: "collectionContentsTag",
          onClick: function onClick(e) {
            e.preventDefault();
            setFilter(tag);
          }
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, tag));
      })
    }));
  }));
};
var CollectionInvitationBox = /*#__PURE__*/function (_Component2) {
  CollectionPage_inherits(CollectionInvitationBox, _Component2);
  var _super2 = CollectionPage_createSuper(CollectionInvitationBox);
  function CollectionInvitationBox(props) {
    var _this6;
    CollectionPage_classCallCheck(this, CollectionInvitationBox);
    _this6 = _super2.call(this, props);
    _this6.state = {
      inviting: false,
      message: null
    };
    return _this6;
  }
  CollectionPage_createClass(CollectionInvitationBox, [{
    key: "onInviteClick",
    value: function onInviteClick() {
      if (!this.state.inviting) {
        this.inviteByEmail(sefariaJquery("#collectionInvitationInput").val());
      }
    }
  }, {
    key: "flashMessage",
    value: function flashMessage(message) {
      this.setState({
        message: message
      });
      setTimeout(function () {
        this.setState({
          message: null
        });
      }.bind(this), 5000);
    }
  }, {
    key: "inviteByEmail",
    value: function inviteByEmail(email) {
      if (!this.validateEmail(email)) {
        this.flashMessage(sefaria._("Please enter a valid email address."));
        return;
      }
      this.setState({
        inviting: true,
        message: sefaria._("Inviting...")
      });
      sefariaJquery.post("/api/collections/" + this.props.slug + "/invite/" + email, function (data) {
        if ("error" in data) {
          alert(data.error);
          this.setState({
            message: null,
            inviting: false
          });
        } else {
          sefaria._collections[this.props.slug] = data.collection;
          sefariaJquery("#collectionInvitationInput").val("");
          this.flashMessage(data.message);
          this.setState({
            inviting: false
          });
          this.props.onDataChange();
        }
      }.bind(this)).fail(function () {
        alert(sefaria._("There was an error sending your invitation."));
        this.setState({
          message: null,
          inviting: false
        });
      }.bind(this));
    }
  }, {
    key: "validateEmail",
    value: function validateEmail(email) {
      var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      return re.test(email);
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionInvitationBox sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionInvitationBoxInner"
      }, /*#__PURE__*/external_react_default().createElement("input", {
        id: "collectionInvitationInput",
        placeholder: sefaria._("Email Address")
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "button small",
        onClick: this.onInviteClick
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Invite"))), this.state.message ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionInvitationBoxMessage"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, this.state.message)) : null);
    }
  }]);
  return CollectionInvitationBox;
}((external_react_class_default()));
CollectionInvitationBox.propTypes = {
  slug: (external_prop_types_default()).string.isRequired,
  onDataChange: (external_prop_types_default()).func.isRequired
};
var CollectionMemberListing = /*#__PURE__*/function (_Component3) {
  CollectionPage_inherits(CollectionMemberListing, _Component3);
  var _super3 = CollectionPage_createSuper(CollectionMemberListing);
  function CollectionMemberListing() {
    CollectionPage_classCallCheck(this, CollectionMemberListing);
    return _super3.apply(this, arguments);
  }
  CollectionPage_createClass(CollectionMemberListing, [{
    key: "render",
    value: function render() {
      if (this.props.member.role == "Invitation") {
        return this.props.isAdmin ? /*#__PURE__*/external_react_default().createElement(CollectionInvitationListing, {
          member: this.props.member,
          slug: this.props.slug,
          onDataChange: this.props.onDataChange
        }) : null;
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionMemberListing"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: this.props.member.profileUrl,
        className: "collectionMemberListingPic"
      }, /*#__PURE__*/external_react_default().createElement(ProfilePic, {
        url: this.props.member.imageUrl,
        name: this.props.member.name,
        len: 40
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionMemberListingText"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: this.props.member.profileUrl,
        className: "collectionMemberListingName"
      }, this.props.member.name), /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionMemberListingRole"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, this.props.member.role), this.props.isAdmin || this.props.isSelf ? /*#__PURE__*/external_react_default().createElement(CollectionMemberListingActions, {
        member: this.props.member,
        slug: this.props.slug,
        isAdmin: this.props.isAdmin,
        isSelf: this.props.isSelf,
        onDataChange: this.props.onDataChange
      }) : null)));
    }
  }]);
  return CollectionMemberListing;
}((external_react_class_default()));
CollectionMemberListing.propTypes = {
  member: (external_prop_types_default()).object.isRequired,
  isAdmin: (external_prop_types_default()).bool,
  isSelf: (external_prop_types_default()).bool,
  slug: (external_prop_types_default()).string,
  onDataChange: (external_prop_types_default()).func.isRequired
};
var CollectionInvitationListing = /*#__PURE__*/function (_Component4) {
  CollectionPage_inherits(CollectionInvitationListing, _Component4);
  var _super4 = CollectionPage_createSuper(CollectionInvitationListing);
  function CollectionInvitationListing() {
    CollectionPage_classCallCheck(this, CollectionInvitationListing);
    return _super4.apply(this, arguments);
  }
  CollectionPage_createClass(CollectionInvitationListing, [{
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionMemberListing"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionMemberListingPic invitation"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/mail.svg"
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionMemberListingText"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "collectionMemberListingName"
      }, this.props.member.email), /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionMemberListingRole"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Invited"), /*#__PURE__*/external_react_default().createElement(CollectionMemberListingActions, {
        member: this.props.member,
        slug: this.props.slug,
        isInvitation: true,
        onDataChange: this.props.onDataChange
      }))));
    }
  }]);
  return CollectionInvitationListing;
}((external_react_class_default()));
CollectionInvitationListing.propTypes = {
  member: (external_prop_types_default()).object.isRequired,
  slug: (external_prop_types_default()).string,
  onDataChange: (external_prop_types_default()).func
};
var CollectionMemberListingActions = /*#__PURE__*/function (_Component5) {
  CollectionPage_inherits(CollectionMemberListingActions, _Component5);
  var _super5 = CollectionPage_createSuper(CollectionMemberListingActions);
  function CollectionMemberListingActions(props) {
    var _this7;
    CollectionPage_classCallCheck(this, CollectionMemberListingActions);
    _this7 = _super5.call(this, props);
    _this7.state = {
      menuOpen: false,
      invitationResent: false
    };
    return _this7;
  }
  CollectionPage_createClass(CollectionMemberListingActions, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      document.addEventListener('mousedown', this.handleClickOutside, false);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      document.removeEventListener('mousedown', this.handleClickOutside, false);
    }
  }, {
    key: "handleClickOutside",
    value: function handleClickOutside(event) {
      var domNode = ReactDOM.findDOMNode(this);
      if ((!domNode || !domNode.contains(event.target)) && this.state.menuOpen) {
        this.setState({
          menuOpen: false
        });
      }
    }
  }, {
    key: "toggleMenu",
    value: function toggleMenu() {
      this.setState({
        menuOpen: !this.state.menuOpen
      });
    }
  }, {
    key: "setRole",
    value: function setRole(role) {
      if (this.props.isSelf && this.props.isAdmin && role !== "admin") {
        if (!confirm(sefaria._("Are you sure you want to change your collection role? You won't be able to undo this action unless another owner restores your permissions."))) {
          return;
        }
      }
      sefariaJquery.post("/api/collections/" + this.props.slug + "/set-role/" + this.props.member.uid + "/" + role, function (data) {
        if ("error" in data) {
          alert(data.error);
        } else {
          sefaria._collections[data.slug] = data;
          this.props.onDataChange();
        }
      }.bind(this));
    }
  }, {
    key: "removeMember",
    value: function removeMember() {
      var message = this.props.isSelf ? sefaria._("Are you sure you want to leave this collection?") : sefaria._("Are you sure you want to remove this person from this collection?");
      if (confirm(message)) {
        this.setRole("remove");
      }
    }
  }, {
    key: "resendInvitation",
    value: function resendInvitation() {
      sefariaJquery.post("/api/collections/" + this.props.slug + "/invite/" + this.props.member.email, function (data) {
        if ("error" in data) {
          alert(data.error);
        } else {
          sefaria._collections[this.props.slug] = data.collection;
          this.props.onDataChange();
          this.setState({
            "invitationResent": true
          });
        }
      }.bind(this));
    }
  }, {
    key: "removeInvitation",
    value: function removeInvitation() {
      if (confirm(sefaria._("Are you sure you want to remove this invitation?"))) {
        sefariaJquery.post("/api/collections/" + this.props.slug + "/invite/" + this.props.member.email + "/uninvite", function (data) {
          if ("error" in data) {
            alert(data.error);
          } else {
            sefaria._collections[this.props.slug] = data.collection;
            this.props.onDataChange();
          }
        }.bind(this));
      }
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionMemberListingActions",
        onClick: this.toggleMenu
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionMemberListingActionsButton"
      }, /*#__PURE__*/external_react_default().createElement("i", {
        className: "fa fa-gear"
      })), this.state.menuOpen ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionMemberListingActionsMenu"
      }, this.props.isAdmin ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "action",
        onClick: this.setRole.bind(this, "admin")
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: external_classnames_default()({
          role: 1,
          current: this.props.member.role == "Owner"
        })
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Owner")), "- ", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "can invite & edit settings")) : null, this.props.isAdmin ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "action",
        onClick: this.setRole.bind(this, "member")
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: external_classnames_default()({
          role: 1,
          current: this.props.member.role == "Editor"
        })
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Editor")), "- ", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "can add & remove sheets")) : null, this.props.isAdmin || this.props.isSelf ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "action",
        onClick: this.removeMember
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "role"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, this.props.isSelf ? "Leave Collection" : "Remove"))) : null, this.props.isInvitation && !this.state.invitationResent ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "action",
        onClick: this.resendInvitation
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "role"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Resend Invitation"))) : null, this.props.isInvitation && this.state.invitationResent ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "action"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "role"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Invitation Resent"))) : null, this.props.isInvitation ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "action",
        onClick: this.removeInvitation
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "role"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Remove"))) : null) : null);
    }
  }]);
  return CollectionMemberListingActions;
}((external_react_class_default()));
CollectionMemberListingActions.propTypes = {
  member: (external_prop_types_default()).object.isRequired,
  slug: (external_prop_types_default()).string.isRequired,
  isAdmin: (external_prop_types_default()).bool,
  isSelf: (external_prop_types_default()).bool,
  isInvitation: (external_prop_types_default()).bool,
  onDataChange: (external_prop_types_default()).func.isRequired
};
/* harmony default export */ const js_CollectionPage = (CollectionPage);
;// CONCATENATED MODULE: ../static/js/NotificationsPanel.jsx
function NotificationsPanel_typeof(obj) { "@babel/helpers - typeof"; return NotificationsPanel_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, NotificationsPanel_typeof(obj); }
function NotificationsPanel_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function NotificationsPanel_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, NotificationsPanel_toPropertyKey(descriptor.key), descriptor); } }
function NotificationsPanel_createClass(Constructor, protoProps, staticProps) { if (protoProps) NotificationsPanel_defineProperties(Constructor.prototype, protoProps); if (staticProps) NotificationsPanel_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function NotificationsPanel_toPropertyKey(arg) { var key = NotificationsPanel_toPrimitive(arg, "string"); return NotificationsPanel_typeof(key) === "symbol" ? key : String(key); }
function NotificationsPanel_toPrimitive(input, hint) { if (NotificationsPanel_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (NotificationsPanel_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function NotificationsPanel_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) NotificationsPanel_setPrototypeOf(subClass, superClass); }
function NotificationsPanel_setPrototypeOf(o, p) { NotificationsPanel_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return NotificationsPanel_setPrototypeOf(o, p); }
function NotificationsPanel_createSuper(Derived) { var hasNativeReflectConstruct = NotificationsPanel_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = NotificationsPanel_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = NotificationsPanel_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return NotificationsPanel_possibleConstructorReturn(this, result); }; }
function NotificationsPanel_possibleConstructorReturn(self, call) { if (call && (NotificationsPanel_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return NotificationsPanel_assertThisInitialized(self); }
function NotificationsPanel_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function NotificationsPanel_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function NotificationsPanel_getPrototypeOf(o) { NotificationsPanel_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return NotificationsPanel_getPrototypeOf(o); }










var NotificationsPanel = /*#__PURE__*/function (_Component) {
  NotificationsPanel_inherits(NotificationsPanel, _Component);
  var _super = NotificationsPanel_createSuper(NotificationsPanel);
  function NotificationsPanel(props) {
    var _this;
    NotificationsPanel_classCallCheck(this, NotificationsPanel);
    _this = _super.call(this, props);
    _this.state = {
      page: 1,
      loadedToEnd: false,
      loading: false
    };
    return _this;
  }
  NotificationsPanel_createClass(NotificationsPanel, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".content").bind("scroll", this.handleScroll);
      this.markAsRead();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this.markAsRead();
    }
  }, {
    key: "handleScroll",
    value: function handleScroll() {
      if (this.state.loadedToEnd || this.state.loading) {
        return;
      }
      var $scrollable = sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".content");
      var margin = 600;
      if ($scrollable.scrollTop() + $scrollable.innerHeight() + margin >= $scrollable[0].scrollHeight) {
        this.getMoreNotifications();
      }
    }
  }, {
    key: "markAllAsRead",
    value: function markAllAsRead() {
      sefariaJquery.post("/api/notifications/read", {
        notifications: "all"
      }, function (data) {
        this.props.setUnreadNotificationsCount(data.unreadCount);
      }.bind(this));
    }
  }, {
    key: "markAsRead",
    value: function markAsRead() {
      // Marks each notification that is loaded into the page as read via API call
      var ids = [];
      sefaria.notifications.map(function (n) {
        if (!n.read) {
          ids.push(n._id);
          n.read = true;
        }
      });
      if (ids.length) {
        sefariaJquery.post("/api/notifications/read", {
          notifications: JSON.stringify(ids)
        }, function (data) {
          this.props.setUnreadNotificationsCount(data.unreadCount);
        }.bind(this));
      }
    }
  }, {
    key: "getMoreNotifications",
    value: function getMoreNotifications() {
      sefariaJquery.getJSON("/api/notifications?page=" + this.state.page, this.loadMoreNotifications);
      this.setState({
        loading: true
      });
    }
  }, {
    key: "loadMoreNotifications",
    value: function loadMoreNotifications(data) {
      if (data.count < data.page_size) {
        this.setState({
          loadedToEnd: true
        });
      }
      sefaria.notifications = sefaria.notifications.concat(data.notifications);
      this.setState({
        page: data.page + 1,
        loading: false
      });
      this.forceUpdate();
    }
  }, {
    key: "render",
    value: function render() {
      var notifications = sefaria.notifications.map(function (n) {
        return /*#__PURE__*/external_react_default().createElement(Notifications, {
          type: n.type,
          props: n,
          key: n._id
        });
      });
      var sidebarModules = [{
        type: "StayConnected"
      }];
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerNavMenu sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "content"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sidebarLayout"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "contentInner"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "notificationsTopContainer"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "notificationsHeaderBox"
      }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement("img", {
        className: "notificationsTitleIcon",
        src: "/static/icons/notification.svg"
      }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Notifications"))), sefaria.notificationCount > 0 ? /*#__PURE__*/external_react_default().createElement("button", {
        className: "button small white",
        onClick: this.markAllAsRead
      }, "Mark all as Read") : null), sefaria._uid ? notifications : /*#__PURE__*/external_react_default().createElement(LoginPrompt, {
        fullPanel: true
      })), /*#__PURE__*/external_react_default().createElement(NavSidebar, {
        modules: sidebarModules
      })), /*#__PURE__*/external_react_default().createElement(js_Footer, null)));
    }
  }]);
  return NotificationsPanel;
}((external_react_class_default()));
NotificationsPanel.propTypes = {
  setUnreadNotificationsCount: (external_prop_types_default()).func.isRequired,
  interfaceLang: (external_prop_types_default()).string
};
var Notifications = function Notifications(_ref) {
  var type = _ref.type,
    props = _ref.props;
  // Choose the appropriate component to render by `type`
  var notificationTypes = {
    "sheet publish": SheetPublishNotification,
    "sheet like": SheetLikeNotification,
    "follow": FollowNotification,
    "collection add": CollectionAddNotification,
    "index": IndexNotification,
    "version": VersionNotification,
    "general": GeneralNotification
  };
  if (!type || !notificationTypes[type]) {
    return null;
  }
  var NotificationType = notificationTypes[type];
  return /*#__PURE__*/external_react_default().createElement(NotificationType, props);
};
var Notification = function Notification(_ref2) {
  var imageUrl = _ref2.imageUrl,
    imageLink = _ref2.imageLink,
    topLine = _ref2.topLine,
    date = _ref2.date,
    body = _ref2.body;
  var image = imageUrl ? /*#__PURE__*/external_react_default().createElement("img", {
    src: imageUrl
  }) : null;
  image = imageLink ? /*#__PURE__*/external_react_default().createElement("a", {
    href: imageLink
  }, image) : image;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "notification"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "imageSection"
  }, image), /*#__PURE__*/external_react_default().createElement("div", {
    className: "mainSection"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "topLine"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "topLineText"
  }, topLine), /*#__PURE__*/external_react_default().createElement("div", {
    className: "date"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: "".concat(sefaria.util.naturalTime(date), " ago"),
      he: "\u05DC\u05E4\u05E0\u05D9 ".concat(sefaria.util.naturalTime(date))
    }
  }))), body ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "notificationBody"
  }, body) : null));
};
var SheetPublishNotification = function SheetPublishNotification(_ref3) {
  var date = _ref3.date,
    content = _ref3.content;
  var topLine = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("a", {
    href: content.profileUrl
  }, content.name), "\xA0", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "published a new sheet"));
  var body = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "sheetTitle",
    href: "/sheets/" + content.sheet_id
  }, content.sheet_title), content.summary ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "sheetSummary"
  }, content.summary) : null);
  return /*#__PURE__*/external_react_default().createElement(Notification, {
    topLine: topLine,
    imageUrl: content.imageUrl,
    imageLink: content.profileUrl,
    date: date,
    body: body
  });
};
var SheetLikeNotification = function SheetLikeNotification(_ref4) {
  var date = _ref4.date,
    content = _ref4.content;
  var topLine = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("a", {
    href: content.profileUrl
  }, content.name), "\xA0", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "liked your sheet"));
  var body = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "sheetTitle",
    href: "/sheets/" + content.sheet_id
  }, content.sheet_title));
  return /*#__PURE__*/external_react_default().createElement(Notification, {
    topLine: topLine,
    imageUrl: content.imageUrl,
    imageLink: content.profileUrl,
    date: date,
    body: body
  });
};
var FollowNotification = function FollowNotification(_ref5) {
  var date = _ref5.date,
    content = _ref5.content;
  var topLine = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("a", {
    href: content.profileUrl
  }, content.name), "\xA0", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "is now following you"));
  var body = content.is_already_following ? null : /*#__PURE__*/external_react_default().createElement(FollowButton, {
    large: true,
    uid: content.follower,
    followBack: true,
    smallText: false
  });
  return /*#__PURE__*/external_react_default().createElement(Notification, {
    topLine: topLine,
    imageUrl: content.imageUrl,
    imageLink: content.profileUrl,
    date: date,
    body: body
  });
};
var CollectionAddNotification = function CollectionAddNotification(_ref6) {
  var date = _ref6.date,
    content = _ref6.content;
  var topLine = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("a", {
    href: content.profileUrl
  }, content.name), "\xA0", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "added you to a collection"));
  var body = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("a", {
    className: "collectionName",
    href: "/collections/" + content.collection_slug
  }, content.collection_name));
  return /*#__PURE__*/external_react_default().createElement(Notification, {
    topLine: topLine,
    imageUrl: content.imageUrl,
    imageLink: content.profileUrl,
    date: date,
    body: body
  });
};
var IndexNotification = function IndexNotification(_ref7) {
  var date = _ref7.date,
    content = _ref7.content;
  var title = content.index;
  var heTitle = sefaria.index(title).heTitle;
  var url = "/" + sefaria.normRef(title);
  var topLine = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "New Text"), ":\xA0", /*#__PURE__*/external_react_default().createElement("a", {
    href: url
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: {
      en: title,
      he: heTitle
    }
  })));
  var body = /*#__PURE__*/external_react_default().createElement("div", {
    className: "globalNotificationText"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    html: content
  }));
  return /*#__PURE__*/external_react_default().createElement(Notification, {
    topLine: topLine,
    imageUrl: "/static/img/icon.png",
    date: date,
    body: body
  });
};
var VersionNotification = function VersionNotification(_ref8) {
  var date = _ref8.date,
    content = _ref8.content;
  var title = content.index;
  var heTitle = sefaria.index(title).heTitle;
  var url = "/" + sefaria.normRef(title);
  var topLine = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "New ", content.language == "en" ? "English" : "Hebrew", " version of ", /*#__PURE__*/external_react_default().createElement("a", {
    href: url
  }, title), ": ", content.version), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05D2\u05E8\u05E1\u05D4 \u05D7\u05D3\u05E9\u05D4 \u05E9\u05DC ", /*#__PURE__*/external_react_default().createElement("a", {
    href: url
  }, heTitle), " \u05D1", content.language == "en" ? "אנגלית" : "עברית", " : ", content.version));
  var body = /*#__PURE__*/external_react_default().createElement("div", {
    className: "globalNotificationText"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    html: content
  }));
  return /*#__PURE__*/external_react_default().createElement(Notification, {
    topLine: topLine,
    imageUrl: "/static/img/icon.png",
    date: date,
    body: body
  });
};
var GeneralNotification = function GeneralNotification(_ref9) {
  var date = _ref9.date,
    content = _ref9.content;
  var topLine = /*#__PURE__*/external_react_default().createElement("div", {
    className: "globalNotificationText"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    html: content
  }));
  return /*#__PURE__*/external_react_default().createElement(Notification, {
    topLine: topLine,
    imageUrl: "/static/img/icon.png",
    date: date
  });
};

;// CONCATENATED MODULE: ../static/js/UserHistoryPanel.jsx
function UserHistoryPanel_toConsumableArray(arr) { return UserHistoryPanel_arrayWithoutHoles(arr) || UserHistoryPanel_iterableToArray(arr) || UserHistoryPanel_unsupportedIterableToArray(arr) || UserHistoryPanel_nonIterableSpread(); }
function UserHistoryPanel_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function UserHistoryPanel_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function UserHistoryPanel_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return UserHistoryPanel_arrayLikeToArray(arr); }
function UserHistoryPanel_slicedToArray(arr, i) { return UserHistoryPanel_arrayWithHoles(arr) || UserHistoryPanel_iterableToArrayLimit(arr, i) || UserHistoryPanel_unsupportedIterableToArray(arr, i) || UserHistoryPanel_nonIterableRest(); }
function UserHistoryPanel_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function UserHistoryPanel_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return UserHistoryPanel_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return UserHistoryPanel_arrayLikeToArray(o, minLen); }
function UserHistoryPanel_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function UserHistoryPanel_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function UserHistoryPanel_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }










var UserHistoryPanel = function UserHistoryPanel(_ref) {
  var menuOpen = _ref.menuOpen,
    toggleLanguage = _ref.toggleLanguage,
    openDisplaySettings = _ref.openDisplaySettings,
    openNav = _ref.openNav,
    compare = _ref.compare,
    toggleSignUpModal = _ref.toggleSignUpModal;
  var store = menuOpen === "saved" ? sefaria.saved : sefaria.userHistory;
  var contentRef = (0,external_react_.useRef)();
  var title = /*#__PURE__*/external_react_default().createElement("span", {
    className: "sans-serif"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/texts/saved",
    className: "navTitleTab" + (menuOpen === "saved" ? " current" : "")
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/bookmark.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Saved")), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/texts/history",
    className: "navTitleTab" + (menuOpen === "history" ? " current" : "")
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/clock.svg"
  }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "History")));
  var sidebarModules = [{
    type: "Promo"
  }, {
    type: "GetTheApp"
  }, {
    type: "SupportSefaria"
  }];
  var footer = compare ? null : /*#__PURE__*/external_react_default().createElement(js_Footer, null);
  var navMenuClasses = external_classnames_default()({
    readerNavMenu: 1,
    compare: compare,
    noLangToggleInHebrew: 1
  });
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: navMenuClasses
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "content",
    ref: contentRef
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sidebarLayout"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "contentInner"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "navTitle sans-serif-in-hebrew"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, title), sefaria.interfaceLang !== "hebrew" && sefaria._siteSettings.TORAH_SPECIFIC ? /*#__PURE__*/external_react_default().createElement(LanguageToggleButton, {
    toggleLanguage: toggleLanguage
  }) : null), /*#__PURE__*/external_react_default().createElement(UserHistoryList, {
    store: store,
    scrollableRef: contentRef,
    menuOpen: menuOpen,
    toggleSignUpModal: toggleSignUpModal,
    key: menuOpen
  })), /*#__PURE__*/external_react_default().createElement(NavSidebar, {
    modules: sidebarModules
  })), footer));
};
UserHistoryPanel.propTypes = {
  toggleLanguage: (external_prop_types_default()).func.isRequired,
  openDisplaySettings: (external_prop_types_default()).func.isRequired,
  openNav: (external_prop_types_default()).func.isRequired,
  compare: (external_prop_types_default()).bool,
  menuOpen: (external_prop_types_default()).string.isRequired
};
var UserHistoryList = function UserHistoryList(_ref2) {
  var store = _ref2.store,
    scrollableRef = _ref2.scrollableRef,
    menuOpen = _ref2.menuOpen,
    toggleSignUpModal = _ref2.toggleSignUpModal;
  var _useState = (0,external_react_.useState)(store.loaded ? store.items : null),
    _useState2 = UserHistoryPanel_slicedToArray(_useState, 2),
    items = _useState2[0],
    setItems = _useState2[1];

  // Store changes when switching tabs, reset items
  (0,external_react_.useEffect)(function () {
    setItems(store.loaded ? store.items : null);
  }, [store]);
  useScrollToLoad({
    scrollableRef: scrollableRef,
    url: "/api/profile/user_history?secondary=0&annotate=1" + (menuOpen === "saved" ? "&saved=1" : ""),
    setter: function setter(data) {
      var _store$items;
      if (!store.loaded) {
        store.items = []; // saved intially has items that have not been annotated with text
        store.loaded = true;
      }
      (_store$items = store.items).push.apply(_store$items, UserHistoryPanel_toConsumableArray(data));
      setItems(store.items.slice());
    },
    itemsPreLoaded: items ? items.length : 0
  });
  if (menuOpen === 'history' && !sefaria.is_history_enabled) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "savedHistoryMessage"
    }, /*#__PURE__*/external_react_default().createElement("span", {
      className: "int-en"
    }, "Reading history is currently disabled. You can re-enable this feature in your ", /*#__PURE__*/external_react_default().createElement("a", {
      href: "/settings/account"
    }, "account settings"), "."), /*#__PURE__*/external_react_default().createElement("span", {
      className: "int-he"
    }, "\u05D4\u05D9\u05E1\u05D8\u05D5\u05E8\u05D9\u05EA \u05E7\u05E8\u05D9\u05D0\u05D4 \u05DB\u05D1\u05D5\u05D9\u05D4 \u05DB\u05E8\u05D2\u05E2. \u05E0\u05D9\u05EA\u05DF \u05DC\u05D4\u05E4\u05E2\u05D9\u05DC\u05D4 \u05DE\u05D7\u05D3\u05E9 \u05D1\u05DE\u05E1\u05DA ", /*#__PURE__*/external_react_default().createElement("a", {
      href: "/settings/account"
    }, "\u05D4\u05D4\u05D2\u05D3\u05E8\u05D5\u05EA"), "."));
  } else if (!items) {
    return /*#__PURE__*/external_react_default().createElement(LoadingMessage, null);
  } else if (items.length === 0) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "savedHistoryMessage sans-serif"
    }, menuOpen === "history" ? /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Texts and sheets that you read will be available for you to see here.") : /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Click the bookmark icon on texts or sheets to save them here."));
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "savedHistoryList"
  }, items.reduce(function (accum, curr, index) {
    // reduce consecutive history items with the same text/sheet
    if (!accum.length || menuOpen === "saved") {
      return accum.concat([curr]);
    }
    var prev = accum[accum.length - 1];
    if (curr.is_sheet && curr.sheet_id === prev.sheet_id) {
      return accum;
    } else if (!curr.is_sheet && curr.book === prev.book) {
      return accum;
    } else {
      return accum.concat(curr);
    }
  }, []).map(function (item, iitem) {
    var key = item.ref + "|" + item.time_stamp + "|" + iitem;
    var timeStamp = menuOpen === "saved" ? null : /*#__PURE__*/external_react_default().createElement("div", {
      className: "timeStamp sans-serif"
    }, sefaria.util.naturalTime(item.time_stamp, {
      "short": true
    }));
    if (item.is_sheet) {
      return /*#__PURE__*/external_react_default().createElement(SheetBlock, {
        sheet: {
          sheet_id: item.sheet_id,
          sheet_title: item.title,
          publisher_name: item.ownerName,
          publisher_id: item.owner,
          publisher_image: item.ownerImageUrl,
          publisher_url: item.ownerProfileUrl,
          publisher_organization: item.ownerOrganization,
          publisher_followed: sefaria.following.includes(item.owner)
        },
        afterSave: timeStamp,
        smallfonts: true,
        key: key
      });
    } else if (!!(item !== null && item !== void 0 && item.text)) {
      // item.versions
      return /*#__PURE__*/external_react_default().createElement(TextPassage, {
        text: {
          ref: item.ref,
          heRef: item.he_ref,
          en: item.text.en,
          he: item.text.he,
          versions: item.versions
        },
        afterSave: timeStamp,
        toggleSignUpModal: toggleSignUpModal,
        key: key
      });
    } else {
      return null;
    }
  }));
};
/* harmony default export */ const js_UserHistoryPanel = (UserHistoryPanel);
;// CONCATENATED MODULE: ../static/js/NoteListing.jsx
function NoteListing_typeof(obj) { "@babel/helpers - typeof"; return NoteListing_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, NoteListing_typeof(obj); }
function NoteListing_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function NoteListing_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, NoteListing_toPropertyKey(descriptor.key), descriptor); } }
function NoteListing_createClass(Constructor, protoProps, staticProps) { if (protoProps) NoteListing_defineProperties(Constructor.prototype, protoProps); if (staticProps) NoteListing_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function NoteListing_toPropertyKey(arg) { var key = NoteListing_toPrimitive(arg, "string"); return NoteListing_typeof(key) === "symbol" ? key : String(key); }
function NoteListing_toPrimitive(input, hint) { if (NoteListing_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (NoteListing_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function NoteListing_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) NoteListing_setPrototypeOf(subClass, superClass); }
function NoteListing_setPrototypeOf(o, p) { NoteListing_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return NoteListing_setPrototypeOf(o, p); }
function NoteListing_createSuper(Derived) { var hasNativeReflectConstruct = NoteListing_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = NoteListing_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = NoteListing_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return NoteListing_possibleConstructorReturn(this, result); }; }
function NoteListing_possibleConstructorReturn(self, call) { if (call && (NoteListing_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return NoteListing_assertThisInitialized(self); }
function NoteListing_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function NoteListing_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function NoteListing_getPrototypeOf(o) { NoteListing_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return NoteListing_getPrototypeOf(o); }








var NoteListing = /*#__PURE__*/function (_Component) {
  NoteListing_inherits(NoteListing, _Component);
  var _super = NoteListing_createSuper(NoteListing);
  function NoteListing(props) {
    var _this;
    NoteListing_classCallCheck(this, NoteListing);
    _this = _super.call(this, props);
    _this.state = {
      showSheetModal: false
    };
    return _this;
  }
  NoteListing_createClass(NoteListing, [{
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (!prevState.showSheetModal && this.state.showSheetModal) {
        this.positionSheetModal();
      }
    }
  }, {
    key: "showSheetModal",
    value: function showSheetModal() {
      this.setState({
        showSheetModal: true
      });
    }
  }, {
    key: "hideSheetModal",
    value: function hideSheetModal() {
      this.setState({
        showSheetModal: false
      });
    }
  }, {
    key: "positionSheetModal",
    value: function positionSheetModal() {
      sefariaJquery(".addToSourceSheetModal").position({
        my: "center center-40",
        at: "center center",
        of: window
      });
    }
  }, {
    key: "deleteNote",
    value: function deleteNote() {
      if (!confirm(sefaria._("Are you sure you want to delete this note?"))) {
        return;
      }
      var resolve = this.props.onDeleteNote || function () {};
      sefaria.deleteNote(this.props.data._id).then(resolve);
    }
  }, {
    key: "render",
    value: function render() {
      var data = this.props.data;
      var url = "/" + sefaria.normRef(data.ref) + "?with=Notes";
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "noteListing"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "actionButtons"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/sheet.svg",
        onClick: this.showSheetModal
      }), /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/circled-x.svg",
        onClick: this.deleteNote
      })), /*#__PURE__*/external_react_default().createElement("a", {
        href: url
      }, this.props.showText ? /*#__PURE__*/external_react_default().createElement(js_TextRange, {
        sref: data.ref
      }) : /*#__PURE__*/external_react_default().createElement("span", {
        className: "textRange placeholder"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "title"
      }, data.ref))), /*#__PURE__*/external_react_default().createElement(Note, {
        text: data.text
      }), this.state.showSheetModal ? /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(AddToSourceSheetWindow, {
        srefs: [data.ref],
        note: data.text,
        close: this.hideSheetModal
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "mask",
        onClick: this.hideSheetModal
      })) : null);
    }
  }]);
  return NoteListing;
}((external_react_class_default()));
NoteListing.propTypes = {
  data: (external_prop_types_default()).object.isRequired,
  showText: (external_prop_types_default()).bool,
  onDeleteNote: (external_prop_types_default()).func
};
NoteListing.defaultProps = {
  showText: true
};
/* harmony default export */ const js_NoteListing = (NoteListing);
;// CONCATENATED MODULE: ../static/js/UserProfile.jsx
function UserProfile_typeof(obj) { "@babel/helpers - typeof"; return UserProfile_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, UserProfile_typeof(obj); }
var UserProfile_this5 = undefined;
function UserProfile_slicedToArray(arr, i) { return UserProfile_arrayWithHoles(arr) || UserProfile_iterableToArrayLimit(arr, i) || UserProfile_unsupportedIterableToArray(arr, i) || UserProfile_nonIterableRest(); }
function UserProfile_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function UserProfile_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return UserProfile_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return UserProfile_arrayLikeToArray(o, minLen); }
function UserProfile_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function UserProfile_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function UserProfile_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function UserProfile_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function UserProfile_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, UserProfile_toPropertyKey(descriptor.key), descriptor); } }
function UserProfile_createClass(Constructor, protoProps, staticProps) { if (protoProps) UserProfile_defineProperties(Constructor.prototype, protoProps); if (staticProps) UserProfile_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function UserProfile_toPropertyKey(arg) { var key = UserProfile_toPrimitive(arg, "string"); return UserProfile_typeof(key) === "symbol" ? key : String(key); }
function UserProfile_toPrimitive(input, hint) { if (UserProfile_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (UserProfile_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function UserProfile_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) UserProfile_setPrototypeOf(subClass, superClass); }
function UserProfile_setPrototypeOf(o, p) { UserProfile_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return UserProfile_setPrototypeOf(o, p); }
function UserProfile_createSuper(Derived) { var hasNativeReflectConstruct = UserProfile_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = UserProfile_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = UserProfile_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return UserProfile_possibleConstructorReturn(this, result); }; }
function UserProfile_possibleConstructorReturn(self, call) { if (call && (UserProfile_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return UserProfile_assertThisInitialized(self); }
function UserProfile_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function UserProfile_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function UserProfile_getPrototypeOf(o) { UserProfile_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return UserProfile_getPrototypeOf(o); }








var UserProfile = /*#__PURE__*/function (_Component) {
  UserProfile_inherits(UserProfile, _Component);
  var _super = UserProfile_createSuper(UserProfile);
  function UserProfile(props) {
    var _this;
    UserProfile_classCallCheck(this, UserProfile);
    _this = _super.call(this, props);
    _this.state = _this.getPrivateTabState(props);
    return _this;
  }
  UserProfile_createClass(UserProfile, [{
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      if (!!this.props.profile && (!prevProps || prevProps.profile.id !== this.props.profile.id) || this.props.tab !== prevProps.tab) {
        this.setState(this.getPrivateTabState(this.props));
      }
    }
  }, {
    key: "getPrivateTabState",
    value: function getPrivateTabState(props) {
      var showNotes = !!props.profile.id && sefaria._uid === props.profile.id;
      var showBio = !!props.profile.bio;
      var tabs = [{
        id: "sheets",
        text: "Sheets",
        icon: "/static/icons/sheet.svg"
      }, {
        id: "collections",
        text: "Collections",
        icon: "/static/icons/collection.svg"
      }, {
        id: "followers",
        text: "Followers",
        invisible: true
      }, {
        id: "following",
        text: "Following",
        invisible: true
      }, {
        id: "torah-tracker",
        text: "Torah Tracker",
        invisible: sefaria._uid !== props.profile.id,
        icon: "/static/icons/chart-icon.svg",
        href: "/torahtracker",
        applink: true,
        justifyright: true
      }];
      if (showNotes) {
        tabs.splice(2, 0, {
          id: "notes",
          text: sefaria._("Notes"),
          icon: "/static/icons/note.svg"
        });
      }
      if (showBio) {
        tabs.push({
          id: "about",
          text: sefaria._("About"),
          icon: "/static/icons/info.svg"
        });
      }
      return {
        showNotes: showNotes,
        showBio: showBio,
        tabs: tabs
      };
    }
  }, {
    key: "_getTabViewRef",
    value: function _getTabViewRef(ref) {
      this._tabViewRef = ref;
    }
  }, {
    key: "getCollections",
    value: function getCollections() {
      return sefaria.getUserCollections(this.props.profile.id);
    }
  }, {
    key: "getCollectionsFromCache",
    value: function getCollectionsFromCache() {
      return sefaria.getUserCollectionsFromCache(this.props.profile.id);
    }
  }, {
    key: "filterCollection",
    value: function filterCollection(currFilter, collection) {
      var n = function n(text) {
        return text.toLowerCase();
      };
      currFilter = n(currFilter);
      return n(collection.name).indexOf(currFilter) > -1;
    }
  }, {
    key: "sortCollection",
    value: function sortCollection(currSortOption, collectionA, collectionB) {
      switch (currSortOption) {
        case "Recent":
          return collectionB.lastModified > collectionA.lastModified ? 1 : -1;
          break;
        case "Name":
          return collectionB.name > collectionA.name ? -1 : 1;
          break;
        case "Sheets":
          return collectionB.sheetCount - collectionA.sheetCount;
          break;
      }
    }
  }, {
    key: "handleCollectionsChange",
    value: function handleCollectionsChange() {
      // Rerender Collections tab when data changes in cache.
      this.setState({
        refreshCollectionsData: Math.random(),
        refreshSheetData: Math.random()
      });
    }
  }, {
    key: "renderEmptyCollectionList",
    value: function renderEmptyCollectionList() {
      if (sefaria._uid !== this.props.profile.id) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "emptyList"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "emptyListText"
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, this.props.profile.full_name), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, " hasn't shared any collections yet.")));
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "emptyList"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "emptyListText"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "You can use collections to organize your sheets or public sheets you like. Collections can be shared privately or made public on Sefaria.")), /*#__PURE__*/external_react_default().createElement("a", {
        href: "/collections/new",
        className: "resourcesLink sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/collection.svg",
        alt: "Collection icon"
      }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Create a New Collection")));
    }
  }, {
    key: "renderCollection",
    value: function renderCollection(collection) {
      return /*#__PURE__*/external_react_default().createElement(CollectionListing, {
        key: collection.slug,
        data: collection
      });
    }
  }, {
    key: "renderCollectionHeader",
    value: function renderCollectionHeader() {
      if (sefaria._uid !== this.props.profile.id) {
        return null;
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "sheet-header"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: "/collections/new",
        className: "resourcesLink sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/icons/collection.svg",
        alt: "Collection icon"
      }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Create a New Collection")));
    }
  }, {
    key: "getNotes",
    value: function getNotes() {
      return new Promise(function (resolve, reject) {
        sefaria.allPrivateNotes(function (notes) {
          resolve(notes);
        });
      });
    }
  }, {
    key: "getNotesFromCache",
    value: function getNotesFromCache() {
      return sefaria.allPrivateNotes();
    }
  }, {
    key: "onDeleteNote",
    value: function onDeleteNote() {
      var _this2 = this;
      sefaria.clearPrivateNotes();
      this.getNotes().then(function () {
        return _this2.setState({
          refreshNoteData: Math.random()
        });
      });
    }
  }, {
    key: "filterNote",
    value: function filterNote(currFilter, note) {
      var n = function n(text) {
        return text.toLowerCase();
      };
      currFilter = n(currFilter);
      return n(note.text).indexOf(currFilter) > -1;
    }
  }, {
    key: "sortNote",
    value: function sortNote(currSortOption, noteA, noteB) {
      return 0;
    }
  }, {
    key: "renderEmptyNoteList",
    value: function renderEmptyNoteList() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "emptyList"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "emptyListText"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "0 Notes"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "0 \u05D4\u05E2\u05E8\u05D5\u05EA")));
    }
  }, {
    key: "renderNote",
    value: function renderNote(note) {
      return /*#__PURE__*/external_react_default().createElement(js_NoteListing, {
        key: "".concat(note.text, "|").concat(note.ref),
        data: note,
        onDeleteNote: this.onDeleteNote
      });
    }
  }, {
    key: "getSheets",
    value: function getSheets() {
      var _this3 = this;
      return new Promise(function (resolve, reject) {
        sefaria.sheets.userSheets(_this3.props.profile.id, function (sheets) {
          resolve(sheets);
        }, undefined, 0, 0);
      });
    }
  }, {
    key: "getSheetsFromCache",
    value: function getSheetsFromCache() {
      return sefaria.sheets.userSheets(this.props.profile.id, null, undefined, 0, 0);
    }
  }, {
    key: "filterSheet",
    value: function filterSheet(currFilter, sheet) {
      var n = function n(text) {
        return text.toLowerCase();
      };
      currFilter = n(currFilter);
      var filterText = [sheet.title.stripHtml(), sheet.topics.map(function (topic) {
        return topic.asTyped;
      }).join(" "), sheet.collections ? sheet.collections.map(function (collection) {
        return collection.name;
      }).join(" ") : "", "displayedCollectionName" in sheet ? sheet.displayedCollectionName : ""].join(" ");
      return n(filterText).indexOf(currFilter) > -1;
    }
  }, {
    key: "sortSheet",
    value: function sortSheet(currSortOption, sheetA, sheetB) {
      if (currSortOption === "Recent") {
        return 0; /* already in order */
      } else {
        return sheetB.views - sheetA.views;
      }
    }
  }, {
    key: "renderEmptySheetList",
    value: function renderEmptySheetList() {
      if (sefaria._uid !== this.props.profile.id) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "emptyList"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "emptyListText"
        }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, this.props.profile.full_name), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, " hasn't shared any sheets yet.")));
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "emptyList"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "emptyListText"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "You can use sheets to save and organize sources, write new texts, create lessons, lectures, articles, and more."), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D1\u05D0\u05E4\u05E9\u05E8\u05D5\u05EA\u05DB\u05DD \u05DC\u05D4\u05E9\u05EA\u05DE\u05E9 \u05D1\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D1\u05DB\u05D3\u05D9 \u05DC\u05D0\u05E8\u05D2\u05DF \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA, \u05DC\u05D9\u05E6\u05D5\u05E8 \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05D7\u05D3\u05E9\u05D9\u05DD, \u05DC\u05EA\u05DB\u05E0\u05DF \u05E9\u05D9\u05E2\u05D5\u05E8\u05D9\u05DD, \u05D4\u05E8\u05E6\u05D0\u05D5\u05EA, \u05DB\u05EA\u05D1\u05D5\u05EA \u05D5\u05E2\u05D5\u05D3.")), /*#__PURE__*/external_react_default().createElement("a", {
        href: "/sheets/new",
        className: "resourcesLink sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/img/sheet.svg",
        alt: "Source sheet icon"
      }), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Create a New Sheet"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05E6\u05D5\u05E8 \u05D3\u05E3 \u05D7\u05D3\u05E9")));
    }
  }, {
    key: "handleSheetDelete",
    value: function handleSheetDelete() {
      var _this4 = this;
      sefaria.sheets.clearUserSheets(sefaria._uid);
      this.getSheets().then(function () {
        return _this4.setState({
          refreshSheetData: Math.random()
        });
      });
      sefaria._collections = {};
      delete sefaria._userCollections[sefaria._uid];
      this.getCollections().then(function () {
        return _this4.setState({
          refreshCollectionsData: Math.random()
        });
      });
    }
  }, {
    key: "renderSheet",
    value: function renderSheet(sheet) {
      return /*#__PURE__*/external_react_default().createElement(SheetListing, {
        key: sheet.id,
        sheet: sheet,
        hideAuthor: true,
        handleSheetDelete: this.handleSheetDelete,
        handleCollectionsChange: this.handleCollectionsChange,
        editable: sefaria._uid === this.props.profile.id,
        deletable: sefaria._uid === this.props.profile.id,
        saveable: sefaria._uid !== this.props.profile.id,
        collectable: true,
        connectedRefs: [],
        infoUnderneath: true,
        toggleSignUpModal: this.props.toggleSignUpModal
      });
    }
  }, {
    key: "renderSheetHeader",
    value: function renderSheetHeader() {
      if (sefaria._uid !== this.props.profile.id) {
        return null;
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "sheet-header"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        href: "/sheets/new",
        className: "resourcesLink sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/img/sheet.svg",
        alt: "Source sheet icon"
      }), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Create a New Sheet"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D9\u05E6\u05D9\u05E8\u05EA \u05D3\u05E3 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA")));
    }
  }, {
    key: "getFollowers",
    value: function getFollowers() {
      return sefaria.followAPI(this.props.profile.slug, "followers");
    }
  }, {
    key: "getFollowing",
    value: function getFollowing() {
      return sefaria.followAPI(this.props.profile.slug, "following");
    }
  }, {
    key: "filterFollower",
    value: function filterFollower(currFilter, follower) {
      var n = function n(text) {
        return text.toLowerCase();
      };
      currFilter = n(currFilter);
      return n(follower.full_name).indexOf(currFilter) > -1 || n(follower.position).indexOf(currFilter) > -1;
    }
  }, {
    key: "renderFollowerHeader",
    value: function renderFollowerHeader() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "follow-header sans-serif"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Followers"), " ", /*#__PURE__*/external_react_default().createElement("span", {
        className: "follow-count"
      }, "(".concat(this.props.profile.followers.length, ")")));
    }
  }, {
    key: "renderFollowingHeader",
    value: function renderFollowingHeader() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "follow-header sans-serif"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Following"), " ", /*#__PURE__*/external_react_default().createElement("span", {
        className: "follow-count"
      }, "(".concat(this.props.profile.followees.length, ")")));
    }
  }, {
    key: "renderFollower",
    value: function renderFollower(item) {
      return /*#__PURE__*/external_react_default().createElement(ProfileListing, {
        key: item.id,
        uid: item.id,
        slug: item.slug,
        url: "/profile/".concat(item.slug),
        name: item.full_name,
        image: item.profile_pic_url,
        is_followed: sefaria.following.indexOf(item.id) > -1,
        position: item.position,
        organization: item.organization,
        toggleSignUpModal: this.props.toggleSignUpModal
      });
    }
  }, {
    key: "renderEmptyFollowerList",
    value: function renderEmptyFollowerList() {
      return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "0 followers"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "0 \u05E2\u05D5\u05E7\u05D1\u05D9\u05DD"));
    }
  }, {
    key: "renderEmptyFollowingList",
    value: function renderEmptyFollowingList() {
      return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "0 following"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "0 \u05E0\u05E2\u05E7\u05D1\u05D9\u05DD"));
    }
  }, {
    key: "renderTab",
    value: function renderTab(tab) {
      if (tab.invisible) {
        return null;
      }
      if (tab.applink) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "tab"
        }, /*#__PURE__*/external_react_default().createElement("a", {
          href: tab.href
        }, /*#__PURE__*/external_react_default().createElement("img", {
          className: "tabIcon",
          src: tab.icon,
          alt: "".concat(tab.text, " icon")
        }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, tab.text)));
      }
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "tab"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        className: "tabIcon",
        src: tab.icon,
        alt: "".concat(tab.text, " icon")
      }), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, tab.text));
    }
  }, {
    key: "follow",
    value: function follow() {
      sefaria.followAPI(this.props.profile.id);
    }
  }, {
    key: "openFollowers",
    value: function openFollowers(e) {
      e.preventDefault();
      this.props.setTab("followers");
    }
  }, {
    key: "openFollowing",
    value: function openFollowing(e) {
      e.preventDefault();
      this.props.setTab("following");
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        key: this.props.profile.id,
        className: "profile-page readerNavMenu"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "content noOverflowX"
      }, this.props.profile.show_editor_toggle ? /*#__PURE__*/external_react_default().createElement(EditorToggleHeader, {
        usesneweditor: this.props.profile.uses_new_editor
      }) : null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "contentInner"
      }, !this.props.profile.id ? /*#__PURE__*/external_react_default().createElement(LoadingMessage, null) : /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(ProfileSummary, {
        profile: this.props.profile,
        follow: this.follow,
        openFollowers: this.openFollowers,
        openFollowing: this.openFollowing,
        toggleSignUpModal: this.props.toggleSignUpModal
      }), /*#__PURE__*/external_react_default().createElement(TabView, {
        ref: this._getTabViewRef,
        currTabName: this.props.tab,
        tabs: this.state.tabs,
        renderTab: this.renderTab,
        setTab: this.props.setTab
      }, /*#__PURE__*/external_react_default().createElement(FilterableList, {
        key: "sheet",
        pageSize: 1e6,
        filterFunc: this.filterSheet,
        sortFunc: this.sortSheet,
        renderItem: this.renderSheet,
        renderEmptyList: this.renderEmptySheetList,
        renderHeader: this.renderSheetHeader,
        sortOptions: ["Recent", "Views"],
        containerClass: "sheetList",
        getData: this.getSheets,
        data: this.getSheetsFromCache(),
        refreshData: this.state.refreshSheetData
      }), /*#__PURE__*/external_react_default().createElement(FilterableList, {
        key: "collection",
        pageSize: 1e6,
        filterFunc: this.filterCollection,
        sortFunc: this.sortCollection,
        renderItem: this.renderCollection,
        renderEmptyList: this.renderEmptyCollectionList,
        renderHeader: this.renderCollectionHeader,
        sortOptions: ["Recent", "Name", "Sheets"],
        getData: this.getCollections,
        data: this.getCollectionsFromCache(),
        refreshData: this.state.refreshCollectionsData
      }), this.state.showNotes ? /*#__PURE__*/external_react_default().createElement(FilterableList, {
        key: "note",
        pageSize: 1e6,
        filterFunc: this.filterNote,
        sortFunc: this.sortNote,
        renderItem: this.renderNote,
        renderEmptyList: this.renderEmptyNoteList,
        sortOptions: [],
        getData: this.getNotes,
        data: this.getNotesFromCache(),
        refreshData: this.state.refreshNoteData
      }) : null, /*#__PURE__*/external_react_default().createElement(FilterableList, {
        key: "follower",
        pageSize: 1e6,
        filterFunc: this.filterFollower,
        sortFunc: function sortFunc() {
          return 0;
        },
        renderItem: this.renderFollower,
        renderEmptyList: this.renderEmptyFollowerList,
        renderHeader: this.renderFollowerHeader,
        sortOptions: [],
        getData: this.getFollowers
      }), /*#__PURE__*/external_react_default().createElement(FilterableList, {
        key: "following",
        pageSize: 1e6,
        filterFunc: this.filterFollower,
        sortFunc: function sortFunc() {
          return 0;
        },
        renderItem: this.renderFollower,
        renderEmptyList: this.renderEmptyFollowingList,
        renderHeader: this.renderFollowingHeader,
        sortOptions: [],
        getData: this.getFollowing
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "torahTrackerPlaceholder filterable-list"
      }), this.state.showBio ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "systemText filterable-list"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "aboutText",
        dangerouslySetInnerHTML: {
          __html: this.props.profile.bio
        }
      })) : null))), /*#__PURE__*/external_react_default().createElement(js_Footer, null)));
    }
  }]);
  return UserProfile;
}((external_react_class_default()));
UserProfile.propTypes = {
  profile: (external_prop_types_default()).object.isRequired
};
var EditorToggleHeader = function EditorToggleHeader(_ref) {
  var usesneweditor = _ref.usesneweditor;
  var _useState = (0,external_react_.useState)("hidden"),
    _useState2 = UserProfile_slicedToArray(_useState, 2),
    feedbackHeaderState = _useState2[0],
    setFeedbackHeaderState = _useState2[1];
  var text = /*#__PURE__*/external_react_default().createElement(InterfaceText, null, usesneweditor ? "You are currently testing the new Sefaria editor." : "You are currently using the old Sefaria editor.");
  var buttonText = /*#__PURE__*/external_react_default().createElement(InterfaceText, null, usesneweditor ? "Go back to old version" : "Try the new version");
  var sendFeedback = function sendFeedback() {
    var feedback = {
      type: "new_editor",
      email: null,
      msg: $("#feedbackText").val(),
      url: "",
      uid: sefaria._uid || null
    };
    if (!feedback.msg) {
      setFeedbackHeaderState("thanks");
      return;
    }
    var postData = {
      json: JSON.stringify(feedback)
    };
    var url = "/api/send_feedback";
    $.post(url, postData, function (data) {
      if (data.error) {
        alert(data.error);
      } else {
        console.log(data);
        $("#feedbackText").val("");
        sefaria.track.event("New Editor", "Send Feedback", null);
        setFeedbackHeaderState("thanks");
      }
    }.bind(UserProfile_this5)).fail(function (xhr, textStatus, errorThrown) {
      alert(sefaria._("Unfortunately, there was an error sending this feedback. Please try again or try reloading this page."));
    });
  };
  var disableOverlayContent = /*#__PURE__*/external_react_default().createElement("div", {
    "class": "sans-serif-in-hebrew"
  }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Request for Feedback")), /*#__PURE__*/external_react_default().createElement("p", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Thank you for trying the new Sefaria editor! We\u2019d love to hear what you thought. Please take a few minutes to give us feedback on your experience.")), /*#__PURE__*/external_react_default().createElement("p", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Did you encounter any issues while using the new editor? For example:")), /*#__PURE__*/external_react_default().createElement("ul", null, /*#__PURE__*/external_react_default().createElement("li", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Technical problems")), /*#__PURE__*/external_react_default().createElement("li", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Difficulties using the editor")), /*#__PURE__*/external_react_default().createElement("li", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Missing features"))), /*#__PURE__*/external_react_default().createElement("p", null, /*#__PURE__*/external_react_default().createElement("textarea", {
    className: "feedbackText",
    placeholder: sefaria._("Tell us about it..."),
    id: "feedbackText"
  })), /*#__PURE__*/external_react_default().createElement("p", null, /*#__PURE__*/external_react_default().createElement("a", {
    href: "#",
    className: "button",
    role: "button",
    onClick: function onClick() {
      return sendFeedback();
    }
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Submit Feedback"))));
  var enableOverlayContent = /*#__PURE__*/external_react_default().createElement("div", {
    "class": "sans-serif-in-hebrew"
  }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Thanks for Trying the New Editor!")), /*#__PURE__*/external_react_default().createElement("p", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Go to your profile to create a new sheet, or edit an existing sheet, to try out the new experience. After you\u2019ve had a chance to try it out, we would love to hear your feedback. You can reach us at"), " ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "mailto:hello@sefaria.org"
  }, "hello@sefaria.org")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "buttonContainer"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/enable_new_editor",
    onClick: function onClick() {
      return toggleFeedbackOverlayState();
    },
    className: "button",
    role: "button"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Back to Profile"))));
  var thankYouContent = /*#__PURE__*/external_react_default().createElement("div", {
    "class": "sans-serif-in-hebrew"
  }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Thank you!")), /*#__PURE__*/external_react_default().createElement("p", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Your feedback is greatly appreciated. You can now edit your sheets again using the old source sheet editor. If you have any questions or additional feedback you can reach us at"), " ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "mailto:hello@sefaria.org"
  }, "hello@sefaria.org"), "."), /*#__PURE__*/external_react_default().createElement("div", {
    className: "buttonContainer"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/disable_new_editor",
    className: "button",
    role: "button"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Back to Profile"))));
  var overlayContent;
  switch (feedbackHeaderState) {
    case "disableOverlay":
      overlayContent = disableOverlayContent;
      break;
    case "enableOverlay":
      overlayContent = enableOverlayContent;
      break;
    case "thanks":
      overlayContent = thankYouContent;
      break;
  }
  var toggleFeedbackOverlayState = function toggleFeedbackOverlayState() {
    if (usesneweditor) {
      setFeedbackHeaderState("disableOverlay");
    } else {
      setFeedbackHeaderState("enableOverlay");
    }
  };
  var buttonLink = usesneweditor ? "/disable_new_editor" : "";
  return /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "editorToggleHeader sans-serif"
  }, text, /*#__PURE__*/external_react_default().createElement("a", {
    href: "#",
    onClick: function onClick() {
      return toggleFeedbackOverlayState();
    },
    className: "button white",
    role: "button"
  }, buttonText)), feedbackHeaderState != "hidden" ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "feedbackOverlay"
  }, overlayContent) : null);
};
var ProfileSummary = function ProfileSummary(_ref2) {
  var p = _ref2.profile,
    follow = _ref2.follow,
    openFollowers = _ref2.openFollowers,
    openFollowing = _ref2.openFollowing,
    toggleSignUpModal = _ref2.toggleSignUpModal;
  // collect info about this profile in `infoList`
  var social = ['facebook', 'twitter', 'youtube', 'linkedin'];
  var infoList = [];
  if (p.location) {
    infoList.push(p.location);
  }
  infoList = infoList.concat(p.jewish_education);
  if (p.website) {
    infoList.push( /*#__PURE__*/external_react_default().createElement("span", null, /*#__PURE__*/external_react_default().createElement("a", {
      href: p.website,
      target: "_blank"
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Website"))));
  }
  var socialList = social.filter(function (s) {
    return !!p[s];
  });
  if (socialList.length) {
    infoList = infoList.concat(
    /*#__PURE__*/
    // we only store twitter handles so twitter needs to be hardcoded
    external_react_default().createElement("span", null, socialList.map(function (s) {
      return /*#__PURE__*/external_react_default().createElement("a", {
        key: s,
        className: "social-icon",
        target: "_blank",
        href: (s == 'twitter' ? 'https://twitter.com/' : '') + p[s]
      }, /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/img/".concat(s, ".svg")
      }));
    })));
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "profile-summary sans-serif"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "summary-column profile-summary-content start"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "title pageTitle"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, p.full_name), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, p.full_name)), p.position || p.organization ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "title sub-title"
  }, /*#__PURE__*/external_react_default().createElement("span", null, p.position), p.position && p.organization ? /*#__PURE__*/external_react_default().createElement("span", null, sefaria._(" at ")) : null, /*#__PURE__*/external_react_default().createElement("span", null, p.organization)) : null, infoList.length ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "title sub-sub-title"
  }, infoList.map(function (i, ii) {
    return /*#__PURE__*/external_react_default().createElement("span", {
      key: ii
    }, ii !== 0 ? "\u2022" : null, /*#__PURE__*/external_react_default().createElement("span", {
      className: "small-margin"
    }, i));
  })) : null, sefaria._uid === p.id ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "profile-actions"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/settings/profile",
    className: "resourcesLink sans-serif"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Edit Profile"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05E2\u05E8\u05D9\u05DB\u05EA \u05E4\u05E8\u05D5\u05E4\u05D9\u05DC")), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/settings/account",
    className: "resourcesLink sans-serif profile-settings"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/icons/settings.svg",
    alt: "Profile Settings"
  }), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Settings"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05D4\u05D2\u05D3\u05E8\u05D5\u05EA")), /*#__PURE__*/external_react_default().createElement("a", {
    href: "/logout",
    className: "button transparent logoutLink"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Log Out"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05E0\u05D9\u05EA\u05D5\u05E7"))) : /*#__PURE__*/external_react_default().createElement("div", {
    className: "profile-actions"
  }, /*#__PURE__*/external_react_default().createElement(FollowButton, {
    large: true,
    uid: p.id,
    following: sefaria.following.indexOf(p.id) > -1,
    toggleSignUpModal: toggleSignUpModal
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "follow"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "",
    onClick: openFollowers
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, String(p.followers.length)), "\xA0", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "followers")), /*#__PURE__*/external_react_default().createElement("span", {
    className: "follow-bull"
  }, "\u2022"), /*#__PURE__*/external_react_default().createElement("a", {
    href: "",
    onClick: openFollowing
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, String(p.followees.length)), "\xA0", /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "following")))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "summary-column end"
  }, /*#__PURE__*/external_react_default().createElement(ProfilePic, {
    url: p.profile_pic_url,
    name: p.full_name,
    len: 175,
    hideOnDefault: sefaria._uid !== p.id,
    showButtons: sefaria._uid === p.id
  })));
};
ProfileSummary.propTypes = {
  profile: (external_prop_types_default()).object.isRequired,
  follow: (external_prop_types_default()).func.isRequired,
  openFollowers: (external_prop_types_default()).func.isRequired,
  openFollowing: (external_prop_types_default()).func.isRequired,
  toggleSignUpModal: (external_prop_types_default()).func.isRequired
};
/* harmony default export */ const js_UserProfile = (UserProfile);
;// CONCATENATED MODULE: ../static/js/UpdatesPanel.jsx
function UpdatesPanel_typeof(obj) { "@babel/helpers - typeof"; return UpdatesPanel_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, UpdatesPanel_typeof(obj); }
function UpdatesPanel_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function UpdatesPanel_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, UpdatesPanel_toPropertyKey(descriptor.key), descriptor); } }
function UpdatesPanel_createClass(Constructor, protoProps, staticProps) { if (protoProps) UpdatesPanel_defineProperties(Constructor.prototype, protoProps); if (staticProps) UpdatesPanel_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function UpdatesPanel_toPropertyKey(arg) { var key = UpdatesPanel_toPrimitive(arg, "string"); return UpdatesPanel_typeof(key) === "symbol" ? key : String(key); }
function UpdatesPanel_toPrimitive(input, hint) { if (UpdatesPanel_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (UpdatesPanel_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function UpdatesPanel_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) UpdatesPanel_setPrototypeOf(subClass, superClass); }
function UpdatesPanel_setPrototypeOf(o, p) { UpdatesPanel_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return UpdatesPanel_setPrototypeOf(o, p); }
function UpdatesPanel_createSuper(Derived) { var hasNativeReflectConstruct = UpdatesPanel_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = UpdatesPanel_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = UpdatesPanel_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return UpdatesPanel_possibleConstructorReturn(this, result); }; }
function UpdatesPanel_possibleConstructorReturn(self, call) { if (call && (UpdatesPanel_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return UpdatesPanel_assertThisInitialized(self); }
function UpdatesPanel_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function UpdatesPanel_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function UpdatesPanel_getPrototypeOf(o) { UpdatesPanel_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return UpdatesPanel_getPrototypeOf(o); }











var UpdatesPanel = /*#__PURE__*/function (_Component) {
  UpdatesPanel_inherits(UpdatesPanel, _Component);
  var _super = UpdatesPanel_createSuper(UpdatesPanel);
  function UpdatesPanel(props) {
    var _this;
    UpdatesPanel_classCallCheck(this, UpdatesPanel);
    _this = _super.call(this, props);
    _this.state = {
      page: 0,
      loadedToEnd: false,
      loading: false,
      updates: [],
      submitting: false,
      submitCount: 0,
      error: null
    };
    return _this;
  }
  UpdatesPanel_createClass(UpdatesPanel, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".content").bind("scroll", this.handleScroll);
      this.getMoreNotifications();
    }
  }, {
    key: "handleScroll",
    value: function handleScroll() {
      if (this.state.loadedToEnd || this.state.loading) {
        return;
      }
      var $scrollable = sefariaJquery(external_react_dom_default().findDOMNode(this)).find(".content");
      var margin = 600;
      if ($scrollable.scrollTop() + $scrollable.innerHeight() + margin >= $scrollable[0].scrollHeight) {
        this.getMoreNotifications();
      }
    }
  }, {
    key: "getMoreNotifications",
    value: function getMoreNotifications() {
      sefariaJquery.getJSON("/api/updates?page=" + this.state.page, this.loadMoreNotifications);
      this.setState({
        loading: true
      });
    }
  }, {
    key: "loadMoreNotifications",
    value: function loadMoreNotifications(data) {
      if (data.count < data.page_size) {
        this.setState({
          loadedToEnd: true
        });
      }
      this.setState({
        page: data.page + 1,
        loading: false,
        updates: this.state.updates.concat(data.updates)
      });
    }
  }, {
    key: "onDelete",
    value: function onDelete(id) {
      sefariaJquery.ajax({
        url: '/api/updates/' + id,
        type: 'DELETE',
        success: function (result) {
          if (result.status == "ok") {
            this.setState({
              updates: this.state.updates.filter(function (u) {
                return u._id != id;
              })
            });
          }
        }.bind(this)
      });
    }
  }, {
    key: "handleSubmit",
    value: function handleSubmit(type, content) {
      this.setState({
        "submitting": true,
        "error": null
      });
      var payload = {
        type: type,
        content: content
      };
      sefariaJquery.ajax({
        url: "/api/updates",
        dataType: 'json',
        type: 'POST',
        data: {
          json: JSON.stringify(payload)
        },
        success: function (data) {
          if (data.status == "ok") {
            payload.date = Date();
            this.state.updates.unshift(payload);
            this.setState({
              submitting: false,
              updates: this.state.updates,
              submitCount: this.state.submitCount + 1
            });
          } else {
            this.setState({
              "error": "Error - " + data.error
            });
          }
        }.bind(this),
        error: function (xhr, status, err) {
          this.setState({
            "error": "Error - " + err.toString()
          });
          console.error(this.props.url, status, err.toString());
        }.bind(this)
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this;
      var sidebarModules = [{
        type: "Promo"
      }, {
        type: "StayConnected"
      }];
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerNavMenu sans-serif"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "content"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "sidebarLayout"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "contentInner"
      }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Updates")), sefaria.is_moderator ? /*#__PURE__*/external_react_default().createElement(NewUpdateForm, {
        handleSubmit: this.handleSubmit,
        key: this.state.submitCount,
        error: this.state.error
      }) : "", /*#__PURE__*/external_react_default().createElement("div", {
        className: "notificationsList"
      }, this.state.updates.map(function (u) {
        return /*#__PURE__*/external_react_default().createElement(SingleUpdate, {
          type: u.type,
          content: u.content,
          date: u.date,
          key: u._id,
          id: u._id,
          onDelete: _this2.onDelete,
          submitting: _this2.state.submitting
        });
      }))), /*#__PURE__*/external_react_default().createElement(NavSidebar, {
        modules: sidebarModules
      })), /*#__PURE__*/external_react_default().createElement(js_Footer, null)));
    }
  }]);
  return UpdatesPanel;
}((external_react_class_default()));
UpdatesPanel.propTypes = {
  interfaceLang: (external_prop_types_default()).string
};
var NewUpdateForm = /*#__PURE__*/function (_Component2) {
  UpdatesPanel_inherits(NewUpdateForm, _Component2);
  var _super2 = UpdatesPanel_createSuper(NewUpdateForm);
  function NewUpdateForm(props) {
    var _this3;
    UpdatesPanel_classCallCheck(this, NewUpdateForm);
    _this3 = _super2.call(this, props);
    _this3.state = {
      type: 'index',
      index: '',
      language: 'en',
      version: '',
      en: '',
      he: '',
      error: ''
    };
    return _this3;
  }
  UpdatesPanel_createClass(NewUpdateForm, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      this.setState({
        "error": nextProps.error
      });
    }
  }, {
    key: "handleEnChange",
    value: function handleEnChange(e) {
      this.setState({
        en: e.target.value,
        error: null
      });
    }
  }, {
    key: "handleHeChange",
    value: function handleHeChange(e) {
      this.setState({
        he: e.target.value,
        error: null
      });
    }
  }, {
    key: "handleTypeChange",
    value: function handleTypeChange(e) {
      this.setState({
        type: e.target.value,
        error: null
      });
    }
  }, {
    key: "handleIndexChange",
    value: function handleIndexChange(e) {
      this.setState({
        index: e.target.value,
        error: null
      });
    }
  }, {
    key: "handleVersionChange",
    value: function handleVersionChange(e) {
      this.setState({
        version: e.target.value,
        error: null
      });
    }
  }, {
    key: "handleLanguageChange",
    value: function handleLanguageChange(e) {
      this.setState({
        language: e.target.value,
        error: null
      });
    }
  }, {
    key: "handleSubmit",
    value: function handleSubmit(e) {
      e.preventDefault();
      var content = {
        "en": this.state.en.trim(),
        "he": this.state.he.trim()
      };
      if (this.state.type == "general") {
        if (!this.state.en || !this.state.he) {
          this.setState({
            "error": "Both Hebrew and English are required"
          });
          return;
        }
      } else {
        if (!this.state.index) {
          this.setState({
            "error": "Index is required"
          });
          return;
        }
        content["index"] = this.state.index.trim();
      }
      if (this.state.type == "version") {
        if (!this.state.version || !this.state.language) {
          this.setState({
            "error": "Version is required"
          });
          return;
        }
        content["version"] = this.state.version.trim();
        content["language"] = this.state.language.trim();
      }
      this.props.handleSubmit(this.state.type, content);
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("form", {
        className: "globalUpdateForm",
        onSubmit: this.handleSubmit
      }, /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("input", {
        type: "radio",
        name: "type",
        value: "index",
        onChange: this.handleTypeChange,
        checked: this.state.type == "index"
      }), "Index\xA0\xA0", /*#__PURE__*/external_react_default().createElement("input", {
        type: "radio",
        name: "type",
        value: "version",
        onChange: this.handleTypeChange,
        checked: this.state.type == "version"
      }), "Version\xA0\xA0", /*#__PURE__*/external_react_default().createElement("input", {
        type: "radio",
        name: "type",
        value: "general",
        onChange: this.handleTypeChange,
        checked: this.state.type == "general"
      }), "General\xA0\xA0"), /*#__PURE__*/external_react_default().createElement("div", null, this.state.type != "general" ? /*#__PURE__*/external_react_default().createElement("input", {
        type: "text",
        placeholder: "Index Title",
        onChange: this.handleIndexChange
      }) : "", this.state.type == "version" ? /*#__PURE__*/external_react_default().createElement("input", {
        type: "text",
        placeholder: "Version Title",
        onChange: this.handleVersionChange
      }) : "", this.state.type == "version" ? /*#__PURE__*/external_react_default().createElement("select", {
        type: "text",
        placeholder: "Version Language",
        onChange: this.handleLanguageChange
      }, /*#__PURE__*/external_react_default().createElement("option", {
        value: "en"
      }, "English"), /*#__PURE__*/external_react_default().createElement("option", {
        value: "he"
      }, "Hebrew")) : ""), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("textarea", {
        placeholder: "English Description (optional for Index and Version)",
        onChange: this.handleEnChange,
        rows: "3",
        cols: "80"
      })), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("textarea", {
        placeholder: "Hebrew Description (optional for Index and Version)",
        onChange: this.handleHeChange,
        rows: "3",
        cols: "80"
      })), /*#__PURE__*/external_react_default().createElement("input", {
        type: "submit",
        value: "Submit",
        disabled: this.props.submitting
      }), /*#__PURE__*/external_react_default().createElement("span", {
        className: "error"
      }, this.state.error));
    }
  }]);
  return NewUpdateForm;
}((external_react_class_default()));
NewUpdateForm.propTypes = {
  error: (external_prop_types_default()).string,
  handleSubmit: (external_prop_types_default()).func
};
var SingleUpdate = /*#__PURE__*/function (_Component3) {
  UpdatesPanel_inherits(SingleUpdate, _Component3);
  var _super3 = UpdatesPanel_createSuper(SingleUpdate);
  function SingleUpdate() {
    UpdatesPanel_classCallCheck(this, SingleUpdate);
    return _super3.apply(this, arguments);
  }
  UpdatesPanel_createClass(SingleUpdate, [{
    key: "onDelete",
    value: function onDelete() {
      this.props.onDelete(this.props.id);
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "update"
      }, sefaria.is_moderator ? /*#__PURE__*/external_react_default().createElement("i", {
        className: "fa fa-times-circle delete-update-button",
        onClick: this.onDelete,
        "aria-hidden": "true"
      }) : "", /*#__PURE__*/external_react_default().createElement(Notifications, {
        type: this.props.type,
        props: this.props
      }));
    }
  }]);
  return SingleUpdate;
}((external_react_class_default()));
SingleUpdate.propTypes = {
  id: (external_prop_types_default()).string,
  type: (external_prop_types_default()).string,
  content: (external_prop_types_default()).object,
  onDelete: (external_prop_types_default()).func,
  date: (external_prop_types_default()).number
};
/* harmony default export */ const js_UpdatesPanel = (UpdatesPanel);
;// CONCATENATED MODULE: ../static/js/CommunityPage.jsx
function CommunityPage_slicedToArray(arr, i) { return CommunityPage_arrayWithHoles(arr) || CommunityPage_iterableToArrayLimit(arr, i) || CommunityPage_unsupportedIterableToArray(arr, i) || CommunityPage_nonIterableRest(); }
function CommunityPage_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function CommunityPage_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return CommunityPage_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return CommunityPage_arrayLikeToArray(o, minLen); }
function CommunityPage_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function CommunityPage_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function CommunityPage_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }









var CommunityPage = function CommunityPage(_ref) {
  var multiPanel = _ref.multiPanel,
    toggleSignUpModal = _ref.toggleSignUpModal,
    initialWidth = _ref.initialWidth;
  var _useState = (0,external_react_.useState)(!!sefaria.community),
    _useState2 = CommunityPage_slicedToArray(_useState, 2),
    dataLoaded = _useState2[0],
    setDataLoaded = _useState2[1];
  var sidebarModules = [{
    type: "JoinTheConversation"
  }, {
    type: dataLoaded ? "WhoToFollow" : null,
    props: {
      toggleSignUpModal: toggleSignUpModal
    }
  }, {
    type: "Promo"
  }, {
    type: "ExploreCollections"
  }, {
    type: "SupportSefaria",
    props: {
      blue: true
    }
  }, {
    type: "StayConnected"
  }];
  (0,external_react_.useEffect)(function () {
    if (!dataLoaded) {
      sefaria.getBackgroundData().then(function () {
        setDataLoaded(true);
      });
    }
  }, []);
  var featuredContent;
  if (dataLoaded) {
    var _Sefaria$community = sefaria.community,
      parashah = _Sefaria$community.parashah,
      calendar = _Sefaria$community.calendar,
      discover = _Sefaria$community.discover,
      featured = _Sefaria$community.featured;
    var sheets = [parashah, calendar, discover, featured].filter(function (x) {
      return !!x;
    }).map(function (x) {
      return x.sheet ? /*#__PURE__*/external_react_default().createElement(FeaturedSheet, {
        sheet: x.sheet,
        key: x.sheet.id,
        toggleSignUpModal: toggleSignUpModal,
        trackClicks: true
      }) : null;
    });
    featuredContent = /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
      content: sheets.slice(0, 2),
      stretch: true,
      initialWidth: initialWidth
    }), sheets.slice(2).map(function (sheet) {
      return /*#__PURE__*/external_react_default().createElement(NBox, {
        content: [sheet],
        n: 1,
        key: sheet.id
      });
    }));
  } else {
    featuredContent = /*#__PURE__*/external_react_default().createElement(LoadingMessage, null);
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerNavMenu communityPage sans-serif",
    key: "0"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "content"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sidebarLayout"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "contentInner mainColumn"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Today on Sefaria")), featuredContent, /*#__PURE__*/external_react_default().createElement(RecentlyPublished, {
    multiPanel: multiPanel,
    toggleSignUpModal: toggleSignUpModal
  })), /*#__PURE__*/external_react_default().createElement(NavSidebar, {
    modules: sidebarModules
  })), /*#__PURE__*/external_react_default().createElement(js_Footer, null)));
};
CommunityPage.propTypes = {
  toggleSignUpModal: (external_prop_types_default()).func.isRequired
};
var RecentlyPublished = function RecentlyPublished(_ref2) {
  var multiPanel = _ref2.multiPanel,
    toggleSignUpModal = _ref2.toggleSignUpModal;
  var options = sefaria.interfaceLang === "hebrew" ? {
    "lang": "hebrew"
  } : {};
  options["filtered"] = true;
  var pageSize = 18;
  var _useState3 = (0,external_react_.useState)(0),
    _useState4 = CommunityPage_slicedToArray(_useState3, 2),
    nSheetsLoaded = _useState4[0],
    setNSheetsLoded = _useState4[1]; // counting sheets loaded from the API, may be different than sheets displayed
  // Start with recent sheets in the cache, if any
  var _useState5 = (0,external_react_.useState)(collapseSheets(sefaria.sheets.publicSheets(0, pageSize, options))),
    _useState6 = CommunityPage_slicedToArray(_useState5, 2),
    recentSheets = _useState6[0],
    setRecentSheets = _useState6[1];

  // But also make an API call immeditately to check for updates
  (0,external_react_.useEffect)(function () {
    loadMore();
  }, []);
  var loadMore = function loadMore(e) {
    var until = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : pageSize;
    sefaria.sheets.publicSheets(nSheetsLoaded, pageSize, options, true, function (data) {
      var collapsedSheets = collapseSheets(data);
      var newSheets = recentSheets ? recentSheets.concat(collapsedSheets) : collapsedSheets;
      setRecentSheets(newSheets);
      setNSheetsLoded(nSheetsLoaded + pageSize);
      if (collapsedSheets.length < until) {
        loadMore(null, until - collapsedSheets.length);
      }
    });
  };
  var recentSheetsContent = !recentSheets ? [/*#__PURE__*/external_react_default().createElement(LoadingMessage, null)] : recentSheets.map(function (s) {
    return /*#__PURE__*/external_react_default().createElement(FeaturedSheet, {
      sheet: s,
      showDate: true,
      toggleSignUpModal: toggleSignUpModal
    });
  });
  var joinTheConversation = /*#__PURE__*/external_react_default().createElement("div", {
    className: "navBlock"
  }, /*#__PURE__*/external_react_default().createElement(Modules, {
    type: "JoinTheConversation",
    props: {
      wide: multiPanel
    }
  }));
  if (recentSheets) {
    recentSheetsContent.splice(6, 0, joinTheConversation);
    recentSheetsContent.push( /*#__PURE__*/external_react_default().createElement("a", {
      className: "button small white loadMore",
      onClick: loadMore
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      context: "RecentlyPublished"
    }, "Load More")));
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "recentlyPublished"
  }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Recently Published")), /*#__PURE__*/external_react_default().createElement(NBox, {
    content: recentSheetsContent,
    n: 1
  }));
};
var collapseSheets = function collapseSheets(sheets) {
  // Collapses consecutive sheets with the same author
  if (!sheets) {
    return null;
  }
  return sheets.reduce(function (accum, sheet) {
    if (!accum.length) {
      return [sheet];
    }
    var prev = accum[accum.length - 1];
    if (prev.author === sheet.author) {
      prev.moreSheets = prev.moreSheets || [];
      prev.moreSheets.push(sheet);
    } else {
      accum.push(sheet);
    }
    return accum;
  }, []);
};
var FeaturedSheet = function FeaturedSheet(_ref3) {
  var sheet = _ref3.sheet,
    showDate = _ref3.showDate,
    trackClicks = _ref3.trackClicks,
    toggleSignUpModal = _ref3.toggleSignUpModal;
  if (!sheet) {
    return null;
  }
  var heading = sheet.heading,
    title = sheet.title,
    id = sheet.id,
    summary = sheet.summary;
  var uid = sheet.author || sheet.owner;
  var author = {
    uid: uid,
    url: sheet.ownerProfileUrl,
    image: sheet.ownerImageUrl,
    name: sheet.ownerName,
    organization: sheet.ownerOrganization,
    is_followed: sefaria._uid ? sefaria.following.indexOf(uid) !== -1 : false,
    toggleSignUpModal: toggleSignUpModal
  };
  var now = new Date();
  var published = new Date(sheet.published);
  var naturalPublished = sefaria.util.naturalTime(published.getTime() / 1000, {
    "short": true
  });
  var trackClick = function trackClick() {
    sefaria.track.event("Community Page Featured Click", title, "/sheets/".concat(id));
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "featuredSheet navBlock"
  }, heading ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "featuredSheetHeading"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: heading
  })) : null, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/sheets/".concat(id),
    className: "navBlockTitle",
    onClick: trackClicks ? trackClick : null
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, title)), summary ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "navBlockDescription"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, summary)) : null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "featuredSheetBottom"
  }, /*#__PURE__*/external_react_default().createElement(ProfileListing, author), showDate ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "featuredSheetDate"
  }, "\u2022 ", naturalPublished) : null));
};

/*


            {parashah ?
            <HomepageRow 
              title="The Torah Portion"
              aboutContent={parashah.topic}
              sheet={parashah.sheet}
              AboutComponent={AboutParashah} 
              initialWidth={initialWidth} />
            : null }

            {calendar ?
            <HomepageRow 
              title="The Jewish Calendar"
              aboutContent={calendar.topic}
              sheet={calendar.sheet}
              AboutComponent={AboutCalendar} 
              initialWidth={initialWidth} />
            : null }

            {discover ?
            <HomepageRow 
              biTitles={{
                en: "Discover " + discover.about.category.en,
                he: Sefaria._("Discover ") + discover.about.category.he
              }}
              aboutContent={discover.about}
              sheet={discover.sheet}
              AboutComponent={AboutDiscover} 
              initialWidth={initialWidth} />
            : null }

            {featured ?
            <HomepageRow 
              title={featured.heading}
              sheet={featured.sheet}
              initialWidth={initialWidth} />
            : null }


const HomepageRow = ({title, biTitles, aboutContent, sheet, AboutComponent, initialWidth}) => {
  const blocks = [];
  if (aboutContent) {
    blocks.push(<AboutComponent content={aboutContent} />);
  }
  if (sheet) {
    blocks.push(<FeaturedSheet sheet={sheet} />);
  }

  return (
    <div>
      <h2>
        {biTitles ? 
        <InterfaceText text={biTitles} />
        : <InterfaceText>{title}</InterfaceText>}
      </h2>

      {blocks.length > 1 ?
      <ResponsiveNBox content={blocks} initialWidth={initialWidth} />
      : <NBox content={blocks} n={1} /> }
    </div>
  );
};


const AboutParashah = ({content}) => {
  if (!content) { return null; }
  const {primaryTitle, description, slug, ref} = content;
  const title = {
    en: primaryTitle.en.replace("Parashat ", ""),
    he: primaryTitle.he.replace("פרשת ", ""),
  }
  const style = {"borderColor": Sefaria.palette.categoryColor("Tanakh")};
  return (
    <div className="navBlock withColorLine" style={style}>
      <a href={`/topics/${slug}`} className="navBlockTitle serif">
        <InterfaceText text={title} />
      </a>       
      <div className="navBlockDescription">
        <InterfaceText text={description} />
      </div>
      <div className="readingLinks">
        <div className="readingLinksHeader">
          <InterfaceText context="AboutParashah">Torah Reading</InterfaceText>
        </div>
        <div className="calendarRef">
          <img src="/static/icons/book.svg" className="navSidebarIcon" alt="book icon" />
          <a href={`/${ref.url}`} className="serif">
            <InterfaceText text={ref} />
          </a> 
        </div>
      </div>
    </div>
  )
};


const AboutCalendar = ({content}) => {
  if (!content) { return null; }
  const {primaryTitle, description, slug, date, readings} = content;

  return (
    <div className="navBlock" >
      <a href={`/topics/${slug}`} className="navBlockTitle">
        <InterfaceText text={primaryTitle} />
      </a>
      <div className="calendarDate">
        <InterfaceText>{date}</InterfaceText>
      </div>
      <div className="navBlockDescription">
        <InterfaceText text={description} />
      </div>
      {!readings ? null :
      <div className="readingLinks">
        <div className="readingLinksHeader">
          <InterfaceText>Readings for</InterfaceText>&nbsp;<InterfaceText text={primaryTitle} />
        </div>
        {readings.map(ref => (
          <div className="calendarRef" key={ref.url}>
            <img src="/static/icons/book.svg" className="navSidebarIcon" alt="book icon" />
            <a href={`/${ref.url}`} className="serif">
              <InterfaceText text={ref} />
           </a> 
          </div>)
        )}
      </div> }
    </div>
  )
};


const AboutDiscover = ({content}) => {
  if (!content) { return null; }
  const {title, description, ref} = content;
  const cat   = Sefaria.refCategories(ref.url)[0]; 
  const style = {"borderColor": Sefaria.palette.categoryColor(cat)};

  return (
    <div className="navBlock withColorLine" style={style}>
      <a href={`/topics/${ref.url}`} className="navBlockTitle">
        <InterfaceText>{title}</InterfaceText>
      </a>
      <div className="navBlockDescription">
        <InterfaceText>{description}</InterfaceText>
      </div>
      <div className="readingLinks">
        <div className="readingLinksHeader">
          <InterfaceText>Readings</InterfaceText>
        </div>
          <div className="calendarRef" key={ref.url}>
            <img src="/static/icons/book.svg" className="navSidebarIcon" alt="book icon" />
            <a href={`/${ref.url}`} className="serif">
              <InterfaceText text={ref} />
           </a> 
          </div>
      </div>
    </div>
  )
};
*/

/* harmony default export */ const js_CommunityPage = (CommunityPage);
;// CONCATENATED MODULE: ../static/js/CalendarsPage.jsx








var CalendarsPage = function CalendarsPage(_ref) {
  var multiPanel = _ref.multiPanel,
    initialWidth = _ref.initialWidth;
  var calendars = reformatCalendars();
  var parashaCalendars = ["Parashat Hashavua", "Haftarah (A)", "Haftarah (S)", "Haftarah"];
  var dailyCalendars = ["Daf Yomi", "929", "Daily Mishnah", "Daily Rambam", "Daily Rambam (3 Chapters)", "Halakhah Yomit", "Arukh HaShulchan Yomi", "Tanakh Yomi", "Zohar for Elul", "Chok LeYisrael", "Tanya Yomi", "Yerushalmi Yomi"];
  var weeklyCalendars = ["Daf a Week"];
  var makeListings = function makeListings(list) {
    return calendars.filter(function (c) {
      return list.indexOf(c.title.en) != -1;
    }).map(function (c) {
      return /*#__PURE__*/external_react_default().createElement(CalendarListing, {
        calendar: c
      });
    });
  };
  var parashaListings = makeListings(parashaCalendars);
  var dailyListings = makeListings(dailyCalendars);
  var weeklyListings = makeListings(weeklyCalendars);
  var about = multiPanel ? null : /*#__PURE__*/external_react_default().createElement(Modules, {
    type: "AboutLearningSchedules"
  });
  var sidebarModules = [multiPanel ? {
    type: "AboutLearningSchedules"
  } : {
    type: null
  }, {
    type: "StayConnected"
  }, {
    type: "SupportSefaria"
  }, {
    type: "Promo"
  }];
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerNavMenu",
    key: "0"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "content"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sidebarLayout"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "contentInner"
  }, about, /*#__PURE__*/external_react_default().createElement("h2", {
    className: "styledH1 sans-serif"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Weekly Torah Portion")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerNavCategories"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    content: parashaListings,
    initialWidth: initialWidth
  })), /*#__PURE__*/external_react_default().createElement("h2", {
    className: "styledH1 sans-serif"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Daily Learning")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerNavCategories"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    content: dailyListings,
    initialWidth: initialWidth
  })), /*#__PURE__*/external_react_default().createElement("h2", {
    className: "styledH1 sans-serif"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Weekly Learning")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerNavCategories"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    content: weeklyListings,
    initialWidth: initialWidth
  }))), /*#__PURE__*/external_react_default().createElement(NavSidebar, {
    modules: sidebarModules
  })), /*#__PURE__*/external_react_default().createElement(js_Footer, null)));
};
var CalendarListing = function CalendarListing(_ref2) {
  var calendar = _ref2.calendar;
  var style = {
    "borderColor": sefaria.palette.categoryColor(calendar.category)
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "navBlock withColorLine calendarListing",
    style: style
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/".concat(calendar.url),
    className: "navBlockTitle"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: calendar.displayTitle
  }), calendar.enSubtitle ? /*#__PURE__*/external_react_default().createElement("span", {
    className: "subtitle"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    context: "CalendarListing"
  }, calendar.enSubtitle)) : null), /*#__PURE__*/external_react_default().createElement("div", {
    className: "calendarRefs"
  }, calendar.refs.map(function (ref) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "calendarRef",
      key: ref.url
    }, /*#__PURE__*/external_react_default().createElement("img", {
      src: "/static/icons/book.svg",
      className: "navSidebarIcon",
      alt: "book icon"
    }), /*#__PURE__*/external_react_default().createElement("a", {
      href: "/".concat(ref.url || calendar.url),
      className: ""
    }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
      text: ref.displayValue
    })));
  })), calendar.description ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "navBlockDescription"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, {
    text: calendar.description
  })) : null);
};
var reformatCalendars = function reformatCalendars() {
  // Reformats the calendar data as it is given by the API into the shape we need,
  // combining with descriptions written here.
  var calendars = sefaria.util.clone(sefaria.calendars);
  var mergedCalendars = [];
  calendars.map(function (cal) {
    var calData = calendarDescriptions[cal.title.en.replace(/ \([AS]\)$/, "")];
    if (!cal.description && calData) {
      cal.description = {
        en: calData.en,
        he: calData.he
      };
    }
    if (cal.title.en === "Parashat Hashavua") {
      cal.displayTitle = cal.displayValue;
      cal.displayValue = {
        en: cal.ref,
        he: cal.heRef
      };
    } else {
      cal.displayTitle = sefaria.util.clone(cal.title);
      if (calData && calData.enSubtitle) {
        cal.enSubtitle = calData.enSubtitle;
      }
      if (calData && calData.heSubtitle) {
        cal.heSubtitle = calData.heSubtitle;
      }
    }

    // Merge multiple calendar entries that from from the same schedule
    // (e.g., when a Haftarah has multiple refs)
    var len = mergedCalendars.length;
    if (len && cal.title.en === mergedCalendars[len - 1].title.en) {
      mergedCalendars[len - 1].refs.push({
        url: cal.url,
        displayValue: cal.displayValue
      });
    } else {
      cal.refs = [{
        url: cal.url,
        displayValue: cal.displayValue
      }];
      mergedCalendars.push(cal);
    }
  });
  return mergedCalendars;
};

// TODO these descriptions should be moved to the DB
// For now, to get this descriptions on mobile, we have copied this data to MobileContentServer/JsonExporterForIOS.py
// Engineers need to be careful to keep these two copies in sync if one of them is edited.
var calendarDescriptions = {
  "Parashat Hashavua": {},
  "Haftarah": {
    en: "The portion from Prophets (a section of the Bible) read on any given week, based on its thematic connection to the weekly Torah portion.",
    he: "קטע קבוע לכל פרשה מספרי הנביאים הנקרא בכל שבת ומועד, ויש לו קשר רעיוני לפרשת השבוע."
  },
  "Daf Yomi": {
    en: "A learning program that covers a page of Talmud a day. In this way, the entire Talmud is completed in about seven and a half years.",
    he: "סדר לימוד לתלמוד הבבלי הכולל לימוד של דף אחד בכל יום. הלומדים בדרך זו מסיימים את קריאת התלמוד כולו בתוך כשבע שנים וחצי.",
    enSubtitle: "Talmud"
  },
  "929": {
    en: "A learning program in which participants study five of the Bible’s 929 chapters a week, completing it in about three and a half years.",
    he: "סדר שבועי ללימוד תנ\"ך שבו נלמדים בכל שבוע חמישה מתוך 929 פרקי התנ\"ך. הלומדים בדרך זו מסיימים את קריאת התנ\"ך כולו כעבור שלוש שנים וחצי.",
    enSubtitle: "Tanakh"
  },
  "Daily Mishnah": {
    en: "A program of daily learning in which participants study two Mishnahs (teachings) each day in order to finish the entire Mishnah in six years.",
    he: "סדר לימוד משנה שבמסגרתו נלמדות שתי משניות בכל יום. הלומדים בדרך זו מסיימים את קריאת המשנה כולה כעבור שש שנים."
  },
  "Daily Rambam": {
    en: "A learning program that divides Maimonides’ Mishneh Torah legal code into daily units, to complete the whole work in three years.",
    he: "סדר לימוד הספר ההלכתי של הרמב\"ם, \"משנה תורה\", המחלק את הספר ליחידות יומיות. הלומדים בדרך זו מסיימים את קריאת הספר כולו בתוך שלוש שנים."
  },
  "Daily Rambam (3 Chapters)": {
    en: "A learning program that divides Maimonides’ Mishneh Torah legal code into daily units, to complete the whole work in one year.",
    he: "סדר לימוד הספר ההלכתי של הרמב\"ם, \"משנה תורה\", המחלק את הספר ליחידות יומיות. הלומדים בדרך זו מסיימים את קריאת הספר כולו בתוך שנה אחת."
  },
  "Daf a Week": {
    en: "A learning program that covers a page of Talmud a week. By going at a slower pace, it facilitates greater mastery and retention.",
    he: "סדר שבועי ללימוד התלמוד הבבלי שבו נלמד דף תלמוד אחד בכל שבוע. קצב הלימוד האיטי מאפשר ללומדים הפנמה ושליטה רבה יותר בחומר הנלמד.",
    enSubtitle: "Talmud"
  },
  "Halakhah Yomit": {
    en: "A four year daily learning program in which participants study central legal texts that cover most of the daily and yearly rituals.",
    he: "תוכנית ארבע־שנתית ללימוד מקורות הלכתיים מרכזיים העוסקים ברוב הלכות היום־יום והמועדים."
  },
  "Arukh HaShulchan Yomi": {
    en: "A four-year daily learning program covering ritual halakhot, practical kashrut and interpersonal mitzvot within Rabbi Yechiel Michel Epstein’s legal code, Arukh HaShulchan.",
    he: "תכנית לימוד ארבע-שנתית של הלכות מעשיות מתוך ספר ערוך השלחן, חיבורו ההלכתי של הרב יחיאל מיכל עפשטיין."
  },
  "Tanya Yomi": {
    "en": "A daily learning cycle for completing Tanya annually, starting at the 19th of Kislev, “Rosh Hashanah of Chasidut.”",
    "he": "סדר לימוד המשלים את ספר התניא אחת לשנה, החל מיום י\"ט בכסליו \"ראש השנה לחסידות\"."
  },
  "Tanakh Yomi": {
    en: "A daily learning cycle for completing Tanakh annually. On Shabbat, each Torah portion is recited. On weekdays, Prophets and Writings are recited according to the ancient Masoretic division of sedarim.",
    he: "סדר לימוד המשלים את קריאת התנ\"ך כולו אחת לשנה. בשבתות קוראים את התורה לפי סדר פרשיות השבוע. בימות החול קוראים את הנ\"ך על פי חלוקת הסדרים של המסורה.",
    enSubtitle: "Tanakh"
  },
  "Zohar for Elul": {
    en: "A 40 day learning schedule in which participants learn the Kabbalistic work \"Tikkunei Zohar\" over the course of the days between the First of the month of Elul and Yom Kippur.",
    he: "סדר יומי ללימוד הספר \"תיקוני הזהר\". הסדר נמשך 40 יום, בתקופה שבין ראש חודש אלול ויום הכיפורים."
  },
  "Chok LeYisrael": {
    en: "A book designed for daily study. Each day’s learning consists of biblical verses together with commentary, a chapter of Mishnah, and short passages of Talmud, Zohar, and of works of Halakhah and Musar.",
    he: 'לימוד יומי הכולל פסוקי תנ״ך ופירושם, פרק משנה, קטע מהתלמוד, קטע מהזוהר, קטע מספר הלכה וקטע מספר מוסר.'
  }
};
/* harmony default export */ const js_CalendarsPage = (CalendarsPage);
// EXTERNAL MODULE: ../static/js/lib/d3.v5.min.js
var d3_v5_min = __webpack_require__("../static/js/lib/d3.v5.min.js");
;// CONCATENATED MODULE: ../static/js/UserStats.jsx
function UserStats_slicedToArray(arr, i) { return UserStats_arrayWithHoles(arr) || UserStats_iterableToArrayLimit(arr, i) || UserStats_unsupportedIterableToArray(arr, i) || UserStats_nonIterableRest(); }
function UserStats_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function UserStats_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return UserStats_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return UserStats_arrayLikeToArray(o, minLen); }
function UserStats_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function UserStats_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function UserStats_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }







var UserStats = function UserStats() {
  var _useState = (0,external_react_.useState)(null),
    _useState2 = UserStats_slicedToArray(_useState, 2),
    uid = _useState2[0],
    setUid = _useState2[1];
  var _useState3 = (0,external_react_.useState)({}),
    _useState4 = UserStats_slicedToArray(_useState3, 2),
    user_data = _useState4[0],
    setUserData = _useState4[1];
  var _useState5 = (0,external_react_.useState)({}),
    _useState6 = UserStats_slicedToArray(_useState5, 2),
    site_data = _useState6[0],
    setSiteData = _useState6[1];
  var _useState7 = (0,external_react_.useState)("Previous Year"),
    _useState8 = UserStats_slicedToArray(_useState7, 2),
    active_mode = _useState8[0],
    setMode = _useState8[1];
  var modes = ["Previous Year", "All Time"];
  var modekeys = {
    "Previous Year": "currently",
    "All Time": "alltime"
  };
  var debouncedUID = useDebounce(uid, 500);
  (0,external_react_.useEffect)(function () {
    sefariaJquery.getJSON("/api/site_stats").then(function (d) {
      return setSiteData(d);
    });
  }, []);
  (0,external_react_.useEffect)(function () {
    var uid = debouncedUID || sefaria._uid;
    setUserData({});
    sefariaJquery.getJSON("/api/user_stats/" + uid).then(function (d) {
      return setUserData(d);
    });
  }, [debouncedUID]);
  var all_ready = !!(user_data.uid && site_data.alltime);
  var mode_user_data;
  var user_active;
  if (all_ready) {
    mode_user_data = user_data[modekeys[active_mode]];
    user_active = mode_user_data.textsRead > 2 || mode_user_data.sheetsRead > 2 || mode_user_data.sheetsThisPeriod > 1;
  }
  // let user_active = true;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "homeFeedWrapper userStats"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "content",
    style: {
      padding: "0 40px 80px"
    }
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "contentInner"
  }, /*#__PURE__*/external_react_default().createElement("h1", {
    style: {
      textAlign: "center"
    }
  }, all_ready ? user_data.name : /*#__PURE__*/external_react_default().createElement(LoadingRing, null)), sefaria.is_moderator && /*#__PURE__*/external_react_default().createElement(UserChooser, {
    setter: setUid
  }), /*#__PURE__*/external_react_default().createElement(UserStatModeChooser, {
    modes: modes,
    activeMode: active_mode,
    setMode: setMode
  }), all_ready && user_active && /*#__PURE__*/external_react_default().createElement(UserDataBlock, {
    user_data: mode_user_data,
    site_data: site_data[modekeys[active_mode]]
  }), all_ready && !user_active && /*#__PURE__*/external_react_default().createElement(SiteDataBlock, {
    site_data: site_data[modekeys[active_mode]]
  }))));
};
var UserStatModeChooser = function UserStatModeChooser(_ref) {
  var modes = _ref.modes,
    activeMode = _ref.activeMode,
    setMode = _ref.setMode;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "userStatModeChooser"
  }, modes.map(function (m) {
    return /*#__PURE__*/external_react_default().createElement(UserStatModeButton, {
      key: m,
      thisMode: m,
      activeMode: activeMode,
      setMode: setMode
    });
  }));
};
var UserStatModeButton = function UserStatModeButton(_ref2) {
  var thisMode = _ref2.thisMode,
    activeMode = _ref2.activeMode,
    setMode = _ref2.setMode;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "userStatModeButton" + (thisMode === activeMode ? " active" : ""),
    onClick: function onClick() {
      return setMode(thisMode);
    }
  }, /*#__PURE__*/external_react_default().createElement("span", null, sefaria._(thisMode)));
};
var UserChooser = function UserChooser(_ref3) {
  var setter = _ref3.setter;
  return /*#__PURE__*/external_react_default().createElement("div", {
    style: {
      textAlign: "center"
    }
  }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, " User ID: "), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, " \u05DE\u05E1\u05E4\u05E8 \u05DE\u05E9\u05EA\u05DE\u05E9: "), /*#__PURE__*/external_react_default().createElement("input", {
    type: "text",
    onChange: function onChange(e) {
      return setter(parseInt(e.target.value));
    }
  })));
};
var SiteDataBlock = function SiteDataBlock(_ref4) {
  var site_data = _ref4.site_data;
  return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "chartRow centered"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "systemText statHeader"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05DE\u05D6\u05DE\u05DF \u05DC\u05D0 \u05D4\u05EA\u05E8\u05D0\u05D9\u05E0\u05D5!", /*#__PURE__*/external_react_default().createElement("br", null), "\u05D1\u05D5\u05D0\u05D5 \u05D5\u05E0\u05E8\u05D0\u05D4 \u05DE\u05D4 \u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05D0\u05D7\u05E8\u05D9\u05DD \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0 \u05DC\u05D5\u05DE\u05D3\u05D9\u05DD"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Looks like we haven\u2019t seen you in a while!", /*#__PURE__*/external_react_default().createElement("br", null), "Discover what other people are doing on Sefaria..."))), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "What People are Reading"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05DE\u05D4 \u05D0\u05E0\u05E9\u05D9\u05DD \u05E7\u05D5\u05E8\u05D0\u05D9\u05DD")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "chartRow centered"
  }, /*#__PURE__*/external_react_default().createElement(CategoriesDonut, {
    title: "Average Sefaria User",
    heTitle: "\u05DE\u05E9\u05EA\u05DE\u05E9 \u05DE\u05DE\u05D5\u05E6\u05E2 \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0",
    cats: site_data.categoriesRead
  }))), /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Top Categories"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05E7\u05D8\u05D2\u05D5\u05E8\u05D9\u05D5\u05EA \u05E4\u05D5\u05E4\u05D5\u05DC\u05E8\u05D9\u05D5\u05EA")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "chartRow"
  }, /*#__PURE__*/external_react_default().createElement(CategoryBars, {
    user_cats: site_data.categoriesRead,
    site_cats: site_data.categoriesRead
  }))));
};
var UserDataBlock = function UserDataBlock(_ref5) {
  var user_data = _ref5.user_data,
    site_data = _ref5.site_data;
  return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement(OverallActivityBlock, {
    user_data: user_data
  }), /*#__PURE__*/external_react_default().createElement(UserDonutsBlock, {
    user_data: user_data,
    site_data: site_data
  }), /*#__PURE__*/external_react_default().createElement(UserCategoryBarchartBlock, {
    user_data: user_data,
    site_data: site_data
  }), /*#__PURE__*/external_react_default().createElement(YourFavoriteTextsBlock, {
    user_data: user_data
  }), /*#__PURE__*/external_react_default().createElement(YourFavoriteSheetsBlock, {
    user_data: user_data
  }), /*#__PURE__*/external_react_default().createElement(MostPopularSheetsBlock, {
    user_data: user_data
  }));
};
var OverallActivityBlock = function OverallActivityBlock(_ref6) {
  var user_data = _ref6.user_data;
  return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Your Overall Activity"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05D4\u05E4\u05E2\u05D9\u05DC\u05D5\u05EA \u05E9\u05DC\u05DA \u05D1\u05DE\u05D1\u05D8")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "statcardRow"
  }, /*#__PURE__*/external_react_default().createElement(StatCard, {
    icon_file: "book-icon-black.svg",
    number: user_data.textsRead,
    name: "Texts Read"
  }), /*#__PURE__*/external_react_default().createElement(StatCard, {
    icon_file: "file-icon-black.svg",
    number: user_data.sheetsRead,
    name: "Sheets Read"
  }), /*#__PURE__*/external_react_default().createElement(StatCard, {
    icon_file: "plus-icon-black.svg",
    number: user_data.sheetsThisPeriod,
    name: "Sheets Created"
  })));
};
var StatCard = function StatCard(_ref7) {
  var icon_file = _ref7.icon_file,
    name = _ref7.name,
    number = _ref7.number;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "statcard"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: "static/img/" + icon_file
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "statcardValue"
  }, number), /*#__PURE__*/external_react_default().createElement("div", {
    className: "statcardLabel"
  }, sefaria._(name)));
};
var UserDonutsBlock = function UserDonutsBlock(_ref8) {
  var user_data = _ref8.user_data,
    site_data = _ref8.site_data;
  return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Your Reading by Category"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05DC\u05D9\u05DE\u05D5\u05D3 \u05DC\u05E4\u05D9 \u05E1\u05D5\u05D2\u05D4")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "chartRow"
  }, /*#__PURE__*/external_react_default().createElement(CategoriesDonut, {
    title: "Your Reading",
    heTitle: "\u05D4\u05DC\u05D9\u05DE\u05D5\u05D3 \u05E9\u05DC\u05DA",
    cats: user_data.categoriesRead
  }), /*#__PURE__*/external_react_default().createElement(CategoriesDonut, {
    title: "Average Sefaria User",
    heTitle: "\u05DE\u05E9\u05EA\u05DE\u05E9 \u05DE\u05DE\u05D5\u05E6\u05E2 \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0",
    cats: site_data.categoriesRead
  })));
};
var UserCategoryBarchartBlock = function UserCategoryBarchartBlock(_ref9) {
  var user_data = _ref9.user_data,
    site_data = _ref9.site_data;
  return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Your Top Categories"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05DE\u05E6\u05E2\u05D3 \u05E1\u05D5\u05D2\u05D5\u05EA \u05D4\u05DC\u05D9\u05DE\u05D5\u05D3")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "chartRow"
  }, /*#__PURE__*/external_react_default().createElement(CategoryBars, {
    user_cats: user_data.categoriesRead,
    site_cats: site_data.categoriesRead
  })));
};
var YourFavoriteTextsBlock = function YourFavoriteTextsBlock(_ref10) {
  var user_data = _ref10.user_data;
  return user_data.mostViewedRefs.length ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "yourFavoriteTextsBlock"
  }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Your Favorite Texts"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05DE\u05D5\u05E2\u05D3\u05E4\u05D9\u05DD")), /*#__PURE__*/external_react_default().createElement(NBox, {
    n: 3,
    content: user_data.mostViewedRefs.map(function (r, i) {
      return /*#__PURE__*/external_react_default().createElement(TextBlockLink, {
        key: i,
        sref: r.en,
        title: r.en,
        heTitle: r.he,
        book: r.book,
        intlang: true
      });
    })
  })) : null;
};
var YourFavoriteSheetsBlock = function YourFavoriteSheetsBlock(_ref11) {
  var user_data = _ref11.user_data;
  return user_data.mostViewedSheets.length ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "yourFavoriteSheetsBlock"
  }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Your Favorite Sheets"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DE\u05D5\u05E2\u05D3\u05E4\u05D9\u05DD")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "story"
  }, /*#__PURE__*/external_react_default().createElement(StorySheetList, {
    sheets: user_data.mostViewedSheets,
    compact: true,
    smallfonts: true
  }))) : null;
};
var MostPopularSheetsBlock = function MostPopularSheetsBlock(_ref12) {
  var user_data = _ref12.user_data;
  return user_data.popularSheets.length ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "yourPopularSheetsBlock"
  }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Your Most Popular Sheets"), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E4\u05D5\u05E4\u05D5\u05DC\u05E8\u05D9\u05D9\u05DD \u05E9\u05DC\u05DA")), user_data.popularSheets.map(function (sheet, i) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      key: i
    }, /*#__PURE__*/external_react_default().createElement(SimpleLinkedBlock, {
      classes: "chapterText lowercase sheetLink",
      en: sheet.title,
      he: sheet.title,
      url: "/sheets/" + sheet.id
    }), /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
      classes: "sheetViews smallText",
      en: sheet.views + " Views",
      he: sheet.views + " צפיות"
    }));
  })) : null;
};
var mapToPercentage = function mapToPercentage(data) {
  var newData = {};
  var total = Object.entries(data).map(function (k) {
    return k[1];
  }).reduce(function (a, b) {
    return a + b;
  }, 0);
  Object.keys(data).forEach(function (k) {
    return newData[k] = data[k] / total;
  });
  return newData;
};
var makeOtherCategory = function makeOtherCategory(data) {
  var total = data.map(function (e) {
    return e.value;
  }).reduce(function (a, b) {
    return a + b;
  }, 0);
  var bar = total * .04;
  var remainder = data.filter(function (e) {
    return e.value < bar;
  }).map(function (e) {
    return e.value;
  }).reduce(function (a, b) {
    return a + b;
  }, 0);
  var result = data.filter(function (e) {
    return e.value >= bar;
  });
  result.push({
    name: "Etc",
    value: remainder
  });
  return result;
};
var CategoryBars = function CategoryBars(_ref13) {
  var user_cats = _ref13.user_cats,
    site_cats = _ref13.site_cats;
  var svg_ref = (0,external_react_.useRef)();
  var margin = {
    top: 20,
    right: 0,
    bottom: 0,
    left: 0
  };
  var perBarHeight = 75;
  var max_cats = 5;
  var height = margin.top + margin.bottom + perBarHeight * Math.min(Object.keys(user_cats).length, max_cats);
  var width = 660;
  var keys = ["user", "site"];
  (0,external_react_.useEffect)(function () {
    var svg = d3_v5_min.select(svg_ref.current);
    if (!svg) {
      return;
    }
    var user_percents = mapToPercentage(user_cats);
    var site_percents = mapToPercentage(site_cats);
    var orderedCats = Object.entries(user_cats).sort(function (a, b) {
      return b[1] - a[1];
    }).map(function (d) {
      return d[0];
    });
    var data = orderedCats.slice(0, max_cats).map(function (cat) {
      return {
        cat: cat,
        site: site_percents[cat],
        user: user_percents[cat]
      };
    });
    var y = d3_v5_min.scaleBand().domain(data.map(function (d) {
      return d.cat;
    })).rangeRound([margin.top, height - margin.bottom]).paddingInner(0.1);
    var inter_bar_padding = 0.05;
    var below_text_padding = 10;
    var userbar = 5;
    var sitebar = 34;
    var x = d3_v5_min.scaleLinear().domain([0, d3_v5_min.max(data.map(function (d) {
      return [d.site, d.user];
    }).flat()) + .10]).nice();
    if (sefaria.interfaceLang === "english") {
      x.rangeRound([0, width - margin.right]);
    } else {
      x.rangeRound([0, width - margin.right]);
    }
    var groups = svg.append("g").selectAll("g").data(data).join("g").attr("transform", function (d) {
      return "translate(".concat(margin.left, ", ").concat(y(d.cat), ")");
    });
    groups.append("text").attr("font-family", sefaria.interfaceLang === "english" ? '"Taamey Frank", "adobe-garamond-pro", "Crimson Text", Georgia, serif' : '"Heebo", sans-serif').attr("text-anchor", "start").attr("x", function (d) {
      return sefaria.interfaceLang === "hebrew" ? width - margin.right : null;
    }).attr("letter-spacing", sefaria.interfaceLang === "english" ? 1.5 : null).attr("font-size", 16).text(function (d) {
      return sefaria._(d.cat).toUpperCase();
    });
    groups.selectAll("rect").data(function (d) {
      return keys.map(function (key) {
        return {
          key: key,
          cat: d.cat,
          value: d[key]
        };
      });
    }).join("rect").attr("class", function (d) {
      return d.key;
    }).attr("x", function (d) {
      return sefaria.interfaceLang === "english" ? 0 : width - margin.right - x(d.value);
    }).attr("y", function (d) {
      return d.key === "user" ? below_text_padding : below_text_padding + userbar + inter_bar_padding;
    }).attr("width", function (d) {
      return x(d.value);
    }).attr("height", function (d) {
      return d.key === "user" ? userbar : sitebar;
    }).attr("fill", function (d) {
      return d.key === "user" ? sefaria.palette.categoryColor(d.cat) : "#ededec";
    });
    d3_v5_min.select("svg g g:first-child").append("text").attr("y", below_text_padding + userbar + inter_bar_padding + sitebar - 11).attr("x", function (d) {
      return x(d.site) > 250 ? x(d.site) - 20 : x(d.site) + 20;
    }).attr("font-size", 16).attr("fill", "#999").attr("text-anchor", function (d) {
      return x(d.site) > 250 ? "end" : "start";
    }).text(sefaria._("Average Sefaria User"));
    return function () {
      svg.selectAll("*").remove();
    };
  }, [user_cats, site_cats]);
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "chartWrapper"
  }, /*#__PURE__*/external_react_default().createElement("svg", {
    ref: svg_ref,
    width: width,
    height: height,
    textAnchor: "middle"
  }));
};
var CategoriesDonut = function CategoriesDonut(_ref14) {
  var cats = _ref14.cats,
    title = _ref14.title,
    heTitle = _ref14.heTitle;
  var svg_ref = (0,external_react_.useRef)();
  var width = 280;
  var height = 280;
  var raw_data = Object.entries(cats).map(function (e) {
    return {
      name: e[0],
      value: e[1]
    };
  });
  var data = raw_data.length > 2 ? makeOtherCategory(raw_data) : raw_data;
  var total = data.map(function (e) {
    return e.value;
  }).reduce(function (a, b) {
    return a + b;
  }, 0);
  var compare = function compare(a, b) {
    return a.name === "Etc" ? 1 : b.name === "Etc" ? -1 : b.value - a.value;
  };
  var pie = d3_v5_min.pie().sort(compare).value(function (d) {
    return d.value;
  });
  var arcs = pie(data);
  var radius = Math.min(width, height) / 2 * 0.75;
  var arcLabel = d3_v5_min.arc().innerRadius(radius).outerRadius(radius);
  var arc = d3_v5_min.arc().innerRadius(Math.min(width, height) / 2 - 10).outerRadius(Math.min(width, height) / 2 - 1);
  (0,external_react_.useEffect)(function () {
    var svg = d3_v5_min.select(svg_ref.current);
    if (!svg) {
      return;
    }
    var g = svg.append("g").attr("transform", "translate(".concat(width / 2, ",").concat(height / 2, ")"));
    g.selectAll("path").data(arcs).enter().append("path").attr("fill", function (d) {
      return sefaria.palette.categoryColor(d.data.name);
    }).attr("stroke", "white").attr("d", arc).append("title").text(function (d) {
      return "".concat(d.data.name, ": ").concat(d.data.value.toLocaleString(undefined, {
        style: 'percent',
        minimumFractionDigits: 2
      }));
    });
    var text = g.selectAll("text").data(arcs).enter().append("text").attr("transform", function (d) {
      return "translate(".concat(arcLabel.centroid(d), ")");
    }).attr("dy", "0.35em");
    text.append("tspan").attr("x", 0).attr("y", "-0.7em").text(function (d) {
      return sefaria._(d.data.name);
    });
    text.filter(function (d) {
      return d.endAngle - d.startAngle > 0.25;
    }).append("tspan").attr("x", 0).attr("y", "0.7em").attr("fill", "#999").text(function (d) {
      return (d.data.value / total).toLocaleString(undefined, {
        style: 'percent'
      });
    });
    return function () {
      svg.selectAll("*").remove();
    };
  }, [cats]);
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "chartWrapper"
  }, /*#__PURE__*/external_react_default().createElement("svg", {
    ref: svg_ref,
    width: width,
    height: height,
    textAnchor: "middle"
  }), /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "chartLabel smallText",
    en: title,
    he: heTitle
  }));
};
/* harmony default export */ const js_UserStats = (UserStats);
;// CONCATENATED MODULE: external "file-saver"
const external_file_saver_namespaceObject = require("file-saver");
;// CONCATENATED MODULE: external "qs"
const external_qs_namespaceObject = require("qs");
var external_qs_default = /*#__PURE__*/__webpack_require__.n(external_qs_namespaceObject);
;// CONCATENATED MODULE: ../static/js/ModeratorToolsPanel.jsx
function ModeratorToolsPanel_typeof(obj) { "@babel/helpers - typeof"; return ModeratorToolsPanel_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, ModeratorToolsPanel_typeof(obj); }
function ModeratorToolsPanel_regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ ModeratorToolsPanel_regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == ModeratorToolsPanel_typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function ModeratorToolsPanel_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function ModeratorToolsPanel_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ModeratorToolsPanel_ownKeys(Object(source), !0).forEach(function (key) { ModeratorToolsPanel_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ModeratorToolsPanel_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function ModeratorToolsPanel_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function ModeratorToolsPanel_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { ModeratorToolsPanel_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { ModeratorToolsPanel_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function ModeratorToolsPanel_slicedToArray(arr, i) { return ModeratorToolsPanel_arrayWithHoles(arr) || ModeratorToolsPanel_iterableToArrayLimit(arr, i) || ModeratorToolsPanel_unsupportedIterableToArray(arr, i) || ModeratorToolsPanel_nonIterableRest(); }
function ModeratorToolsPanel_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function ModeratorToolsPanel_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return ModeratorToolsPanel_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return ModeratorToolsPanel_arrayLikeToArray(o, minLen); }
function ModeratorToolsPanel_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function ModeratorToolsPanel_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function ModeratorToolsPanel_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function ModeratorToolsPanel_defineProperty(obj, key, value) { key = ModeratorToolsPanel_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function ModeratorToolsPanel_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function ModeratorToolsPanel_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, ModeratorToolsPanel_toPropertyKey(descriptor.key), descriptor); } }
function ModeratorToolsPanel_createClass(Constructor, protoProps, staticProps) { if (protoProps) ModeratorToolsPanel_defineProperties(Constructor.prototype, protoProps); if (staticProps) ModeratorToolsPanel_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function ModeratorToolsPanel_toPropertyKey(arg) { var key = ModeratorToolsPanel_toPrimitive(arg, "string"); return ModeratorToolsPanel_typeof(key) === "symbol" ? key : String(key); }
function ModeratorToolsPanel_toPrimitive(input, hint) { if (ModeratorToolsPanel_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (ModeratorToolsPanel_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function ModeratorToolsPanel_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) ModeratorToolsPanel_setPrototypeOf(subClass, superClass); }
function ModeratorToolsPanel_setPrototypeOf(o, p) { ModeratorToolsPanel_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return ModeratorToolsPanel_setPrototypeOf(o, p); }
function ModeratorToolsPanel_createSuper(Derived) { var hasNativeReflectConstruct = ModeratorToolsPanel_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = ModeratorToolsPanel_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = ModeratorToolsPanel_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return ModeratorToolsPanel_possibleConstructorReturn(this, result); }; }
function ModeratorToolsPanel_possibleConstructorReturn(self, call) { if (call && (ModeratorToolsPanel_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return ModeratorToolsPanel_assertThisInitialized(self); }
function ModeratorToolsPanel_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function ModeratorToolsPanel_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function ModeratorToolsPanel_getPrototypeOf(o) { ModeratorToolsPanel_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return ModeratorToolsPanel_getPrototypeOf(o); }









var ModeratorToolsPanel = /*#__PURE__*/function (_Component) {
  ModeratorToolsPanel_inherits(ModeratorToolsPanel, _Component);
  var _super = ModeratorToolsPanel_createSuper(ModeratorToolsPanel);
  function ModeratorToolsPanel(props) {
    var _this;
    ModeratorToolsPanel_classCallCheck(this, ModeratorToolsPanel);
    _this = _super.call(this, props);
    _this.handleWfSubmit = _this.handleWfSubmit.bind(ModeratorToolsPanel_assertThisInitialized(_this));
    _this.wfFileInput = /*#__PURE__*/external_react_default().createRef();
    _this.state = {
      // Bulk Download
      bulk_format: null,
      bulk_title_pattern: null,
      bulk_version_title_pattern: null,
      bulk_language: null,
      // CSV Upload
      files: [],
      uploading: false,
      uploadError: null,
      uploadMessage: null
    };
    return _this;
  }
  ModeratorToolsPanel_createClass(ModeratorToolsPanel, [{
    key: "handleFiles",
    value: function handleFiles(event) {
      this.setState({
        files: event.target.files
      });
    }
  }, {
    key: "uploadFiles",
    value: function uploadFiles(event) {
      event.preventDefault();
      this.setState({
        uploading: true,
        uploadMessage: "Uploading..."
      });
      var formData = new FormData();
      for (var i = 0; i < this.state.files.length; i++) {
        var file = this.state.files[i];
        formData.append('texts[]', file, file.name);
      }
      sefariaJquery.ajax({
        url: "api/text-upload",
        type: 'POST',
        data: formData,
        success: function (data) {
          if (data.status == "ok") {
            this.setState({
              uploading: false,
              uploadMessage: data.message,
              uploadError: null,
              files: []
            });
            sefariaJquery("#file-form").get(0).reset(); //Remove selected files from the file selector
          } else {
            this.setState({
              "uploadError": "Error - " + data.error,
              uploading: false,
              uploadMessage: data.message
            });
          }
        }.bind(this),
        error: function (xhr, status, err) {
          this.setState({
            "uploadError": "Error - " + err.toString(),
            uploading: false,
            uploadMessage: null
          });
        }.bind(this),
        cache: false,
        contentType: false,
        processData: false
      });
    }
  }, {
    key: "onDlTitleChange",
    value: function onDlTitleChange(event) {
      this.setState({
        bulk_title_pattern: event.target.value
      });
    }
  }, {
    key: "onDlVersionChange",
    value: function onDlVersionChange(event) {
      this.setState({
        bulk_version_title_pattern: event.target.value
      });
    }
  }, {
    key: "onDlLanguageSelect",
    value: function onDlLanguageSelect(event) {
      this.setState({
        bulk_language: event.target.value
      });
    }
  }, {
    key: "onDlFormatSelect",
    value: function onDlFormatSelect(event) {
      this.setState({
        bulk_format: event.target.value
      });
    }
  }, {
    key: "bulkVersionDlLink",
    value: function bulkVersionDlLink() {
      var _this2 = this;
      var args = ["format", "title_pattern", "version_title_pattern", "language"].map(function (arg) {
        return _this2.state["bulk_" + arg] ? "".concat(arg, "=").concat(encodeURIComponent(_this2.state["bulk_" + arg])) : "";
      }).filter(function (a) {
        return a;
      }).join("&");
      return "download/bulk/versions/?" + args;
    }
  }, {
    key: "handleInputChange",
    value: function handleInputChange(event) {
      var target = event.target;
      var value = target.type === 'checkbox' ? target.checked : target.value;
      var name = target.name;
      this.setState(ModeratorToolsPanel_defineProperty({}, name, value));
    }
  }, {
    key: "handleWfSubmit",
    value: function handleWfSubmit(event) {
      event.preventDefault();
      alert("Selected file - ".concat(this.wfFileInput.current.files[0].name));
    }
  }, {
    key: "render",
    value: function render() {
      // Bulk Download
      var dlReady = this.state.bulk_format && (this.state.bulk_title_pattern || this.state.bulk_version_title_pattern);
      var downloadButton = /*#__PURE__*/external_react_default().createElement("div", {
        className: "modtoolsButton"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "modtoolsButtonInner"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Download"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D4\u05D5\u05E8\u05D3\u05D4")));
      var downloadSection = /*#__PURE__*/external_react_default().createElement("div", {
        className: "modToolsSection dlSection"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "dlSectionTitle"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Bulk Download Text"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D4\u05D5\u05E8\u05D3\u05EA \u05D4\u05D8\u05E7\u05E1\u05D8")), /*#__PURE__*/external_react_default().createElement("input", {
        className: "dlVersionSelect",
        type: "text",
        placeholder: "Index Title Pattern",
        onChange: this.onDlTitleChange
      }), /*#__PURE__*/external_react_default().createElement("input", {
        className: "dlVersionSelect",
        type: "text",
        placeholder: "Version Title Pattern",
        onChange: this.onDlVersionChange
      }), /*#__PURE__*/external_react_default().createElement("select", {
        className: "dlVersionSelect dlVersionLanguageSelect",
        value: this.state.bulk_language || "",
        onChange: this.onDlLanguageSelect
      }, /*#__PURE__*/external_react_default().createElement("option", {
        disabled: true
      }, "Language"), /*#__PURE__*/external_react_default().createElement("option", {
        key: "all",
        value: ""
      }, "Hebrew & English"), /*#__PURE__*/external_react_default().createElement("option", {
        key: "he",
        value: "he"
      }, "Hebrew"), /*#__PURE__*/external_react_default().createElement("option", {
        key: "en",
        value: "en"
      }, "English")), /*#__PURE__*/external_react_default().createElement("select", {
        className: "dlVersionSelect dlVersionFormatSelect",
        value: this.state.bulk_format || "",
        onChange: this.onDlFormatSelect
      }, /*#__PURE__*/external_react_default().createElement("option", {
        disabled: true
      }, "File Format"), /*#__PURE__*/external_react_default().createElement("option", {
        key: "txt",
        value: "txt"
      }, "Text (with tags)"), /*#__PURE__*/external_react_default().createElement("option", {
        key: "plain.txt",
        value: "plain.txt"
      }, "Text (without tags)"), /*#__PURE__*/external_react_default().createElement("option", {
        key: "csv",
        value: "csv"
      }, "CSV"), /*#__PURE__*/external_react_default().createElement("option", {
        key: "json",
        value: "json"
      }, "JSON")), dlReady ? /*#__PURE__*/external_react_default().createElement("a", {
        href: this.bulkVersionDlLink(),
        download: true
      }, downloadButton) : downloadButton);

      // Uploading
      var ulReady = !this.state.uploading && this.state.files.length > 0;
      var uploadButton = /*#__PURE__*/external_react_default().createElement("a", null, /*#__PURE__*/external_react_default().createElement("div", {
        className: "modtoolsButton",
        onClick: this.uploadFiles
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "modtoolsButtonInner"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Upload"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D4\u05E2\u05DC\u05D0\u05D4"))));
      var uploadForm = /*#__PURE__*/external_react_default().createElement("div", {
        className: "modToolsSection"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "dlSectionTitle"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Bulk Upload CSV"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D4\u05D5\u05E8\u05D3\u05EA \u05D4\u05D8\u05E7\u05E1\u05D8")), /*#__PURE__*/external_react_default().createElement("form", {
        id: "file-form"
      }, /*#__PURE__*/external_react_default().createElement("input", {
        className: "dlVersionSelect",
        type: "file",
        id: "file-select",
        multiple: true,
        onChange: this.handleFiles
      }), ulReady ? uploadButton : ""), this.state.uploadMessage ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "message"
      }, this.state.uploadMessage) : "", this.state.uploadError ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "error"
      }, this.state.uploadError) : "");
      var wflowyUpl = /*#__PURE__*/external_react_default().createElement("div", {
        className: "modToolsSection"
      }, /*#__PURE__*/external_react_default().createElement(WorkflowyModeratorTool, null));
      var uploadLinksFromCSV = /*#__PURE__*/external_react_default().createElement("div", {
        className: "modToolsSection"
      }, /*#__PURE__*/external_react_default().createElement(UploadLinksFromCSV, null));
      var getLinks = /*#__PURE__*/external_react_default().createElement("div", {
        className: "modToolsSection"
      }, /*#__PURE__*/external_react_default().createElement(GetLinks, null));
      return sefaria.is_moderator ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "modTools"
      }, " ", downloadSection, uploadForm, wflowyUpl, uploadLinksFromCSV, getLinks, " ") : /*#__PURE__*/external_react_default().createElement("div", {
        className: "modTools"
      }, " Tools are only available to logged in moderators.");
    }
  }]);
  return ModeratorToolsPanel;
}((external_react_class_default()));
ModeratorToolsPanel.propTypes = {
  interfaceLang: (external_prop_types_default()).string
};
var WorkflowyModeratorTool = /*#__PURE__*/function (_Component2) {
  ModeratorToolsPanel_inherits(WorkflowyModeratorTool, _Component2);
  var _super2 = ModeratorToolsPanel_createSuper(WorkflowyModeratorTool);
  function WorkflowyModeratorTool(props) {
    var _this3;
    ModeratorToolsPanel_classCallCheck(this, WorkflowyModeratorTool);
    _this3 = _super2.call(this, props);
    _this3.handleWfSubmit = _this3.handleWfSubmit.bind(ModeratorToolsPanel_assertThisInitialized(_this3));
    _this3.wfFileInput = /*#__PURE__*/external_react_default().createRef();
    _this3.state = {
      c_index: true
    };
    return _this3;
  }
  ModeratorToolsPanel_createClass(WorkflowyModeratorTool, [{
    key: "handleInputChange",
    value: function handleInputChange(event) {
      var target = event.target;
      var value = target.type === 'checkbox' ? target.checked : target.value;
      var name = target.name;
      this.setState(ModeratorToolsPanel_defineProperty({}, name, value));
    }
  }, {
    key: "handleWfSubmit",
    value: function handleWfSubmit(event) {
      var _this4 = this;
      event.preventDefault();
      /*console.log(
        `Selected file - ${this.wfFileInput.current.files[0].name}`
      );*/
      this.setState({
        uploading: true,
        uploadMessage: "Uploading..."
      });
      var data = new FormData(event.target);
      console.log(data);
      var request = new Request('/modtools/upload_text', {
        headers: {
          'X-CSRFToken': external_js_cookie_default().get('csrftoken')
        }
      });
      fetch(request, {
        method: 'POST',
        mode: 'same-origin',
        credentials: 'same-origin',
        body: data
      }).then(function (response) {
        _this4.setState({
          uploading: false,
          uploadMessage: ""
        });
        if (!response.ok) {
          response.text().then(function (resp_text) {
            console.log("error in html form", resp_text);
            _this4.setState({
              uploading: false,
              error: true,
              errorIsHTML: true,
              uploadResult: resp_text
            });
          });
        } else {
          response.json().then(function (resp_json) {
            console.log("okay response", resp_json);
            _this4.setState({
              uploading: false,
              error: false,
              uploadMessage: resp_json["data"]["message"],
              uploadResult: JSON.stringify(resp_json["data"]["index"], undefined, 4)
            });
          });
        }
      })["catch"](function (error) {
        console.log("network error", error);
        _this4.setState({
          uploading: false,
          error: true,
          errorIsHTML: false,
          uploadMessage: error.message
        });
      });
    }
  }, {
    key: "parseErrorHTML",
    value: function parseErrorHTML(htmltext) {
      console.log("pparsing html", htmltext);
      // Initialize the DOM parser
      var parser = new DOMParser();
      // Parse the text
      var doc = parser.parseFromString(htmltext, "text/html");
      //return {__html: doc};
      return doc;
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "workflowy-tool"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "dlSectionTitle"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Workflowy Outline Upload"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D4\u05E2\u05DC\u05D0\u05EA \u05E7\u05D5\u05D1\u05E5 - workflowy")), /*#__PURE__*/external_react_default().createElement("form", {
        id: "wf-file-form",
        className: "workflowy-tool-form",
        onSubmit: this.handleWfSubmit
      }, /*#__PURE__*/external_react_default().createElement("label", null, "Upload Workflowy file:", /*#__PURE__*/external_react_default().createElement("input", {
        type: "file",
        name: "wf_file",
        ref: this.wfFileInput
      })), /*#__PURE__*/external_react_default().createElement("label", null, "Create Index Record:", /*#__PURE__*/external_react_default().createElement("input", {
        name: "c_index",
        type: "checkbox",
        checked: this.state.c_index,
        onChange: this.handleInputChange
      })), /*#__PURE__*/external_react_default().createElement("label", null, "Create Version From Notes on Outline:", /*#__PURE__*/external_react_default().createElement("input", {
        name: "c_version",
        type: "checkbox",
        checked: this.state.c_version || false,
        onChange: this.handleInputChange
      })), /*#__PURE__*/external_react_default().createElement("label", null, "Custom Delimiters (In the following Order- 1. Title Language 2. Alt Titles 3. Categories):", /*#__PURE__*/external_react_default().createElement("input", {
        className: "dlVersionSelect",
        name: "delims",
        type: "text",
        value: this.state.delims,
        onChange: this.handleInputChange
      })), /*#__PURE__*/external_react_default().createElement("label", null, "Optional Term Scheme Name:", /*#__PURE__*/external_react_default().createElement("input", {
        className: "dlVersionSelect",
        name: "term_scheme",
        type: "text",
        value: this.state.term_scheme,
        onChange: this.handleInputChange
      })), /*#__PURE__*/external_react_default().createElement("button", {
        className: "modtoolsButton",
        name: "wf-submit",
        type: "submit"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Upload"), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "Upload"))), /*#__PURE__*/external_react_default().createElement("div", {
        id: "wf-upl-msg",
        className: "wf-upl-msg"
      }, this.state.uploadMessage || ""), this.state.error && this.state.errorIsHTML ? /*#__PURE__*/external_react_default().createElement("div", {
        id: "wf-upl-message",
        className: "wf-upl-message",
        dangerouslySetInnerHTML: {
          __html: this.state.uploadResult
        }
      }) : /*#__PURE__*/external_react_default().createElement("textarea", {
        id: "wf-upl-message",
        className: "wf-upl-message",
        cols: "80",
        rows: "30",
        value: this.state.uploadResult
      }));
    }
  }]);
  return WorkflowyModeratorTool;
}((external_react_class_default()));
var UploadLinksFromCSV = /*#__PURE__*/function (_Component3) {
  ModeratorToolsPanel_inherits(UploadLinksFromCSV, _Component3);
  var _super3 = ModeratorToolsPanel_createSuper(UploadLinksFromCSV);
  function UploadLinksFromCSV(props) {
    var _this5;
    ModeratorToolsPanel_classCallCheck(this, UploadLinksFromCSV);
    _this5 = _super3.call(this, props);
    _this5.state = {
      projectName: ''
    };
    _this5.handleChange = _this5.handleChange.bind(ModeratorToolsPanel_assertThisInitialized(_this5));
    _this5.handleSubmit = _this5.handleSubmit.bind(ModeratorToolsPanel_assertThisInitialized(_this5));
    return _this5;
  }
  ModeratorToolsPanel_createClass(UploadLinksFromCSV, [{
    key: "isSubmitDisabled",
    value: function isSubmitDisabled() {
      return !this.state.hasFile || !this.state.projectName.length;
    }
  }, {
    key: "handleChange",
    value: function handleChange(event) {
      var target = event.target;
      this.setState(ModeratorToolsPanel_defineProperty({}, target.name, target.value));
    }
  }, {
    key: "handleFileChange",
    value: function handleFileChange(event) {
      this.setState({
        hasFile: !!event.target.files[0]
      });
    }
  }, {
    key: "handleSubmit",
    value: function handleSubmit(event) {
      var _this6 = this;
      event.preventDefault();
      this.setState({
        uploading: true,
        uploadMessage: "Uploading..."
      });
      var data = new FormData(event.target);
      var request = new Request('/modtools/links', {
        headers: {
          'X-CSRFToken': external_js_cookie_default().get('csrftoken')
        }
      });
      fetch(request, {
        method: 'POST',
        mode: 'same-origin',
        credentials: 'same-origin',
        body: data
      }).then(function (response) {
        if (!response.ok) {
          response.text().then(function (resp_text) {
            _this6.setState({
              uploading: false,
              uploadMessage: "",
              error: true,
              errorIsHTML: true,
              uploadResult: resp_text
            });
          });
        } else {
          response.json().then(function (resp_json) {
            _this6.setState({
              uploading: false,
              error: false,
              uploadMessage: resp_json.data.message,
              uploadResult: JSON.stringify(resp_json.data.index, undefined, 4)
            });
            if (resp_json.data.errors) {
              var blob = new Blob([resp_json.data.errors], {
                type: "text/plain;charset=utf-8"
              });
              (0,external_file_saver_namespaceObject.saveAs)(blob, 'errors.csv');
            }
          });
        }
      })["catch"](function (error) {
        _this6.setState({
          uploading: false,
          error: true,
          errorIsHTML: false,
          uploadMessage: error.message
        });
      });
    }
  }, {
    key: "getOptions",
    value: function getOptions() {
      var options = ['Commentary', 'Quotation', 'Related', 'Mesorat hashas', 'Ein Mishpat', 'Reference'];
      return options.map(function (option) {
        return /*#__PURE__*/external_react_default().createElement("option", {
          value: option.toLowerCase(),
          key: option
        }, option);
      });
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", {
        className: "uploadLinksFromCSV"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "dlSectionTitle"
      }, "Upload links"), /*#__PURE__*/external_react_default().createElement("form", {
        id: "upload-links-form",
        onSubmit: this.handleSubmit
      }, /*#__PURE__*/external_react_default().createElement("label", null, "Upload file:", /*#__PURE__*/external_react_default().createElement("input", {
        type: "file",
        name: "csv_file",
        onChange: this.handleFileChange
      }), /*#__PURE__*/external_react_default().createElement("br", null), "Choose a csv file with two columns. First row should include titles, and the others valid refs to link", /*#__PURE__*/external_react_default().createElement("br", null)), /*#__PURE__*/external_react_default().createElement("label", null, "Select links type:", /*#__PURE__*/external_react_default().createElement("select", {
        name: "linkType",
        value: this.state.linkType,
        onChange: this.handleChange
      }, this.getOptions())), /*#__PURE__*/external_react_default().createElement("label", null, "Project name", /*#__PURE__*/external_react_default().createElement("input", {
        name: "projectName",
        type: "text",
        value: this.state.generatedBy,
        onChange: this.handleChange
      })), /*#__PURE__*/external_react_default().createElement("input", {
        type: "submit",
        value: "Submit",
        disabled: this.isSubmitDisabled()
      })), this.state.uploadMessage && /*#__PURE__*/external_react_default().createElement("div", null, this.state.uploadMessage), this.state.errorIsHTML && /*#__PURE__*/external_react_default().createElement("div", {
        dangerouslySetInnerHTML: {
          __html: this.state.uploadResult
        }
      }));
    }
  }]);
  return UploadLinksFromCSV;
}((external_react_class_default()));
var InputRef = function InputRef(_ref) {
  var id = _ref.id,
    value = _ref.value,
    handleChange = _ref.handleChange,
    handleBlur = _ref.handleBlur,
    error = _ref.error;
  return /*#__PURE__*/external_react_default().createElement("label", null, "Ref", id, /*#__PURE__*/external_react_default().createElement("input", {
    type: "text",
    name: "ref".concat(id),
    value: value,
    onChange: handleChange,
    onBlur: handleBlur,
    style: error ? {
      backgroundColor: "rgba(255, 0, 0, 0.5)"
    } : {},
    placeholder: id === 2 ? 'all library, limited to 15k links' : null
  }), /*#__PURE__*/external_react_default().createElement("p", {
    role: "alert",
    style: {
      color: "rgb(255, 0, 0)"
    }
  }, error ? "Not a valid ref" : ""));
};
InputRef.propTypes = {
  id: (external_prop_types_default()).number.isRequired,
  value: (external_prop_types_default()).string.isRequired,
  handleChange: (external_prop_types_default()).func.isRequired,
  handleBlur: (external_prop_types_default()).func.isRequired,
  error: (external_prop_types_default()).bool
};
var InputNonRef = function InputNonRef(_ref2) {
  var name = _ref2.name,
    value = _ref2.value,
    handleChange = _ref2.handleChange;
  return /*#__PURE__*/external_react_default().createElement("label", null, name.charAt(0).toUpperCase() + name.slice(1), /*#__PURE__*/external_react_default().createElement("input", {
    type: "text",
    name: name,
    value: value,
    onChange: handleChange,
    placeholder: "any"
  }));
};
InputNonRef.propTypes = {
  name: (external_prop_types_default()).string.isRequired,
  value: (external_prop_types_default()).string.isRequired,
  handleChange: (external_prop_types_default()).func.isRequired
};
var DownloadButton = function DownloadButton() {
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "modtoolsButton"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "modtoolsButtonInner"
  }, "Download"));
};
function GetLinks() {
  var _useState = (0,external_react_.useState)({
      ref1: '',
      ref2: ''
    }),
    _useState2 = ModeratorToolsPanel_slicedToArray(_useState, 2),
    refs = _useState2[0],
    setRefs = _useState2[1];
  var _useState3 = (0,external_react_.useState)({
      ref2: false
    }),
    _useState4 = ModeratorToolsPanel_slicedToArray(_useState3, 2),
    errors = _useState4[0],
    setErrors = _useState4[1];
  var _useState5 = (0,external_react_.useState)(''),
    _useState6 = ModeratorToolsPanel_slicedToArray(_useState5, 2),
    type = _useState6[0],
    setType = _useState6[1];
  var _useState7 = (0,external_react_.useState)(''),
    _useState8 = ModeratorToolsPanel_slicedToArray(_useState7, 2),
    generatedBy = _useState8[0],
    setGeneratedBy = _useState8[1];
  var _useState9 = (0,external_react_.useState)(false),
    _useState10 = ModeratorToolsPanel_slicedToArray(_useState9, 2),
    bySegment = _useState10[0],
    setBySegment = _useState10[1];
  var handleCheck = function handleCheck() {
    setBySegment(!bySegment);
  };
  var handleChange = /*#__PURE__*/function () {
    var _ref3 = ModeratorToolsPanel_asyncToGenerator( /*#__PURE__*/ModeratorToolsPanel_regeneratorRuntime().mark(function _callee(event) {
      var _event$target, name, value, response;
      return ModeratorToolsPanel_regeneratorRuntime().wrap(function _callee$(_context) {
        while (1) switch (_context.prev = _context.next) {
          case 0:
            _event$target = event.target, name = _event$target.name, value = _event$target.value;
            setRefs(function (prev) {
              return ModeratorToolsPanel_objectSpread(ModeratorToolsPanel_objectSpread({}, prev), {}, ModeratorToolsPanel_defineProperty({}, name, value));
            });
            if (!errors[name]) {
              _context.next = 17;
              break;
            }
            if (value) {
              _context.next = 7;
              break;
            }
            setErrors(function (prev) {
              return ModeratorToolsPanel_objectSpread(ModeratorToolsPanel_objectSpread({}, prev), {}, ModeratorToolsPanel_defineProperty({}, name, false));
            });
            _context.next = 17;
            break;
          case 7:
            _context.prev = 7;
            _context.next = 10;
            return sefaria.getName(value);
          case 10:
            response = _context.sent;
            setErrors(function (prev) {
              return ModeratorToolsPanel_objectSpread(ModeratorToolsPanel_objectSpread({}, prev), {}, ModeratorToolsPanel_defineProperty({}, name, !response.is_ref));
            });
            _context.next = 17;
            break;
          case 14:
            _context.prev = 14;
            _context.t0 = _context["catch"](7);
            console.error(_context.t0);
          case 17:
          case "end":
            return _context.stop();
        }
      }, _callee, null, [[7, 14]]);
    }));
    return function handleChange(_x2) {
      return _ref3.apply(this, arguments);
    };
  }();
  var handleBlur = /*#__PURE__*/function () {
    var _ref4 = ModeratorToolsPanel_asyncToGenerator( /*#__PURE__*/ModeratorToolsPanel_regeneratorRuntime().mark(function _callee2(event) {
      var name, response;
      return ModeratorToolsPanel_regeneratorRuntime().wrap(function _callee2$(_context2) {
        while (1) switch (_context2.prev = _context2.next) {
          case 0:
            name = event.target.name;
            if (!refs[name]) {
              _context2.next = 12;
              break;
            }
            _context2.prev = 2;
            _context2.next = 5;
            return sefaria.getName(refs[name]);
          case 5:
            response = _context2.sent;
            setErrors(function (prev) {
              return ModeratorToolsPanel_objectSpread(ModeratorToolsPanel_objectSpread({}, prev), {}, ModeratorToolsPanel_defineProperty({}, name, !response.is_ref));
            });
            _context2.next = 12;
            break;
          case 9:
            _context2.prev = 9;
            _context2.t0 = _context2["catch"](2);
            console.error(_context2.t0);
          case 12:
          case "end":
            return _context2.stop();
        }
      }, _callee2, null, [[2, 9]]);
    }));
    return function handleBlur(_x3) {
      return _ref4.apply(this, arguments);
    };
  }();
  var formReady = function formReady() {
    return refs.ref1 && errors.ref1 === false && errors.ref2 === false;
  };
  var linksDownloadLink = function linksDownloadLink() {
    var queryParams = external_qs_default().stringify({
      type: type ? type : null,
      generated_by: generatedBy ? generatedBy : null
    }, {
      addQueryPrefix: true,
      skipNulls: true
    });
    var tool = bySegment ? 'index_links' : 'links';
    return "modtools/".concat(tool, "/").concat(refs.ref1, "/").concat(refs.ref2 || 'all').concat(queryParams);
  };
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "getLinks"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "dlSectionTitle"
  }, "Download links"), /*#__PURE__*/external_react_default().createElement("form", {
    id: "download-links-form"
  }, /*#__PURE__*/external_react_default().createElement("fieldset", null, /*#__PURE__*/external_react_default().createElement(InputRef, {
    id: 1,
    value: refs.ref1,
    handleChange: handleChange,
    handleBlur: handleBlur,
    error: errors.ref1
  }), /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement("input", {
    type: "checkbox",
    checked: bySegment,
    onChange: handleCheck
  }), "iterate by segments (include empties)")), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement(InputRef, {
    id: 2,
    value: refs.ref2,
    handleChange: handleChange,
    handleBlur: handleBlur,
    error: errors.ref2
  }), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement(InputNonRef, {
    name: "type",
    value: type,
    handleChange: function handleChange(e) {
      return setType(e.target.value);
    }
  }), /*#__PURE__*/external_react_default().createElement("br", null), /*#__PURE__*/external_react_default().createElement(InputNonRef, {
    name: "generated_by",
    value: generatedBy,
    handleChange: function handleChange(e) {
      return setGeneratedBy(e.target.value);
    }
  })), formReady() ? /*#__PURE__*/external_react_default().createElement("a", {
    href: linksDownloadLink(),
    download: true
  }, /*#__PURE__*/external_react_default().createElement(DownloadButton, null)) : /*#__PURE__*/external_react_default().createElement(DownloadButton, null));
}
/* harmony default export */ const js_ModeratorToolsPanel = (ModeratorToolsPanel);
;// CONCATENATED MODULE: ../static/js/PublicCollectionsPage.jsx
function PublicCollectionsPage_slicedToArray(arr, i) { return PublicCollectionsPage_arrayWithHoles(arr) || PublicCollectionsPage_iterableToArrayLimit(arr, i) || PublicCollectionsPage_unsupportedIterableToArray(arr, i) || PublicCollectionsPage_nonIterableRest(); }
function PublicCollectionsPage_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function PublicCollectionsPage_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return PublicCollectionsPage_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return PublicCollectionsPage_arrayLikeToArray(o, minLen); }
function PublicCollectionsPage_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function PublicCollectionsPage_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function PublicCollectionsPage_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }








var PublicCollectionsPage = function PublicCollectionsPage(_ref) {
  var multiPanel = _ref.multiPanel,
    initialWidth = _ref.initialWidth;
  var _useState = (0,external_react_.useState)(sefaria.getCollectionsListFromCache()),
    _useState2 = PublicCollectionsPage_slicedToArray(_useState, 2),
    collectionsList = _useState2[0],
    setCollectionsList = _useState2[1];
  var sortCollectionList = function sortCollectionList(d) {
    // Sort alphabetically, ignoring punctuation, putting numbers at the end, with collections in the current interface lang first.
    d["public"].sort(function (a, b) {
      var _map = [a.name, b.name].map(function (x) {
          return x.stripPunctuation();
        }),
        _map2 = PublicCollectionsPage_slicedToArray(_map, 2),
        strippedA = _map2[0],
        strippedB = _map2[1];
      var _map3 = [strippedA, strippedB].map(sefaria.hebrew.isHebrew),
        _map4 = PublicCollectionsPage_slicedToArray(_map3, 2),
        aHe = _map4[0],
        bHe = _map4[1];
      var _map5 = [strippedA, strippedB].map(function (x) {
          return /^\d/.test(x);
        }),
        _map6 = PublicCollectionsPage_slicedToArray(_map5, 2),
        aNum = _map6[0],
        bNum = _map6[1];
      if (aHe !== bHe) {
        return (sefaria.interfaceLang === "hebrew" ? aHe : bHe) ? -1 : 1;
      } else if (aNum !== bNum) {
        return aNum ? 1 : -1;
      } else {
        return strippedA < strippedB ? -1 : 1;
      }
    });
    return d;
  };
  if (collectionsList) {
    sortCollectionList(collectionsList);
  }
  (0,external_react_.useEffect)(function () {
    sefaria.getCollectionsList().then(function (d) {
      return sortCollectionList(d);
    }).then(function (d) {
      return setCollectionsList(d);
    });
  });
  var sidebarModules = [multiPanel ? {
    type: "AboutCollections"
  } : {
    type: null
  }, {
    type: "StayConnected"
  }];
  var enCollections, heCollections, enCollBox, heCollBox;
  if (collectionsList) {
    enCollections = collectionsList["public"].filter(function (c) {
      return !sefaria.hebrew.isHebrew(c.name);
    });
    heCollections = collectionsList["public"].filter(function (c) {
      return sefaria.hebrew.isHebrew(c.name);
    });
    var _map7 = [enCollections, heCollections].map(function (coll) {
      return /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
        content: coll.map(function (item) {
          return /*#__PURE__*/external_react_default().createElement(CollectionBlockListing, {
            data: item,
            key: item.name
          });
        }),
        initialWidth: initialWidth
      });
    });
    var _map8 = PublicCollectionsPage_slicedToArray(_map7, 2);
    enCollBox = _map8[0];
    heCollBox = _map8[1];
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerNavMenu"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "content"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "sidebarLayout"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "contentInner"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Collections")), multiPanel ? null : /*#__PURE__*/external_react_default().createElement(Modules, {
    type: "AboutCollections",
    props: {
      hideTitle: true
    }
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionsList"
  }, !!collectionsList ? collectionsList["public"].length ? sefaria.interfaceLang === "hebrew" ? /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "heCollections"
  }, heCollBox), /*#__PURE__*/external_react_default().createElement("div", {
    className: "enCollections"
  }, enCollBox)) : /*#__PURE__*/external_react_default().createElement((external_react_default()).Fragment, null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "enCollections"
  }, enCollBox), /*#__PURE__*/external_react_default().createElement("div", {
    className: "heCollections"
  }, heCollBox)) : /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "There are no public collections yet.") : /*#__PURE__*/external_react_default().createElement(LoadingMessage, null))), /*#__PURE__*/external_react_default().createElement(NavSidebar, {
    modules: sidebarModules
  })), /*#__PURE__*/external_react_default().createElement(js_Footer, null)));
};
var CollectionBlockListing = function CollectionBlockListing(_ref2) {
  var data = _ref2.data;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "navBlock"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: "/collections/".concat(data.slug),
    className: "navBlockTitle"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "collectionListingImageBox"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    className: "collectionListingImage",
    src: data.imageUrl,
    alt: "Collection Logo"
  })), /*#__PURE__*/external_react_default().createElement(InterfaceText, null, data.name)), data.description ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "navBlockDescription clamped clamped5"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, data.description.stripHtml())) : null);
};
/* harmony default export */ const js_PublicCollectionsPage = (PublicCollectionsPage);
;// CONCATENATED MODULE: ../static/js/TranslationsPage.jsx
function TranslationsPage_slicedToArray(arr, i) { return TranslationsPage_arrayWithHoles(arr) || TranslationsPage_iterableToArrayLimit(arr, i) || TranslationsPage_unsupportedIterableToArray(arr, i) || TranslationsPage_nonIterableRest(); }
function TranslationsPage_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function TranslationsPage_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return TranslationsPage_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TranslationsPage_arrayLikeToArray(o, minLen); }
function TranslationsPage_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function TranslationsPage_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function TranslationsPage_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }






var TranslationsPage = function TranslationsPage(_ref) {
  var translationsSlug = _ref.translationsSlug;
  var _useState = (0,external_react_.useState)(null),
    _useState2 = TranslationsPage_slicedToArray(_useState, 2),
    translations = _useState2[0],
    setTranslations = _useState2[1];
  var _useState3 = (0,external_react_.useState)({}),
    _useState4 = TranslationsPage_slicedToArray(_useState3, 2),
    uncategorized = _useState4[0],
    setUncategorized = _useState4[1];
  var _useState5 = (0,external_react_.useState)({}),
    _useState6 = TranslationsPage_slicedToArray(_useState5, 2),
    prioritized = _useState6[0],
    setPrioritized = _useState6[1];
  var sidebarModules = [{
    type: "AboutTranslatedText",
    props: {
      translationsSlug: translationsSlug
    }
  }];
  var translation = sefaria.getTranslation(translationsSlug).then(function (x) {
    setTranslations(x);
  });
  (0,external_react_.useEffect)(function () {
    setPrioritized(translations ? Object.keys(translations).reduce(function (uncategorized, key) {
      uncategorized[key] = translations[key]['Uncategorized'] ? translations[key]['Uncategorized'].filter(function (translation) {
        return sefaria.tocItemsByCategories([key]).map(function (x) {
          return x.title;
        }).includes(translation.title);
      }) : null;
      return uncategorized;
    }, {}) : {});
    setUncategorized(translations ? Object.keys(translations).reduce(function (uncategorized, key) {
      uncategorized[key] = translations[key]['Uncategorized'] ? translations[key]['Uncategorized'].filter(function (translation) {
        return !sefaria.tocItemsByCategories([key]).map(function (x) {
          return x.title;
        }).includes(translation.title);
      }) : null;
      return uncategorized;
    }, {}) : {});
  }, [translations]);
  var tabs = [{
    id: "texts",
    title: {
      en: "Texts",
      he: sefaria._("Texts", "Header")
    }
  }];
  var sortFx = function sortFx(a, b) {
    if (a["order"] && b["order"]) {
      return a['order'][0] - b['order'][0];
    } else {
      return 0;
    }
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "readerNavMenu noLangToggleInHebrew",
    key: "0"
  }, /*#__PURE__*/React.createElement("div", {
    className: "content"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sidebarLayout"
  }, /*#__PURE__*/React.createElement("div", {
    className: "contentInner"
  }, /*#__PURE__*/React.createElement("h1", {
    className: "serif pageTitle"
  }, /*#__PURE__*/React.createElement(InterfaceText, null, sefaria.getHebrewTitle(translationsSlug))), /*#__PURE__*/React.createElement(TabView, {
    currTabIndex: 0,
    tabs: tabs,
    containerClasses: "largeTabs",
    renderTab: function renderTab(t) {
      return /*#__PURE__*/React.createElement("div", {
        className: external_classnames_default()({
          tab: 1,
          noselect: 1,
          filter: t.justifyright,
          open: t.justifyright && showFilterHeader
        })
      }, /*#__PURE__*/React.createElement(InterfaceText, {
        text: t.title
      }), t.icon ? /*#__PURE__*/React.createElement("img", {
        src: t.icon,
        alt: "".concat(t.title.en, " icon")
      }) : null);
    }
  }, /*#__PURE__*/React.createElement(React.Fragment, null, " ", translations ? sefaria.toc.filter(function (w) {
    return Object.keys(translations).includes(w.category);
  }).map(function (w) {
    return w.category;
  }).map(function (corpus) {
    return /*#__PURE__*/React.createElement("div", {
      key: corpus,
      className: "translationsPage"
    }, /*#__PURE__*/React.createElement("h2", null, /*#__PURE__*/React.createElement(InterfaceText, null, corpus)), prioritized[corpus] ? /*#__PURE__*/React.createElement("ul", null, prioritized[corpus].sort(sortFx).map(function (x) {
      return /*#__PURE__*/React.createElement("li", {
        key: x.title,
        className: "bullet languageItem"
      }, /*#__PURE__*/React.createElement("a", {
        href: x.url
      }, /*#__PURE__*/React.createElement(InterfaceText, null, x.title)));
    })) : null, sefaria.tocObjectByCategories([corpus]).contents.filter(function (x) {
      return Object.keys(translations[corpus]).includes(x.category);
    }).map(function (x) {
      return /*#__PURE__*/React.createElement("details", {
        key: x.category,
        open: translationsSlug !== "en"
      }, /*#__PURE__*/React.createElement("summary", null, /*#__PURE__*/React.createElement(InterfaceText, null, x.category)), /*#__PURE__*/React.createElement("ul", null, translations[corpus][x.category].sort(sortFx).map(function (y, i) {
        return /*#__PURE__*/React.createElement("li", {
          key: i + y.title,
          className: "bullet languageItem"
        }, /*#__PURE__*/React.createElement("a", {
          href: y.url
        }, /*#__PURE__*/React.createElement(InterfaceText, null, y.title)));
      })));
    }), uncategorized[corpus] && uncategorized[corpus].length > 0 ? /*#__PURE__*/React.createElement("details", {
      open: translationsSlug !== "en"
    }, /*#__PURE__*/React.createElement("summary", null, /*#__PURE__*/React.createElement(InterfaceText, null, "Uncategorized")), /*#__PURE__*/React.createElement("ul", null, uncategorized[corpus].sort(sortFx).map(function (y, i) {
      return /*#__PURE__*/React.createElement("li", {
        key: i + y.title,
        className: "bullet languageItem"
      }, /*#__PURE__*/React.createElement("a", {
        href: y.url
      }, y.title));
    }))) : null);
  }) : null))), /*#__PURE__*/React.createElement(NavSidebar, {
    modules: sidebarModules
  })), /*#__PURE__*/React.createElement(js_Footer, null)));
};
/* harmony default export */ const js_TranslationsPage = (TranslationsPage);
;// CONCATENATED MODULE: ../static/js/ReaderPanel.jsx
function ReaderPanel_typeof(obj) { "@babel/helpers - typeof"; return ReaderPanel_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, ReaderPanel_typeof(obj); }
function ReaderPanel_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = ReaderPanel_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function ReaderPanel_slicedToArray(arr, i) { return ReaderPanel_arrayWithHoles(arr) || ReaderPanel_iterableToArrayLimit(arr, i) || ReaderPanel_unsupportedIterableToArray(arr, i) || ReaderPanel_nonIterableRest(); }
function ReaderPanel_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function ReaderPanel_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return ReaderPanel_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return ReaderPanel_arrayLikeToArray(o, minLen); }
function ReaderPanel_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function ReaderPanel_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function ReaderPanel_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function ReaderPanel_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function ReaderPanel_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ReaderPanel_ownKeys(Object(source), !0).forEach(function (key) { ReaderPanel_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ReaderPanel_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function ReaderPanel_defineProperty(obj, key, value) { key = ReaderPanel_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function ReaderPanel_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function ReaderPanel_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, ReaderPanel_toPropertyKey(descriptor.key), descriptor); } }
function ReaderPanel_createClass(Constructor, protoProps, staticProps) { if (protoProps) ReaderPanel_defineProperties(Constructor.prototype, protoProps); if (staticProps) ReaderPanel_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function ReaderPanel_toPropertyKey(arg) { var key = ReaderPanel_toPrimitive(arg, "string"); return ReaderPanel_typeof(key) === "symbol" ? key : String(key); }
function ReaderPanel_toPrimitive(input, hint) { if (ReaderPanel_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (ReaderPanel_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function ReaderPanel_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) ReaderPanel_setPrototypeOf(subClass, superClass); }
function ReaderPanel_setPrototypeOf(o, p) { ReaderPanel_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return ReaderPanel_setPrototypeOf(o, p); }
function ReaderPanel_createSuper(Derived) { var hasNativeReflectConstruct = ReaderPanel_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = ReaderPanel_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = ReaderPanel_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return ReaderPanel_possibleConstructorReturn(this, result); }; }
function ReaderPanel_possibleConstructorReturn(self, call) { if (call && (ReaderPanel_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return ReaderPanel_assertThisInitialized(self); }
function ReaderPanel_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function ReaderPanel_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function ReaderPanel_getPrototypeOf(o) { ReaderPanel_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return ReaderPanel_getPrototypeOf(o); }
































var ReaderPanel = /*#__PURE__*/function (_Component) {
  ReaderPanel_inherits(ReaderPanel, _Component);
  var _super = ReaderPanel_createSuper(ReaderPanel);
  function ReaderPanel(props) {
    var _this;
    ReaderPanel_classCallCheck(this, ReaderPanel);
    _this = _super.call(this, props);
    var state = _this.clonePanel(props.initialState);
    state["initialAnalyticsTracked"] = false;
    state.width = _this.props.multiPanel ? 1000 : 500; // Assume we're in a small panel not using multipanel
    _this.state = state;
    _this.sheetRef = /*#__PURE__*/external_react_default().createRef();
    _this.readerContentRef = /*#__PURE__*/external_react_default().createRef();
    return _this;
  }
  ReaderPanel_createClass(ReaderPanel, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      window.addEventListener("resize", this.setWidth);
      this.setWidth();
      if (this.props.panelPosition) {
        //Focus on the first focusable element of the newly loaded panel. Mostly for a11y
        var curPanel = sefariaJquery(".readerPanel")[this.props.panelPosition];
        sefariaJquery(curPanel).find(':focusable').first().focus();
      }
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      window.removeEventListener("resize", this.setWidth);
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if (nextProps.searchQuery && this.state.menuOpen !== "search") {
        this.openSearch(nextProps.searchQuery);
      }
      if (this.state.menuOpen !== nextProps.initialMenu) {
        this.setState({
          menuOpen: nextProps.initialMenu
        });
      }
      this.setState(nextProps.initialState);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (prevProps.layoutWidth !== this.props.layoutWidth) {
        this.setWidth();
      }
      if (sefariaJquery('*:focus').length == 0 && this.props.multiPanel && sefariaJquery("body").hasClass("user-is-tabbing")) {
        var curPanel = sefariaJquery(".readerPanel")[sefariaJquery(".readerPanel").length - 1];
        sefariaJquery(curPanel).find(':focusable').first().focus();
      }
      this.replaceHistory = false;
      if (this.state.displaySettingsOpen) {
        sefariaJquery(".readerOptionsPanel").find('.on:focusable').first().focus();
      }
    }
  }, {
    key: "conditionalSetState",
    value: function conditionalSetState(state) {
      // Set state either in the central app or in the local component.
      // If setCentralState function is present, then this ReaderPanel's state is managed from within the ReaderApp component.
      // If it is not present, then the state for this ReaderPanel is managed from the component itself.
      if (this.props.setCentralState) {
        this.props.setCentralState(state, this.replaceHistory);
        this.replaceHistory = false;
      } else {
        this.setState(state);
      }
    }
  }, {
    key: "onError",
    value: function onError(message) {
      if (this.props.onError) {
        this.props.onError(message);
        return;
      }
      this.setState({
        "error": message
      });
    }
  }, {
    key: "getContentLanguageOverride",
    value: function getContentLanguageOverride(originalLanguage, mode, menuOpen) {
      // Determines the actual content language used inside this ReaderPanel.
      // Because it's called in the constructor, assume state isnt necessarily defined and pass
      // variables mode and menuOpen manually
      var contentLangOverride = originalLanguage;
      if (["topics", "allTopics", "calendars", "community", "collection"].includes(menuOpen)) {
        //  "story_editor",
        // Always bilingual for English interface, always Hebrew for Hebrew interface
        contentLangOverride = sefaria.interfaceLang === "english" ? "bilingual" : "hebrew";
      } else if (mode === "Connections" || !!menuOpen) {
        // Always Hebrew for Hebrew interface, treat bilingual as English for English interface
        contentLangOverride = sefaria.interfaceLang === "hebrew" ? "hebrew" : originalLanguage === "bilingual" ? "english" : originalLanguage;
      }
      return contentLangOverride;
    }
  }, {
    key: "clonePanel",
    value: function clonePanel(panel) {
      // Todo: Move the multiple instances of this out to a utils file
      return sefaria.util.clone(panel);
    }
  }, {
    key: "handleBaseSegmentClick",
    value: function handleBaseSegmentClick(ref) {
      var showHighlight = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
      if (this.state.mode === "TextAndConnections") {
        this.closeConnectionsInPanel();
      } else if (this.state.mode === "Text") {
        sefaria.track.event("Reader", "Open Connections Panel", ref);
        if (this.props.multiPanel) {
          this.conditionalSetState({
            showHighlight: showHighlight
          });
          this.props.onSegmentClick(ref);
        } else {
          this.openConnectionsInPanel(ref);
        }
      }
    }
  }, {
    key: "handleSheetSegmentClick",
    value: function handleSheetSegmentClick(source) {
      var _this2 = this;
      if (source === 0) {
        //the click may be coming from the sheet reader controls, and so we need to find
        // the first node or the node thats in the url
        var sheet = sefaria.sheets.loadSheetByID(this.state.sheetID); // Should already be loaded and in cache
        source = this.state.highlightedNode ? sheet.sources.find(function (source) {
          return source.node === _this2.state.highlightedNode;
        }) : sheet.sources[0];
      }
      this.conditionalSetState({
        highlightedNode: source.node
      });
      var sheetRef = "Sheet " + this.state.sheetID + ":" + source.node;
      if (this.state.mode === "SheetAndConnections") {
        this.closeSheetConnectionsInPanel();
      } else if (this.state.mode === "Sheet") {
        if (this.props.multiPanel) {
          if (source.ref) {
            this.props.onSegmentClick(sefaria.splitRangingRef(source.ref), source.node);
          } else {
            this.props.onSegmentClick(sheetRef, source.node);
          }
        } else {
          this.openSheetConnectionsInPanel(source.ref || sheetRef, source.node);
        }
      }
    }
  }, {
    key: "handleCitationClick",
    value: function handleCitationClick(citationRef, textRef, replace, currVersions) {
      if (this.props.multiPanel) {
        this.props.onCitationClick(citationRef, textRef, replace, currVersions);
      } else {
        this.showBaseText(citationRef, replace, currVersions);
      }
    }
  }, {
    key: "handleTextListClick",
    value: function handleTextListClick(ref, replaceHistory, currVersions) {
      this.showBaseText(ref, replaceHistory, currVersions);
    }
  }, {
    key: "updateCurrVersionsToMatchAPIResult",
    value: function updateCurrVersionsToMatchAPIResult(enVTitle, heVTitle) {
      var newVersions = ReaderPanel_objectSpread(ReaderPanel_objectSpread({}, this.state.currVersions), {}, {
        enAPIResult: enVTitle,
        heAPIResult: heVTitle
      });
      if (sefaria.util.object_equals(this.state.currVersions, newVersions)) {
        return;
      }
      this.conditionalSetState({
        currVersions: newVersions
      });
    }
  }, {
    key: "openConnectionsInPanel",
    value: function openConnectionsInPanel(ref, additionalState) {
      var refs = typeof ref == "string" ? [ref] : ref;
      this.replaceHistory = this.state.mode === "TextAndConnections"; // Don't push history for change in Connections focus
      var newState = {
        highlightedRefs: refs,
        mode: "TextAndConnections"
      };
      if (additionalState) {
        newState = ReaderPanel_objectSpread(ReaderPanel_objectSpread({}, newState), additionalState);
      }
      this.conditionalSetState(newState, this.replaceHistory);
    }
  }, {
    key: "onNamedEntityClick",
    value: function onNamedEntityClick(slug, textRef, namedEntityText) {
      // make sure text list is highlighted for segment with named entity
      this.setTextListHighlight(textRef, true);

      // decide whether to open side panel in current panel or in new panel based on whether app is multipanel
      var namedEntityState = {
        connectionsMode: "Lexicon",
        selectedNamedEntity: slug,
        selectedNamedEntityText: namedEntityText
      };
      if (this.props.multiPanel) {
        this.props.openNamedEntityInNewPanel(textRef, namedEntityState);
      } else {
        this.openConnectionsInPanel([textRef], namedEntityState);
      }
    }
  }, {
    key: "closeConnectionsInPanel",
    value: function closeConnectionsInPanel() {
      // Return to the original text in the ReaderPanel contents
      this.conditionalSetState({
        highlightedRefs: [],
        mode: "Text"
      });
    }
  }, {
    key: "openSheetConnectionsInPanel",
    value: function openSheetConnectionsInPanel(ref, node) {
      var refs = typeof ref == "string" ? [ref] : ref;
      this.replaceHistory = this.state.mode === "SheetAndConnections"; // Don't push history for change in Connections focus
      this.conditionalSetState({
        highlightedNode: node,
        highlightedRefs: refs,
        mode: "SheetAndConnections"
      }, this.replaceHistory);
    }
  }, {
    key: "closeSheetConnectionsInPanel",
    value: function closeSheetConnectionsInPanel() {
      // Return to the original text in the ReaderPanel contents
      this.conditionalSetState({
        highlightedNode: null,
        highlightedRefs: [],
        mode: "Sheet"
      });
    }
  }, {
    key: "handleSheetClick",
    value: function handleSheetClick(e, sheet, highlightedNode, highlightedRefsInSheet) {
      e.preventDefault();
      this.conditionalSetState({
        mode: "Sheet",
        sheetID: sheet.id,
        highlightedNode: highlightedNode,
        highlightedRefsInSheet: highlightedRefsInSheet
      });
    }
  }, {
    key: "showBaseText",
    value: function showBaseText(ref, replaceHistory) {
      var currVersions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {
        en: null,
        he: null
      };
      var filter = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [];
      // Set the current primary text `ref`, which may be either a string or an array of strings.
      // `replaceHistory` - bool whether to replace browser history rather than push for this change
      if (!ref) {
        return;
      }
      this.replaceHistory = Boolean(replaceHistory);
      // console.log("showBaseText", ref, replaceHistory);
      if (this.state.mode === "Connections" && this.props.masterPanelLanguage === "bilingual") {
        // Connections panels are forced to be mono-lingual. When opening a text from a connections panel,
        // allow it to return to bilingual.
        this.state.settings.language = "bilingual";
      }
      var refs, currentlyVisibleRef, highlightedRefs;
      if (ref.constructor === Array) {
        // When called with an array, set highlight for the whole spanning range
        refs = ref;
        currentlyVisibleRef = sefaria.humanRef(ref);
        var splitArray = refs.map(function (ref) {
          return sefaria.splitRangingRef(ref);
        });
        highlightedRefs = [].concat.apply([], splitArray);
      } else {
        var oRef = sefaria.parseRef(ref);
        if (oRef.book === "Sheet") {
          this.openSheet(ref);
          return;
        }
        refs = [ref];
        currentlyVisibleRef = ref;
        highlightedRefs = [];
      }
      if (this.replaceHistory) {
        this.props.saveLastPlace({
          mode: "Text",
          refs: refs,
          currVersions: currVersions,
          settings: this.state.settings
        }, this.props.panelPosition);
      }
      this.conditionalSetState({
        mode: "Text",
        refs: refs,
        filter: filter,
        currentlyVisibleRef: currentlyVisibleRef,
        currVersions: currVersions,
        highlightedRefs: highlightedRefs,
        recentFilters: [],
        menuOpen: null,
        compare: false,
        sheetID: null,
        connectionsMode: "Resources",
        settings: this.state.settings
      });
    }
  }, {
    key: "openSheet",
    value: function openSheet(sheetRef, replaceHistory) {
      this.replaceHistory = Boolean(replaceHistory);
      var parsedRef = sefaria.parseRef(sheetRef);
      var _parsedRef$sections = ReaderPanel_slicedToArray(parsedRef.sections, 2),
        sheetID = _parsedRef$sections[0],
        sheetNode = _parsedRef$sections[1];
      sheetID = parseInt(sheetID);
      sheetNode = sheetNode ? parseInt(sheetNode) : null;
      if (this.replaceHistory) {
        // Replacing sheet history occurs after sheet data has been loaded,
        // when we have all the data we need to store history.
        this.props.saveLastPlace({
          mode: "Sheet",
          sheetID: sheetID,
          settings: this.state.settings
        }, this.props.panelPosition);
      }
      this.conditionalSetState({
        mode: 'Sheet',
        sheetID: sheetID,
        highlightedNode: sheetNode,
        menuOpen: null
      });
    }
  }, {
    key: "updateTextColumn",
    value: function updateTextColumn(refs) {
      // Change the refs in the current TextColumn, for infinite scroll up/down.
      this.replaceHistory = true;
      this.conditionalSetState({
        refs: refs
      });
    }
  }, {
    key: "setTextListHighlight",
    value: function setTextListHighlight(refs, showHighlight) {
      refs = typeof refs === "string" ? [refs] : refs;
      this.replaceHistory = true;
      if (!sefaria.util.object_equals(refs, this.state.highlightedRefs)) {
        this.props.closeNamedEntityInConnectionPanel();
      }
      this.conditionalSetState({
        highlightedRefs: refs,
        showHighlight: showHighlight
      });
      this.props.setTextListHighlight(refs);
    }
  }, {
    key: "setFocusedText",
    value: function setFocusedText(refs) {
      refs = typeof refs === "string" ? [refs] : refs;
      this.replaceHistory = true;
      this.conditionalSetState({
        highlightedRefs: refs
      });
      if (this.props.multiPanel) {
        this.props.setTextListHighlight(refs);
      }
    }
  }, {
    key: "updateCollectionName",
    value: function updateCollectionName(name) {
      // Replace history with collection name, which may be loaded from API with slug
      // after the CollectionPage has initiall rendered.
      this.replaceHistory = true;
      this.conditionalSetState({
        collectionName: name
      });
    }
  }, {
    key: "setSelectedWords",
    value: function setSelectedWords(words) {
      words = typeof words !== "undefined" && words.length ? words : "";
      words = words.trim();
      this.replaceHistory = false;
      if (this.props.multiPanel) {
        this.props.setSelectedWords(words);
      } else {
        this.conditionalSetState({
          'selectedWords': words
        });
      }
    }
  }, {
    key: "clearSelectedWords",
    value: function clearSelectedWords() {
      this.replaceHistory = false;
      if (this.props.multiPanel) {
        this.props.clearSelectedWords();
      } else {
        this.conditionalSetState({
          'selectedWords': ''
        });
      }
    }
  }, {
    key: "closeMenus",
    value: function closeMenus() {
      var state = {
        // If there's no content to show, return to navigation
        menuOpen: this.state.refs.slice(-1)[0] ? null : "navigation",
        navigationCategories: null,
        navigationTopicCategory: null
      };
      this.conditionalSetState(state);
    }
  }, {
    key: "closeSheetMetaData",
    value: function closeSheetMetaData() {
      var state = {
        menuOpen: null,
        mode: "Sheet",
        navigationCategories: null,
        navigationTopicCategory: null
      };
      this.conditionalSetState(state);
    }
  }, {
    key: "openMenu",
    value: function openMenu(menu) {
      this.conditionalSetState({
        menuOpen: menu,
        mode: "Text",
        initialAnalyticsTracked: false,
        navigationCategories: null,
        navigationTopic: null,
        navigationTopicTitle: null,
        topicTitle: null
      });
    }
  }, {
    key: "setNavigationCategories",
    value: function setNavigationCategories(categories) {
      this.conditionalSetState({
        navigationCategories: categories
      });
    }
  }, {
    key: "setNavigationTopic",
    value: function setNavigationTopic(topic, topicTitle) {
      this.conditionalSetState({
        menuOpen: 'topics',
        navigationTopicCategory: topic,
        navigationTopicTitle: topicTitle,
        navigationTopic: null,
        topicTitle: null,
        navigationCategories: null
      });
    }
  }, {
    key: "setCollectionTag",
    value: function setCollectionTag(tag) {
      this.conditionalSetState({
        collectionTag: tag
      });
    }
  }, {
    key: "setFilter",
    value: function setFilter(filter, updateRecent) {
      // Sets the current filter for Connected Texts (TextList)
      // If updateRecent is true, include the current setting in the list of recent filters.
      if (this.props.setConnectionsFilter) {
        this.props.setConnectionsFilter(filter, updateRecent);
      } else {
        if (updateRecent && filter) {
          if (sefaria.util.inArray(filter, this.state.recentFilters) !== -1) {
            this.state.recentFilters.toggle(filter);
          }
          this.state.recentFilters = [filter].concat(this.state.recentFilters);
        }
        filter = filter ? [filter] : [];
        this.conditionalSetState({
          recentFilters: this.state.recentFilters,
          filter: filter,
          connectionsMode: "TextList"
        });
      }
    }
  }, {
    key: "setVersionFilter",
    value: function setVersionFilter(filter) {
      if (this.props.setVersionFilter) {
        this.props.setVersionFilter(filter);
      } else {
        var filtInd = sefaria.util.inArray(filter, this.state.recentVersionFilters);
        if (filtInd === -1) {
          this.state.recentVersionFilters = [filter].concat(this.state.recentVersionFilters);
        }
        filter = filter ? [filter] : [];
        this.conditionalSetState({
          recentVersionFilters: this.state.recentVersionFilters,
          versionFilter: filter,
          connectionsMode: "Translation Open"
        });
      }
    }
  }, {
    key: "setWebPagesFilter",
    value: function setWebPagesFilter(filter) {
      this.conditionalSetState({
        webPagesFilter: filter,
        connectionsMode: "WebPagesList"
      });
    }
  }, {
    key: "setTopic",
    value: function setTopic(navigationTopic, topicTitle) {
      this.conditionalSetState({
        menuOpen: "topics",
        navigationTopicCategory: null,
        topicTestVersion: this.props.topicTestVersion,
        navigationTopic: navigationTopic,
        topicTitle: topicTitle
      });
    }
  }, {
    key: "openCompareTextTOC",
    value: function openCompareTextTOC(title) {
      // Opens the Text TOC in a compare panel
      console.log("openCompareTextTOC");
      this.conditionalSetState({
        menuOpen: "book toc",
        compare: true,
        bookRef: title,
        previousCategories: this.state.navigationCategories
      });
    }
  }, {
    key: "toggleLanguage",
    value: function toggleLanguage() {
      if (this.state.settings.language === "hebrew") {
        this.setOption("language", "english");
        if (sefaria.site) {
          sefaria.track.event("Reader", "Change Language", "english");
        }
      } else {
        this.setOption("language", "hebrew");
        if (sefaria.site) {
          sefaria.track.event("Reader", "Change Language", "hebrew");
        }
      }
    }
  }, {
    key: "openSearch",
    value: function openSearch(query) {
      this.conditionalSetState({
        menuOpen: "search",
        searchQuery: query
      });
    }
  }, {
    key: "openDisplaySettings",
    value: function openDisplaySettings() {
      this.conditionalSetState({
        displaySettingsOpen: true
      });
    }
  }, {
    key: "closeDisplaySettings",
    value: function closeDisplaySettings() {
      this.conditionalSetState({
        displaySettingsOpen: false
      });
    }
  }, {
    key: "setOption",
    value: function setOption(option, value) {
      if (option === "fontSize") {
        var step = 1.15;
        var size = this.state.settings.fontSize;
        value = value === "smaller" ? size / step : size * step;
      } else if (option === "layout") {
        var category = this.currentCategory();
        option = category === "Tanakh" || category === "Talmud" ? "layout" + category : "layoutDefault";
      }
      this.state.settings[option] = value;
      var state = {
        settings: this.state.settings
      };
      if (option !== "fontSize") {
        state.displaySettingsOpen = false;
      }
      if (option === "language") {
        sefariaJquery.cookie("contentLang", value, {
          path: "/"
        });
        this.replaceHistory = true;
        this.props.setDefaultOption && this.props.setDefaultOption(option, value);
      }
      sefariaJquery.cookie(option, value, {
        path: "/"
      });
      this.conditionalSetState(state);
    }
  }, {
    key: "setConnectionsMode",
    value: function setConnectionsMode(mode) {
      var connectionData = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      var loginRequired = {
        "Add Connection": 1
      };
      if (mode == "Add Connection" && this.props.allOpenRefs.length == 1) {
        this.props.openComparePanel(true);
        return;
      }
      sefaria.track.event("Tools", mode + " Click"); // TODO Shouldn't be tracking clicks here, this function is called programmatically
      if (!sefaria._uid && mode in loginRequired) {
        sefaria.track.event("Tools", "Prompt Login");
        mode = "Login";
      }
      var state = {
        connectionsMode: mode
      };
      if (mode === "Resources") {
        this.setFilter();
      }
      state["connectionData"] = !!connectionData ? connectionData : null;
      this.conditionalSetState(state);
    }
  }, {
    key: "setConnectionsCategory",
    value: function setConnectionsCategory(category) {
      this.setFilter(category, false); // Set filter so that basetext shows link dots according to this category
      this.conditionalSetState({
        connectionsCategory: category,
        connectionsMode: "ConnectionsList"
      });
    }
  }, {
    key: "editNote",
    value: function editNote(note) {
      this.conditionalSetState({
        connectionsMode: "Edit Note",
        noteBeingEdited: note
      });
    }
  }, {
    key: "setWidth",
    value: function setWidth() {
      this.setState({
        width: sefariaJquery(external_react_dom_default().findDOMNode(this)).width()
      });
      //console.log("Setting panel width", this.width);
    }
  }, {
    key: "setCurrentlyVisibleRef",
    value: function setCurrentlyVisibleRef(ref) {
      this.replaceHistory = true;
      //var ref = this.state.highlightedRefs.length ? Sefaria.normRef(this.state.highlightedRefs) : ref;
      this.conditionalSetState({
        currentlyVisibleRef: ref
      });
    }
  }, {
    key: "setTab",
    value: function setTab(tab) {
      var replaceHistoryIfReaderAppUpdated = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      // There is a race condition such that when navigating to a new page that has a TabView component, sometimes TabView
      // mounts before ReaderApp's componentDidUpdate gets called, which results in setTab calling conditionalSetState
      // before the previous page's history state has been pushed to the history object. If this happens, we want
      // this.replaceHistory to be false so that we don't override the previous page's history.
      // If history.state.panels[0].mode is undefined, we know that conditionalSetState has been called already, and we
      // can replace the history state. Otherwise, we want to push the history state, so we set replaceHistory to false.
      this.replaceHistory = replaceHistoryIfReaderAppUpdated ? history.state ? !history.state.panels[0].mode : true // on page load history state may not yet exist -- in that case force update
      : false;
      this.conditionalSetState({
        tab: tab
      });
    }
  }, {
    key: "currentMode",
    value: function currentMode() {
      return this.state.mode;
    }
  }, {
    key: "currentRef",
    value: function currentRef() {
      // Returns a string of the current ref, the first if there are many
      return this.state.refs && this.state.refs.length ? this.state.refs[0] : this.state.highlightedRefs && this.state.highlightedRefs ? this.state.highlightedRefs[0] : null;
    }
  }, {
    key: "currentData",
    value: function currentData() {
      // Returns the data from the library of the current ref
      var ref = this.currentRef();
      if (!ref) {
        return null;
      }
      if (typeof ref !== "string") {
        debugger;
      }
      var data = sefaria.ref(ref);
      return data;
    }
  }, {
    key: "currentBook",
    value: function currentBook() {
      var data = this.currentData();
      if (data) {
        return data.indexTitle;
      } else {
        var pRef = sefaria.parseRef(this.currentRef());
        return "index" in pRef ? pRef.index : "book" in pRef ? pRef.book : null;
      }
    }
  }, {
    key: "currentCategory",
    value: function currentCategory() {
      if (this.state.mode == "Sheet") {
        return "Sheets";
      } else {
        var book = this.currentBook();
        return sefaria.index(book) ? sefaria.index(book)['primary_category'] : null;
      }
    }
  }, {
    key: "currentLayout",
    value: function currentLayout() {
      if (this.state.settings.language == "bilingual") {
        return this.state.width > 500 ? this.state.settings.biLayout : "stacked";
      }
      // dont allow continuous mode in sidebar since it's currently not possible to control layout from sidebar
      if (this.state.mode === "Connections") {
        return "segmented";
      }
      var category = this.currentCategory();
      var option = category && (category === "Tanakh" || category === "Talmud") ? "layout" + category : "layoutDefault";
      return this.state.settings[option];
    }
  }, {
    key: "handleKeyPress",
    value: function handleKeyPress(e) {
      if (e.keyCode === 27) {
        this.props.closePanel(e);
      }
    }
  }, {
    key: "backFromExtendedNotes",
    value: function backFromExtendedNotes() {
      var bookRef = this.state.bookRef ? this.state.bookRef : this.currentBook();
      this.props.backFromExtendedNotes(bookRef, this.state.currVersions);
    }
  }, {
    key: "whereIsElementInViewport",
    value: function whereIsElementInViewport(element) {
      var elementbbox = element.getBoundingClientRect();
      var vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
      if (elementbbox.top >= 200 && elementbbox.bottom < vh) {
        return "in viewport";
      }
      if (elementbbox.bottom >= vh / 2 && element) {
        return "past half";
      }
    }
  }, {
    key: "getHighlightedByScrollPos",
    value: function getHighlightedByScrollPos() {
      var segmentToHighlight = null;
      var segments = this.readerContentRef.current.querySelectorAll(".sheetItem");
      var _iterator = ReaderPanel_createForOfIteratorHelper(segments),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var segment = _step.value;
          var elementLoc = this.whereIsElementInViewport(segment);
          if (elementLoc === "in viewport" || elementLoc === "past half") {
            segmentToHighlight = segment;
            break;
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return segmentToHighlight;
    }
  }, {
    key: "openSidePanel",
    value: function openSidePanel() {
      var highlighted = this.getHighlightedByScrollPos();
      highlighted.click();
    }
  }, {
    key: "render",
    value: function render() {
      var _this3 = this;
      if (this.state.error) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          ref: this.readerContentRef,
          className: "readerContent"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "readerError"
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "int-en"
        }, "Something went wrong! Please use the back button or the menus above to get back on track."), /*#__PURE__*/external_react_default().createElement("span", {
          className: "int-he"
        }, "\u05D0\u05E8\u05E2\u05D4 \u05EA\u05E7\u05DC\u05D4 \u05D1\u05DE\u05E2\u05E8\u05DB\u05EA. \u05D0\u05E0\u05D0 \u05D7\u05D6\u05E8\u05D5 \u05DC\u05EA\u05E4\u05E8\u05D9\u05D8 \u05D4\u05E8\u05D0\u05E9\u05D9 \u05D0\u05D5 \u05D0\u05D7\u05D5\u05E8\u05E0\u05D9\u05EA \u05E2\u05DC \u05D9\u05D3\u05D9 \u05E9\u05D9\u05DE\u05D5\u05E9 \u05D1\u05DB\u05E4\u05EA\u05D5\u05E8\u05D9 \u05D4\u05EA\u05E4\u05E8\u05D9\u05D8 \u05D0\u05D5 \u05D4\u05D7\u05D6\u05D5\u05E8."), /*#__PURE__*/external_react_default().createElement("div", {
          className: "readerErrorText"
        }, /*#__PURE__*/external_react_default().createElement("span", {
          className: "int-en"
        }, "Error Message: "), /*#__PURE__*/external_react_default().createElement("span", {
          className: "int-he"
        }, "\u05E9\u05D2\u05D9\u05D0\u05D4: "), this.state.error)));
      }
      var items = [];
      var menu = null;
      var contextContentLang = {
        "language": this.getContentLanguageOverride(this.state.settings.language, this.state.mode, this.state.menuOpen)
      };
      if (this.state.mode === "Text" || this.state.mode === "TextAndConnections") {
        var oref = sefaria.parseRef(this.state.refs[0]);
        var showHighlight = this.state.showHighlight || this.state.highlightedRefs.length > 1;
        var index = oref && oref.index ? sefaria.index(oref.index) : null;
        var _ref = index ? [index.title, index.heTitle] : [null, null],
          _ref2 = ReaderPanel_slicedToArray(_ref, 2),
          textColumnBookTitle = _ref2[0],
          heTextColumnBookTitle = _ref2[1];
        items.push( /*#__PURE__*/external_react_default().createElement(js_TextColumn, {
          panelPosition: this.props.panelPosition,
          srefs: this.state.refs.slice(),
          currVersions: this.state.currVersions,
          highlightedRefs: this.state.highlightedRefs,
          currentlyVisibleRef: this.state.currentlyVisibleRef,
          showHighlight: showHighlight,
          basetext: true,
          bookTitle: textColumnBookTitle,
          heBookTitle: heTextColumnBookTitle,
          withContext: true,
          loadLinks: true,
          prefetchNextPrev: true,
          multiPanel: this.props.multiPanel,
          mode: this.state.mode,
          settings: sefaria.util.clone(this.state.settings),
          hasSidebar: this.props.hasSidebar,
          interfaceLang: this.props.interfaceLang,
          setOption: this.setOption,
          showBaseText: this.showBaseText,
          updateTextColumn: this.updateTextColumn,
          onSegmentClick: this.handleBaseSegmentClick,
          onCitationClick: this.handleCitationClick,
          onNamedEntityClick: this.onNamedEntityClick,
          setTextListHighlight: this.setTextListHighlight,
          setCurrentlyVisibleRef: this.setCurrentlyVisibleRef,
          setSelectedWords: this.setSelectedWords,
          selectedWords: this.state.selectedWords,
          panelsOpen: this.props.panelsOpen,
          layoutWidth: this.props.layoutWidth,
          filter: this.state.filter,
          textHighlights: this.state.textHighlights,
          unsetTextHighlight: this.props.unsetTextHighlight,
          translationLanguagePreference: this.props.translationLanguagePreference,
          updateCurrVersionsToMatchAPIResult: this.updateCurrVersionsToMatchAPIResult,
          key: "".concat(textColumnBookTitle ? textColumnBookTitle : "empty", "-TextColumn")
        }));
      }
      if (this.state.mode === "Sheet" || this.state.mode === "SheetAndConnections") {
        items.push( /*#__PURE__*/external_react_default().createElement(js_Sheet, {
          nodeRef: this.sheetRef,
          adjustHighlightedAndVisible: this.adjustSheetHighlightedAndVisible,
          panelPosition: this.props.panelPosition,
          id: this.state.sheetID,
          key: "sheet-" + this.state.sheetID,
          multiPanel: this.props.multiPanel,
          highlightedNode: this.state.highlightedNode,
          highlightedRefsInSheet: this.state.highlightedRefsInSheet,
          scrollToHighlighted: this.state.scrollToHighlighted,
          onRefClick: this.handleCitationClick,
          onSegmentClick: this.handleSheetSegmentClick,
          onCitationClick: this.handleCitationClick,
          openSheet: this.openSheet,
          hasSidebar: this.props.hasSidebar,
          setSelectedWords: this.setSelectedWords,
          contentLang: this.state.settings.language,
          setDivineNameReplacement: this.props.setDivineNameReplacement,
          divineNameReplacement: this.props.divineNameReplacement
        }));
      }
      if (this.state.mode === "Connections" || this.state.mode === "TextAndConnections" || this.state.mode === "SheetAndConnections") {
        var langMode = this.props.masterPanelLanguage || this.state.settings.language;
        var data = this.currentData();
        var canEditText = data && (langMode === "hebrew" && data.heVersionStatus !== "locked" || langMode === "english" && data.versionStatus !== "locked" || sefaria.is_moderator && langMode !== "bilingual");
        items.push( /*#__PURE__*/external_react_default().createElement(ConnectionsPanel, {
          panelPosition: this.props.panelPosition,
          selectVersion: this.props.selectVersion,
          srefs: this.state.mode === "Connections" ? this.state.refs.slice() : this.state.highlightedRefs.slice(),
          filter: this.state.filter || [],
          mode: this.state.connectionsMode || "Resources",
          recentFilters: this.state.recentFilters,
          connectionsCategory: this.state.connectionsCategory,
          connectionData: this.state.connectionData,
          interfaceLang: this.props.interfaceLang,
          contentLang: this.state.settings.language,
          title: this.currentBook(),
          currentlyVisibleRef: this.state.currentlyVisibleRef,
          currVersions: this.state.currVersions,
          fullPanel: this.props.multiPanel,
          multiPanel: this.props.multiPanel,
          allOpenRefs: this.props.allOpenRefs,
          canEditText: canEditText,
          setFilter: this.setFilter,
          scrollPosition: this.state.sideScrollPosition || 0,
          setSideScrollPosition: this.props.setSideScrollPosition,
          toggleSignUpModal: this.props.toggleSignUpModal,
          setConnectionsMode: this.setConnectionsMode,
          setConnectionsCategory: this.setConnectionsCategory,
          webPagesFilter: this.state.webPagesFilter,
          setWebPagesFilter: this.setWebPagesFilter,
          nodeRef: this.state.nodeRef,
          closeConectionsInPanel: this.closeConnectionsInPanel,
          handleSheetClick: this.handleSheetClick,
          openNav: this.openMenu.bind(null, "navigation"),
          openDisplaySettings: this.openDisplaySettings,
          editNote: this.editNote,
          noteBeingEdited: this.state.noteBeingEdited,
          onTextClick: this.handleTextListClick,
          onCitationClick: this.handleCitationClick,
          openComparePanel: this.props.openComparePanel,
          closePanel: this.props.closePanel,
          selectedWords: this.state.selectedWords,
          sidebarSearchQuery: this.state.sidebarSearchQuery,
          onSidebarSearchClick: this.props.onSidebarSearchClick,
          selectedNamedEntity: this.state.selectedNamedEntity,
          selectedNamedEntityText: this.state.selectedNamedEntityText,
          clearSelectedWords: this.clearSelectedWords,
          clearNamedEntity: this.props.clearNamedEntity,
          setSidebarSearchQuery: this.props.setSidebarSearchQuery,
          masterPanelLanguage: this.props.masterPanelLanguage,
          masterPanelMode: this.props.initialState.mode === "SheetAndConnections" && this.props.multiPanel === false ? "Sheet" : this.props.masterPanelMode,
          masterPanelSheetId: this.props.initialState.mode === "SheetAndConnections" && this.props.multiPanel === false ? this.props.initialState.sheetID : this.props.masterPanelSheetId,
          versionFilter: this.state.versionFilter,
          recentVersionFilters: this.state.recentVersionFilters,
          setVersionFilter: this.setVersionFilter,
          viewExtendedNotes: this.props.viewExtendedNotes.bind(null, "Connections"),
          checkIntentTimer: this.props.checkIntentTimer,
          navigatePanel: this.props.navigatePanel,
          translationLanguagePreference: this.props.translationLanguagePreference,
          setDivineNameReplacement: this.props.setDivineNameReplacement,
          divineNameReplacement: this.props.divineNameReplacement,
          key: "connections"
        }));
      }
      if (this.state.menuOpen === "navigation") {
        var openNav = this.state.compare ? this.props.openComparePanel : this.openMenu.bind(null, "navigation");
        var openTextTOC = this.state.compare ? this.openCompareTextTOC : null;
        menu = /*#__PURE__*/external_react_default().createElement(js_TextsPage, {
          key: this.state.navigationCategories ? this.state.navigationCategories.join("-") : this.state.navigationTopicCategory ? this.state.navigationTopicCategory : "navHome",
          compare: this.state.compare,
          multiPanel: this.props.multiPanel,
          categories: this.state.navigationCategories || [],
          settings: this.state.settings,
          setCategories: this.setNavigationCategories,
          openTextTOC: openTextTOC,
          setOption: this.setOption,
          toggleLanguage: this.toggleLanguage,
          onCompareBack: this.props.closePanel,
          openSearch: this.openSearch,
          openDisplaySettings: this.openDisplaySettings,
          initialWidth: this.state.width,
          toggleSignUpModal: this.props.toggleSignUpModal
        });
      } else if (this.state.menuOpen === "sheet meta") {
        menu = /*#__PURE__*/external_react_default().createElement(js_SheetMetadata, {
          mode: this.state.menuOpen,
          toggleSignUpModal: this.props.toggleSignUpModal,
          interfaceLang: this.props.interfaceLang,
          close: this.closeSheetMetaData,
          id: this.state.sheetID,
          versionLanguage: this.state.versionLanguage,
          settingsLanguage: this.state.settings.language == "hebrew" ? "he" : "en",
          narrowPanel: !this.props.multiPanel,
          currentRef: this.state.currentlyVisibleRef,
          openNav: this.openMenu.bind(null, "navigation"),
          openDisplaySettings: this.openDisplaySettings,
          selectVersion: this.props.selectVersion,
          showBaseText: this.showBaseText
        });
      } else if (this.state.menuOpen === "text toc") {
        menu = /*#__PURE__*/external_react_default().createElement(BookPage, {
          tab: this.state.tab,
          setTab: this.setTab,
          mode: this.state.menuOpen,
          multiPanel: this.props.multiPanel,
          close: this.closeMenus,
          title: this.currentBook(),
          currVersions: this.state.currVersions,
          settingsLanguage: this.state.settings.language == "hebrew" ? "he" : "en",
          category: this.currentCategory(),
          narrowPanel: !this.props.multiPanel,
          currentRef: this.state.currentlyVisibleRef,
          openNav: this.openMenu.bind(null, "navigation"),
          openDisplaySettings: this.openDisplaySettings,
          selectVersion: this.props.selectVersion,
          viewExtendedNotes: this.props.viewExtendedNotes.bind(null, "toc"),
          showBaseText: this.showBaseText
        });
      } else if (this.state.menuOpen === "book toc") {
        var onCompareBack = function onCompareBack() {
          _this3.conditionalSetState({
            menuOpen: "navigation",
            navigationCategories: _this3.state.previousCategories
          });
        };
        menu = /*#__PURE__*/external_react_default().createElement(BookPage, {
          tab: this.state.tab,
          setTab: this.setTab,
          mode: this.state.menuOpen,
          multiPanel: this.props.multiPanel,
          close: this.closeMenus,
          title: this.state.bookRef,
          currVersions: this.state.currVersions,
          settingsLanguage: this.state.settings.language == "hebrew" ? "he" : "en",
          toggleLanguage: this.toggleLanguage,
          category: sefaria.index(this.state.bookRef).primary_category,
          currentRef: this.state.bookRef,
          compare: this.state.compare,
          onCompareBack: onCompareBack,
          narrowPanel: !this.props.multiPanel,
          key: this.state.bookRef,
          openDisplaySettings: this.openDisplaySettings,
          selectVersion: this.props.selectVersion,
          showBaseText: this.showBaseText,
          viewExtendedNotes: this.props.viewExtendedNotes.bind(null, "toc")
        });
      } else if (this.state.menuOpen === "extended notes" && this.state.mode !== "Connections") {
        menu = /*#__PURE__*/external_react_default().createElement(BookPage, {
          tab: this.state.tab,
          setTab: this.setTab,
          mode: this.state.menuOpen,
          interfaceLang: this.props.interfaceLang,
          close: this.closeMenus,
          title: this.state.bookRef ? this.state.bookRef : this.currentBook(),
          currVersions: this.state.currVersions,
          settingsLanguage: this.state.settings.language == "hebrew" ? "he" : "en",
          category: sefaria.index(this.state.bookRef) ? sefaria.index(this.state.bookRef).primary_category : this.currentCategory(),
          currentRef: this.state.bookRef ? this.state.bookRef : this.state.currentlyVisibleRef,
          narrowPanel: !this.props.multiPanel,
          openDisplaySettings: this.openDisplaySettings,
          selectVersion: this.props.selectVersion,
          showBaseText: this.showBaseText,
          backFromExtendedNotes: this.state.mode === "Connections" ? this.closeMenus : this.backFromExtendedNotes
        });
      } else if (this.state.menuOpen === "search" && this.state.searchQuery) {
        menu = /*#__PURE__*/external_react_default().createElement(js_SearchPage, {
          key: "searchPage",
          interfaceLang: this.props.interfaceLang,
          query: this.state.searchQuery,
          tab: this.state.searchTab,
          textSearchState: this.state.textSearchState,
          sheetSearchState: this.state.sheetSearchState,
          settings: sefaria.util.clone(this.state.settings),
          panelsOpen: this.props.panelsOpen,
          onResultClick: this.props.onSearchResultClick,
          openDisplaySettings: this.openDisplaySettings,
          toggleLanguage: this.toggleLanguage,
          close: this.props.closePanel,
          onQueryChange: this.props.onQueryChange,
          updateTab: this.props.updateSearchTab,
          updateAppliedFilter: this.props.updateSearchFilter,
          updateAppliedOptionField: this.props.updateSearchOptionField,
          updateAppliedOptionSort: this.props.updateSearchOptionSort,
          registerAvailableFilters: this.props.registerAvailableFilters,
          compare: this.state.compare
        });
      } else if (this.state.menuOpen === "topics") {
        if (this.state.navigationTopicCategory) {
          menu = /*#__PURE__*/external_react_default().createElement(TopicCategory, {
            topic: this.state.navigationTopicCategory,
            topicTitle: this.state.navigationTopicTitle,
            setTopic: this.setTopic,
            setNavTopic: this.setNavigationTopic,
            interfaceLang: this.props.interfaceLang,
            compare: this.state.compare,
            initialWidth: this.state.width,
            openDisplaySettings: this.openDisplaySettings,
            openSearch: this.openSearch
          });
        } else if (this.state.navigationTopic) {
          menu = /*#__PURE__*/external_react_default().createElement(TopicPage, {
            tab: this.state.tab,
            setTab: this.setTab,
            topic: this.state.navigationTopic,
            topicTitle: this.state.topicTitle,
            interfaceLang: this.props.interfaceLang,
            setTopic: this.setTopic,
            setNavTopic: this.setNavigationTopic,
            openTopics: this.openMenu.bind(null, "topics"),
            showBaseText: this.props.onNavTextClick || this.showBaseText,
            openNav: this.openMenu.bind(null, "navigation"),
            openSearch: this.openSearch,
            close: this.closeMenus,
            multiPanel: this.props.multiPanel,
            navHome: this.openMenu.bind(null, "navigation"),
            openDisplaySettings: this.openDisplaySettings,
            toggleSignUpModal: this.props.toggleSignUpModal,
            translationLanguagePreference: this.props.translationLanguagePreference,
            topicTestVersion: this.props.topicTestVersion,
            key: "TopicPage"
          });
        } else {
          menu = /*#__PURE__*/external_react_default().createElement(js_TopicsPage, {
            key: "TopicsPage",
            setNavTopic: this.setNavigationTopic,
            multiPanel: this.props.multiPanel,
            initialWidth: this.state.width
          });
        }
      } else if (this.state.menuOpen === "allTopics") {
        menu = /*#__PURE__*/external_react_default().createElement(js_TopicPageAll, {
          interfaceLang: this.props.interfaceLang,
          topicLetter: this.state.navigationTopicLetter,
          intiialWidth: this.state.width,
          setTopic: this.setTopic,
          openNav: this.openMenu.bind(null, "navigation"),
          close: this.closeMenus,
          multiPanel: this.props.multiPanel,
          toggleLanguage: this.toggleLanguage,
          navHome: this.openMenu.bind(null, "navigation"),
          openDisplaySettings: this.openDisplaySettings,
          key: "TopicPageAll"
        });
      } else if (this.state.menuOpen === "notifications") {
        menu = /*#__PURE__*/external_react_default().createElement(NotificationsPanel, {
          setUnreadNotificationsCount: this.props.setUnreadNotificationsCount,
          interfaceLang: this.props.interfaceLang
        });
      } else if (this.state.menuOpen === "collection") {
        menu = /*#__PURE__*/external_react_default().createElement(js_CollectionPage, {
          name: this.state.collectionName,
          setTab: this.setTab,
          tab: this.state.tab,
          slug: this.state.collectionSlug,
          tag: this.state.collectionTag,
          setCollectionTag: this.setCollectionTag,
          width: this.state.width,
          searchInCollection: this.props.searchInCollection,
          toggleLanguage: this.toggleLanguage,
          toggleSignUpModal: this.props.toggleSignUpModal,
          updateCollectionName: this.updateCollectionName,
          navHome: this.openMenu.bind(null, "navigation"),
          multiPanel: this.props.multiPanel,
          initialWidth: this.state.width,
          interfaceLang: this.props.interfaceLang
        });
      } else if (this.state.menuOpen === "collectionsPublic") {
        menu = /*#__PURE__*/external_react_default().createElement(js_PublicCollectionsPage, {
          multiPanel: this.props.multiPanel,
          initialWidth: this.state.width
        });
      } else if (this.state.menuOpen === "translationsPage") {
        menu = /*#__PURE__*/external_react_default().createElement(js_TranslationsPage, {
          translationsSlug: this.state.translationsSlug
        });
      } else if (this.state.menuOpen === "community") {
        menu = /*#__PURE__*/external_react_default().createElement(js_CommunityPage, {
          multiPanel: this.props.multiPanel,
          toggleSignUpModal: this.props.toggleSignUpModal,
          initialWidth: this.state.width
        });
      } else if (this.state.menuOpen === "updates") {
        menu = /*#__PURE__*/external_react_default().createElement(js_UpdatesPanel, {
          interfaceLang: this.props.interfaceLang,
          multiPanel: this.props.multiPanel,
          navHome: this.openMenu.bind(null, "navigation")
        });
      } else if (this.state.menuOpen === "user_stats") {
        menu = /*#__PURE__*/external_react_default().createElement(js_UserStats, null);
      } else if (this.state.menuOpen === "modtools") {
        menu = /*#__PURE__*/external_react_default().createElement(js_ModeratorToolsPanel, {
          interfaceLang: this.props.interfaceLang
        });
      } else if (this.state.menuOpen === "saved" || this.state.menuOpen === "history") {
        menu = /*#__PURE__*/external_react_default().createElement(js_UserHistoryPanel, {
          multiPanel: this.props.multiPanel,
          menuOpen: this.state.menuOpen,
          openMenu: this.openMenu,
          openNav: this.openMenu.bind(null, "navigation"),
          openDisplaySettings: this.openDisplaySettings,
          toggleLanguage: this.toggleLanguage,
          compare: this.state.compare,
          toggleSignUpModal: this.props.toggleSignUpModal
        });
      } else if (this.state.menuOpen === "profile") {
        menu = /*#__PURE__*/external_react_default().createElement(js_UserProfile, {
          profile: this.state.profile,
          tab: this.state.tab,
          setTab: this.setTab,
          toggleSignUpModal: this.props.toggleSignUpModal,
          multiPanel: this.props.multiPanel,
          navHome: this.openMenu.bind(null, "navigation")
        });
      } else if (this.state.menuOpen === "calendars") {
        menu = /*#__PURE__*/external_react_default().createElement(js_CalendarsPage, {
          multiPanel: this.props.multiPanel,
          initialWidth: this.state.width
        });
      }
      var classes = {
        readerPanel: 1,
        serif: 1,
        narrowColumn: this.state.width < 730
      };
      classes[contextContentLang.language] = 1;
      classes[this.currentLayout()] = 1;
      classes[this.state.settings.color] = 1;
      classes = external_classnames_default()(classes);
      var style = {
        "fontSize": this.state.settings.fontSize + "%"
      };
      var sheet = sefaria.sheets.loadSheetByID(this.state.sheetID);
      var sheetTitle = !!sheet ? sheet.title.stripHtmlConvertLineBreaks() : null;
      var hideReaderControls = this.state.mode === "TextAndConnections" || this.state.menuOpen || this.props.hideNavHeader;
      return /*#__PURE__*/external_react_default().createElement(ContentLanguageContext.Provider, {
        value: contextContentLang
      }, /*#__PURE__*/external_react_default().createElement("div", {
        ref: this.readerContentRef,
        className: classes,
        onKeyDown: this.handleKeyPress,
        role: "region",
        id: "panel-" + this.props.panelPosition
      }, hideReaderControls ? null : /*#__PURE__*/external_react_default().createElement(ReaderControls, {
        showBaseText: this.showBaseText,
        hasSidebar: this.state.hasSidebar,
        toggleSheetEditMode: this.toggleSheetEditMode,
        currentRef: this.state.currentlyVisibleRef,
        highlightedRefs: this.state.highlightedRefs,
        sheetID: this.state.sheetID,
        sheetTitle: sheetTitle,
        currentMode: this.currentMode.bind(this),
        currentCategory: this.currentCategory,
        currentBook: this.currentBook.bind(this),
        currVersions: this.state.currVersions,
        multiPanel: this.props.multiPanel,
        settings: this.state.settings,
        setOption: this.setOption,
        setConnectionsMode: this.setConnectionsMode,
        setConnectionsCategory: this.setConnectionsCategory,
        openMenu: this.openMenu,
        closeMenus: this.closeMenus,
        onTextTitleClick: this.handleBaseSegmentClick,
        onSheetTitleClick: this.handleSheetSegmentClick,
        openMobileNavMenu: this.props.openMobileNavMenu,
        openDisplaySettings: this.openDisplaySettings,
        currentLayout: this.currentLayout,
        onError: this.onError,
        openSidePanel: this.openSidePanel,
        connectionsMode: this.state.filter.length && this.state.connectionsMode === "Connections" ? "Connection Text" : this.state.connectionsMode,
        connectionsCategory: this.state.connectionsCategory,
        closePanel: this.props.closePanel,
        toggleLanguage: this.toggleLanguage,
        interfaceLang: this.props.interfaceLang,
        toggleSignUpModal: this.props.toggleSignUpModal,
        historyObject: this.props.getHistoryObject(this.state, this.props.hasSidebar),
        connectionData: this.state.connectionData,
        translationLanguagePreference: this.props.translationLanguagePreference,
        setTranslationLanguagePreference: this.props.setTranslationLanguagePreference
      }), items.length > 0 && !menu ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerContent",
        style: style
      }, items) : null, menu, this.state.displaySettingsOpen ? /*#__PURE__*/external_react_default().createElement(ReaderDisplayOptionsMenu, {
        settings: this.state.settings,
        multiPanel: this.props.multiPanel,
        setOption: this.setOption,
        parentPanel: this.props.initialState.mode,
        currentLayout: this.currentLayout,
        currentBook: this.currentBook,
        currentData: this.currentData,
        width: this.state.width,
        menuOpen: this.state.menuOpen
      }) : null, this.state.displaySettingsOpen ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "mask",
        onClick: this.closeDisplaySettings
      }) : null));
    }
  }]);
  return ReaderPanel;
}((external_react_class_default()));
ReaderPanel.propTypes = {
  initialState: (external_prop_types_default()).object,
  interfaceLang: (external_prop_types_default()).string,
  setCentralState: (external_prop_types_default()).func,
  onSegmentClick: (external_prop_types_default()).func,
  onCitationClick: (external_prop_types_default()).func,
  openNamedEntityInNewPanel: (external_prop_types_default()).func,
  onNavTextClick: (external_prop_types_default()).func,
  onSearchResultClick: (external_prop_types_default()).func,
  onUpdate: (external_prop_types_default()).func,
  onError: (external_prop_types_default()).func,
  closePanel: (external_prop_types_default()).func,
  closeMenus: (external_prop_types_default()).func,
  setConnectionsFilter: (external_prop_types_default()).func,
  setSideScrollPosition: (external_prop_types_default()).func,
  setDefaultOption: (external_prop_types_default()).func,
  selectVersion: (external_prop_types_default()).func,
  viewExtendedNotes: (external_prop_types_default()).func,
  backFromExtendedNotes: (external_prop_types_default()).func,
  unsetTextHighlight: (external_prop_types_default()).func,
  onQueryChange: (external_prop_types_default()).func,
  updateSearchTab: (external_prop_types_default()).func,
  updateSearchFilter: (external_prop_types_default()).func,
  updateSearchOptionField: (external_prop_types_default()).func,
  updateSearchOptionSort: (external_prop_types_default()).func,
  registerAvailableFilters: (external_prop_types_default()).func,
  searchInCollection: (external_prop_types_default()).func,
  openComparePanel: (external_prop_types_default()).func,
  setUnreadNotificationsCount: (external_prop_types_default()).func,
  highlightedRefs: (external_prop_types_default()).array,
  multiPanel: (external_prop_types_default()).bool,
  masterPanelLanguage: (external_prop_types_default()).string,
  panelsOpen: (external_prop_types_default()).number,
  allOpenRefs: (external_prop_types_default()).array,
  hasSidebar: (external_prop_types_default()).bool,
  layoutWidth: (external_prop_types_default()).number,
  setTextListHighlight: (external_prop_types_default()).func,
  setSelectedWords: (external_prop_types_default()).func,
  analyticsInitialized: (external_prop_types_default()).bool,
  setVersionFilter: (external_prop_types_default()).func,
  saveLastPlace: (external_prop_types_default()).func,
  setDivineNameReplacement: (external_prop_types_default()).func,
  checkIntentTimer: (external_prop_types_default()).func,
  toggleSignUpModal: (external_prop_types_default()).func.isRequired,
  getHistoryRef: (external_prop_types_default()).func,
  profile: (external_prop_types_default()).object,
  masterPanelMode: (external_prop_types_default()).string,
  masterPanelSheetId: (external_prop_types_default()).number,
  translationLanguagePreference: (external_prop_types_default()).string,
  setTranslationLanguagePreference: (external_prop_types_default()).func.isRequired,
  topicTestVersion: (external_prop_types_default()).string
};
var ReaderControls = /*#__PURE__*/function (_Component2) {
  ReaderPanel_inherits(ReaderControls, _Component2);
  var _super2 = ReaderPanel_createSuper(ReaderControls);
  // The Header of a Reader panel when looking at a text
  // contains controls for display, navigation etc.
  function ReaderControls(props) {
    var _this4;
    ReaderPanel_classCallCheck(this, ReaderControls);
    _this4 = _super2.call(this, props);
    _this4.state = {
      displayVersionTitle: {} // lang codes as keys and version title to display in header as values. prefers shortVersionTitle when available but falls back on versionTitle
    };
    return _this4;
  }
  ReaderPanel_createClass(ReaderControls, [{
    key: "openTextConnectionsPanel",
    value: function openTextConnectionsPanel(e) {
      e.preventDefault();
      if (!this.props.hasSidebar) {
        //Prevent click on title from opening connections panel if its already open
        sefaria.track.event("Reader", "Open Connections Panel from Header", this.props.currentRef);
        this.props.onTextTitleClick(this.props.currentRef, false);
      }
    }
  }, {
    key: "openSheetConnectionsPanel",
    value: function openSheetConnectionsPanel(e) {
      e.preventDefault();
      this.props.onSheetTitleClick(0);
    }
  }, {
    key: "shouldShowVersion",
    value: function shouldShowVersion(props) {
      props = props || this.props;
      // maybe one day sheets will have versions (e.g Nachama) but for now, let's ignore that possibility
      return !props.sheetID && (props.settings.language === "english" || props.settings.language === "bilingual");
    }
  }, {
    key: "setDisplayVersionTitle",
    value: function setDisplayVersionTitle(version) {
      var en = version.shortVersionTitle || version.versionTitle;
      this.setState({
        displayVersionTitle: {
          en: en,
          he: version.shortVersionTitleInHebrew || en
        }
      });
    }
  }, {
    key: "loadTranslations",
    value: function loadTranslations() {
      var _this5 = this;
      /**
       * Preload translation versions to get shortVersionTitle to display
       */
      if (!this.shouldShowVersion()) {
        return;
      }
      sefaria.getTranslations(this.props.currentRef).then(function (versions) {
        var enVTitle = _this5.props.currVersions.enAPIResult;
        if (!enVTitle) {
          // merged version from API
          _this5.setDisplayVersionTitle({});
          return;
        }
        var _iterator2 = ReaderPanel_createForOfIteratorHelper(Object.values(versions).flat()),
          _step2;
        try {
          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
            var version = _step2.value;
            if (version.versionTitle === enVTitle) {
              _this5.setDisplayVersionTitle(version);
              break;
            }
          }
        } catch (err) {
          _iterator2.e(err);
        } finally {
          _iterator2.f();
        }
      });
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this6 = this;
      var title = this.props.currentRef;
      if (title) {
        // If we don't have this data yet, rerender when we do so we can set the Hebrew title
        var versionPref = sefaria.versionPreferences.getVersionPref(title);
        var getTextPromise = sefaria.getText(title, {
          context: 1,
          translationLanguagePreference: this.props.translationLanguagePreference,
          versionPref: versionPref
        }).then(function (data) {
          if ("error" in data) {
            _this6.props.onError(data.error);
          }
          _this6.setState({
            runningQuery: null
          }); // Causes re-render
        });

        this.setState({
          runningQuery: sefaria.makeCancelable(getTextPromise)
        });
      }
      this.loadTranslations();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      if (this.shouldShowVersion() !== this.shouldShowVersion(prevProps) || this.props.currVersions !== prevProps.currVersions) {
        this.loadTranslations();
      }
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      if (this.state.runningQuery) {
        this.state.runningQuery.cancel();
      }
    }
  }, {
    key: "stopPropagation",
    value: function stopPropagation(e) {
      e.stopPropagation();
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props$connectio;
      var title = this.props.currentRef || "";
      var heTitle = "";
      var sectionString = "";
      var heSectionString = "";
      var categoryAttribution = null;
      var oref = sefaria.getRefFromCache(this.props.currentRef);
      if (this.props.sheetID) {
        if (this.props.sheetTitle === null) {
          title = heTitle = sefaria._("Loading...");
        } else {
          title = heTitle = this.props.sheetTitle;
          if (title === "") {
            title = heTitle = sefaria._("Untitled");
          }
        }
      } else if (oref) {
        sectionString = oref.ref.replace(oref.indexTitle, "");
        heSectionString = oref.heRef.replace(oref.heIndexTitle, "");
        title = oref.indexTitle;
        heTitle = oref.heIndexTitle;
        categoryAttribution = oref && sefaria.categoryAttribution(oref.categories);
      }
      var mode = this.props.currentMode();
      var hideHeader = !this.props.multiPanel && mode === "Connections";
      var connectionsHeader = this.props.multiPanel && mode === "Connections";
      var displayVersionTitle = this.props.settings.language === 'hebrew' ? this.state.displayVersionTitle.he : this.state.displayVersionTitle.en;
      if (categoryAttribution && displayVersionTitle) {
        displayVersionTitle = "(".concat(displayVersionTitle, ")");
      }
      var url = this.props.sheetID ? "/sheets/" + this.props.sheetID : oref ? "/" + sefaria.normRef(oref.book) : sefaria.normRef(this.props.currentRef);
      var readerTextTocClasses = external_classnames_default()({
        readerTextToc: 1,
        attributed: !!categoryAttribution || this.shouldShowVersion(),
        connected: this.props.hasSidebar
      });
      var centerContent = connectionsHeader ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerTextToc"
      }, /*#__PURE__*/external_react_default().createElement(js_ConnectionsPanelHeader, {
        connectionsMode: this.props.connectionsMode,
        previousCategory: this.props.connectionsCategory,
        previousMode: (_this$props$connectio = this.props.connectionData) === null || _this$props$connectio === void 0 ? void 0 : _this$props$connectio.previousMode,
        multiPanel: this.props.multiPanel,
        setConnectionsMode: this.props.setConnectionsMode,
        setConnectionsCategory: this.props.setConnectionsCategory,
        closePanel: this.props.closePanel,
        toggleLanguage: this.props.toggleLanguage,
        interfaceLang: this.props.interfaceLang
      })) : /*#__PURE__*/external_react_default().createElement("div", {
        className: readerTextTocClasses,
        onClick: this.props.sheetID ? this.openSheetConnectionsPanel : this.openTextConnectionsPanel
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerTextTocBox" + (this.props.sheetID ? " sheetBox" : ""),
        role: "heading",
        "aria-level": "1",
        "aria-live": "polite"
      }, /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("a", {
        href: url,
        "aria-label": "Show Connection Panel contents for " + title
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerControlsTitle"
      }, this.props.sheetID ? /*#__PURE__*/external_react_default().createElement("img", {
        src: "/static/img/sheet.svg",
        className: "sheetTocIcon",
        alt: ""
      }) : null, this.props.sheetID ? /*#__PURE__*/external_react_default().createElement("h1", {
        style: {
          direction: sefaria.hebrew.isHebrew(title) ? "rtl" : "ltr"
        }
      }, title) : /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(ContentText, {
        text: {
          en: title,
          he: heTitle
        },
        defaultToInterfaceOnBilingual: true
      }), /*#__PURE__*/external_react_default().createElement("span", {
        className: "sectionString"
      }, /*#__PURE__*/external_react_default().createElement(ContentText, {
        text: {
          en: sectionString,
          he: heSectionString
        },
        defaultToInterfaceOnBilingual: true
      })))), /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerTextVersion"
      }, categoryAttribution ? /*#__PURE__*/external_react_default().createElement(CategoryAttribution, {
        categories: oref.categories,
        linked: false
      }) : null, this.shouldShowVersion() && displayVersionTitle ? /*#__PURE__*/external_react_default().createElement("span", {
        className: "readerTextVersion"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "en"
      }, displayVersionTitle)) : null)))));
      var leftControls = hideHeader || connectionsHeader ? null : /*#__PURE__*/external_react_default().createElement("div", {
        className: "leftButtons"
      }, this.props.multiPanel ? /*#__PURE__*/external_react_default().createElement(CloseButton, {
        onClick: this.props.closePanel
      }) : null, this.props.multiPanel ? null : /*#__PURE__*/external_react_default().createElement(MenuButton, {
        onClick: this.props.openMobileNavMenu
      }), /*#__PURE__*/external_react_default().createElement(SaveButton, {
        placeholder: true
      }));
      var rightControls = hideHeader || connectionsHeader ? null : /*#__PURE__*/external_react_default().createElement("div", {
        className: "rightButtons"
      }, /*#__PURE__*/external_react_default().createElement(SaveButton, {
        historyObject: this.props.historyObject,
        tooltip: true,
        toggleSignUpModal: this.props.toggleSignUpModal
      }), /*#__PURE__*/external_react_default().createElement(DisplaySettingsButton, {
        onClick: this.props.openDisplaySettings
      }));
      var transLangPrefSuggBann = hideHeader || connectionsHeader ? null : /*#__PURE__*/external_react_default().createElement(TranslationLanguagePreferenceSuggestionBanner, {
        setTranslationLanguagePreference: this.props.setTranslationLanguagePreference
      });
      var classes = external_classnames_default()({
        readerControls: 1,
        connectionsHeader: mode == "Connections",
        fullPanel: this.props.multiPanel,
        sheetReaderControls: !!this.props.sheetID
      });
      var readerControls = hideHeader ? null : /*#__PURE__*/external_react_default().createElement("header", {
        className: classes
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "readerControlsInner"
      }, leftControls, centerContent, rightControls));
      return /*#__PURE__*/external_react_default().createElement("div", null, connectionsHeader ? null : /*#__PURE__*/external_react_default().createElement(CategoryColorLine, {
        category: this.props.currentCategory()
      }), readerControls, transLangPrefSuggBann);
    }
  }]);
  return ReaderControls;
}((external_react_class_default()));
ReaderControls.propTypes = {
  settings: (external_prop_types_default()).object.isRequired,
  showBaseText: (external_prop_types_default()).func.isRequired,
  setOption: (external_prop_types_default()).func.isRequired,
  setConnectionsMode: (external_prop_types_default()).func.isRequired,
  setConnectionsCategory: (external_prop_types_default()).func.isRequired,
  openMenu: (external_prop_types_default()).func.isRequired,
  openDisplaySettings: (external_prop_types_default()).func.isRequired,
  openMobileNavMenu: (external_prop_types_default()).func.isRequired,
  closeMenus: (external_prop_types_default()).func.isRequired,
  currentMode: (external_prop_types_default()).func.isRequired,
  currentCategory: (external_prop_types_default()).func.isRequired,
  currentBook: (external_prop_types_default()).func.isRequired,
  currentLayout: (external_prop_types_default()).func.isRequired,
  onError: (external_prop_types_default()).func.isRequired,
  closePanel: (external_prop_types_default()).func,
  toggleLanguage: (external_prop_types_default()).func,
  currentRef: (external_prop_types_default()).string,
  currVersions: (external_prop_types_default()).object,
  connectionsMode: (external_prop_types_default()).string,
  connectionsCategory: (external_prop_types_default()).string,
  multiPanel: (external_prop_types_default()).bool,
  openSidePanel: (external_prop_types_default()).func.isRequired,
  interfaceLang: (external_prop_types_default()).string,
  toggleSignUpModal: (external_prop_types_default()).func.isRequired,
  historyObject: (external_prop_types_default()).object,
  setTranslationLanguagePreference: (external_prop_types_default()).func.isRequired
};
var TranslationLanguagePreferenceSuggestionBanner = function TranslationLanguagePreferenceSuggestionBanner(_ref3) {
  var setTranslationLanguagePreference = _ref3.setTranslationLanguagePreference;
  var _useState = (0,external_react_.useState)(false),
    _useState2 = ReaderPanel_slicedToArray(_useState, 2),
    accepted = _useState2[0],
    setAccepted = _useState2[1];
  var _useState3 = (0,external_react_.useState)(false),
    _useState4 = ReaderPanel_slicedToArray(_useState3, 2),
    closed = _useState4[0],
    setClosed = _useState4[1];
  var cookie = sefaria._inBrowser ? sefariaJquery.cookie : sefaria.util.cookie;
  var translation_language_preference_suggestion = sefaria.translation_language_preference_suggestion;
  if (closed || !accepted && cookie("translation_language_preference_suggested") || !translation_language_preference_suggestion) {
    return null;
  }
  var closeBanner = function closeBanner() {
    setClosed(true);
    cookie("translation_language_preference_suggested", JSON.stringify(1), {
      path: "/"
    });
    sefaria.editProfileAPI({
      settings: {
        translation_language_preference_suggested: true
      }
    });
  };
  var accept = function accept() {
    setAccepted(true);
    setTranslationLanguagePreference(translation_language_preference_suggestion);
  };
  var lang = sefaria.translateISOLanguageCode(translation_language_preference_suggestion);
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerControls transLangPrefSuggBann"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "readerControlsInner transLangPrefSuggBannInner sans-serif"
  }, accepted ? /*#__PURE__*/external_react_default().createElement("div", {
    className: "transLangPrefCentered"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, " Thanks! We'll show you ", lang, " translations first when we have them. "), /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05EA\u05D5\u05D3\u05D4! \u05DB\u05E9\u05E0\u05D5\u05DB\u05DC, \u05E0\u05E6\u05D9\u05D2 \u05DC\u05DB\u05DD \u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD \u05D1\u05E9\u05E4\u05D4 \u05D4", /*#__PURE__*/external_react_default().createElement("span", {
    className: "bold"
  }, sefaria._(lang)), " \u05DB\u05D0\u05E9\u05E8 \u05D0\u05DC\u05D5 \u05D9\u05D4\u05D9\u05D5 \u05D6\u05DE\u05D9\u05E0\u05D9\u05DD. "))) : /*#__PURE__*/external_react_default().createElement("div", {
    className: "transLangPrefCentered"
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, /*#__PURE__*/external_react_default().createElement(EnglishText, null, " Prefer to see ", /*#__PURE__*/external_react_default().createElement("span", {
    className: "bold"
  }, " ", lang, " "), " translations when available? "), /*#__PURE__*/external_react_default().createElement(HebrewText, null, "\u05D4\u05D0\u05DD \u05EA\u05E2\u05D3\u05D9\u05E4\u05D5 \u05DC\u05E8\u05D0\u05D5\u05EA \u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD \u05D1\u05E9\u05E4\u05D4 \u05D4", /*#__PURE__*/external_react_default().createElement("span", {
    className: "bold"
  }, sefaria._(lang)), " \u05DB\u05D0\u05E9\u05E8 \u05D4\u05DD \u05D6\u05DE\u05D9\u05E0\u05D9\u05DD?")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "yesNoGroup"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    className: "yesNoButton",
    onClick: accept
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Yes")), /*#__PURE__*/external_react_default().createElement("a", {
    className: "yesNoButton",
    onClick: closeBanner
  }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "No")))), /*#__PURE__*/external_react_default().createElement(CloseButton, {
    onClick: closeBanner
  })));
};
var ReaderDisplayOptionsMenu = /*#__PURE__*/function (_Component3) {
  ReaderPanel_inherits(ReaderDisplayOptionsMenu, _Component3);
  var _super3 = ReaderPanel_createSuper(ReaderDisplayOptionsMenu);
  function ReaderDisplayOptionsMenu() {
    ReaderPanel_classCallCheck(this, ReaderDisplayOptionsMenu);
    return _super3.apply(this, arguments);
  }
  ReaderPanel_createClass(ReaderDisplayOptionsMenu, [{
    key: "renderAliyotToggle",
    value: function renderAliyotToggle() {
      var torah = ["Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy", "Onkelos Genesis", "Onkelos Exodus", "Onkelos Leviticus", "Onkelos Numbers", "Onkelos Deuteronomy"];
      return this.props.currentBook ? torah.includes(this.props.currentBook()) : false;
    }
  }, {
    key: "vowelToggleAvailability",
    value: function vowelToggleAvailability() {
      var data = this.props.currentData();
      if (!data) return 2;
      var sample = data["he"];
      while (Array.isArray(sample)) {
        sample = sample[0];
      }
      var vowels_re = /[\u05b0-\u05c3\u05c7]/g;
      var cantillation_re = /[\u0591-\u05af]/g;
      if (cantillation_re.test(sample)) {
        //console.log("all");
        return 0;
      } else if (vowels_re.test(sample)) {
        //console.log("partial");
        return 1;
      } else {
        //console.log("none");
        return 2;
      }
    }
  }, {
    key: "showLangaugeToggle",
    value: function showLangaugeToggle() {
      if (sefaria._siteSettings.TORAH_SPECIFIC) return true;
      var data = this.props.currentData();
      if (!data) return true; // Sheets don't have currentData, also show for now (4x todo)

      var hasHebrew = !!data.he.length;
      var hasEnglish = !!data.text.length;
      return !(hasHebrew && hasEnglish);
    }
  }, {
    key: "shouldPunctuationToggleRender",
    value: function shouldPunctuationToggleRender() {
      var _this$props$currentDa, _this$props, _this$props$currentDa2, _this$props$settings, _this$props$settings2;
      if (((_this$props$currentDa = (_this$props = this.props).currentData) === null || _this$props$currentDa === void 0 ? void 0 : (_this$props$currentDa2 = _this$props$currentDa.call(_this$props)) === null || _this$props$currentDa2 === void 0 ? void 0 : _this$props$currentDa2.primary_category) === "Talmud" && (((_this$props$settings = this.props.settings) === null || _this$props$settings === void 0 ? void 0 : _this$props$settings.language) === "hebrew" || ((_this$props$settings2 = this.props.settings) === null || _this$props$settings2 === void 0 ? void 0 : _this$props$settings2.language) === "bilingual")) {
        return true;
      } else {
        return false;
      }
    }
  }, {
    key: "render",
    value: function render() {
      var languageOptions = [{
        name: "english",
        content: "<span class='en'>A</span>",
        role: "radio",
        ariaLabel: "Show English Text"
      }, {
        name: "bilingual",
        content: "<span class='en'>A</span><span class='he'>א</span>",
        role: "radio",
        ariaLabel: "Show English & Hebrew Text"
      }, {
        name: "hebrew",
        content: "<span class='he'>א</span>",
        role: "radio",
        ariaLabel: "Show Hebrew Text"
      }];
      var languageToggle = this.showLangaugeToggle() ? /*#__PURE__*/external_react_default().createElement(ToggleSet, {
        ariaLabel: "Language toggle",
        label: sefaria._("Language"),
        name: "language",
        options: languageOptions,
        setOption: this.props.setOption,
        currentValue: this.props.settings.language
      }) : null;
      var layoutOptions = [{
        name: "continuous",
        fa: "align-justify",
        role: "radio",
        ariaLabel: "Show Text as a paragram"
      }, {
        name: "segmented",
        fa: "align-left",
        role: "radio",
        ariaLabel: "Show Text segmented"
      }];
      var biLayoutOptions = [{
        name: "stacked",
        content: "<img src='/static/img/stacked.png' alt='Stacked Language Toggle'/>",
        role: "radio",
        ariaLabel: "Show Hebrew & English Stacked"
      }, {
        name: "heLeft",
        content: "<img src='/static/img/backs.png' alt='Hebrew Left Toggle' />",
        role: "radio",
        ariaLabel: "Show Hebrew Text Left of English Text"
      }, {
        name: "heRight",
        content: "<img src='/static/img/faces.png' alt='Hebrew Right Toggle' />",
        role: "radio",
        ariaLabel: "Show Hebrew Text Right of English Text"
      }];
      var layoutToggle = this.props.settings.language !== "bilingual" ? this.props.parentPanel === "Sheet" ? null : /*#__PURE__*/external_react_default().createElement(ToggleSet, {
        ariaLabel: "text layout toggle",
        label: sefaria._("Layout"),
        name: "layout",
        options: layoutOptions,
        setOption: this.props.setOption,
        currentValue: this.props.currentLayout()
      }) : this.props.width > 500 ? /*#__PURE__*/external_react_default().createElement(ToggleSet, {
        ariaLabel: "bidirectional text layout toggle",
        label: sefaria._("Bilingual Layout"),
        name: "biLayout",
        options: biLayoutOptions,
        setOption: this.props.setOption,
        currentValue: this.props.currentLayout()
      }) : null;
      var colorOptions = [{
        name: "light",
        content: "",
        role: "radio",
        ariaLabel: "Toggle light mode"
      }, /*{name: "sepia", content: "", role: "radio", ariaLabel: "Toggle sepia mode" },*/
      {
        name: "dark",
        content: "",
        role: "radio",
        ariaLabel: "Toggle dark mode"
      }];
      var colorToggle = /*#__PURE__*/external_react_default().createElement(ToggleSet, {
        ariaLabel: "Color toggle",
        label: sefaria._("Color"),
        name: "color",
        separated: true,
        options: colorOptions,
        setOption: this.props.setOption,
        currentValue: this.props.settings.color
      });
      colorToggle = this.props.multiPanel ? null : colorToggle;
      var sizeOptions = [{
        name: "smaller",
        content: sefaria._("Aa"),
        role: "button",
        ariaLabel: sefaria._("Decrease font size")
      }, {
        name: "larger",
        content: sefaria._("Aa"),
        role: "button",
        ariaLabel: sefaria._("Increase font size")
      }];
      var sizeToggle = /*#__PURE__*/external_react_default().createElement(ToggleSet, {
        ariaLabel: "Increase/Decrease Font Size Buttons",
        label: sefaria._("Font Size"),
        name: "fontSize",
        options: sizeOptions,
        setOption: this.props.setOption,
        currentValue: null
      });
      var aliyahOptions = [{
        name: "aliyotOn",
        content: sefaria._("On"),
        role: "radio",
        ariaLabel: sefaria._("Show Parasha Aliyot")
      }, {
        name: "aliyotOff",
        content: sefaria._("Off"),
        role: "radio",
        ariaLabel: sefaria._("Hide Parasha Aliyot")
      }];
      var aliyahToggle = this.renderAliyotToggle() ? this.props.parentPanel == "Sheet" ? null : /*#__PURE__*/external_react_default().createElement(ToggleSet, {
        ariaLabel: "Toggle Aliyot",
        label: sefaria._("Aliyot"),
        name: "aliyotTorah",
        options: aliyahOptions,
        setOption: this.props.setOption,
        currentValue: this.props.settings.aliyotTorah
      }) : null;
      var vowelsOptions = [{
        name: "all",
        content: "<span class='he'>אָ֑</span>",
        role: "radio",
        ariaLabel: sefaria._("Show Vowels and Cantillation")
      }, {
        name: "partial",
        content: "<span class='he'>אָ</span>",
        role: "radio",
        ariaLabel: sefaria._("Show only vowel points")
      }, {
        name: "none",
        content: "<span class='he'>א</span>",
        role: "radio",
        ariaLabel: sefaria._("Show only consonantal text")
      }];
      var vowelToggle = null;
      if (!this.props.menuOpen) {
        var vowelOptionsSlice = this.vowelToggleAvailability();
        var vowelOptionsTitle = vowelOptionsSlice == 0 ? sefaria._("Vocalization") : sefaria._("Vowels");
        vowelsOptions = vowelsOptions.slice(vowelOptionsSlice);
        vowelToggle = this.props.settings.language !== "english" && vowelsOptions.length > 1 ? this.props.parentPanel == "Sheet" ? null : /*#__PURE__*/external_react_default().createElement(ToggleSet, {
          ariaLabel: "vowels and cantillation toggle",
          label: vowelOptionsTitle,
          name: "vowels",
          options: vowelsOptions,
          setOption: this.props.setOption,
          currentValue: this.props.settings.vowels
        }) : null;
      }
      var punctuationOptions = [{
        name: "punctuationOn",
        content: sefaria._("On"),
        role: "radio",
        ariaLabel: sefaria._("Show Punctuation")
      }, {
        name: "punctuationOff",
        content: sefaria._("Off"),
        role: "radio",
        ariaLabel: sefaria._("Hide Punctuation")
      }];
      var punctuationToggle = this.shouldPunctuationToggleRender() ? /*#__PURE__*/external_react_default().createElement(ToggleSet, {
        ariaLabel: "Punctuation Toggle",
        label: sefaria._("Punctuation"),
        name: "punctuationTalmud",
        options: punctuationOptions,
        setOption: this.props.setOption,
        currentValue: this.props.settings.punctuationTalmud
      }) : null;
      if (this.props.menuOpen === "search") {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "readerOptionsPanel",
          role: "dialog"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "readerOptionsPanelInner"
        }, languageToggle, sizeToggle));
      } else if (this.props.menuOpen) {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "readerOptionsPanel",
          role: "dialog"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "readerOptionsPanelInner"
        }, languageToggle));
      } else {
        return /*#__PURE__*/external_react_default().createElement("div", {
          className: "readerOptionsPanel",
          role: "dialog"
        }, /*#__PURE__*/external_react_default().createElement("div", {
          className: "readerOptionsPanelInner"
        }, languageToggle, layoutToggle, colorToggle, sizeToggle, aliyahToggle, vowelToggle, punctuationToggle));
      }
    }
  }]);
  return ReaderDisplayOptionsMenu;
}((external_react_class_default()));
ReaderDisplayOptionsMenu.propTypes = {
  setOption: (external_prop_types_default()).func.isRequired,
  currentLayout: (external_prop_types_default()).func.isRequired,
  currentBook: (external_prop_types_default()).func,
  currentData: (external_prop_types_default()).func,
  menuOpen: (external_prop_types_default()).string,
  multiPanel: (external_prop_types_default()).bool.isRequired,
  width: (external_prop_types_default()).number.isRequired,
  settings: (external_prop_types_default()).object.isRequired
};
/* harmony default export */ const js_ReaderPanel = (ReaderPanel);
;// CONCATENATED MODULE: ../static/js/EditCollectionPage.jsx
function EditCollectionPage_typeof(obj) { "@babel/helpers - typeof"; return EditCollectionPage_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, EditCollectionPage_typeof(obj); }
function EditCollectionPage_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function EditCollectionPage_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, EditCollectionPage_toPropertyKey(descriptor.key), descriptor); } }
function EditCollectionPage_createClass(Constructor, protoProps, staticProps) { if (protoProps) EditCollectionPage_defineProperties(Constructor.prototype, protoProps); if (staticProps) EditCollectionPage_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function EditCollectionPage_toPropertyKey(arg) { var key = EditCollectionPage_toPrimitive(arg, "string"); return EditCollectionPage_typeof(key) === "symbol" ? key : String(key); }
function EditCollectionPage_toPrimitive(input, hint) { if (EditCollectionPage_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (EditCollectionPage_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function EditCollectionPage_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) EditCollectionPage_setPrototypeOf(subClass, superClass); }
function EditCollectionPage_setPrototypeOf(o, p) { EditCollectionPage_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return EditCollectionPage_setPrototypeOf(o, p); }
function EditCollectionPage_createSuper(Derived) { var hasNativeReflectConstruct = EditCollectionPage_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = EditCollectionPage_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = EditCollectionPage_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return EditCollectionPage_possibleConstructorReturn(this, result); }; }
function EditCollectionPage_possibleConstructorReturn(self, call) { if (call && (EditCollectionPage_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return EditCollectionPage_assertThisInitialized(self); }
function EditCollectionPage_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function EditCollectionPage_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function EditCollectionPage_getPrototypeOf(o) { EditCollectionPage_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return EditCollectionPage_getPrototypeOf(o); }






var EditCollectionPage = /*#__PURE__*/function (_Component) {
  EditCollectionPage_inherits(EditCollectionPage, _Component);
  var _super = EditCollectionPage_createSuper(EditCollectionPage);
  function EditCollectionPage(props) {
    var _this;
    EditCollectionPage_classCallCheck(this, EditCollectionPage);
    _this = _super.call(this, props);
    _this.state = props.initialData || {
      name: null,
      description: null,
      websiteUrl: null,
      imageUrl: null,
      headerUrl: null,
      listed: false
    };
    return _this;
  }
  EditCollectionPage_createClass(EditCollectionPage, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      sefariaJquery(window).on("beforeunload", function () {
        if (this.changed) {
          return sefaria._("You have unsaved changes to your collection.");
        }
      }.bind(this));
    }
  }, {
    key: "handleImageChange",
    value: function handleImageChange(e) {
      var MAX_IMAGE_MB = 2;
      var MAX_IMAGE_SIZE = MAX_IMAGE_MB * 1024 * 1024;
      var idToField = {
        collectionHeader: "headerUrl",
        collectionImage: "imageUrl"
      };
      var field = idToField[e.target.id];
      var file = e.currentTarget.files[0];
      if (file.size > MAX_IMAGE_SIZE) {
        alert(sefaria._("Images must be smaller than ") + MAX_IMAGE_MB + "MB.");
        return;
      }
      var formData = new FormData();
      formData.append("file", e.currentTarget.files[0]);
      sefariaJquery.ajax({
        url: '/api/collections/upload',
        data: formData,
        type: 'POST',
        contentType: false,
        processData: false,
        success: function (data) {
          if ("error" in data) {
            alert(data.error);
            this.clearUploading(field);
          } else {
            var state = {};
            state[field] = data.url;
            this.setState(state);
            this.changed = true;
          }
        }.bind(this),
        fail: function fail() {
          alert(sefaria._("Unfortunately an error occurred uploading your file."));
          this.clearUploading(field);
        }
      });
      this.setUploading(field);
    }
  }, {
    key: "setUploading",
    value: function setUploading(field) {
      var state = {};
      state[field] = "/static/img/loading.gif";
      this.setState(state);
    }
  }, {
    key: "clearUploading",
    value: function clearUploading(field) {
      var state = {};
      state[field] = null;
      this.setState(state);
    }
  }, {
    key: "handleInputChange",
    value: function handleInputChange(e) {
      var idToField = {
        collectionName: "name",
        collectionWebsite: "websiteUrl",
        collectionDescription: "description"
      };
      var field = idToField[e.target.id];
      var state = {};
      state[field] = e.target.value;
      this.setState(state);
      this.changed = true;
    }
  }, {
    key: "handleListingChange",
    value: function handleListingChange(e) {
      this.setState({
        listed: !!e.target.checked
      });
    }
  }, {
    key: "delete",
    value: function _delete() {
      if (confirm(sefaria._("Are you sure you want to delete this collection? This cannot be undone."))) {
        sefariaJquery.ajax({
          url: "/api/collections/" + this.props.initialData.slug,
          type: "DELETE",
          success: function success(data) {
            if ("error" in data) {
              alert(data.error);
            } else {
              window.location = "/my/profile";
            }
          },
          fail: function fail() {
            alert(sefaria._("Unfortunately an error occurred deleting your collection."));
          }
        });
      }
    }
  }, {
    key: "save",
    value: function save() {
      var collectionData = sefaria.util.clone(this.state);
      if (collectionData["headerUrl"] == "/static/img/loading.gif") {
        collectionData["headerUrl"] = null;
      }
      if (collectionData["imageUrl"] == "/static/img/loading.gif") {
        collectionData["imageUrl"] = null;
      }
      sefariaJquery.post("/api/collections", {
        json: JSON.stringify(collectionData)
      }, function (data) {
        if ("error" in data) {
          alert(data.error);
        } else {
          this.changed = false;
          window.location = "/collections/" + data.collection.slug;
        }
      }.bind(this)).fail(function () {
        alert(sefaria._("Unfortunately an error occurred saving your collection."));
      });
    }
  }, {
    key: "render",
    value: function render() {
      var title = this.props.initialData ? "Edit Collection" : "Create a Collection";
      return /*#__PURE__*/external_react_default().createElement("div", {
        id: "editCollectionPage"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "headerWithButtons"
      }, /*#__PURE__*/external_react_default().createElement("div", {
        className: "start"
      }), /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, title)), /*#__PURE__*/external_react_default().createElement("div", {
        className: "end"
      }, /*#__PURE__*/external_react_default().createElement("a", {
        className: "button small transparent control-elem",
        href: this.props.initialData ? "/collections/" + this.state.slug : "/my/profile"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Cancel")), /*#__PURE__*/external_react_default().createElement("div", {
        id: "saveCollection",
        className: "button small blue control-elem",
        onClick: this.save
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Save")))), /*#__PURE__*/external_react_default().createElement("div", {
        className: "field halfWidth"
      }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Collection Name")), /*#__PURE__*/external_react_default().createElement("input", {
        id: "collectionName",
        value: this.state.name || "",
        onChange: this.handleInputChange
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "field halfWidth"
      }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Website")), /*#__PURE__*/external_react_default().createElement("input", {
        id: "collectionWebsite",
        value: this.state.websiteUrl || "",
        onChange: this.handleInputChange
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "field"
      }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Description")), /*#__PURE__*/external_react_default().createElement("textarea", {
        id: "collectionDescription",
        onChange: this.handleInputChange,
        value: this.state.description || ""
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "field"
      }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Collection Image")), this.state.imageUrl ? /*#__PURE__*/external_react_default().createElement("img", {
        className: "collectionImage",
        src: this.state.imageUrl,
        alt: "Collection Image"
      }) : /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionImage placeholder"
      }), /*#__PURE__*/external_react_default().createElement(FileInput, {
        name: "collectionImage",
        accept: "image/*",
        text: sefaria._("Upload Image"),
        className: "button white",
        onChange: this.handleImageChange
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "helperText"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Recommended size: 350px x 350px or larger"))), this.state.headerUrl ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "field"
      }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Default Sheet Header")), this.state.headerUrl ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionHeaderBox"
      }, /*#__PURE__*/external_react_default().createElement("img", {
        className: "collectionHeader",
        src: this.state.headerUrl,
        alt: "Collection Header Image"
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "clearFix"
      })) : /*#__PURE__*/external_react_default().createElement("div", {
        className: "collectionHeader placeholder"
      }), /*#__PURE__*/external_react_default().createElement(FileInput, {
        name: "collectionHeader",
        accept: "image/*",
        text: "Upload Image",
        className: "button white",
        onChange: this.handleImageChange
      }), /*#__PURE__*/external_react_default().createElement("div", {
        className: "helperText"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Recommended size: 1000px width to fill sheet, smaller images align right"))) : null, this.props.initialData ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "field"
      }, /*#__PURE__*/external_react_default().createElement("label", null, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "List on Sefaria")), this.state.moderationStatus !== "nolist" ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "onoffswitch"
      }, /*#__PURE__*/external_react_default().createElement("input", {
        type: "checkbox",
        name: "onoffswitch",
        className: "onoffswitch-checkbox",
        id: "collectionPublicToggle",
        checked: !!this.state.listed,
        onChange: this.handleListingChange
      }), /*#__PURE__*/external_react_default().createElement("label", {
        className: "onoffswitch-label",
        htmlFor: "collectionPublicToggle"
      }, /*#__PURE__*/external_react_default().createElement("span", {
        className: "onoffswitch-inner"
      }), /*#__PURE__*/external_react_default().createElement("span", {
        className: "onoffswitch-switch"
      })), /*#__PURE__*/external_react_default().createElement("div", {
        className: "helperText"
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Your collection will appear on the public collections page where others can find it."))) : /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-en"
      }, "Your collection was previously made public, but our moderators determined it was not generally useful for all Sefaria users. Please contact ", /*#__PURE__*/external_react_default().createElement("a", {
        href: "mailto:hello@sefari.org"
      }, "hello@sefaria.org"), " with any questions."), /*#__PURE__*/external_react_default().createElement("span", {
        className: "int-he"
      }, "\u05D4\u05D0\u05E1\u05D5\u05E4\u05D4 \u05E9\u05DC\u05DA \u05D4\u05D5\u05D2\u05D3\u05E8\u05D4 \u05DB\u05E6\u05D9\u05D1\u05D5\u05E8\u05D9\u05EA, \u05D0\u05DA \u05D4\u05DE\u05E0\u05D4\u05DC\u05D9\u05DD \u05E9\u05DC\u05E0\u05D5 \u05D4\u05D2\u05D9\u05E2\u05D5 \u05DC\u05DE\u05E1\u05E7\u05E0\u05D4 \u05E9\u05D4\u05D9\u05D0 \u05D0\u05D9\u05E0\u05D4 \u05E8\u05DC\u05D5\u05D5\u05E0\u05D8\u05D9\u05EA \u05DC\u05DB\u05DC\u05DC \u05DE\u05E9\u05EA\u05DE\u05E9\u05D9 \u05E1\u05E4\u05E8\u05D9\u05D0. \u05DC\u05E9\u05D0\u05DC\u05D5\u05EA \u05D9\u05E9 \u05DC\u05D9\u05E6\u05D5\u05E8 \u05E2\u05D9\u05DE\u05E0\u05D5 \u05E7\u05E9\u05E8 \u05D1\u05DB\u05EA\u05D5\u05D1\u05EA ", /*#__PURE__*/external_react_default().createElement("a", {
        href: "mailto:hello@sefari.org"
      }, "hello@sefaria.org"), "."))) : null, this.props.initialData ? /*#__PURE__*/external_react_default().createElement("div", {
        className: "deleteCollection",
        onClick: this["delete"]
      }, /*#__PURE__*/external_react_default().createElement(InterfaceText, null, "Delete Collection")) : null);
    }
  }]);
  return EditCollectionPage;
}((external_react_class_default()));
EditCollectionPage.propTypes = {
  initialData: (external_prop_types_default()).object // If present this view is for editing a collection, otherwise for creating a new collection
};
var FileInput = /*#__PURE__*/function (_Component2) {
  EditCollectionPage_inherits(FileInput, _Component2);
  var _super2 = EditCollectionPage_createSuper(FileInput);
  function FileInput() {
    EditCollectionPage_classCallCheck(this, FileInput);
    return _super2.apply(this, arguments);
  }
  EditCollectionPage_createClass(FileInput, [{
    key: "handleChange",
    value: function handleChange(e) {
      if (this.props.onChange) {
        this.props.onChange(e);
      }
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/external_react_default().createElement("div", null, /*#__PURE__*/external_react_default().createElement("label", {
        htmlFor: this.props.name,
        className: this.props.className
      }, this.props.text), /*#__PURE__*/external_react_default().createElement("input", {
        type: "file",
        id: this.props.name,
        name: this.props.name,
        className: "hiddenFileInput",
        accept: this.props.accept,
        onChange: this.handleChange
      }));
    }
  }]);
  return FileInput;
}((external_react_class_default()));
/* harmony default export */ const js_EditCollectionPage = (EditCollectionPage);
;// CONCATENATED MODULE: ../static/js/StaticPages.jsx
function StaticPages_slicedToArray(arr, i) { return StaticPages_arrayWithHoles(arr) || StaticPages_iterableToArrayLimit(arr, i) || StaticPages_unsupportedIterableToArray(arr, i) || StaticPages_nonIterableRest(); }
function StaticPages_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function StaticPages_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return StaticPages_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return StaticPages_arrayLikeToArray(o, minLen); }
function StaticPages_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function StaticPages_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function StaticPages_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }






/*  Templates:

        <Header
            enTitle=""
            enText=""
            enImg="/static/img/"
            enImgAlt=""
            enActionURL={null}
            enActionText={null}
            heTitle=""
            heText=""
            heImg="/static/img/"
            heImgAlt=""
            heActionURL={null}
            heActionText={null}
        />

        <H2Block
            en=""
            he=""
        />

        <EnBlock padded={true}>
            {Any content}
        </EnBlock

        <HeBlock padded={true}>
            {Any content}
        </HeBlock>

        <Feature
            enTitle=""
            enText=""
            enImg="/static/img/"
            enImgAlt=""
            heTitle=""
            heText=""
            heImg="/static/img/"
            heImgAlt=""
            borderColor="#"
        />

        <About
            enTitle=""
            heTitle=""
            enText=""
            heText=""
            backgroundColor=""
        />
 */

var ContestLandingPage = function ContestLandingPage() {
  return /*#__PURE__*/external_react_default().createElement(StaticPage, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Header, {
    enTitle: "Powered by Sefaria Contest",
    enText: "Advance the frontiers of tech and Torah this summer. Build something new using our free data or API.",
    enImg: "/static/img/contest-landing-page/codemockup3.png",
    enImgAlt: "",
    enActionURL: "#",
    enActionText: "Register to Join",
    heTitle: "\u05EA\u05D7\u05E8\u05D5\u05EA \u05E4\u05D9\u05EA\u05D5\u05D7 \u05EA\u05D5\u05DB\u05E0\u05D4",
    heText: "\u05D4\u05E6\u05D8\u05E8\u05E4\u05D5 \u05D0\u05DC\u05D9\u05E0\u05D5 \u05DC\u05D0\u05EA\u05D2\u05E8 \u05E9\u05D9\u05E7\u05D3\u05DD \u05D0\u05EA \u05EA\u05D7\u05D5\u05DD \u05D4\u05EA\u05D5\u05E8\u05D4 \u05D5\u05D4\u05D8\u05DB\u05E0\u05D5\u05DC\u05D5\u05D2\u05D9\u05D4 \u05D1\u05D1\u05E0\u05D9\u05D9\u05EA \u05EA\u05D5\u05E6\u05E8 \u05D9\u05E6\u05D9\u05E8\u05EA\u05D9 \u05D5\u05E2\u05E6\u05DE\u05D0\u05D9 \u05D1\u05E2\u05D6\u05E8\u05EA \u05D4\u05DE\u05D0\u05D2\u05E8 \u05D4\u05D7\u05D5\u05E4\u05E9\u05D9 \u05D5\u05DE\u05DE\u05E9\u05E7 \u05D4\u05BEAPI \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0.",
    heImg: "/static/img/contest-landing-page/codemockup3.png",
    heImgAlt: "",
    heActionURL: "#",
    heActionText: "\u05D4\u05E8\u05E9\u05DE\u05D4 \u05DC\u05EA\u05D7\u05E8\u05D5\u05EA"
  }), /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "The Contest",
    he: "\u05D4\u05EA\u05D7\u05E8\u05D5\u05EA"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Sefaria offers a free digital dataset of Jewish texts, translations, and interconnections that is open for anyone to reuse in novel ways. Last year, we received over 50 innovative Powered by Sefaria projects using our open data or API (", /*#__PURE__*/external_react_default().createElement("a", {
    href: "/powered-by-sefaria-contest-2020"
  }, "see the winners and honorable mentions!"), "). We\u2019re eager to see what else our community can dream up to advance the frontiers of Torah and technology in this year\u2019s contest!"), /*#__PURE__*/external_react_default().createElement("p", null, "What you create is up to you. It could be a functioning web app or just a compelling demo; an interactive visualization, or just a question that digs into data quantitatively in search of an answer; something useful and impactful to the world of learning, or just a crazy experiment that fascinates you without a clear application. ", /*#__PURE__*/external_react_default().createElement("b", null, "The only requirement is that your project must prominently make use of the data that Sefaria has to offer"), "."), /*#__PURE__*/external_react_default().createElement("p", null, "To get your ideas flowing, here are three great examples from last year\u2019s Powered by Sefaria contest. You can find dozens more projects on our ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "https://github.com/Sefaria/Sefaria-Project/wiki/Projects-Powered-by-Sefaria"
  }, "Powered by Sefaria list"), " on GitHub and on the ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "https://www.sefaria.org/powered-by-sefaria-contest-2020"
  }, "Powered by Sefaria 2020 Winners & Honorable Mentions page"), ".")), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\u05E1\u05E4\u05E8\u05D9\u05D0 \u05DE\u05E6\u05D9\u05E2\u05D4 \u05DC\u05E6\u05D9\u05D1\u05D5\u05E8 \u05DE\u05E1\u05D3 \u05E0\u05EA\u05D5\u05E0\u05D9\u05DD \u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9 \u05D5\u05D7\u05D5\u05E4\u05E9\u05D9 \u05E9\u05DC \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD, \u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD \u05D5\u05E7\u05D9\u05E9\u05D5\u05E8\u05D9\u05DD \u05D1\u05D9\u05DF\u05BE\u05D8\u05E7\u05E1\u05D8\u05D5\u05D0\u05DC\u05D9\u05D9\u05DD.  \u05D1\u05E9\u05E0\u05D4 \u05E9\u05E2\u05D1\u05E8\u05D4 \u05D4\u05D2\u05D9\u05E2\u05D5 \u05DC\u05E4\u05EA\u05D7\u05E0\u05D5 \u05D9\u05D5\u05EA\u05E8 \u05DE\u05BE50 \u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05D7\u05D3\u05E9\u05E0\u05D9\u05D9\u05DD \u05E9\u05D4\u05E9\u05EA\u05DE\u05E9\u05D5 \u05D1\u05DE\u05E1\u05D3 \u05D4\u05E0\u05EA\u05D5\u05E0\u05D9\u05DD \u05D4\u05E4\u05EA\u05D5\u05D7  \u05D0\u05D5 \u05D1\u05BEAPI \u05E9\u05DC\u05E0\u05D5 (", /*#__PURE__*/external_react_default().createElement("a", {
    href: "/powered-by-sefaria-contest-2020"
  }, "\u05E8\u05D0\u05D5 \u05D0\u05EA \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05D4\u05D6\u05D5\u05DB\u05D9\u05DD \u05D5\u05D0\u05EA \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E9\u05D6\u05DB\u05D5 \u05DC\u05D4\u05E2\u05E8\u05DB\u05D4 \u05DE\u05D9\u05D5\u05D7\u05D3\u05EA"), "). \u05D0\u05E0\u05D5 \u05DE\u05DC\u05D0\u05D9 \u05E6\u05D9\u05E4\u05D9\u05D9\u05D4 \u05DC\u05E8\u05D0\u05D5\u05EA \u05DE\u05D4 \u05E2\u05D5\u05D3 \u05DE\u05E1\u05D5\u05D2\u05DC\u05EA \u05D4\u05E7\u05D4\u05D9\u05DC\u05D4 \u05E9\u05DC\u05E0\u05D5 \u05DC\u05E2\u05E9\u05D5\u05EA \u05DB\u05D3\u05D9 \u05DC\u05D7\u05E6\u05D5\u05EA \u05D0\u05EA \u05D4\u05D2\u05D1\u05D5\u05DC\u05D5\u05EA \u05D4\u05DE\u05D5\u05DB\u05E8\u05D9\u05DD \u05E9\u05DC \u05D4\u05EA\u05D5\u05E8\u05D4 \u05D5\u05D4\u05D8\u05DB\u05E0\u05D5\u05DC\u05D5\u05D2\u05D9\u05D4?"), /*#__PURE__*/external_react_default().createElement("p", null, "\u05D4\u05DE\u05D9\u05D6\u05DD \u05EA\u05DC\u05D5\u05D9 \u05E8\u05E7 \u05D1\u05DB\u05DD: \u05D6\u05D4 \u05D9\u05DB\u05D5\u05DC \u05DC\u05D4\u05D9\u05D5\u05EA \u05D9\u05D9\u05E9\u05D5\u05DE\u05D5\u05DF \u05E8\u05E9\u05EA \u05E4\u05E2\u05D9\u05DC \u05D0\u05D5 \u05D3\u05DE\u05D5 \u05DE\u05E9\u05DB\u05E0\u05E2; \u05D5\u05D9\u05D6\u05D5\u05D0\u05DC\u05D9\u05D6\u05E6\u05D9\u05D4 \u05D0\u05D9\u05E0\u05D8\u05E8\u05D0\u05E7\u05D8\u05D9\u05D1\u05D9\u05EA \u05D0\u05D5 \u05E9\u05D0\u05DC\u05D4 \u05E9\u05D9\u05D5\u05E8\u05D3\u05EA \u05DC\u05E2\u05D5\u05DE\u05E7\u05DD \u05E9\u05DC \u05D4\u05E0\u05EA\u05D5\u05E0\u05D9\u05DD \u05D4\u05DB\u05DE\u05D5\u05EA\u05D9\u05D9\u05DD \u05E9\u05DC \u05D4\u05DE\u05E2\u05E8\u05DB\u05EA; \u05DB\u05DC\u05D9 \u05E9\u05D9\u05DE\u05D5\u05E9\u05D9 \u05D5\u05D9\u05E2\u05D9\u05DC \u05DC\u05E2\u05D5\u05DC\u05DD \u05D4\u05DC\u05D9\u05DE\u05D5\u05D3 \u05D0\u05D5 \u05E0\u05D9\u05E1\u05D5\u05D9 \u05DE\u05D3\u05DC\u05D9\u05E7 \u05DC\u05DC\u05D0 \u05EA\u05D5\u05E6\u05E8 \u05D1\u05E8\u05D5\u05E8 \u05E9\u05E4\u05E9\u05D5\u05D8 \u05DE\u05E8\u05EA\u05E7 \u05D0\u05EA\u05DB\u05DD. ", /*#__PURE__*/external_react_default().createElement("b", null, "\u05D4\u05D3\u05E8\u05D9\u05E9\u05D4 \u05D4\u05D9\u05D7\u05D9\u05D3\u05D4 \u05D4\u05D9\u05D0 \u05E9\u05D1\u05DE\u05D9\u05D6\u05DD \u05D9\u05D9\u05E2\u05E9\u05D4 \u05E9\u05D9\u05DE\u05D5\u05E9 \u05DE\u05D5\u05D1\u05D4\u05E7 \u05D1\u05DE\u05E1\u05D3 \u05D4\u05E0\u05EA\u05D5\u05E0\u05D9\u05DD \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0"), "."), /*#__PURE__*/external_react_default().createElement("p", null, "\u05DB\u05D3\u05D9 \u05DC\u05E2\u05D6\u05D5\u05E8 \u05DC\u05DB\u05DD \u05DC\u05D4\u05EA\u05D7\u05D9\u05DC \u05D4\u05D9\u05E0\u05D4 \u05E9\u05DC\u05D5\u05E9 \u05D3\u05D5\u05D2\u05DE\u05D0\u05D5\u05EA \u05DE\u05E2\u05D5\u05DC\u05D5\u05EA \u05DE\u05EA\u05D7\u05E8\u05D5\u05EA \u05E4\u05D9\u05EA\u05D5\u05D7 \u05D4\u05EA\u05D5\u05DB\u05E0\u05D4 \u05D1\u05E9\u05E0\u05D4 \u05E9\u05E2\u05D1\u05E8\u05D4. \u05D0\u05E4\u05E9\u05E8 \u05DC\u05DE\u05E6\u05D5\u05D0 \u05E2\u05E9\u05E8\u05D5\u05EA \u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05D0\u05D7\u05E8\u05D9\u05DD \u05D1\u05E8\u05E9\u05D9\u05DE\u05EA \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E9\u05DC \u05D4\u05EA\u05D7\u05E8\u05D5\u05EA \u05D1", /*#__PURE__*/external_react_default().createElement("a", {
    href: "https://github.com/Sefaria/Sefaria-Project/wiki/Projects-Powered-by-Sefaria"
  }, "\u05D2\u05D9\u05D8\u05D4\u05D0\u05D1"), " \u05D5\u05D1", /*#__PURE__*/external_react_default().createElement("a", {
    href: "/powered-by-sefaria-contest-2020"
  }, "\u05E2\u05DE\u05D5\u05D3 \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05D4\u05D6\u05D5\u05DB\u05D9\u05DD \u05D5\u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E9\u05D6\u05DB\u05D5 \u05DC\u05D4\u05E2\u05E8\u05DB\u05D4 \u05DE\u05D9\u05D5\u05D7\u05D3\u05EA \u05D1\u05EA\u05D7\u05E8\u05D5\u05EA \u05E4\u05D9\u05EA\u05D5\u05D7 \u05D4\u05EA\u05D5\u05DB\u05E0\u05D4 \u05DC\u05E9\u05E0\u05EA 2020"), ".")), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    white: true
  }, /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "https://www.youtube.com/watch?v=C6nMn4CLuEU",
    he_href: "https://www.youtube.com/watch?v=C6nMn4CLuEU",
    he: "\u05E1\u05E8\u05D2\u05DC \u05D4\u05DB\u05DC\u05D9\u05DD \u05E9\u05DC \u05D4\u05EA\u05DC\u05DE\u05D5\u05D3",
    en: "Talmud Sidebar Extension"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "https://www.youtube.com/watch?v=uB4In-Nc2WU",
    he_href: "https://www.youtube.com/watch?v=uB4In-Nc2WU",
    he: "\u05DE\u05D6\u05DE\u05D5\u05E8 \u05E9\u05D9\u05E8",
    en: "Mizmor Shir"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "https://jhostyk.github.io/SeferSimilarityMap/",
    he_href: "https://jhostyk.github.io/SeferSimilarityMap/",
    he: "\u05E1\u05E4\u05E8 \u2013 \u05DE\u05E4\u05EA \u05D3\u05DE\u05D9\u05D5\u05DF \u05D1\u05D9\u05DF \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD",
    en: "Sefer Similarity Map"
  })), /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Timeline and Prize",
    he: "\u05DC\u05D5\u05D7 \u05D6\u05DE\u05E0\u05D9\u05DD \u05D5\u05E4\u05E8\u05E1\u05D9\u05DD"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "The contest is open from Sunday, June 13th through Tuesday, August 31st. ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "https://sefaria.nationbuilder.com/contest2021"
  }, "Registered participants"), " will receive a form to submit their projects. The contest deliverable must be in the form of a URL where our judges can directly access your work. For many projects, this will be a running demo of an app on the web. For other projects, your URL may point to a description and summary of the work you've done, much like a poster for a research project presented at a conference. For desktop or mobile apps, you will need to host your app on a web-based emulator (like ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "https://appetize.io/"
  }, "Appetize.io"), ") so our judges can interact with it without downloading executables."), /*#__PURE__*/external_react_default().createElement("p", null, "A jury will select three projects to win cash prizes: $5,000 for the grand prize, $5,000 for the Women in Tech prize, and $3,600 for the youth prize."), /*#__PURE__*/external_react_default().createElement("p", null, "A selection of completed projects will also be featured on a contest page and shared with our community.")), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\u05D4\u05EA\u05D7\u05E8\u05D5\u05EA \u05EA\u05EA\u05D7\u05D9\u05DC \u05D1\u05D9\u05D5\u05DD \u05E8\u05E9\u05D5\u05DF, 13 \u05D1\u05D9\u05D5\u05E0\u05D9, \u05D5\u05EA\u05E1\u05EA\u05D9\u05D9\u05DD \u05D1\u05D9\u05D5\u05DD \u05E9\u05DC\u05D9\u05E9\u05D9, 31 \u05D1\u05D0\u05D5\u05D2\u05D5\u05E1\u05D8. ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "#"
  }, "\u05D4\u05DE\u05E9\u05EA\u05EA\u05E4\u05D9\u05DD \u05D5\u05D4\u05DE\u05E9\u05EA\u05EA\u05E4\u05D5\u05EA \u05E9\u05D9\u05D9\u05E8\u05E9\u05DE\u05D5"), " \u05D9\u05E7\u05D1\u05DC\u05D5 \u05D8\u05D5\u05E4\u05E1 \u05DC\u05D4\u05D2\u05E9\u05EA \u05D4\u05DE\u05D9\u05D6\u05DD. \u05D4\u05D4\u05D2\u05E9\u05D4 \u05E6\u05E8\u05D9\u05DB\u05D4 \u05DC\u05D4\u05D9\u05D5\u05EA \u05D1\u05E4\u05D5\u05E8\u05DE\u05D8 URL \u05E9\u05D3\u05E8\u05DB\u05D5 \u05D9\u05D5\u05DB\u05DC\u05D5 \u05D4\u05E9\u05D5\u05E4\u05D8\u05D9\u05DD \u05DC\u05D2\u05E9\u05EA \u05D9\u05E9\u05D9\u05E8\u05D5\u05EA \u05D0\u05DC \u05D4\u05DE\u05D9\u05D6\u05DD. \u05E2\u05D1\u05D5\u05E8 \u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E8\u05D1\u05D9\u05DD \u05DE\u05E9\u05DE\u05E2\u05D5\u05EA \u05D4\u05D3\u05D1\u05E8 \u05D4\u05D9\u05D0 \u05D4\u05E2\u05DC\u05D0\u05EA \u05D2\u05E8\u05E1\u05EA \u05D3\u05DE\u05D5 \u05D7\u05D9\u05D4 \u05E9\u05DC \u05D4\u05D9\u05D9\u05E9\u05D5\u05DE\u05D5\u05DF, \u05E9\u05EA\u05E4\u05E2\u05DC \u05D1\u05E8\u05E9\u05EA. \u05E2\u05D1\u05D5\u05E8 \u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05D0\u05D7\u05E8\u05D9\u05DD \u05DB\u05EA\u05D5\u05D1\u05EA \u05D4\u05BEURL \u05EA\u05D5\u05D1\u05D9\u05DC \u05DC\u05EA\u05D9\u05D0\u05D5\u05E8 \u05D5\u05DC\u05EA\u05E7\u05E6\u05D9\u05E8 \u05E9\u05DC \u05D4\u05DE\u05D9\u05D6\u05DD, \u05D1\u05D3\u05D5\u05DE\u05D4 \u05DC\u05DB\u05E8\u05D6\u05D5\u05EA \u05D4\u05DE\u05E6\u05D9\u05D2\u05D5\u05EA \u05DE\u05D9\u05D6\u05DE\u05D9 \u05DE\u05D7\u05E7\u05E8 \u05D1\u05DB\u05E0\u05E1\u05D9\u05DD. \u05D0\u05DD \u05D4\u05DE\u05D9\u05D6\u05DD \u05E9\u05DC\u05DB\u05DD \u05D4\u05D5\u05D0 \u05D9\u05D9\u05E9\u05D5\u05DE\u05D5\u05DF \u05DC\u05E9\u05D5\u05DC\u05D7\u05DF \u05E2\u05D1\u05D5\u05D3\u05D4 \u05D0\u05D5 \u05DC\u05D8\u05DC\u05E4\u05D5\u05DF \u05E0\u05D9\u05D9\u05D3, \u05D9\u05E9 \u05DC\u05D4\u05E4\u05E2\u05D9\u05DC \u05D0\u05D5\u05EA\u05D5 \u05D1\u05D0\u05DE\u05E6\u05E2\u05D5\u05EA \u05D0\u05DE\u05D5\u05DC\u05D8\u05D5\u05E8 \u05DE\u05D1\u05D5\u05E1\u05E1 \u05E8\u05E9\u05EA (\u05DC\u05D3\u05D5\u05D2\u05DE\u05D4 ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "https://appetize.io"
  }, "Appetize.io"), "), \u05DB\u05D3\u05D9 \u05E9\u05D4\u05E9\u05D5\u05E4\u05D8\u05D9\u05DD \u05D5\u05D4\u05E9\u05D5\u05E4\u05D8\u05D5\u05EA \u05D9\u05D5\u05DB\u05DC\u05D5 \u05DC\u05D4\u05E9\u05EA\u05DE\u05E9 \u05D1\u05D5 \u05D1\u05DC\u05D9 \u05DC\u05D4\u05D5\u05E8\u05D9\u05D3 \u05E7\u05D5\u05D1\u05E6\u05D9 \u05D4\u05E8\u05E6\u05D4 \u05DB\u05DC\u05E9\u05D4\u05DD."), /*#__PURE__*/external_react_default().createElement("p", null, "\u05D4\u05E9\u05D5\u05E4\u05D8\u05D9\u05DD \u05D9\u05D1\u05D7\u05E8\u05D5 \u05E9\u05DC\u05D5\u05E9\u05D4 \u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E9\u05D9\u05D6\u05DB\u05D5 \u05D1\u05E4\u05E8\u05E1 \u05DB\u05E1\u05E4\u05D9: 5,000 \u05D3\u05D5\u05DC\u05E8 \u05DC\u05E4\u05E8\u05E1 \u05D4\u05DB\u05DC\u05DC\u05D9, 5,000 \u05D3\u05D5\u05DC\u05E8 \u05DC\u05E4\u05E8\u05E1 \u05DC\u05E0\u05E9\u05D9\u05DD \u05DE\u05E4\u05EA\u05D7\u05D5\u05EA \u05EA\u05D5\u05DB\u05E0\u05D4 \u05D5\u05BE3,600 \u05D3\u05D5\u05DC\u05E8 \u05DC\u05E4\u05E8\u05E1 \u05D4\u05DE\u05EA\u05DE\u05D5\u05D3\u05D3 \u05D4\u05E6\u05E2\u05D9\u05E8."), /*#__PURE__*/external_react_default().createElement("p", null, "\u05DE\u05D1\u05D7\u05E8 \u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05D0\u05D7\u05E8\u05D9\u05DD \u05E9\u05D9\u05D5\u05E9\u05DC\u05DE\u05D5, \u05D9\u05D5\u05E4\u05D9\u05E2\u05D5 \u05D0\u05E3 \u05D4\u05DD \u05D1\u05D3\u05E3 \u05D4\u05EA\u05D7\u05E8\u05D5\u05EA \u05D5\u05D9\u05E9\u05D5\u05EA\u05E4\u05D5 \u05E2\u05DD \u05E7\u05D4\u05D9\u05DC\u05EA \u05E1\u05E4\u05E8\u05D9\u05D0.")), /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Eligibility",
    he: "\u05D6\u05DB\u05D0\u05D5\u05EA"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "The Contest is open to applicants from the United States and Israel. All participants are eligible to enter the grand prize. Eligible participants for the Women in Tech prize include a) individuals who identify as women or b) groups of 3 or more, the majority of whom identify as women. Participants who are eligible for the Women in Tech prize may submit their project into both the Women in Tech prize and grand prize categories, and the youth prize category if eligible. Eligible participants for the youth prize include people under the age of 23. Participants who are eligible for the youth prize may submit their project into both the youth prize and grand prize categories, as well as the Women in Tech category if eligible. All entrants under the age of 18 must obtain permission from their parent or guardian before entering the contest. ", /*#__PURE__*/external_react_default().createElement("b", null, "To learn more, see our official ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "https://drive.google.com/file/d/1CMlxEe-xIk8RNpfdBRlytLDWsdLMXPpl/view"
  }, "Contest Rules")), ".")), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\u05D4\u05EA\u05D7\u05E8\u05D5\u05EA \u05D4\u05DB\u05DC\u05DC\u05D9\u05EA \u05E4\u05EA\u05D5\u05D7\u05D4 \u05DC\u05DE\u05D5\u05E2\u05DE\u05D3\u05D9\u05DD \u05DE\u05D0\u05E8\u05E6\u05D5\u05EA \u05D4\u05D1\u05E8\u05D9\u05EA \u05D5\u05DE\u05D9\u05E9\u05E8\u05D0\u05DC (\u05E0\u05E9\u05D9\u05DD \u05D5\u05D2\u05D1\u05E8\u05D9\u05DD). \u05D4\u05E4\u05E8\u05E1 \u05D4\u05DE\u05D9\u05D5\u05D7\u05D3 \u05E2\u05D1\u05D5\u05E8 \u05E0\u05E9\u05D9\u05DD \u05DE\u05D9\u05D5\u05E2\u05D3 \u05DC\u05E0\u05E9\u05D9\u05DD \u05E9\u05DE\u05E4\u05EA\u05D7\u05D5\u05EA \u05EA\u05D5\u05DB\u05E0\u05D4 \u05D0\u05D5 \u05DC\u05E7\u05D1\u05D5\u05E6\u05D4 \u05D1\u05EA\u05E0\u05D0\u05D9 \u05E9\u05D9\u05E9 \u05D1\u05D4 \u05E8\u05D5\u05D1 \u05E0\u05E9\u05D9. \u05D0. \u05D0\u05D9\u05E9\u05D4; \u05D1. \u05E7\u05D1\u05D5\u05E6\u05D4 \u05E9\u05DC \u05E9\u05DC\u05D5\u05E9\u05D4 \u05DE\u05E9\u05EA\u05EA\u05E4\u05D9\u05DD \u05D0\u05D5 \u05D9\u05D5\u05EA\u05E8, \u05E9\u05DE\u05D5\u05E8\u05DB\u05D1\u05EA \u05E8\u05D5\u05D1\u05D4 \u05DE\u05E0\u05E9\u05D9\u05DD. \u05D4\u05DE\u05E9\u05EA\u05EA\u05E4\u05D5\u05EA \u05D4\u05D6\u05DB\u05D0\u05D9\u05D5\u05EA \u05D9\u05DB\u05D5\u05DC\u05D5\u05EA \u05DC\u05E9\u05DC\u05D5\u05D7 \u05D0\u05EA \u05D4\u05DE\u05D9\u05D6\u05DD \u05E9\u05DC\u05D4\u05DF \u05DC\u05D4\u05EA\u05DE\u05D5\u05D3\u05D3\u05D5\u05EA \u05E2\u05DC \u05DB\u05DE\u05D4 \u05E4\u05E8\u05E1\u05D9\u05DD: \u05D4\u05E4\u05E8\u05E1 \u05D4\u05DB\u05DC\u05DC\u05D9, \u05D4\u05E4\u05E8\u05E1 \u05DC\u05E0\u05E9\u05D9\u05DD \u05DE\u05E4\u05EA\u05D7\u05D5\u05EA \u05EA\u05D5\u05DB\u05E0\u05D4 \u05D5\u05E2\u05DC \u05E4\u05E8\u05E1 \u05D4\u05DE\u05EA\u05DE\u05D5\u05D3\u05D3 \u05D4\u05E6\u05E2\u05D9\u05E8, \u05D0\u05DD \u05D4\u05DF \u05E2\u05D5\u05DE\u05D3\u05D5\u05EA \u05D1\u05EA\u05E0\u05D0\u05D9\u05D5. \u05D4\u05EA\u05E0\u05D0\u05D9 \u05DC\u05D4\u05EA\u05DE\u05D5\u05D3\u05D3\u05D5\u05EA \u05D1\u05E7\u05D8\u05D2\u05D5\u05E8\u05D9\u05D9\u05EA \u05E4\u05E8\u05E1 \u05D4\u05DE\u05EA\u05DE\u05D5\u05D3\u05D3 \u05D4\u05E6\u05E2\u05D9\u05E8 \u05D4\u05D5\u05D0 \u05E9\u05D2\u05D9\u05DC \u05D4\u05DE\u05E9\u05EA\u05EA\u05E3 \u05D0\u05D9\u05E0\u05D5 \u05E2\u05D5\u05DC\u05D4 \u05E2\u05DC 23. \u05DB\u05DC \u05D4\u05DE\u05E9\u05EA\u05EA\u05E4\u05D9\u05DD \u05D1\u05EA\u05D7\u05E8\u05D5\u05EA \u05DE\u05EA\u05D7\u05EA \u05DC\u05D2\u05D9\u05DC 18 \u05D7\u05D9\u05D9\u05D1\u05D9\u05DD \u05DC\u05D4\u05E6\u05D9\u05D2 \u05D0\u05D9\u05E9\u05D5\u05E8 \u05DE\u05D4\u05D5\u05E8\u05D4 \u05D0\u05D5 \u05DE\u05D0\u05E4\u05D8\u05E8\u05D5\u05E4\u05D5\u05E1 \u05DC\u05E4\u05E0\u05D9 \u05D4\u05DB\u05E0\u05D9\u05E1\u05D4 \u05DC\u05EA\u05D7\u05E8\u05D5\u05EA. \u05DC\u05E2\u05D9\u05D5\u05DF \u05E0\u05D5\u05E1\u05E3, \u05E8\u05D0\u05D5 \u05D0\u05EA ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "https://drive.google.com/file/d/1CMlxEe-xIk8RNpfdBRlytLDWsdLMXPpl/view"
  }, "\u05EA\u05E7\u05E0\u05D5\u05DF \u05D4\u05EA\u05D7\u05E8\u05D5\u05EA \u05D4\u05E8\u05E9\u05DE\u05D9 \u05E9\u05DC\u05E0\u05D5"), ".")), /*#__PURE__*/external_react_default().createElement(Spacer, null), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(ImageWithText, {
    enText: "<i>\u201CBy open-sourcing a vast array of Jewish texts, Sefaria's API makes programmatic analysis of Jewish tradition simple for the everyday programmer. talmud.page began as my own hand-tailored UI for learning Daf Yomi. The more developers use Sefaria's API to solve creative questions, the richer Jewish learning will be worldwide.\u201D <br/><br/> - Ron Shapiro, <a href='https://talmud.page'>talmud.page</a></i></div>",
    enImg: "/static/img/contest-landing-page/AdobeStock_314348719.png",
    enImgAlt: "",
    heText: "<i>\"\u05E2\u05DC-\u05D9\u05D3\u05D9 \u05D0\u05E1\u05E4\u05E7\u05EA \u05D2\u05D9\u05E9\u05D4 \u05DC\u05DE\u05D2\u05D5\u05D5\u05DF \u05E2\u05E6\u05D5\u05DD \u05E9\u05DC \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD, \u05D4-API \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05DE\u05D0\u05E4\u05E9\u05E8 \u05DC\u05DE\u05EA\u05DB\u05E0\u05EA \u05D4\u05E4\u05E9\u05D5\u05D8 \u05DC\u05D1\u05E6\u05E2 \u05E0\u05D9\u05EA\u05D5\u05D7 \u05E4\u05E8\u05D5\u05D2\u05E8\u05DE\u05D8\u05D9 \u05E9\u05DC \u05D4\u05DE\u05E1\u05D5\u05E8\u05EA \u05D4\u05D9\u05D4\u05D5\u05D3\u05D9. talmud.page \u05D4\u05D7\u05DC \u05DB\u05DE\u05DE\u05E9\u05E7 \u05DE\u05E9\u05EA\u05DE\u05E9 \u05D0\u05D9\u05E9\u05D9 \u05DC\u05E6\u05D5\u05E8\u05DA \u05DC\u05D9\u05DE\u05D5\u05D3 \u05D3\u05E3 \u05D9\u05D5\u05DE\u05D9. \u05DB\u05DB\u05DC \u05E9\u05DE\u05E4\u05EA\u05D7\u05D9\u05DD \u05D9\u05E9\u05EA\u05DE\u05E9\u05D5 \u05D9\u05D5\u05EA\u05E8  \u05D1-API \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05DC\u05E4\u05EA\u05E8\u05D5\u05DF \u05E9\u05D0\u05DC\u05D5\u05EA \u05D9\u05E6\u05D9\u05E8\u05EA\u05D9\u05D5\u05EA- \u05D4\u05DC\u05D9\u05DE\u05D5\u05D3 \u05D4\u05D9\u05D4\u05D5\u05D3\u05D9 \u05D1\u05DB\u05DC \u05D4\u05E2\u05D5\u05DC\u05DD- \u05D9\u05D6\u05DB\u05D4\" <br/><br/> - \u05E8\u05D5\u05DF \u05E9\u05E4\u05D9\u05E8\u05D0, <a href=\"https://talmud.page\">talmud.page</a></i>",
    heImg: "/static/img/contest-landing-page/AdobeStock_314348719.png",
    heImgAlt: ""
  })), /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Winner Selection",
    he: "\u05D1\u05D7\u05D9\u05E8\u05EA \u05D4\u05D6\u05D5\u05DB\u05D4"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Winners will be selected by a panel of three judges. The judges will evaluate each project on the basis of four criteria:"), /*#__PURE__*/external_react_default().createElement("ol", null, /*#__PURE__*/external_react_default().createElement("li", null, "Highlighting of Jewish texts and their unique value"), /*#__PURE__*/external_react_default().createElement("li", null, "Technological accomplishment"), /*#__PURE__*/external_react_default().createElement("li", null, "Potential for impact or inspiration"), /*#__PURE__*/external_react_default().createElement("li", null, "Creativity")), /*#__PURE__*/external_react_default().createElement("p", null, "Projects that existed prior to the call for submission may enter on the basis of additional work added since the time the contest began. Judges will evaluate the projects on the basis of the additional work. Projects don\u2019t have to be 100% complete or polished to enter either; our judges will be happy to see the potential in a promising start. ")), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\u05D4\u05D6\u05D5\u05DB\u05D9\u05DD \u05D9\u05D9\u05D1\u05D7\u05E8\u05D5 \u05E2\u05DC \u05D9\u05D3\u05D9 \u05E4\u05D0\u05E0\u05DC \u05E9\u05DC \u05E9\u05DC\u05D5\u05E9\u05D4 \u05E9\u05D5\u05E4\u05D8\u05D9\u05DD. \u05D4\u05E9\u05D5\u05E4\u05D8\u05D9\u05DD \u05D9\u05D1\u05D7\u05E0\u05D5 \u05DB\u05DC \u05E4\u05E8\u05D5\u05D9\u05E7\u05D8 \u05E2\u05DC \u05D1\u05E1\u05D9\u05E1 \u05D4\u05E7\u05E8\u05D9\u05D8\u05E8\u05D9\u05D5\u05E0\u05D9\u05DD \u05D4\u05D1\u05D0\u05D9\u05DD:"), /*#__PURE__*/external_react_default().createElement("ol", null, /*#__PURE__*/external_react_default().createElement("li", null, "\u05D3\u05D2\u05E9 \u05E2\u05DC \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD \u05D5\u05E2\u05E8\u05DB\u05DD \u05D4\u05DE\u05D9\u05D5\u05D7\u05D3"), /*#__PURE__*/external_react_default().createElement("li", null, "\u05D4\u05D4\u05D9\u05E9\u05D2\u05D9\u05DD \u05D4\u05D8\u05DB\u05E0\u05D5\u05DC\u05D5\u05D2\u05D9\u05D9\u05DD \u05E9\u05D1\u05DE\u05D9\u05D6\u05DD"), /*#__PURE__*/external_react_default().createElement("li", null, "\u05E4\u05D5\u05D8\u05E0\u05E6\u05D9\u05D0\u05DC \u05D4\u05D4\u05E9\u05E4\u05E2\u05D4 \u05D0\u05D5 \u05D4\u05D4\u05E9\u05E8\u05D0\u05D4 \u05D4\u05D8\u05DE\u05D5\u05DF \u05D1\u05DE\u05D9\u05D6\u05DD"), /*#__PURE__*/external_react_default().createElement("li", null, "\u05D9\u05E6\u05D9\u05E8\u05EA\u05D9\u05D5\u05EA \u05D4\u05DE\u05D9\u05D6\u05DD")), /*#__PURE__*/external_react_default().createElement("p", null, "\u05D0\u05E4\u05E9\u05E8 \u05DC\u05D4\u05D2\u05D9\u05E9 \u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E9\u05D4\u05EA\u05D7\u05D9\u05DC\u05D5 \u05E2\u05D5\u05D3 \u05DC\u05E4\u05E0\u05D9 \u05E4\u05E8\u05E1\u05D5\u05DD \u05D4\u05E7\u05D5\u05DC \u05E7\u05D5\u05E8\u05D0, \u05DB\u05DC \u05E2\u05D5\u05D3 \u05EA\u05D9\u05E2\u05E9\u05D4 \u05E2\u05D1\u05D5\u05D3\u05D4 \u05E0\u05D5\u05E1\u05E4\u05EA \u05D1\u05DE\u05D9\u05D6\u05DD \u05D0\u05D7\u05E8\u05D9 \u05E9\u05D4\u05EA\u05D7\u05E8\u05D5\u05EA \u05DB\u05D1\u05E8 \u05D4\u05D7\u05DC\u05D4. \u05D4\u05E9\u05D5\u05E4\u05D8\u05D9\u05DD \u05D9\u05E2\u05E8\u05D9\u05DB\u05D5 \u05D0\u05EA \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E2\u05DC \u05E4\u05D9 \u05D4\u05E2\u05D1\u05D5\u05D3\u05D4 \u05E9\u05D4\u05EA\u05D5\u05D5\u05E1\u05E4\u05D4.")), /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Registration",
    he: "\u05D4\u05E8\u05E9\u05DE\u05D4"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Interested in participating in the contest? ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "#"
  }, "Sign up"), " for updates and resources, including office hours with the Sefaria engineering team. We'll share a link for project submissions with you in the coming weeks!")), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\u05D0\u05DD \u05D0\u05EA\u05DD \u05DE\u05E2\u05D5\u05E0\u05D9\u05D9\u05E0\u05D9\u05DD \u05DC\u05D4\u05E9\u05EA\u05EA\u05E3 \u05D1\u05EA\u05D7\u05E8\u05D5\u05EA, ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "#"
  }, "\u05DC\u05D7\u05E6\u05D5 \u05DB\u05D0\u05DF \u05DC\u05D4\u05E8\u05E9\u05DE\u05D4"), ", \u05DB\u05D3\u05D9 \u05E9\u05E0\u05D5\u05DB\u05DC \u05DC\u05E9\u05DC\u05D5\u05D7 \u05DC\u05DB\u05DD \u05E2\u05D3\u05DB\u05D5\u05E0\u05D9\u05DD \u05D1\u05DE\u05D4\u05DC\u05DA \u05D4\u05EA\u05D7\u05E8\u05D5\u05EA \u05D1\u05E0\u05D5\u05D2\u05E2 \u05DC\u05DB\u05DC\u05D9\u05DD \u05D5\u05DE\u05E9\u05D0\u05D1\u05D9\u05DD, \u05DB\u05D5\u05DC\u05DC \u05E9\u05E2\u05D5\u05EA \u05D4\u05E2\u05D1\u05D5\u05D3\u05D4 \u05E9\u05DC \u05D4\u05DE\u05EA\u05DB\u05E0\u05EA\u05D9\u05DD \u05E9\u05DC\u05E0\u05D5, \u05E9\u05EA\u05D5\u05DB\u05DC\u05D5 \u05DC\u05E9\u05D0\u05D5\u05DC \u05D0\u05D5\u05EA\u05DD \u05E9\u05D0\u05DC\u05D5\u05EA \u05D5\u05DC\u05D4\u05EA\u05D9\u05D9\u05E2\u05E5 \u05D0\u05D9\u05EA\u05DD \u05E2\u05DC \u05E8\u05E2\u05D9\u05D5\u05E0\u05D5\u05EA \u05D0\u05D7\u05D3\u05BE\u05E2\u05DC\u05BE\u05D0\u05D7\u05D3. \u05EA\u05D5\u05DB\u05DC\u05D5 \u05DC\u05D4\u05EA\u05DE\u05D5\u05D3\u05D3 \u05D1\u05D0\u05D5\u05E4\u05DF \u05E2\u05E6\u05DE\u05D0\u05D9 \u05D0\u05D5 \u05DB\u05D7\u05DC\u05E7 \u05DE\u05E6\u05D5\u05D5\u05EA, \u05D5\u05DC\u05D4\u05D9\u05E8\u05E9\u05DD \u05D1\u05DB\u05DC \u05E9\u05DC\u05D1 \u05DE\u05E2\u05DB\u05E9\u05D9\u05D5 \u05D5\u05E2\u05D3 \u05DC\u05E1\u05D9\u05D5\u05DD \u05D4\u05EA\u05D7\u05E8\u05D5\u05EA.")), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    white: true
  }, /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "#",
    he_href: "#",
    he: "\u05D8\u05D5\u05E4\u05E1 \u05D4\u05E8\u05E9\u05DE\u05D4",
    en: "Register"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "https://drive.google.com/file/d/1CMlxEe-xIk8RNpfdBRlytLDWsdLMXPpl/view",
    he_href: "https://drive.google.com/file/d/1CMlxEe-xIk8RNpfdBRlytLDWsdLMXPpl/view",
    he: "\u05DB\u05DC\u05DC\u05D9 \u05D4\u05EA\u05D7\u05E8\u05D5\u05EA",
    en: "Official Rules"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "https://github.com/Sefaria/Sefaria-Project",
    he_href: "https://github.com/Sefaria/Sefaria-Project",
    he: "GitHub",
    en: "GitHub"
  })), /*#__PURE__*/external_react_default().createElement(CallToActionFooterWithButton, {
    href: "/powered-by-sefaria-contest-2020",
    he_href: "/powered-by-sefaria-contest-2020",
    enText: "Need Inspiration?",
    heText: "\u05E8\u05D5\u05E6\u05D4 \u05DC\u05E7\u05D1\u05DC \u05D4\u05E9\u05E8\u05D0\u05D4?",
    enButtonText: "See 2020 Projects",
    heButtonText: "\u05DC\u05DE\u05D9\u05D6\u05DE\u05D9 2020"
  }));
};
var RambanLandingPage = function RambanLandingPage() {
  var emailLink = /*#__PURE__*/external_react_default().createElement("a", {
    target: "_blank",
    href: "mailto:hannah@sefaria.org?Subject=Ramban Sponsorship"
  }, "hannah@sefaria.org");
  return /*#__PURE__*/external_react_default().createElement(StaticPage, {
    optionalClass: "englishOnly"
  }, /*#__PURE__*/external_react_default().createElement(StaticPages_Header, {
    enTitle: "Ramban on Torah: A Translation",
    enText: "Sefaria is thrilled to release Rabbi Charles Chavel's classic English translation of Rabbi Moshe ben Nachman (known as Ramban or Nachmanides) on Torah. This historic launch makes a complete bilingual version of Ramban's commentary available online for the very first time, and it will remain free for use and re-use under a CC-BY license. We are profoundly grateful to the following donors for making this possible.",
    enActionText: "Read the Text",
    enActionURL: "/texts/Tanakh/Rishonim%20on%20Tanakh/Ramban",
    heTitle: "Ramban on Torah: A Translation",
    heText: "Sefaria is thrilled to be able to offer Rabbi Charles Chavel's classic English translation of Ramban (Nachmanides) on Torah to the world.  This historic launch makes a complete version of this work available online for the very first time, and it will remain free for use and re-use under a CC-BY license. We are profoundly grateful to the following donors for making this possible.",
    heActionURL: "/texts/Tanakh/Rishonim%20on%20Tanakh/Ramban",
    heActionText: "Read the Text",
    enImg: "",
    heImg: ""
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    content: [['Bereshit', 'Leib and Linda Koyfman', 'In honor of Hilary and Mo Koyfman and family', '/Genesis.1.1?with=Ramban'], ['Noach', 'Tali and Sender Cohen', '', '/Genesis.6.9?with=Ramban'], ['Lech Lecha', 'Rabbi David Aladjem', 'In support of Sefaria', '/Genesis.12.1?with=Ramban'], ['Vayera', 'Howard and Tova Weiser', 'In honor of their children and grandchildren', '/Genesis.18.1?with=Ramban'], ['Chayei Sara', 'Rechtschaffen Family', "In honor of the 30th anniversary of Andrew Rechtscaffen's bar mitzvah", '/Genesis.23.1?with=Ramban'], ['Toldot', 'Shapira-Stern Family', 'In honor of David Shapira', '/Genesis.25.19?with=Ramban'], ['Vayetzei', null, null, '/Genesis.28.10?with=Ramban'], ['Vayishlach', null, null, '/Genesis.32.4?with=Ramban'], ['Vayashev', null, null, '/Genesis.37.1?with=Ramban'], ['Miketz', 'Raquel and Aryeh Rubin', 'In memory of the one and a half million children', '/Genesis.41.1?with=Ramban'], ['Vayigash', 'Laurie and Milton Wakschlag', 'In memory of their parents Fishel and Sheva Wakschlag', '/Genesis.44.18?with=Ramban'], ['Vayechi', 'The Stein Children', 'In memory of their father Jacob K. Stein z"l', '/Genesis.47.28?with=Ramban']].map(function (i) {
      return /*#__PURE__*/external_react_default().createElement(ParashaSponsorship, {
        title: i[0],
        sponsorNames: i[1],
        message: i[2],
        link: i[3]
      });
    })
  })), /*#__PURE__*/external_react_default().createElement(StaticHR, null), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    content: [['Shemot', 'Sam and Debbie Moed', 'In memory of Henry I. Zeisel, who derived tremendous joy from learning. This perush of his bar mitzvah parashah is dedicated with love.', '/Exodus.1.1?with=Ramban'], ['Vaera', 'The loving children and children-in-law of Arthur Helft', 'In memory of Dr. Arthur Helft', '/Exodus.6.2?with=Ramban'], ['Bo', 'Honey Kessler Amado', 'In memory of her husband, Ralph A. Amado; her parents, Bernard and Mildred Kessler; and our teacher, Rabbi Moshe ben Nachman (Nachmanides).', '/Exodus.10.1?with=Ramban'], ['Beshalach', 'Nicole and Raanan Agus', 'In memory of Dr. Saul G. Agus z"l', '/Exodus.13.17?with=Ramban'], ['Yitro', 'Anonymous', 'To honor the memory of Joe and Rose Rudis', '/Exodus.18.1?with=Ramban'], ['Mishpatim ', null, null, '/Exodus.21.1?with=Ramban'], ['Terumah', 'Julia Baum and Adam Feldman', 'In memory of Earl Katz and Annette Steinman', '/Exodus.25.1?with=Ramban'], ['Tetzaveh', 'Huti and Jay', 'In Gratitude to all the Health Care Workers during the Pandemic', '/Exodus.27.20?with=Ramban'], ['Ki Tisa', 'Nicole and Raanan Agus', 'In memory of Dr. Saul G. Agus z"l', '/Exodus.30.11?with=Ramban'], ['Vayahkel', 'The Berkowitz Family', 'In honor of their parents and grandparents (Bebe, Bepop, Pop pop, and grandmama) who provide a sense of inspiration and demonstrate a desire to constantly learn more.', '/Exodus.35.1?with=Ramban'], ['Pekudei', 'The Hiltzik Family', '', '/Exodus.38.21?with=Ramban']].map(function (i) {
      return /*#__PURE__*/external_react_default().createElement(ParashaSponsorship, {
        title: i[0],
        sponsorNames: i[1],
        message: i[2],
        link: i[3]
      });
    })
  })), /*#__PURE__*/external_react_default().createElement(StaticHR, null), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    content: [['Vayikra', 'Edy and Jacob Kupietzky and Family', '', '/Leviticus.1.1?with=Ramban'], ['Tzav', 'Rabbi Ruth Adar', 'In memory of K\'vod HaRav André Zaoui, z"l', '/Leviticus.6.1?with=Ramban'], ['Shmini', 'Joshua and Dinah Foer', '', '/Leviticus.9.1?with=Ramban'], ['Tazria', 'Diane and Howard Zack and Family', 'In honor of their parents', '/Leviticus.12.1?with=Ramban'], ['Metzora', 'Anne Germanacos', 'In honor of Rabbi Noa Kusher and Rabbi Jessica Kate Meyer in gratitude for their brilliance and resilience during the pandemic, and their friendship in all times.', '/Leviticus.14.1?with=Ramban'], ['Achrei Mot', 'Anne Germanacos', 'In honor of Rabbi Noa Kusher and Rabbi Jessica Kate Meyer in gratitude for their brilliance and resilience during the pandemic, and their friendship in all times.', '/Leviticus.16.1?with=Ramban'], ['Kedoshim', 'Karine and Michael Bloch', 'In honor of our children Eitan, Yoel, and Tali'], ['Emor', 'Joshua and Dinah Foer', '', '/Leviticus.19.1?with=Ramban'], ['Behar ', 'Tamar and Eric Goldstein', 'In honor of Aryeh’s aufruf', '/Leviticus.25.1?with=Ramban'], ['Bechukotai ', 'Tamar and Eric Goldstein', 'In honor of Aryeh’s aufruf', '/Leviticus.26.3?with=Ramban']].map(function (i) {
      return /*#__PURE__*/external_react_default().createElement(ParashaSponsorship, {
        title: i[0],
        sponsorNames: i[1],
        message: i[2],
        link: i[3]
      });
    })
  })), /*#__PURE__*/external_react_default().createElement(StaticHR, null), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    content: [['Bamidbar', 'The Hiltzik Family', '', '/Numbers.1.1?with=Ramban'], ['Nasso', 'Annoymous Sponsor', 'In honor of Tzeela, Rina Faiga, Dalia and Penina Malka', '/Numbers.4.21?with=Ramban'], ["Beha'alotcha", null, null, '/Numbers.8.1?with=Ramban'], ["Sh'lach", 'Meyer Family', 'In honor of the bar mitzvah of George Meyer', '/Numbers.13.1?with=Ramban'], ['Korach', 'Fred Blau and Maayan Roth', 'In memory of Sarita Blau, loving mother and teacher', '/Numbers.16.1?with=Ramban'], ['Chukat', 'Kevin Waldman', 'In support of Sefaria', '/Numbers.19.1?with=Ramban'], ['Balak', null, null, '/Numbers.22.2?with=Ramban'], ['Pinchas', 'The Berkowitz Family', "In honor of our parent's and grandparent's (Bebe, Bepop, Pop pop, and grandmama) who provide a sense of inspiration and demonstrate a desire to constantly learn more.", '/Numbers.25.10?with=Ramban'], ['Matot', 'Shprintzy and Effy', 'Dedicated in memory of the late Mendel Schoenberg, son of the late Naftali Binyamin and Shprintza. Born in Sanok, Poland, in Elul, between the years 5684 and 5686. Passed away at a ripe old age at his home in Brooklyn, New York, on the First Night of Chanukah 5779.', '/Numbers.30.2?with=Ramban', '/Numbers.33.1?with=Ramban'], ['Masei', 'Nadine and Beni Gesundheit', '', '/Numbers.33.1?with=Ramban']].map(function (i) {
      return /*#__PURE__*/external_react_default().createElement(ParashaSponsorship, {
        title: i[0],
        sponsorNames: i[1],
        message: i[2],
        link: i[3]
      });
    })
  })), /*#__PURE__*/external_react_default().createElement(StaticHR, null), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    content: [['Devarim', null, null, '/Deuteronomy.1.1?with=Ramban'], ['Vaetchanan', 'Becky and Avi Katz', 'In honor of Sefaria', '/Deuteronomy.3.23?with=Ramban'], ['Eikev', 'Annoymous Sponsor', '', '/Deuteronomy.7.12?with=Ramban'], ["Re'eh", 'Tamar and Eric Goldstein', "In honor of Adin's aufruf", '/Deuteronomy.11.26?with=Ramban'], ['Shoftim', 'Tricia Gibbs', 'In memory of F. Warren Hellman', '/Deuteronomy.16.18?with=Ramban'], ['Ki Tetzei', 'The Katz Family', 'In honor of the victims of Covid-19', '/Deuteronomy.21.10?with=Ramban'], ['Ki Tavo ', 'Rechtschaffen Family', "In honor of the 3rd anniversary of Jordan Rechtscaffen's bar mitzvah", '/Deuteronomy.26.1?with=Ramban'], ['Nitzavim', 'Jeremy Rosenthal', 'In honor of Judy and Stuart Rosenthal, in gratitude for their commitment to a sustained Jewish future.', '/Deuteronomy.29.9?with=Ramban'], ['Vayeilech', 'Nicole and Raanan Agus', 'In memory of Dr. Saul G. Agus z"l', '/Deuteronomy.31.1?with=Ramban'], ["Ha'Azinu", 'Mayer', 'In honour of Shalom Rosenzweig, on the occasion of his Bar Mitzvah, October 10, 1992', '/Deuteronomy.32.1?with=Ramban'], ["V'Zot HaBerachah", 'Elisha Wiesel', 'In memory of Elie Wiesel', '/Deuteronomy.33.1?with=Ramban']].map(function (i) {
      return /*#__PURE__*/external_react_default().createElement(ParashaSponsorship, {
        title: i[0],
        sponsorNames: i[1],
        message: i[2],
        link: i[3]
      });
    })
  })), /*#__PURE__*/external_react_default().createElement(Spacer, null), /*#__PURE__*/external_react_default().createElement(Spacer, null), /*#__PURE__*/external_react_default().createElement(Spacer, null), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageCallToActionFooter"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "callToActionText noButton"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Interested in sponsoring a parashah? Please email ", emailLink, " for more information."), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, "Interested in sponsoring a parashah? Please email ", emailLink, " for more information.")))));
};
var SheetsLandingPage = function SheetsLandingPage() {
  return /*#__PURE__*/external_react_default().createElement(StaticPage, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Header, {
    enTitle: "Create with Sefaria",
    enText: "Mix and match sources from Sefaria\u2019s library of Jewish texts, and add your comments, images and videos.",
    enImg: "/static/img/sheets-landing-page/sheetspage_headerimage.png",
    enImgAlt: "Sefaria Sheets",
    enActionURL: "/sheets/new?utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets",
    enActionText: "Make a Sheet",
    heTitle: "\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA",
    heText: "\u05D1\u05D7\u05E8\u05D5 \u05DC\u05DB\u05DD \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DE\u05D0\u05E8\u05D5\u05DF \u05D4\u05E1\u05E4\u05E8\u05D9\u05DD \u05D4\u05D9\u05D4\u05D5\u05D3\u05D9 \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D5\u05D4\u05D5\u05E1\u05D9\u05E4\u05D5 \u05D4\u05E2\u05E8\u05D5\u05EA, \u05EA\u05DE\u05D5\u05E0\u05D5\u05EA \u05D0\u05D5 \u05E1\u05E8\u05D8\u05D5\u05E0\u05D9\u05DD \u05DE\u05E9\u05DC\u05DB\u05DD.",
    heImg: "/static/img/sheets-landing-page/sheetspage_headerimage_HEB.png",
    heImgAlt: "\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA",
    heActionURL: "/sheets/new?utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets_HEB",
    heActionText: "\u05D1\u05E0\u05D5 \u05D3\u05E3 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA"
  }), /*#__PURE__*/external_react_default().createElement(GreyBox, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Discover new ways to learn & teach",
    he: "\u05D2\u05DC\u05D5 \u05D3\u05E8\u05DB\u05D9\u05DD \u05D7\u05D3\u05E9\u05D5\u05EA \u05DC\u05DC\u05DE\u05D5\u05D3 \u05D5\u05DC\u05DC\u05DE\u05D3"
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Organize Sources",
    enText: "Sheets let you mix and match sources from our library. Type in a source title and chapter to add it to your sheet, then edit the source to cut it down or customize  the translation. Use sources in any order you wish. ",
    enImg: "/static/img/sheets-landing-page/organizesources.jpg",
    enImgAlt: "Organize Sources",
    heTitle: "\u05E1\u05D3\u05E8\u05D5 \u05D0\u05EA \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA",
    heText: "\u05EA\u05D5\u05DB\u05DC\u05D5 \u05DC\u05D1\u05D7\u05D5\u05E8 \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05DE\u05EA\u05D5\u05DA \u05E9\u05DC\u05DC \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D1\u05E1\u05E4\u05E8\u05D9\u05D9\u05D4 \u05E9\u05DC\u05E0\u05D5 \u05D5\u05DC\u05E6\u05E8\u05E3 \u05D0\u05D5\u05EA\u05DD \u05DC\u05D3\u05E3 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA. \u05D4\u05E7\u05DC\u05D9\u05D3\u05D5 \u05D0\u05EA \u05E9\u05DD \u05D4\u05DE\u05E7\u05D5\u05E8 \u05D5\u05D0\u05EA \u05DE\u05E1\u05E4\u05E8 \u05D4\u05E4\u05E8\u05E7 \u05DB\u05D3\u05D9 \u05DC\u05D4\u05D5\u05E1\u05D9\u05E3 \u05D0\u05D5\u05EA\u05D5 \u05DC\u05D3\u05E3 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05DC\u05DB\u05DD. \u05D1\u05E9\u05DC\u05D1 \u05D4\u05D1\u05D0 \u05EA\u05D5\u05DB\u05DC\u05D5 \u05DC\u05E2\u05E8\u05D5\u05DA \u05D5\u05DC\u05E7\u05E6\u05E8 \u05D0\u05EA \u05D4\u05DE\u05E7\u05D5\u05E8, \u05DC\u05D1\u05D7\u05D5\u05E8 \u05D1\u05EA\u05E8\u05D2\u05D5\u05DD \u05D0\u05D7\u05E8 \u05D5\u05DC\u05D0\u05E8\u05D2\u05DF \u05D0\u05EA \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D1\u05E1\u05D3\u05E8 \u05D4\u05E8\u05E6\u05D5\u05D9 \u05DC\u05DB\u05DD.",
    heImg: "/static/img/sheets-landing-page/organizesources_HEB.jpg",
    heImgAlt: "\u05E1\u05D3\u05E8\u05D5 \u05D0\u05EA \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA",
    borderColor: "#004E5F"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Add Your Commentary",
    enText: "Make it more than sources. You can easily add your own commentary or texts from outside our library to create something new. You can also add images and videos to enhance your reader\u2019s experience even more. ",
    enImg: "/static/img/sheets-landing-page/commentary_sheet.jpg",
    enImgAlt: "Add Your Commentary",
    heTitle: "\u05D4\u05D5\u05E1\u05D9\u05E4\u05D5 \u05D4\u05E2\u05E8\u05D5\u05EA \u05DE\u05E9\u05DC\u05DB\u05DD",
    heText: "\u05D4\u05EA\u05D5\u05E6\u05E8 \u05E9\u05DC\u05DB\u05DD \u05D9\u05DB\u05D5\u05DC \u05DC\u05D4\u05D9\u05D5\u05EA \u05D9\u05D5\u05EA\u05E8 \u05DE\u05E8\u05E9\u05D9\u05DE\u05EA \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D1\u05DC\u05D1\u05D3. \u05EA\u05D5\u05DB\u05DC\u05D5 \u05D1\u05E7\u05DC\u05D5\u05EA \u05DC\u05D4\u05D5\u05E1\u05D9\u05E3 \u05D4\u05E2\u05E8\u05D5\u05EA, \u05E4\u05E8\u05E9\u05E0\u05D5\u05EA \u05D5\u05D4\u05E1\u05D1\u05E8\u05D9\u05DD \u05DE\u05E9\u05DC\u05DB\u05DD \u05D5\u05DB\u05DF \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05D0\u05D7\u05E8\u05D9\u05DD \u05DB\u05D3\u05D9 \u05DC\u05D9\u05E6\u05D5\u05E8 \u05DE\u05E9\u05D4\u05D5 \u05D7\u05D3\u05E9. \u05DC\u05D7\u05D5\u05D5\u05D9\u05D9\u05EA \u05DC\u05D9\u05DE\u05D5\u05D3 \u05DE\u05E9\u05DE\u05E2\u05D5\u05EA\u05D9\u05EA \u05D9\u05D5\u05EA\u05E8 \u05EA\u05D5\u05DB\u05DC\u05D5 \u05D0\u05E4\u05D9\u05DC\u05D5 \u05DC\u05D4\u05D5\u05E1\u05D9\u05E3 \u05EA\u05DE\u05D5\u05E0\u05D5\u05EA \u05D5\u05E1\u05E8\u05D8\u05D5\u05E0\u05D9\u05DD.",
    heImg: "/static/img/sheets-landing-page/addcommentary_HEB.jpg",
    heImgAlt: "\u05D4\u05D5\u05E1\u05D9\u05E4\u05D5 \u05D4\u05E2\u05E8\u05D5\u05EA \u05DE\u05E9\u05DC\u05DB\u05DD",
    borderColor: "#CCB479"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Share Your Work",
    enText: "You can share your sheet privately with a link, publicly on our site, or print it out for your class. Make your sheet public and add it to our library of over 200,000 user-created sheets. ",
    enImg: "/static/img/sheets-landing-page/shareyoursheets.jpg",
    enImgAlt: "Share Your Work",
    heTitle: "\u05E9\u05EA\u05E4\u05D5",
    heText: "\u05EA\u05D5\u05DB\u05DC\u05D5 \u05DC\u05E9\u05EA\u05E3 \u05D0\u05EA \u05D3\u05E3 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D1\u05D0\u05D5\u05E4\u05DF \u05E4\u05E8\u05D8\u05D9 \u05D1\u05E2\u05D6\u05E8\u05EA \u05DC\u05D9\u05E0\u05E7, \u05DC\u05D4\u05D3\u05E4\u05D9\u05E1 \u05D0\u05D5\u05EA\u05D5 \u05E2\u05D1\u05D5\u05E8 \u05D4\u05DB\u05D9\u05EA\u05D4 \u05E9\u05DC\u05DB\u05DD \u05D0\u05D5 \u05DC\u05D4\u05E2\u05DC\u05D5\u05EA \u05D0\u05D5\u05EA\u05D5 \u05DC\u05D0\u05EA\u05E8 \u05E9\u05DC\u05E0\u05D5 \u05DC\u05EA\u05D5\u05E2\u05DC\u05EA \u05E6\u05D9\u05D1\u05D5\u05E8 \u05D4\u05D2\u05D5\u05DC\u05E9\u05D9\u05DD. \u05D0\u05EA\u05DD \u05DE\u05D5\u05D6\u05DE\u05E0\u05D9\u05DD \u05DC\u05D4\u05D5\u05E1\u05D9\u05E3 \u05D0\u05EA \u05D3\u05E3 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DC\u05E1\u05E4\u05E8\u05D9\u05D9\u05D4 \u05E9\u05DC\u05E0\u05D5 \u2013 \u05EA\u05D5\u05DB\u05DC\u05D5 \u05DC\u05DE\u05E6\u05D5\u05D0 \u05D1\u05D4 \u05DC\u05DE\u05E2\u05DC\u05D4 \u05DE\u05BE200,000 \u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05E0\u05D5\u05E6\u05E8\u05D5 \u05E2\u05DC \u05D9\u05D3\u05D9 \u05D2\u05D5\u05DC\u05E9\u05D9 \u05D4\u05D0\u05EA\u05E8.",
    heImg: "/static/img/sheets-landing-page/shareyoursheets_HEB.jpg",
    heImgAlt: "\u05E9\u05EA\u05E4\u05D5",
    borderColor: "#802F3E"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Find Great Resources",
    enText: "Browse user-created sheets by topic to research for your next class, learn something new, or to get inspiration for your own sheets. Filter results further by keyword and sort by relevance, views, or creation date.",
    enImg: "/static/img/sheets-landing-page/sheetssearch.jpg",
    enImgAlt: "Find Great Resources",
    heTitle: "\u05D0\u05EA\u05E8\u05D5 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DE\u05E2\u05D5\u05DC\u05D9\u05DD",
    heText: "\u05DB\u05D3\u05D9 \u05DC\u05D4\u05E2\u05E9\u05D9\u05E8 \u05D0\u05EA \u05D4\u05E9\u05D9\u05E2\u05D5\u05E8 \u05D4\u05D1\u05D0 \u05E9\u05DC\u05DB\u05DD, \u05DC\u05DC\u05DE\u05D5\u05D3 \u05DE\u05E9\u05D4\u05D5 \u05D7\u05D3\u05E9 \u05D0\u05D5 \u05DC\u05D7\u05E4\u05E9 \u05D4\u05E9\u05E8\u05D0\u05D4 \u05DC\u05D3\u05E3 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DE\u05E9\u05DC\u05DB\u05DD, \u05D3\u05E4\u05D3\u05E4\u05D5 \u05DC\u05E4\u05D9 \u05E0\u05D5\u05E9\u05D0 \u05D1\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05D9\u05E6\u05E8\u05D5 \u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05D0\u05D7\u05E8\u05D9\u05DD. \u05E1\u05E0\u05E0\u05D5 \u05D0\u05EA \u05D4\u05EA\u05D5\u05E6\u05D0\u05D5\u05EA \u05DC\u05E4\u05D9 \u05DE\u05D9\u05DC\u05D5\u05EA \u05DE\u05E4\u05EA\u05D7 \u05D0\u05D5 \u05DC\u05E4\u05D9 \u05E8\u05DC\u05D5\u05D5\u05E0\u05D8\u05D9\u05D5\u05EA, \u05EA\u05E6\u05D5\u05D2\u05D4 \u05D0\u05D5 \u05EA\u05D0\u05E8\u05D9\u05DA.",
    heImg: "/static/img/sheets-landing-page/sheetssearch_HEB.jpg",
    heImgAlt: "\u05D0\u05EA\u05E8\u05D5 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DE\u05E2\u05D5\u05DC\u05D9\u05DD",
    borderColor: "#5A99B7"
  }), /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "See what people are making with Sheets",
    he: "\u05E8\u05D0\u05D5 \u05DE\u05D4 \u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05D0\u05D7\u05E8\u05D9\u05DD \u05D9\u05D5\u05E6\u05E8\u05D9\u05DD \u05D1\u05E2\u05D6\u05E8\u05EA \u05D3\u05E4\u05D9 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05DC\u05D4\u05DD"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Section, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Sheet, {
    title: "Creation and Consciousness",
    link: "/sheets/17566?lang=bi&utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets",
    author: "Michael Feuer",
    image: "/static/img/sheets-landing-page/michael.png"
  }), /*#__PURE__*/external_react_default().createElement(StaticPages_Sheet, {
    title: "Is Love the Death of Duty? A Tanakh Take on the Game of Thrones Maxim",
    link: "/sheets/184685?lang=bi&utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets",
    author: "Olivia Friedman",
    image: "/static/img/sheets-landing-page/olivia.png"
  }), /*#__PURE__*/external_react_default().createElement(StaticPages_Sheet, {
    title: "Practical Torah for Time Management",
    link: "/sheets/193023?utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets",
    author: "Loren Berman (Moishe House)",
    image: "/static/img/sheets-landing-page/loren.png"
  }), /*#__PURE__*/external_react_default().createElement(StaticPages_Sheet, {
    title: "The Four (Thousand) Questions: Cultivating Question-Asking at Your Pesach Seder",
    link: "/sheets/9219?lang=bi&utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets",
    author: "Dasi Fruchter",
    image: "/static/img/sheets-landing-page/dasi.png"
  }))), /*#__PURE__*/external_react_default().createElement(HeBlock, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Section, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Sheet, {
    title: "\u05EA\u05E4\u05D9\u05DC\u05EA \u05D4\u05D3\u05E8\u05DA",
    link: "/sheets/216261?lang=he&utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets_HEB",
    author: "\u05D0\u05EA\u05E8 \u05DE\u05D3\u05E8\u05E9\u05EA",
    image: "/static/img/sheets-landing-page/midreshet.png"
  }), /*#__PURE__*/external_react_default().createElement(StaticPages_Sheet, {
    title: "\u05DB\u05D9\u05E6\u05D3 \u05DC\u05DE\u05D3 \u05D4\u05D1\u05E2\u05DC \u05E9\u05DD \u05D8\u05D5\u05D1 \u05D0\u05EA \u05D4\u05EA\u05D5\u05E8\u05D4?",
    link: "/sheets/112651?lang=he&utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets_HEB",
    author: "\u05D9\u05DB\u05D9\u05DF \u05D0\u05E4\u05E9\u05D8\u05D9\u05D9\u05DF (\u05D6\u05D5\u05E9\u05D0: \u05DE\u05D2\u05DC\u05D9\u05DD \u05D0\u05EA \u05D4\u05E1\u05D9\u05E4\u05D5\u05E8 \u05D4\u05D7\u05E1\u05D9\u05D3\u05D9)",
    image: "/static/img/sheets-landing-page/yachin.png"
  }), /*#__PURE__*/external_react_default().createElement(StaticPages_Sheet, {
    title: "\u05D9\u05DC\u05D3\u05D9\u05DD \u05E8\u05D5\u05D0\u05D9\u05DD \u05D0\u05EA \u05E2\u05E6\u05DE\u05DD \u05DB\u05D0\u05D9\u05DC\u05D5 \u05D9\u05E6\u05D0\u05D5 \u05DE\u05DE\u05E6\u05E8\u05D9\u05DD",
    link: "/sheets/222661?lang=he&utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets_HEB",
    author: "\u05D7\u05D3\u05D5\u05D4 \u05D9\u05D7\u05D9\u05D0\u05DC\u05D9",
    image: "/static/img/sheets-landing-page/hedva.png"
  }), /*#__PURE__*/external_react_default().createElement(StaticPages_Sheet, {
    title: "\u05DE\u05E2\u05E9\u05D4 \u05D1\u05E8\u05D1\u05D9 \u05D9\u05E9\u05DE\u05E2\u05D0\u05DC",
    link: "/sheets/141399?lang=he&utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets_HEB",
    author: "\u05D9\u05D5\u05E8\u05DD \u05D2\u05DC\u05D9\u05DC\u05D9 (\u05D1\u05D5\u05D0\u05D5 \u05E0\u05DC\u05DE\u05D3 \u05DE\u05E9\u05E4\u05D8 \u05D5\u05D9\u05D5\u05E9\u05E8)",
    image: "/static/img/sheets-landing-page/yoram.png"
  }))), /*#__PURE__*/external_react_default().createElement(StaticPages_Section, null, /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    he: "\u05D7\u05E4\u05E9\u05D5 \u05E2\u05D5\u05D3 \u05DC\u05E4\u05D9 \u05E0\u05D5\u05E9\u05D0",
    en: "Explore More by Topic",
    href: "/topics?utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets",
    he_href: "/topics?utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets_HEB"
  })), /*#__PURE__*/external_react_default().createElement(Spacer, null), /*#__PURE__*/external_react_default().createElement(CallToActionFooterWithButton, {
    href: "/sheets/228095?utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets",
    he_href: "/sheets/226003?utm_source=Sefaria&utm_medium=LandingPage&utm_campaign=Sheets_HEB",
    enText: "Start creating a sheet today.",
    heText: "\u05E6\u05E8\u05D5 \u05D3\u05E3 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D4\u05D9\u05D5\u05DD",
    enButtonText: "How to Create a Sheet",
    heButtonText: "\u05D0\u05D9\u05DA \u05D9\u05D5\u05E6\u05E8\u05D9\u05DD \u05D3\u05E3 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA"
  }));
};
var RemoteLearningPage = function RemoteLearningPage() {
  return /*#__PURE__*/external_react_default().createElement(StaticPage, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Header, {
    enTitle: "Remote Learning",
    enText: "Discover the power of online education. Sefaria is always available to provide foundational Jewish texts, educational materials, and the tools to allow you to engage with dynamic Jewish learning.",
    enImg: "/static/img/distance-learning-landing-page/remotelearning_headerimage.png",
    enImgAlt: "Sefaria on tablet.",
    enActionURL: null,
    enActionText: null,
    heTitle: "\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DC\u05DC\u05D9\u05DE\u05D5\u05D3 \u05D5\u05DC\u05DC\u05DE\u05D9\u05D3\u05D4 \u05DE\u05E8\u05D7\u05D5\u05E7",
    heText: "\u05DC\u05D5\u05DE\u05D3\u05D9\u05DD \u05E8\u05D1\u05D9\u05DD \u05D1\u05E8\u05D7\u05D1\u05D9 \u05D4\u05E2\u05D5\u05DC\u05DD \u05DE\u05D2\u05DC\u05D9\u05DD \u05D0\u05EA \u05D4\u05DB\u05D5\u05D7 \u05D5\u05D4\u05E4\u05D5\u05D8\u05E0\u05E6\u05D9\u05D0\u05DC \u05E9\u05D9\u05E9 \u05D1\u05DC\u05DE\u05D9\u05D3\u05D4 \u05DE\u05E7\u05D5\u05D5\u05E0\u05EA. \u05D0\u05EA\u05E8 \u05E1\u05E4\u05E8\u05D9\u05D0 \u05E4\u05EA\u05D5\u05D7 \u05DC\u05DB\u05D5\u05DC\u05DD \u05D1\u05D7\u05D9\u05E0\u05DD, \u05D5\u05DE\u05E6\u05D9\u05E2 \u05DE\u05D0\u05D2\u05E8 \u05E8\u05D7\u05D1 \u05E9\u05DC \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD \u05D5\u05DB\u05DC\u05D9\u05DD \u05DE\u05EA\u05E7\u05D3\u05DE\u05D9\u05DD \u05DC\u05D4\u05E2\u05E6\u05DE\u05EA \u05D4\u05DC\u05DE\u05D9\u05D3\u05D4.",
    heImg: "/static/img/distance-learning-landing-page/remotelearningpage_headerimage_HEB.png",
    heImgAlt: "Sefaria on tablet.",
    heActionURL: null,
    heActionText: null
  }), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    enTitle: "Browse our Latest Resources",
    heTitle: "\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0"
  }, /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "/collections/educator-newsletters?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he_href: "/sheets/219410?lang=he?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he: "\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D0\u05E7\u05D8\u05D5\u05D0\u05DC\u05D9\u05D9\u05DD",
    en: "Educator Newsletters"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "/sheets/227733?lang=bi?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he_href: "/sheets/227981.5?lang=he&utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he: "\u05E0\u05D2\u05D9\u05E3 \u05D4\u05E7\u05D5\u05E8\u05D5\u05E0\u05D4",
    en: "A Jewish Response to COVID-19"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "/collections/KGvMhYW3#?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he_href: "/collections/KGvMhYW3?lang=he&utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he: "\u05E2\u05E9\u05E8\u05EA \u05D4\u05D3\u05D9\u05D1\u05E8\u05D5\u05EA \u05DC\u05DC\u05DE\u05D9\u05D3\u05D4 \u05DE\u05E8\u05D7\u05D5\u05E7",
    en: "Online Learning Resources"
  }))), /*#__PURE__*/external_react_default().createElement(GreyBox, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Resources for Everyone",
    he: "\u05DC\u05D5\u05DE\u05D3\u05D9\u05DD \u05E2\u05DD \u05E1\u05E4\u05E8\u05D9\u05D0"
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Learners",
    enText: "Whether you\u2019re a pro, or a new user, Sefaria has resources to help your virtual study thrive. Join a Sefaria 101 webinar, browse our tutorials, or sign up for the online student training course to up your skills on all things Sefaria. <a href='/register?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning'>Create a free account</a> to track your learning, save texts, and follow users creating things that interest you.",
    enImg: "/static/img/distance-learning-landing-page/remotelearningpage_learners.png",
    enImgAlt: "Source Sheet - Pesach 101",
    heTitle: "\u05DC\u05D5\u05DE\u05D3\u05D9\u05DD \u05E2\u05DD \u05E1\u05E4\u05E8\u05D9\u05D0",
    heText: "ספריא נותנת כלים להעצים את הלימוד המקוון שלכם. השתמשו בוובינרים וב'מדריך למשתמש המתחיל' כדי ללמוד איך להשתמש באתר. " + "<a href='/register?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning'>" + "צרו חשבון משתמש" + "</a>" + " כדי לארגן את חומרי הלימוד שלכם, לשמור מקורות ולעקוב אחר חומרים של אנשים אחרים שמעניינים אתכם.",
    heImg: "/static/img/distance-learning-landing-page/remotelearningpage_learners_HEB.png",
    heImgAlt: "",
    borderColor: "#004E5F"
  }), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "/collections/webinars-for-learners?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he_href: "/sheets/224909?lang=he?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he: "\u05D5\u05D5\u05D1\u05D9\u05E0\u05E8\u05D9\u05DD",
    en: "Webinars for Learners"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "/collections/sefaria-faqs?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he_href: "/sheets/224919?lang=he?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he: "\u05DE\u05D3\u05E8\u05D9\u05DA \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9 \u05D4\u05DE\u05EA\u05D7\u05D9\u05DC",
    en: "Tutorials for Learners"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "/collections/sefaria-student-course?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he_href: "/sheets/228260?lang=he&utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he: "\u05D4\u05E1\u05D5\u05D3\u05D5\u05EA \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0",
    en: "Student Course"
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Educators & Rabbis",
    enText: "Sefaria is here to support your online teaching. Our <a href='/educators?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning'>Learning Department</a> has a variety of resources to get you started with distance learning using Sefaria. <a href='/register?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning'>Create a free account</a> to make and assign source sheets to your students, organize your sheets into groups, and save texts.",
    enImg: "/static/img/distance-learning-landing-page/remotelearningpage_educators.png",
    enImgAlt: "Source Sheet - Teaching with Sefaria Online",
    heTitle: "\u05DE\u05D5\u05E8\u05D9\u05DD \u05D5\u05D0\u05E0\u05E9\u05D9 \u05D4\u05D5\u05E8\u05D0\u05D4",
    heText: "צוות ספריא תומך בהוראה דיגיטלית ובהוראה מרחוק. למדו בעזרת החומרים שצוות החינוך שלנו יצר עבורכם, בכיתה ומחוצה לה. " + "<a href='/register?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning'>" + "צרו חשבון משתמש" + "</a>" + ' כדי ליצור דפי מקורות עבורכם או עבור תלמידים, לארגן דפי מקורות ע"פי נושאים ולשמור מקורות נבחרים.',
    heImg: "/static/img/distance-learning-landing-page/remotelearningpage_educators_HEB.png",
    heImgAlt: "",
    borderColor: "#CCB479"
  }), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "/collections/webinars-for-educators?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he_href: "/sheets/224909?lang=he?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he: "\u05D5\u05D5\u05D1\u05D9\u05E0\u05E8\u05D9\u05DD",
    en: "Webinars for Educators"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "/collections/tutorials-for-educators?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he_href: "/sheets/224923?lang=he?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he: "\u05E7\u05D5\u05E8\u05E1 \u05DC\u05DE\u05D5\u05E8\u05D9\u05DD: '\u05E1\u05E4\u05E8\u05D9\u05D0 \u05D1\u05DB\u05D9\u05EA\u05D4'",
    en: "Tutorials for Educators"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    rounded: false,
    tall: true,
    href: "https://sefaria.typeform.com/to/tJVexqpG?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he_href: "/sheets/223245?lang=he?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he: "\u05D8\u05D9\u05E4\u05D9\u05DD \u05DC\u05D4\u05D5\u05E8\u05D0\u05D4 \u05E2\u05DD \u05E1\u05E4\u05E8\u05D9\u05D0",
    en: "Educator Course"
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Institutions & Organizations",
    enText: "Is it time to start incorporating digital texts into your website, blog, or app? Sefaria has you covered. All of our software is open source and our texts are all in the creative commons \u2013 meaning you can use anything we have for your own projects. Take a look at these resources and get in touch with your web/app developer to start including Sefaria\u2019s texts on your site.",
    enImg: "/static/img/distance-learning-landing-page/remotelearningpage_developers.png",
    enImgAlt: "Source Sheet - Link Sefaria to your Site",
    heTitle: "\u05DE\u05D5\u05E1\u05D3\u05D5\u05EA \u05D5\u05D0\u05E8\u05D2\u05D5\u05E0\u05D9\u05DD",
    heText: "\u05D4\u05D0\u05DD \u05EA\u05E8\u05E6\u05D5 \u05DC\u05D4\u05D8\u05DE\u05D9\u05E2 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9\u05D9\u05DD \u05DC\u05D0\u05EA\u05E8, \u05DC\u05D1\u05DC\u05D5\u05D2 \u05D0\u05D5 \u05DC\u05D0\u05E4\u05DC\u05D9\u05E7\u05E6\u05D9\u05D4 \u05E9\u05DC\u05DB\u05DD? \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D9\u05DB\u05D5\u05DC\u05D4 \u05DC\u05E1\u05D9\u05D9\u05E2 \u05DC\u05DB\u05DD. \u05DB\u05DC \u05D4\u05DE\u05D9\u05D3\u05E2 \u05E9\u05D9\u05E9 \u05D1\u05D0\u05EA\u05E8 \u05D4\u05D9\u05E0\u05D5 \u05D1\u05E7\u05D5\u05D3 \u05E4\u05EA\u05D5\u05D7, \u05D5\u05EA\u05D5\u05DB\u05DC\u05D5 \u05DC\u05D4\u05E9\u05EA\u05DE\u05E9 \u05D1\u05DB\u05DC \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05E2\u05D1\u05D5\u05E8 \u05D4\u05E4\u05E8\u05D5\u05D9\u05D9\u05E7\u05D8\u05D9\u05DD \u05D4\u05D0\u05D9\u05E9\u05D9\u05D9\u05DD \u05E9\u05DC\u05DB\u05DD. \u05D0\u05EA\u05DD \u05DE\u05D5\u05D6\u05DE\u05E0\u05D9\u05DD \u05DC\u05E4\u05E0\u05D5\u05EA \u05DC\u05DE\u05E4\u05EA\u05D7\u05D9\u05DD \u05D5\u05DC\u05DE\u05D4\u05E0\u05D3\u05E1\u05D9\u05DD \u05E9\u05DC\u05DB\u05DD \u05D1\u05DB\u05D3\u05D9 \u05DC\u05D4\u05E9\u05EA\u05DE\u05E9 \u05D1\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D1\u05D0\u05EA\u05E8 \u05E9\u05DC\u05DB\u05DD.",
    heImg: "/static/img/distance-learning-landing-page/remotelearningpage_developers_HEB.png",
    heImgAlt: "",
    borderColor: "#802F3E"
  }), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    tall: true,
    rounded: false,
    href: "/linker?utm_source=sefaria&utm_medium=landingpage&utm_campaign=remotelearning",
    he: "\u05DC\u05D9\u05E0\u05E7\u05E8 \u05D3\u05D5 \u05E6\u05D3\u05D3\u05D9",
    en: "Two-Way Linker"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    tall: true,
    rounded: false,
    href: "https://github.com/Sefaria/Sefaria-Project/wiki/Projects-Powered-by-Sefaria",
    he: "\u05D0\u05EA\u05E8\u05D9\u05DD \u05D4\u05DE\u05D5\u05E4\u05E2\u05DC\u05D9\u05DD \u05E2\u201D\u05D9 \u05E1\u05E4\u05E8\u05D9\u05D0",
    en: "Powered by Sefaria"
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: true,
    tall: true,
    rounded: false,
    href: "https://github.com/Sefaria/Sefaria-Project/wiki#developers",
    he: "Github \u05D2\u05D9\u05D8\u05D4\u05D0\u05D1",
    en: "GitHub"
  })), /*#__PURE__*/external_react_default().createElement(CallToActionFooterWithNewsletter, {
    enText: "Sign up for our mailing list to get updates in your inbox.",
    heText: "\u05D4\u05E8\u05E9\u05DE\u05D5 \u05DC\u05E8\u05E9\u05D9\u05DE\u05EA \u05D4\u05EA\u05E4\u05D5\u05E6\u05D4 \u05E9\u05DC\u05E0\u05D5 \u05E2\u05DC \u05DE\u05E0\u05EA \u05DC\u05E7\u05D1\u05DC \u05E2\u05D3\u05DB\u05D5\u05E0\u05D9\u05DD \u05DE\u05E1\u05E4\u05E8\u05D9\u05D0.",
    includeEducatorOption: true
  }));
};
var EducatorsPage = function EducatorsPage() {
  return /*#__PURE__*/external_react_default().createElement(StaticPage, null, /*#__PURE__*/external_react_default().createElement(HeaderForEducatorsPage, null), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Empower and Engage",
    he: "\u05DE\u05E1\u05E2 \u05E9\u05DC \u05D2\u05D9\u05DC\u05D5\u05D9"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Empower your students with Sefaria\u2019s free library of digital texts, in Hebrew and English translation, and use our teaching materials to spark creativity and foster independence. Learn new ways of teaching and engaging your students in the centuries-old conversation around Jewish texts, and join Sefaria\u2019s Educator community.")), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "            \u05D3\u05DE\u05D9\u05D9\u05E0\u05D5 \u05D0\u05EA \u05D4\u05EA\u05DC\u05DE\u05D9\u05D3\u05D9\u05DD \u05E9\u05DC\u05DB\u05DD  \u05DE\u05D8\u05D9\u05D9\u05DC\u05D9\u05DD \u05D1\u05DE\u05E1\u05D3\u05E8\u05D5\u05E0\u05D5\u05EA \u05E1\u05E4\u05E8\u05D9\u05D9\u05EA \u05E2\u05E0\u05E7 \u05D5\u05E9\u05D5\u05DC\u05E4\u05D9\u05DD \u05E1\u05E4\u05E8\u05D9\u05DD \u05E2\u05EA\u05D9\u05E7\u05D9\u05DD \u05D5\u05D7\u05D3\u05E9\u05D9\u05DD \u05D1\u05D4\u05DD \u05DE\u05EA\u05D2\u05DC\u05D9\u05DD \u05D3\u05DE\u05D5\u05D9\u05D5\u05EA, \u05E8\u05E2\u05D9\u05D5\u05E0\u05D5\u05EA \u05D5\u05DE\u05D7\u05E9\u05D1\u05D5\u05EA \u05DE\u05EA\u05D5\u05DA \u05D4\u05E2\u05D5\u05DC\u05DD \u05D4\u05D9\u05D4\u05D5\u05D3\u05D9 \u05E9\u05E0\u05DB\u05EA\u05D1\u05D5 \u05D1\u05DE\u05E9\u05DA 3000 \u05E9\u05E0\u05D4. \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0 \u05D4\u05D7\u05DC\u05D5\u05DD \u05D4\u05D5\u05E4\u05DA \u05DC\u05DE\u05E6\u05D9\u05D0\u05D5\u05EA. \u05D4\u05D5\u05D1\u05D9\u05DC\u05D5 \u05D0\u05EA \u05D4\u05EA\u05DC\u05DE\u05D9\u05D3\u05D9\u05DD \u05DC\u05DE\u05E1\u05E2 \u05E9\u05DC \u05D2\u05D9\u05DC\u05D5\u05D9 \u05D5\u05DC\u05DE\u05D9\u05D3\u05D4 \u05D1\u05D9\u05DF \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05DC \u05D0\u05E8\u05D5\u05DF \u05D4\u05E1\u05E4\u05E8\u05D9\u05DD \u05D4\u05D9\u05D4\u05D5\u05D3\u05D9.")), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Professional Development",
    enText: "Whether you\u2019re a pro or a new user, Sefaria has resources to help you and your students learn and thrive. Join a Sefaria webinar, browse our tutorials, sign up for our Educator course, or request a custom workshop for your team or your students.",
    enImg: "/static/img/educators-landing-page/teaching-with-sefaria-library.png",
    enImgAlt: "Professional Development",
    heTitle: "\u05D0\u05D9\u05DA \u05DC\u05D4\u05E9\u05EA\u05DE\u05E9 \u05D1\u05D0\u05EA\u05E8?",
    heText: "\u05E0\u05EA\u05D7\u05D9\u05DC \u05D1\u05D4\u05EA\u05D7\u05DC\u05D4: \"\u05D4\u05DE\u05D3\u05E8\u05D9\u05DA \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9 \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0\" \u05DE\u05D5\u05E8\u05DB\u05D1 \u05DE\u05D9\u05D7\u05D9\u05D3\u05D5\u05EA \u05DE\u05D5\u05D3\u05E8\u05DB\u05D5\u05EA \u05D1\u05D4\u05DF \u05E0\u05DC\u05DE\u05D3\u05D5\u05EA \u05E6\u05E2\u05D3 \u05D0\u05D7\u05E8 \u05E6\u05E2\u05D3 \u05D4\u05D0\u05E4\u05E9\u05E8\u05D5\u05D9\u05D5\u05EA \u05D4\u05E9\u05D5\u05E0\u05D5\u05EA \u05D1\u05D0\u05EA\u05E8 \u05E1\u05E4\u05E8\u05D9\u05D0. \u05D1\u05D0\u05E1\u05D5\u05E4\u05D4 \"\u05E1\u05E4\u05E8\u05D9\u05D0 \u05DC\u05EA\u05DC\u05DE\u05D9\u05D3\u05D9\u05DD\" \u05E0\u05DE\u05E6\u05D0\u05D5\u05EA \u05D4\u05D3\u05E8\u05DB\u05D5\u05EA \u05E2\u05DC \u05D4\u05E9\u05D9\u05DE\u05D5\u05E9 \u05D1\u05D0\u05EA\u05E8 \u05E9\u05DE\u05D5\u05EA\u05D0\u05DE\u05D5\u05EA \u05D1\u05DE\u05D9\u05D5\u05D7\u05D3 \u05E2\u05D1\u05D5\u05E8 \u05DC\u05DE\u05D9\u05D3\u05D4 \u05E2\u05E6\u05DE\u05D0\u05D9\u05EA \u05E9\u05DC \u05EA\u05DC\u05DE\u05D9\u05D3\u05D9\u05DD. \u05DB\u05D3\u05D9 \u05DC\u05DC\u05DE\u05D5\u05D3 \u05D5\u05DC\u05D4\u05DB\u05D9\u05E8 \u05D7\u05DC\u05E7 \u05DE\u05E1\u05D5\u05D9\u05DD \u05D1\u05D0\u05EA\u05E8 \u05EA\u05D5\u05DB\u05DC\u05D5 \u05DC\u05D4\u05E9\u05EA\u05DE\u05E9 \u05D1\u05D0\u05E1\u05D5\u05E4\u05D4 \u05E9\u05DC \"\u05E9\u05D0\u05DC\u05D5\u05EA \u05E0\u05E4\u05D5\u05E6\u05D5\u05EA\".",
    heImg: "/static/img/educators-landing-page/teaching-with-sefaria-library-heb.png",
    heImgAlt: "Professional Development",
    borderColor: sefaria_palette.colors.darkblue
  }), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    white: true,
    enTitle: "",
    heTitle: ""
  }, [["Online Educator Course", "מדריך למשתמש בספריא", "https://sefaria.typeform.com/to/tJVexqpG", "https://www.sefaria.org.il/sheets/361600?lang=he"], ["Lesson Plans on Sefaria", "ספריא לתלמידים", "/collections/pedagogy-on-sefaria-exemplary-lesson-plans", "https://www.sefaria.org.il/collections/KGMlHrvA"], ["Schedule A Workshop", "שאלות נפוצות", "https://sefaria.typeform.com/to/Pl3biam8", "https://www.sefaria.org.il/collections/%D7%A9%D7%90%D7%9C%D7%95%D7%AA-%D7%A0%D7%A4%D7%95%D7%A6%D7%95%D7%AA-%D7%91%D7%A1%D7%A4%D7%A8%D7%99%D7%90"]].map(function (i) {
    return /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: false,
      tall: true,
      newTab: true,
      href: i[2],
      he_href: i[3],
      he: i[1],
      en: i[0]
    });
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Resources for Educators",
    enText: "Stay up to date with the latest news and resources from Sefaria. Learn from other educators\u2019 experiences teaching and using Sefaria\u2019s resources, and get inspired to try new things in your work. Discover our adaptable lesson plans and resources, or find learning materials and activities ready-to-go for your classroom!",
    enImg: "/static/img/educators-landing-page/megillah-activity.png",
    enImgAlt: "Resources for Educators",
    heTitle: "\u05DE\u05E2\u05E8\u05DB\u05D9 \u05E9\u05D9\u05E2\u05D5\u05E8 \u05D5\u05D7\u05D5\u05DE\u05E8\u05D9 \u05D4\u05D5\u05E8\u05D0\u05D4",
    heText: "\u05E6\u05D5\u05D5\u05EA \u05D4\u05D7\u05D9\u05E0\u05D5\u05DA \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D9\u05E6\u05E8 \u05D5\u05D0\u05E1\u05E3 \u05E2\u05D1\u05D5\u05E8\u05DB\u05DD \u05D4\u05DE\u05D5\u05E8\u05D9\u05DD, \u05D7\u05D5\u05DE\u05E8\u05D9 \u05D4\u05D5\u05E8\u05D0\u05D4 \u05D1\u05E2\u05D6\u05E8\u05EA\u05DD \u05EA\u05D5\u05DB\u05DC\u05D5 \u05DC\u05D4\u05E2\u05E9\u05D9\u05E8 \u05D5\u05DC\u05D4\u05E2\u05DE\u05D9\u05E7 \u05D0\u05EA \u05D4\u05DC\u05DE\u05D9\u05D3\u05D4. <br><br>\u05DC\u05E4\u05E0\u05D9\u05DB\u05DD \u05D0\u05E1\u05D5\u05E4\u05D4 \u05E9\u05DC \u05DE\u05E2\u05E8\u05DB\u05D9 \u05E9\u05D9\u05E2\u05D5\u05E8 \u05D1\u05E0\u05D5\u05E9\u05D0\u05D9\u05DD \u05E9\u05D5\u05E0\u05D9\u05DD, \u05D4\u05E6\u05E2\u05D4 \u05DC\u05EA\u05D4\u05DC\u05D9\u05DA \u05E9\u05DC \u05E2\u05D1\u05D5\u05D3\u05EA \u05D7\u05E7\u05E8 \u05D1\u05D0\u05DE\u05E6\u05E2\u05D5\u05EA \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D5\u05E8\u05E2\u05D9\u05D5\u05E0\u05D5\u05EA \u05DC\u05D4\u05E2\u05E8\u05DB\u05D4 \u05D7\u05DC\u05D5\u05E4\u05D9\u05EA.",
    heImg: "/static/img/educators-landing-page/369968.png",
    heImgAlt: "",
    borderColor: sefaria_palette.colors.gold,
    link: ""
  }), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    white: true,
    enTitle: "",
    heTitle: ""
  }, [["Past Educator Newsletters", "10 רעיונות להערכה חלופית", "/collections/qZ0UWi5y", "https://www.sefaria.org.il/sheets/281661?lang=he"], ["Sefaria in Action", "עבודת חקר: מסע בין מקורות", "/sheets/311116?lang=bi", "https://www.sefaria.org.il/collections/%D7%A2%D7%91%D7%95%D7%93%D7%AA-%D7%97%D7%A7%D7%A8-%D7%91%D7%A1%D7%A4%D7%A8%D7%99%D7%90-%D7%9E%D7%A1%D7%A2-%D7%91%D7%99%D7%9F-%D7%9E%D7%A7%D7%95%D7%A8%D7%95%D7%AA"], ["For Your Students", "מערכי שיעור", "/sheets/311291?lang=bi", "https://www.sefaria.org.il/sheets/361593?lang=he"]].map(function (i) {
    return /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: false,
      tall: true,
      newTab: true,
      href: i[2],
      he_href: i[3],
      he: i[1],
      en: i[0]
    });
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Sefaria for Educators How-Tos",
    enText: "Browse our FAQ\u2019s and learn more about how to use Sefaria\u2019s tools to study and to teach. Sefaria\u2019s Learning Team is always available to support you and your students or answer any questions you might have. If there are texts, translations, lesson plans, or student materials that would enhance your teaching, please share that with us as well.",
    enImg: "/static/img/educators-landing-page/tutorials-for-educators.png",
    enImgAlt: "Sefaria for Educators How-Tos",
    heTitle: "\u05D2\u05DD \u05D0\u05EA \u05D6\u05D4 \u05D9\u05E9 \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0! \u05D0\u05DC \u05EA\u05D7\u05DE\u05D9\u05E6\u05D5!",
    heText: "\u05DE\u05D0\u05D2\u05E8 \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D4\u05D5\u05D0 \u05D2\u05D3\u05D5\u05DC \u05D5\u05D1\u05EA\u05D5\u05DB\u05D5 \u05D0\u05E4\u05E9\u05E8\u05D5\u05D9\u05D5\u05EA \u05DC\u05D9\u05DE\u05D5\u05D3 \u05E8\u05D1\u05D5\u05EA. \u05DE\u05D5\u05D6\u05DE\u05E0\u05D9\u05DD \u05DC\u05E2\u05D9\u05D9\u05DF \u05D1\u05D0\u05E1\u05D5\u05E4\u05D5\u05EA \u05DE\u05E2\u05E0\u05D9\u05D9\u05E0\u05D5\u05EA \u05D5\u05E9\u05D9\u05DE\u05D5\u05E9\u05D9\u05D5\u05EA, \u05DC\u05D4\u05DB\u05D9\u05E8 \u05D0\u05EA \u05E2\u05DE\u05D5\u05D3 \u05D4\u05E7\u05D4\u05D9\u05DC\u05D4 \u05D5\u05D4\u05EA\u05DB\u05E0\u05D9\u05DD \u05E9\u05D1\u05D5 \u05D5\u05D2\u05DD \u05DC\u05D2\u05DC\u05D5\u05EA \u05D0\u05EA \"\u05D4\u05E1\u05D5\u05D3\u05D5\u05EA \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0\"",
    heImg: "/static/img/educators-landing-page/228260.png",
    heImgAlt: "",
    borderColor: sefaria_palette.colors.red
  }), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    white: true,
    enTitle: "",
    heTitle: ""
  }, [["Educator FAQ", "אסופות מומלצות", "/collections/tutorials-for-educators", "https://www.sefaria.org.il/sheets/360599?lang=he"], ["Request New Resources", "עמוד הקהילה", "https://sefaria.typeform.com/to/aaZmi4JD", "https://www.sefaria.org.il/community"], ["Webinars for Educators", "הסודות של ספריא", "/collections/qJLU68HQ", "https://www.sefaria.org.il/sheets/228260.2?lang=he"]].map(function (i) {
    return /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: false,
      tall: true,
      newTab: true,
      href: i[2],
      he_href: i[3],
      he: i[1],
      en: i[0]
    });
  })), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Get in touch",
    he: "\u05D0\u05E0\u05D7\u05E0\u05D5 \u05E8\u05D5\u05E6\u05D9\u05DD \u05DC\u05E9\u05DE\u05D5\u05E2 \u05DE\u05DB\u05DD"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Was your teaching enhanced by Sefaria? Did you have a \u201CSefaria moment\u201D with your students? Share it with us! We love to hear how educators are using Sefaria in the field and we learn from the feedback we receive. We are also available to answer all of your Sefaria questions. Write to us at education@sefaria.org.")), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\u05D0\u05E0\u05D7\u05E0\u05D5 \u05DC\u05D5\u05DE\u05D3\u05D9\u05DD \u05E8\u05D1\u05D5\u05EA \u05DE\u05DE\u05D5\u05E8\u05D9\u05DD \u05D5\u05EA\u05DC\u05DE\u05D9\u05D3\u05D9\u05DD \u05E9\u05DE\u05E1\u05E4\u05E8\u05D9\u05DD \u05DC\u05E0\u05D5 \u05E2\u05DC \u05D4\u05D4\u05EA\u05E0\u05E1\u05D5\u05EA \u05E9\u05DC\u05D4\u05DD \u05E2\u05DD \u05E1\u05E4\u05E8\u05D9\u05D0. \u05E0\u05E9\u05DE\u05D7 \u05DE\u05D0\u05D3 \u05D0\u05DD \u05EA\u05E9\u05EA\u05E4\u05D5 \u05D0\u05D5\u05EA\u05E0\u05D5 \u05D1\u05D7\u05D5\u05D5\u05D9\u05D9\u05EA \u05D4\u05DC\u05D9\u05DE\u05D5\u05D3 \u05E9\u05DC\u05DB\u05DD. \u05D0\u05EA\u05DD \u05DE\u05D5\u05D6\u05DE\u05E0\u05D9\u05DD \u05DC\u05D9\u05E6\u05D5\u05E8 \u05D0\u05D9\u05EA\u05E0\u05D5 \u05E7\u05E9\u05E8 \u05DB\u05D3\u05D9 \u05DC\u05EA\u05D0\u05DD \u05D4\u05D3\u05E8\u05DB\u05D4 \u05DC\u05DE\u05D5\u05E8\u05D9\u05DD \u05D5\u05D2\u05DD \u05DC\u05EA\u05DC\u05DE\u05D9\u05D3\u05D9\u05DD,  \u05DC\u05E1\u05E4\u05E8 \u05DC\u05E0\u05D5 \u05E2\u05DC \u05D7\u05D5\u05D5\u05D9\u05D9\u05EA \u05D4\u05DC\u05DE\u05D9\u05D3\u05D4 \u05E2\u05DD \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D5\u05DC\u05D4\u05EA\u05D9\u05D9\u05E2\u05E5 \u05D0\u05D9\u05EA\u05E0\u05D5 \u05D1\u05DB\u05DC \u05D3\u05D1\u05E8 \u05D5\u05E2\u05E0\u05D9\u05D9\u05DF"), /*#__PURE__*/external_react_default().createElement("p", null, "\u05DB\u05EA\u05D1\u05D5 \u05DC\u05E0\u05D5 \u05DC\u05DB\u05EA\u05D5\u05D1\u05EA \u05D4\u05DE\u05D9\u05D9\u05DC hello@sefaria.org")), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "What the educators have to say\u2026",
    he: "\u05DE\u05D5\u05E8\u05D9\u05DD \u05D5\u05EA\u05DC\u05DE\u05D9\u05D3\u05D9\u05DD \u05DE\u05DE\u05DC\u05D9\u05E6\u05D9\u05DD"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Section, null, /*#__PURE__*/external_react_default().createElement(UserQuote, {
    heText: "",
    enText: "As an educator, I have come to appreciate Sefaria more and more. I now make sure to expose all of my students to what Sefaria has to offer. I show them how to use Sefaria to make source sheets. <b>I love hearing their excitement as they realize how easy it is to make a sheet on Sefaria and how organized their final products look.</b> They also are impressed at how Sefaria helps them do research by finding sources that connect to their topic. I am grateful that Sefaria is there to provide Torah resources to my students after they complete their formal Jewish education. Overall, the experience of using Sefaria with my students has been very positive!",
    enName: "Sarit Anstandig | High School Judaics Teacher | Farber Hebrew Day School",
    heName: "",
    image: "/static/img/educators-landing-page/sarit anstandig.png"
  }), /*#__PURE__*/external_react_default().createElement(UserQuote, {
    enText: "I really appreciate Sefaria. I use it all the time studying for tests, doing homework, doing learning on my own or even preparing for a seminary interview. <b>The fact that I can quickly and easily find whatever I need wherever I am and understand and study it is incredible.</b> I'm so so grateful for Sefaria. I've introduced all my friends to it and they all use it now too.",
    heText: "",
    enName: "Anonymous day school student",
    heName: "",
    image: "/static/img/educators-landing-page/anonymous.png"
  }), /*#__PURE__*/external_react_default().createElement(UserQuote, {
    heText: "",
    enText: "Digital learning is making its way into all aspects of our students' education and learning, and if we are not on the train we will lose the hearts and minds of our students. We risk Torah being viewed as antiquated if it does not respond to our students' way of thinking about the world. Equally important, there are tools at our disposal which can enhance the experience of learning Torah and it would be malpractice not to see them. Through Sefaria's innovative educational features, my students' learning has been greatly enhanced. <b>We owe it to our students, and to ourselves, to make the most of this platform and to help make it better.</b>",
    enName: "Leib Zalesch | Judaic Studies Teacher | Beth Tfiloh Dahan Community School",
    heName: "",
    image: "/static/img/educators-landing-page/Leib Pic Prof.png"
  }), /*#__PURE__*/external_react_default().createElement(UserQuote, {
    enText: "Students have exposure to so many more commentaries than they would have in the past because of Sefaria and online texts. What I like most about Sefaria is the ability to compare and contrast texts clearly with the text side by side. It is a very powerful tool in the classroom and allows students to be more active in the learning process. Sefaria has also enhanced the level of sophistication of student project based learning.",
    heText: "",
    enName: "Yael Goldfischer | Chair: Chumash Department | The Frisch School",
    heName: "",
    image: "/static/img/educators-landing-page/Yael Goldfischer.png"
  }))), /*#__PURE__*/external_react_default().createElement(HeBlock, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Section, null, /*#__PURE__*/external_react_default().createElement(UserQuote, {
    heText: "\u05DE\u05E6\u05D0\u05EA\u05D9 \u05E9-\"\u05E1\u05E4\u05E8\u05D9\u05D0\" \u05D4\u05D9\u05D0 \u05D3\u05E8\u05DA \u05D8\u05D5\u05D1\u05D4 \u05DC\u05D4\u05DE\u05D7\u05D9\u05E9 \u05DC\u05EA\u05DC\u05DE\u05D9\u05D3\u05D9\u05DD \u05D0\u05EA \u05DE\u05D4 \u05E9\u05D4\u05EA\u05D2\u05DC\u05D4 \u05DC\u05E0\u05D5 \u05D5\u05D4\u05E4\u05E2\u05D9\u05DD \u05D0\u05D5\u05EA\u05E0\u05D5, \u05D5\u05DE\u05D4 \u05E9\u05D0\u05E0\u05D7\u05E0\u05D5 \u05DC\u05E4\u05E2\u05DE\u05D9\u05DD \u05DE\u05EA\u05E7\u05E9\u05D9\u05DD \u05DC\u05D4\u05E1\u05D1\u05D9\u05E8 \u05DC\u05D4\u05DD: \u05E9\u05D4\u05D9\u05D4\u05D3\u05D5\u05EA \u05D4\u05D9\u05D0 \u05DE\u05D0\u05E8\u05D2 \u05E9\u05DC\u05DD \u05E9\u05DC \u05D4\u05E7\u05E9\u05E8\u05D9\u05DD, \u05E9\u05D0\u05D9\u05E0\u05D5 \u05DE\u05E4\u05E1\u05D9\u05E7 \u05DC\u05D9\u05E6\u05D5\u05E8 \u05D5\u05DC\u05D4\u05EA\u05E7\u05D9\u05D9\u05DD. \u05D1-\"\u05E1\u05E4\u05E8\u05D9\u05D0\" \u05D4\u05D4\u05E7\u05E9\u05E8\u05D9\u05DD \u05D4\u05D0\u05DC\u05D4 \u05E0\u05E8\u05D0\u05D9\u05DD \u05DC\u05E2\u05D9\u05DF, \u05DE\u05EA\u05D2\u05DC\u05D9\u05DD \u05D1\u05E7\u05DC\u05D9\u05E7, \u05D5\u05DC\u05D5\u05E7\u05D7\u05D9\u05DD \u05D0\u05EA \u05D4\u05EA\u05DC\u05DE\u05D9\u05D3/\u05D4 \u05D0\u05D9\u05EA\u05DD \u05DC\u05DE\u05E1\u05E2 \u05DE\u05E1\u05D7\u05E8\u05E8 \u05E9\u05D0\u05D9\u05E0\u05D5 \u05E0\u05D2\u05DE\u05E8: \u05D3\u05D1\u05E8 \u05DE\u05D5\u05D1\u05D9\u05DC \u05DC\u05D3\u05D1\u05E8, \u05D3\u05D1\u05E8 \u05E7\u05E9\u05D5\u05E8 \u05DC\u05D3\u05D1\u05E8: \u05E4\u05E1\u05D5\u05E7 \u05DC\u05E4\u05E8\u05E9\u05E0\u05D5\u05EA, \u05DC\u05DE\u05D3\u05E8\u05E9, \u05DC\u05D3\u05E3 \u05DC\u05D9\u05DE\u05D5\u05D3, \u05DC\u05E9\u05D9\u05E8 \u05E2\u05DB\u05E9\u05D5\u05D5\u05D9 \u05E9\u05D1\u05D5 \u05DE\u05E6\u05D5\u05D8\u05D8 \u05E4\u05E1\u05D5\u05E7, \u05E9\u05D2\u05DD \u05E2\u05DC\u05D9\u05D5 \u05D9\u05E9 \u05DE\u05D3\u05E8\u05E9, \u05D5\u05DB\u05DA \u05D4\u05DC\u05D0\u05D4 \u05D5\u05DB\u05DA \u05D4\u05DC\u05D0\u05D4. \"\u05E1\u05E4\u05E8\u05D9\u05D0\" \u05D4\u05D9\u05D0 \u05D4\u05DE\u05D7\u05E9\u05D4 \u05E9\u05DC \u05D4\u05E2\u05D5\u05E9\u05E8 \u05D4\u05D1\u05DC\u05EA\u05D9-\u05E0\u05EA\u05E4\u05E1 \u05E9\u05DC \u05D4\u05D9\u05E6\u05D9\u05E8\u05D4 \u05D4\u05D9\u05D4\u05D5\u05D3\u05D9\u05EA, \u05D5\u05D4\u05D9\u05D0 \u05D2\u05DD \u05D4\u05D6\u05DE\u05E0\u05D4 \u05DC\u05E7\u05D7\u05EA \u05D1\u05D5 \u05D7\u05DC\u05E7 \u05D5\u05DC\u05D4\u05D5\u05E1\u05D9\u05E3 \u05D0\u05EA \u05D4\u05D7\u05D5\u05DC\u05D9\u05D4 \u05E9\u05DC\u05DA \u05DC\u05E9\u05DC\u05E9\u05DC\u05EA \u05D4\u05D6\u05D4\u05D1.",
    enText: "",
    enName: "",
    heName: "\u05D9\u05D5\u05E8\u05DD \u05D2\u05DC\u05D9\u05DC\u05D9, \u05DE\u05D5\u05E8\u05D4 \u05DC\u05EA\u05D5\u05E9\u05D1\"\u05E2, \u05DE\u05E0\u05D7\u05D4 \u05DE\u05D5\u05E8\u05D9\u05DD \u05D1\u05DE\u05E9\u05E8\u05D3 \u05D4\u05D7\u05D9\u05E0\u05D5\u05DA \u05D5\u05D1\u05EA\u05DB\u05E0\u05D9\u05EA \u05D1\u05D0\u05E8\u05D9 \u05E9\u05DC \u05DE\u05DB\u05D5\u05DF \u05D4\u05E8\u05D8\u05DE\u05DF",
    image: "/static/img/educators-landing-page/yoram-galil.png"
  }), /*#__PURE__*/external_react_default().createElement(UserQuote, {
    enText: "",
    heText: "\u05E2\u05D1\u05D5\u05E8\u05D9 \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D4\u05D5\u05D0 \u05DE\u05E8\u05D7\u05D1 \u05E4\u05E2\u05D9\u05DC\u05D5\u05EA \u05D7\u05D9\u05E0\u05D5\u05DB\u05D9 \u05E8\u05D1 \u05E2\u05E0\u05E4\u05D9\u05DD, \u05D1\u05D9\u05EA \u05DE\u05D3\u05E8\u05E9 \u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9 \u05E9\u05DC\u05DD. \u05DE\u05E9\u05DE\u05E9 \u05E2\u05D1\u05D5\u05E8\u05D9 \u05DB\u05E1\u05E4\u05E8\u05D9\u05D4  \u05DC\u05DC\u05D9\u05DE\u05D5\u05D3 \u05D5\u05DC\u05D4\u05DB\u05E0\u05EA \u05D7\u05D5\u05DE\u05E8\u05D9 \u05DC\u05D9\u05DE\u05D5\u05D3 \u05D5\u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA  \u05DC\u05EA\u05DC\u05DE\u05D9\u05D3\u05D9\u05D9. \u05E2\u05D1\u05D5\u05E8 \u05EA\u05DC\u05DE\u05D9\u05D3\u05D9\u05D9 \u05D6\u05D4 \u05D4\u05DE\u05E7\u05D5\u05DD \u05E9\u05D0\u05DC\u05D9\u05D5 \u05E0\u05DB\u05E0\u05E1\u05D9\u05DD \u05DC\u05D7\u05E4\u05E9, \u05DC\u05E7\u05E8\u05D0 \u05D5\u05DC\u05D1\u05E0\u05D5\u05EA \u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D0\u05D5\u05EA\u05DD \u05D4\u05DD \u05DC\u05D5\u05DE\u05D3\u05D9\u05DD \u05D1\u05D7\u05D1\u05E8\u05D5\u05EA\u05D0 \u05D5\u05DE\u05DC\u05DE\u05D3\u05D9\u05DD \u05D0\u05EA \u05D7\u05D1\u05E8\u05D9\u05D4\u05DD.    \u05D3\u05D1\u05E8 \u05D2\u05D3\u05D5\u05DC \u05D4\u05D5\u05D0 \u05E9\u05EA\u05DC\u05DE\u05D9\u05D3 \u05E0\u05DB\u05E0\u05E1 \u05DB\u05DC \u05E4\u05E2\u05DD \u05DC\u05D4\u05D9\u05DB\u05DC, \u05DC\u05E1\u05E4\u05E8\u05D9\u05D4 \u05E9\u05DC\u05DE\u05D4 \u05DE\u05D7\u05E4\u05E9 \u05D5\u05DE\u05D3\u05E4\u05D3\u05E3  \u05D5\u05D0\u05D2\u05D1 \u05DB\u05DA  \u05E0\u05D7\u05E9\u05E3 \u05DC\u05E2\u05D5\u05E9\u05E8 \u05D2\u05D3\u05D5\u05DC - \u05D6\u05D4 \u05D3\u05D1\u05E8 \u05D7\u05E9\u05D5\u05D1 \u05DE\u05D0\u05D9\u05DF \u05DB\u05DE\u05D5\u05EA\u05D5. \u05DB\u05DA  \u05E9\u05DC\u05E4\u05E2\u05DE\u05D9\u05DD \u05DE\u05D7\u05E4\u05E9\u05D9\u05DD \u05D0\u05EA\u05D5\u05E0\u05D5\u05EA \u05D5\u05DE\u05D5\u05E6\u05D0\u05D9\u05DD \u05DE\u05DC\u05D5\u05DB\u05D4.",
    enName: "",
    heName: "\u05D0\u05D9\u05E6\u05D9\u05E7 \u05E8\u05D1\u05D9, \u05DE\u05D5\u05E8\u05D4 \u05D5\u05DE\u05D3\u05E8\u05D9\u05DA \u05D0\u05E8\u05E6\u05D9 \u05DC\u05EA\u05D5\u05E9\u05D1\"\u05E2 \u05D5\u05DE\u05E9\u05E4\u05D8 \u05E2\u05D1\u05E8\u05D9 \u05D1\u05D7\u05D9\u05E0\u05D5\u05DA \u05D4\u05DE\u05DE\u05DC\u05DB\u05EA\u05D9, \u05DE\u05E0\u05D7\u05D4 \u05DC\u05D4\u05D5\u05E8\u05D0\u05EA \u05EA\u05E8\u05D1\u05D5\u05EA \u05D9\u05D4\u05D5\u05D3\u05D9\u05EA \u05D9\u05E9\u05E8\u05D0\u05DC\u05D9\u05EA \u05D1\u05EA\u05DB\u05E0\u05D9\u05EA \u05D1\u05D0\u05E8\u05D9 \u05E9\u05DC \u05DE\u05DB\u05D5\u05DF \u05D4\u05E8\u05D8\u05DE\u05DF",
    image: "/static/img/educators-landing-page/izhak-rabi.png"
  }), /*#__PURE__*/external_react_default().createElement(UserQuote, {
    heText: "\u05D0\u05E0\u05D9 \u05DE\u05E9\u05EA\u05DE\u05E9\u05EA \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0 \u05DC\u05D0 \u05E4\u05E2\u05DD \u05DB\u05DE\u05D5\u05E8\u05D4 - \u05DC\u05E2\u05EA\u05D9\u05DD \u05D1\u05D4\u05DB\u05E0\u05EA \u05D4\u05E9\u05D9\u05E2\u05D5\u05E8\u05D9\u05DD \u05D1\u05E2\u05E6\u05DE\u05D9 , \u05D0\u05D1\u05DC \u05D1\u05E2\u05D9\u05E7\u05E8 - \u05DB\u05DB\u05DC\u05D9 \u05DE\u05E2\u05E9\u05D9 \u05E2\u05D1\u05D5\u05E8 \u05D4\u05EA\u05DC\u05DE\u05D9\u05D3\u05D5\u05EA: \u05E2\u05D1\u05D5\u05E8 \u05D2\u05D9\u05E9\u05D4 \u05DC\u05E4\u05E8\u05E9\u05E0\u05D9\u05DD \u05D5\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E9\u05DC\u05D0 \u05E0\u05D2\u05D9\u05E9\u05D9\u05DD \u05DC\u05D4\u05DF \u05D1\u05DB\u05D9\u05EA\u05D4 \u05D0\u05D5 \u05D1\u05D1\u05D9\u05EA, \u05DC\u05D4\u05D3\u05D2\u05DE\u05EA \u05D4\u05E7\u05D9\u05E9\u05D5\u05E8\u05D9\u05D5\u05EA \u05D1\u05D9\u05DF \u05E1\u05D5\u05D2\u05D9\u05D5\u05EA \u05D1\u05D2\u05DE\u05E8\u05D0 \u05DC\u05D1\u05D9\u05DF \u05E4\u05E1\u05D9\u05E7\u05EA \u05D4\u05D4\u05DC\u05DB\u05D4, \u05DC\u05D4\u05D9\u05DB\u05E8\u05D5\u05EA \u05E2\u05DD \u05D4\u05D3\u05DE\u05D5\u05D9\u05D5\u05EA \u05D4\u05DE\u05D5\u05D6\u05DB\u05E8\u05D5\u05EA \u05D1\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D7\u05D6\"\u05DC, \u05D5\u05E2\u05D5\u05D3. \u05D4\u05DB\u05DC\u05D9 \u05E9\u05DC \u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D4\u05D5\u05D0 \u05E0\u05D4\u05D3\u05E8 \u05DB\u05E4\u05E8\u05D5\u05D9\u05D9\u05E7\u05D8 \u05D4\u05E2\u05E8\u05DB\u05D4 \u05D7\u05DC\u05D5\u05E4\u05D9\u05EA - \u05EA\u05D4\u05DC\u05D9\u05DA \u05E9\u05DC \u05D0\u05D9\u05EA\u05D5\u05E8 \u05D7\u05D5\u05DE\u05E8\u05D9\u05DD, \u05D7\u05E9\u05D9\u05D1\u05D4 \u05E2\u05DC \u05D4\u05D9\u05D7\u05E1 \u05D1\u05D9\u05E0\u05D9\u05D4\u05DD, \u05D5\u05D4\u05D2\u05E2\u05D4 \u05DC\u05EA\u05D5\u05E6\u05E8 \u05E9\u05D9\u05DB\u05D5\u05DC \u05DC\u05D4\u05D9\u05D5\u05EA \u05DE\u05E2\u05E0\u05D9\u05D9\u05DF \u05D2\u05DD \u05DC\u05D7\u05D1\u05E8\u05D5\u05EA\u05D9\u05D4\u05DF \u05DC\u05DB\u05D9\u05EA\u05D4 \u05D5\u05D2\u05DD \u05DC\u05E6\u05D9\u05D1\u05D5\u05E8 \u05D4\u05E8\u05D7\u05D1 \u05D3\u05E8\u05DA \u05D4\u05D0\u05EA\u05E8.",
    enText: "",
    enName: "",
    heName: "\u05D0\u05D1\u05D9\u05D2\u05D9\u05DC \u05D2\u05E8\u05D5\u05E1-\u05D2\u05DC\u05DE\u05DF, \u05DE\u05D5\u05D1\u05D9\u05DC\u05D4 \u05E8\u05D5\u05D7\u05E0\u05D9\u05EA \u05D1\u05EA\u05D9\u05DB\u05D5\u05DF \"\u05E4\u05DC\u05DA\" \u05DC\u05D1\u05E0\u05D5\u05EA \u05D1\u05D6\u05DB\u05E8\u05D5\u05DF \u05D9\u05E2\u05E7\u05D1",
    image: "/static/img/educators-landing-page/avigail-gross.png"
  }))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageCallToActionFooter"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "callToActionText",
    en: "Sign up for our mailing list to get updates in your inbox",
    he: "\u05E7\u05D1\u05DC\u05D5 \u05E2\u05D3\u05DB\u05D5\u05E0\u05D9\u05DD \u05D5\u05D4\u05E4\u05E0\u05D9\u05D5\u05EA \u05DC\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DE\u05E2\u05E0\u05D9\u05D9\u05E0\u05D9\u05DD"
  }), /*#__PURE__*/external_react_default().createElement(SubscribeButton, {
    enAction: "Sign up to get updates",
    heAction: "הירשמו לקבלת הניוזלטר",
    heLists: "Announcements_General_Hebrew|Announcements_Edu_Hebrew",
    enLists: "Announcements_General|Announcements_Edu",
    redirectURL: "/register?educator=true&next=/educators"
  }))));
};
var RabbisPage = function RabbisPage() {
  return /*#__PURE__*/external_react_default().createElement(StaticPage, null, /*#__PURE__*/external_react_default().createElement(HeaderForRabbisPage, null), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Engage Your Community and Share Your Torah",
    he: ""
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Engage your community in learning using Sefaria\u2019s free library of digital texts, in Hebrew and English translation. Enjoy having an extensive library at your fingertips for learning in the synagogue, on campus, at home or on the go. Share your Torah with Sefaria learners near and far.")), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Sefaria in Your Community",
    enText: "Explore the ways in which Sefaria supports teaching and learning. Whether you\u2019re a pro or a new user, Sefaria has resources to help you and your community learn and thrive. Request a custom workshop for your team or your community, discover how to use Chavruta for learning events, and share your Divrei Torah and Sermons using Collections.",
    enImg: "/static/img/rabbis-landing-page/sara+rabbis.jpg",
    enImgAlt: "Sefaria in Your Community",
    borderColor: sefaria_palette.colors.darkblue
  }), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    white: true,
    enTitle: "",
    heTitle: ""
  }, [["Schedule A Workshop", "שאלות נפוצות", "https://www.sefaria.org/sheets/370615?lang=bi", "https://www.sefaria.org.il/collections/%D7%A9%D7%90%D7%9C%D7%95%D7%AA-%D7%A0%D7%A4%D7%95%D7%A6%D7%95%D7%AA-%D7%91%D7%A1%D7%A4%D7%A8%D7%99%D7%90"], ["Innovating with a Digital Library", "", "https://www.sefaria.org/sheets/415628?lang=bi", ""], ["Collections: A Home for Sermons and Classes", "", "https://www.sefaria.org/sheets/370836?lang=bi", ""]].map(function (i) {
    return /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: false,
      tall: true,
      newTab: true,
      href: i[2],
      he_href: i[3],
      he: i[1],
      en: i[0]
    });
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Resources for Rabbis",
    enText: "Stay up to date with the latest news and resources from Sefaria. Find relevant texts and sheets for thousands of topics, use and share Sefaria\u2019s Chavruta feature for your own chavruta study, and get inspired to try something new in your work.",
    enImg: "/static/img/rabbis-landing-page/Sermon landing page screenshot.png",
    enImgAlt: "Resources for Rabbis",
    borderColor: sefaria_palette.colors.gold,
    link: ""
  }), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    white: true,
    enTitle: "",
    heTitle: ""
  }, [["Past Rabbi Newsletters", "", "https://www.sefaria.org/collections/T-5hbqOq?tab=sheets", ""], ["Topics Tutorial", "", "https://www.sefaria.org/sheets/231377?lang=bi", ""], ["Studying With a Partner: A Chavruta Tutorial", "", "https://www.sefaria.org/sheets/263246?lang=bi", ""]].map(function (i) {
    return /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: false,
      tall: true,
      newTab: true,
      href: i[2],
      he_href: i[3],
      he: i[1],
      en: i[0]
    });
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Sefaria How-Tos",
    enText: "Browse our Help Center and learn more about how to use Sefaria\u2019s tools to study and to teach. Sefaria\u2019s Learning Team is always available to support you or answer any questions you might have. If there are texts, translations, or learning materials that would enhance your work, please share that with us as well!",
    enImg: "/static/img/rabbis-landing-page/help-center-screenshot.png",
    enImgAlt: "Sefaria How-Tos",
    borderColor: sefaria_palette.colors.red
  }), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    white: true,
    enTitle: "",
    heTitle: ""
  }, [["Help Center", "", "https://www.sefaria.org/collections/sefaria-faqs", ""], ["Webinars", "", "https://www.sefaria.org/sheets/228105?lang=bi", ""], ["Request New Resources", "", "https://sefaria.typeform.com/to/aaZmi4JD?typeform-source=www.sefaria.org", ""]].map(function (i) {
    return /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: false,
      tall: true,
      newTab: true,
      href: i[2],
      he_href: i[3],
      he: i[1],
      en: i[0]
    });
  })), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Keep in touch",
    he: "\u05D0\u05E0\u05D7\u05E0\u05D5 \u05E8\u05D5\u05E6\u05D9\u05DD \u05DC\u05E9\u05DE\u05D5\u05E2 \u05DE\u05DB\u05DD"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Was your work enhanced by Sefaria? Did you have a \u201CSefaria moment\u201D with your learning community? Share it with us! We love to hear how rabbis are using Sefaria in the field and we learn from the feedback we receive. We are also available to answer all of your Sefaria questions. Write to us at education@sefaria.org.")), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "As the Rabbis say\u2026",
    he: "\u05DE\u05D5\u05E8\u05D9\u05DD \u05D5\u05EA\u05DC\u05DE\u05D9\u05D3\u05D9\u05DD \u05DE\u05DE\u05DC\u05D9\u05E6\u05D9\u05DD"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Section, null, /*#__PURE__*/external_react_default().createElement(UserQuote, {
    heText: "",
    enText: "\u201CSefaria is a gift to those of us seeking not just the conclusions to Halakhic arguments, but the entirety of the conversation; we are the ones who look up every citation and want to fully grasp the web of discourse for ourselves and Sefaria makes that so easy. It is equally a gift to those of us who teach and know the importance of providing readable and easy to find sources for our students. I use Sefaria to create and share annotated source sheets with some of the more complicated sources we discuss and invite my students to iterate on those sheets in turn. Before applying to rabbinical school, I studied how Sefaria shaped students' experiences of learning. Now, I am lucky to study Torah with my students using Sefaria.\u201D",
    enName: "Rabbanit Dr. Liz Shayne",
    heName: "",
    image: "/static/img/rabbis-landing-page/lizshayne 1.png"
  }), /*#__PURE__*/external_react_default().createElement(UserQuote, {
    enText: "\u201CSefaria\u2019s commitment to digital text access for all who seek to take hold of Torah played a pivotal and unparalleled role in my rabbinical school journey. As a blind woman in the rabbinate, Sefaria\u2019s digital library enabled me to access texts with ease for both educational and Torah lishma purposes. With much hakarat hatov do I thank Sefaria for the holy work you are doing.\u201D",
    heText: "",
    enName: "Rabbi Lauren Tuchman",
    heName: "",
    image: "/static/img/rabbis-landing-page/lauren-tuchman.png"
  }), /*#__PURE__*/external_react_default().createElement(UserQuote, {
    heText: "",
    enText: "\u201CAs a Rabbi, I have come to rely on Sefaria for my own lishmah study, as well as for creating source sheets for programs and study sessions in my community. I look forward to all that Sefaria still has in store for the Jewish world, and am proud to continue supporting your work.\u201D",
    enName: "Rabbi Max Chaiken | Temple Emanuel | Andover, MA",
    heName: "",
    image: "/static/img/rabbis-landing-page/Rabbi-Chaiken-Headshot.png"
  }), /*#__PURE__*/external_react_default().createElement(UserQuote, {
    enText: "\u201CDue to Hurricane Harvey in 2017 I lost about half of my library.  While some of the lost seforim have been replaced, I do not have the physical space to have access to them.  I have relied on the amazing Sefaria library to make up for the books that I am missing or cannot get to. I use Sefaria on a daily basis and there are some days that it is open on my computer all day long.  Sefaria and I spend extra time together on Friday when it is Drasha preparation time. I am grateful for the regular updates and additions Sefaria makes to the library.\u201D",
    heText: "",
    enName: "Rabbi Barry Gelman | Director of the Bobbi and Vic Samuels Center For Jewish Living and Learning | ERJCC in Houston",
    heName: "",
    image: "/static/img/rabbis-landing-page/Rabbi Gelman 1.png"
  }), /*#__PURE__*/external_react_default().createElement(UserQuote, {
    enText: "\u201CMy community and I worked this summer to put together a haggadah for the high holidays and wanted to thank you for all the help Sefaria provided as a source for Hebrew texts and inspiration. We couldn't dive as deep into our faith as we do without you! You offer us an ocean of Torah and boats to set sail upon it.\u201D",
    heText: "",
    enName: "Rabbi David Winship | Temple Beth David of the South Shore",
    heName: "",
    image: "/static/img/rabbis-landing-page/rabbi-david-winship.png"
  }))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageCallToActionFooter"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "callToActionText",
    en: "Sign up for our mailing list to get updates in your inbox",
    he: "\u05E7\u05D1\u05DC\u05D5 \u05E2\u05D3\u05DB\u05D5\u05E0\u05D9\u05DD \u05D5\u05D4\u05E4\u05E0\u05D9\u05D5\u05EA \u05DC\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DE\u05E2\u05E0\u05D9\u05D9\u05E0\u05D9\u05DD"
  }), /*#__PURE__*/external_react_default().createElement(SubscribeButton, {
    enAction: "Sign up for Rabbi Newsletter",
    heAction: "הירשמו לקבלת הניוזלטר",
    heLists: "Announcements_General_Hebrew|Announcements_Edu_Hebrew",
    enLists: "Announcements_General|Announcements_Edu",
    redirectURL: "/register?next=/rabbis"
  }))));
};
var PBSC2020LandingPage = function PBSC2020LandingPage() {
  return /*#__PURE__*/external_react_default().createElement(StaticPage, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Header, {
    enTitle: "Powered by Sefaria Contest 2020",
    enText: "Explore the Projects",
    enImg: "/static/img/pbsc-2020-landing-page/codemockup3.png",
    enImgAlt: "",
    heTitle: "\u05EA\u05D7\u05E8\u05D5\u05EA \u05E4\u05D9\u05EA\u05D5\u05D7 \u05EA\u05D5\u05DB\u05E0\u05D4 2020",
    heText: "\u05D4\u05DB\u05D9\u05E8\u05D5 \u05D0\u05EA \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD",
    heImg: "/static/img/pbsc-2020-landing-page/codemockup3.png",
    heImgAlt: ""
  }), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Inviting Innovation",
    he: ""
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "In an effort to seed the digital future of Jewish texts, the Powered by Sefaria Contest was launched in July 2020 \u2014 inviting the global Sefaria community to make use of our free and open digital dataset of Jewish texts, translations, and interconnections. Over the years, dozens of third parties have created apps, visualizations, and conducted research using our data or API, and we wanted to see what else our community could dream up. We saw tremendous enthusiasm and welcomed 50 high quality submissions from Sefaria users around the world. ", /*#__PURE__*/external_react_default().createElement("b", null, "Keep reading to learn more about the two winners and some incredibly innovative honorable mentions."))), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\u05DE\u05EA\u05D5\u05DA \u05E8\u05E6\u05D5\u05DF \u05DC\u05D8\u05E4\u05D7 \u05D0\u05EA \u05D4\u05E2\u05EA\u05D9\u05D3 \u05D4\u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9 \u05E9\u05DC \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD, \u05D4\u05D5\u05E6\u05D0\u05E0\u05D5 \u05DC\u05E4\u05D5\u05E2\u05DC \u05D1\u05D9\u05D5\u05DC\u05D9 2020 \u05D0\u05EA \u05EA\u05D7\u05E8\u05D5\u05EA \u05E4\u05D9\u05EA\u05D5\u05D7 \u05D4\u05EA\u05D5\u05DB\u05E0\u05D4 \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0. \u05D4\u05D6\u05DE\u05E0\u05D5 \u05D0\u05EA \u05E7\u05D4\u05D9\u05DC\u05EA \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D1\u05E8\u05D7\u05D1\u05D9 \u05D4\u05E2\u05D5\u05DC\u05DD \u05DC\u05D4\u05E9\u05EA\u05DE\u05E9 \u05D1\u05DE\u05E1\u05D3 \u05D4\u05E0\u05EA\u05D5\u05E0\u05D9\u05DD \u05D4\u05E4\u05EA\u05D5\u05D7 \u05E9\u05DC\u05E0\u05D5, \u05D4\u05DB\u05D5\u05DC\u05DC \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD, \u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD \u05D5\u05E7\u05D9\u05E9\u05D5\u05E8\u05D9\u05DD \u05D0\u05D9\u05E0\u05D8\u05E8\u05D8\u05E7\u05E1\u05D8\u05D5\u05D0\u05DC\u05D9\u05D9\u05DD. \u05D1\u05DE\u05E9\u05DA \u05D4\u05E9\u05E0\u05D9\u05DD \u05D4\u05E9\u05EA\u05DE\u05E9\u05D5 \u05E2\u05E9\u05E8\u05D5\u05EA \u05D2\u05D5\u05E4\u05D9 \u05E6\u05D3 \u05E9\u05DC\u05D9\u05E9\u05D9 \u05D1\u05BEAPI \u05E9\u05DC\u05E0\u05D5, \u05E2\u05E8\u05DB\u05D5 \u05D1\u05E2\u05D6\u05E8\u05EA\u05D5 \u05DE\u05D7\u05E7\u05E8\u05D9\u05DD \u05D5\u05D9\u05E6\u05E8\u05D5 \u05D1\u05D0\u05DE\u05E6\u05E2\u05D5\u05EA\u05D5 \u05D9\u05D9\u05E9\u05D5\u05DE\u05D9\u05DD \u05D5\u05EA\u05E8\u05E9\u05D9\u05DE\u05D9\u05DD \u05D2\u05E8\u05E4\u05D9\u05D9\u05DD. \u05DB\u05E2\u05EA \u05E8\u05E6\u05D9\u05E0\u05D5 \u05DC\u05E8\u05D0\u05D5\u05EA \u05DE\u05D4 \u05E2\u05D5\u05D3 \u05D4\u05E7\u05D4\u05D9\u05DC\u05D4 \u05E9\u05DC\u05E0\u05D5 \u05DE\u05E1\u05D5\u05D2\u05DC\u05EA \u05DC\u05D4\u05DE\u05E6\u05D9\u05D0. \u05E0\u05E2\u05E0\u05D9\u05E0\u05D5 \u05D1\u05D4\u05EA\u05DC\u05D4\u05D1\u05D5\u05EA \u05D9\u05D5\u05E6\u05D0\u05EA \u05D3\u05D5\u05E4\u05DF \u05D5\u05E7\u05D9\u05D1\u05DC\u05E0\u05D5 \u05D1\u05D1\u05E8\u05DB\u05D4 50 \u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05D0\u05D9\u05DB\u05D5\u05EA\u05D9\u05D9\u05DD \u05DE\u05D0\u05D5\u05D3 \u05DE\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9 \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D1\u05E8\u05D7\u05D1\u05D9 \u05D4\u05E2\u05D5\u05DC\u05DD. \u05D4\u05DE\u05E9\u05D9\u05DB\u05D5 \u05DC\u05E7\u05E8\u05D5\u05D0 \u05DB\u05D3\u05D9 \u05DC\u05D3\u05E2\u05EA \u05E2\u05D5\u05D3 \u05E2\u05DC \u05E9\u05E0\u05D9 \u05D4\u05D6\u05D5\u05DB\u05D9\u05DD \u05D5\u05E2\u05DC \u05DB\u05DE\u05D4 \u05E8\u05E2\u05D9\u05D5\u05E0\u05D5\u05EA \u05D9\u05E6\u05D9\u05E8\u05EA\u05D9\u05D9\u05DD \u05DE\u05D0\u05D5\u05D3 \u05D4\u05E8\u05D0\u05D5\u05D9\u05D9\u05DD \u05D1\u05E2\u05D9\u05E0\u05D9\u05E0\u05D5 \u05DC\u05DE\u05E7\u05D5\u05DD \u05E9\u05DC \u05DB\u05D1\u05D5\u05D3.")), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement(GreyBox, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Grand Prize Winner",
    he: "\u05D6\u05D5\u05DB\u05D4 \u05D4\u05E4\u05E8\u05E1 \u05D4\u05E8\u05D0\u05E9\u05D5\u05DF"
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Talmud Sidebar Extension",
    enText: "By Dov Katz<br/><br/>The Talmud Sidebar Extension brings Sefaria\u2019s learning resources to Daf Yomi sites across the web. Created in response to the move to Zoom for Daf Yomi classes the world over in the wake of COVID-19, the extension recognizes what daf you\u2019re learning or listening to on nearly a dozen Daf Yomi sites. It then enables a sidebar to see connections from Sefaria\u2019s library or link straight back to Sefaria.",
    enImg: "/static/img/pbsc-2020-landing-page/talmudsidebar.png",
    enImgAlt: "Talmud Sidebar Extension",
    heTitle: "\u05EA\u05D5\u05E1\u05E3 \u05E1\u05E8\u05D2\u05DC \u05D4\u05DB\u05DC\u05D9\u05DD \u05E9\u05DC \u05D4\u05EA\u05DC\u05DE\u05D5\u05D3",
    heText: "\u05D3\u05D1 \u05DB\u05E5<br/><br/>\u05EA\u05D5\u05E1\u05E3 \u05E1\u05E8\u05D2\u05DC \u05D4\u05DB\u05DC\u05D9\u05DD \u05E9\u05DC \u05D4\u05EA\u05DC\u05DE\u05D5\u05D3 \u05DE\u05D1\u05D9\u05D0 \u05D0\u05EA \u05DE\u05E9\u05D0\u05D1\u05D9 \u05D4\u05DC\u05D9\u05DE\u05D5\u05D3 \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05DC\u05D0\u05EA\u05E8\u05D9 \u05D3\u05E3 \u05D9\u05D5\u05DE\u05D9 \u05D1\u05E8\u05D7\u05D1\u05D9 \u05D4\u05E8\u05E9\u05EA. \u05D4\u05E4\u05D9\u05EA\u05D5\u05D7 \u05D4\u05D6\u05D4 \u05E0\u05D5\u05E6\u05E8 \u05DE\u05EA\u05D5\u05DA \u05E8\u05E6\u05D5\u05DF \u05DC\u05D4\u05EA\u05DE\u05D5\u05D3\u05D3 \u05E2\u05DD \u05D4\u05DE\u05E2\u05D1\u05E8 \u05E9\u05DC \u05E9\u05D9\u05E2\u05D5\u05E8\u05D9 \u05D4\u05D3\u05E3 \u05D4\u05D9\u05D5\u05DE\u05D9 \u05D1\u05E8\u05D7\u05D1\u05D9 \u05D4\u05E2\u05D5\u05DC\u05DD \u05D0\u05DC \u05D4\u05DE\u05E8\u05D7\u05D1 \u05D4\u05D5\u05D5\u05D9\u05E8\u05D8\u05D5\u05D0\u05DC\u05D9 \u05D1\u05E2\u05E7\u05D1\u05D5\u05EA \u05E0\u05D2\u05D9\u05E3 \u05E7\u05D5\u05E8\u05D5\u05E0\u05D4.  \u05D4\u05EA\u05D5\u05E1\u05E3 \u05D9\u05DB\u05D5\u05DC \u05DC\u05D6\u05D4\u05D5\u05EA \u05D1\u05D3\u05D9\u05D5\u05E7 \u05DE\u05D4\u05D5 \u05D4\u05D3\u05E3 \u05E9\u05D0\u05E0\u05D7\u05E0\u05D5 \u05DC\u05D5\u05DE\u05D3\u05D9\u05DD \u05D0\u05D5 \u05DE\u05D0\u05D6\u05D9\u05E0\u05D9\u05DD \u05DC\u05D5 \u05DE\u05EA\u05D5\u05DA \u05E7\u05E8\u05D5\u05D1 \u05DC\u05EA\u05E8\u05D9\u05E1\u05E8 \u05D0\u05EA\u05E8\u05D9 \u05D3\u05E3 \u05D9\u05D5\u05DE\u05D9 \u2013 Hadran.org.il, YUTorah.org, Steinsaltz-center.org, OUTorah.org \u05D5\u05E2\u05D5\u05D3 \u2013 \u05D5\u05DC\u05E4\u05EA\u05D5\u05D7 \u05E1\u05E8\u05D2\u05DC \u05DB\u05DC\u05D9\u05DD \u05D4\u05DB\u05D5\u05DC\u05DC \u05E7\u05D9\u05E9\u05D5\u05E8\u05D9\u05DD \u05DC\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05E8\u05DC\u05D5\u05D5\u05E0\u05D8\u05D9\u05D9\u05DD \u05D1\u05DE\u05D0\u05D2\u05E8 \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D5\u05DB\u05DF \u05E7\u05D9\u05E9\u05D5\u05E8 \u05DC\u05D3\u05E3 \u05D4\u05D9\u05D5\u05DE\u05D9 \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0.",
    heImg: "/static/img/pbsc-2020-landing-page/talmudsidebar.png",
    heImgAlt: "\u05EA\u05D5\u05E1\u05E3 \u05E1\u05E8\u05D2\u05DC \u05D4\u05DB\u05DC\u05D9\u05DD \u05E9\u05DC \u05D4\u05EA\u05DC\u05DE\u05D5\u05D3",
    borderColor: sefaria_palette.colors.yellow,
    link: "https://chrome.google.com/webstore/detail/talmud-sidebar-extension/dmpiiciebnbekblfbcdeogjkbbmeeimi"
  }), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Meet the Grand Prize Winner",
    he: "\u05D4\u05DB\u05D9\u05E8\u05D5 \u05D0\u05EA \u05D4\u05D6\u05D5\u05DB\u05D4"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Originally from Memphis, TN and now living in Modiin, Israel, Dov Katz leads a developer productivity group for the technology arm of a large financial services firm and enjoys tinkering with tech in his free time. Long interested in the ways technology could increase access to Jewish life and Torah study \u2013 he created the popular Jewish site OnlySimchas.com back in 1999! \u2013 he invented the Sidebar Extension this summer to meet the new digital needs of his own formerly in-person Daf Yomi shiur. Dov\u2019s passion for access leads him to be a strong advocate of Open Source and he currently sits as the Chairman of the board on the Fintech Open Source Foundation.")), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\u05D3\u05D1 \u05DB\u05E5 \u05D2\u05D3\u05DC \u05D1\u05DE\u05DE\u05E4\u05D9\u05E1 \u05E9\u05D1\u05DE\u05D3\u05D9\u05E0\u05EA \u05D8\u05E0\u05E1\u05D9 \u05D1\u05D0\u05E8\u05E6\u05D5\u05EA \u05D4\u05D1\u05E8\u05D9\u05EA \u05D5\u05DB\u05D9\u05D5\u05DD \u05DE\u05EA\u05D2\u05D5\u05E8\u05E8 \u05D1\u05DE\u05D5\u05D3\u05D9\u05E2\u05D9\u05DF. \u05D4\u05D5\u05D0 \u05E2\u05D5\u05DE\u05D3 \u05D1\u05E8\u05D0\u05E9 \u05E6\u05D5\u05D5\u05EA \u05E4\u05D9\u05EA\u05D5\u05D7 \u05D9\u05D9\u05E6\u05D5\u05E8 \u05D1\u05D0\u05D2\u05E3 \u05D4\u05D8\u05DB\u05E0\u05D5\u05DC\u05D5\u05D2\u05D9 \u05E9\u05DC \u05D7\u05D1\u05E8\u05EA \u05E9\u05D9\u05E8\u05D5\u05EA\u05D9\u05DD \u05E4\u05D9\u05E0\u05E0\u05E1\u05D9\u05D9\u05DD \u05D2\u05D3\u05D5\u05DC\u05D4, \u05D5\u05D1\u05E9\u05E2\u05D5\u05EA \u05D4\u05E4\u05E0\u05D0\u05D9 \u05D4\u05D5\u05D0 \u05DE\u05E4\u05EA\u05D7 \u05D7\u05D5\u05D1\u05D1 \u05E9\u05DC \u05D7\u05D9\u05D3\u05D5\u05E9\u05D9\u05DD \u05D8\u05DB\u05E0\u05D5\u05DC\u05D5\u05D2\u05D9\u05D9\u05DD. \u05DE\u05E6\u05D9\u05D0\u05EA \u05D3\u05E8\u05DB\u05D9\u05DD \u05DC\u05D4\u05E8\u05D7\u05D1\u05EA \u05D4\u05D2\u05D9\u05E9\u05D4 \u05DC\u05D7\u05D9\u05D9\u05DD \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD \u05D5\u05DC\u05DC\u05D9\u05DE\u05D5\u05D3 \u05EA\u05D5\u05E8\u05D4 \u05D1\u05D0\u05DE\u05E6\u05E2\u05D5\u05EA \u05D8\u05DB\u05E0\u05D5\u05DC\u05D5\u05D2\u05D9\u05D4 \u05DE\u05E2\u05E1\u05D9\u05E7\u05D4 \u05D0\u05EA \u05D3\u05D1 \u05D6\u05D4 \u05D6\u05DE\u05DF \u05E8\u05D1, \u05D5\u05E2\u05D5\u05D3 \u05D1\u05E9\u05E0\u05EA 1999 \u05D4\u05D5\u05D0 \u05D4\u05E7\u05D9\u05DD \u05D0\u05EA \u05D4\u05D0\u05EA\u05E8 \u05D4\u05DE\u05D5\u05DB\u05E8 onlysimchas.com, \u05DE\u05E2\u05D9\u05DF \u05DC\u05D5\u05D7 \u05E9\u05DE\u05D7\u05D5\u05EA \u05D0\u05D9\u05E0\u05D8\u05E8\u05E0\u05D8\u05D9. \u05D1\u05E7\u05D9\u05E5 \u05D4\u05D0\u05D7\u05E8\u05D5\u05DF \u05D9\u05E6\u05E8 \u05D0\u05EA \u05EA\u05D5\u05E1\u05E3 \u05E1\u05E8\u05D2\u05DC \u05D4\u05DB\u05DC\u05D9\u05DD \u05E9\u05DC \u05D4\u05EA\u05DC\u05DE\u05D5\u05D3 \u05DB\u05D3\u05D9 \u05DC\u05E2\u05E0\u05D5\u05EA \u05E2\u05DC \u05E6\u05E8\u05DB\u05D9\u05DD \u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9\u05D9\u05DD \u05D7\u05D3\u05E9\u05D9\u05DD \u05D1\u05E9\u05D9\u05E2\u05D5\u05E8 \u05D4\u05D3\u05E3 \u05D4\u05D9\u05D5\u05DE\u05D9 \u05E9\u05DC\u05D5 \u05E9\u05D4\u05E4\u05DA \u05DE\u05E7\u05D5\u05D5\u05DF. \u05D1\u05D6\u05DB\u05D5\u05EA \u05D4\u05EA\u05E9\u05D5\u05E7\u05D4 \u05E9\u05DC \u05D3\u05D1 \u05DC\u05E9\u05DB\u05DC\u05D5\u05DC \u05D3\u05E8\u05DB\u05D9 \u05D2\u05D9\u05E9\u05D4 \u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9\u05D5\u05EA \u05D4\u05D5\u05D0 \u05E0\u05D4\u05D9\u05D4 \u05EA\u05D5\u05DE\u05DA \u05E0\u05DC\u05D4\u05D1 \u05D1\u05E7\u05D5\u05D3 \u05E4\u05EA\u05D5\u05D7 \u05D5\u05DB\u05D9\u05D5\u05DD \u05DE\u05E9\u05DE\u05E9 \u05D9\u05D5\"\u05E8 \u05D4\u05D3\u05D9\u05E8\u05E7\u05D8\u05D5\u05E8\u05D9\u05D5\u05DF \u05E9\u05DC \u05E7\u05E8\u05DF \u05D4\u05E7\u05D5\u05D3 \u05D4\u05E4\u05EA\u05D5\u05D7 \u05E9\u05DC Fintech.")), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement(GreyBox, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Youth Prize Winner",
    he: "\u05D6\u05D5\u05DB\u05D9 \u05E4\u05E8\u05E1 \u05D4\u05DE\u05EA\u05DE\u05D5\u05D3\u05D3 \u05D4\u05E6\u05E2\u05D9\u05E8"
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Mizmor Shir",
    enText: "By Immanuel Bissel, Simon Landau, and Ben Kotton<br/><br/>Mizmor Shir explores the intersections of Torah and music as two forms of holy language. Using the Kabbalistic tradition of gematria, Mizmor Shir transforms the text of the Torah into music, in keys and scales that you choose, to reveal unseen (and unheard) patterns within it. ",
    enImg: "/static/img/pbsc-2020-landing-page/mizmorshir.png",
    enImgAlt: "Talmud Sidebar Extension",
    heTitle: "\u05DE\u05D6\u05DE\u05D5\u05E8 \u05E9\u05D9\u05E8",
    heText: "\u05E2\u05DE\u05E0\u05D5\u05D0\u05DC \u05D1\u05D9\u05E1\u05DC, \u05E1\u05D9\u05D9\u05DE\u05D5\u05DF \u05DC\u05E0\u05D3\u05D0\u05D5 \u05D5\u05D1\u05DF \u05E7\u05D5\u05D8\u05D5\u05DF<br/><br/>\"\u05DE\u05D6\u05DE\u05D5\u05E8 \u05E9\u05D9\u05E8\" \u05DE\u05EA\u05D1\u05D5\u05E0\u05DF \u05D1\u05DE\u05DE\u05E9\u05E7\u05D9\u05DD \u05E9\u05DC \u05EA\u05D5\u05E8\u05D4 \u05D5\u05DE\u05D5\u05D6\u05D9\u05E7\u05D4 \u05DB\u05DE\u05E4\u05D2\u05E9 \u05D1\u05D9\u05DF \u05E9\u05EA\u05D9 \u05E6\u05D5\u05E8\u05D5\u05EA \u05E9\u05D5\u05E0\u05D5\u05EA \u05E9\u05DC \u05E9\u05E4\u05EA \u05E7\u05D5\u05D3\u05E9. \u05D1\u05D0\u05DE\u05E6\u05E2\u05D5\u05EA \u05E9\u05D9\u05DE\u05D5\u05E9 \u05D1\u05D2\u05D9\u05DE\u05D8\u05E8\u05D9\u05D9\u05D4 \u05E7\u05D1\u05DC\u05D9\u05EA \u05D4\u05D5\u05E4\u05DA \u05DE\u05D6\u05DE\u05D5\u05E8 \u05E9\u05D9\u05E8 \u05D0\u05EA \u05D4\u05EA\u05D5\u05E8\u05D4 \u05D4\u05DB\u05EA\u05D5\u05D1\u05D4 \u05DC\u05DE\u05D5\u05D6\u05D9\u05E7\u05D4 \u05D1\u05EA\u05D5\u05D5\u05D9\u05DD \u05D5\u05D1\u05E1\u05D5\u05DC\u05DE\u05D5\u05EA \u05D4\u05E0\u05D9\u05EA\u05E0\u05D9\u05DD \u05DC\u05D1\u05D7\u05D9\u05E8\u05D4, \u05D5\u05D7\u05D5\u05E9\u05E3 \u05D1\u05D4 \u05D3\u05E4\u05D5\u05E1\u05D9\u05DD \u05E9\u05DC\u05D0 \u05E0\u05E8\u05D0\u05D5 (\u05D5\u05DC\u05D0 \u05E0\u05E9\u05DE\u05E2\u05D5) \u05DE\u05E2\u05D5\u05DC\u05DD.",
    heImg: "/static/img/pbsc-2020-landing-page/mizmorshir.png",
    heImgAlt: "\u05DE\u05D6\u05DE\u05D5\u05E8 \u05E9\u05D9\u05E8",
    borderColor: sefaria_palette.colors.raspberry,
    link: "http://mizmor-shir.herokuapp.com/"
  }), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Meet the Youth Prize Winners",
    he: "\u05D4\u05DB\u05D9\u05E8\u05D5 \u05D0\u05EA \u05D6\u05D5\u05DB\u05D9 \u05D4\u05E4\u05E8\u05E1"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Mizmor Shir was created by three college students \u2013 Simon Landau, a junior at USC majoring in Computer Science; Immanuel Bissel, a rising sophomore at Yale majoring in Earth and Planetary Science; and Ben Kotton, also a rising Sophomore at Yale, majoring in applied mathematics. Friends from a childhood shared in Los Angeles, all three are avid music lovers \u2013 Simon plays both orchestral bass as well as guitar in a three-piece band, Emmanuel the guitar, and Ben the mandolin. It was this love that got them excited to respond to Sefaria\u2019s PBS challenge with an idea that combined music with Torah and harnessed the power of technology to reveal the beauty of each in new ways.")), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\u05DE\u05D6\u05DE\u05D5\u05E8 \u05E9\u05D9\u05E8 \u05E0\u05D5\u05E6\u05E8 \u05D1\u05D9\u05D3\u05D9 \u05E9\u05DC\u05D5\u05E9\u05D4 \u05E1\u05D8\u05D5\u05D3\u05E0\u05D8\u05D9\u05DD \u2013 \u05E1\u05D9\u05D9\u05DE\u05D5\u05DF \u05DC\u05E0\u05D3\u05D0\u05D5, \u05E1\u05D8\u05D5\u05D3\u05E0\u05D8 \u05D1\u05E9\u05E0\u05D4 \u05D4\u05E9\u05DC\u05D9\u05E9\u05D9\u05EA \u05DC\u05DE\u05D3\u05E2\u05D9 \u05D4\u05DE\u05D7\u05E9\u05D1 \u05D1\u05D0\u05D5\u05E0\u05D9\u05D1\u05E8\u05E1\u05D9\u05D8\u05EA \u05D3\u05E8\u05D5\u05DD \u05E7\u05DC\u05D9\u05E4\u05D5\u05E8\u05E0\u05D9\u05D4; \u05E2\u05DE\u05E0\u05D5\u05D0\u05DC \u05D1\u05D9\u05E1\u05DC, \u05E1\u05D8\u05D5\u05D3\u05E0\u05D8 \u05D1\u05E9\u05E0\u05D4 \u05D4\u05E9\u05E0\u05D9\u05D9\u05D4 \u05DC\u05DE\u05D3\u05E2\u05D9 \u05DB\u05D3\u05D5\u05E8 \u05D4\u05D0\u05E8\u05E5 \u05D5\u05DB\u05D5\u05DB\u05D1\u05D9 \u05D4\u05DC\u05DB\u05EA \u05D1\u05D0\u05D5\u05E0\u05D9\u05D1\u05E8\u05E1\u05D9\u05D8\u05EA \u05D9\u05D9\u05DC; \u05D5\u05D1\u05DF \u05E7\u05D5\u05D8\u05D5\u05DF, \u05E1\u05D8\u05D5\u05D3\u05E0\u05D8 \u05D1\u05E9\u05E0\u05D4 \u05D4\u05E9\u05E0\u05D9\u05D9\u05D4 \u05DC\u05DE\u05EA\u05DE\u05D8\u05D9\u05E7\u05D4 \u05E9\u05D9\u05DE\u05D5\u05E9\u05D9\u05EA \u05D1\u05D0\u05D5\u05E0\u05D9\u05D1\u05E8\u05E1\u05D9\u05D8\u05EA \u05D9\u05D9\u05DC. \u05E9\u05DC\u05D5\u05E9\u05EA\u05DD \u05D7\u05D1\u05E8\u05D9 \u05D9\u05DC\u05D3\u05D5\u05EA \u05DE\u05DC\u05D5\u05E1 \u05D0\u05E0\u05D2'\u05DC\u05E1 \u05D5\u05D0\u05D5\u05D4\u05D1\u05D9 \u05DE\u05D5\u05D6\u05D9\u05E7\u05D4 \u05E0\u05DC\u05D4\u05D1\u05D9\u05DD: \u05E1\u05D9\u05D9\u05DE\u05D5\u05DF \u05D4\u05D5\u05D0 \u05E0\u05D2\u05DF \u05E7\u05D5\u05E0\u05D8\u05E8\u05D1\u05E1 \u05D5\u05D2\u05D9\u05D8\u05E8\u05D9\u05E1\u05D8 \u05D1\u05E9\u05DC\u05D9\u05E9\u05D9\u05D9\u05D4 \u05DE\u05D5\u05D6\u05D9\u05E7\u05DC\u05D9\u05EA, \u05E2\u05DE\u05E0\u05D5\u05D0\u05DC \u05DE\u05E0\u05D2\u05DF \u05D2\u05DD \u05D4\u05D5\u05D0 \u05D1\u05D2\u05D9\u05D8\u05E8\u05D4, \u05D5\u05D1\u05DF \u05DE\u05E0\u05D2\u05DF \u05D1\u05DE\u05E0\u05D3\u05D5\u05DC\u05D9\u05E0\u05D4. \u05D4\u05D0\u05D4\u05D1\u05D4 \u05D4\u05D6\u05D5 \u05D4\u05D9\u05D0 \u05E9\u05D3\u05E8\u05D1\u05E0\u05D4 \u05D0\u05D5\u05EA\u05DD \u05DC\u05E0\u05E1\u05D5\u05EA \u05DC\u05D4\u05EA\u05DE\u05D5\u05D3\u05D3 \u05E2\u05DD \u05D4\u05D0\u05EA\u05D2\u05E8 \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D1\u05E2\u05D6\u05E8\u05EA \u05E8\u05E2\u05D9\u05D5\u05DF \u05E9\u05E9\u05D9\u05DC\u05D1 \u05DE\u05D5\u05D6\u05D9\u05E7\u05D4 \u05D5\u05EA\u05D5\u05E8\u05D4 \u05D5\u05E8\u05EA\u05DD \u05D0\u05EA \u05DB\u05D5\u05D7\u05D4 \u05E9\u05DC \u05D4\u05D8\u05DB\u05E0\u05D5\u05DC\u05D5\u05D2\u05D9\u05D4 \u05DC\u05D7\u05E9\u05D5\u05E3 \u05D0\u05EA \u05D4\u05D9\u05D5\u05E4\u05D9 \u05E9\u05D1\u05DB\u05DC \u05D0\u05D7\u05EA \u05DE\u05D4\u05DF \u05D1\u05D3\u05E8\u05DB\u05D9\u05DD \u05D7\u05D3\u05E9\u05D5\u05EA.")), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "What the Judges Had to Say",
    he: "\u05D3\u05D1\u05E8\u05D9 \u05D4\u05E9\u05D5\u05E4\u05D8\u05D9\u05DD"
  }), /*#__PURE__*/external_react_default().createElement(StaticPages_Section, null, /*#__PURE__*/external_react_default().createElement(UserQuote, {
    enText: "It was very exciting to see all of the creative applications to the Powered by Sefaria Contest. There was such a wide range of ideas, truly displaying the power of Sefaria to engage a range of audiences. At the core of all of the ideas was creating innovative ways to allow more people to engage with text in a deeper way, from bringing the text to life through interactive museums to creating additional features and ease for the toolbar and the Sefaria browsing experience.<br/><br/>Many of the ideas are very promising and I hope the contestants continue to explore their ideas and bring their passion to life. Thanks to Sefaria for creating such an accessible and open platform to allow for such a meaningful and collaborative competition.",
    heText: "\u05D4\u05EA\u05E8\u05D2\u05E9\u05E0\u05D5 \u05DE\u05D0\u05D5\u05D3 \u05DC\u05E8\u05D0\u05D5\u05EA \u05D0\u05EA \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05D4\u05D9\u05E6\u05D9\u05E8\u05EA\u05D9\u05D9\u05DD \u05E9\u05E0\u05E9\u05DC\u05D7\u05D5 \u05DC\u05EA\u05D7\u05E8\u05D5\u05EA \u05E4\u05D9\u05EA\u05D5\u05D7 \u05D4\u05EA\u05D5\u05DB\u05E0\u05D4 \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0. \u05DE\u05E0\u05E2\u05D3 \u05D4\u05E8\u05E2\u05D9\u05D5\u05E0\u05D5\u05EA \u05D4\u05D9\u05D4 \u05E8\u05D7\u05D1 \u05D1\u05DE\u05D9\u05D5\u05D7\u05D3 \u05D5\u05D7\u05E9\u05E3 \u05D0\u05EA \u05DB\u05D5\u05D7\u05D4 \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05DC\u05E8\u05EA\u05D5\u05DD \u05DE\u05D2\u05D5\u05D5\u05DF \u05E7\u05D4\u05DC\u05D9\u05DD. \u05D4\u05DC\u05D1 \u05E9\u05DC \u05DB\u05DC \u05D4\u05E8\u05E2\u05D9\u05D5\u05E0\u05D5\u05EA \u05D4\u05DC\u05DC\u05D5 \u05D4\u05D9\u05D4 \u05D0\u05D7\u05D3 \u2013 \u05D9\u05E6\u05D9\u05E8\u05EA \u05D3\u05E8\u05DB\u05D9\u05DD \u05D7\u05D3\u05E9\u05E0\u05D9\u05D5\u05EA \u05DC\u05D0\u05E4\u05E9\u05E8 \u05DC\u05E2\u05D5\u05D3 \u05D5\u05E2\u05D5\u05D3 \u05D0\u05E0\u05E9\u05D9\u05DD \u05DC\u05E2\u05E1\u05D5\u05E7 \u05D1\u05D8\u05E7\u05E1\u05D8 \u05D1\u05D0\u05D5\u05E4\u05DF \u05E2\u05DE\u05D5\u05E7 \u05D9\u05D5\u05EA\u05E8, \u05D4\u05D7\u05DC \u05D1\u05DE\u05D5\u05D6\u05D9\u05D0\u05D5\u05E0\u05D9\u05DD \u05D0\u05D9\u05E0\u05D8\u05E8\u05D0\u05E7\u05D8\u05D9\u05D1\u05D9\u05D9\u05DD \u05D4\u05DE\u05E4\u05D9\u05D7\u05D9\u05DD \u05D7\u05D9\u05D9\u05DD \u05D1\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05E2\u05E6\u05DE\u05DD \u05D5\u05DB\u05DC\u05D4 \u05D1\u05E9\u05DC\u05DC \u05DB\u05DC\u05D9\u05DD \u05E9\u05DE\u05D8\u05E8\u05EA\u05DD \u05DC\u05D4\u05D5\u05E1\u05D9\u05E3 \u05E0\u05D5\u05D7\u05D5\u05EA \u05D5\u05D9\u05E2\u05D9\u05DC\u05D5\u05EA \u05DC\u05D7\u05D5\u05D5\u05D9\u05D9\u05EA \u05D4\u05D2\u05DC\u05D9\u05E9\u05D4 \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0 \u05D0\u05D5 \u05DC\u05E9\u05D9\u05DE\u05D5\u05E9 \u05D1\u05E1\u05E8\u05D2\u05DC \u05D4\u05DB\u05DC\u05D9\u05DD \u05E9\u05DC\u05D4. \u05E8\u05D1\u05D9\u05DD \u05DE\u05DF \u05D4\u05E8\u05E2\u05D9\u05D5\u05E0\u05D5\u05EA \u05D4\u05D0\u05DC\u05D4 \u05DE\u05D1\u05D8\u05D9\u05D7\u05D9\u05DD \u05DE\u05D0\u05D5\u05D3, \u05D5\u05D0\u05E0\u05D5 \u05DE\u05E7\u05D5\u05D5\u05D9\u05DD \u05E9\u05D4\u05DE\u05E9\u05EA\u05EA\u05E4\u05D9\u05DD \u05D5\u05D4\u05DE\u05E9\u05EA\u05EA\u05E4\u05D5\u05EA \u05D9\u05DE\u05E9\u05D9\u05DB\u05D5 \u05DC\u05D7\u05E7\u05D5\u05E8 \u05D0\u05EA \u05D4\u05E8\u05E2\u05D9\u05D5\u05E0\u05D5\u05EA \u05E9\u05DC\u05D4\u05DD \u05D5\u05DC\u05D4\u05D2\u05E9\u05D9\u05DD \u05D0\u05EA \u05E9\u05D0\u05D9\u05E4\u05D5\u05EA\u05D9\u05D4\u05DD. \u05EA\u05D5\u05D3\u05D4 \u05DC\u05E1\u05E4\u05E8\u05D9\u05D0 \u05E2\u05DC \u05D9\u05E6\u05D9\u05E8\u05EA \u05E4\u05DC\u05D8\u05E4\u05D5\u05E8\u05DE\u05D4 \u05E0\u05D2\u05D9\u05E9\u05D4 \u05D5\u05E4\u05EA\u05D5\u05D7\u05D4 \u05DB\u05DC \u05DB\u05DA \u05D4\u05DE\u05D0\u05E4\u05E9\u05E8\u05EA \u05EA\u05D7\u05E8\u05D5\u05EA \u05D1\u05E2\u05DC\u05EA \u05E2\u05E8\u05DA \u05D5\u05E9\u05D9\u05EA\u05D5\u05E4\u05D9 \u05E4\u05E2\u05D5\u05DC\u05D4.",
    enName: "Libby Novack, <i>Chief Operations Officer, Maapilim; Sefaria advisory board member</i>",
    heName: "\u05DC\u05D9\u05D1\u05D9 \u05E0\u05D5\u05D1\u05D0\u05E7, \u05E1\u05DE\u05E0\u05DB\"\u05DC \u05EA\u05E4\u05E2\u05D5\u05DC \u05D1\u05D7\u05D1\u05E8\u05EA \"\u05DE\u05E2\u05E4\u05D9\u05DC\u05D9\u05DD\"; \u05D7\u05D1\u05E8\u05D4 \u05D1\u05E6\u05D5\u05D5\u05EA \u05D4\u05D9\u05D9\u05E2\u05D5\u05E5 \u05DC\u05E1\u05E4\u05E8\u05D9\u05D0.",
    image: "/static/img/pbsc-2020-landing-page/libby.png"
  }), /*#__PURE__*/external_react_default().createElement(UserQuote, {
    enText: "Each of the top projects that I looked into were intriguing and useful.The Sidebar extension won deservedly because it is so obviously helpful for increasing Sefaria's efficiency. But I greatly admired the cleverness of the Shulkhan tool, the mathematical sophistication of the Sefer Similarity Map, and the ingenuity and resourcefulness of all the submissions.",
    heText: "\u05DB\u05DC \u05D0\u05D7\u05D3 \u05DE\u05DF \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05D4\u05DE\u05E2\u05D5\u05DC\u05D9\u05DD \u05E9\u05D1\u05D7\u05E0\u05EA\u05D9 \u05D4\u05D9\u05D5 \u05DE\u05E1\u05E7\u05E8\u05E0\u05D9\u05DD \u05D5\u05E9\u05D9\u05DE\u05D5\u05E9\u05D9\u05D9\u05DD. \u05D1\u05DE\u05E7\u05D5\u05DD \u05D4\u05E8\u05D0\u05E9\u05D5\u05DF \u05D6\u05DB\u05D4 \u05D1\u05D9\u05D5\u05E9\u05E8 \u05EA\u05D5\u05E1\u05E3 \u05E1\u05E8\u05D2\u05DC \u05D4\u05DB\u05DC\u05D9\u05DD \u05E9\u05DC \u05D4\u05EA\u05DC\u05DE\u05D5\u05D3, \u05DE\u05DB\u05D9\u05D5\u05D5\u05DF \u05E9\u05D1\u05E8\u05D5\u05E8 \u05E9\u05D1\u05DB\u05D5\u05D7\u05D5 \u05DC\u05D4\u05D2\u05D1\u05D9\u05E8 \u05D0\u05EA \u05D4\u05D9\u05E2\u05D9\u05DC\u05D5\u05EA \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D1\u05E7\u05E8\u05D1 \u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05D4. \u05E2\u05DD \u05D6\u05D0\u05EA \u05D9\u05E9 \u05D1\u05D9 \u05D2\u05DD \u05D4\u05E2\u05E8\u05DB\u05D4 \u05E8\u05D1\u05D4 \u05DC\u05E4\u05D9\u05E7\u05D7\u05D5\u05EA \u05E9\u05DC \u05DE\u05D9\u05D6\u05DD \"\u05D4\u05E9\u05D5\u05DC\u05D7\u05DF\", \u05DC\u05EA\u05D7\u05DB\u05D5\u05DD \u05D4\u05DE\u05EA\u05DE\u05D8\u05D9 \u05E9\u05DC \"\u05E1\u05E4\u05E8\" \u2013 \u05DE\u05E4\u05EA \u05D4\u05D3\u05DE\u05D9\u05D5\u05DF \u05D4\u05D8\u05E7\u05E1\u05D8\u05D5\u05D0\u05DC\u05D9\u05EA \u2013 \u05D5\u05DC\u05EA\u05D5\u05E9\u05D9\u05D9\u05D4 \u05D5\u05DB\u05D5\u05D7 \u05D4\u05D4\u05DE\u05E6\u05D0\u05D4 \u05E9\u05DC \u05DB\u05DC \u05D0\u05D7\u05D3 \u05DE\u05DF \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05D4\u05D0\u05D7\u05E8\u05D9\u05DD.",
    enName: "Moshe Koppel, <i>Professor of Computer Science at Bar-Ilan University; Founder of DICTA, a laboratory creating computational linguistics tools for the analysis of Jewish and Hebrew texts</i>",
    heName: "\u05DE\u05E9\u05D4 \u05E7\u05D5\u05E4\u05DC, \u05E4\u05E8\u05D5\u05E4\u05E1\u05D5\u05E8 \u05D1\u05DE\u05D7\u05DC\u05E7\u05D4 \u05DC\u05DE\u05D3\u05E2\u05D9 \u05D4\u05DE\u05D7\u05E9\u05D1 \u05D1\u05D0\u05D5\u05E0\u05D9\u05D1\u05E8\u05E1\u05D9\u05D8\u05EA \u05D1\u05E8\u05BE\u05D0\u05D9\u05DC\u05DF; \u05D4\u05DE\u05E7\u05D9\u05DD \u05E9\u05DC \"\u05D3\u05D9\u05E7\u05D8\u05D4\", \u05DE\u05E2\u05D1\u05D3\u05D4 \u05DC\u05E4\u05D9\u05EA\u05D5\u05D7 \u05DB\u05DC\u05D9 \u05DC\u05E9\u05D5\u05DF \u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9\u05D9\u05DD \u05DC\u05E0\u05D9\u05EA\u05D5\u05D7 \u05E9\u05DC \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05E2\u05D1\u05E8\u05D9\u05D9\u05DD \u05D5\u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD.",
    image: "/static/img/pbsc-2020-landing-page/moshe.png"
  }), /*#__PURE__*/external_react_default().createElement(UserQuote, {
    enText: "I was incredibly impressed by the submissions to the Powered by Sefaria contest. When Sefaria started, we could not have imagined the level of technical talent that would be applied to enhancing Sefaria's texts and platform. The submissions to the contest were both interesting and often quite practical, many adding useful features on top of Sefaria's existing platform. I was especially excited to see such wonderful energy from our younger supporters who brought creativity and vision to the contest. Congratulations to all the submitters!",
    heText: "\u05D4\u05EA\u05E8\u05E9\u05DE\u05EA\u05D9 \u05E2\u05DE\u05D5\u05E7\u05D5\u05EA \u05DE\u05DF \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E9\u05E0\u05E9\u05DC\u05D7\u05D5 \u05DC\u05EA\u05D7\u05E8\u05D5\u05EA \u05E4\u05D9\u05EA\u05D5\u05D7 \u05D4\u05EA\u05D5\u05DB\u05E0\u05D4 \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0. \u05DB\u05E9\u05E1\u05E4\u05E8\u05D9\u05D0 \u05D4\u05D7\u05DC\u05D4 \u05D0\u05EA \u05E4\u05E2\u05D9\u05DC\u05D5\u05EA\u05D4, \u05DC\u05D0 \u05D9\u05DB\u05D5\u05DC\u05E0\u05D5 \u05DC\u05D3\u05DE\u05D9\u05D9\u05DF \u05E9\u05D1\u05E2\u05EA\u05D9\u05D3 \u05D9\u05D9\u05E2\u05E9\u05D4 \u05E9\u05D9\u05DE\u05D5\u05E9 \u05D1\u05E8\u05DE\u05D4 \u05D2\u05D1\u05D5\u05D4\u05D4 \u05DB\u05DC \u05DB\u05DA \u05E9\u05DC \u05DE\u05D9\u05D5\u05DE\u05E0\u05D5\u05EA \u05D8\u05DB\u05E0\u05D5\u05DC\u05D5\u05D2\u05D9\u05EA \u05DB\u05D3\u05D9 \u05DC\u05E9\u05DB\u05DC\u05DC \u05D0\u05EA \u05D4\u05E4\u05DC\u05D8\u05E4\u05D5\u05E8\u05DE\u05D4 \u05D5\u05D0\u05EA \u05D4\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0. \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E9\u05E0\u05E9\u05DC\u05D7\u05D5 \u05DC\u05EA\u05D7\u05E8\u05D5\u05EA \u05D4\u05D9\u05D5 \u05DE\u05E2\u05E0\u05D9\u05D9\u05E0\u05D9\u05DD \u05D5\u05DC\u05E8\u05D5\u05D1 \u05D2\u05DD \u05DE\u05E2\u05E9\u05D9\u05D9\u05DD \u05DC\u05DE\u05D3\u05D9, \u05D5\u05D1\u05D4\u05DD \u05EA\u05D5\u05E1\u05E4\u05D9\u05DD \u05E9\u05D9\u05DE\u05D5\u05E9\u05D9\u05D9\u05DD \u05E8\u05D1\u05D9\u05DD \u05DC\u05E4\u05DC\u05D8\u05E4\u05D5\u05E8\u05DE\u05D4 \u05D4\u05E0\u05D5\u05DB\u05D7\u05D9\u05EA \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0. \u05D4\u05EA\u05E8\u05D2\u05E9\u05EA\u05D9 \u05DE\u05D0\u05D5\u05D3 \u05DC\u05E8\u05D0\u05D5\u05EA \u05D0\u05E0\u05E8\u05D2\u05D9\u05D4 \u05DE\u05D5\u05E4\u05DC\u05D0\u05D4 \u05DB\u05DC \u05DB\u05DA \u05DE\u05EA\u05D5\u05DE\u05DB\u05D9\u05E0\u05D5 \u05D4\u05E6\u05E2\u05D9\u05E8\u05D9\u05DD, \u05E9\u05D4\u05D1\u05D9\u05D0\u05D5 \u05D0\u05DC \u05D4\u05EA\u05D7\u05E8\u05D5\u05EA \u05D7\u05D6\u05D5\u05DF \u05D5\u05D9\u05E6\u05D9\u05E8\u05EA\u05D9\u05D5\u05EA. \u05D1\u05E8\u05DB\u05D5\u05EA \u05DC\u05DB\u05DC \u05D4\u05DE\u05E9\u05EA\u05EA\u05E4\u05D9\u05DD \u05D5\u05D4\u05DE\u05E9\u05EA\u05EA\u05E4\u05D5\u05EA!",
    enName: "Mo Koyfman, <i>Founder of early-stage venture capital firm, Shine Capital; founding Sefaria board member</i>",
    heName: "\u05DE\u05D5\u05B9 \u05E7\u05D0\u05D5\u05E4\u05DE\u05DF, \u05DE\u05D9\u05D9\u05E1\u05D3 Shine Capital, \u05E7\u05E8\u05DF \u05D4\u05D5\u05DF\u05BE\u05E1\u05D9\u05DB\u05D5\u05DF \u05DC\u05D7\u05D1\u05E8\u05D5\u05EA \u05D4\u05D6\u05E0\u05E7; \u05D7\u05D1\u05E8 \u05D4\u05E0\u05D4\u05DC\u05D4 \u05D1\u05E6\u05D5\u05D5\u05EA \u05D4\u05DE\u05D9\u05D9\u05E1\u05D3\u05D9\u05DD \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0.",
    image: "/static/img/pbsc-2020-landing-page/mo.png"
  })), /*#__PURE__*/external_react_default().createElement(GreyBox, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Honorable Mentions",
    he: "\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E9\u05D6\u05DB\u05D5 \u05DC\u05D4\u05E2\u05E8\u05DB\u05D4 \u05DE\u05D9\u05D5\u05D7\u05D3\u05EA"
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Shulkhan",
    enText: "By Joseph Tepperman<br/><br/>Shulkhan is a touch interface for the printed Talmud. Using a camera and projector, Shulkan can watch as you learn with a book and project translations to the passages of text that you touch.",
    enImg: "/static/img/pbsc-2020-landing-page/shulkhan.png",
    enImgAlt: "Shulkhan",
    heTitle: "\u05E9\u05D5\u05DC\u05D7\u05DF",
    heText: "\u05D2\u05F3\u05D5\u05D6\u05E3 \u05D8\u05E4\u05E8\u05DE\u05DF<br/><br/>\u05E9\u05D5\u05DC\u05D7\u05DF \u05D4\u05D5\u05D0 \u05DE\u05DE\u05E9\u05E7 \u05DE\u05D2\u05E2 \u05D4\u05DE\u05D9\u05D5\u05E2\u05D3 \u05DC\u05EA\u05DC\u05DE\u05D5\u05D3 \u05DE\u05D5\u05D3\u05E4\u05E1. \u05D1\u05D0\u05DE\u05E6\u05E2\u05D5\u05EA \u05DE\u05E6\u05DC\u05DE\u05D4 \u05D5\u05DE\u05E7\u05E8\u05DF, \"\u05E9\u05D5\u05DC\u05D7\u05DF\" \u05D9\u05DB\u05D5\u05DC \u05DC\u05E6\u05E4\u05D5\u05EA \u05D1\u05DE\u05E9\u05EA\u05DE\u05E9 \u05D1\u05D6\u05DE\u05DF \u05DC\u05D9\u05DE\u05D5\u05D3 \u05D2\u05DE\u05E8\u05D0 \u05D5\u05DC\u05D4\u05E7\u05E8\u05D9\u05DF \u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD \u05E9\u05DC \u05D4\u05E4\u05D9\u05E1\u05E7\u05D4 \u05E9\u05D4\u05DD \u05E0\u05D5\u05D2\u05E2\u05D9\u05DD \u05D1\u05D4. \u05DC\u05E7\u05E8\u05D9\u05D0\u05D4 \u05E0\u05D5\u05E1\u05E4\u05EA \u05E2\u05DC \u05D4\u05DE\u05D9\u05D6\u05DD.",
    heImg: "/static/img/pbsc-2020-landing-page/shulkhan.png",
    heImgAlt: "\u05E9\u05D5\u05DC\u05D7\u05DF",
    borderColor: sefaria_palette.colors.green,
    link: "http://josephtepperman.com/shulkhan.htm"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Goof - Body parts in Tefillah",
    enText: "By Judah Kaunfer and Matan Kotler-Berkowitz<br/><br/>Goof lets you explore texts of Tefillah through the lens of the body. Pick a body part and see texts that relate to it. <b>Goof has the honor of being the project submitted to the contest by the youngest entrant, Mr. Kaunfer, at 11 years old.</b>",
    enImg: "/static/img/pbsc-2020-landing-page/goof.png",
    enImgAlt: "Goof - Body parts in Tefillah",
    heTitle: "\u05D2\u05D5\u05E3: \u05D0\u05D9\u05D1\u05E8\u05D9 \u05D4\u05D2\u05D5\u05E3 \u05D1\u05EA\u05E4\u05D9\u05DC\u05D4",
    heText: "\u05D9\u05D4\u05D5\u05D3\u05D4 \u05E7\u05D0\u05D5\u05E0\u05E4\u05E8 \u05D5\u05DE\u05EA\u05DF \u05E7\u05D5\u05D8\u05DC\u05E8\u05BE\u05D1\u05E8\u05E7\u05D5\u05D1\u05D9\u05E5<br/><br/>\u05D2\u05D5\u05E3 \u05E2\u05D5\u05D6\u05E8 \u05DC\u05D7\u05E7\u05D5\u05E8 \u05D0\u05EA \u05D4\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05E9\u05DC \u05D4\u05EA\u05E4\u05D9\u05DC\u05D4 \u05D3\u05E8\u05DA \u05D4\u05D2\u05D5\u05E3. \u05D1\u05E2\u05D6\u05E8\u05EA \"\u05D2\u05D5\u05E3\" \u05D0\u05E4\u05E9\u05E8 \u05DC\u05D1\u05D7\u05D5\u05E8 \u05D1\u05D0\u05D9\u05D1\u05E8 \u05D1\u05D2\u05D5\u05E3 \u05D5\u05DC\u05E8\u05D0\u05D5\u05EA \u05D0\u05EA \u05D4\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05D4\u05E7\u05E9\u05D5\u05E8\u05D9\u05DD \u05D0\u05DC\u05D9\u05D5. \u05DC\u05DE\u05D9\u05D6\u05DD \u05D6\u05D4 \u05DE\u05E7\u05D5\u05DD \u05E9\u05DC \u05DB\u05D1\u05D5\u05D3 \u05D1\u05D4\u05D9\u05D5\u05EA\u05D5 \u05D4\u05DE\u05D9\u05D6\u05DD \u05E9\u05E0\u05E9\u05DC\u05D7 \u05DC\u05EA\u05D7\u05E8\u05D5\u05EA \u05E2\u05DC \u05D9\u05D3\u05D9 \u05D4\u05DE\u05EA\u05DE\u05D5\u05D3\u05D3 \u05D4\u05E6\u05E2\u05D9\u05E8 \u05D1\u05D9\u05D5\u05EA\u05E8, \u05DE\u05E8 \u05E7\u05D0\u05D5\u05E0\u05E4\u05E8, \u05D1\u05DF 11 \u05D1\u05DC\u05D1\u05D3",
    heImg: "/static/img/pbsc-2020-landing-page/goof.png",
    heImgAlt: "\u05D2\u05D5\u05E3: \u05D0\u05D9\u05D1\u05E8\u05D9 \u05D4\u05D2\u05D5\u05E3 \u05D1\u05EA\u05E4\u05D9\u05DC\u05D4",
    borderColor: sefaria_palette.colors.paleblue,
    link: "https://goof.surge.sh/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Capish - Interactive Learning",
    enText: "By Chanah Emunah Deitch and Shalva Eisenberg<br/><br/>Capish is an interactive learning environment for Jewish texts. For this contest, Capish added a feature that allows users to record themselves reading lines of text. As they play back their recordings the users see words highlighted as they are spoken, or jump to parts of the recording by clicking words.",
    enImg: "/static/img/pbsc-2020-landing-page/capish.png",
    enImgAlt: "Capish - Interactive Learning",
    heTitle: "\u05E7\u05D0\u05E4\u05D9\u05E9: \u05DC\u05D9\u05DE\u05D5\u05D3 \u05D0\u05D9\u05E0\u05D8\u05E8\u05D0\u05E7\u05D8\u05D9\u05D1\u05D9",
    heText: "\u05D7\u05E0\u05D4 \u05D0\u05DE\u05D5\u05E0\u05D4 \u05D3\u05D9\u05D9\u05D8\u05E9 \u05D5\u05E9\u05DC\u05D5\u05D5\u05D4 \u05D0\u05D9\u05D9\u05D6\u05E0\u05D1\u05E8\u05D2<br/><br/>\u05E7\u05D0\u05E4\u05D9\u05E9 \u05D4\u05D5\u05D0 \u05DE\u05E8\u05D7\u05D1 \u05DC\u05D9\u05DE\u05D5\u05D3 \u05D0\u05D9\u05E0\u05D8\u05E8\u05D0\u05E7\u05D8\u05D9\u05D1\u05D9 \u05DC\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD. \u05DC\u05E6\u05D5\u05E8\u05DA \u05D4\u05EA\u05D7\u05E8\u05D5\u05EA \u05E0\u05D5\u05E1\u05E3 \u05DC\u05E7\u05D0\u05E4\u05D9\u05E9 \u05DB\u05DC\u05D9 \u05D7\u05D3\u05E9 \u05D4\u05DE\u05D0\u05E4\u05E9\u05E8 \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05DC\u05D4\u05E7\u05DC\u05D9\u05D8 \u05D0\u05EA \u05E2\u05E6\u05DE\u05DD \u05D1\u05D6\u05DE\u05DF \u05E7\u05E8\u05D9\u05D0\u05EA \u05E9\u05D5\u05E8\u05D5\u05EA \u05D1\u05D8\u05E7\u05E1\u05D8. \u05DB\u05D0\u05E9\u05E8 \u05DE\u05E4\u05E2\u05D9\u05DC\u05D9\u05DD \u05D0\u05EA \u05D4\u05D4\u05E7\u05DC\u05D8\u05D4, \u05D0\u05E4\u05E9\u05E8 \u05DC\u05E8\u05D0\u05D5\u05EA \u05D0\u05EA \u05D4\u05DE\u05D9\u05DC\u05D9\u05DD \u05D4\u05DE\u05D5\u05E9\u05DE\u05E2\u05D5\u05EA \u05D1\u05D5\u05DC\u05D8\u05D5\u05EA \u05D1\u05EA\u05D5\u05DA \u05D4\u05D8\u05E7\u05E1\u05D8 \u05D0\u05D5 \u05DC\u05D7\u05DC\u05D5\u05E4\u05D9\u05DF \u05DC\u05D3\u05DC\u05D2 \u05DC\u05D7\u05DC\u05E7\u05D9\u05DD \u05D0\u05D7\u05E8\u05D9\u05DD \u05D1\u05D4\u05E7\u05DC\u05D8\u05D4 \u05D1\u05D0\u05DE\u05E6\u05E2\u05D5\u05EA \u05DC\u05D7\u05D9\u05E6\u05D4 \u05E2\u05DC \u05DE\u05D9\u05DC\u05D9\u05DD \u05D1\u05D8\u05E7\u05E1\u05D8.",
    heImg: "/static/img/pbsc-2020-landing-page/capish.png",
    heImgAlt: "\u05E7\u05D0\u05E4\u05D9\u05E9: \u05DC\u05D9\u05DE\u05D5\u05D3 \u05D0\u05D9\u05E0\u05D8\u05E8\u05D0\u05E7\u05D8\u05D9\u05D1\u05D9",
    borderColor: sefaria_palette.colors.blue,
    link: "https://capish.me/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Daf Yomi Crossword",
    enText: "By Chanoch Goldfarb<br/><br/>Daf Yomi Crossword automatically generates a crossword puzzle based on any page of Talmud. The clues ask you to find words used on the page based on their context, or to find the words that commentaries choose to comment on.",
    enImg: "/static/img/pbsc-2020-landing-page/dafyomicrossword.png",
    enImgAlt: "Daf Yomi Crossword",
    heTitle: "\u05EA\u05E9\u05D1\u05E5 \u05D3\u05E3 \u05D9\u05D5\u05DE\u05D9",
    heText: "\u05D7\u05E0\u05D5\u05DA \u05D2\u05D5\u05DC\u05D3\u05E4\u05E8\u05D1<br/><br/>\u05EA\u05E9\u05D1\u05E5 \u05D3\u05E3 \u05D9\u05D5\u05DE\u05D9 \u05D4\u05D5\u05D0 \u05EA\u05E9\u05D1\u05E5 \u05E9\u05E0\u05D5\u05E6\u05E8 \u05D0\u05D5\u05D8\u05D5\u05DE\u05D8\u05D9\u05EA \u05E2\u05DC \u05D1\u05E1\u05D9\u05E1 \u05DB\u05DC \u05E2\u05DE\u05D5\u05D3 \u05D1\u05EA\u05DC\u05DE\u05D5\u05D3. \u05D4\u05E8\u05DE\u05D6\u05D9\u05DD \u05DE\u05D5\u05D1\u05D9\u05DC\u05D9\u05DD \u05D0\u05EA \u05D4\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05DC\u05DE\u05E6\u05D5\u05D0 \u05DE\u05D9\u05DC\u05D9\u05DD \u05E9\u05E0\u05E2\u05E9\u05D4 \u05D1\u05D4\u05DF \u05E9\u05D9\u05DE\u05D5\u05E9 \u05D1\u05E2\u05DE\u05D5\u05D3 \u05D1\u05D4\u05EA\u05D0\u05DD \u05DC\u05D4\u05E7\u05E9\u05E8 \u05E9\u05DC\u05D4\u05DF \u05D0\u05D5 \u05DC\u05DE\u05E6\u05D5\u05D0 \u05DE\u05D9\u05DC\u05D9\u05DD \u05E9\u05D4\u05DE\u05E4\u05E8\u05E9\u05D9\u05DD \u05E2\u05D5\u05E1\u05E7\u05D9\u05DD \u05D1\u05D4\u05DF.",
    heImg: "/static/img/pbsc-2020-landing-page/dafyomicrossword.png",
    heImgAlt: "\u05EA\u05E9\u05D1\u05E5 \u05D3\u05E3 \u05D9\u05D5\u05DE\u05D9",
    borderColor: sefaria_palette.colors.orange,
    link: "http://ee.cooper.edu/~goldfarb/daf/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Sefer Similarity Map",
    enText: "By Joseph Hostyk and Alex Zaloum<br/><br/>Sefer Similarity Map visualizes relationships among Jewish texts by analyzing their usage of words or phrases to show which texts and sections have the most in common. Exploring the results in graphical form can illuminate historical, authorial, linguistic, and stylistic connections between texts.",
    enImg: "/static/img/pbsc-2020-landing-page/sefersimilarity.png",
    enImgAlt: "Sefer Similarity Map",
    heTitle: "\u05E1\u05E4\u05E8\u2013 \u05DE\u05E4\u05EA \u05D3\u05DE\u05D9\u05D5\u05DF \u05D1\u05D9\u05DF \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD",
    heText: "\u05D2\u05F3\u05D5\u05D6\u05E3 \u05D4\u05D5\u05E1\u05D8\u05D9\u05E7 \u05D5\u05D0\u05DC\u05DB\u05E1 \u05D6\u05D0\u05DC\u05D5\u05DD<br/><br/>\u05D1\u05E2\u05D6\u05E8\u05EA \u05E0\u05D9\u05EA\u05D5\u05D7 \u05E9\u05DC \u05D0\u05D7\u05D5\u05D6\u05D9 \u05D4\u05E9\u05D9\u05DE\u05D5\u05E9 \u05D1\u05DE\u05D9\u05DC\u05D9\u05DD \u05D0\u05D5 \u05D1\u05D1\u05D9\u05D8\u05D5\u05D9\u05D9\u05DD \u05DE\u05E1\u05D5\u05D9\u05DE\u05D9\u05DD, \"\u05E1\u05E4\u05E8\" \u2013 \u05DE\u05E4\u05EA \u05D3\u05DE\u05D9\u05D5\u05DF \u05D1\u05D9\u05DF \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u2013 \u05DE\u05DE\u05D7\u05D9\u05E9\u05D4 \u05D0\u05EA \u05D4\u05E7\u05E9\u05E8\u05D9\u05DD \u05D1\u05D9\u05DF \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD, \u05D5\u05D1\u05D0\u05D5\u05E4\u05DF \u05D6\u05D4 \u05DE\u05E8\u05D0\u05D4 \u05DC\u05D0\u05D9\u05DC\u05D5 \u05DE\u05D4\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05D0\u05D5 \u05D4\u05E7\u05D8\u05E2\u05D9\u05DD \u05D4\u05E0\u05D1\u05D7\u05E8\u05D9\u05DD \u05D9\u05E9 \u05D4\u05DB\u05D9 \u05D4\u05E8\u05D1\u05D4 \u05D1\u05DE\u05E9\u05D5\u05EA\u05E3. \u05D4\u05E6\u05D2\u05EA \u05D4\u05EA\u05D5\u05E6\u05D0\u05D5\u05EA \u05D1\u05E6\u05D5\u05E8\u05D4 \u05D2\u05E8\u05E4\u05D9\u05EA \u05DB\u05D6\u05D5 \u05D9\u05DB\u05D5\u05DC\u05D4 \u05DC\u05E9\u05E4\u05D5\u05DA \u05D0\u05D5\u05E8 \u05E2\u05DC \u05E7\u05E9\u05E8\u05D9\u05DD \u05D4\u05D9\u05E1\u05D8\u05D5\u05E8\u05D9\u05D9\u05DD, \u05DC\u05E9\u05D5\u05E0\u05D9\u05D9\u05DD \u05D5\u05E1\u05D2\u05E0\u05D5\u05E0\u05D9\u05D9\u05DD \u05D5\u05D0\u05D7\u05E8\u05D9\u05DD \u05D1\u05D9\u05DF \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD.",
    heImg: "/static/img/pbsc-2020-landing-page/sefersimilarity.png",
    heImgAlt: "\u05E1\u05E4\u05E8\u2013 \u05DE\u05E4\u05EA \u05D3\u05DE\u05D9\u05D5\u05DF \u05D1\u05D9\u05DF \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD",
    borderColor: sefaria_palette.colors.lightpink,
    link: "https://jhostyk.github.io/SeferSimilarityMap/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Custom Mikraot Gedolot",
    enText: "By Eshel Sinclair and Ben Gold<br/><br/>Custom Mikraot Gedolot lets you create your own Mikraot Gedolot. You choose the texts, translations and up to 9 commentaries, and the app will automatically generate a PDF that you can download and print.",
    enImg: "/static/img/pbsc-2020-landing-page/mikraotgedolot.png",
    enImgAlt: "Custom Mikraot Gedolot",
    heTitle: "\u05DE\u05E7\u05E8\u05D0\u05D5\u05EA \u05D2\u05D3\u05D5\u05DC\u05D5\u05EA \u05D1\u05D4\u05EA\u05D0\u05DE\u05D4 \u05D0\u05D9\u05E9\u05D9\u05EA",
    heText: "\u05D0\u05E9\u05DC \u05E1\u05D9\u05E0\u05E7\u05DC\u05D9\u05D9\u05E8 \u05D5\u05D1\u05DF \u05D2\u05D5\u05DC\u05D3<br/><br/>\u05D9\u05D9\u05E9\u05D5\u05DE\u05D5\u05DF \u05DE\u05E7\u05E8\u05D0\u05D5\u05EA \u05D2\u05D3\u05D5\u05DC\u05D5\u05EA \u05D1\u05D4\u05EA\u05D0\u05DE\u05D4 \u05D0\u05D9\u05E9\u05D9\u05EA \u05DE\u05D0\u05E4\u05E9\u05E8 \u05DC\u05DA \u05DC\u05D9\u05E6\u05D5\u05E8 \u05DE\u05E7\u05E8\u05D0\u05D5\u05EA \u05D2\u05D3\u05D5\u05DC\u05D5\u05EA \u05D0\u05D9\u05E9\u05D9\u05D5\u05EA. \u05D1\u05D9\u05DB\u05D5\u05DC\u05EA\u05DA \u05DC\u05D1\u05D7\u05D5\u05E8 \u05D0\u05EA \u05D4\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD, \u05D0\u05EA \u05D4\u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD \u05D5\u05DB\u05DF \u05E2\u05D3 9 \u05E4\u05E8\u05E9\u05E0\u05D9\u05DD \u05E9\u05D5\u05E0\u05D9\u05DD, \u05D5\u05D1\u05D4\u05EA\u05D0\u05DD \u05DC\u05D1\u05D7\u05D9\u05E8\u05D5\u05EA \u05D0\u05DC\u05D4 \u05D9\u05D9\u05E6\u05D5\u05E8 \u05D4\u05D9\u05D9\u05E9\u05D5\u05DE\u05D5\u05DF \u05E7\u05D5\u05D1\u05E5 PDF \u05D1\u05D0\u05D5\u05E4\u05DF \u05D0\u05D5\u05D8\u05D5\u05DE\u05D8\u05D9.",
    heImg: "/static/img/pbsc-2020-landing-page/mikraotgedolot.png",
    heImgAlt: "\u05DE\u05E7\u05E8\u05D0\u05D5\u05EA \u05D2\u05D3\u05D5\u05DC\u05D5\u05EA \u05D1\u05D4\u05EA\u05D0\u05DE\u05D4 \u05D0\u05D9\u05E9\u05D9\u05EA",
    borderColor: sefaria_palette.colors.darkblue,
    link: "http://ec2-3-129-165-55.us-east-2.compute.amazonaws.com:3002/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Sefaria Space: (Topic Museum + Text Mania)",
    enText: "By David Komer<br/><br/>The Sefaria Space has two parts: the Topic Museum creates an immersive 3D environment where you can explore texts related to a topic as though they were paintings hanging on a wall. Text Mania is a 3D game based on the letters of a text of your choosing.",
    enImg: "/static/img/pbsc-2020-landing-page/sefariaspace.png",
    enImgAlt: "Sefaria Space: (Topic Museum + Text Mania)",
    heTitle: "\u05DE\u05E8\u05D7\u05D1 \u05E1\u05E4\u05E8\u05D9\u05D0 (\u05DE\u05D5\u05D6\u05D9\u05D0\u05D5\u05DF \u05E0\u05D5\u05E9\u05D0\u05D9 + \u05D8\u05B8\u05E8\u05B6\u05E4\u05B6\u05EA \u05D8\u05E7\u05E1\u05D8)",
    heText: "\u05D3\u05D5\u05D3 \u05E7\u05D5\u05DE\u05E8<br/><br/>\u05DE\u05E8\u05D7\u05D1 \u05E1\u05E4\u05E8\u05D9\u05D0 \u05DE\u05D5\u05E8\u05DB\u05D1 \u05DE\u05E9\u05E0\u05D9 \u05D7\u05DC\u05E7\u05D9\u05DD: \u05D4\u05DE\u05D5\u05D6\u05D9\u05D0\u05D5\u05DF \u05D4\u05E0\u05D5\u05E9\u05D0\u05D9 \u2013 \u05E1\u05D1\u05D9\u05D1\u05D4 \u05EA\u05DC\u05EA\u05BE\u05DE\u05DE\u05D3\u05D9\u05EA \u05E1\u05D5\u05D7\u05E4\u05EA \u05E9\u05D1\u05D4 \u05D0\u05E4\u05E9\u05E8 \u05DC\u05D7\u05E7\u05D5\u05E8 \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05E2\u05DC \u05E4\u05D9 \u05E0\u05D5\u05E9\u05D0 \u05DB\u05D0\u05D9\u05DC\u05D5 \u05D4\u05D9\u05D5 \u05E6\u05D9\u05D5\u05E8\u05D9\u05DD \u05E2\u05DC \u05D4\u05E7\u05D9\u05E8 \u2013 \u05D5\"\u05D8\u05E8\u05E4\u05EA \u05D8\u05E7\u05E1\u05D8\", \u05DE\u05E9\u05D7\u05E7 \u05EA\u05DC\u05EA\u05BE\u05DE\u05DE\u05D3 \u05D4\u05DE\u05D1\u05D5\u05E1\u05E1 \u05E2\u05DC \u05D4\u05D0\u05D5\u05EA\u05D9\u05D5\u05EA \u05E9\u05DC \u05D4\u05D8\u05E7\u05E1\u05D8 \u05E9\u05D1\u05D7\u05E8\u05EA\u05DD.",
    heImg: "/static/img/pbsc-2020-landing-page/sefariaspace.png",
    heImgAlt: "\u05DE\u05E8\u05D7\u05D1 \u05E1\u05E4\u05E8\u05D9\u05D0 (\u05DE\u05D5\u05D6\u05D9\u05D0\u05D5\u05DF \u05E0\u05D5\u05E9\u05D0\u05D9 + \u05D8\u05B8\u05E8\u05B6\u05E4\u05B6\u05EA \u05D8\u05E7\u05E1\u05D8)",
    borderColor: sefaria_palette.colors.darkpink,
    link: " https://sefaria-space.web.app/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "The Rabbinic Citation Network",
    enText: "By Michael Satlow and Mike Sperling<br/><br/>Using Sefaria's digital text of the Bavli, the Rabbinic Citation Networks extracts the names and links of rabbis who cite (or who are cited by) other rabbis and visualizes the resulting network.",
    enImg: "/static/img/pbsc-2020-landing-page/rabbiniccitation.png",
    enImgAlt: "The Rabbinic Citation Network",
    heTitle: "\u05E8\u05E9\u05EA \u05E6\u05D9\u05D8\u05D5\u05D8\u05D9\u05DD \u05E9\u05DC \u05D7\u05DB\u05DE\u05D9 \u05D4\u05EA\u05DC\u05DE\u05D5\u05D3",
    heText: "\u05DE\u05D9\u05D9\u05E7\u05DC \u05E1\u05D0\u05D8\u05DC\u05D5 \u05D5\u05DE\u05D9\u05D9\u05E7 \u05E1\u05E4\u05E8\u05DC\u05D9\u05E0\u05D2<br/><br/>\u05D1\u05D0\u05DE\u05E6\u05E2\u05D5\u05EA \u05D8\u05E7\u05E1\u05D8 \u05D4\u05EA\u05DC\u05DE\u05D5\u05D3 \u05D4\u05D1\u05D1\u05DC\u05D9 \u05D4\u05DE\u05E7\u05D5\u05D5\u05DF \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0, \u05E8\u05E9\u05EA \u05D4\u05E6\u05D9\u05D8\u05D5\u05D8\u05D9\u05DD \u05E9\u05DC \u05D7\u05DB\u05DE\u05D9 \u05D4\u05EA\u05DC\u05DE\u05D5\u05D3 \u05DE\u05D7\u05DC\u05E6\u05EA \u05D0\u05EA \u05D4\u05E9\u05DE\u05D5\u05EA \u05D5\u05D0\u05EA \u05D4\u05E7\u05D9\u05E9\u05D5\u05E8\u05D9\u05DD \u05E9\u05DC \u05D4\u05D7\u05DB\u05DE\u05D9\u05DD \u05D4\u05DE\u05E6\u05D8\u05D8\u05D9\u05DD (\u05D0\u05D5 \u05D4\u05DE\u05E6\u05D5\u05D8\u05D8\u05D9\u05DD \u05D1\u05D9\u05D3\u05D9) \u05D7\u05DB\u05DE\u05D9\u05DD \u05D0\u05D7\u05E8\u05D9\u05DD \u05D5\u05DE\u05DE\u05D7\u05D9\u05E9\u05D4 \u05D0\u05EA \u05E8\u05E9\u05EA \u05D4\u05EA\u05D5\u05E6\u05D0\u05D5\u05EA.",
    heImg: "/static/img/pbsc-2020-landing-page/rabbiniccitation.png",
    heImgAlt: "\u05E8\u05E9\u05EA \u05E6\u05D9\u05D8\u05D5\u05D8\u05D9\u05DD \u05E9\u05DC \u05D7\u05DB\u05DE\u05D9 \u05D4\u05EA\u05DC\u05DE\u05D5\u05D3",
    borderColor: sefaria_palette.colors.lavender,
    link: "http://www.rabbiniccitations.jewishstudies.digitalscholarship.brown.edu/blog/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "T'Feeling",
    enText: "By Matan Kotler-Berkowitz<br/><br/>T\u2019Feeling encourages people to think deeply and intentionally about the connections between t'fillot and emotions. The site allows users to browse t\u2019fillot by emotion (either what they\u2019re currently feeling or what they hope to be feeling), as well as contribute their own ratings for which t\u2019fillot connect most to which emotions.",
    enImg: "/static/img/pbsc-2020-landing-page/tfeeling.png",
    enImgAlt: "T'Feeling",
    heTitle: "\u05EA'\u05E4\u05D9\u05DC\u05D9\u05E0\u05D2",
    heText: "\u05DE\u05EA\u05DF \u05E7\u05D5\u05D8\u05DC\u05E8\u05BE\u05D1\u05E8\u05E7\u05D5\u05D1\u05D9\u05E5<br/><br/>\u05EA'\u05E4\u05D9\u05DC\u05D9\u05E0\u05D2 (T\u2019Feeling) \u05DE\u05E2\u05D5\u05D3\u05D3 \u05DC\u05D7\u05E9\u05D5\u05D1 \u05D1\u05E6\u05D5\u05E8\u05D4 \u05E2\u05DE\u05D5\u05E7\u05D4 \u05D5\u05DE\u05DB\u05D5\u05D5\u05E0\u05EA \u05D9\u05D5\u05EA\u05E8 \u05E2\u05DC \u05D4\u05E7\u05E9\u05E8\u05D9\u05DD \u05E9\u05D1\u05D9\u05DF \u05EA\u05E4\u05D9\u05DC\u05D5\u05EA \u05D5\u05E8\u05D2\u05E9\u05D5\u05EA. \u05D4\u05D0\u05EA\u05E8 \u05DE\u05E6\u05D9\u05D2 \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05E9\u05DC\u05DC \u05EA\u05E4\u05D9\u05DC\u05D5\u05EA \u05E2\u05DC \u05E4\u05D9 \u05E8\u05D2\u05E9 (\u05E9\u05D0\u05D5\u05EA\u05D5 \u05D4\u05DD \u05DE\u05E8\u05D2\u05D9\u05E9\u05D9\u05DD \u05E2\u05DB\u05E9\u05D9\u05D5 \u05D0\u05D5 \u05DE\u05D9\u05D9\u05D7\u05DC\u05D9\u05DD \u05DC\u05D7\u05D5\u05E9), \u05D5\u05DB\u05DF \u05DE\u05D0\u05E4\u05E9\u05E8 \u05DC\u05D4\u05DD \u05DC\u05D3\u05E8\u05D2 \u05D0\u05D9\u05DC\u05D5 \u05EA\u05E4\u05D9\u05DC\u05D5\u05EA \u05D4\u05DF \u05D4\u05DE\u05EA\u05D0\u05D9\u05DE\u05D5\u05EA \u05D1\u05D9\u05D5\u05EA\u05E8 \u05DC\u05DB\u05DC \u05E8\u05D2\u05E9.",
    heImg: "/static/img/pbsc-2020-landing-page/tfeeling.png",
    heImgAlt: "\u05EA'\u05E4\u05D9\u05DC\u05D9\u05E0\u05D2",
    borderColor: sefaria_palette.colors.yellow,
    link: "https://tfeeling.netlify.app"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "CiteMakor",
    enText: "By Ariel Caplan<br/><br/>CiteMakor is a Twitter bot which accepts requests for citations and responds by tweeting back one or more images that include the cited text. The goal of CiteMakor is to make it easy to bring source texts into discussions of Jewish topics on Twitter.",
    enImg: "/static/img/pbsc-2020-landing-page/citemakor.png",
    enImgAlt: "CiteMakor",
    heTitle: "\u05D4\u05DE\u05E6'\u05D8\u05D8",
    heText: "\u05D0\u05E8\u05D9\u05D0\u05DC \u05E7\u05E4\u05DC\u05DF<br/><br/>\u05D4\u05DE\u05E6'\u05D8\u05D8 \u05D4\u05D5\u05D0 \u05D1\u05D5\u05D8 \u05D8\u05D5\u05D5\u05D9\u05D8\u05E8 \u05D4\u05DE\u05E7\u05D1\u05DC \u05D1\u05E7\u05E9\u05D5\u05EA \u05DC\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DE\u05E1\u05D5\u05D9\u05DE\u05D9\u05DD \u05D5\u05DE\u05E9\u05D9\u05D1 \u05E2\u05DC \u05D9\u05D3\u05D9 \u05E6\u05D9\u05D5\u05E5 \u05E9\u05DC \u05EA\u05DE\u05D5\u05E0\u05D4 \u05D0\u05D7\u05EA \u05D0\u05D5 \u05D9\u05D5\u05EA\u05E8 \u05D4\u05DB\u05D5\u05DC\u05DC\u05EA \u05D0\u05EA \u05D4\u05D8\u05E7\u05E1\u05D8 \u05D4\u05DE\u05E6\u05D5\u05D8\u05D8. \u05DE\u05D8\u05E8\u05EA\u05BE\u05D4\u05E2\u05DC \u05E9\u05DC \u05D4\u05DE\u05E6'\u05D8\u05D8 \u05D4\u05D9\u05D0 \u05DC\u05D4\u05E7\u05DC \u05E2\u05DC \u05D4\u05D1\u05D0\u05EA \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D8\u05E7\u05E1\u05D8\u05D5\u05D0\u05DC\u05D9\u05D9\u05DD \u05DC\u05EA\u05D5\u05DA \u05D3\u05D9\u05D5\u05E0\u05D9\u05DD \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD \u05E2\u05DB\u05E9\u05D5\u05D5\u05D9\u05D9\u05DD \u05D1\u05D8\u05D5\u05D5\u05D9\u05D8\u05E8.",
    heImg: "/static/img/pbsc-2020-landing-page/citemakor.png",
    heImgAlt: "",
    borderColor: sefaria_palette.colors.purple,
    link: "https://twitter.com/CiteMakor"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Gifaria",
    enText: "By John Cassil and Tiger Tang<br/><br/>For a little bit of fun, gifaria finds GIFs relevant to any verse in Tanakh. This project provides an engaging way for people to interact with biblical texts in a lighthearted way.",
    enImg: "/static/img/pbsc-2020-landing-page/gifaria.png",
    enImgAlt: "Gifaria",
    heTitle: "\u05D2\u05D9\u05E4\u05B7\u05E8\u05D9\u05D0",
    heText: "\u05D2\u05F3\u05D5\u05DF \u05E7\u05E1\u05D9\u05DC \u05D5\u05D8\u05D9\u05D9\u05D2\u05E8 \u05D8\u05D0\u05E0\u05D2<br/><br/>\u05D0\u05D9 \u05D0\u05E4\u05E9\u05E8 \u05D1\u05DC\u05D9 \u05E7\u05E6\u05EA \u05DB\u05D9\u05E3. \u05D1\u05E2\u05D6\u05E8\u05EA \u05D2\u05D9\u05E4\u05E8\u05D9\u05D0 \u05EA\u05D5\u05DB\u05DC\u05D5 \u05DC\u05DE\u05E6\u05D5\u05D0 \u05D2\u05D9\u05E4\u05D9\u05DD \u05E8\u05DC\u05D5\u05D5\u05E0\u05D8\u05D9\u05D9\u05DD \u05DC\u05DB\u05DC \u05E4\u05E1\u05D5\u05E7 \u05D1\u05EA\u05E0\"\u05DA. \u05D4\u05DE\u05D9\u05D6\u05DD \u05D4\u05D6\u05D4 \u05DE\u05E1\u05E4\u05E7 \u05D3\u05E8\u05DA \u05D0\u05D8\u05E8\u05E7\u05D8\u05D9\u05D1\u05D9\u05EA \u05D5\u05E7\u05DC\u05D9\u05DC\u05D4 \u05DC\u05E2\u05E1\u05D5\u05E7 \u05D1\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05EA\u05E0\"\u05DB\u05D9\u05D9\u05DD.",
    heImg: "/static/img/pbsc-2020-landing-page/gifaria.png",
    heImgAlt: "\u05D2\u05D9\u05E4\u05B7\u05E8\u05D9\u05D0",
    borderColor: sefaria_palette.colors.lightblue,
    link: "https://tiger-tang.shinyapps.io/gifaria/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "The Taryag Mitzvos",
    enText: "By Rafi Wolfe<br/><br/>The Taryag Mitzvos is an interactive visualization of the 613 commandments, and the different ways that different scholars have enumerated that list. The interface lets users view and sort according to which opinions support each mitzvah\u2019s inclusion, as well as compare the differences between different lists.",
    enImg: "/static/img/pbsc-2020-landing-page/thetaryag.png",
    enImgAlt: "The Taryag Mitzvos",
    heTitle: "\u05EA\u05E8\u05D9\"\u05D2 \u05DE\u05E6\u05D5\u05D5\u05EA",
    heText: "\u05E8\u05E4\u05D9 \u05D5\u05D5\u05DC\u05E3<br/><br/>\u05EA\u05E8\u05D9\"\u05D2 \u05DE\u05E6\u05D5\u05D5\u05EA \u05D4\u05D5\u05D0 \u05D4\u05DE\u05D7\u05E9\u05D4 \u05D0\u05D9\u05E0\u05D8\u05E8\u05D0\u05E7\u05D8\u05D9\u05D1\u05D9\u05EA \u05E9\u05DC 613 \u05D4\u05DE\u05E6\u05D5\u05D5\u05EA \u05D5\u05E9\u05DC \u05E9\u05DC\u05DC \u05D3\u05E8\u05DB\u05D9 \u05D4\u05DE\u05E0\u05D9\u05D9\u05D4 \u05E9\u05DC\u05D4\u05DF \u05E9\u05E0\u05E7\u05D8\u05D5 \u05D7\u05DB\u05DE\u05D9\u05DD \u05E9\u05D5\u05E0\u05D9\u05DD \u05D1\u05D9\u05E6\u05D9\u05E8\u05EA \u05D4\u05E8\u05E9\u05D9\u05DE\u05D4 \u05D4\u05D6\u05D5. \u05D4\u05DE\u05DE\u05E9\u05E7 \u05DE\u05D0\u05E4\u05E9\u05E8 \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05D5\u05DC\u05DE\u05E9\u05EA\u05DE\u05E9\u05D5\u05EA \u05DC\u05D2\u05DC\u05D5\u05EA \u05D0\u05D9\u05DC\u05D5 \u05DE\u05E6\u05D5\u05D5\u05EA \u05E0\u05DE\u05E0\u05D5 \u05D1\u05D9\u05D3\u05D9 \u05D0\u05D9\u05DC\u05D5 \u05E8\u05D1\u05E0\u05D9\u05DD \u05D5\u05DC\u05DE\u05D9\u05D9\u05DF \u05D0\u05D5\u05EA\u05DF \u05D1\u05D4\u05EA\u05D0\u05DD, \u05D5\u05DB\u05DF \u05DC\u05D4\u05E9\u05D5\u05D5\u05EA \u05D1\u05D9\u05DF \u05D4\u05E8\u05E9\u05D9\u05DE\u05D5\u05EA",
    heImg: "/static/img/pbsc-2020-landing-page/thetaryag.png",
    heImgAlt: "\u05EA\u05E8\u05D9\"\u05D2 \u05DE\u05E6\u05D5\u05D5\u05EA",
    borderColor: sefaria_palette.colors.lightgreen,
    link: "https://thetaryag.com/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "3D Tanach Family Tree",
    enText: "By Moshe Escott, Shlomo Gordon, Simcha Schaum, Aaron Farntrog and Ari Abramowitz<br/><br/>The 3D Tanach Family Tree is an interactive 3D visualization of characters mentioned in Tanach. As you float through the tree you can find information about each character, search relationships between them, and find verses on Tanach where they appear.  Select \"Tanach Family Tree\" from the menu at top right to view.",
    enImg: "/static/img/pbsc-2020-landing-page/familytree.jpg",
    enImgAlt: "3D Tanach Family Tree",
    heTitle: "\u05D0\u05D9\u05DC\u05DF \u05D9\u05D5\u05D7\u05E1\u05D9\u05DF \u05EA\u05E0\"\u05DB\u05D9 \u05EA\u05DC\u05EA \u05DE\u05DE\u05D3\u05D9",
    heText: "\u05DE\u05E9\u05D4 \u05D0\u05E1\u05E7\u05D5\u05D8, \u05E9\u05DC\u05DE\u05D4 \u05D2\u05D5\u05E8\u05D3\u05D5\u05DF, \u05E9\u05DE\u05D7\u05D4 \u05E9\u05D0\u05D5\u05DD, \u05D0\u05D4\u05E8\u05D5\u05DF \u05E4\u05E8\u05E0\u05D8\u05E8\u05D5\u05D2 \u05D5\u05D0\u05E8\u05D9 \u05D0\u05D1\u05E8\u05DE\u05D5\u05D1\u05D9\u05E5<br/><br/>\u05D0\u05D9\u05DC\u05DF \u05D4\u05D9\u05D5\u05D7\u05E1\u05D9\u05DF \u05D4\u05EA\u05E0\"\u05DB\u05D9 \u05D5\u05D4\u05EA\u05DC\u05EA\u05BE\u05DE\u05DE\u05D3\u05D9 \u05D4\u05D5\u05D0 \u05D4\u05DE\u05D7\u05E9\u05D4 \u05EA\u05DC\u05EA\u05BE\u05DE\u05DE\u05D3\u05D9\u05EA \u05E9\u05DC \u05D3\u05DE\u05D5\u05D9\u05D5\u05EA \u05EA\u05E0\"\u05DB\u05D9\u05D5\u05EA. \u05D1\u05D9\u05DB\u05D5\u05DC\u05EA\u05DA \u05DC\u05E9\u05D5\u05D8\u05D8 \u05D1\u05EA\u05D5\u05DA \u05D4\u05D0\u05D9\u05DC\u05DF \u05D5\u05DC\u05DE\u05E6\u05D5\u05D0 \u05DE\u05D9\u05D3\u05E2 \u05E2\u05DC \u05DB\u05DC \u05D3\u05DE\u05D5\u05EA \u05D5\u05D3\u05DE\u05D5\u05EA, \u05DC\u05D7\u05E4\u05E9 \u05E7\u05E9\u05E8\u05D9\u05DD \u05D1\u05D9\u05E0\u05D9\u05D4\u05DF \u05D5\u05DC\u05D2\u05DC\u05D5\u05EA \u05E4\u05E1\u05D5\u05E7\u05D9\u05DD \u05E9\u05D1\u05D4\u05DD \u05D4\u05DF \u05E0\u05D6\u05DB\u05E8\u05D5\u05EA. \u05DB\u05D3\u05D9 \u05DC\u05E6\u05E4\u05D5\u05EA \u05D1\u05D0\u05D9\u05DC\u05DF, \u05D9\u05E9 \u05DC\u05DC\u05D7\u05D5\u05E5 \u05E2\u05DC \"\u05D0\u05D9\u05DC\u05DF \u05D9\u05D5\u05D7\u05E1\u05D9\u05DF \u05EA\u05E0\"\u05DB\u05D9\" \u05E9\u05D1\u05EA\u05E4\u05E8\u05D9\u05D8 \u05D4\u05E0\u05DE\u05E6\u05D0 \u05D1\u05E4\u05D9\u05E0\u05D4 \u05D4\u05D9\u05DE\u05E0\u05D9\u05EA \u05D4\u05E2\u05DC\u05D9\u05D5\u05E0\u05D4 \u05E9\u05DC \u05D4\u05D3\u05E3.",
    heImg: "/static/img/pbsc-2020-landing-page/familytree.jpg",
    heImgAlt: "\u05D0\u05D9\u05DC\u05DF \u05D9\u05D5\u05D7\u05E1\u05D9\u05DF \u05EA\u05E0\"\u05DB\u05D9 \u05EA\u05DC\u05EA\u05BE\u05DE\u05DE\u05D3\u05D9",
    borderColor: sefaria_palette.colors.red,
    link: "http://www.basehasefer.com/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Gematriaphone",
    enText: "By Alexander Boxer<br/><br/>Gematriaphone lets you hear the Torah's hidden mathematical music. Starting from any word of Torah, users can hear tones corresponding to the gematria of each word as it is highlighted on the screen.",
    enImg: "/static/img/pbsc-2020-landing-page/gematriaphone.png",
    enImgAlt: "Gematriaphone",
    heTitle: "\u05D2\u05D9\u05DE\u05D8\u05E8\u05D9\u05D4 \u05E7\u05D5\u05DC\u05D9\u05EA",
    heText: "\u05D0\u05DC\u05DB\u05E1\u05E0\u05D3\u05E8 \u05D1\u05D5\u05E7\u05E1\u05E8<br/><br/>\u05D4\u05D2\u05D9\u05DE\u05D8\u05E8\u05D9\u05D4 \u05D4\u05E7\u05D5\u05DC\u05D9\u05EA \u05DE\u05D0\u05E4\u05E9\u05E8\u05EA \u05DC\u05DA \u05DC\u05E9\u05DE\u05D5\u05E2 \u05D0\u05EA \u05D4\u05DE\u05D5\u05D6\u05D9\u05E7\u05D4 \u05D4\u05DE\u05EA\u05DE\u05D8\u05D9\u05EA \u05D4\u05D7\u05D1\u05D5\u05D9\u05D4 \u05D1\u05EA\u05D5\u05E8\u05D4. \u05D4\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05D5\u05D4\u05DE\u05E9\u05EA\u05DE\u05E9\u05D5\u05EA \u05D9\u05DB\u05D5\u05DC\u05D9\u05DD \u05DC\u05D1\u05D7\u05D5\u05E8 \u05DB\u05DC \u05DE\u05D9\u05DC\u05D4 \u05D1\u05EA\u05D5\u05E8\u05D4, \u05DC\u05E9\u05DE\u05D5\u05E2 \u05D0\u05EA \u05D4\u05E6\u05DC\u05D9\u05DC\u05D9\u05DD \u05E2\u05DC \u05E4\u05D9 \u05D4\u05D2\u05D9\u05DE\u05D8\u05E8\u05D9\u05D4 \u05E9\u05DC\u05D4 \u05D5\u05DC\u05E8\u05D0\u05D5\u05EA \u05D0\u05D5\u05EA\u05D4 \u05DE\u05D5\u05D3\u05D2\u05E9\u05EA \u05E2\u05DC \u05D4\u05E6\u05D2.",
    heImg: "/static/img/pbsc-2020-landing-page/gematriaphone.png",
    heImgAlt: "\u05D2\u05D9\u05DE\u05D8\u05E8\u05D9\u05D4 \u05E7\u05D5\u05DC\u05D9\u05EA",
    borderColor: sefaria_palette.colors.teal,
    link: "http://alexboxer.com/gematriaphone/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "sefaria-connections",
    enText: "By Charles Loder<br/><br/>Sefaria-connections is an interactive visualization of the connections between texts in Sefaria\u2019s library. Starting from any line of Tanakh you can choose a type of connection, see the sources that match that type, and see the sources connected to those sources.",
    enImg: "/static/img/pbsc-2020-landing-page/sefariaconnections.png",
    enImgAlt: "SefariAcrostic",
    heTitle: "\u05E7\u05E9\u05E8\u05D9 \u05E1\u05E4\u05E8\u05D9\u05D0",
    heText: "\u05E6\u05F3\u05E8\u05DC\u05E1 \u05DC\u05D5\u05D3\u05E8<br/><br/>\u05E7\u05E9\u05E8\u05D9 \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D4\u05DD \u05D4\u05DE\u05D7\u05E9\u05D4 \u05D0\u05D9\u05E0\u05D8\u05E8\u05D0\u05E7\u05D8\u05D9\u05D1\u05D9\u05EA \u05E9\u05DC \u05D4\u05B7\u05E7\u05E9\u05E8\u05D9\u05DD \u05E9\u05D1\u05D9\u05DF \u05D4\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05D4\u05DE\u05E6\u05D5\u05D9\u05D9\u05DD \u05D1\u05E1\u05E4\u05E8\u05D9\u05D9\u05EA \u05E1\u05E4\u05E8\u05D9\u05D0. \u05D0\u05E4\u05E9\u05E8 \u05DC\u05D1\u05D7\u05D5\u05E8 \u05DB\u05DC \u05E4\u05E1\u05D5\u05E7 \u05D1\u05EA\u05E0\"\u05DA \u05D5\u05D0\u05EA \u05E1\u05D5\u05D2 \u05D4\u05E7\u05E9\u05E8 \u05D4\u05D0\u05D9\u05E0\u05D8\u05E8\u05D8\u05E7\u05E1\u05D8\u05D5\u05D0\u05DC\u05D9, \u05DC\u05E8\u05D0\u05D5\u05EA \u05D0\u05EA \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D4\u05DE\u05EA\u05D0\u05D9\u05DE\u05D9\u05DD \u05DC\u05E1\u05D5\u05D2 \u05D4\u05E7\u05E9\u05E8 \u05D4\u05D6\u05D4 \u05D5\u05DC\u05D2\u05DC\u05D5\u05EA \u05D0\u05EA \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D4\u05E7\u05E9\u05D5\u05E8\u05D9\u05DD \u05DC\u05D0\u05D5\u05EA\u05DD \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA.",
    heImg: "/static/img/pbsc-2020-landing-page/sefariaconnections.png",
    heImgAlt: "\u05E7\u05E9\u05E8\u05D9 \u05E1\u05E4\u05E8\u05D9\u05D0",
    borderColor: sefaria_palette.colors.tan,
    link: "https://charlesloder.github.io/sefaria-connections/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "SefariAcrostic",
    enText: "By Ezra Gordon<br/><br/>SefariaAcrostic searches books of Tanakh for acrostics that match a person\u2019s Hebrew name. Acrostics can be used to create digital art or to inspire personalized artwork for a simcha, such as finding an acrostic with the couple's names for a wedding.",
    enImg: "/static/img/pbsc-2020-landing-page/acrostic.png",
    enImgAlt: "SefariAcrostic",
    heTitle: "\u05E1\u05E4\u05E8\u05D9\u05D0\u05E7\u05E8\u05D5\u05E1\u05D8\u05D9\u05DB\u05D5\u05DF",
    heText: "\u05E2\u05D6\u05E8\u05D0 \u05D2\u05D5\u05E8\u05D3\u05D5\u05DF<br/><br/>\u05E1\u05E4\u05E8\u05D9\u05D0\u05E7\u05E8\u05D5\u05E1\u05D8\u05D9\u05DB\u05D5\u05DF \u05DE\u05E1\u05D5\u05D2\u05DC \u05DC\u05DE\u05E6\u05D5\u05D0 \u05D0\u05E7\u05E8\u05D5\u05E1\u05D8\u05D9\u05DB\u05D5\u05E0\u05D9\u05DD \u05D1\u05E1\u05E4\u05E8\u05D9 \u05D4\u05EA\u05E0\"\u05DA \u05DC\u05E4\u05D9 \u05E9\u05DE\u05D5\u05EA \u05E4\u05E8\u05D8\u05D9\u05D9\u05DD \u05E2\u05D1\u05E8\u05D9\u05D9\u05DD. \u05D1\u05E2\u05D6\u05E8\u05EA \u05D4\u05DE\u05D9\u05D6\u05DD \u05D0\u05E4\u05E9\u05E8 \u05DC\u05D9\u05E6\u05D5\u05E8 \u05D0\u05D5\u05DE\u05E0\u05D5\u05EA \u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9\u05EA \u05D0\u05D5 \u05E7\u05D8\u05E2 \u05D0\u05D5\u05DE\u05E0\u05D5\u05EA \u05D0\u05D9\u05E9\u05D9 \u05DC\u05E6\u05D5\u05E8\u05DA \u05D0\u05D9\u05E8\u05D5\u05E2 \u05DE\u05E9\u05DE\u05D7, \u05DC\u05DE\u05E9\u05DC \u05D0\u05E7\u05E8\u05D5\u05E1\u05D8\u05D9\u05DB\u05D5\u05DF \u05DC\u05D7\u05EA\u05D5\u05E0\u05D4 \u05E2\u05DD \u05E9\u05DE\u05D5\u05EA \u05D1\u05E0\u05D9 \u05D4\u05D6\u05D5\u05D2.",
    heImg: "/static/img/pbsc-2020-landing-page/acrostic.png",
    heImgAlt: "\u05E1\u05E4\u05E8\u05D9\u05D0\u05E7\u05E8\u05D5\u05E1\u05D8\u05D9\u05DB\u05D5\u05DF",
    borderColor: sefaria_palette.colors.lightbg,
    link: "https://20gordone.github.io/SefariaContest/"
  }), /*#__PURE__*/external_react_default().createElement(CallToActionFooterWithButton, {
    href: "https://github.com/Sefaria/Sefaria-Project",
    he_href: "https://github.com/Sefaria/Sefaria-Project",
    enText: "Want to create something of your own?",
    heText: "\u05E8\u05D5\u05E6\u05D4 \u05DC\u05D9\u05E6\u05D5\u05E8 \u05DE\u05E9\u05D4\u05D5 \u05DE\u05E9\u05DC\u05DA?",
    enButtonText: "GitHub",
    heButtonText: "GitHub"
  }), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    white: true,
    enTitle: "Explore more projects",
    heTitle: "\u05DC\u05DE\u05D9\u05D3\u05E2 \u05E2\u05DC \u05E2\u05D5\u05D3 \u05DB\u05DE\u05D4 \u05DE\u05D9\u05D6\u05DE\u05D9\u05DD"
  }, [["Abba Saul", "", "https://github.com/scopreon/abba-saul/"], ["Amud-anan", "", "https://github.com/Binyomin-Cohen/sefaria"], ["Bashamayim Hi", "", "https://yosefsklar.github.io/bashamayim-hi/"], ["Daily Daf Tracker", "", "https://mattpolanieckidev.github.io/dailydaf/"], ["I’m Learning Lucky", "", "https://github.com/jmcaplan/sefariaExtension"], ["Jew And A", "", "https://seph-efd35.web.app/"], ["Leiner", "", "https://appetize.io/app/w380pbm112n7ar9m4n6er9kpm8?device=iphone11promax&scale=100&orientation=portrait&osVersion=13.3"], ["Memorize Plus", "", "https://www.dropbox.com/sh/cd5xhc1gg8oqqk7/AAAeFSscagGfesVgyBkBwEiIa?dl=0"], ["NLP-Talmud", "", "https://github.com/adinabruce/NLP-Talmud"], ["Pninim", "", "https://pninim.yiddishe-kop.com/"], ["QUIZARIA", "", "https://www.figma.com/proto/wk07O8t1I9Wxw989SGopwr/QUIZARIA!?node-id=11%3A14&scaling=scale-down"], ["Quran Tanakh Kabbalah Project", "", "https://bref-saucisson-56522.herokuapp.com/"], ["RecurrentRav", "", "https://github.com/leerosenthalj/RecurrentRav"], ["Scribe", "", "https://www.youtube.com/watch?v=BkCKrLf6pvk&feature=youtu.be"], ["Sheilta", "", "https://www.sheilta.ml/"], ["Talmud Note", "", "https://play.google.com/store/apps/details?id=com.graytapps.talmudnote"], ["Talmudoi Beyodoi", "", " https://torah.yiddishe-kop.com/"], ["The Jewish Story Through Books", "", "https://joshcooper417.github.io/"], ["Torah for the Blind", "", "https://torahfortheblind.com/"], ["Tweet Yomi", "", "https://tweetyomi.org/"], ["Visualizations of Sefaria", "", "https://guedalia.github.io/testab/test"], ["Visualizing Talmud Topics", "", "https://share.streamlit.io/guedalia/streamlit/main/first_app.py"], ["Visualizing Works Influence", "", "https://adinabechhofer.github.io/"], ["Yamim Noraim Machzor", "", "https://play.google.com/store/apps/details?id=com.machzoryamimnoraim"], ["Yomyomishna", "", "https://yomyomishna.web.app/"]].map(function (i) {
    return /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: false,
      tall: true,
      newTab: true,
      href: i[2],
      he_href: i[2],
      he: i[0],
      en: i[0]
    });
  })));
};
var DonatePage = function DonatePage() {
  return /*#__PURE__*/external_react_default().createElement(StaticPage, {
    optionalClass: "donate"
  }, /*#__PURE__*/external_react_default().createElement(HeaderForDonatePage, null), /*#__PURE__*/external_react_default().createElement("div", {
    className: "center"
  }, /*#__PURE__*/external_react_default().createElement(H1Block, {
    en: "How to make a difference:",
    he: "\u05DE\u05E1\u05E2 \u05E9\u05DC \u05D2\u05D9\u05DC\u05D5\u05D9"
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    gap: "30px",
    content: [/*#__PURE__*/external_react_default().createElement(FeatureBox, {
      enTitle: "Make a One-Time Gift",
      heTitle: "",
      enText: "Whether you give $1.80, $18, or $1,800, every gift made to Sefaria supports the future of Torah.",
      heText: "",
      enButtonText: "Donate Now",
      heButtonText: "",
      enButtonUrl: "https://donate.sefaria.org/en",
      heButtonUrl: "https://donate.sefaria.org/he",
      borderColor: "#004E5F"
    }), /*#__PURE__*/external_react_default().createElement(FeatureBox, {
      enTitle: "Become a Sustainer",
      heTitle: "",
      enText: "Multiply the power of your impact by signing up for a monthly donation with hundreds of other users, supporting a vision of <em>Torah for all.</em>",
      heText: "",
      enButtonText: "Join the Sustainers",
      heButtonText: "",
      enButtonUrl: "https://donate.sefaria.org/sustainers",
      heButtonUrl: "https://donate.sefaria.org/sustainershe",
      borderColor: "#97B386"
    }), /*#__PURE__*/external_react_default().createElement(FeatureBox, {
      enTitle: "Sponsor a Day of Learning",
      heTitle: "",
      enText: "Fuel a day of study on Sefaria by celebrating a special occasion, commemorating a yahrzeit, or honoring a legacy \u2014 with a gift of $360 or more.",
      heText: "",
      enButtonText: "Sponsor a Day of Learning",
      heButtonText: "",
      enButtonUrl: "https://donate.sefaria.org/sponsor",
      heButtonUrl: "https://donate.sefaria.org/sponsorhe",
      borderColor: "#4B71B7"
    }), /*#__PURE__*/external_react_default().createElement(FeatureBox, {
      enTitle: "Sponsor a Text",
      heTitle: "",
      enText: "There are many opportunities to sponsor a text or translation in Sefaria's ever growing library and receive a personal dedication. ",
      heText: "",
      enButtonText: "Learn More",
      heButtonText: "",
      enButtonUrl: "https://drive.google.com/file/d/1FU8bHy7jZz86aywF7_kYMV0N3_h-k0nM/view",
      heButtonUrl: "",
      borderColor: "#7C416F"
    })]
  })), /*#__PURE__*/external_react_default().createElement(Spacer, null), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H1Block, {
    en: "Ways to Give",
    he: "",
    serif: true
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    threshold3: 768,
    threshold2: 500,
    gap: "10px",
    stretch: true,
    content: [/*#__PURE__*/external_react_default().createElement(HeaderWithColorAccentBlockAndText, {
      enTitle: "Donate Online",
      heTitle: "",
      enText: "<p>Make a donation by <strong>credit card, PayPal, GooglePay, ApplePay, Venmo, or bank transfer</strong> on our <a href='http://donate.sefaria.org/en'>main donation page</a>.</p>",
      heText: "",
      colorBar: "#AB4E66"
    }), /*#__PURE__*/external_react_default().createElement(HeaderWithColorAccentBlockAndText, {
      enTitle: "Donate by Mail",
      heTitle: "",
      enText: "<p><strong>Personal checks</strong> should be made payable to \u201CSefaria\u201D and mailed to:</p> <p>Sefaria<br/> 228 Park Avenue South<br/> Suite 79262<br/> New York, NY 10003-1502</p>",
      heText: "",
      colorBar: "#D4896C"
    }), /*#__PURE__*/external_react_default().createElement(HeaderWithColorAccentBlockAndText, {
      enTitle: "Donor-Advised Fund",
      heTitle: "",
      enText: "<p>Sefaria accepts donations from donor-advised funds; our <strong>EIN is 46-4406454</strong>. If you need additional information to make a DAF donation, please contact Caitlyn Cushing, Development Operations Associate, at <a href='mailto:donate@sefaria.org'>donate@sefaria.org</a>.</p>",
      heText: "",
      colorBar: "#CCB479"
    }), /*#__PURE__*/external_react_default().createElement(HeaderWithColorAccentBlockAndText, {
      enTitle: "Additional Ways to Give",
      heTitle: "",
      enText: "<p>Sefaria also accepts donations via <strong>wire transfer</strong>, <strong>stock</strong>, and <strong>Cryptocurrency</strong>. For more information, please email Caitlyn Cushing, Development Operations Associate, at <a href='mailto:donate@sefaria.org'>donate@sefaria.org</a>. (For wire transfers, you can also <a href='https://sefaria.formstack.com/forms/wire_request'>click here</a> to get our account information).",
      heText: "",
      colorBar: "#97B386"
    })]
  })), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageCallToActionFooter"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer light"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "msgToSupporters"
  }, /*#__PURE__*/external_react_default().createElement("h1", {
    className: "serif center"
  }, "Thank you for your support!")))), /*#__PURE__*/external_react_default().createElement(H1Block, {
    en: "Get Your questions answered.",
    he: "",
    serif: true
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner"
  }, /*#__PURE__*/external_react_default().createElement("h2", {
    className: "serif"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Your Gift to Sefaria")), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "Can I make my gift in honor or memory of someone?",
    heTitle: "",
    enText: "<p>Yes! If you\u2019re donating online, check the box for \u201CDedicate my donation <strong>in honor or in memory</strong> of someone\u201D right after entering your donation amount. Then enter your desired tribute information and our donation processing platform will send your message to the recipient. If you have questions about this process, please email <a href='mailto:donate@sefaria.org'>donate@sefaria.org</a></p>",
    heText: "",
    colorBar: "#B8D4D3"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "Where does my gift go? How does Sefaria use the donations it receives?",
    heTitle: "",
    enText: "<p>Generally, gifts made to Sefaria are considered \u201Cunrestricted,\u201D meaning that our staff allocates funds where they\u2019re needed most. This includes everything from the text and learning you see on your screen to the technology support that keeps us online to the time and energy of the Sefaria team.</p> <p><a href='https://www.guidestar.org/profile/46-4406454'>Sefaria has a Platinum rating on GuideStar</a> and we\u2019re devoted to making sure we\u2019re transparent and open with our donors. For a closer look at our financials, <a target='_blank' href='/static/files/Sefaria_2021_990_Public.pdf'>download the most recent Sefaria 990</a>.</p>",
    heText: "",
    colorBar: "#B8D4D3"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "Can I make a gift to support a specific program or initiative?",
    heTitle: "",
    enText: "<p>Our online giving page does not support restricted gifts. You can sponsor a day of learning <a href='https://donate.sefaria.org/sponsor'>here</a>. If you would like to sponsor a text or support a specific Sefaria program, please email Samantha Shokin, Grant Writer and Development Associate, at <a href='mailto:samantha@sefaria.org'>samantha@sefaria.org</a> for more information.</p>",
    heText: "",
    colorBar: "#B8D4D3"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "I want to sponsor a day of learning or a new text. How do I know what\u2019s available and where my message will appear?",
    heTitle: "",
    enText: "<p>To learn more about available sponsorship dates and texts on Sefaria, send an email to Samantha Shokin, Grant Writer and Development Associate, at <a href='mailto:samantha@sefaria.org'>samantha@sefaria.org</a>, with \u201CSponsorship\u201D in your subject line. We\u2019ll aim to get back to you within two business days.</p> <p>Sponsorships can be made in honor, memory, or celebration of a person, group, occasion, or anything else that matters to you. </p> <p>Dedications for a day, week, or month of learning will appear on Sefaria\u2019s homepage throughout the duration of the sponsorship period beginning the evening of the date you choose. <a href='https://docs.google.com/spreadsheets/d/1CUVb18QKbRcgBvBzH-x9R_Stx-_o5YkE9bi7oYBTlRw/edit#gid=0'>Available dates can be viewed in this calendar</a>. To convert a Hebrew date to the English calendar, we recommend <a href='https://www.hebcal.com/converter/'>HebCal\u2019s date converter</a>.</p>",
    heText: "",
    colorBar: "#B8D4D3"
  }), /*#__PURE__*/external_react_default().createElement("h2", {
    className: "serif"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Giving Logistics")), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "Is my donation tax-deductible?",
    heTitle: "",
    enText: "<p>Sefaria is a registered 501(c)(3) in the United States, and all donations are fully tax-deductible under the extent of the law. We are not able to issue tax receipts to donors outside the United States.</p>",
    heText: "",
    colorBar: "#7F85A9"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "Why aren\u2019t you tax-exempt outside of the United States?",
    heTitle: "",
    enText: "<p>At this time, Sefaria only meets eligibility requirements for tax-exempt status in the United States.</p>",
    heText: "",
    colorBar: "#7F85A9"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "Can I still donate from outside the USA?",
    heTitle: "",
    enText: "<p>Yes! Donors outside of the USA may make a gift online  \u2013 via credit card, PayPal, GooglePay, ApplePay, Venmo, and bank transfer \u2013 <a href='https://donate.sefaria.org/en'>on this page</a> On this page you can modify your currency. You can also <a href='https://sefaria.formstack.com/forms/wire_request'>make a wire transfer</a>.</p>",
    heText: "",
    colorBar: "#7F85A9"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "Will I get a gift receipt?",
    heTitle: "",
    enText: "<p>Yes! If you make your gift online, you will receive an email acknowledgment that includes all the information necessary for use as a tax receipt. If you make your gift by mail, you will receive a printed acknowledgment. If you don\u2019t receive your gift receipt, please let us know at <a href='mailto:donate@sefaria.org'>donate@sefaria.org</a> and we will issue a replacement.</p>",
    heText: "",
    colorBar: "#7F85A9"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "I want to donate through a donor-advised fund, federation, or foundation. What do I need to send you?",
    heTitle: "",
    enText: "<p>Donations from these types of institutions can be made through any of the payment methods listed in the Ways to Give section above. If you are donating from a foundation, federation, or donor-advised fund, please include any relevant gift acknowledgment information or preferences along with your gift. <strong>Sefaria's EIN is 46-4406454</strong>.</p> <p>If you are sending your donation by mail, please include this information in a cover letter accompanying your check; if you are donating through a wire transfer or other electronic method, please send an email with this information to <a href='mailto:donate@sefaria.org'>donate@sefaria.org</a>. This ensures we have all the necessary information to send your gift acknowledgment and tax receipt.</p>",
    heText: "",
    colorBar: "#7F85A9"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "I think my employer will match my gift. How can I find out?",
    heTitle: "",
    enText: "<p>The best way to find out if your employer matches donations made to eligible nonprofits is to ask directly at your place of work. <a href='https://www.charitynavigator.org/index.cfm?bay=content.view&cpid=1799'>You can also search for your employer on Charity Navigator</a>.</p>",
    heText: "",
    colorBar: "#7F85A9"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "My gift is going to be matched by someone else. Will you send them an acknowledgment as well?",
    heTitle: "",
    enText: "<p>Typically, matching gifts are directly acknowledged through the third-party processor. If you would like to request a thank you letter from the Sefaria team for the individual or organization matching your gift, please send us an email at <a href='mailto:donate@sefaria.org'>donate@sefaria.org</a>. </p>",
    heText: "",
    colorBar: "#7F85A9"
  }), /*#__PURE__*/external_react_default().createElement("h2", {
    className: "serif"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Help and Support")), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "I\u2019m having trouble making my donation.",
    heTitle: "",
    enText: "<p>If you\u2019re having difficulty donating online, we want to help! Please email us at <a href='mailto:donate@sefaria.org'>donate@sefaria.org</a> with a detailed description of the issue you\u2019re experiencing, and we will get back to you within two business days. The more information you provide in your email, the more we will be able to help resolve the situation. We appreciate your patience and generosity.</p>",
    heText: "",
    colorBar: "#5A99B7"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "I made a one-time or monthly donation in error.",
    heTitle: "",
    enText: "<p>To cancel and/or request a refund for a donation, please follow the link in your email confirmation to view your online Classy (Sefaria's donation processor) profile where you can manually update or cancel your monthly gift. In addition, you can email Caitlyn Cushing, Development Operations Associate <a href='mailto:donate@sefaria.org'>donate@sefaria.org</a>, for support with this process.</p>",
    heText: "",
    colorBar: "#5A99B7"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "I never received a gift receipt / I need a new gift receipt.",
    heTitle: "",
    enText: "<p>If you\u2019re looking for a missing e-receipt, we first recommend checking your spam folder for any emails received from info@sefaria-inc.classy-mail.org. If you\u2019re unable to find your gift receipt or you need a new copy of a mailed gift receipt, please email us at <a href='mailto:donate@sefaria.org'>donate@sefaria.org</a>. </p>",
    heText: "",
    colorBar: "#5A99B7"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "I want to cancel my monthly donation.",
    heTitle: "",
    enText: "<p>We\u2019re sorry to see you go! To cancel your sustaining donation, please follow the link in your email confirmation to view your online Classy (Sefaria's donation processor) profile where you can manually update or cancel your monthly gift. In addition, you can email Caitlyn Cushing, Development Operations Associate at <a href='mailto:donate@sefaria.org'>donate@sefaria.org</a>, or by phone at <a href='tel:+13477730077'>(347) 773-0077</a></p>",
    heText: "",
    colorBar: "#5A99B7"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "I want to change my monthly donation by updating the amount or changing my credit card.",
    heTitle: "",
    enText: "<p>To change the amount of or credit card information associated with your monthly donation, please follow the link in your email confirmation to your Classy (Sefaria's donation processor) profile. On your profile, you can edit this information. You can also contact Caitlyn Cushing, Development Operations Associate, at <a href='mailto:donate@sefaria.org'>donate@sefaria.org</a>, for assistance with this process.",
    heText: "",
    colorBar: "#5A99B7"
  })), /*#__PURE__*/external_react_default().createElement(Spacer, null), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageCallToActionFooter"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer light"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "msgToSupporters"
  }, /*#__PURE__*/external_react_default().createElement("h2", {
    className: "serif"
  }, "Sefaria takes pride in its financial stewardship as a fully transparent, 501(c)(3) charitable organization. Sefaria\u2019s EIN is 46-4406454."), /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    threshold3: 768,
    threshold2: 500,
    gap: "10px",
    stretch: true,
    content: [/*#__PURE__*/external_react_default().createElement("div", {
      className: "finStewardBox"
    }, /*#__PURE__*/external_react_default().createElement("h2", {
      className: "serif"
    }, "GuideStar Platinum"), /*#__PURE__*/external_react_default().createElement("p", null, "Sefaria is proud to have received a Platinum Seal of Transparency from Guidestar, which indicates that we have proven a commitment to sharing our goals, strategies, and key metrics towards achieving our mission and vision."), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: true,
      tall: false,
      newTab: true,
      href: "https://www.guidestar.org/profile/46-4406454",
      he_href: "",
      he: "",
      en: "Learn More"
    })), /*#__PURE__*/external_react_default().createElement("div", {
      className: "finStewardBox"
    }, /*#__PURE__*/external_react_default().createElement("h2", {
      className: "serif"
    }, "Sefaria\u2019s 990 "), /*#__PURE__*/external_react_default().createElement("p", null, "Nonprofit organizations are required to file a Form 990 each year that provides the public with information about our revenue, expenditures, and other key financial data. We are committed to making sure our 990 is always easily accessible. "), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: true,
      tall: false,
      newTab: true,
      href: "/static/files/Sefaria_2021_990_Public.pdf",
      he_href: "",
      he: "",
      en: "See Here"
    })), /*#__PURE__*/external_react_default().createElement("div", {
      className: "finStewardBox"
    }, /*#__PURE__*/external_react_default().createElement("h2", {
      className: "serif"
    }, "Annual Report "), /*#__PURE__*/external_react_default().createElement("p", null, "Each year, our annual report gives an up-to-date account of our achievements, challenges, innovations, and benchmarks. The annual report also includes messages and stories from our leadership, team members, and supporters like you."), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: true,
      tall: false,
      newTab: true,
      href: "/static/files/Sefaria_AnnualImpactReport_R14.pdf",
      he_href: "",
      he: "",
      en: "Read Here"
    }))]
  })))));
};
var WordByWordPage = function WordByWordPage() {
  return /*#__PURE__*/external_react_default().createElement(StaticPage, {
    optionalClass: "donate wordbyword"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageHeader wordbyword"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageHeaderTextBox donate"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, "Word-by-Word: A Jewish Women's Writing Circle")), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageHeaderText"
  }, /*#__PURE__*/external_react_default().createElement("em", null, "\"...I am grateful to God for this gift, this possibility of developing myself and of writing, of expressing all that is in me.\""), /*#__PURE__*/external_react_default().createElement("br", null), "- Anne Frank")))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageCallToActionFooter"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer light"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "msgToSupportersEven"
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Word-by-Word: A Jewish Women\u2019s Writing Circle will provide up to 20 Jewish women writers engaged in serious Torah scholarship the support and guidance to complete publishable books of Jewish textual analysis that will be significant contributions to any Jewish library. Word-by-Word will offer writers a three-year stipend and community to develop talent by providing skill-based workshops, professional coaching, peer mentoring, an annual retreat, and opportunities to network with publishers and experienced authors. Sefaria is proud to partner with Dr. Erica Brown on this new initiative, co-led by Sefaria\u2019s Chief Learning Officer, Sara Wolkenfeld."), /*#__PURE__*/external_react_default().createElement("p", null, /*#__PURE__*/external_react_default().createElement("em", null, "This program is generously funded by Micah Philanthropies, Walder Foundation, and the Arev Fund."))))), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "About the Program",
    he: ""
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(ResponsiveNBox, {
    threshold3: 768,
    threshold2: 500,
    gap: "10px",
    stretch: true,
    content: [/*#__PURE__*/external_react_default().createElement(HeaderWithColorAccentBlockAndText, {
      enTitle: "Requirements",
      heTitle: "",
      enText: "<p>Application must include a detailed synopsis of the proposed book (1,000 words), a detailed table of contents, and two published writing samples.\xA0</p> <p>The finished book must be written in English, must be at least 150 pages / 75,000 words.</p> <p>Participants should be located in a time zone that makes it reasonable for them to participate in programming on U.S. time zones.</p>",
      heText: "",
      colorBar: "#AB4E66"
    }), /*#__PURE__*/external_react_default().createElement(HeaderWithColorAccentBlockAndText, {
      enTitle: "Schedule",
      heTitle: "",
      enText: "<p>Applicants must be willing to commit to the following schedule:</p> <p>Annual writing retreat each June. The first retreat is provisionally scheduled for June 18-22, 2023</p> <p>Monthly online meetings of a 1.5 hour duration. Participants are required to attend 8 out of 10 of these meetings each year.</p>",
      heText: "",
      colorBar: "#D4896C"
    }), /*#__PURE__*/external_react_default().createElement(HeaderWithColorAccentBlockAndText, {
      enTitle: "Benefits",
      heTitle: "",
      enText: "<p>Each participant will receive a total stipend of $18,000 ($6,000/year over three years).</p> <p>Workshops with experts from the writing and publishing world.</p> <p>Each participant is entitled to 10-15 hours of coaching per year. Program leaders will work with each author to match her with an appropriate coach. Coaching sessions will be scheduled at the discretion of the participant.</p>",
      heText: "",
      colorBar: "#CCB479"
    })]
  })), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement(CallToActionFooterWithButton, {
    href: "https://drive.google.com/file/d/1DXh0J-y0hHJTZuIdaoa2k3CrJBHeBdxK/view",
    he_href: "",
    enText: "Read the full schedule, requirements, and application information.",
    heText: "",
    enButtonText: "Download",
    heButtonText: "",
    newTab: true
  }), /*#__PURE__*/external_react_default().createElement(GreyBox, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Word-by-Word Leadership",
    he: ""
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Sara Wolkenfeld",
    enText: "Sara Wolkenfeld is the Chief Learning Officer at Sefaria, an online database and interface for Jewish texts. Sara is also a fellow at the David Hartman Center at the Hartman Institute of North America, and is a member of Class Six of the Wexner Field Fellowship. She writes about Jewish texts and Jewish law, and her current projects focus on applying Talmudic ideas to questions of advancements in digital technology.",
    enImg: "/static/img/sara_circle.png",
    enImgAlt: "Sara Wolkenfeld headshot",
    heTitle: "",
    heText: "",
    heImg: "",
    heImgAlt: "",
    borderColor: "#004E5F"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Erica Brown",
    enText: "Dr. Erica Brown is the Vice Provost for Values and Leadership at Yeshiva University and the founding director of its Rabbi Lord Jonathan Sacks-Herenstein Center for Values and Leadership. She previously served as the director of the Mayberg Center for Jewish Education and Leadership and an associate professor of curriculum and pedagogy at The George Washington University. Erica is the author or co-author of 15 books on leadership, the Hebrew Bible and spirituality. Erica has a daily podcast, \u201CTake Your Soul to Work.\u201D Her forthcoming book Kohelet and the Search for Meaning (Maggid) will be available in 2023. Her last book Esther: Power, Fate and Fragility in Exile (Maggid) was a finalist for the National Jewish Book Award.",
    enImg: "/static/img/ericabrown_circle 1.png",
    enImgAlt: "Erica Brown headshot",
    heTitle: "",
    heText: "",
    heImg: "",
    heImgAlt: "",
    borderColor: "#004E5F"
  }), /*#__PURE__*/external_react_default().createElement(H1Block, {
    en: "Get Your questions answered.",
    he: "",
    serif: true
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner"
  }, /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "What\u2019s the application deadline?",
    heTitle: "",
    enText: "<p>The deadline for applications is March 13, 2023. We will not consider applications submitted after this date.</p>",
    heText: "",
    colorBar: "#B8D4D3"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "How many women will be in the cohort?",
    heTitle: "",
    enText: "<p>We plan to welcome 20 women to this cohort.</p>",
    heText: "",
    colorBar: "#B8D4D3"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "How does the stipend work?",
    heTitle: "",
    enText: "<p>Each woman will be awarded $6,000 per year, contingent on meeting the yearly writing requirements (15,000 words in the first year, 25,000 words in years two and three).</p>",
    heText: "",
    colorBar: "#B8D4D3"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "How will the cohort support each other?",
    heTitle: "",
    enText: "<p>Through monthly meetings, a WhatsApp group, and regular check-ins, this cohort will build a supportive community in which women motivate each other, check in on progress, and share ideas. The monthly meetings will provide space to get to know one another, share drafts and get feedback, collaborate around best practices, and champion one another\u2019s projects. The annual retreat will help cement these relationships and expose the cohort to developments in the field and veteran writers.</p>",
    heText: "",
    colorBar: "#B8D4D3"
  }), /*#__PURE__*/external_react_default().createElement(Accordian, {
    enTitle: "I have more questions. How can I contact you?",
    heTitle: "",
    enText: "<p>Please email Rachel Buckman at <a href='mailto:rachel@sefaria.org'>rachel@sefaria.org</a></p>",
    heText: "",
    colorBar: "#B8D4D3"
  })), /*#__PURE__*/external_react_default().createElement(Spacer, null), /*#__PURE__*/external_react_default().createElement(CallToActionFooterWithButton, {
    href: "https://sefaria.typeform.com/to/wJXgn9jL",
    he_href: "",
    enText: "Ready to Apply? Fill out your application by March 13, 2023.",
    heText: "",
    enButtonText: "Apply Now",
    heButtonText: "",
    newTab: true
  }));
};
var PoweredByPage = function PoweredByPage() {
  return /*#__PURE__*/external_react_default().createElement(StaticPage, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Header, {
    enTitle: "Powered by Sefaria",
    enText: "Did you know that Sefaria\u2019s open data and API can be used by anyone to create new technological solutions for learning Torah? You can find it all for free in our GitHub repository!",
    heText: "Did you know that Sefaria\u2019s open data and API can be used by anyone to create new technological solutions for learning Torah? You can find it all for free in our GitHub repository!",
    enActionURL: "https://github.com/Sefaria",
    enActionText: "Create Something New",
    newTab: true
  }), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Open Source Torah",
    he: "Open Source Torah"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "We do our best to ensure that the texts we put in our library come with a Creative Commons license, so the texts can be used and reused, for free. We also make all of our code available for open source use by other developers in any way they\u2019d like. To date, there are more than 70 projects Powered by Sefaria, and nearly 100 sites linked to the Sefaria library through our Linker API.")), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement(GreyBox, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Projects Powered by Sefaria",
    he: "Projects Powered by Sefaria"
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "AlHaTorah",
    enText: "AlHaTorah is a website with a broad range of tools for studying Tanakh, including study guides broken down by parashah, biblical art, and interactive modules. Among the available sources, AlHaTorah makes use of biblical commentaries from Sefaria\u2019s library.",
    enImg: "/static/img/powered-by-landing-page/alhatorah.org_.png",
    enImgAlt: "Screenshot of AlHaTorah",
    borderColor: sefaria_palette.colors.darkteal,
    link: "https://alhatorah.org/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "AllDaf",
    enText: "This app for learning Daf Yomi from the Orthodox Union provides users with personalized feeds that adapt to learners\u2019 interests, supporting study of the Daf in a user-friendly and approachable format. The English text on AllDaf is sourced from Sefaria.",
    enImg: "/static/img/powered-by-landing-page/alldaf.org_.png",
    enImgAlt: "Screenshot of AllDaf",
    borderColor: sefaria_palette.colors.yellow,
    link: "https://alldaf.org/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Hadran",
    enText: "Founded in 2018 by a group of women studying Talmud together, Hadran aims to make the study of Talmud more accessible to Jewish women at all levels of learning. Among the resources they provide are guides to learning Daf Yomi, and these lessons use texts from Sefaria.",
    enImg: "/static/img/powered-by-landing-page/hadran.org.il_daf_yevamot-63_.png",
    enImgAlt: "Screenshot of Hadran",
    borderColor: sefaria_palette.colors.green,
    link: "https://hadran.org.il/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Dicta",
    enText: "Dicta is a non-profit research organization based in Israel that applies cutting-edge machine learning and natural language processing (the ability of a computer program to understand human language as it is spoken and written) to the analysis of Hebrew texts. Sefaria and Dicta often collaborate, sharing texts and splitting the costs of shared projects. Dicta offers a broad range of tools for free use by anyone, including the ability to add nikud (vocalization) to text as you type, intuitive Talmud and Bible search, and more.",
    enImg: "/static/img/powered-by-landing-page/talmudsearch.dicta.org.il_.png",
    enImgAlt: "Screenshot of Dicta",
    borderColor: sefaria_palette.colors.lightblue,
    link: "https://dicta.org.il/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Artscroll Smart Siddur",
    enText: "This app converts the popular ArtSchool Siddur into a fully digital format, including hyperlinks to secondary sources, translations, and commentary, as well as the ability to customize your siddur experience.  When you click on citations to non-ArtScroll books in the siddur's footnotes, they include texts from the Sefaria library.",
    enImg: "/static/img/powered-by-landing-page/artscroll siddur.png",
    enImgAlt: "Screenshot of Artscroll Smart Siddur",
    borderColor: sefaria_palette.colors.red,
    link: "https://www.artscroll.com/Categories/DSD.html"
  }), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Tell us about your projects!",
    he: "Tell us about your projects!"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Have you used Sefaria\u2019s data to build an app, visualization, website, or other digital tool? Tell us about it! We\u2019d love to see your project. You can also reach out to us with your questions about our open source data and API by writing to us at ", /*#__PURE__*/external_react_default().createElement("a", {
    href: "mailto:hello@sefaria.org"
  }, "hello@sefaria.org"), ".")), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    white: true,
    enTitle: "Explore a few more projects",
    heTitle: "Explore a few more projects"
  }, [["HaTanakh.com", "http://www.hatanakh.com/"], ["Koveah", "https://koveah.org/"], ["Parasha Bytes", "https://parashabytes.zemon.name/bytes/"], ["Shnayim Mikra", "http://www.shnayim.com/"], ["Russel Neiss' Micrography", "https://github.com/rneiss/micrography"], ["Sefaria Wordpress Plugin", "https://github.com/JoshMB/sefaria-wp-plugin"], ["Mizmor Shir", "http://mizmor-shir.herokuapp.com/"], ["Capish - Interactive Learning", "https://capish.me/"], ["Sefer Similarity Map", "https://jhostyk.github.io/SeferSimilarityMap/"], ["Sefaria Space: (Topic Museum + Text Mania)", "https://sefaria-space.web.app/"], ["T'Feeling", "https://tfeeling.netlify.app/"], ["The Taryag Mitzvos", "https://thetaryag.com/"], ["Visualizations of Sefaria", "https://guedalia.github.io/testab/test"], ["Gematriaphone", "http://alexboxer.com/gematriaphone/"], ["Yamim Noraim Machzor", "https://play.google.com/store/apps/details?id=com.machzoryamimnoraim"], ["Sefaria Sidebar Extension", "https://github.com/DovOps/SefariaSidebarExtension/"], ["Kindle Seforim", "https://kindleseforim.paritcher.com/"], ["The Jewish Story Through Books", "https://joshcooper417.github.io/"]].map(function (i) {
    return /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: false,
      tall: true,
      newTab: true,
      href: i[1],
      en: i[0]
    });
  })));
};
var PBSC2021LandingPage = function PBSC2021LandingPage() {
  return /*#__PURE__*/external_react_default().createElement(StaticPage, null, /*#__PURE__*/external_react_default().createElement(StaticPages_Header, {
    enTitle: "Powered by Sefaria Contest 2021",
    enText: "Explore the Projects",
    enImg: "/static/img/pbsc-2020-landing-page/codemockup3.png",
    enImgAlt: "",
    heTitle: "\u05EA\u05D7\u05E8\u05D5\u05EA \u05E4\u05D9\u05EA\u05D5\u05D7 \u05D4\u05EA\u05D5\u05DB\u05E0\u05D4 \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 2021",
    heText: "\u05D2\u05DC\u05D5 \u05D0\u05EA \u05D4\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD",
    heImg: "/static/img/pbsc-2020-landing-page/codemockup3.png",
    heImgAlt: ""
  }), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Inviting Innovation",
    he: "\u05D4\u05D6\u05DE\u05E0\u05D4 \u05DC\u05D7\u05D9\u05D3\u05D5\u05E9"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "In an effort to seed the digital future of Jewish texts, the Powered by Sefaria Contest was launched in July 2020 \u2014 inviting the global Sefaria community to make use of our free and open digital dataset of Jewish texts, translations, and interconnections. Over the years, dozens of third parties have created apps, visualizations, and conducted research using our data or API, and we wanted to see what else our community could dream up. The second annual Powered by Sefaria Contest saw tremendous enthusiasm and welcomed many high quality submissions from Sefaria users around the world. ", /*#__PURE__*/external_react_default().createElement("strong", null, "Keep reading to learn more about the two winners and some innovative honorable mentions."))), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\u05DE\u05EA\u05D5\u05DA \u05E8\u05E6\u05D5\u05DF \u05DC\u05D6\u05E8\u05D5\u05E2 \u05D0\u05EA \u05D6\u05E8\u05E2\u05D9 \u05D4\u05E2\u05EA\u05D9\u05D3 \u05D4\u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9 \u05E9\u05DC \u05D0\u05E8\u05D5\u05DF \u05D4\u05E1\u05E4\u05E8\u05D9\u05DD \u05D4\u05D9\u05D4\u05D5\u05D3\u05D9, \u05D4\u05E9\u05E7\u05E0\u05D5 \u05D1\u05E9\u05E0\u05EA 2020 \u05D0\u05EA \u05EA\u05D7\u05E8\u05D5\u05EA \u05E4\u05D9\u05EA\u05D5\u05D7 \u05D4\u05EA\u05D5\u05DB\u05E0\u05D4 \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0, \u05D5\u05D1\u05D4 \u05D4\u05D6\u05DE\u05E0\u05D5 \u05D0\u05EA \u05D4\u05E7\u05D4\u05D9\u05DC\u05D4 \u05D4\u05D2\u05DC\u05D5\u05D1\u05DC\u05D9\u05EA \u05E9\u05DC \u05E1\u05E4\u05E8\u05D9\u05D0 \u05DC\u05D4\u05E9\u05EA\u05DE\u05E9 \u05D1\u05DE\u05E2\u05E8\u05DA \u05D4\u05E0\u05EA\u05D5\u05E0\u05D9\u05DD \u05D4\u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9 \u05D4\u05E4\u05EA\u05D5\u05D7 \u05D5\u05D4\u05D7\u05D5\u05E4\u05E9\u05D9 \u05E9\u05DC \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D9\u05D4\u05D5\u05D3\u05D9\u05D9\u05DD, \u05EA\u05E8\u05D2\u05D5\u05DE\u05D9\u05DD \u05D5\u05E7\u05D9\u05E9\u05D5\u05E8\u05D9\u05DD \u05D1\u05D9\u05DF\u05BE\u05D8\u05E7\u05E1\u05D8\u05D5\u05D0\u05DC\u05D9\u05D9\u05DD. \u05DC\u05D0\u05D5\u05E8\u05DA \u05D4\u05E9\u05E0\u05D9\u05DD \u05D4\u05D9\u05D9\u05E0\u05D5 \u05E2\u05D3\u05D9\u05DD \u05DC\u05E2\u05E9\u05E8\u05D5\u05EA \u05DE\u05E4\u05EA\u05D7\u05D9 \u05D2\u05D5\u05E3 \u05E9\u05DC\u05D9\u05E9\u05D9 \u05E9\u05D4\u05E9\u05EA\u05DE\u05E9\u05D5 \u05D1\u05E0\u05EA\u05D5\u05E0\u05D9\u05DD \u05D0\u05D5 \u05D1\u05BEAPI \u05E9\u05DC\u05E0\u05D5 \u05DC\u05D9\u05E6\u05D9\u05E8\u05EA \u05D9\u05D9\u05E9\u05D5\u05DE\u05D5\u05E0\u05D9\u05DD \u05D5\u05D4\u05D3\u05DE\u05D9\u05D5\u05EA \u05D5\u05DC\u05E6\u05D5\u05E8\u05DB\u05D9 \u05DE\u05D7\u05E7\u05E8, \u05D5\u05E8\u05E6\u05D9\u05E0\u05D5 \u05DC\u05D1\u05D3\u05D5\u05E7 \u05D0\u05D9\u05DC\u05D5 \u05E8\u05E2\u05D9\u05D5\u05E0\u05D5\u05EA \u05E0\u05D5\u05E1\u05E4\u05D9\u05DD \u05D9\u05E9 \u05D1\u05E7\u05D4\u05D9\u05DC\u05D4 \u05E9\u05DC\u05E0\u05D5. \u05D4\u05EA\u05D7\u05E8\u05D5\u05EA \u05D4\u05E4\u05D2\u05D9\u05E9\u05D4 \u05D0\u05D5\u05EA\u05E0\u05D5 \u05E2\u05DD \u05D4\u05EA\u05DC\u05D4\u05D1\u05D5\u05EA \u05D9\u05D5\u05E6\u05D0\u05EA \u05DE\u05DF \u05D4\u05DB\u05DC\u05DC \u05D5\u05E2\u05DD \u05EA\u05D5\u05E6\u05E8\u05D9\u05DD \u05D1\u05D0\u05D9\u05DB\u05D5\u05EA \u05D2\u05D1\u05D5\u05D4\u05D4 \u05E9\u05E7\u05D9\u05D1\u05DC\u05E0\u05D5 \u05DE\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9 \u05E1\u05E4\u05E8\u05D9\u05D0 \u05D1\u05E8\u05D7\u05D1\u05D9 \u05D4\u05E2\u05D5\u05DC\u05DD. \u05D4\u05DE\u05E9\u05D9\u05DB\u05D5 \u05DC\u05E7\u05E8\u05D5\u05D0 \u05DB\u05D3\u05D9 \u05DC\u05DC\u05DE\u05D5\u05D3 \u05E2\u05DC \u05E9\u05E0\u05D9 \u05D4\u05DE\u05E0\u05E6\u05D7\u05D9\u05DD \u05D5\u05E2\u05DC \u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E0\u05D5\u05E1\u05E4\u05D9\u05DD \u05E9\u05D6\u05DB\u05D5 \u05D1\u05E6\u05D9\u05D5\u05DF \u05DC\u05E9\u05D1\u05D7.")), /*#__PURE__*/external_react_default().createElement(Spacer, null)), /*#__PURE__*/external_react_default().createElement(GreyBox, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Grand Prize Winner",
    he: "\u05D6\u05D5\u05DB\u05D4 \u05D4\u05E4\u05E8\u05E1 \u05D4\u05DB\u05DC\u05DC\u05D9"
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Sefaria Chavrusa",
    enText: "Gershon Binder<br/><br/>Sefaria Chavrusa is designed to increase accessibility by introducing a text-to-speech feature on Sefaria. Most text-to-speech options struggle with Hebrew; Sefaria Chavrusa is a solution for people who use screen readers, are unfamiliar with reading Hebrew, or just prefer hearing texts read aloud.  It also allows for customized voices with different accents including Chassidish, Litvish, and Israeli.",
    enImg: "/static/img/pbsc-2021-landing-page/sefariachavrusa.png",
    enImgAlt: "Screenshot of Sefaria Chavrusa",
    heTitle: "\u05D0\u05D5 '\u05D7\u05D1\u05E8\u05D5\u05EA\u05D0 \u05E2\u05DD \u05E1\u05E4\u05E8\u05D9\u05D0'",
    heText: "\u05DE\u05D0\u05EA \u05D2\u05E8\u05E9\u05D5\u05DF \u05D1\u05D9\u05E0\u05D3\u05E8<br><br>'\u05D7\u05D1\u05E8\u05D5\u05EA\u05D0 \u05E2\u05DD \u05E1\u05E4\u05E8\u05D9\u05D0' \u05D4\u05D9\u05D0 \u05DB\u05DC\u05D9 \u05E9\u05E0\u05D5\u05E2\u05D3 \u05DC\u05D4\u05D2\u05D1\u05D9\u05E8 \u05D0\u05EA \u05E0\u05D2\u05D9\u05E9\u05D5\u05EA\u05DD \u05E9\u05DC \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0 \u05E2\u05DC \u05D9\u05D3\u05D9 \u05D4\u05E9\u05DE\u05E2\u05D4 \u05E7\u05D5\u05DC\u05D9\u05EA \u05E9\u05DC \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD. \u05DB\u05D9\u05D5\u05DD \u05DE\u05E8\u05D1\u05D9\u05EA \u05D4\u05DB\u05DC\u05D9\u05DD \u05E9\u05D4\u05D5\u05E4\u05DB\u05D9\u05DD \u05D8\u05E7\u05E1\u05D8 \u05DC\u05E9\u05DE\u05E2 \u05DE\u05EA\u05E7\u05E9\u05D9\u05DD \u05DC\u05E2\u05E9\u05D5\u05EA \u05D6\u05D0\u05EA \u05D1\u05E2\u05D1\u05E8\u05D9\u05EA, \u05D5\u05E2\u05DC \u05DB\u05DF '\u05D7\u05D1\u05E8\u05D5\u05EA\u05D0 \u05E2\u05DD \u05E1\u05E4\u05E8\u05D9\u05D0' \u05EA\u05E1\u05D9\u05D9\u05E2 \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05E9\u05E0\u05E2\u05D6\u05E8\u05D9\u05DD \u05D1\u05E7\u05D5\u05E8\u05D0\u05D9 \u05DE\u05E1\u05DA, \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05E9\u05D0\u05D9\u05E0\u05DD \u05DE\u05E0\u05D5\u05E1\u05D9\u05DD \u05D3\u05D9\u05D9\u05DD \u05D1\u05E7\u05E8\u05D9\u05D0\u05EA \u05E2\u05D1\u05E8\u05D9\u05EA \u05D0\u05D5 \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05E9\u05E4\u05E9\u05D5\u05D8 \u05DE\u05E2\u05D3\u05D9\u05E4\u05D9\u05DD \u05DC\u05E9\u05DE\u05D5\u05E2 \u05D0\u05EA \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D1\u05E7\u05D5\u05DC. \u05D4\u05DE\u05D9\u05D6\u05DD \u05DE\u05D0\u05E4\u05E9\u05E8 \u05E9\u05D9\u05DE\u05D5\u05E9 \u05D1\u05E7\u05D5\u05DC\u05D5\u05EA \u05DE\u05D5\u05EA\u05D0\u05DE\u05D9\u05DD \u05D0\u05D9\u05E9\u05D9\u05EA \u05E2\u05DD \u05DE\u05D1\u05D8\u05D0\u05D9\u05DD \u05DC\u05D1\u05D7\u05D9\u05E8\u05D4, \u05DB\u05D2\u05D5\u05DF \u05D7\u05E1\u05D9\u05D3\u05D9, \u05D0\u05E9\u05DB\u05E0\u05D6\u05D9 \u05D0\u05D5 \u05D9\u05E9\u05E8\u05D0\u05DC\u05D9.",
    heImg: "/static/img/pbsc-2021-landing-page/sefariachavrusa.png",
    heImgAlt: "Screenshot of Sefaria Chavrusa",
    borderColor: sefaria_palette.colors.yellow,
    link: "https://www.youtube.com/watch?v=wnvw6H9BWDw&feature=youtu.be"
  }), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Meet the Grand Prize Winner",
    he: "\u05E4\u05D2\u05E9\u05D5 \u05D0\u05EA \u05D6\u05D5\u05DB\u05D4 \u05D4\u05E4\u05E8\u05E1 \u05D4\u05DB\u05DC\u05DC\u05D9"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "Originally from Huntington, Long Island, Gershon Binder is a senior at Lander College for Men working toward a degree in Computer Science. He is a graphic and web designer working with 3D rendering and Unreal Engine. He currently lives in Queens, New York.")), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\u05D2\u05E8\u05E9\u05D5\u05DF \u05D1\u05D9\u05E0\u05D3\u05E8 \u05DE\u05D4\u05E0\u05D8\u05D9\u05E0\u05D2\u05D8\u05D5\u05DF \u05E9\u05D1\u05DC\u05D5\u05E0\u05D2 \u05D0\u05D9\u05D9\u05DC\u05E0\u05D3 \u05D1\u05DE\u05D3\u05D9\u05E0\u05EA \u05E0\u05D9\u05D5 \u05D9\u05D5\u05E8\u05E7 \u05D4\u05D5\u05D0 \u05E1\u05D8\u05D5\u05D3\u05E0\u05D8 \u05DC\u05DE\u05D3\u05E2\u05D9 \u05D4\u05DE\u05D7\u05E9\u05D1 \u05D1\u05E9\u05E0\u05EA\u05D5 \u05D4\u05D0\u05D7\u05E8\u05D5\u05E0\u05D4 \u05D1\u05E7\u05D5\u05DC\u05D2' \u05DC\u05E0\u05D3\u05E8 \u05DC\u05D2\u05D1\u05E8\u05D9\u05DD. \u05D1\u05D9\u05E0\u05D3\u05E8 \u05D4\u05D5\u05D0 \u05DE\u05E2\u05E6\u05D1 \u05D0\u05EA\u05E8\u05D9\u05DD \u05D5\u05DE\u05E2\u05E6\u05D1 \u05D2\u05E8\u05E4\u05D9 \u05D5\u05E2\u05D5\u05D1\u05D3 \u05E2\u05DD \u05DE\u05D5\u05D3\u05DC\u05D9\u05DD \u05EA\u05DC\u05EA-\u05DE\u05DE\u05D3\u05D9\u05D9\u05DD \u05D5\u05E2\u05DD \u05DE\u05E0\u05D5\u05E2 Unreal. \u05DB\u05D9\u05D5\u05DD \u05DE\u05EA\u05D2\u05D5\u05E8\u05E8 \u05D1\u05E7\u05D5\u05D5\u05D9\u05E0\u05E1 \u05E9\u05D1\u05E0\u05D9\u05D5 \u05D9\u05D5\u05E8\u05E7.")), /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "What Our Team Had to Say",
    he: "\u05DE\u05D4 \u05D9\u05E9 \u05DC\u05E6\u05D5\u05D5\u05EA \u05E9\u05DC\u05E0\u05D5 \u05DC\u05D4\u05D2\u05D9\u05D3 \u05E2\u05DC \u05D6\u05D4"
  }), /*#__PURE__*/external_react_default().createElement(StaticPages_Section, {
    noPadding: true
  }, /*#__PURE__*/external_react_default().createElement(UserQuote, {
    enText: "\u201CI was really impressed with the quality of the speech, even for unvowelized texts.  One of the things that we learned early at Sefaria is that making a text digital opens it up to people with low vision.  But the quality of Rabbinic Hebrew text-to-speech has always been poor, especially in comparison with English. This project gave me hope that we could provide low-sighted users a truly excellent spoken version of all of our texts.\u201D",
    heText: "\u05D4\u05EA\u05E8\u05E9\u05DE\u05EA\u05D9 \u05DE\u05D0\u05D5\u05D3 \u05DE\u05D0\u05D9\u05DB\u05D5\u05EA \u05D4\u05D3\u05D9\u05D1\u05D5\u05E8, \u05D0\u05E4\u05D9\u05DC\u05D5 \u05E2\u05D1\u05D5\u05E8 \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05DC\u05DC\u05D0 \u05E0\u05D9\u05E7\u05D5\u05D3. \u05D0\u05D7\u05D3 \u05D4\u05D3\u05D1\u05E8\u05D9\u05DD \u05E9\u05D2\u05D9\u05DC\u05D9\u05E0\u05D5 \u05D1\u05E9\u05DC\u05D1 \u05DE\u05D5\u05E7\u05D3\u05DD \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0 \u05D4\u05D5\u05D0 \u05E9\u05D4\u05E4\u05D9\u05DB\u05EA \u05D8\u05E7\u05E1\u05D8 \u05DC\u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9 \u05DE\u05D0\u05E4\u05E9\u05E8\u05EA \u05DC\u05DC\u05E7\u05D5\u05D9\u05D9 \u05E8\u05D0\u05D9\u05D4 \u05DC\u05D4\u05D9\u05E0\u05D5\u05EA \u05DE\u05D4\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05E9\u05DC\u05E0\u05D5. \u05D4\u05D1\u05E2\u05D9\u05D4 \u05D4\u05D9\u05D0 \u05E9\u05D4\u05E2\u05D1\u05E8\u05D4 \u05E9\u05DC \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E8\u05D1\u05E0\u05D9\u05D9\u05DD \u05DE\u05D8\u05E7\u05E1\u05D8 \u05DB\u05EA\u05D5\u05D1 \u05DC\u05D3\u05D9\u05D1\u05D5\u05E8 \u05E4\u05D5\u05D2\u05E2\u05EA \u05D1\u05D0\u05D9\u05DB\u05D5\u05EA \u05E9\u05DC \u05D4\u05D8\u05E7\u05E1\u05D8. \u05D4\u05E4\u05E8\u05D5\u05D9\u05E7\u05D8 \u05D4\u05D6\u05D4 \u05E0\u05EA\u05DF \u05DC\u05D9 \u05EA\u05E7\u05D5\u05D5\u05D4 \u05E9\u05E0\u05D5\u05DB\u05DC \u05DC\u05E1\u05E4\u05E7 \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05DC\u05E7\u05D5\u05D9\u05D9 \u05E8\u05D0\u05D9\u05D9\u05D4 \u05D2\u05E8\u05E1\u05D4 \u05DE\u05D3\u05D5\u05D1\u05E8\u05EA \u05DE\u05E2\u05D5\u05DC\u05D4 \u05D1\u05D0\u05DE\u05EA \u05E9\u05DC \u05DB\u05DC \u05D4\u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05E9\u05DC\u05E0\u05D5.",
    enName: "Lev Israel, Chief Data Officer at Sefaria",
    heName: "\u05DC\u05D1 \u05D9\u05E9\u05E8\u05D0\u05DC, \u05DE\u05E0\u05D4\u05DC \u05E0\u05EA\u05D5\u05E0\u05D9\u05DD \u05E8\u05D0\u05E9\u05D9, \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0",
    image: "/static/img/pbsc-2021-landing-page/lev.png"
  }))), /*#__PURE__*/external_react_default().createElement(GreyBox, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Women in Tech Winner",
    he: "\u05D6\u05D5\u05DB\u05EA \u05E4\u05E8\u05E1 \u05E0\u05E9\u05D9\u05DD \u05DE\u05E4\u05EA\u05D7\u05D5\u05EA \u05D8\u05DB\u05E0\u05D5\u05DC\u05D5\u05D2\u05D9\u05D4"
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Torah Chanting Source Sheet Generator",
    enText: "By Valerie Monaco<br><br>The Torah Chanting Source Sheet Generator takes a range of Torah verses and provides a generated Sefaria sheet loaded with features for people learning how to chant, including trope identification and highlighting, trope cantillation tunes, and full verse chanting audio files.",
    enImg: "/static/img/pbsc-2021-landing-page/torahchanting.png",
    enImgAlt: "Screenshot of Torah Chanting Source Sheet Generator",
    heTitle: "\u05DE\u05D7\u05D5\u05DC\u05DC \u05D3\u05E4\u05D9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DC\u05E7\u05E8\u05D9\u05D0\u05D4 \u05D1\u05EA\u05D5\u05E8\u05D4",
    heText: "\u05DE\u05D0\u05EA \u05D5\u05DC\u05E8\u05D9 \u05DE\u05D5\u05E0\u05E7\u05D5<br><br>\"\u05DE\u05D7\u05D5\u05DC\u05DC \u05D3\u05E4\u05D9 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DC\u05E7\u05E8\u05D9\u05D0\u05D4 \u05D1\u05EA\u05D5\u05E8\u05D4\"  \u05D0\u05D5\u05E1\u05E3 \u05DE\u05D2\u05D5\u05D5\u05DF  \u05E4\u05E1\u05D5\u05E7\u05D9\u05DD \u05DE\u05DF \u05D4\u05EA\u05D5\u05E8\u05D4 \u05DB\u05D3\u05D9 \u05DC\u05D7\u05D5\u05DC\u05DC \u05D1\u05E2\u05D6\u05E8\u05EA\u05DD \u05D3\u05E3 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D4\u05DB\u05D5\u05DC\u05DC \u05DB\u05DC\u05D9 \u05E2\u05D6\u05E8 \u05DC\u05E7\u05E8\u05D9\u05D0\u05D4 \u05D1\u05EA\u05D5\u05E8\u05D4 \u2013 \u05D6\u05D9\u05D4\u05D5\u05D9 \u05D5\u05D4\u05D3\u05D2\u05E9\u05D4 \u05E9\u05DC \u05D8\u05E2\u05DE\u05D9 \u05D4\u05DE\u05E7\u05E8\u05D0, \u05D4\u05D3\u05D2\u05DE\u05D5\u05EA \u05E9\u05DE\u05E2 \u05E9\u05DC \u05D8\u05E2\u05DE\u05D9 \u05D4\u05DE\u05E7\u05E8\u05D0 \u05D5\u05DB\u05DF \u05E7\u05D5\u05D1\u05E6\u05D9 \u05E9\u05DE\u05E2 \u05E9\u05DC \u05E4\u05E1\u05D5\u05E7\u05D9\u05DD \u05DE\u05DC\u05D0\u05D9\u05DD.",
    heImg: "/static/img/pbsc-2021-landing-page/torahchanting.png",
    heImgAlt: "Screenshot of Torah Chanting Source Sheet Generator",
    borderColor: sefaria_palette.colors.raspberry,
    link: "https://www.torahchantinghelper.net/"
  }), /*#__PURE__*/external_react_default().createElement(GreyBox, null, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Meet the Women in Tech Winner",
    he: "\u05E4\u05D2\u05E9\u05D5 \u05D0\u05EA \u05D6\u05D5\u05DB\u05EA \u05E4\u05E8\u05E1 \u05E0\u05E9\u05D9\u05DD \u05DE\u05E4\u05EA\u05D7\u05D5\u05EA \u05D8\u05DB\u05E0\u05D5\u05DC\u05D5\u05D2\u05D9\u05D4"
  }), /*#__PURE__*/external_react_default().createElement(EnBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "The Torah Chanting Source Sheet Generator was created by Valerie Monaco, who officially converted to Judaism in 2013. In addition to being members at Rodef Shalom in Pittsburgh, PA, she and her wife are very involved with Congregation Bet Tikvah. Valerie works as a Senior Data Analyst for the City of Pittsburgh and has graduate degrees in psychology and human-computer interaction. As she was studying chanting, Valerie found it was difficult without a shared visual resource, and setting up a useful sheet \u201Cby hand\u201D was time-consuming and had limitations. The Torah Chanting Source Sheet Generator eases the process of creating sheets to make it easier for people to spend their time learning.")), /*#__PURE__*/external_react_default().createElement(HeBlock, {
    padded: true
  }, /*#__PURE__*/external_react_default().createElement("p", null, "\"\u05DE\u05D7\u05D5\u05DC\u05DC \u05D3\u05E4\u05D9 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DC\u05E7\u05E8\u05D9\u05D0\u05D4 \u05D1\u05EA\u05D5\u05E8\u05D4\" \u05E0\u05D5\u05E6\u05E8 \u05E2\u05DC \u05D9\u05D3\u05D9 \u05D5\u05DC\u05E8\u05D9 \u05DE\u05D5\u05E0\u05E7\u05D5, \u05E9\u05D4\u05EA\u05D2\u05D9\u05D9\u05E8\u05D4 \u05D1\u05E9\u05E0\u05EA 2013. \u05E0\u05D5\u05E1\u05E3 \u05E2\u05DC \u05D7\u05D1\u05E8\u05D5\u05EA\u05DF \u05D1\u05E7\u05D4\u05D9\u05DC\u05EA \"\u05E8\u05D5\u05D3\u05E3 \u05E9\u05DC\u05D5\u05DD\" \u05D1\u05E4\u05D9\u05D8\u05E1\u05D1\u05D5\u05E8\u05D2 \u05E9\u05D1\u05E4\u05E0\u05E1\u05D9\u05DC\u05D1\u05E0\u05D9\u05D4, \u05D4\u05D9\u05D0 \u05D5\u05D1\u05EA \u05D6\u05D5\u05D2\u05D4 \u05D4\u05DF \u05D2\u05DD \u05E9\u05D5\u05EA\u05E4\u05D5\u05EA \u05E0\u05DC\u05D4\u05D1\u05D5\u05EA \u05D1\u05E7\u05D4\u05D9\u05DC\u05EA \"\u05D1\u05D9\u05EA \u05EA\u05E7\u05D5\u05D5\u05D4\". \u05D5\u05DC\u05E8\u05D9 \u05D4\u05D9\u05D0 \u05D0\u05E0\u05DC\u05D9\u05E1\u05D8\u05D9\u05EA \u05D3\u05D0\u05D8\u05D4 \u05D1\u05DB\u05D9\u05E8\u05D4 \u05D1\u05E2\u05D9\u05E8\u05D9\u05D9\u05EA \u05E4\u05D9\u05D8\u05E1\u05D1\u05D5\u05E8\u05D2 \u05D5\u05D1\u05E2\u05DC\u05EA \u05EA\u05D5\u05D0\u05E8 \u05E8\u05D0\u05E9\u05D5\u05DF \u05D1\u05E4\u05E1\u05D9\u05DB\u05D5\u05DC\u05D5\u05D2\u05D9\u05D4 \u05D5\u05D1\u05E7\u05E9\u05E8\u05D9 \u05D0\u05D3\u05DD\u05BE\u05DE\u05D7\u05E9\u05D1. \u05DB\u05D0\u05E9\u05E8 \u05DC\u05DE\u05D3\u05D4 \u05DC\u05E7\u05E8\u05D5\u05D0 \u05D1\u05EA\u05D5\u05E8\u05D4 \u05D2\u05D9\u05DC\u05EA\u05D4 \u05D5\u05DC\u05E8\u05D9 \u05E9\u05E7\u05E9\u05D4 \u05DC\u05E2\u05E9\u05D5\u05EA \u05D6\u05D0\u05EA \u05DC\u05DC\u05D0 \u05D3\u05E3 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D5\u05D9\u05D6\u05D5\u05D0\u05DC\u05D9 \u05DE\u05E9\u05D5\u05EA\u05E3, \u05D5\u05E9\u05D4\u05DB\u05E0\u05EA \u05D3\u05E3 \u05E9\u05D9\u05DE\u05D5\u05E9\u05D9 \u05DB\u05D6\u05D4 \u05D1\u05D0\u05D5\u05E4\u05DF \u05D9\u05D3\u05E0\u05D9 \u05EA\u05D9\u05D0\u05E8\u05DA \u05D6\u05DE\u05DF \u05E8\u05D1 \u05D5\u05D9\u05D4\u05D9\u05D5 \u05DC\u05D4 \u05DE\u05D2\u05D1\u05DC\u05D5\u05EA. \"\u05DE\u05D7\u05D5\u05DC\u05DC \u05D3\u05E4\u05D9 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05DC\u05E7\u05E8\u05D9\u05D0\u05D4 \u05D1\u05EA\u05D5\u05E8\u05D4\" \u05DE\u05E7\u05DC \u05E2\u05DC \u05EA\u05D4\u05DC\u05D9\u05DA \u05D9\u05E6\u05D9\u05E8\u05EA \u05D3\u05E4\u05D9 \u05D4\u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05D5\u05DE\u05D0\u05E4\u05E9\u05E8 \u05DC\u05D4\u05E7\u05D3\u05D9\u05E9 \u05D9\u05D5\u05EA\u05E8 \u05D6\u05DE\u05DF \u05DC\u05DC\u05D9\u05DE\u05D5\u05D3.")), /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "What Our Team Had to Say",
    he: "\u05DE\u05D4 \u05D9\u05E9 \u05DC\u05E6\u05D5\u05D5\u05EA \u05E9\u05DC\u05E0\u05D5 \u05DC\u05D4\u05D2\u05D9\u05D3 \u05E2\u05DC \u05D6\u05D4"
  }), /*#__PURE__*/external_react_default().createElement(StaticPages_Section, {
    noPadding: true
  }, /*#__PURE__*/external_react_default().createElement(UserQuote, {
    enText: "\u201COne of the most powerful things about Sefaria is how our tools and resources can be harnessed to provide access and ease of use for folks to grow into their Judaism and Torah learning whenever they're ready. As an adult b'nai mitzvah student Valerie knows this first hand, and her extension of our API and resources to create a tool that simplifies the process of learning Torah reading by automatically creating interactive trope exercises and highlighting trop phrases in a given selection of text is exactly the kind of project that would have been much more difficult to create without our open APIs and data.\u201D",
    heText: "",
    enName: "Russel Neiss, Sr. Product Engineer at Sefaria",
    heName: "\u05E8\u05D6\u05D9\u05D0\u05DC \u05E0\u05D9\u05E1, \u05DE\u05D4\u05E0\u05D3\u05E1 \u05DE\u05D5\u05E6\u05E8 \u05D1\u05DB\u05D9\u05E8, \u05D1\u05E1\u05E4\u05E8\u05D9\u05D0",
    image: "/static/img/pbsc-2021-landing-page/russel.png"
  }))), /*#__PURE__*/external_react_default().createElement(GreyBox, {
    light: true
  }, /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: "Honorable Mentions",
    he: "\u05DE\u05D9\u05D6\u05DE\u05D9\u05DD \u05E9\u05D6\u05DB\u05D5 \u05D1\u05E6\u05D9\u05D5\u05DF \u05DC\u05E9\u05D1\u05D7"
  })), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "he_Toranit",
    enText: "By Zeev Pekar<br><br>Ivrit Toranit is a free spelling dictionary. It includes Hebrew from different eras,  as well as Western and Eastern Aramaic. The dictionary is designed to reduce the \u2018mispellings\u2019 wrongly detected by the modern Hebrew spell checkers when working with Torah literature.",
    enImg: "/static/img/pbsc-2021-landing-page/he_toranit.png",
    enImgAlt: "he_Toranit screenshot",
    heTitle: "\u05E2\u05D1\u05E8\u05D9\u05EA \u05EA\u05D5\u05E8\u05E0\u05D9\u05EA",
    heText: "\u05DE\u05D0\u05EA \u05D6\u05D0\u05D1 \u05E4\u05E7\u05E8<br><br>\"\u05E2\u05D1\u05E8\u05D9\u05EA \u05EA\u05D5\u05E8\u05E0\u05D9\u05EA\" \u05D4\u05D9\u05D0 \u05DE\u05D9\u05DC\u05D5\u05DF \u05D0\u05D9\u05D5\u05EA \u05DC\u05DC\u05D0 \u05EA\u05E9\u05DC\u05D5\u05DD \u05D4\u05DB\u05D5\u05DC\u05DC \u05E2\u05D1\u05E8\u05D9\u05EA \u05DE\u05EA\u05E7\u05D5\u05E4\u05D5\u05EA \u05E9\u05D5\u05E0\u05D5\u05EA \u05D5\u05DB\u05DF \u05D0\u05E8\u05DE\u05D9\u05EA \u05DE\u05D6\u05E8\u05D7\u05D9\u05EA \u05D5\u05DE\u05E2\u05E8\u05D1\u05D9\u05EA. \u05D4\u05DE\u05D9\u05DC\u05D5\u05DF \u05E0\u05D5\u05E2\u05D3 \u05DC\u05D4\u05E4\u05D7\u05D9\u05EA \u05D0\u05EA \"\u05E9\u05D2\u05D9\u05D0\u05D5\u05EA \u05D4\u05DB\u05EA\u05D9\u05D1\" \u05E9\u05D1\u05D5\u05D3\u05E7\u05D9 \u05D4\u05D0\u05D9\u05D5\u05EA, \u05D4\u05E4\u05D5\u05E2\u05DC\u05D9\u05DD \u05E2\u05DC \u05E4\u05D9 \u05D4\u05E2\u05D1\u05E8\u05D9\u05EA \u05D4\u05DE\u05D5\u05D3\u05E8\u05E0\u05D9\u05EA, \u05DE\u05E8\u05D1\u05D9\u05DD \u05DC\u05DE\u05E6\u05D5\u05D0 \u05D5\u05DC\u05D4\u05EA\u05E8\u05D9\u05E2 \u05E2\u05DC\u05D9\u05D4\u05DF \u05D1\u05E2\u05EA \u05E2\u05D1\u05D5\u05D3\u05D4 \u05E2\u05DD \u05E1\u05E4\u05E8\u05D5\u05EA \u05EA\u05D5\u05E8\u05E0\u05D9\u05EA.",
    heImg: "/static/img/pbsc-2021-landing-page/he_toranit.png",
    heImgAlt: "he_Toranit screenshot",
    borderColor: sefaria_palette.colors.green,
    link: "https://gitlab.com/pninim.org/he_TORANIT"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "ShenaimMikra - Text to Speech",
    enText: "By Abraham Saiovici<br><br>ShnaimMikra Text-to-Speech is an application that pulls in the weekly Parsha along with the Rashis and synthesizes the text into speech, providing a way of hearing the Parsha on the go. Handy for long commutes!",
    enImg: "/static/img/pbsc-2021-landing-page/shenaim mikra.png",
    enImgAlt: "ShenaimMikra - Text to Speech",
    heTitle: "\u05E9\u05E0\u05D9\u05D9\u05DE\u05E7\u05E8\u05D0 \u2013 \u05D8\u05E7\u05E1\u05D8 \u05DC\u05E9\u05DE\u05E2",
    heText: "\u05DE\u05D0\u05EA \u05D0\u05D1\u05E8\u05D4\u05DD \u05E1\u05D9\u05D5\u05D1\u05D9\u05E6\u2019\u05D9<br><br>\"\u05E9\u05E0\u05D9\u05D9\u05DE\u05E7\u05E8\u05D0 \u2013 \u05D8\u05E7\u05E1\u05D8 \u05DC\u05E9\u05DE\u05E2\" \u05D4\u05D5\u05D0 \u05D9\u05D9\u05E9\u05D5\u05DE\u05D5\u05DF \u05D4\u05E9\u05D5\u05DC\u05E3 \u05D0\u05EA \u05E4\u05E8\u05E9\u05EA \u05D4\u05E9\u05D1\u05D5\u05E2 \u05E2\u05DD \u05E4\u05E8\u05E9\u05E0\u05D5\u05EA \u05E8\u05E9\"\u05D9 \u05DE\u05E1\u05E0\u05EA\u05D6 \u05D0\u05EA \u05D4\u05D8\u05E7\u05E1\u05D8 \u05DC\u05E9\u05DE\u05E2 \u05D5\u05DE\u05D0\u05E4\u05E9\u05E8 \u05DC\u05E9\u05DE\u05D5\u05E2 \u05D0\u05EA \u05D4\u05E4\u05E8\u05E9\u05D4 \"\u05D1\u05DC\u05DB\u05EA\u05DA \u05D1\u05D3\u05E8\u05DA\". \u05E9\u05D9\u05DE\u05D5\u05E9\u05D9 \u05DE\u05D0\u05D5\u05D3 \u05DC\u05E0\u05E1\u05D9\u05E2\u05D5\u05EA \u05D0\u05E8\u05D5\u05DB\u05D5\u05EA \u05DC\u05E2\u05D1\u05D5\u05D3\u05D4!",
    heImg: "/static/img/pbsc-2021-landing-page/shenaim mikra.png",
    heImgAlt: "\u05E9\u05E0\u05D9\u05D9\u05DE\u05E7\u05E8\u05D0 \u2013 \u05D8\u05E7\u05E1\u05D8 \u05DC\u05E9\u05DE\u05E2",
    borderColor: sefaria_palette.colors.paleblue,
    link: "http://shnaim-mikra-abe.s3-website-us-east-1.amazonaws.com/"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Verse-Based Search",
    enText: "By Oren Mishali<br><br>An innovative tool that helps users search for sources by quotations. On selecting a set of verses, the site generates a list of texts that quote verses from the set. This tool provides an different way to quickly find relevant sources - sorting results by their relationship to a specific verse rather than topic or text",
    enImg: "/static/img/pbsc-2021-landing-page/verse search.png",
    enImgAlt: "Verse-Based Search",
    heTitle: "\u05D7\u05D9\u05E4\u05D5\u05E9 \u05DE\u05D1\u05D5\u05E1\u05E1 \u05E4\u05E1\u05D5\u05E7\u05D9\u05DD",
    heText: "\u05DE\u05D0\u05EA \u05D0\u05D5\u05E8\u05DF \u05DE\u05E9\u05E2\u05DC\u05D9<br><br>\"\u05D7\u05D9\u05E4\u05D5\u05E9 \u05DE\u05D1\u05D5\u05E1\u05E1 \u05E4\u05E1\u05D5\u05E7\u05D9\u05DD\" \u05D4\u05D5\u05D0 \u05DB\u05DC\u05D9 \u05D7\u05D3\u05E9\u05E0\u05D9 \u05E9\u05E2\u05D5\u05D6\u05E8 \u05DC\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD \u05DC\u05D7\u05E4\u05E9 \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E2\u05DC \u05E4\u05D9 \u05E6\u05D9\u05D8\u05D5\u05D8\u05D9\u05DD. \u05D1\u05D0\u05DE\u05E6\u05E2\u05D5\u05EA \u05D1\u05D7\u05D9\u05E8\u05D4 \u05E9\u05DC \u05E1\u05D3\u05E8\u05EA \u05E4\u05E1\u05D5\u05E7\u05D9\u05DD, \u05D4\u05D0\u05EA\u05E8 \u05DE\u05D7\u05D5\u05DC\u05DC \u05E8\u05E9\u05D9\u05DE\u05D4 \u05E9\u05DC \u05D8\u05E7\u05E1\u05D8\u05D9\u05DD \u05D4\u05DE\u05E6\u05D8\u05D8\u05D9\u05DD \u05E4\u05E1\u05D5\u05E7\u05D9\u05DD \u05D1\u05E1\u05D3\u05E8\u05D4. \u05D4\u05DB\u05DC\u05D9 \u05D4\u05D6\u05D4 \u05DE\u05E1\u05E4\u05E7 \u05D3\u05E8\u05DA \u05D7\u05DC\u05D5\u05E4\u05D9\u05EA \u05DC\u05DE\u05E6\u05D9\u05D0\u05EA \u05DE\u05E7\u05D5\u05E8\u05D5\u05EA \u05E8\u05DC\u05D5\u05D5\u05E0\u05D8\u05D9\u05D9\u05DD \u05D1\u05DE\u05D4\u05D9\u05E8\u05D5\u05EA \u2013 \u05D4\u05D5\u05D0 \u05DE\u05DE\u05D9\u05D9\u05DF \u05EA\u05D5\u05E6\u05D0\u05D5\u05EA \u05E2\u05DC \u05E4\u05D9 \u05D4\u05E7\u05E9\u05E8 \u05E9\u05DC\u05D4\u05DD \u05DC\u05E4\u05E1\u05D5\u05E7 \u05DE\u05E1\u05D5\u05D9\u05DD \u05D1\u05DE\u05E7\u05D5\u05DD \u05DC\u05E4\u05D9 \u05D4\u05E7\u05E9\u05E8 \u05E9\u05DC\u05D4\u05DD \u05DC\u05E0\u05D5\u05E9\u05D0 \u05D0\u05D5 \u05DC\u05D8\u05E7\u05E1\u05D8.",
    heImg: "/static/img/pbsc-2021-landing-page/verse search.png",
    heImgAlt: "\u05D7\u05D9\u05E4\u05D5\u05E9 \u05DE\u05D1\u05D5\u05E1\u05E1 \u05E4\u05E1\u05D5\u05E7\u05D9\u05DD",
    borderColor: sefaria_palette.colors.blue,
    link: "http://jbse.cs.technion.ac.il/#/show?uri=section-tanach-1-1"
  }), /*#__PURE__*/external_react_default().createElement(Feature, {
    enTitle: "Stories of the Zohar",
    enText: "By Yair Gardin<br><br>A digital resource of the stories of the sages that appear in the Zohar, allowing easy perusal of the stories. The site includes mapping of all the stories of the Zohar according to parshas and topics, as well as accompanying visuals and links to similar stories.",
    enImg: "/static/img/pbsc-2021-landing-page/zohar stories.png",
    enImgAlt: "Daf Yomi Crossword",
    heTitle: "\u05E1\u05D9\u05E4\u05D5\u05E8\u05D9 \u05D4\u05D6\u05D5\u05D4\u05E8",
    heText: "\u05DE\u05D0\u05EA \u05D9\u05D0\u05D9\u05E8 \u05D2\u05E8\u05D3\u05D9\u05DF<br><br>\u05D6\u05D4\u05D5 \u05DE\u05E9\u05D0\u05D1 \u05D3\u05D9\u05D2\u05D9\u05D8\u05DC\u05D9 \u05DC\u05E1\u05D9\u05E4\u05D5\u05E8\u05D9 \u05D4\u05D7\u05DB\u05DE\u05D9\u05DD \u05E9\u05D1\u05D6\u05D5\u05D4\u05E8, \u05D4\u05DE\u05D0\u05E4\u05E9\u05E8 \u05E7\u05E8\u05D9\u05D0\u05D4 \u05DE\u05E2\u05DE\u05D9\u05E7\u05D4 \u05D1\u05E7\u05DC\u05D5\u05EA. \u05D4\u05D0\u05EA\u05E8 \u05DB\u05D5\u05DC\u05DC \u05DE\u05D9\u05E4\u05D5\u05D9 \u05E9\u05DC \u05DB\u05DC \u05E1\u05D9\u05E4\u05D5\u05E8\u05D9 \u05D4\u05D6\u05D5\u05D4\u05E8 \u05E2\u05DC \u05E4\u05D9 \u05E4\u05E8\u05E9\u05D5\u05EA \u05D5\u05E0\u05D5\u05E9\u05D0\u05D9\u05DD, \u05D5\u05DB\u05DF \u05D4\u05D3\u05DE\u05D9\u05D5\u05EA \u05D4\u05DE\u05DC\u05D5\u05D5\u05EA \u05D0\u05EA \u05D4\u05E1\u05D9\u05E4\u05D5\u05E8\u05D9\u05DD \u05D5\u05E7\u05D9\u05E9\u05D5\u05E8\u05D9\u05DD \u05DC\u05E1\u05D9\u05E4\u05D5\u05E8\u05D9\u05DD \u05D3\u05D5\u05DE\u05D9\u05DD. ",
    heImg: "/static/img/pbsc-2021-landing-page/zohar stories.png",
    heImgAlt: "\u05EA\u05E9\u05D1\u05E5 \u05D3\u05E3 \u05D9\u05D5\u05DE\u05D9",
    borderColor: sefaria_palette.colors.orange,
    link: "https://www.zohar-stories.com/"
  }), /*#__PURE__*/external_react_default().createElement(CallToActionFooterWithButton, {
    href: "https://github.com/Sefaria/Sefaria-Project",
    he_href: "https://github.com/Sefaria/Sefaria-Project",
    enText: "Want to create something of your own?",
    heText: "\u05E8\u05D5\u05E6\u05D4 \u05DC\u05D9\u05E6\u05D5\u05E8 \u05DE\u05E9\u05D4\u05D5 \u05DE\u05E9\u05DC\u05DA?",
    enButtonText: "GitHub",
    heButtonText: "\u05D2\u05D9\u05D8\u05D4\u05D0\u05D1"
  }), /*#__PURE__*/external_react_default().createElement(ButtonRow, {
    white: true,
    enTitle: "Explore the 2021 projects",
    heTitle: "\u05D2\u05DC\u05D5 \u05D0\u05EA \u05DE\u05D9\u05D6\u05DE\u05D9 2021"
  }, [["Talmud Sidebar Extension", "תוסף סרגל הכלים של התלמוד", "https://chrome.google.com/webstore/detail/talmud-sidebar-extension/dmpiiciebnbekblfbcdeogjkbbmeeimi"], ["Mizmor Shir", "מזמור שיר", "http://mizmor-shir.herokuapp.com/"], ["Shulkhan", "שולחן", "http://josephtepperman.com/shulkhan.htm"], ["Goof - Body parts in Tefillah", "גוף: איברי הגוף בתפילה", "https://goof.surge.sh/"], ["Capish - Interactive Learning", "קאפיש: לימוד אינטראקטיבי", "https://capish.me/"], ["Daf Yomi Crossword", "תשבץ דף יומי", "http://ee.cooper.edu/~goldfarb/daf"], ["Sefer Similarity Map", "ספר– מפת דמיון בין טקסטים", "https://jhostyk.github.io/SeferSimilarityMap"], ["Custom Mikraot Gedolot", "מקראות גדולות בהתאמה אישית", "http://ec2-3-129-165-55.us-east-2.compute.amazonaws.com:3002/"], ["Sefaria Space: (Topic Museum + Text Mania)", "מרחב ספריא (מוזיאון נושאי + טָרֶפֶת טקסט)", "https://sefaria-space.web.app/"], ["The Rabbinic Citation Network", "רשת ציטוטים של חכמי התלמוד", "http://www.rabbiniccitations.jewishstudies.digitalscholarship.brown.edu/blog/"], ["T'Feeling", "פילינג", "https://tfeeling.netlify.app"], ["CiteMakor", "המצ'טט", "https://twitter.com/CiteMakor"], ["Gifaria", "גיפַריא", "https://tiger-tang.shinyapps.io/gifaria"], ["The Taryag Mitzvos", "תרי\"ג מצוות", "https://thetaryag.com/"], ["3D Tanach Family Tree", "אילן יוחסין תנ\"כי תלת ממדי", "http://www.basehasefer.com"], ["Gematriaphone", "גימטריה קולית", "http://alexboxer.com/gematriaphone"], ["sefaria-connections", "קשרי ספריא", "https://charlesloder.github.io/sefaria-connections"], ["SefariAcrostic", "ספריאקרוסטיכון", "https://20gordone.github.io/SefariaContest"]].map(function (i) {
    return /*#__PURE__*/external_react_default().createElement(SimpleButton, {
      white: true,
      rounded: false,
      tall: true,
      newTab: true,
      href: i[2],
      he_href: i[2],
      he: i[1],
      en: i[0]
    });
  })));
};
var Accordian = function Accordian(_ref) {
  var enTitle = _ref.enTitle,
    heTitle = _ref.heTitle,
    enText = _ref.enText,
    heText = _ref.heText,
    colorBar = _ref.colorBar;
  return /*#__PURE__*/external_react_default().createElement("details", {
    style: {
      borderColor: colorBar
    }
  }, /*#__PURE__*/external_react_default().createElement("summary", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, enTitle), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, heTitle)), /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-en",
    dangerouslySetInnerHTML: {
      __html: enText
    }
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-he",
    dangerouslySetInnerHTML: {
      __html: heText
    }
  }));
};
var StaticPage = function StaticPage(_ref2) {
  var children = _ref2.children,
    _ref2$optionalClass = _ref2.optionalClass,
    optionalClass = _ref2$optionalClass === void 0 ? "" : _ref2$optionalClass;
  var staticPageClass = "staticPage";
  if (optionalClass !== "") {
    staticPageClass += " " + optionalClass;
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: staticPageClass
  }, children);
};
var Spacer = function Spacer(_ref3) {
  var height = _ref3.height;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageSpacer",
    style: {
      height: height || 60
    }
  });
};
var HeBlock = function HeBlock(_ref4) {
  var children = _ref4.children,
    padded = _ref4.padded;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-he" + (padded ? " staticPageBlockInner" : "")
  }, children);
};
var EnBlock = function EnBlock(_ref5) {
  var children = _ref5.children,
    padded = _ref5.padded;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-en" + (padded ? " staticPageBlockInner" : "")
  }, children);
};
var GreyBox = function GreyBox(_ref6) {
  var children = _ref6.children,
    light = _ref6.light;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: light ? "lightgreyBackground" : "greyBackground"
  }, children);
};
var H1Block = function H1Block(_ref7) {
  var en = _ref7.en,
    he = _ref7.he;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner"
  }, /*#__PURE__*/external_react_default().createElement("h1", {
    className: "staticPageH1 serif"
  }, /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    en: en,
    he: he
  })));
};
var H2Block = function H2Block(_ref8) {
  var en = _ref8.en,
    he = _ref8.he,
    classes = _ref8.classes,
    serif = _ref8.serif;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner"
  }, /*#__PURE__*/external_react_default().createElement("h2", {
    className: serif ? "staticPageH2 serif" : "staticPageH2"
  }, /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    en: en,
    he: he
  })));
};
var HeaderWithColorAccentBlockAndText = function HeaderWithColorAccentBlockAndText(_ref9) {
  var enTitle = _ref9.enTitle,
    heTitle = _ref9.heTitle,
    enText = _ref9.enText,
    heText = _ref9.heText,
    colorBar = _ref9.colorBar;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "HeaderWithColorAccentBlockAndText"
  }, /*#__PURE__*/external_react_default().createElement("h2", {
    className: "serif"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, enTitle), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, heTitle)), /*#__PURE__*/external_react_default().createElement("hr", {
    style: {
      borderColor: colorBar
    }
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-en",
    dangerouslySetInnerHTML: {
      __html: enText
    }
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-he",
    dangerouslySetInnerHTML: {
      __html: heText
    }
  }));
};
var SubscribeButton = function SubscribeButton(_ref10) {
  var enAction = _ref10.enAction,
    heAction = _ref10.heAction,
    heLists = _ref10.heLists,
    enLists = _ref10.enLists,
    redirectURL = _ref10.redirectURL;
  var email = Sefaria._email;
  var _useState = (0,external_react_.useState)(""),
    _useState2 = StaticPages_slicedToArray(_useState, 2),
    message = _useState2[0],
    setMessage = _useState2[1];
  var _useState3 = (0,external_react_.useState)(""),
    _useState4 = StaticPages_slicedToArray(_useState3, 2),
    messageStyle = _useState4[0],
    setMessageStyle = _useState4[1];
  var heActionText = (0,external_react_.useRef)(heAction);
  var enActionText = (0,external_react_.useRef)(enAction);
  if (email.length === 0) {
    enActionText.current = enAction;
    heActionText.current = heAction;
  }
  var handleClick = function handleClick() {
    if (Sefaria.util.isValidEmailAddress(email)) {
      setMessage("Subscribing...");
      setMessageStyle("italics");
      var lists = Sefaria.interfaceLang == "hebrew" ? heLists : enLists;
      var request = new Request("/api/subscribe/" + email, {
        headers: {
          'X-CSRFToken': external_js_cookie_default().get('csrftoken')
        }
      });
      fetch(request, {
        method: 'POST',
        mode: 'same-origin',
        credentials: 'same-origin',
        body: {
          "lists": lists
        }
      }).then(function (response) {
        if (!response.ok) {
          response.text().then(function (resp_text) {
            setMessage(resp_text);
            setMessageStyle("");
          });
        } else {
          response.json().then(function (resp_json) {
            if (resp_json.hasOwnProperty("status") && resp_json["status"] == "ok") {
              setMessage("Subscribed! Welcome to our list.");
              setMessageStyle("");
            } else if (resp_json.hasOwnProperty("error")) {
              setMessage(resp_json["error"]);
              setMessageStyle("");
            }
          });
        }
      })["catch"](function (error) {
        setMessage(error.message);
      });
    }
  };
  return /*#__PURE__*/external_react_default().createElement("span", null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "simpleButtonWrapper signUpEducators"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    onClick: handleClick,
    className: external_classnames_default()({
      button: 1,
      flexContainer: 1,
      "int-en": 1,
      white: true,
      tall: false,
      rounded: true
    })
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, email.length === 0 ? /*#__PURE__*/external_react_default().createElement("a", {
    href: redirectURL
  }, enActionText.current) : enActionText.current, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/circled-arrow-right.svg"
  }))), /*#__PURE__*/external_react_default().createElement("div", {
    onClick: handleClick,
    className: external_classnames_default()({
      button: 1,
      flexContainer: 1,
      "int-he": 1,
      white: true,
      tall: false,
      rounded: true
    })
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, email.length === 0 ? /*#__PURE__*/external_react_default().createElement("a", {
    href: redirectURL
  }, heActionText.current) : heActionText.current, /*#__PURE__*/external_react_default().createElement("img", {
    src: "/static/img/circled-arrow-left.svg"
  })))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "signUpEducatorsMessage ".concat(messageStyle)
  }, message, /*#__PURE__*/external_react_default().createElement("br", null)));
};
var HeaderForEducatorsPage = function HeaderForEducatorsPage() {
  var enTitle = "Teach with Sefaria";
  var enText = "Discover the power of digital texts and tools in your classroom. Explore Sefaria’s many resources to enrich teaching and learning in your community.";
  var heText = "גלו כיצד להעשיר את הלמידה וההוראה באמצעות מאגר מקורות דיגיטלי. באתר אפשרויות רבות ללומדים:  תוכלו למצוא מקורות, להיפגש עם מגוון של חומרי הוראה ולחזק את התלמידים שלכם כלומדים עצמאיים.";
  var heTitle = "מלמדים עם ספריא";
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageHeader educators"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageHeaderTextBox educators"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, enTitle), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, heTitle)), /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "staticPageHeaderText",
    he: heText,
    en: enText
  }), /*#__PURE__*/external_react_default().createElement(SubscribeButton, {
    enAction: "Sign up to get updates",
    heAction: "הירשמו לקבלת הניוזלטר",
    heLists: "Announcements_General_Hebrew|Announcements_Edu_Hebrew",
    enLists: "Announcements_General|Announcements_Edu",
    redirectURL: "/register?educator=true&next=/educators"
  }))));
};
var HeaderForRabbisPage = function HeaderForRabbisPage() {
  var enTitle = "Sefaria for Rabbis";
  var enText = "Discover the power of digital texts and tools to fuel your rabbinate. Explore Sefaria’s many resources to enrich learning and teaching in your community.";
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageHeader rabbis"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageHeaderTextBox educators"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, enTitle)), /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "staticPageHeaderText",
    en: enText
  }), /*#__PURE__*/external_react_default().createElement(SubscribeButton, {
    enAction: "Sign up for Rabbi Newsletter",
    heAction: "הירשמו לקבלת הניוזלטר",
    heLists: "ANNOUNCEMENTS_General_Hebrew|ANNOUNCEMENTS_Rabbi_Hebrew",
    enLists: "ANNOUNCEMENTS_General|ANNOUNCEMENTS_Rabbi",
    redirectURL: "/register?next=/rabbis"
  }))));
};
var HeaderForDonatePage = function HeaderForDonatePage() {
  var enTitle = "Your gift. Your impact.";
  var enText = "When you give to Sefaria, you’re powering a living library of more than 3,000 years of Jewish texts. Donate today and support the future of Jewish learning, innovation, and conversation.";
  var heText = "גלו כיצד להעשיר את הלמידה וההוראה באמצעות מאגר מקורות דיגיטלי. באתר אפשרויות רבות ללומדים:  תוכלו למצוא מקורות, להיפגש עם מגוון של חומרי הוראה ולחזק את התלמידים שלכם כלומדים עצמאיים.";
  var heTitle = "מלמדים עם ספריא";
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageHeader donate"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageHeaderTextBox donate"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, enTitle), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, heTitle)), /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "staticPageHeaderText",
    he: heText,
    en: enText
  }))));
};
var StaticPages_Header = function Header(_ref11) {
  var enTitle = _ref11.enTitle,
    heTitle = _ref11.heTitle,
    enText = _ref11.enText,
    heText = _ref11.heText,
    enImg = _ref11.enImg,
    heImg = _ref11.heImg,
    enImgAlt = _ref11.enImgAlt,
    heImgAlt = _ref11.heImgAlt,
    enActionURL = _ref11.enActionURL,
    enActionText = _ref11.enActionText,
    heActionURL = _ref11.heActionURL,
    heActionText = _ref11.heActionText,
    newTab = _ref11.newTab;
  var staticPageHeaderClass = "staticPageHeader";
  var imgComponent = "";
  if (enImg === "" && heImg === "") {
    staticPageHeaderClass += " textOnly";
  } else {
    imgComponent = /*#__PURE__*/external_react_default().createElement("span", null, /*#__PURE__*/external_react_default().createElement("img", {
      className: "int-en",
      src: enImg,
      alt: enImgAlt
    }), /*#__PURE__*/external_react_default().createElement("img", {
      className: "int-he",
      src: heImg,
      alt: heImgAlt
    }));
  }
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: staticPageHeaderClass
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageHeaderTextBox"
  }, /*#__PURE__*/external_react_default().createElement("h1", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, enTitle), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, heTitle)), /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "staticPageHeaderText",
    he: heText,
    en: enText
  }), enActionURL ? /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    en: enActionText,
    he: heActionText,
    href: enActionURL,
    he_href: heActionURL,
    white: true,
    newTab: newTab
  }) : null), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageHeaderImg"
  }, imgComponent)));
};
var StaticPages_Section = function Section(_ref12) {
  var children = _ref12.children,
    noPadding = _ref12.noPadding;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: external_classnames_default()({
      "staticPageBlockInner": 1,
      "staticPageSection": !noPadding
    })
  }, children);
};
var UserQuote = function UserQuote(_ref13) {
  var enText = _ref13.enText,
    heText = _ref13.heText,
    image = _ref13.image,
    enName = _ref13.enName,
    heName = _ref13.heName;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageUserQuote"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageUserQuoteContent"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-en",
    dangerouslySetInnerHTML: {
      __html: enText
    }
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-he",
    dangerouslySetInnerHTML: {
      __html: heText
    }
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageUserQuoteNameBox"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    src: image
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageUserQuoteName"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en",
    dangerouslySetInnerHTML: {
      __html: enName
    }
  }), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he",
    dangerouslySetInnerHTML: {
      __html: heName
    }
  }))));
};
var StaticPages_Sheet = function Sheet(_ref14) {
  var title = _ref14.title,
    link = _ref14.link,
    author = _ref14.author,
    image = _ref14.image;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageSheetItem"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: link
  }, title), /*#__PURE__*/external_react_default().createElement("img", {
    src: image
  }), /*#__PURE__*/external_react_default().createElement("span", {
    className: "staticPageSheetAuthor"
  }, author));
};
var CallToActionFooterWithButton = function CallToActionFooterWithButton(_ref15) {
  var href = _ref15.href,
    he_href = _ref15.he_href,
    enText = _ref15.enText,
    heText = _ref15.heText,
    enButtonText = _ref15.enButtonText,
    heButtonText = _ref15.heButtonText,
    _ref15$newTab = _ref15.newTab,
    newTab = _ref15$newTab === void 0 ? false : _ref15$newTab;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageCallToActionFooter"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "callToActionText",
    en: enText,
    he: heText
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    href: href,
    he_href: he_href,
    en: enButtonText,
    he: heButtonText,
    white: true,
    newTab: newTab
  })));
};
var CallToActionFooter = function CallToActionFooter(_ref16) {
  var enText = _ref16.enText,
    heText = _ref16.heText;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageCallToActionFooter"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "callToActionText noButton",
    en: enText,
    he: heText
  })));
};
var CallToActionFooterWithNewsletter = function CallToActionFooterWithNewsletter(_ref17) {
  var enText = _ref17.enText,
    heText = _ref17.heText,
    includeEducatorOption = _ref17.includeEducatorOption;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageCallToActionFooter"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "callToActionText",
    en: enText,
    he: heText
  }), /*#__PURE__*/external_react_default().createElement(NewsletterSignUpForm, {
    contextName: "Distance Learning Static Page",
    includeEducatorOption: includeEducatorOption
  })));
};
var About = function About(_ref18) {
  var enTitle = _ref18.enTitle,
    heTitle = _ref18.heTitle,
    enText = _ref18.enText,
    heText = _ref18.heText,
    backgroundColor = _ref18.backgroundColor;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageAbout" + (backgroundColor == "grey" ? " greyBackground" : "")
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner"
  }, /*#__PURE__*/external_react_default().createElement("h2", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, enTitle), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, heTitle)), /*#__PURE__*/external_react_default().createElement(SimpleInterfaceBlock, {
    classes: "staticPageAboutText",
    he: heText,
    en: enText
  })));
};
var ImageWithText = function ImageWithText(_ref19) {
  var enText = _ref19.enText,
    heText = _ref19.heText,
    enImg = _ref19.enImg,
    heImg = _ref19.heImg,
    enImgAlt = _ref19.enImgAlt,
    heImgAlt = _ref19.heImgAlt;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "feature blockVerticalPadding",
    style: {
      backgroundColor: "inherit"
    }
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "featureText",
    style: {
      borderTop: 0
    }
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-en",
    dangerouslySetInnerHTML: {
      __html: enText
    }
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-he",
    dangerouslySetInnerHTML: {
      __html: heText
    }
  })), /*#__PURE__*/external_react_default().createElement("div", {
    className: "featureImage"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    className: "int-en",
    src: enImg,
    alt: enImgAlt
  }), /*#__PURE__*/external_react_default().createElement("img", {
    className: "int-he",
    src: heImg,
    alt: heImgAlt
  }))));
};
var FeatureBox = function FeatureBox(_ref20) {
  var enTitle = _ref20.enTitle,
    heTitle = _ref20.heTitle,
    enText = _ref20.enText,
    heText = _ref20.heText,
    enButtonText = _ref20.enButtonText,
    heButtonText = _ref20.heButtonText,
    enButtonUrl = _ref20.enButtonUrl,
    heButtonUrl = _ref20.heButtonUrl,
    borderColor = _ref20.borderColor;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "featureBox",
    style: {
      borderColor: borderColor
    }
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "featureHeader"
  }, /*#__PURE__*/external_react_default().createElement("h3", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, enTitle), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, heTitle))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-en",
    dangerouslySetInnerHTML: {
      __html: enText
    }
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-he",
    dangerouslySetInnerHTML: {
      __html: heText
    }
  }), /*#__PURE__*/external_react_default().createElement(SimpleButton, {
    white: false,
    rounded: true,
    tall: false,
    href: enButtonUrl,
    he_href: heButtonUrl,
    he: heButtonText,
    en: enButtonText
  }));
};
var Feature = function Feature(_ref21) {
  var enTitle = _ref21.enTitle,
    heTitle = _ref21.heTitle,
    enText = _ref21.enText,
    heText = _ref21.heText,
    enImg = _ref21.enImg,
    heImg = _ref21.heImg,
    enImgAlt = _ref21.enImgAlt,
    heImgAlt = _ref21.heImgAlt,
    borderColor = _ref21.borderColor,
    link = _ref21.link;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "feature"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "featureText",
    style: {
      borderColor: borderColor
    }
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "featureHeader"
  }, /*#__PURE__*/external_react_default().createElement(ConditionalLink, {
    link: link
  }, /*#__PURE__*/external_react_default().createElement("h3", null, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, enTitle), /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, heTitle)))), /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-en",
    dangerouslySetInnerHTML: {
      __html: enText
    }
  }), /*#__PURE__*/external_react_default().createElement("div", {
    className: "int-he",
    dangerouslySetInnerHTML: {
      __html: heText
    }
  })), /*#__PURE__*/external_react_default().createElement(ConditionalLink, {
    link: link
  }, /*#__PURE__*/external_react_default().createElement("div", {
    className: "featureImage"
  }, /*#__PURE__*/external_react_default().createElement("img", {
    className: "int-en",
    src: enImg,
    alt: enImgAlt
  }), /*#__PURE__*/external_react_default().createElement("img", {
    className: "int-he",
    src: heImg,
    alt: heImgAlt
  })))));
};
var ButtonRow = function ButtonRow(_ref22) {
  var children = _ref22.children,
    light = _ref22.light,
    white = _ref22.white,
    enTitle = _ref22.enTitle,
    heTitle = _ref22.heTitle;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: external_classnames_default()({
      "buttonRow": 1,
      "blockVerticalPadding": 1,
      "lightgreyBackground": light,
      "greyBackground": !white && !light
    })
  }, enTitle && heTitle ? /*#__PURE__*/external_react_default().createElement(H2Block, {
    en: enTitle,
    he: heTitle
  }) : null, /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner flexContainer"
  }, children));
};
var SimpleButton = function SimpleButton(_ref23) {
  var href = _ref23.href,
    he_href = _ref23.he_href,
    he = _ref23.he,
    en = _ref23.en,
    white = _ref23.white,
    _ref23$rounded = _ref23.rounded,
    rounded = _ref23$rounded === void 0 ? true : _ref23$rounded,
    _ref23$tall = _ref23.tall,
    tall = _ref23$tall === void 0 ? false : _ref23$tall,
    _ref23$newTab = _ref23.newTab,
    newTab = _ref23$newTab === void 0 ? false : _ref23$newTab;
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "simpleButtonWrapper"
  }, /*#__PURE__*/external_react_default().createElement("a", {
    href: href,
    className: external_classnames_default()({
      button: 1,
      flexContainer: 1,
      "int-en": 1,
      white: white,
      tall: tall,
      rounded: rounded
    }),
    target: newTab ? "_blank" : "_self"
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-en"
  }, en)), /*#__PURE__*/external_react_default().createElement("a", {
    href: he_href || href,
    className: external_classnames_default()({
      button: 1,
      flexContainer: 1,
      "int-he": 1,
      white: white,
      tall: tall,
      rounded: rounded
    })
  }, /*#__PURE__*/external_react_default().createElement("span", {
    className: "int-he"
  }, he)));
};
var ParashaSponsorship = function ParashaSponsorship(_ref24) {
  var title = _ref24.title,
    sponsorNames = _ref24.sponsorNames,
    message = _ref24.message,
    link = _ref24.link;
  if (!sponsorNames) {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "parashaSponsorship"
    }, /*#__PURE__*/external_react_default().createElement("div", {
      className: "parashaTitle"
    }, title), /*#__PURE__*/external_react_default().createElement("div", {
      className: "parashaSponsorNames"
    }, /*#__PURE__*/external_react_default().createElement("a", {
      target: "_blank",
      href: "mailto:hannah@sefaria.org?subject=Ramban Sponsorship"
    }, /*#__PURE__*/external_react_default().createElement("b", null, /*#__PURE__*/external_react_default().createElement("i", null, "Available for Sponsorship")))));
  } else {
    return /*#__PURE__*/external_react_default().createElement("div", {
      className: "parashaSponsorship"
    }, /*#__PURE__*/external_react_default().createElement("a", {
      href: link,
      className: "parashaTitle"
    }, title), /*#__PURE__*/external_react_default().createElement("div", {
      className: "parashaSponsorNames"
    }, sponsorNames), message ? /*#__PURE__*/external_react_default().createElement("div", {
      className: "parashaMessage"
    }, message) : null);
  }
};
var StaticHR = function StaticHR() {
  return /*#__PURE__*/external_react_default().createElement("div", {
    className: "staticPageBlockInner"
  }, /*#__PURE__*/external_react_default().createElement("hr", null));
};
var ConditionalLink = function ConditionalLink(_ref25) {
  var link = _ref25.link,
    children = _ref25.children;
  return link ? /*#__PURE__*/external_react_default().createElement("a", {
    href: link,
    target: "_blank"
  }, children) : children;
};

;// CONCATENATED MODULE: external "socket.io-client"
const external_socket_io_client_namespaceObject = require("socket.io-client");
;// CONCATENATED MODULE: ../static/js/ReaderApp.jsx
function ReaderApp_typeof(obj) { "@babel/helpers - typeof"; return ReaderApp_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, ReaderApp_typeof(obj); }
function ReaderApp_slicedToArray(arr, i) { return ReaderApp_arrayWithHoles(arr) || ReaderApp_iterableToArrayLimit(arr, i) || ReaderApp_unsupportedIterableToArray(arr, i) || ReaderApp_nonIterableRest(); }
function ReaderApp_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function ReaderApp_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function ReaderApp_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function ReaderApp_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function ReaderApp_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ReaderApp_ownKeys(Object(source), !0).forEach(function (key) { ReaderApp_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ReaderApp_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function ReaderApp_defineProperty(obj, key, value) { key = ReaderApp_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function ReaderApp_toConsumableArray(arr) { return ReaderApp_arrayWithoutHoles(arr) || ReaderApp_iterableToArray(arr) || ReaderApp_unsupportedIterableToArray(arr) || ReaderApp_nonIterableSpread(); }
function ReaderApp_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function ReaderApp_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function ReaderApp_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return ReaderApp_arrayLikeToArray(arr); }
function ReaderApp_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = ReaderApp_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function ReaderApp_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return ReaderApp_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return ReaderApp_arrayLikeToArray(o, minLen); }
function ReaderApp_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function ReaderApp_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function ReaderApp_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, ReaderApp_toPropertyKey(descriptor.key), descriptor); } }
function ReaderApp_createClass(Constructor, protoProps, staticProps) { if (protoProps) ReaderApp_defineProperties(Constructor.prototype, protoProps); if (staticProps) ReaderApp_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function ReaderApp_toPropertyKey(arg) { var key = ReaderApp_toPrimitive(arg, "string"); return ReaderApp_typeof(key) === "symbol" ? key : String(key); }
function ReaderApp_toPrimitive(input, hint) { if (ReaderApp_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (ReaderApp_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function ReaderApp_inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) ReaderApp_setPrototypeOf(subClass, superClass); }
function ReaderApp_setPrototypeOf(o, p) { ReaderApp_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return ReaderApp_setPrototypeOf(o, p); }
function ReaderApp_createSuper(Derived) { var hasNativeReflectConstruct = ReaderApp_isNativeReflectConstruct(); return function _createSuperInternal() { var Super = ReaderApp_getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = ReaderApp_getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return ReaderApp_possibleConstructorReturn(this, result); }; }
function ReaderApp_possibleConstructorReturn(self, call) { if (call && (ReaderApp_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return ReaderApp_assertThisInitialized(self); }
function ReaderApp_assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function ReaderApp_isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function ReaderApp_getPrototypeOf(o) { ReaderApp_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return ReaderApp_getPrototypeOf(o); }


















var ReaderApp = /*#__PURE__*/function (_Component) {
  ReaderApp_inherits(ReaderApp, _Component);
  var _super = ReaderApp_createSuper(ReaderApp);
  function ReaderApp(props) {
    var _this;
    ReaderApp_classCallCheck(this, ReaderApp);
    _this = _super.call(this, props);
    // TODO clean up generation of initial panels objects.
    // Currently these get generated in reader/views.py then regenerated again in ReaderApp.
    _this.MIN_PANEL_WIDTH = 360.0;
    var panels = [];
    if (props.initialMenu) {
      // If a menu is specified in `initialMenu`, make a panel for it
      panels[0] = {
        mode: "Menu",
        menuOpen: props.initialMenu,
        searchQuery: props.initialQuery,
        searchTab: props.initialSearchTab,
        tab: props.initialTab,
        textSearchState: new sefaria_searchState({
          type: 'text',
          appliedFilters: props.initialTextSearchFilters,
          field: props.initialTextSearchField,
          appliedFilterAggTypes: props.initialTextSearchFilterAggTypes,
          sortType: props.initialTextSearchSortType
        }),
        sheetSearchState: new sefaria_searchState({
          type: 'sheet',
          appliedFilters: props.initialSheetSearchFilters,
          appliedFilterAggTypes: props.initialSheetSearchFilterAggTypes,
          sortType: props.initialSheetSearchSortType
        }),
        navigationCategories: props.initialNavigationCategories,
        navigationTopicCategory: props.initialNavigationTopicCategory,
        navigationTopic: props.initialTopic,
        navigationTopicTitle: props.initialNavigationTopicTitle,
        navigationTopicLetter: props.initialNavigationTopicLetter,
        topicTitle: props.initialTopicTitle,
        topicTestVersion: props.topicTestVersion,
        profile: props.initialProfile,
        collectionName: props.initialCollectionName,
        collectionSlug: props.initialCollectionSlug,
        collectionTag: props.initialCollectionTag,
        translationsSlug: props.initialTranslationsSlug
      };
    }
    var defaultPanelSettings = _this.getDefaultPanelSettings();
    var initialPanels = props.initialPanels || [];
    panels = panels.concat(initialPanels.map(_this.clonePanel));
    panels = panels.map(function (panel) {
      if (!panel.hasOwnProperty("settings") && !!panel.currVersions) {
        // If a panel doesn't have its own settings, but it does have a text version set
        // make sure the settings show the language of the version set.
        if (panel.currVersions.he && panel.currVersions.en) {
          panel.settings = {
            language: "bilingual"
          };
        } else if (panel.currVersions.he) {
          panel.settings = {
            language: "hebrew"
          };
        } else if (panel.currVersions.en) {
          panel.settings = {
            language: "english"
          };
        }
      }
      panel.settings = external_extend_default()(sefaria.util.clone(defaultPanelSettings), panel.settings || {});
      if (panel.mode.endsWith("AndConnections")) {
        panel.highlightedRefs = panel.refs;
      }
      if (panel.menuOpen === "book toc") {
        // TODO figure out how to delete this
        panel.tab = props.initialTab; // why is book toc initial menu false?
      }

      return panel;
    }).map(function (panel) {
      return _this.makePanelState(panel);
    });
    var defaultVersions = sefaria.util.clone(props.initialDefaultVersions) || {};
    var layoutOrientation = props.interfaceLang == "hebrew" ? "rtl" : "ltr";
    _this.state = {
      panels: panels,
      headerMode: props.headerMode,
      defaultVersions: defaultVersions,
      defaultPanelSettings: sefaria.util.clone(defaultPanelSettings),
      layoutOrientation: layoutOrientation,
      path: props.initialPath,
      panelCap: props.initialPanelCap,
      initialAnalyticsTracked: false,
      showSignUpModal: false,
      translationLanguagePreference: props.translationLanguagePreference
    };
    return _this;
  }
  ReaderApp_createClass(ReaderApp, [{
    key: "makePanelState",
    value: function makePanelState(state) {
      // Return a full representation of a single panel's state, given a partial representation in `state`
      var panel = {
        mode: state.mode,
        // "Text", "TextAndConnections", "Connections", "Sheet", "SheetAndConnection", "Menu"
        refs: state.refs || [],
        // array of ref strings
        filter: state.filter || [],
        versionFilter: state.versionFilter || [],
        connectionsMode: state.connectionsMode || "Resources",
        connectionsCategory: state.connectionsCategory || null,
        currVersions: state.currVersions || {
          en: null,
          he: null
        },
        highlightedRefs: state.highlightedRefs || [],
        highlightedNode: state.highlightedNode || null,
        scrollToHighlighted: state.scrollToHighlighted || false,
        currentlyVisibleRef: state.refs && state.refs.length ? state.refs[0] : null,
        recentFilters: state.recentFilters || state.filter || [],
        recentVersionFilters: state.recentVersionFilters || state.versionFilter || [],
        menuOpen: state.menuOpen || null,
        // "navigation", "text toc", "display", "search", "sheets", "community", "book toc"
        navigationCategories: state.navigationCategories || [],
        navigationTopicCategory: state.navigationTopicCategory || "",
        sheetID: state.sheetID || null,
        sheetNodes: state.sheetNodes || null,
        nodeRef: state.nodeRef || null,
        navigationTopic: state.navigationTopic || null,
        navigationTopicTitle: state.navigationTopicTitle || null,
        navigationTopicLetter: state.navigationTopicLetter || null,
        topicTitle: state.topicTitle || null,
        collectionName: state.collectionName || null,
        collectionSlug: state.collectionSlug || null,
        collectionTag: state.collectionTag || null,
        translationsSlug: state.translationsSlug || null,
        searchQuery: state.searchQuery || null,
        searchTab: state.searchTab || 'text',
        showHighlight: state.showHighlight || null,
        textSearchState: state.textSearchState || new sefaria_searchState({
          type: 'text'
        }),
        sheetSearchState: state.sheetSearchState || new sefaria_searchState({
          type: 'sheet'
        }),
        compare: state.compare || false,
        openSidebarAsConnect: state.openSidebarAsConnect || false,
        bookRef: state.bookRef || null,
        settings: state.settings ? sefaria.util.clone(state.settings) : sefaria.util.clone(this.getDefaultPanelSettings()),
        displaySettingsOpen: false,
        initialAnalyticsTracked: state.initialAnalyticsTracked || false,
        selectedWords: state.selectedWords || "",
        sidebarSearchQuery: state.sidebarSearchQuery || null,
        selectedNamedEntity: state.selectedNamedEntity || null,
        selectedNamedEntityText: state.selectedNamedEntityText || null,
        textHighlights: state.textHighlights || null,
        profile: state.profile || null,
        tab: state.tab || null,
        webPagesFilter: state.webPagesFilter || null,
        sideScrollPosition: state.sideScrollPosition || null,
        topicTestVersion: state.topicTestVersion || null
      };
      // if version is not set for the language you're in, see if you can retrieve it from cache
      if (this.state && panel.refs.length && (panel.settings.language === "hebrew" && !panel.currVersions.he || panel.settings.language !== "hebrew" && !panel.currVersions.en)) {
        var oRef = sefaria.ref(panel.refs[0]);
        if (oRef) {
          var lang = panel.settings.language === "hebrew" ? "he" : "en";
          panel.currVersions[lang] = this.getCachedVersion(oRef.indexTitle, lang);
        }
      }
      return panel;
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      this.updateHistoryState(true); // make sure initial page state is in history, (passing true to replace)
      window.addEventListener("popstate", this.handlePopState);
      window.addEventListener("resize", this.setPanelCap);
      window.addEventListener("beforeprint", this.handlePrint);
      document.addEventListener('copy', this.handleCopyEvent);
      this.setPanelCap();
      if (this.props.headerMode) {
        // Handle in app links on static pages outside of react container
        sefariaJquery("a").not(sefariaJquery(ReactDOM.findDOMNode(this)).find("a")).on("click", this.handleInAppLinkClick);
      }
      //Add a default handler on all (link) clicks that is set to fire first
      // and check if we need to just ignore other handlers because someone is doing ctrl+click or something.
      // (because its set to capture, or the event going down the dom stage, and the listener is the document element- it should fire before other handlers. Specifically
      // handleInAppLinkClick that disables modifier keys such as cmd, alt, shift)
      document.addEventListener('click', this.handleInAppClickWithModifiers, {
        capture: true
      });
      // Save all initial panels to recently viewed
      this.state.panels.map(this.saveLastPlace);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      window.removeEventListener("popstate", this.handlePopState);
      window.removeEventListener("resize", this.setPanelCap);
      window.removeEventListener("beforeprint", this.handlePrint);
      document.removeEventListener('copy', this.handleCopyEvent);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps, prevState) {
      sefariaJquery(".content").off("scroll.scrollPosition").on("scroll.scrollPosition", this.setScrollPositionInHistory); // when .content may have rerendered

      if (this.justPopped) {
        //console.log("Skipping history update - just popped")
        this.justPopped = false;
        return;
      }

      // Set initial page view (deferred from analytics.js instanciation)
      if (!this.state.initialAnalyticsTracked) {
        this.trackPageview();
      }
      // If a new panel has been added, and the panels extend beyond the viewable area, check horizontal scroll
      if (this.state.panels.length > this.state.panelCap && this.state.panels.length > prevState.panels.length) {
        var elem = document.getElementById("panelWrapBox");
        var viewExtent = this.state.layoutOrientation === "ltr" // How far (px) current view extends into viewable area
        ? elem.scrollLeft + this.state.windowWidth : elem.scrollWidth - elem.scrollLeft;
        var lastCompletelyVisible = Math.floor(viewExtent / this.MIN_PANEL_WIDTH); // # of last visible panel - base 1
        var leftover = viewExtent % this.MIN_PANEL_WIDTH; // Leftover viewable pixels after last fully visible panel

        var newPanelPosition; // # of newly inserted panel - base 1
        for (var i = 0; i < this.state.panels.length; i++) {
          if (!prevState.panels[i] || this.state.panels[i] != prevState.panels[i]) {
            newPanelPosition = i + 1;
            break;
          }
        }
        if (newPanelPosition > lastCompletelyVisible) {
          var scrollBy = 0; // Pixels to scroll by
          var panelOffset = 0; // Account for partial panel scroll
          if (leftover > 0) {
            // If a panel is half scrolled, bring it fully into view
            scrollBy += this.MIN_PANEL_WIDTH - leftover;
            panelOffset += 1;
          }
          scrollBy += (newPanelPosition - lastCompletelyVisible - panelOffset) * this.MIN_PANEL_WIDTH;
          elem.scrollLeft = this.state.layoutOrientation === "ltr" ? elem.scrollLeft + scrollBy : elem.scrollLeft - scrollBy;
        }
      }
      this.setContainerMode();
      this.updateHistoryState(this.replaceHistory);
    }
  }, {
    key: "handlePopState",
    value: function handlePopState(event) {
      var state = event.state;
      // console.log("Pop - " + window.location.pathname);
      // console.log(event.state);
      if (state) {
        this.justPopped = true;

        // history does not preserve custom objects
        if (state.panels) {
          var _iterator = ReaderApp_createForOfIteratorHelper(state.panels),
            _step;
          try {
            for (_iterator.s(); !(_step = _iterator.n()).done;) {
              var p = _step.value;
              p.textSearchState = p.textSearchState && new sefaria_searchState(p.textSearchState);
              p.sheetSearchState = p.sheetSearchState && new sefaria_searchState(p.sheetSearchState);
            }
          } catch (err) {
            _iterator.e(err);
          } finally {
            _iterator.f();
          }
        } else {
          state.panels = [];
        }
        this.setState(state, function () {
          if (state.scrollPosition) {
            sefariaJquery(".content").scrollTop(event.state.scrollPosition).trigger("scroll");
          }
        });
        this.setContainerMode();
      }
    }
  }, {
    key: "trackPageview",
    value: function trackPageview() {
      var panels = this.state.panels;
      var textPanels = panels.filter(function (panel) {
        return (panel.refs.length || panel.bookRef) && panel.mode !== "Connections";
      });
      var connectionPanels = panels.filter(function (panel) {
        return panel.mode == "Connections";
      });

      // Set Page Type
      // Todo: More specificity for sheets - browsing, reading, writing
      var pageType = !panels.length ? "Static" : panels[0].menuOpen || panels[0].mode;
      sefaria.track.setPageType(pageType);

      // Number of panels as e.g. "2" meaning 2 text panels or "3.2" meaning 3 text panels and 2 connection panels
      if (connectionPanels.length == 0) {
        sefaria.track.setNumberOfPanels(textPanels.length.toString());
      } else {
        sefaria.track.setNumberOfPanels("".concat(textPanels.length, ".").concat(connectionPanels.length));
      }

      // refs - per text panel
      var refs = textPanels.map(function (panel) {
        return panel.refs.length ? panel.refs.slice(-1)[0] : panel.bookRef;
      });
      sefaria.track.setRef(refs.join(" | "));

      // Book name (Index record primary name) - per text panel
      var bookNames = refs.map(function (ref) {
        return sefaria.parseRef(ref).index;
      }).filter(function (b) {
        return !!b;
      });
      sefaria.track.setBookName(bookNames.join(" | "));

      // Indexes - per text panel
      var indexes = bookNames.map(function (b) {
        return sefaria.index(b);
      }).filter(function (i) {
        return !!i;
      });

      // categories - per text panel
      var primaryCats = indexes.map(function (i) {
        return i.dependence === "Commentary" ? i.categories[0] + " Commentary" : i.categories[0];
      });
      sefaria.track.setPrimaryCategory(primaryCats.join(" | "));
      var secondaryCats = indexes.map(function (i) {
        var cats = i.categories.filter(function (cat) {
          return cat != "Commentary";
        }).slice(1);
        return cats.length >= 1 ? cats[0] : "";
      });
      sefaria.track.setSecondaryCategory(secondaryCats.join(" | "));

      // panel content languages - per text panel
      var contentLanguages = textPanels.map(function (panel) {
        return panel.settings.language;
      });
      sefaria.track.setContentLanguage(contentLanguages.join(" | "));

      // Set Versions - per text panel
      var versionTitles = textPanels.map(function (p) {
        return p.currVersions.en ? "".concat(p.currVersions.en, "(en)") : p.currVersions.he ? "".concat(p.currVersions.he, "(he)") : 'default version';
      });
      sefaria.track.setVersionTitle(versionTitles.join(" | "));

      // Set Sidebar usages
      // todo: handle toolbar selections
      var sidebars = connectionPanels.map(function (panel) {
        return panel.filter.length ? panel.filter.join("+") : "all";
      });
      sefaria.track.setSidebars(sidebars.join(" | "));

      // After setting the dimensions, post the hit
      var url = window.location.pathname + window.location.search;
      // Sefaria.track.pageview(url);

      if (!this.state.initialAnalyticsTracked) {
        this.setState({
          initialAnalyticsTracked: true
        });
      }
    }
  }, {
    key: "shouldHistoryUpdate",
    value: function shouldHistoryUpdate() {
      // Compare the current state to the state last pushed to history,
      // Return true if the change warrants pushing to history.
      if (!history.state || !history.state.panels && !!this.state.panels || history.state.panels && history.state.panels.length !== this.state.panels.length) {
        // If there's no history or the number or basic state of panels has changed
        return true;
      }
      var prevPanels = history.state.panels || [];
      var nextPanels = this.state.panels || [];
      for (var i = 0; i < prevPanels.length; i++) {
        // Cycle through each panel, compare previous state to next state, looking for differences
        var prev = prevPanels[i];
        var next = nextPanels[i];
        if (!prev || !next) {
          return true;
        }
        // history does not preserve custom objects
        var prevTextSearchState = new sefaria_searchState(prev.textSearchState);
        var prevSheetSearchState = new sefaria_searchState(prev.sheetSearchState);
        var nextTextSearchState = new sefaria_searchState(next.textSearchState);
        var nextSheetSearchState = new sefaria_searchState(next.sheetSearchState);
        if (prev.mode !== next.mode || prev.menuOpen !== next.menuOpen || prev.menuOpen === "book toc" && prev.bookRef !== next.bookRef || next.mode === "Text" && prev.refs.slice(-1)[0] !== next.refs.slice(-1)[0] || next.mode === "Text" && !prev.highlightedRefs.compare(next.highlightedRefs) || next.mode === "TextAndConnections" && prev.highlightedRefs.slice(-1)[0] !== next.highlightedRefs.slice(-1)[0] || (next.mode === "Connections" || next.mode === "TextAndConnections") && prev.filter && !prev.filter.compare(next.filter) || next.mode === "Translation Open" && prev.versionFilter && !prev.versionFilter(next.versionFilter) || next.mode === "Connections" && !prev.refs.compare(next.refs) || next.currentlyVisibleRef !== prev.currentlyVisibleRef || next.connectionsMode !== prev.connectionsMode || prev.currVersions.en !== next.currVersions.en || prev.currVersions.he !== next.currVersions.he || prev.searchQuery != next.searchQuery || prev.searchTab != next.searchTab || prev.tab !== next.tab || prev.collectionName !== next.collectionName || prev.collectionTag !== next.collectionTag || !prevTextSearchState.isEqual({
          other: nextTextSearchState,
          fields: ["appliedFilters", "field", "sortType"]
        }) || !prevSheetSearchState.isEqual({
          other: nextSheetSearchState,
          fields: ["appliedFilters", "field", "sortType"]
        }) || prev.settings.language != next.settings.language || prev.navigationTopicCategory !== next.navigationTopicCategory || prev.settings.aliyotTorah != next.settings.aliyotTorah || prev.navigationTopic != next.navigationTopic) {
          return true;
        } else if (prev.navigationCategories !== next.navigationCategories) {
          // Handle array comparison, !== could mean one is null or both are arrays
          if (!prev.navigationCategories || !next.navigationCategories) {
            return true; // They are not equal and one is null
          } else if (!prev.navigationCategories.compare(next.navigationCategories)) {
            return true; // both are set, compare arrays
          }
        }
      }

      return false;
    }
  }, {
    key: "clonePanel",
    value: function clonePanel(panel, prepareForSerialization) {
      return sefaria.util.clone(panel, prepareForSerialization);
    }
  }, {
    key: "makeHistoryState",
    value: function makeHistoryState() {
      var _this2 = this;
      // Returns an object with state, title and url params for the current state
      var histories = [];
      var states = this.state.panels.map(function (panel) {
        return _this2.clonePanel(panel, true);
      });
      var siteName = sefaria._siteSettings.SITE_NAME.en; // e.g. "Sefaria"
      var shortLang = sefaria.interfaceLang === 'hebrew' ? 'he' : 'en';

      // List of modes that the ConnectionsPanel may have which can be represented in a URL.
      var sidebarModes = new Set(["Sheets", "Notes", "Translations", "Translation Open", "About", "AboutSheet", "Navigation", "WebPages", "extended notes", "Topics", "Torah Readings", "manuscripts", "Lexicon", "SidebarSearch"]);
      var addTab = function addTab(url) {
        if (state.tab && state.menuOpen !== "search") {
          return url + "&tab=".concat(state.tab);
        } else {
          return url;
        }
      };
      for (var i = 0; i < states.length; i++) {
        // Walk through each panel, create a history object as though for this panel alone
        if (!states[i]) {
          debugger;
        }
        var state = states[i];
        var hist = {
          url: ""
        };
        if (state.menuOpen) {
          hist.menuPage = true;
          switch (state.menuOpen) {
            case "navigation":
              var cats = state.navigationCategories ? state.navigationCategories.join("/") : "";
              hist.title = cats ? state.navigationCategories.map(sefaria._).join(", ") + " | " + sefaria._(siteName) : sefaria._("Sefaria: a Living Library of Jewish Texts Online");
              hist.url = "texts" + (cats ? "/" + cats : "");
              hist.mode = "navigation";
              break;
            case "text toc":
              var ref = state.refs.slice(-1)[0];
              var bookTitle = ref ? sefaria.parseRef(ref).index : "404";
              hist.title = sefaria._(bookTitle) + " | " + sefaria._(siteName);
              hist.url = bookTitle.replace(/ /g, "_");
              hist.mode = "text toc";
              break;
            case "book toc":
              var bookTitle = state.bookRef;
              hist.title = sefaria._(bookTitle) + " | " + sefaria._(siteName);
              hist.url = bookTitle.replace(/ /g, "_");
              hist.mode = "book toc";
              break;
            case "sheet meta":
              var sheet = sefaria.sheets.loadSheetByID(state.sheetID);
              var sheetTitle = sheet ? sheet.title.stripHtml() : "";
              hist.title = sefaria._(siteName + " Source Sheets") + ": " + sheetTitle;
              hist.url = i == 0 ? "sheets/" + state.sheetID : "sheet&s=" + state.sheetID;
              hist.mode = "sheet meta";
              break;
            case "extended notes":
              var bookTitle = state.mode === "Connections" ? sefaria.parseRef(state.currentlyVisibleRef).index : state.bookRef;
              hist.currVersions = state.currVersions;
              hist.url = "".concat(bookTitle, "&notes").concat(i > 1 ? i : '', "=1").replace(/ /g, "_");
              hist.mode = "extended notes";
              break;
            case "search":
              var query = state.searchQuery ? encodeURIComponent(state.searchQuery) : "";
              hist.title = state.searchQuery ? state.searchQuery + " | " : "";
              hist.title += sefaria._(siteName + " Search");
              hist.url = "search" + (state.searchQuery ? "&q=".concat(query, "&tab=").concat(state.searchTab) + state.textSearchState.makeURL({
                prefix: 't',
                isStart: false
              }) + state.sheetSearchState.makeURL({
                prefix: 's',
                isStart: false
              }) : "");
              hist.mode = "search";
              break;
            case "topics":
              if (state.navigationTopic) {
                hist.url = state.topicTestVersion ? "topics/".concat(state.topicTestVersion, "/").concat(state.navigationTopic) : "topics/".concat(state.navigationTopic);
                hist.title = "".concat(state.topicTitle[shortLang], " | ").concat(sefaria._("Texts & Source Sheets from Torah, Talmud and Sefaria's library of Jewish sources."));
                hist.mode = "topic";
              } else if (state.navigationTopicCategory) {
                hist.title = state.navigationTopicTitle[shortLang] + " | " + sefaria._("Texts & Source Sheets from Torah, Talmud and Sefaria's library of Jewish sources.");
                hist.url = "topics/category/" + state.navigationTopicCategory;
                hist.mode = "topicCat";
              } else {
                hist.url = "topics";
                hist.title = sefaria._("Topics | " + siteName);
                hist.mode = "topics";
              }
              break;
            case "allTopics":
              hist.url = "topics/all/" + state.navigationTopicLetter;
              hist.title = sefaria._("Explore Jewish Texts by Topic") + " - " + state.navigationTopicLetter + " | " + sefaria._(siteName);
              hist.mode = "topics";
              break;
            case "community":
              hist.title = sefaria._("From the Community: Today on Sefaria");
              hist.url = "community";
              hist.mode = "community";
              break;
            case "profile":
              hist.title = "".concat(state.profile.full_name, " ").concat(sefaria._("on Sefaria"));
              hist.url = "profile/".concat(state.profile.slug);
              hist.mode = "profile";
              break;
            case "notifications":
              hist.title = sefaria._(siteName + " Notifications");
              hist.url = "notifications";
              hist.mode = "notifications";
              break;
            case "collection":
              hist.url = "collections/" + state.collectionSlug;
              if (states[i].collectionTag) {
                hist.url += "&tag=" + state.collectionTag.replace("#", "%23");
              }
              hist.title = (state.collectionName ? state.collectionName + " | " : "") + sefaria._(siteName + " Collections");
              hist.mode = "collection";
              break;
            case "collectionsPublic":
              hist.title = sefaria._("Collections") + " | " + sefaria._(siteName);
              hist.url = "collections";
              hist.mode = "collcetionsPublic";
              break;
            case "translationsPage":
              hist.url = "translations/" + state.translationsSlug;
              hist.title = sefaria.getHebrewTitle(state.translationsSlug);
              hist.mode = "translations";
              break;
            case "calendars":
              hist.title = sefaria._("Learning Schedules") + " | " + sefaria._(siteName);
              hist.url = "calendars";
              hist.mode = "calendars";
              break;
            case "updates":
              hist.title = sefaria._("New Additions to the " + siteName + " Library");
              hist.url = "updates";
              hist.mode = "updates";
              break;
            case "modtools":
              hist.title = sefaria._("Moderator Tools");
              hist.url = "modtools";
              hist.mode = "modtools";
              break;
            case "user_stats":
              hist.title = sefaria._("Torah Tracker");
              hist.url = "torahtracker";
              hist.mode = "user_stats";
              break;
            case "saved":
              hist.title = sefaria._("My Saved Content");
              hist.url = "texts/saved";
              hist.mode = "saved";
              break;
            case "history":
              hist.title = sefaria._("My Reading History");
              hist.url = "texts/history";
              hist.mode = "history";
          }
          hist.url = addTab(hist.url);
        } else if (state.mode === "Text") {
          var highlighted = state.highlightedRefs.length ? sefaria.normRefList(state.highlightedRefs) : null;
          if (highlighted && (sefaria.refContains(highlighted, state.currentlyVisibleRef) || sefaria.refContains(state.currentlyVisibleRef, highlighted))) {
            var htitle = highlighted;
          } else {
            var htitle = state.currentlyVisibleRef;
          }
          hist.title = sefaria._r(htitle);
          hist.url = sefaria.normRef(htitle);
          hist.currVersions = state.currVersions;
          hist.mode = "Text";
          if (sefaria.titleIsTorah(htitle)) {
            hist.aliyot = state.settings.aliyotTorah == "aliyotOff" ? 0 : 1;
          }
        } else if (state.mode === "Connections") {
          var ref = sefaria.normRefList(state.refs);
          if (state.connectionsMode === "WebPagesList") {
            hist.sources = "WebPage:" + state.webPagesFilter;
          } else {
            var filter = state.filter.length ? state.filter : sidebarModes.has(state.connectionsMode) ? [state.connectionsMode] : ["all"];
            filter = state.connectionsMode === "ConnectionsList" ? filter.map(function (x) {
              return x + " ConnectionsList";
            }) : filter; // "Reflect ConnectionsList
            hist.sources = filter.join("+");
          }
          if (state.connectionsMode === "Translation Open" && state.versionFilter.length) {
            hist.versionFilter = state.versionFilter[0];
          }
          if (state.connectionsMode === "SidebarSearch") {
            state.refs = states[i - 1].refs;
            if (state.sidebarSearchQuery) {
              hist.sidebarSearchQuery = state.sidebarSearchQuery;
            }
          }
          if (state.connectionsMode === "Lexicon") {
            if (state.selectedWords.length) {
              hist.selectedWords = state.selectedWords;
            }
            if (state.selectedNamedEntity) {
              hist.selectedNamedEntity = state.selectedNamedEntity;
            }
            if (state.selectedNamedEntityText) {
              hist.selectedNamedEntityText = state.selectedNamedEntityText;
            }
          }
          hist.title = sefaria._r(ref) + sefaria._(" with ") + sefaria._(hist.sources === "all" ? "Connections" : hist.sources);
          hist.url = sefaria.normRef(ref); // + "?with=" + sources;
          hist.mode = "Connections";
        } else if (state.mode === "TextAndConnections") {
          var highlighted = state.highlightedRefs.length ? sefaria.normRefList(state.highlightedRefs) : null;
          var filter = state.filter.length ? state.filter : sidebarModes.has(state.connectionsMode) ? [state.connectionsMode] : ["all"];
          hist.sources = filter.join("+");
          if (highlighted && (sefaria.refContains(highlighted, state.currentlyVisibleRef) || sefaria.refContains(state.currentlyVisibleRef, highlighted))) {
            var htitle = highlighted;
          } else {
            var htitle = state.currentlyVisibleRef;
          }
          if (state.connectionsMode === "Translation Open" && state.versionFilter.length) {
            hist.versionFilter = state.versionFilter[0];
          }
          hist.title = sefaria._r(htitle) + sefaria._(" with ") + sefaria._(hist.sources === "all" ? "Connections" : hist.sources);
          hist.url = sefaria.normRef(htitle); // + "?with=" + sources;
          hist.currVersions = state.currVersions;
          hist.mode = "TextAndConnections";
          if (sefaria.titleIsTorah(htitle)) {
            hist.aliyot = state.settings.aliyotTorah == "aliyotOff" ? 0 : 1;
          }
        } else if (state.mode === "Sheet") {
          var _sheet = sefaria.sheets.loadSheetByID(state.sheetID);
          hist.title = _sheet ? _sheet.title.stripHtml() : "";
          var sheetURLSlug = state.highlightedNode ? state.sheetID + "." + state.highlightedNode : state.sheetID;
          var _filter = state.filter.length ? state.filter : sidebarModes.has(state.connectionsMode) ? [state.connectionsMode] : ["all"];
          hist.sources = _filter.join("+");
          hist.url = i == 0 ? "sheets/" + sheetURLSlug : "sheet&s=" + sheetURLSlug;
          hist.mode = "Sheet";
        } else if (state.mode === "SheetAndConnections") {
          var _filter2 = state.filter.length ? state.filter : sidebarModes.has(state.connectionsMode) ? [state.connectionsMode] : ["all"];
          hist.sources = _filter2.join("+");
          if (state.connectionsMode === "Translation Open" && state.versionFilter.length) {
            hist.versionFilter = state.versionFilter[0];
          }
          var _sheet2 = sefaria.sheets.loadSheetByID(state.sheetID);
          var _title = _sheet2 ? _sheet2.title.stripHtml() : "";
          hist.title = _title + sefaria._(" with ") + sefaria._(hist.sources === "all" ? "Connections" : hist.sources);
          hist.url = i == 0 ? "sheets/" + state.sheetID : "sheet&s=" + state.sheetID + "?with=" + sefaria._(hist.sources === "all" ? "Connections" : hist.sources);
          hist.mode = "SheetAndConnections";
        }
        if (!state.settings) {
          debugger;
        }
        if (!hist.menuPage) {
          hist.lang = state.settings.language ? state.settings.language.substring(0, 2) : "bi";
        }
        histories.push(hist);
      }
      if (!histories.length) {
        // If there were no panels, we're in headerMode over a static page
        histories[0] = {
          title: document.title,
          url: window.location.pathname.slice(1),
          mode: "Header"
        };
        if (window.location.search != "") {
          // Replace initial ? of query string with & which logic below expects
          histories[0].url += "&" + window.location.search.slice(1);
        }
      }

      // Now merge all history objects into one
      var title = histories.length ? histories[0].title : "Sefaria";
      var url = "/" + (histories.length ? histories[0].url : "");
      url += sefaria.util.getUrlVersionsParams(histories[0].currVersions, 0);
      if (histories[0].mode === "TextAndConnections" || histories[0].mode === "SheetAndConnections") {
        url += "&with=" + histories[0].sources;
      }
      if (histories[0].lang) {
        url += "&lang=" + histories[0].lang;
      }
      if ("aliyot" in histories[0]) {
        url += "&aliyot=" + histories[0].aliyot;
      }
      hist = {
        state: {
          panels: states
        },
        url: url,
        title: title,
        mode: histories[0].mode
      };
      var isMobileConnectionsOpen = histories[0].mode === "TextAndConnections" || histories[0].mode === "SheetAndConnections";
      for (var i = 1; i < histories.length || isMobileConnectionsOpen && i === 1; i++) {
        var isMultiPanelConnectionsOpen = histories[i - 1].mode === "Text" && histories[i].mode === "Connections" || histories[i - 1].mode === "Sheet" && histories[i].mode === "Connections";
        if (isMultiPanelConnectionsOpen || isMobileConnectionsOpen) {
          if (i == 1) {
            var sheetAndCommentary = histories[i - 1].mode === "Sheet" ? true : false;
            var connectionsHistory = isMultiPanelConnectionsOpen ? histories[1] : histories[0];
            // short form for two panels text+commentary - e.g., /Genesis.1?with=Rashi
            hist.url = sheetAndCommentary ? "/" + histories[0].url : "/" + connectionsHistory.url; // Rewrite the URL
            hist.url += sefaria.util.getUrlVersionsParams(histories[0].currVersions, 0);
            if (histories[0].lang) {
              hist.url += "&lang=" + histories[0].lang;
            }
            if ("aliyot" in histories[0]) {
              url += "&aliyot=" + histories[0].aliyot;
            }
            if (connectionsHistory.versionFilter) {
              hist.url += "&vside=" + sefaria.util.encodeVtitle(connectionsHistory.versionFilter);
            }
            if (connectionsHistory.selectedWords) {
              hist.url += "&lookup=" + encodeURIComponent(connectionsHistory.selectedWords);
            }
            if (connectionsHistory.selectedNamedEntity) {
              hist.url += "&namedEntity=" + connectionsHistory.selectedNamedEntity;
            }
            if (connectionsHistory.sidebarSearchQuery) {
              hist.url += "&sbsq=" + connectionsHistory.sidebarSearchQuery;
            }
            if (connectionsHistory.selectedNamedEntityText) {
              hist.url += "&namedEntityText=" + encodeURIComponent(connectionsHistory.selectedNamedEntityText);
            }
            hist.url += "&with=" + connectionsHistory.sources;
            hist.title = sheetAndCommentary ? histories[0].title : connectionsHistory.title;
          } else {
            var replacer = "&p" + i + "=";
            hist.url = hist.url.replace(RegExp(replacer + ".*"), "");
            hist.url += replacer + histories[i].url;
            hist.url += sefaria.util.getUrlVersionsParams(histories[i - 1].currVersions, i);
            if (histories[i - 1].lang) {
              hist.url += "&lang" + i + "=" + histories[i - 1].lang;
            }
            if ("aliyot" in histories[i - 1]) {
              hist.url += "&aliyot" + i + "=" + histories[i - 1].aliyot;
            }
            if (histories[i].versionFilter) {
              hist.url += "&vside" + i + "=" + sefaria.util.encodeVtitle(histories[i].versionFilter);
            }
            if (histories[i].selectedWords) {
              hist.url += "&lookup".concat(i, "=").concat(encodeURIComponent(histories[i].selectedWords));
            }
            if (histories[i].sidebarSearchQuery) {
              hist.url += "&sbsq{i}=".concat(histories[i].sidebarSearchQuery);
            }
            if (histories[i].selectedNamedEntity) {
              hist.url += "&namedEntity".concat(i, "=").concat(histories[i].selectedNamedEntity);
            }
            if (histories[i].selectedNamedEntityText) {
              hist.url += "&namedEntityText".concat(i, "=").concat(encodeURIComponent(histories[i].selectedNamedEntityText));
            }
            hist.url += "&w" + i + "=" + histories[i].sources; //.replace("with=", "with" + i + "=").replace("?", "&");
            hist.title += sefaria._(" & ") + histories[i].title; // TODO this doesn't trim title properly
          }
        } else {
          var next = "&p=" + histories[i].url;
          next = next.replace("?", "&").replace(/=/g, i + 1 + "=");
          hist.url += next;
          hist.url += sefaria.util.getUrlVersionsParams(histories[i].currVersions, i + 1);
          hist.title += sefaria._(" & ") + histories[i].title;
        }
        if (!isMobileConnectionsOpen) {
          if (histories[i].lang) {
            hist.url += "&lang" + (i + 1) + "=" + histories[i].lang;
          }
          if ("aliyot" in histories[i]) {
            hist.url += "&aliyot" + (i + 1) + "=" + histories[i].aliyot;
          }
        }
      }
      // Replace the first only & with a ?
      hist.url = hist.url.replace(/&/, "?");
      return hist;
    }
  }, {
    key: "updateHistoryState",
    value: function updateHistoryState(replace) {
      if (!this.shouldHistoryUpdate()) {
        return;
      }
      var currentUrl = window.location.pathname + window.location.search;
      var hist = this.makeHistoryState();
      if (window.location.hash.length) {
        currentUrl += window.location.hash;
        hist.url += window.location.hash;
      }
      if (replace) {
        history.replaceState(hist.state, hist.title, hist.url);
        // console.log("Replace History - " + hist.url + " | " + currentUrl);
        if (currentUrl !== hist.url) {
          this.checkScrollIntentAndTrack();
        }
        //console.log(hist);
      } else {
        if (currentUrl === hist.url) {
          return;
        } // Never push history with the same URL
        history.pushState(hist.state, hist.title, hist.url);
        // console.log("Push History - " + hist.url);
        this.trackPageview();
      }
      sefariaJquery("title").html(hist.title);
      this.replaceHistory = false;
      this.setPaddingForScrollbar(); // Called here to save duplicate calls to shouldHistoryUpdate
    }
  }, {
    key: "_refState",
    value: function _refState() {
      var _ref;
      // Return a single flat list of all the refs across all panels
      return (_ref = []).concat.apply(_ref, ReaderApp_toConsumableArray(this.state.panels.map(function (p) {
        return p.refs || [];
      })));
    }
    // These two methods to check scroll intent have similar implementations on the panel level.  Refactor?
    // Dec 2018 - somewhat refactored
  }, {
    key: "checkScrollIntentAndTrack",
    value: function checkScrollIntentAndTrack() {
      var _this3 = this;
      // Record current state of panel refs, and check if it has changed after some delay.  If it remains the same, track analytics.
      var initialRefs = this._refState();
      this.scrollIntentTimer = this.checkIntentTimer(this.scrollIntentTimer, function () {
        if (initialRefs.compare(_this3._refState())) {
          console.log("TRACK PAGE VIEW");
          _this3.trackPageview();
        }
        _this3.scrollIntentTimer = null;
      });
    }
  }, {
    key: "checkPanelScrollIntentAndSaveRecent",
    value: function checkPanelScrollIntentAndSaveRecent(state, n) {
      var _this4 = this;
      // Record current state of panel refs, and check if it has changed after some delay.  If it remains the same, track analytics.
      this.panelScrollIntentTimer = this.panelScrollIntentTimer || [];
      this.panelScrollIntentTimer[n] = this.checkIntentTimer(this.panelScrollIntentTimer[n], function () {
        if (!_this4.didPanelRefChange(state, _this4.state.panels[n])) {
          //const ref  = (state.highlightedRefs && state.highlightedRefs.length) ? Sefaria.normRef(state.highlightedRefs) : (state.currentlyVisibleRef || state.refs.slice(-1)[0]);  // Will currentlyVisibleRef ever not be available?
          //console.log("Firing last viewed " + ref + " in panel " + n);
          _this4.saveLastPlace(_this4.state.panels[n], n);
        }
        _this4.panelScrollIntentTimer[n] = null;
      });
    }
  }, {
    key: "checkIntentTimer",
    value: function checkIntentTimer(timer, cb, intentDelay) {
      intentDelay = intentDelay || 3000; // Number of milliseconds to demonstrate intent
      if (timer) {
        clearTimeout(timer);
      }
      return window.setTimeout(cb, intentDelay);
    }
  }, {
    key: "setScrollPositionInHistory",
    value: function setScrollPositionInHistory(e) {
      var $scrollContainer = sefariaJquery(e.target);
      this.scrollPositionTimer = this.checkIntentTimer(this.scrollPositionTimer, function () {
        var scrollTop = $scrollContainer.scrollTop();
        var state = history.state;
        if (scrollTop === state.scrollPosition) {
          return;
        }
        state.scrollPosition = scrollTop;
        history.replaceState(state, window.location.href);
      }, 300);
    }
  }, {
    key: "getDefaultPanelSettings",
    value: function getDefaultPanelSettings() {
      if (this.state && this.state.defaultPanelSettings) {
        return this.state.defaultPanelSettings;
      } else if (this.props.initialSettings) {
        return this.props.initialSettings;
      } else {
        return {
          language: "bilingual",
          layoutDefault: "segmented",
          layoutTalmud: "continuous",
          layoutTanakh: "segmented",
          aliyotTorah: "aliyotOff",
          vowels: "all",
          punctuationTalmud: "punctuationOn",
          biLayout: "stacked",
          color: "light",
          fontSize: 62.5
        };
      }
    }
  }, {
    key: "setContainerMode",
    value: function setContainerMode() {
      // Applies CSS classes to the React container and body so that the App can function as a
      // header only on top of a static page.
      if (this.props.headerMode) {
        if (this.state.panels && this.state.panels.length) {
          sefariaJquery("#s2").removeClass("headerOnly");
          sefariaJquery("body").css({
            overflow: "hidden"
          }).addClass("inApp").removeClass("hasBannerMessage");
        } else {
          sefariaJquery("#s2").addClass("headerOnly");
          sefariaJquery("body").css({
            overflow: "auto"
          }).removeClass("inApp");
        }
      }
    }
  }, {
    key: "setPanelCap",
    value: function setPanelCap() {
      // In multi panel mode, set the maximum number of visible panels depending on the window width.
      this.setWindowWidth();
      var panelCap = Math.floor(sefariaJquery(window).outerWidth() / this.MIN_PANEL_WIDTH);
      this.setState({
        panelCap: panelCap
      });
    }
  }, {
    key: "setWindowWidth",
    value: function setWindowWidth() {
      // console.log("Setting window width: " + $(window).outerWidth());
      this.setState({
        windowWidth: sefariaJquery(window).outerWidth()
      });
    }
  }, {
    key: "setPaddingForScrollbar",
    value: function setPaddingForScrollbar() {
      // Scrollbars take up spacing, causing the centering of panels to be slightly off
      // compared to the header. This functions sets appropriate padding to compensate.
      var width = sefaria.util.getScrollbarWidth();
      // These are the divs that actually scroll
      var $container = sefariaJquery(ReactDOM.findDOMNode(this)).find(".textColumn, .sheetsInPanel");
      if (this.state.panels.length > 1) {
        $container.css({
          paddingRight: "",
          paddingLeft: ""
        });
      } else {
        $container.css({
          paddingRight: 0,
          paddingLeft: width
        });
      }
    }
  }, {
    key: "toggleSignUpModal",
    value: function toggleSignUpModal() {
      var modalContentKind = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : SignUpModalKind.Default;
      if (this.state.showSignUpModal) {
        this.setState({
          showSignUpModal: false
        });
      } else {
        this.setState({
          showSignUpModal: true,
          modalContentKind: modalContentKind
        });
      }
    }
  }, {
    key: "handleNavigationClick",
    value: function handleNavigationClick(ref, currVersions, options) {
      this.openPanel(ref, currVersions, options);
    }
  }, {
    key: "handleSegmentClick",
    value: function handleSegmentClick(n, ref, sheetNode) {
      // Handle a click on a text segment `ref` in from panel in position `n`
      // Update or add panel after this one to be a TextList
      var refs = typeof ref == "string" ? [ref] : ref;
      if (sheetNode) {
        this.setSheetHighlight(n, sheetNode);
      } else {
        this.setTextListHighlight(n, refs);
      }
      var nodeRef = sheetNode ? this.state.panels[n].sheetID + "." + sheetNode : null;
      if (this.currentlyConnecting()) {
        return;
      }
      this.openTextListAt(n + 1, refs, nodeRef);
      if (sefariaJquery(".readerPanel")[n + 1] && window.getSelection().isCollapsed && window.getSelection().anchorNode.nodeType !== 3) {
        //Focus on the first focusable element of the newly loaded panel if text not selected and not actively typing
        // in editor. Exists for a11y
        var curPanel = sefariaJquery(".readerPanel")[n + 1];
        sefariaJquery(curPanel).find(':focusable').first().focus();
      }
    }
  }, {
    key: "closeConnectionPanel",
    value: function closeConnectionPanel(n) {
      if (this.state.panels.length > n + 1 && this.state.panels[n + 1].mode === "Connections") {
        this.closePanel(n + 1);
      }
    }
  }, {
    key: "closeNamedEntityInConnectionPanel",
    value: function closeNamedEntityInConnectionPanel(n) {
      if (this.state.panels.length > n + 1 && this.state.panels[n + 1].selectedNamedEntity) {
        this.setPanelState(n + 1, {
          connectionsMode: "Resources"
        });
        this.clearNamedEntity(n + 1);
      }
    }
  }, {
    key: "handleCitationClick",
    value: function handleCitationClick(n, citationRef, textRef, replace, currVersions) {
      // Handle clicking on the citation `citationRef` which was found inside of `textRef` in panel `n`.
      // If `replace`, replace a following panel with this citation, otherwise open a new panel after.
      if (this.state.panels.length > n + 1 && (replace || this.state.panels[n + 1].mode === "Connections")) {
        this.closePanel(n + 1);
      }
      if (textRef) {
        this.setTextListHighlight(n, textRef);
      }
      this.openPanelAt(n, citationRef, currVersions, {
        scrollToHighlighted: !!replace
      });
    }
  }, {
    key: "openNamedEntityInNewPanel",
    value: function openNamedEntityInNewPanel(n, textRef, namedEntityState) {
      //this.setTextListHighlight(n, [textRef]);
      this.openTextListAt(n + 1, [textRef], null, namedEntityState);
    }
  }, {
    key: "clearSelectedWords",
    value: function clearSelectedWords(n) {
      this.setPanelState(n, {
        selectedWords: ""
      });
    }
  }, {
    key: "clearNamedEntity",
    value: function clearNamedEntity(n) {
      this.setPanelState(n, {
        selectedNamedEntity: null,
        selectedNamedEntityText: null
      });
    }
  }, {
    key: "setSidebarSearchQuery",
    value: function setSidebarSearchQuery(n, query) {
      this.setPanelState(n, {
        sidebarSearchQuery: query
      });
    }
  }, {
    key: "handleCompareSearchClick",
    value: function handleCompareSearchClick(n, ref, currVersions, options) {
      // Handle clicking a search result in a compare panel, so that clicks don't clobber open panels
      this.replacePanel(n, ref, currVersions, options);
    }
  }, {
    key: "handleSidebarSearchClick",
    value: function handleSidebarSearchClick(n, ref, currVersions, options) {
      var refs = typeof ref == "string" ? [ref] : ref;
      var new_opts = {
        scrollToHighlighted: true,
        refs: refs,
        highlightedRefs: refs,
        showHighlight: true,
        currentlyVisibleRef: refs
      };
      this.replacePanel(n - 1, ref, currVersions, new_opts);
    }
  }, {
    key: "getHTMLLinkParentOfEventTarget",
    value: function getHTMLLinkParentOfEventTarget(event) {
      //get the lowest level parent element of an event target that is an HTML link tag. Or Null.
      var target = event.target,
        parent = target,
        outmost = event.currentTarget;
      while (parent) {
        if (parent.nodeName === 'A') {
          return parent;
        } else if (parent.parentNode === outmost) {
          return null;
        }
        parent = parent.parentNode;
      }
    }
  }, {
    key: "handleInAppClickWithModifiers",
    value: function handleInAppClickWithModifiers(e) {
      //Make sure to respect ctrl/cmd etc modifier keys when a click on a link happens
      var linkTarget = this.getHTMLLinkParentOfEventTarget(e);
      if (linkTarget) {
        // We want the absolute target of the event to be a link tag, not the "currentTarget".
        // Dont trigger if user is attempting to open a link with a modifier key (new tab, new window)
        if (e.metaKey || e.shiftKey || e.ctrlKey || e.altKey) {
          //the ctrl/cmd, shift and alt/options keys in Windows and MacOS
          // in this case we want to stop other handlers from running and just go to target href
          e.stopImmediatePropagation();
          return;
        }
      }
    }
  }, {
    key: "handleInAppLinkClick",
    value: function handleInAppLinkClick(e) {
      //Allow global navigation handling in app via link elements
      // If a default has been prevented, assume a custom handler is already in place
      if (e.isDefaultPrevented()) {
        return;
      }
      // Don't trigger from v1 Sheet Builder which has conflicting CSS
      if (typeof sjs !== "undefined") {
        return;
      }
      // https://github.com/STRML/react-router-component/blob/master/lib/CaptureClicks.js
      // Get the <a> element.
      var linkTarget = this.getHTMLLinkParentOfEventTarget(e);
      // Ignore clicks from non-a elements.
      if (!linkTarget) {
        return;
      }
      // Ignore the click if the element has a target.
      if (linkTarget.target && linkTarget.target !== '_self') {
        return;
      }
      var href = linkTarget.getAttribute('href');
      if (!href) {
        return;
      }
      //on mobile just replace panel w/ any link
      if (!this.props.multiPanel) {
        var _handled = this.openURL(href, true);
        if (_handled) {
          e.preventDefault();
        }
        return;
      }
      //All links within sheet content should open in a new panel
      var isSheet = !!linkTarget.closest(".sheetItem");
      var replacePanel = !isSheet;
      var isTranslationsPage = !!linkTarget.closest(".translationsPage");
      var handled = this.openURL(href, replacePanel, isTranslationsPage);
      if (handled) {
        e.preventDefault();
      }
    }
  }, {
    key: "openURL",
    value: function openURL(href) {
      var replace = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
      var overrideContentLang = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
      // Attempts to open `href` in app, return true if successful.
      href = href.startsWith("/") ? "https://www.sefaria.org" + href : href;
      var url;
      try {
        url = new URL(href);
      } catch (_unused) {
        return false;
      }
      // Open non-Sefaria urls in new tab/window
      // TODO generalize to any domain of current deploy.
      if (url.hostname.indexOf("www.sefaria.org") === -1) {
        window.open(url, '_blank');
        return true;
      }
      var path = decodeURI(url.pathname);
      var params = url.searchParams;
      if (overrideContentLang && params.get('lang')) {
        var lang = params.get("lang");
        lang = lang === "bi" ? "bilingual" : lang === "en" ? "english" : "hebrew";
        this.setDefaultOption("language", lang);
      }
      var openPanel = replace ? this.openPanel : this.openPanelAtEnd;
      if (path === "/") {
        this.showLibrary();
      } else if (path === "/texts") {
        this.showLibrary();
      } else if (path === "/texts/history") {
        this.showHistory();
      } else if (path === "/texts/saved") {
        this.showSaved();
      } else if (path.match(/\/texts\/.+/)) {
        this.showLibrary(path.slice(7).split("/"));
      } else if (path === "/collections") {
        this.showCollections();
      } else if (path === "/community") {
        this.showCommunity();
      } else if (path === "/my/profile") {
        this.openProfile(sefaria.slug, params.get("tab"));
      } else if (path === "/notifications") {
        this.showNotifications();
      } else if (path === "/calendars") {
        this.showCalendars();
      } else if (path === "/torahtracker") {
        this.showUserStats();
      } else if (path.match(/^\/sheets\/\d+/)) {
        openPanel("Sheet " + path.slice(8));
      } else if (path === "/topics") {
        this.showTopics();
      } else if (path.match(/^\/topics\/category\/[^\/]/)) {
        this.openTopicCategory(path.slice(17));
      } else if (path.match(/^\/topics\/all\/[^\/]/)) {
        this.openAllTopics(path.slice(12));
      } else if (path.match(/^\/topics\/[^\/]+/)) {
        this.openTopic(path.slice(8), params.get("tab"));
      } else if (path.match(/^\/profile\/.+/)) {
        this.openProfile(path.slice(9), params.get("tab"));
      } else if (path.match(/^\/collections\/.+/) && !path.endsWith("/settings") && !path.endsWith("/new")) {
        this.openCollection(path.slice(13), params.get("tag"));
      } else if (path.match(/^\/translations\/.+/)) {
        var slug = path.slice(14);
        this.openTranslationsPage(slug);
      } else if (sefaria.isRef(path.slice(1))) {
        var currVersions = {
          en: params.get("ven"),
          he: params.get("vhe")
        };
        var options = {
          showHighlight: path.slice(1).indexOf("-") !== -1
        }; // showHighlight when ref is ranged
        openPanel(sefaria.humanRef(path.slice(1)), currVersions, options);
      } else {
        return false;
      }
      return true;
    }
  }, {
    key: "unsetTextHighlight",
    value: function unsetTextHighlight(n) {
      this.setPanelState(n, {
        textHighlights: null
      });
    }
  }, {
    key: "_getSearchStateName",
    value: function _getSearchStateName(type) {
      return "".concat(type, "SearchState");
    }
  }, {
    key: "_getSearchState",
    value: function _getSearchState(state, type) {
      return !!state && state[this._getSearchStateName(type)];
    }
  }, {
    key: "updateQuery",
    value: function updateQuery(n, query) {
      var state = this.state.panels[n];
      var updates = {
        searchQuery: query,
        textSearchState: state.textSearchState.update({
          filtersValid: false
        }),
        sheetSearchState: state.sheetSearchState.update({
          filtersValid: false
        })
      };
      this.setPanelState(n, updates);
    }
  }, {
    key: "updateSearchTab",
    value: function updateSearchTab(n, searchTab) {
      this.setPanelState(n, {
        searchTab: searchTab
      });
    }
  }, {
    key: "updateAvailableFilters",
    value: function updateAvailableFilters(n, type, availableFilters, filterRegistry, orphanFilters, aggregationsToUpdate) {
      var state = this.state.panels[n];
      var searchState = this._getSearchState(state, type);
      var searchStateName = this._getSearchStateName(type);
      this.setPanelState(n, ReaderApp_defineProperty({}, searchStateName, !!searchState ? searchState.update({
        availableFilters: availableFilters,
        filterRegistry: filterRegistry,
        orphanFilters: orphanFilters,
        filtersValid: true,
        aggregationsToUpdate: aggregationsToUpdate
      }) : new sefaria_searchState({
        type: type,
        availableFilters: availableFilters,
        filterRegistry: filterRegistry,
        orphanFilters: orphanFilters,
        filtersValid: true
      })));
    }
  }, {
    key: "updateSearchFilter",
    value: function updateSearchFilter(n, type, searchState, filterNode) {
      var searchStateName = this._getSearchStateName(type);
      if (filterNode.isUnselected()) {
        filterNode.setSelected(true);
      } else {
        filterNode.setUnselected(true);
      }
      var update = sefaria.search.getAppliedSearchFilters(searchState.availableFilters);
      this.setPanelState(n, ReaderApp_defineProperty({}, searchStateName, searchState.update(update)));
    }
  }, {
    key: "updateSearchOptionField",
    value: function updateSearchOptionField(n, type, field) {
      var state = this.state.panels[n];
      var searchState = this._getSearchState(state, type);
      var searchStateName = this._getSearchStateName(type);
      this.setPanelState(n, ReaderApp_defineProperty({}, searchStateName, searchState.update({
        field: field,
        filtersValid: false
      })));
    }
  }, {
    key: "updateSearchOptionSort",
    value: function updateSearchOptionSort(n, type, sortType) {
      var state = this.state.panels[n];
      var searchState = this._getSearchState(state, type);
      var searchStateName = this._getSearchStateName(type);
      this.setPanelState(n, ReaderApp_defineProperty({}, searchStateName, searchState.update({
        sortType: sortType
      })));
    }
  }, {
    key: "setPanelState",
    value: function setPanelState(n, state, replaceHistory) {
      this.replaceHistory = Boolean(replaceHistory);
      //console.log(`setPanel State ${n}, replace: ` + this.replaceHistory);
      //console.log(state)
      // When the driving panel changes language, carry that to the dependent panel
      // However, when carrying a language change to the Tools Panel, do not carry over an incorrect version
      if (!this.state.panels[n]) {
        debugger;
      }
      var langChange = state.settings && state.settings.language !== this.state.panels[n].settings.language;
      var next = this.state.panels[n + 1];
      if (langChange && next && next.mode === "Connections" && state.settings.language !== "bilingual") {
        next.settings.language = state.settings.language;
      }
      // state is not always a full panel state. make sure it has necessary fields needed to run saveLastPlace()
      state = ReaderApp_objectSpread(ReaderApp_objectSpread({}, this.state.panels[n]), state);
      if (this.didPanelRefChange(this.state.panels[n], state)) {
        this.checkPanelScrollIntentAndSaveRecent(state, n);
      }
      this.state.panels[n] = external_extend_default()(this.state.panels[n], state);
      var new_state = {
        panels: this.state.panels
      };
      if (this.didDefaultPanelSettingsChange(state)) {
        new_state["defaultPanelSettings"] = sefaria.util.clone(state.settings);
      }
      this.setState(new_state);
    }
  }, {
    key: "didDefaultPanelSettingsChange",
    value: function didDefaultPanelSettingsChange(state) {
      if ("settings" in state) {
        var defaultSettings = this.getDefaultPanelSettings();
        var defaultKeys = Object.keys(defaultSettings);
        for (var _i = 0, _defaultKeys = defaultKeys; _i < _defaultKeys.length; _i++) {
          var i = _defaultKeys[_i];
          //console.log(i); // logs 3, 5, 7
          if (state.settings[i] != defaultSettings[i]) {
            return true;
          }
        }
      } else {
        return false;
      }
    }
  }, {
    key: "didPanelRefChange",
    value: function didPanelRefChange(prevPanel, nextPanel) {
      // Returns true if nextPanel represents a change in current ref (including version change) from prevPanel.
      if (!prevPanel && !!nextPanel) {
        return true;
      }
      if (!!prevPanel && !nextPanel) {
        return true;
      }
      if (!prevPanel && !nextPanel) {
        return false;
      }
      if (prevPanel.mode === 'Connections' && nextPanel.mode === 'Text') {
        return false;
      } // special case. when opening new panel from commentary, ref is already logged in history
      if (prevPanel.mode === 'Text' && nextPanel.mode === 'Sheet') {
        return true;
      }
      if (prevPanel.mode === 'Sheet' && nextPanel.mode === 'Text') {
        return true;
      }
      if (nextPanel.mode === 'Text') {
        if (nextPanel.menu || nextPanel.mode == "Connections" || !nextPanel.refs || nextPanel.refs.length == 0 || !prevPanel.refs || prevPanel.refs.length == 0) {
          return false;
        }
        if (nextPanel.refs.compare(prevPanel.refs)) {
          if (nextPanel.currVersions.en !== prevPanel.currVersions.en) {
            return true;
          }
          if (nextPanel.currVersions.he !== prevPanel.currVersions.he) {
            return true;
          }
          //console.log('didPanelRefChange?', nextPanel.highlightedRefs, prevPanel.highlightedRefs);
          return !(nextPanel.highlightedRefs || []).compare(prevPanel.highlightedRefs || []);
        } else {
          return true;
        }
      } else if (nextPanel.mode === 'Sheet') {
        if (prevPanel.sheetID !== nextPanel.sheetID) {
          return true;
        }
        return prevPanel.highlightedNode !== nextPanel.highlightedNode;
      } else {
        return true;
      }
    }
  }, {
    key: "_getPanelLangOnVersionChange",
    value: function _getPanelLangOnVersionChange(panel, versionLanguage, isConnectionsPanel) {
      var panelLang;
      if (panel.settings.language === 'bilingual' || !!panel.currVersions["he"] && !!panel.currVersions["en"] || versionLanguage === "he" && panel.settings.language === 'english' || versionLanguage === "en" && panel.settings.language === 'hebrew') {
        // if lang of version isn't visible, display it
        panelLang = "bilingual";
      } else if (versionLanguage === "he") {
        panelLang = "hebrew";
      } else {
        panelLang = "english";
      }
      if (isConnectionsPanel) {
        panelLang = panelLang !== "bilingual" ? panelLang : versionLanguage === "he" ? "hebrew" : "english";
      }
      return panelLang;
    }
  }, {
    key: "_getDependentPanel",
    value: function _getDependentPanel(n) {
      /**
       * Given panel `n`, return dependent panel, if it exists. A dependent panel is the master panel if panel
       * `n` is a connections panel and vice versa if panel `n` is a master panel.
       * Returns null if no dependent panel exists
       **/
      var dependentPanel = null;
      var isDependentPanelConnections = false;
      if (this.state.panels.length > n + 1 && this.state.panels[n + 1].mode === "Connections") {
        dependentPanel = this.state.panels[n + 1];
        isDependentPanelConnections = true;
      } else if (n - 1 >= 0 && this.state.panels[n].mode === "Connections") {
        dependentPanel = this.state.panels[n - 1];
      }
      return {
        dependentPanel: dependentPanel,
        isDependentPanelConnections: isDependentPanelConnections
      };
    }
  }, {
    key: "selectVersion",
    value: function selectVersion(n, versionName, versionLanguage) {
      // Set the version for panel `n`.
      var panel = this.state.panels[n];
      var oRef = sefaria.ref(panel.refs[0]);
      if (versionName && versionLanguage) {
        panel.currVersions[versionLanguage] = versionName;
        this.setCachedVersion(oRef.indexTitle, versionLanguage, versionName);
        sefaria.track.event("Reader", "Choose Version", "".concat(oRef.indexTitle, " / ").concat(versionName, " / ").concat(versionLanguage));
      } else {
        panel.currVersions[versionLanguage] = null;
        sefaria.track.event("Reader", "Choose Version", "".concat(oRef.indexTitle, " / default version / ").concat(panel.settings.language));
      }
      panel.settings.language = this._getPanelLangOnVersionChange(panel, versionLanguage, panel.mode === "Connections");
      var _this$_getDependentPa = this._getDependentPanel(n),
        dependentPanel = _this$_getDependentPa.dependentPanel,
        isDependentPanelConnections = _this$_getDependentPa.isDependentPanelConnections;

      // make sure object reference changes for setState()
      dependentPanel.currVersions = ReaderApp_objectSpread({}, panel.currVersions);
      panel.currVersions = ReaderApp_objectSpread({}, panel.currVersions);
      dependentPanel.settings.language = this._getPanelLangOnVersionChange(dependentPanel, versionLanguage, isDependentPanelConnections);
      this.setState({
        panels: this.state.panels
      });
    }
  }, {
    key: "navigatePanel",
    value: function navigatePanel(n, ref) {
      var currVersions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {
        en: null,
        he: null
      };
      // Sets the ref on panel `n` and cascades to any attached panels (Text + Connections)
      var panel = this.state.panels[n];
      // next few lines adapted from ReaderPanel.showBaseText()
      var refs, currentlyVisibleRef, highlightedRefs;
      if (ref.constructor === Array) {
        // When called with an array, set highlight for the whole spanning range
        refs = ref;
        currentlyVisibleRef = sefaria.humanRef(ref);
        var splitArray = refs.map(function (ref) {
          return sefaria.splitRangingRef(ref);
        });
        highlightedRefs = [].concat.apply([], splitArray);
      } else {
        refs = [ref];
        currentlyVisibleRef = ref;
        highlightedRefs = panel.mode === "TextAndConnections" ? [ref] : [];
      }
      var updatePanelObj = {
        refs: refs,
        currentlyVisibleRef: currentlyVisibleRef,
        highlightedRefs: highlightedRefs
      };
      var _this$_getDependentPa2 = this._getDependentPanel(n),
        dependentPanel = _this$_getDependentPa2.dependentPanel;
      Object.assign(dependentPanel, {
        refs: refs,
        currentlyVisibleRef: currentlyVisibleRef,
        highlightedRefs: highlightedRefs
      });
      Object.assign(panel, updatePanelObj);
      this.setState({
        panels: this.state.panels
      });
    }
  }, {
    key: "viewExtendedNotes",
    value: function viewExtendedNotes(n, method, title, versionLanguage, versionName) {
      var panel = this.state.panels[n];
      panel.bookRef = title;
      panel.currVersions = {
        'en': null,
        'he': null
      }; // ensure only 1 version is set
      panel.currVersions[versionLanguage] = versionName;
      if (method === "toc") {
        panel.menuOpen = "extended notes";
      } else if (method === "Connections") {
        panel.connectionsMode = "extended notes";
      }
      this.setState({
        panels: this.state.panels
      });
    }
  }, {
    key: "backFromExtendedNotes",
    value: function backFromExtendedNotes(n, bookRef, currVersions) {
      var panel = this.state.panels[n];
      panel.menuOpen = panel.currentlyVisibleRef ? "text toc" : "book toc";
      panel.bookRef = bookRef;
      panel.currVersions = currVersions;
      this.setState({
        panels: this.state.panels
      });
    }
    // this.state.defaultVersion is a depth 2 dictionary - keyed: bookname, language
  }, {
    key: "getCachedVersion",
    value: function getCachedVersion(indexTitle, language) {
      if (!indexTitle || !this.state.defaultVersions[indexTitle]) {
        return null;
      }
      return language ? this.state.defaultVersions[indexTitle][language] || null : this.state.defaultVersions[indexTitle];
    }
  }, {
    key: "setCachedVersion",
    value: function setCachedVersion(indexTitle, language, versionTitle) {
      this.state.defaultVersions[indexTitle] = this.state.defaultVersions[indexTitle] || {};
      this.state.defaultVersions[indexTitle][language] = versionTitle; // Does this need a setState?  I think not.
    }
  }, {
    key: "setDefaultOption",
    value: function setDefaultOption(option, value) {
      if (value !== this.state.defaultPanelSettings[option]) {
        this.state.defaultPanelSettings[option] = value;
        this.setState(this.state);
      }
    }
  }, {
    key: "openPanel",
    value: function openPanel(ref, currVersions, options) {
      // Opens a text panel, replacing all panels currently open.
      // options can contain {
      //  'textHighlights': array of strings to highlight in focused segment. used when clicking on search query result
      // }
      this.state.panels = []; // temporarily clear panels directly in state, set properly with setState in openPanelAt
      this.openPanelAt(0, ref, currVersions, options);
    }
  }, {
    key: "openPanelAt",
    value: function openPanelAt(n, ref, currVersions, options, replace) {
      // Open a new panel after `n` with the new ref
      // If `replace`, replace existing panel at `n`, otherwise insert new panel at `n`
      // If book level, Open book toc
      var parsedRef = sefaria.parseRef(ref);
      var index = sefaria.index(ref); // Do we have to worry about normalization, as in Header.subimtSearch()?
      var panel;
      if (index) {
        panel = this.makePanelState({
          "menuOpen": "book toc",
          "bookRef": index.title
        });
      } else if (parsedRef.book === "Sheet") {
        var _parsedRef$sections = ReaderApp_slicedToArray(parsedRef.sections, 2),
          sheetID = _parsedRef$sections[0],
          sheetNode = _parsedRef$sections[1];
        panel = this.makePanelState(ReaderApp_objectSpread({
          mode: 'Sheet',
          sheetID: parseInt(sheetID),
          highlightedNode: parseInt(sheetNode),
          refs: null
        }, options));
      } else {
        // Text
        var refs, currentlyVisibleRef, highlightedRefs;
        if (ref.constructor === Array) {
          // When called with an array, set highlight for the whole spanning range of the array
          refs = ref;
          currentlyVisibleRef = sefaria.normRef(ref);
          var splitArray = refs.map(function (ref) {
            return sefaria.splitRangingRef(ref);
          });
          highlightedRefs = [].concat.apply([], splitArray);
        } else {
          refs = [ref];
          currentlyVisibleRef = ref;
          highlightedRefs = [];
        }
        //console.log("Higlighted refs:", highlightedRefs)
        panel = this.makePanelState(ReaderApp_objectSpread({
          refs: refs,
          currVersions: currVersions,
          highlightedRefs: highlightedRefs,
          currentlyVisibleRef: currentlyVisibleRef,
          mode: "Text"
        }, options));
      }
      var newPanels = this.state.panels.slice();
      newPanels.splice(replace ? n : n + 1, replace ? 1 : 0, panel);
      this.setState({
        panels: newPanels
      });
      this.saveLastPlace(panel, n + 1);
    }
  }, {
    key: "openPanelAtEnd",
    value: function openPanelAtEnd(ref, currVersions) {
      this.openPanelAt(this.state.panels.length + 1, ref, currVersions);
    }
  }, {
    key: "replacePanel",
    value: function replacePanel(n, ref, currVersions, options) {
      // Opens a text in in place of the panel currently open at `n`.
      this.openPanelAt(n, ref, currVersions, options, true);
    }
  }, {
    key: "openComparePanel",
    value: function openComparePanel(n, connectAfter) {
      var comparePanel = this.makePanelState({
        menuOpen: "navigation",
        compare: true,
        openSidebarAsConnect: typeof connectAfter !== "undefined" ? connectAfter : false
      });
      sefaria.track.event("Reader", "Other Text Click");
      this.state.panels[n] = comparePanel;
      this.setState({
        panels: this.state.panels
      });
    }
  }, {
    key: "openTextListAt",
    value: function openTextListAt(n, refs, sheetNodes, textListState) {
      // Open a connections panel at position `n` for `refs`
      // Replace panel there if already a connections panel, otherwise splice new panel into position `n`
      // `refs` is an array of ref strings
      // `textListState` is an object of initial state to pass to the new panel. if `undefined`, no-op
      var newPanels = this.state.panels.slice();
      var panel = newPanels[n] || {};
      var parentPanel = n >= 1 && newPanels[n - 1].mode === 'Text' || n >= 1 && newPanels[n - 1].mode === 'Sheet' ? newPanels[n - 1] : null;
      if (panel.mode !== "Connections") {
        // No connections panel is open yet, splice in a new one
        this.saveLastPlace(parentPanel, n, true);
        newPanels.splice(n, 0, {});
        panel = newPanels[n];
        panel.filter = [];
        panel.versionFilter = [];
      }
      panel.refs = refs;
      panel.sheetNodes = sheetNodes ? sheetNodes.split(".")[1] : null;
      panel.nodeRef = sheetNodes;
      panel.menuOpen = null;
      panel.mode = panel.mode || "Connections";
      panel.settings = panel.settings ? panel.settings : sefaria.util.clone(this.getDefaultPanelSettings());
      panel.settings.language = panel.settings.language === "hebrew" ? "hebrew" : "english"; // Don't let connections panels be bilingual
      if (parentPanel) {
        panel.filter = parentPanel.filter;
        panel.versionFilter = parentPanel.versionFilter;
        panel.connectionsMode = parentPanel.openSidebarAsConnect ? "Add Connection" : panel.connectionsMode;
        panel.recentFilters = parentPanel.recentFilters;
        panel.recentVersionFilters = parentPanel.recentVersionFilters;
        panel.currVersions = parentPanel.currVersions;
      }
      if (textListState) {
        panel = ReaderApp_objectSpread(ReaderApp_objectSpread({}, panel), textListState);
      }
      newPanels[n] = this.makePanelState(panel);
      this.setState({
        panels: newPanels
      });
    }
  }, {
    key: "setTextListHighlight",
    value: function setTextListHighlight(n, refs) {
      // Set the textListHighlight for panel `n` to `refs`
      refs = typeof refs === "string" ? [refs] : refs;
      this.state.panels[n].highlightedRefs = refs;
      this.setState({
        panels: this.state.panels
      });
      // If a connections panel is opened after n, update its refs as well.
      var next = this.state.panels[n + 1];
      if (next && next.mode === "Connections" && !next.menuOpen) {
        this.openTextListAt(n + 1, refs);
      }
    }
  }, {
    key: "setSheetHighlight",
    value: function setSheetHighlight(n, node) {
      // Set the sheetListHighlight for panel `n` to `node`
      node = typeof node === "string" ? [node] : node;
      this.state.panels[n].highlightedNode = node;
      this.state.panels[n].scrollToHighlighted = false;
      this.setState({
        panels: this.state.panels
      });
    }
  }, {
    key: "setDivineNameReplacement",
    value: function setDivineNameReplacement(mode) {
      this.setState({
        divineNameReplacement: mode
      });
    }
  }, {
    key: "setConnectionsFilter",
    value: function setConnectionsFilter(n, filter, updateRecent) {
      // Set the filter for connections panel at `n`, carry data onto the panel's basetext as well.
      var connectionsPanel = this.state.panels[n];
      var basePanel = this.state.panels[n - 1];
      if (filter) {
        if (updateRecent) {
          if (sefaria.util.inArray(filter, connectionsPanel.recentFilters) !== -1) {
            connectionsPanel.recentFilters.toggle(filter);
          }
          connectionsPanel.recentFilters = [filter].concat(connectionsPanel.recentFilters);
        }
        connectionsPanel.filter = [filter];
        var filterAndSuffix = filter.split("|");
        connectionsPanel.connectionsMode = filterAndSuffix.length === 2 && filterAndSuffix[1] === "Essay" ? "EssayList" : "TextList";
      } else {
        connectionsPanel.filter = [];
        connectionsPanel.connectionsMode = "ConnectionsList";
      }
      if (basePanel) {
        basePanel.filter = connectionsPanel.filter;
        basePanel.recentFilters = connectionsPanel.recentFilters;
      }
      this.setState({
        panels: this.state.panels
      });
    }
  }, {
    key: "setSideScrollPosition",
    value: function setSideScrollPosition(n, pos) {
      var connectionsPanel = this.state.panels[n];
      connectionsPanel.sideScrollPosition = pos;
      this.setState({
        panels: this.state.panels
      });
    }
  }, {
    key: "setVersionFilter",
    value: function setVersionFilter(n, filter) {
      var connectionsPanel = this.state.panels[n];
      var basePanel = this.state.panels[n - 1];
      if (filter) {
        if (sefaria.util.inArray(filter, connectionsPanel.recentVersionFilters) === -1) {
          connectionsPanel.recentVersionFilters = [filter].concat(connectionsPanel.recentVersionFilters);
        }
        connectionsPanel.versionFilter = [filter];
        connectionsPanel.connectionsMode = "Translation Open";
      } else {
        connectionsPanel.versionFilter = [];
        connectionsPanel.connectionsMode = "Translations";
      }
      if (basePanel) {
        basePanel.versionFilter = connectionsPanel.versionFilter;
        basePanel.recentVersionFilters = connectionsPanel.recentVersionFilters;
      }
      this.setState({
        panels: this.state.panels
      });
    }
  }, {
    key: "setSelectedWords",
    value: function setSelectedWords(n, words) {
      //console.log(this.state.panels[n].refs);
      var next = this.state.panels[n + 1];
      if (next && !next.menuOpen) {
        this.state.panels[n + 1].selectedWords = words;
        this.setState({
          panels: this.state.panels
        });
      }
    }
  }, {
    key: "setUnreadNotificationsCount",
    value: function setUnreadNotificationsCount(n) {
      sefaria.notificationCount = n;
      this.forceUpdate();
    }
  }, {
    key: "closePanel",
    value: function closePanel(n) {
      // Removes the panel in position `n`, as well as connections panel in position `n+1` if it exists.
      if (this.state.panels.length === 1 && n === 0) {
        this.state.panels = [];
      } else {
        // If this is a Connection panel, we need to unset the filter in the base panel
        if (n > 0 && this.state.panels[n] && this.state.panels[n].mode === "Connections") {
          var parent = this.state.panels[n - 1];
          parent.filter = [];
          parent.highlightedRefs = [];
          parent.refs = parent.refs.map(function (ref) {
            return sefaria.ref(ref).sectionRef;
          });
          parent.currentlyVisibleRef = parent.currentlyVisibleRef ? sefaria.ref(parent.currentlyVisibleRef).sectionRef : null;
        }
        this.state.panels.splice(n, 1);
        if (this.state.panels[n] && (this.state.panels[n].mode === "Connections" || this.state.panels[n].compare)) {
          // Close connections panel or compare panel when text panel is closed
          if (this.state.panels.length === 1) {
            this.state.panels = [];
          } else {
            this.state.panels.splice(n, 1);
          }
        }
      }
      var state = {
        panels: this.state.panels
      };
      if (state.panels.length === 0) {
        this.showLibrary();
      } else {
        this.setState(state);
      }
    }
  }, {
    key: "convertToTextList",
    value: function convertToTextList(n) {
      console.log("convert");
      var base = this.state.panels[n - 1];
      this.closePanel(n);
      if (base.mode == "Sheet") {
        var sheet = sefaria.sheets.loadSheetByID(base.sheetID);
        if (!sheet) {
          return;
        }
        for (var i in sheet.sources) {
          if (sheet.sources[i].node == base.highlightedNode) {
            this.openTextListAt(n, [sheet.sources[i].ref]);
          }
        }
      } else {
        this.openTextListAt(n, base.highlightedRefs);
      }
    }
  }, {
    key: "showLibrary",
    value: function showLibrary(categories) {
      var state = {
        menuOpen: "navigation",
        navigationCategories: categories,
        "mode": "Menu"
      };
      state = this.makePanelState(state);
      if (!sefaria._siteSettings.TORAH_SPECIFIC) {
        state.settings.language = "english";
      }
      this.setSinglePanelState(state);
    }
  }, {
    key: "showSearch",
    value: function showSearch(searchQuery) {
      var panel;
      var textSearchState = !!this.state.panels && this.state.panels.length && !!this.state.panels[0].textSearchState ? this.state.panels[0].textSearchState.update({
        filtersValid: false
      }) : new sefaria_searchState({
        type: 'text'
      });
      var sheetSearchState = !!this.state.panels && this.state.panels.length && !!this.state.panels[0].sheetSearchState ? this.state.panels[0].sheetSearchState.update({
        filtersValid: false
      }) : new sefaria_searchState({
        type: 'sheet'
      });
      var searchTab = !!this.state.panels && this.state.panels.length ? this.state.panels[0].searchTab : "text";
      this.setSinglePanelState({
        mode: "Menu",
        menuOpen: "search",
        searchQuery: searchQuery,
        searchTab: searchTab,
        textSearchState: textSearchState,
        sheetSearchState: sheetSearchState
      });
    }
  }, {
    key: "searchInCollection",
    value: function searchInCollection(searchQuery, collection) {
      var panel;
      var textSearchState = new sefaria_searchState({
        type: 'text'
      });
      var sheetSearchState = new sefaria_searchState({
        type: 'sheet',
        appliedFilters: [collection],
        appliedFilterAggTypes: ['collections']
      });
      this.setSinglePanelState({
        mode: "Menu",
        menuOpen: "search",
        "searchTab": "sheet",
        searchQuery: searchQuery,
        textSearchState: textSearchState,
        sheetSearchState: sheetSearchState
      });
    }
  }, {
    key: "showCommunity",
    value: function showCommunity() {
      this.setSinglePanelState({
        menuOpen: "community"
      });
    }
  }, {
    key: "showSaved",
    value: function showSaved() {
      this.setSinglePanelState({
        menuOpen: "saved"
      });
    }
  }, {
    key: "showHistory",
    value: function showHistory() {
      this.setSinglePanelState({
        menuOpen: "history"
      });
    }
  }, {
    key: "showTopics",
    value: function showTopics() {
      this.setSinglePanelState({
        menuOpen: "topics",
        navigationTopicCategory: null,
        navigationTopic: null
      });
    }
  }, {
    key: "showNotifications",
    value: function showNotifications() {
      this.setSinglePanelState({
        menuOpen: "notifications"
      });
    }
  }, {
    key: "showCalendars",
    value: function showCalendars() {
      this.setSinglePanelState({
        menuOpen: "calendars"
      });
    }
  }, {
    key: "showUserStats",
    value: function showUserStats() {
      this.setSinglePanelState({
        menuOpen: "user_stats"
      });
    }
  }, {
    key: "showCollections",
    value: function showCollections() {
      this.setSinglePanelState({
        menuOpen: "collectionsPublic"
      });
    }
  }, {
    key: "setSinglePanelState",
    value: function setSinglePanelState(state) {
      // Sets state to be a single panel with properties of `state`
      state = this.makePanelState(state);
      this.setState({
        panels: [state],
        headerMode: false
      });
    }
  }, {
    key: "openTopic",
    value: function openTopic(slug) {
      var _this5 = this;
      sefaria.getTopic(slug).then(function (topic) {
        _this5.setSinglePanelState({
          menuOpen: "topics",
          navigationTopic: slug,
          topicTitle: topic.primaryTitle,
          topicTestVersion: _this5.props.topicTestVersion
        });
      });
    }
  }, {
    key: "openTopicCategory",
    value: function openTopicCategory(slug) {
      this.setSinglePanelState({
        menuOpen: "topics",
        navigationTopicCategory: slug,
        navigationTopicTitle: sefaria.topicTocCategoryTitle(slug),
        navigationTopic: null
      });
    }
  }, {
    key: "openAllTopics",
    value: function openAllTopics(letter) {
      this.setSinglePanelState({
        menuOpen: "allTopics",
        navigationTopicLetter: letter
      });
    }
  }, {
    key: "openProfile",
    value: function openProfile(slug, tab) {
      var _this6 = this;
      tab = tab || "sheets";
      sefaria.profileAPI(slug).then(function (profile) {
        _this6.setSinglePanelState({
          menuOpen: "profile",
          profile: profile,
          tab: tab
        });
      });
    }
  }, {
    key: "openCollection",
    value: function openCollection(slug, tag) {
      this.setSinglePanelState({
        menuOpen: "collection",
        collectionSlug: slug,
        collectionTag: tag
      });
    }
  }, {
    key: "openTranslationsPage",
    value: function openTranslationsPage(slug) {
      this.setSinglePanelState({
        menuOpen: "translationsPage",
        translationsSlug: slug
      });
    }
  }, {
    key: "toggleMobileNavMenu",
    value: function toggleMobileNavMenu() {
      this.setState({
        mobileNavMenuOpen: !this.state.mobileNavMenuOpen
      });
    }
  }, {
    key: "toggleLanguageInFirstPanel",
    value: function toggleLanguageInFirstPanel() {
      if (this.state.panels[0].settings.language === "hebrew") {
        this.state.panels[0].settings.language = "english";
      } else {
        this.state.panels[0].settings.language = "hebrew";
      }
      this.setState({
        panels: this.state.panels
      });
    }
  }, {
    key: "getHistoryObject",
    value: function getHistoryObject(panel, hasSidebar) {
      // get rave to send to /api/profile/user_history
      var ref, sheet_owner, sheet_title;
      if (panel.mode === 'Sheet' || panel.mode === "SheetAndConnections") {
        var sheet = sefaria.sheets.loadSheetByID(panel.sheetID);
        if (!sheet) {
          return null;
        }
        ref = "Sheet ".concat(sheet.id).concat(panel.highlightedNode ? ":".concat(panel.highlightedNode) : '');
        sheet_owner = sheet.ownerName;
        sheet_title = sheet.title;
      } else {
        ref = hasSidebar && panel.highlightedRefs && panel.highlightedRefs.length ? sefaria.normRef(panel.highlightedRefs) : panel.currentlyVisibleRef || panel.refs.slice(-1)[0]; // Will currentlyVisibleRef ever not be available?
      }
      // strip APIResult fields from currVersions
      var currVersions = sefaria.util.getCurrVersionsWithoutAPIResultFields(panel.currVersions);
      var parsedRef = sefaria.parseRef(ref);
      if (!ref) {
        debugger;
      }
      return {
        ref: ref,
        versions: currVersions,
        book: parsedRef.book,
        language: panel.settings.language,
        sheet_owner: sheet_owner,
        sheet_title: sheet_title
      };
    }
  }, {
    key: "setTranslationLanguagePreference",
    value: function setTranslationLanguagePreference(lang) {
      var suggested = true;
      if (lang === null) {
        suggested = false;
        sefariaJquery.removeCookie("translation_language_preference", {
          path: "/"
        });
        sefariaJquery.removeCookie("translation_language_preference_suggested", {
          path: "/"
        });
      } else {
        sefariaJquery.cookie("translation_language_preference", lang, {
          path: "/"
        });
        sefariaJquery.cookie("translation_language_preference_suggested", JSON.stringify(1), {
          path: "/"
        });
      }
      sefaria.track.event("Reader", "Set Translation Language Preference", lang);
      sefaria.editProfileAPI({
        settings: {
          translation_language_preference: lang,
          translation_language_preference_suggested: suggested
        }
      });
      this.setState({
        translationLanguagePreference: lang
      });
    }
  }, {
    key: "doesPanelHaveSidebar",
    value: function doesPanelHaveSidebar(n) {
      return this.state.panels.length > n + 1 && this.state.panels[n + 1].mode == "Connections";
    }
  }, {
    key: "saveLastPlace",
    value: function saveLastPlace(panel, n, openingSidebar) {
      //openingSidebar is true when you call `saveLastPlace` at the time you're opening the sidebar. In this case, `doesPanelHaveSidebar` will be false
      var hasSidebar = this.doesPanelHaveSidebar(n) || openingSidebar;
      // if panel is sheet, panel.refs isn't set
      if (panel.mode !== 'Sheet' && !panel.refs.length || panel.mode === 'Connections') {
        return;
      }
      sefaria.saveUserHistory(this.getHistoryObject(panel, hasSidebar));
    }
  }, {
    key: "currentlyConnecting",
    value: function currentlyConnecting() {
      // returns true if there is currently an "Add Connections" Panel open
      for (var i = 0; i < this.state.panels.length; i++) {
        //console.log(this.state.panels[i].connectionsMode)
        if (this.state.panels[i].connectionsMode === "Add Connection") {
          return true;
        }
      }
      return false;
    }
  }, {
    key: "getDisplayString",
    value: function getDisplayString(mode) {
      var learningStatus = ["text toc", "book toc", "sheet meta", "Text", "TextAndConnections", "SheetAndConnections"];
      var topicStatus = ["topicCat", "topic"];
      if (mode.includes("sheet")) {
        return "learning the Sheet";
      } else if (topicStatus.includes(mode)) {
        return "viewing the topic";
      } else if (learningStatus.includes(mode)) {
        return "learning";
      } else {
        return "currently viewing";
      }
    }
  }, {
    key: "generateCurrentlyReading",
    value: function generateCurrentlyReading() {
      var currentHistoryState = this.makeHistoryState();
      var inBeitMidrash = ["navigation", "text toc", "book toc", "sheet meta", "topics", "topic", "topicCat", "Text", "TextAndConnections", "Sheet", "SheetAndConnections"];
      currentHistoryState.title = currentHistoryState.title.match(/[^|]*/)[0];
      if (inBeitMidrash.includes(currentHistoryState.mode)) {
        return {
          title: currentHistoryState.title,
          url: currentHistoryState.url,
          mode: currentHistoryState.mode,
          display: this.getDisplayString(currentHistoryState.mode)
        };
      } else {
        return null;
      }
    }
  }, {
    key: "handlePrint",
    value: function handlePrint(e) {
      gtag("event", "print");
    }
  }, {
    key: "handleGACopyEvents",
    value: function handleGACopyEvents(e, selectedEls, textOnly) {
      var activePanelIndex = e.target.closest('.readerPanel').id.split("-")[1];
      var activePanel = this.state.panels[activePanelIndex];
      var book = activePanel['currentlyVisibleRef'] ? sefaria.parseRef(activePanel['currentlyVisibleRef'])["book"] : null;
      var category = book && sefaria.index(book) ? sefaria.index(book)["primary_category"] : null;
      var params = {
        "length": textOnly.length,
        "panelType": activePanel["menuOpen"] || activePanel["mode"],
        "book": book,
        "category": category
      };
      gtag("event", "copy_text", params);

      // check if selection is spanning or bilingual
      if (book) {
        var selectedEnEls = selectedEls.querySelectorAll('.en');
        var selectedHeEls = selectedEls.querySelectorAll('.he');
        if (selectedEnEls.length > 0 && selectedHeEls.length > 0) {
          gtag("event", "bilingual_copy_text", params);
        }
        if (selectedEnEls.length > 1 || selectedHeEls.length > 1) {
          gtag("event", "spanning_copy_text", params);
        }
      }
    }
  }, {
    key: "handleCopyEvent",
    value: function handleCopyEvent(e) {
      // Custom processing of Copy/Paste
      var tagsToIgnore = ["INPUT", "TEXTAREA"];
      if (tagsToIgnore.includes(e.srcElement.tagName)) {
        // If the selection is from an input or textarea tag, don't do anything special
        return;
      }
      var selection = document.getSelection();
      var closestReaderPanel = this.state.panels.length > 0 && e.target.closest('.readerPanel') || null;
      var textOnly = selection.toString();
      var html = textOnly;
      var selectedEls;
      if (selection.rangeCount) {
        var container = document.createElement("div");
        for (var i = 0, len = selection.rangeCount; i < len; ++i) {
          container.appendChild(selection.getRangeAt(i).cloneContents());
        }

        // Set content direction & add line breaks for each contentSpan
        var contentSpans = container.querySelectorAll(".contentSpan");
        if (closestReaderPanel && !closestReaderPanel.classList.contains('continuous')) {
          contentSpans.forEach(function (el) {
            el.outerHTML = "<div dir=\"".concat(sefaria.hebrew.isHebrew(el.innerText) ? 'rtl' : 'ltr', "\">").concat(el.innerHTML, "</div>");
          });
        }
        if (closestReaderPanel && closestReaderPanel.classList.contains('hebrew')) {
          container.setAttribute('dir', 'rtl');
        }

        // Collapse all nodes with poetry classes. This is needed for specifically pasting into Google Docs in Chrome to work.
        var poetryElsToCollapse = container.querySelectorAll('.poetry');
        poetryElsToCollapse.forEach(function (poetryEl) {
          poetryEl.outerHTML = poetryEl.innerHTML;
        });

        // Remove extra breaks for continuous mode
        if (closestReaderPanel && closestReaderPanel.classList.contains('continuous')) {
          var elsToRemove = container.querySelectorAll("br");
          elsToRemove.forEach(function (el) {
            return el.remove();
          });

          // each of these are divs which by default creates line breaks for various html/txt renderers on paste. We want to collapse them.
          var classesToCollapse = ["segment", "rangeSpan", "segmentText", "contentSpan"];
          classesToCollapse.map(function (cls) {
            var elsToCollapse = container.getElementsByClassName(cls);
            while (elsToCollapse.length > 0) {
              elsToCollapse[0].outerHTML = elsToCollapse[0].innerHTML;
            }
          });
        }

        // These interfere with the copying and pasting of text and users do not want them there. This code removes them.
        var classesToRemove = ["segmentNumber", "linkCount", "clearFix", "footnote-marker"];
        classesToRemove.map(function (cls) {
          var elsToRemove = container.getElementsByClassName(cls);
          while (elsToRemove.length > 0) {
            elsToRemove[0].parentNode.removeChild(elsToRemove[0]);
          }
        });

        // Remove hidden footnotes
        var hiddenFootnotes = container.querySelectorAll(".footnote:not([style*='display: inline'])");
        var _iterator2 = ReaderApp_createForOfIteratorHelper(hiddenFootnotes),
          _step2;
        try {
          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
            var footnote = _step2.value;
            footnote.parentNode.removeChild(footnote);
          }

          // Add footnote marker and appropriate space for open footnotes
        } catch (err) {
          _iterator2.e(err);
        } finally {
          _iterator2.f();
        }
        var footnotes = container.querySelectorAll(".footnote");
        footnotes.forEach(function (el) {
          return el.prepend(" *");
        });

        // Links to Strip
        var linksToStrip = "a.namedEntityLink, a.refLink";
        var elsToStrip = container.querySelectorAll(linksToStrip);
        elsToStrip.forEach(function (el) {
          return el.outerHTML = el.innerText;
        });
        html = container.outerHTML;
        textOnly = sefaria.util.htmlToText(html);
        selectedEls = container;
      }

      // ga tracking
      if (closestReaderPanel) {
        this.handleGACopyEvents(e, selectedEls, textOnly);
      }
      var clipdata = e.clipboardData || window.clipboardData;
      clipdata.setData('text/plain', textOnly);
      clipdata.setData('text/html', html);
      e.preventDefault();
    }
  }, {
    key: "rerender",
    value: function rerender() {
      this.forceUpdate();
      this.setContainerMode();
    }
  }, {
    key: "getUserContext",
    value: function getUserContext() {
      var returnNullIfEmpty = function returnNullIfEmpty(value) {
        if (Array.isArray(value)) {
          if (value.length === 0) {
            return null;
          } else {
            return value;
          }
        }
      };
      var refs = this.state.panels.map(function (panel) {
        return panel.currentlyVisibleRef || panel.bookRef || returnNullIfEmpty(panel.navigationCategories) || panel.navigationTopic;
      }).flat();
      var books = refs.map(function (ref) {
        return sefaria.parseRef(ref).book;
      });
      var triggers = refs.map(function (ref) {
        return sefaria.refCategories(ref);
      }).concat(books).concat(refs).flat().filter(function (ref) {
        return !!ref;
      });
      var deDupedTriggers = ReaderApp_toConsumableArray(new Set(triggers.map(JSON.stringify))).map(JSON.parse).map(function (x) {
        return x.toLowerCase();
      });
      var context = {
        isDebug: this.props._debug,
        isLoggedIn: sefaria._uid,
        interfaceLang: sefaria.interfaceLang,
        dt: sefaria.util.epoch_time(new Date()) * 1000,
        keywordTargets: refs ? deDupedTriggers : []
      };
      return context;
    }
  }, {
    key: "render",
    value: function render() {
      var _this$state$panels, _this$state$panels$, _this$state$panels2, _this$state$panels2$, _this$state$panels3, _this$state$panels3$, _this$state$panels3$$;
      var panelStates = this.state.panels;
      var evenWidth;
      var widths;
      var unit;
      var wrapBoxScroll = false;
      if (panelStates.length <= this.state.panelCap || !this.state.panelCap) {
        evenWidth = 100.0 / panelStates.length;
        unit = "%";
      } else {
        evenWidth = this.MIN_PANEL_WIDTH;
        unit = "px";
        wrapBoxScroll = true;
      }
      if (panelStates.length === 2 && (panelStates[0].mode === "Text" || panelStates[0].mode === "Sheet") && (panelStates[1].mode === "Connections" || panelStates[1].menuOpen === "search" || panelStates[1].compare)) {
        widths = [68.0, 32.0];
        unit = "%";
      } else if (panelStates.length === 3 && (panelStates[0].mode === "Text" || panelStates[0].mode === "Sheet") && panelStates[1].mode === "Connections" && (panelStates[2].mode === "Text" || panelStates[2].mode === "Sheet")) {
        widths = [37.0, 26.0, 37.0];
        unit = "%";
      } else if (panelStates.length === 3 && (panelStates[0].mode === "Text" || panelStates[0].mode === "Sheet") && (panelStates[1].mode === "Text" || panelStates[1].mode === "Sheet") && panelStates[2].mode === "Connections") {
        widths = [37.0, 37.0, 26.0];
        unit = "%";
      } else {
        widths = panelStates.map(function (panel) {
          return evenWidth;
        });
      }

      // Header should not show box-shadow over panels that have color line
      var menuOpen = (_this$state$panels = this.state.panels) === null || _this$state$panels === void 0 ? void 0 : (_this$state$panels$ = _this$state$panels[0]) === null || _this$state$panels$ === void 0 ? void 0 : _this$state$panels$.menuOpen;
      var hasColorLine = [null, "book toc", "sheets", "sheets meta"];
      var headerHasBoxShadow = hasColorLine.indexOf(menuOpen) === -1 || !this.props.multiPanel;
      // Header is hidden on certain mobile panels, but still rendered so the mobileNavMenu can be opened
      var hideHeader = !this.props.multiPanel && !this.state.headerMode && (!menuOpen || menuOpen === "text toc");
      var header = /*#__PURE__*/external_react_default().createElement(js_Header, {
        multiPanel: this.props.multiPanel,
        onRefClick: this.handleNavigationClick,
        showSearch: this.showSearch,
        openURL: this.openURL,
        headerMode: this.props.headerMode,
        openTopic: this.openTopic,
        hidden: hideHeader,
        mobileNavMenuOpen: this.state.mobileNavMenuOpen,
        onMobileMenuButtonClick: this.toggleMobileNavMenu,
        hasLanguageToggle: !this.props.multiPanel && sefaria.interfaceLang !== "hebrew" && ((_this$state$panels2 = this.state.panels) === null || _this$state$panels2 === void 0 ? void 0 : (_this$state$panels2$ = _this$state$panels2[0]) === null || _this$state$panels2$ === void 0 ? void 0 : _this$state$panels2$.menuOpen) === "navigation",
        toggleLanguage: this.toggleLanguageInFirstPanel,
        firstPanelLanguage: (_this$state$panels3 = this.state.panels) === null || _this$state$panels3 === void 0 ? void 0 : (_this$state$panels3$ = _this$state$panels3[0]) === null || _this$state$panels3$ === void 0 ? void 0 : (_this$state$panels3$$ = _this$state$panels3$.settings) === null || _this$state$panels3$$ === void 0 ? void 0 : _this$state$panels3$$.language,
        hasBoxShadow: headerHasBoxShadow,
        translationLanguagePreference: this.state.translationLanguagePreference,
        setTranslationLanguagePreference: this.setTranslationLanguagePreference
      });
      var panels = [];
      var allOpenRefs = panelStates.filter(function (panel) {
        return panel.mode == "Text" && !panel.menuOpen;
      }).map(function (panel) {
        return sefaria.humanRef(panel.highlightedRefs.length ? panel.highlightedRefs : panel.refs);
      });
      for (var i = 0; i < panelStates.length; i++) {
        var panel = this.clonePanel(panelStates[i]);
        if (!("settings" in panel)) {
          debugger;
        }
        var offset = widths.reduce(function (prev, curr, index, arr) {
          return index < i ? prev + curr : prev;
        }, 0);
        var width = widths[i];
        var style = this.state.layoutOrientation == "ltr" ? {
          width: width + unit,
          left: offset + unit
        } : {
          width: width + unit,
          right: offset + unit
        };
        var onSegmentClick = this.props.multiPanel ? this.handleSegmentClick.bind(null, i) : null;
        var onCitationClick = this.handleCitationClick.bind(null, i);
        var openNamedEntityInNewPanel = this.openNamedEntityInNewPanel.bind(null, i);
        var onCloseConnectionClick = this.closeConnectionPanel.bind(null, i);
        var closeNamedEntityInConnectionPanel = this.closeNamedEntityInConnectionPanel.bind(null, i);
        var onSearchResultClick = i > 0 ? this.handleCompareSearchClick.bind(null, i) : this.handleNavigationClick;
        var onSidebarSearchClick = this.handleSidebarSearchClick.bind(null, i);
        var unsetTextHighlight = this.unsetTextHighlight.bind(null, i);
        var updateQuery = this.updateQuery.bind(null, i);
        var updateSearchTab = this.updateSearchTab.bind(null, i);
        var updateAvailableFilters = this.updateAvailableFilters.bind(null, i);
        var updateSearchFilter = this.updateSearchFilter.bind(null, i);
        var updateSearchOptionField = this.updateSearchOptionField.bind(null, i);
        var updateSearchOptionSort = this.updateSearchOptionSort.bind(null, i);
        var onOpenConnectionsClick = this.openTextListAt.bind(null, i + 1);
        var setTextListHighlight = this.setTextListHighlight.bind(null, i);
        var setSelectedWords = this.setSelectedWords.bind(null, i);
        var clearSelectedWords = this.clearSelectedWords.bind(null, i);
        var clearNamedEntity = this.clearNamedEntity.bind(null, i);
        var setSidebarSearchQuery = this.setSidebarSearchQuery.bind(null, i);
        var openComparePanel = this.openComparePanel.bind(null, i);
        var closePanel = panel.compare ? this.convertToTextList.bind(null, i) : this.closePanel.bind(null, i);
        var setPanelState = this.setPanelState.bind(null, i);
        var setConnectionsFilter = this.setConnectionsFilter.bind(this, i);
        var setSideScrollPosition = this.setSideScrollPosition.bind(this, i);
        var setVersionFilter = this.setVersionFilter.bind(this, i);
        var selectVersion = this.selectVersion.bind(null, i);
        var viewExtendedNotes = this.viewExtendedNotes.bind(this, i);
        var backFromExtendedNotes = this.backFromExtendedNotes.bind(this, i);
        var navigatePanel = this.navigatePanel.bind(null, i);
        var ref = panel.refs && panel.refs.length ? panel.refs[0] : null;
        var oref = ref ? sefaria.parseRef(ref) : null;
        var title = oref && oref.indexTitle ? oref.indexTitle : 0;
        // Keys must be constant as text scrolls, but changing as new panels open in new positions
        // Use a combination of the panel number and text title
        var key = i + title;
        var classes = external_classnames_default()({
          readerPanelBox: 1,
          sidebar: panel.mode == "Connections"
        });
        panels.push( /*#__PURE__*/external_react_default().createElement("div", {
          className: classes,
          style: style,
          key: key
        }, /*#__PURE__*/external_react_default().createElement(js_ReaderPanel, {
          panelPosition: i,
          initialState: panel,
          interfaceLang: this.props.interfaceLang,
          setCentralState: setPanelState,
          multiPanel: this.props.multiPanel,
          onSegmentClick: onSegmentClick,
          onCitationClick: onCitationClick,
          openNamedEntityInNewPanel: openNamedEntityInNewPanel,
          closeConnectionPanel: onCloseConnectionClick,
          closeNamedEntityInConnectionPanel: closeNamedEntityInConnectionPanel,
          onSearchResultClick: onSearchResultClick,
          onSidebarSearchClick: onSidebarSearchClick,
          onNavigationClick: this.handleNavigationClick,
          onOpenConnectionsClick: onOpenConnectionsClick,
          openComparePanel: openComparePanel,
          setTextListHighlight: setTextListHighlight,
          setConnectionsFilter: setConnectionsFilter,
          setSideScrollPosition: setSideScrollPosition,
          setVersionFilter: setVersionFilter,
          setSelectedWords: setSelectedWords,
          selectVersion: selectVersion,
          viewExtendedNotes: viewExtendedNotes,
          backFromExtendedNotes: backFromExtendedNotes,
          setDefaultOption: this.setDefaultOption,
          unsetTextHighlight: unsetTextHighlight,
          onQueryChange: updateQuery,
          updateSearchTab: updateSearchTab,
          updateSearchFilter: updateSearchFilter,
          updateSearchOptionField: updateSearchOptionField,
          updateSearchOptionSort: updateSearchOptionSort,
          registerAvailableFilters: updateAvailableFilters,
          searchInCollection: this.searchInCollection,
          setUnreadNotificationsCount: this.setUnreadNotificationsCount,
          closePanel: closePanel,
          panelsOpen: panelStates.length,
          allOpenRefs: allOpenRefs,
          hasSidebar: this.doesPanelHaveSidebar(i),
          masterPanelLanguage: panel.mode === "Connections" ? panelStates[i - 1].settings.language : panel.settings.language,
          masterPanelMode: panel.mode === "Connections" ? panelStates[i - 1].mode : null,
          masterPanelSheetId: panel.mode === "Connections" ? panelStates[i - 1].sheetID : null,
          layoutWidth: width,
          analyticsInitialized: this.state.initialAnalyticsTracked,
          saveLastPlace: this.saveLastPlace,
          checkIntentTimer: this.checkIntentTimer,
          openMobileNavMenu: this.toggleMobileNavMenu,
          toggleSignUpModal: this.toggleSignUpModal,
          getHistoryObject: this.getHistoryObject,
          clearSelectedWords: clearSelectedWords,
          clearNamedEntity: clearNamedEntity,
          setSidebarSearchQuery: setSidebarSearchQuery,
          translationLanguagePreference: this.state.translationLanguagePreference,
          setTranslationLanguagePreference: this.setTranslationLanguagePreference,
          navigatePanel: navigatePanel,
          divineNameReplacement: this.state.divineNameReplacement,
          setDivineNameReplacement: this.setDivineNameReplacement,
          topicTestVersion: this.props.topicTestVersion
        })));
      }
      var boxClasses = external_classnames_default()({
        wrapBoxScroll: wrapBoxScroll
      });
      var boxWidth = wrapBoxScroll ? this.state.windowWidth + "px" : "100%";
      var boxStyle = this.state.beitMidrashStatus ? {
        width: "calc(".concat(boxWidth, " - 330px)")
      } : {
        width: boxWidth
      };
      panels = panels.length ? /*#__PURE__*/external_react_default().createElement("div", {
        id: "panelWrapBox",
        className: boxClasses,
        style: boxStyle
      }, panels) : null;
      var interruptingMessage = sefaria.interruptingMessage ? /*#__PURE__*/external_react_default().createElement(InterruptingMessage, {
        messageName: sefaria.interruptingMessage.name,
        messageHTML: sefaria.interruptingMessage.html,
        style: sefaria.interruptingMessage.style,
        repetition: sefaria.interruptingMessage.repetition,
        onClose: this.rerender
      }) : /*#__PURE__*/external_react_default().createElement(Promotions, {
        rerender: this.rerender,
        adType: "banner"
      });
      var sefariaModal = /*#__PURE__*/external_react_default().createElement(SignUpModal, {
        onClose: this.toggleSignUpModal,
        show: this.state.showSignUpModal,
        modalContentKind: this.state.modalContentKind
      });
      var communityPagePreviewControls = this.props.communityPreview ? /*#__PURE__*/external_react_default().createElement(CommunityPagePreviewControls, {
        date: this.props.communityPreview
      }) : null;
      var classDict = {
        readerApp: 1,
        multiPanel: this.props.multiPanel,
        singlePanel: !this.props.multiPanel
      };
      var interfaceLangClass = "interface-".concat(this.props.interfaceLang);
      classDict[interfaceLangClass] = true;
      var classes = external_classnames_default()(classDict);
      return /*#__PURE__*/external_react_default().createElement(AdContext.Provider, {
        value: this.getUserContext()
      }, /*#__PURE__*/external_react_default().createElement("div", {
        id: "readerAppWrap"
      }, interruptingMessage, /*#__PURE__*/external_react_default().createElement("div", {
        className: classes,
        onClick: this.handleInAppLinkClick
      }, header, panels, sefariaModal, communityPagePreviewControls, /*#__PURE__*/external_react_default().createElement(CookiesNotification, null))));
    }
  }]);
  return ReaderApp;
}((external_react_class_default()));
ReaderApp.propTypes = {
  multiPanel: (external_prop_types_default()).bool,
  headerMode: (external_prop_types_default()).bool,
  // is the App serving only as a header on top of another page?
  interfaceLang: (external_prop_types_default()).string,
  initialRefs: (external_prop_types_default()).array,
  initialFilter: (external_prop_types_default()).array,
  initialMenu: (external_prop_types_default()).string,
  initialCollection: (external_prop_types_default()).string,
  initialQuery: (external_prop_types_default()).string,
  initialTextSearchFilters: (external_prop_types_default()).array,
  initialTextSearchField: (external_prop_types_default()).string,
  initialTextSearchSortType: (external_prop_types_default()).string,
  initialSheetSearchFilters: (external_prop_types_default()).array,
  initialSheetSearchField: (external_prop_types_default()).string,
  initialSheetSearchSortType: (external_prop_types_default()).string,
  initialTopic: (external_prop_types_default()).string,
  initialProfile: (external_prop_types_default()).object,
  initialNavigationCategories: (external_prop_types_default()).array,
  initialSettings: (external_prop_types_default()).object,
  initialPanels: (external_prop_types_default()).array,
  initialDefaultVersions: (external_prop_types_default()).object,
  initialPath: (external_prop_types_default()).string,
  initialPanelCap: (external_prop_types_default()).number,
  topicTestVersion: (external_prop_types_default()).string
};
ReaderApp.defaultProps = {
  multiPanel: true,
  headerMode: false,
  // is the App serving only as a header on top of another page?
  interfaceLang: "english",
  initialRefs: [],
  initialFilter: null,
  initialMenu: null,
  initialCollection: null,
  initialQuery: null,
  initialTopic: null,
  initialProfile: null,
  initialNavigationCategories: [],
  initialPanels: [],
  initialDefaultVersions: {},
  initialPanelCap: 2,
  initialPath: "/",
  topicTestVersion: null
};
var sefariaSetup = sefaria.setup;
var unpackDataFromProps = sefaria.unpackDataFromProps,
  loadServerData = sefaria.loadServerData;


/***/ }),

/***/ "../static/js/lib/d3.v5.min.js":
/*!*************************************!*\
  !*** ../static/js/lib/d3.v5.min.js ***!
  \*************************************/
/***/ (function(module, exports) {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }
// https://d3js.org v5.9.7 Copyright 2019 Mike Bostock
!function (t, n) {
  "object" == ( false ? 0 : _typeof(exports)) && "undefined" != "object" ? n(exports) :  true ? !(__WEBPACK_AMD_DEFINE_ARRAY__ = [exports], __WEBPACK_AMD_DEFINE_FACTORY__ = (n),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : 0;
}(this, function (t) {
  "use strict";

  function n(t, n) {
    return t < n ? -1 : t > n ? 1 : t >= n ? 0 : NaN;
  }
  function e(t) {
    var e;
    return 1 === t.length && (e = t, t = function t(_t2, r) {
      return n(e(_t2), r);
    }), {
      left: function left(n, e, r, i) {
        for (null == r && (r = 0), null == i && (i = n.length); r < i;) {
          var o = r + i >>> 1;
          t(n[o], e) < 0 ? r = o + 1 : i = o;
        }
        return r;
      },
      right: function right(n, e, r, i) {
        for (null == r && (r = 0), null == i && (i = n.length); r < i;) {
          var o = r + i >>> 1;
          t(n[o], e) > 0 ? i = o : r = o + 1;
        }
        return r;
      }
    };
  }
  var r = e(n),
    i = r.right,
    o = r.left;
  function a(t, n) {
    return [t, n];
  }
  function u(t) {
    return null === t ? NaN : +t;
  }
  function c(t, n) {
    var e,
      r,
      i = t.length,
      o = 0,
      a = -1,
      c = 0,
      f = 0;
    if (null == n) for (; ++a < i;) isNaN(e = u(t[a])) || (f += (r = e - c) * (e - (c += r / ++o)));else for (; ++a < i;) isNaN(e = u(n(t[a], a, t))) || (f += (r = e - c) * (e - (c += r / ++o)));
    if (o > 1) return f / (o - 1);
  }
  function f(t, n) {
    var e = c(t, n);
    return e ? Math.sqrt(e) : e;
  }
  function s(t, n) {
    var e,
      r,
      i,
      o = t.length,
      a = -1;
    if (null == n) {
      for (; ++a < o;) if (null != (e = t[a]) && e >= e) for (r = i = e; ++a < o;) null != (e = t[a]) && (r > e && (r = e), i < e && (i = e));
    } else for (; ++a < o;) if (null != (e = n(t[a], a, t)) && e >= e) for (r = i = e; ++a < o;) null != (e = n(t[a], a, t)) && (r > e && (r = e), i < e && (i = e));
    return [r, i];
  }
  var l = Array.prototype,
    h = l.slice,
    d = l.map;
  function p(t) {
    return function () {
      return t;
    };
  }
  function v(t) {
    return t;
  }
  function g(t, n, e) {
    t = +t, n = +n, e = (i = arguments.length) < 2 ? (n = t, t = 0, 1) : i < 3 ? 1 : +e;
    for (var r = -1, i = 0 | Math.max(0, Math.ceil((n - t) / e)), o = new Array(i); ++r < i;) o[r] = t + r * e;
    return o;
  }
  var y = Math.sqrt(50),
    _ = Math.sqrt(10),
    b = Math.sqrt(2);
  function m(t, n, e) {
    var r,
      i,
      o,
      a,
      u = -1;
    if (e = +e, (t = +t) === (n = +n) && e > 0) return [t];
    if ((r = n < t) && (i = t, t = n, n = i), 0 === (a = x(t, n, e)) || !isFinite(a)) return [];
    if (a > 0) for (t = Math.ceil(t / a), n = Math.floor(n / a), o = new Array(i = Math.ceil(n - t + 1)); ++u < i;) o[u] = (t + u) * a;else for (t = Math.floor(t * a), n = Math.ceil(n * a), o = new Array(i = Math.ceil(t - n + 1)); ++u < i;) o[u] = (t - u) / a;
    return r && o.reverse(), o;
  }
  function x(t, n, e) {
    var r = (n - t) / Math.max(0, e),
      i = Math.floor(Math.log(r) / Math.LN10),
      o = r / Math.pow(10, i);
    return i >= 0 ? (o >= y ? 10 : o >= _ ? 5 : o >= b ? 2 : 1) * Math.pow(10, i) : -Math.pow(10, -i) / (o >= y ? 10 : o >= _ ? 5 : o >= b ? 2 : 1);
  }
  function w(t, n, e) {
    var r = Math.abs(n - t) / Math.max(0, e),
      i = Math.pow(10, Math.floor(Math.log(r) / Math.LN10)),
      o = r / i;
    return o >= y ? i *= 10 : o >= _ ? i *= 5 : o >= b && (i *= 2), n < t ? -i : i;
  }
  function M(t) {
    return Math.ceil(Math.log(t.length) / Math.LN2) + 1;
  }
  function N(t, n, e) {
    if (null == e && (e = u), r = t.length) {
      if ((n = +n) <= 0 || r < 2) return +e(t[0], 0, t);
      if (n >= 1) return +e(t[r - 1], r - 1, t);
      var r,
        i = (r - 1) * n,
        o = Math.floor(i),
        a = +e(t[o], o, t);
      return a + (+e(t[o + 1], o + 1, t) - a) * (i - o);
    }
  }
  function A(t, n) {
    var e,
      r,
      i = t.length,
      o = -1;
    if (null == n) {
      for (; ++o < i;) if (null != (e = t[o]) && e >= e) for (r = e; ++o < i;) null != (e = t[o]) && e > r && (r = e);
    } else for (; ++o < i;) if (null != (e = n(t[o], o, t)) && e >= e) for (r = e; ++o < i;) null != (e = n(t[o], o, t)) && e > r && (r = e);
    return r;
  }
  function T(t) {
    for (var n, e, r, i = t.length, o = -1, a = 0; ++o < i;) a += t[o].length;
    for (e = new Array(a); --i >= 0;) for (n = (r = t[i]).length; --n >= 0;) e[--a] = r[n];
    return e;
  }
  function S(t, n) {
    var e,
      r,
      i = t.length,
      o = -1;
    if (null == n) {
      for (; ++o < i;) if (null != (e = t[o]) && e >= e) for (r = e; ++o < i;) null != (e = t[o]) && r > e && (r = e);
    } else for (; ++o < i;) if (null != (e = n(t[o], o, t)) && e >= e) for (r = e; ++o < i;) null != (e = n(t[o], o, t)) && r > e && (r = e);
    return r;
  }
  function k(t) {
    if (!(i = t.length)) return [];
    for (var n = -1, e = S(t, E), r = new Array(e); ++n < e;) for (var i, o = -1, a = r[n] = new Array(i); ++o < i;) a[o] = t[o][n];
    return r;
  }
  function E(t) {
    return t.length;
  }
  var C = Array.prototype.slice;
  function P(t) {
    return t;
  }
  var z = 1,
    R = 2,
    D = 3,
    q = 4,
    L = 1e-6;
  function U(t) {
    return "translate(" + (t + .5) + ",0)";
  }
  function O(t) {
    return "translate(0," + (t + .5) + ")";
  }
  function B() {
    return !this.__axis;
  }
  function Y(t, n) {
    var e = [],
      r = null,
      i = null,
      o = 6,
      a = 6,
      u = 3,
      c = t === z || t === q ? -1 : 1,
      f = t === q || t === R ? "x" : "y",
      s = t === z || t === D ? U : O;
    function l(l) {
      var h = null == r ? n.ticks ? n.ticks.apply(n, e) : n.domain() : r,
        d = null == i ? n.tickFormat ? n.tickFormat.apply(n, e) : P : i,
        p = Math.max(o, 0) + u,
        v = n.range(),
        g = +v[0] + .5,
        y = +v[v.length - 1] + .5,
        _ = (n.bandwidth ? function (t) {
          var n = Math.max(0, t.bandwidth() - 1) / 2;
          return t.round() && (n = Math.round(n)), function (e) {
            return +t(e) + n;
          };
        } : function (t) {
          return function (n) {
            return +t(n);
          };
        })(n.copy()),
        b = l.selection ? l.selection() : l,
        m = b.selectAll(".domain").data([null]),
        x = b.selectAll(".tick").data(h, n).order(),
        w = x.exit(),
        M = x.enter().append("g").attr("class", "tick"),
        N = x.select("line"),
        A = x.select("text");
      m = m.merge(m.enter().insert("path", ".tick").attr("class", "domain").attr("stroke", "currentColor")), x = x.merge(M), N = N.merge(M.append("line").attr("stroke", "currentColor").attr(f + "2", c * o)), A = A.merge(M.append("text").attr("fill", "currentColor").attr(f, c * p).attr("dy", t === z ? "0em" : t === D ? "0.71em" : "0.32em")), l !== b && (m = m.transition(l), x = x.transition(l), N = N.transition(l), A = A.transition(l), w = w.transition(l).attr("opacity", L).attr("transform", function (t) {
        return isFinite(t = _(t)) ? s(t) : this.getAttribute("transform");
      }), M.attr("opacity", L).attr("transform", function (t) {
        var n = this.parentNode.__axis;
        return s(n && isFinite(n = n(t)) ? n : _(t));
      })), w.remove(), m.attr("d", t === q || t == R ? a ? "M" + c * a + "," + g + "H0.5V" + y + "H" + c * a : "M0.5," + g + "V" + y : a ? "M" + g + "," + c * a + "V0.5H" + y + "V" + c * a : "M" + g + ",0.5H" + y), x.attr("opacity", 1).attr("transform", function (t) {
        return s(_(t));
      }), N.attr(f + "2", c * o), A.attr(f, c * p).text(d), b.filter(B).attr("fill", "none").attr("font-size", 10).attr("font-family", "sans-serif").attr("text-anchor", t === R ? "start" : t === q ? "end" : "middle"), b.each(function () {
        this.__axis = _;
      });
    }
    return l.scale = function (t) {
      return arguments.length ? (n = t, l) : n;
    }, l.ticks = function () {
      return e = C.call(arguments), l;
    }, l.tickArguments = function (t) {
      return arguments.length ? (e = null == t ? [] : C.call(t), l) : e.slice();
    }, l.tickValues = function (t) {
      return arguments.length ? (r = null == t ? null : C.call(t), l) : r && r.slice();
    }, l.tickFormat = function (t) {
      return arguments.length ? (i = t, l) : i;
    }, l.tickSize = function (t) {
      return arguments.length ? (o = a = +t, l) : o;
    }, l.tickSizeInner = function (t) {
      return arguments.length ? (o = +t, l) : o;
    }, l.tickSizeOuter = function (t) {
      return arguments.length ? (a = +t, l) : a;
    }, l.tickPadding = function (t) {
      return arguments.length ? (u = +t, l) : u;
    }, l;
  }
  var F = {
    value: function value() {}
  };
  function I() {
    for (var t, n = 0, e = arguments.length, r = {}; n < e; ++n) {
      if (!(t = arguments[n] + "") || t in r) throw new Error("illegal type: " + t);
      r[t] = [];
    }
    return new j(r);
  }
  function j(t) {
    this._ = t;
  }
  function H(t, n) {
    for (var e, r = 0, i = t.length; r < i; ++r) if ((e = t[r]).name === n) return e.value;
  }
  function X(t, n, e) {
    for (var r = 0, i = t.length; r < i; ++r) if (t[r].name === n) {
      t[r] = F, t = t.slice(0, r).concat(t.slice(r + 1));
      break;
    }
    return null != e && t.push({
      name: n,
      value: e
    }), t;
  }
  j.prototype = I.prototype = {
    constructor: j,
    on: function on(t, n) {
      var e,
        r,
        i = this._,
        o = (r = i, (t + "").trim().split(/^|\s+/).map(function (t) {
          var n = "",
            e = t.indexOf(".");
          if (e >= 0 && (n = t.slice(e + 1), t = t.slice(0, e)), t && !r.hasOwnProperty(t)) throw new Error("unknown type: " + t);
          return {
            type: t,
            name: n
          };
        })),
        a = -1,
        u = o.length;
      if (!(arguments.length < 2)) {
        if (null != n && "function" != typeof n) throw new Error("invalid callback: " + n);
        for (; ++a < u;) if (e = (t = o[a]).type) i[e] = X(i[e], t.name, n);else if (null == n) for (e in i) i[e] = X(i[e], t.name, null);
        return this;
      }
      for (; ++a < u;) if ((e = (t = o[a]).type) && (e = H(i[e], t.name))) return e;
    },
    copy: function copy() {
      var t = {},
        n = this._;
      for (var e in n) t[e] = n[e].slice();
      return new j(t);
    },
    call: function call(t, n) {
      if ((e = arguments.length - 2) > 0) for (var e, r, i = new Array(e), o = 0; o < e; ++o) i[o] = arguments[o + 2];
      if (!this._.hasOwnProperty(t)) throw new Error("unknown type: " + t);
      for (o = 0, e = (r = this._[t]).length; o < e; ++o) r[o].value.apply(n, i);
    },
    apply: function apply(t, n, e) {
      if (!this._.hasOwnProperty(t)) throw new Error("unknown type: " + t);
      for (var r = this._[t], i = 0, o = r.length; i < o; ++i) r[i].value.apply(n, e);
    }
  };
  var G = "http://www.w3.org/1999/xhtml",
    V = {
      svg: "http://www.w3.org/2000/svg",
      xhtml: G,
      xlink: "http://www.w3.org/1999/xlink",
      xml: "http://www.w3.org/XML/1998/namespace",
      xmlns: "http://www.w3.org/2000/xmlns/"
    };
  function $(t) {
    var n = t += "",
      e = n.indexOf(":");
    return e >= 0 && "xmlns" !== (n = t.slice(0, e)) && (t = t.slice(e + 1)), V.hasOwnProperty(n) ? {
      space: V[n],
      local: t
    } : t;
  }
  function W(t) {
    var n = $(t);
    return (n.local ? function (t) {
      return function () {
        return this.ownerDocument.createElementNS(t.space, t.local);
      };
    } : function (t) {
      return function () {
        var n = this.ownerDocument,
          e = this.namespaceURI;
        return e === G && n.documentElement.namespaceURI === G ? n.createElement(t) : n.createElementNS(e, t);
      };
    })(n);
  }
  function Z() {}
  function Q(t) {
    return null == t ? Z : function () {
      return this.querySelector(t);
    };
  }
  function J() {
    return [];
  }
  function K(t) {
    return null == t ? J : function () {
      return this.querySelectorAll(t);
    };
  }
  function tt(t) {
    return function () {
      return this.matches(t);
    };
  }
  function nt(t) {
    return new Array(t.length);
  }
  function et(t, n) {
    this.ownerDocument = t.ownerDocument, this.namespaceURI = t.namespaceURI, this._next = null, this._parent = t, this.__data__ = n;
  }
  et.prototype = {
    constructor: et,
    appendChild: function appendChild(t) {
      return this._parent.insertBefore(t, this._next);
    },
    insertBefore: function insertBefore(t, n) {
      return this._parent.insertBefore(t, n);
    },
    querySelector: function querySelector(t) {
      return this._parent.querySelector(t);
    },
    querySelectorAll: function querySelectorAll(t) {
      return this._parent.querySelectorAll(t);
    }
  };
  var rt = "$";
  function it(t, n, e, r, i, o) {
    for (var a, u = 0, c = n.length, f = o.length; u < f; ++u) (a = n[u]) ? (a.__data__ = o[u], r[u] = a) : e[u] = new et(t, o[u]);
    for (; u < c; ++u) (a = n[u]) && (i[u] = a);
  }
  function ot(t, n, e, r, i, o, a) {
    var u,
      c,
      f,
      s = {},
      l = n.length,
      h = o.length,
      d = new Array(l);
    for (u = 0; u < l; ++u) (c = n[u]) && (d[u] = f = rt + a.call(c, c.__data__, u, n), f in s ? i[u] = c : s[f] = c);
    for (u = 0; u < h; ++u) (c = s[f = rt + a.call(t, o[u], u, o)]) ? (r[u] = c, c.__data__ = o[u], s[f] = null) : e[u] = new et(t, o[u]);
    for (u = 0; u < l; ++u) (c = n[u]) && s[d[u]] === c && (i[u] = c);
  }
  function at(t, n) {
    return t < n ? -1 : t > n ? 1 : t >= n ? 0 : NaN;
  }
  function ut(t) {
    return t.ownerDocument && t.ownerDocument.defaultView || t.document && t || t.defaultView;
  }
  function ct(t, n) {
    return t.style.getPropertyValue(n) || ut(t).getComputedStyle(t, null).getPropertyValue(n);
  }
  function ft(t) {
    return t.trim().split(/^|\s+/);
  }
  function st(t) {
    return t.classList || new lt(t);
  }
  function lt(t) {
    this._node = t, this._names = ft(t.getAttribute("class") || "");
  }
  function ht(t, n) {
    for (var e = st(t), r = -1, i = n.length; ++r < i;) e.add(n[r]);
  }
  function dt(t, n) {
    for (var e = st(t), r = -1, i = n.length; ++r < i;) e.remove(n[r]);
  }
  function pt() {
    this.textContent = "";
  }
  function vt() {
    this.innerHTML = "";
  }
  function gt() {
    this.nextSibling && this.parentNode.appendChild(this);
  }
  function yt() {
    this.previousSibling && this.parentNode.insertBefore(this, this.parentNode.firstChild);
  }
  function _t() {
    return null;
  }
  function bt() {
    var t = this.parentNode;
    t && t.removeChild(this);
  }
  function mt() {
    return this.parentNode.insertBefore(this.cloneNode(!1), this.nextSibling);
  }
  function xt() {
    return this.parentNode.insertBefore(this.cloneNode(!0), this.nextSibling);
  }
  lt.prototype = {
    add: function add(t) {
      this._names.indexOf(t) < 0 && (this._names.push(t), this._node.setAttribute("class", this._names.join(" ")));
    },
    remove: function remove(t) {
      var n = this._names.indexOf(t);
      n >= 0 && (this._names.splice(n, 1), this._node.setAttribute("class", this._names.join(" ")));
    },
    contains: function contains(t) {
      return this._names.indexOf(t) >= 0;
    }
  };
  var wt = {};
  (t.event = null, "undefined" != typeof document) && ("onmouseenter" in document.documentElement || (wt = {
    mouseenter: "mouseover",
    mouseleave: "mouseout"
  }));
  function Mt(t, n, e) {
    return t = Nt(t, n, e), function (n) {
      var e = n.relatedTarget;
      e && (e === this || 8 & e.compareDocumentPosition(this)) || t.call(this, n);
    };
  }
  function Nt(n, e, r) {
    return function (i) {
      var o = t.event;
      t.event = i;
      try {
        n.call(this, this.__data__, e, r);
      } finally {
        t.event = o;
      }
    };
  }
  function At(t) {
    return function () {
      var n = this.__on;
      if (n) {
        for (var e, r = 0, i = -1, o = n.length; r < o; ++r) e = n[r], t.type && e.type !== t.type || e.name !== t.name ? n[++i] = e : this.removeEventListener(e.type, e.listener, e.capture);
        ++i ? n.length = i : delete this.__on;
      }
    };
  }
  function Tt(t, n, e) {
    var r = wt.hasOwnProperty(t.type) ? Mt : Nt;
    return function (i, o, a) {
      var u,
        c = this.__on,
        f = r(n, o, a);
      if (c) for (var s = 0, l = c.length; s < l; ++s) if ((u = c[s]).type === t.type && u.name === t.name) return this.removeEventListener(u.type, u.listener, u.capture), this.addEventListener(u.type, u.listener = f, u.capture = e), void (u.value = n);
      this.addEventListener(t.type, f, e), u = {
        type: t.type,
        name: t.name,
        value: n,
        listener: f,
        capture: e
      }, c ? c.push(u) : this.__on = [u];
    };
  }
  function St(n, e, r, i) {
    var o = t.event;
    n.sourceEvent = t.event, t.event = n;
    try {
      return e.apply(r, i);
    } finally {
      t.event = o;
    }
  }
  function kt(t, n, e) {
    var r = ut(t),
      i = r.CustomEvent;
    "function" == typeof i ? i = new i(n, e) : (i = r.document.createEvent("Event"), e ? (i.initEvent(n, e.bubbles, e.cancelable), i.detail = e.detail) : i.initEvent(n, !1, !1)), t.dispatchEvent(i);
  }
  var Et = [null];
  function Ct(t, n) {
    this._groups = t, this._parents = n;
  }
  function Pt() {
    return new Ct([[document.documentElement]], Et);
  }
  function zt(t) {
    return "string" == typeof t ? new Ct([[document.querySelector(t)]], [document.documentElement]) : new Ct([[t]], Et);
  }
  Ct.prototype = Pt.prototype = {
    constructor: Ct,
    select: function select(t) {
      "function" != typeof t && (t = Q(t));
      for (var n = this._groups, e = n.length, r = new Array(e), i = 0; i < e; ++i) for (var o, a, u = n[i], c = u.length, f = r[i] = new Array(c), s = 0; s < c; ++s) (o = u[s]) && (a = t.call(o, o.__data__, s, u)) && ("__data__" in o && (a.__data__ = o.__data__), f[s] = a);
      return new Ct(r, this._parents);
    },
    selectAll: function selectAll(t) {
      "function" != typeof t && (t = K(t));
      for (var n = this._groups, e = n.length, r = [], i = [], o = 0; o < e; ++o) for (var a, u = n[o], c = u.length, f = 0; f < c; ++f) (a = u[f]) && (r.push(t.call(a, a.__data__, f, u)), i.push(a));
      return new Ct(r, i);
    },
    filter: function filter(t) {
      "function" != typeof t && (t = tt(t));
      for (var n = this._groups, e = n.length, r = new Array(e), i = 0; i < e; ++i) for (var o, a = n[i], u = a.length, c = r[i] = [], f = 0; f < u; ++f) (o = a[f]) && t.call(o, o.__data__, f, a) && c.push(o);
      return new Ct(r, this._parents);
    },
    data: function data(t, n) {
      if (!t) return p = new Array(this.size()), s = -1, this.each(function (t) {
        p[++s] = t;
      }), p;
      var e,
        r = n ? ot : it,
        i = this._parents,
        o = this._groups;
      "function" != typeof t && (e = t, t = function t() {
        return e;
      });
      for (var a = o.length, u = new Array(a), c = new Array(a), f = new Array(a), s = 0; s < a; ++s) {
        var l = i[s],
          h = o[s],
          d = h.length,
          p = t.call(l, l && l.__data__, s, i),
          v = p.length,
          g = c[s] = new Array(v),
          y = u[s] = new Array(v);
        r(l, h, g, y, f[s] = new Array(d), p, n);
        for (var _, b, m = 0, x = 0; m < v; ++m) if (_ = g[m]) {
          for (m >= x && (x = m + 1); !(b = y[x]) && ++x < v;);
          _._next = b || null;
        }
      }
      return (u = new Ct(u, i))._enter = c, u._exit = f, u;
    },
    enter: function enter() {
      return new Ct(this._enter || this._groups.map(nt), this._parents);
    },
    exit: function exit() {
      return new Ct(this._exit || this._groups.map(nt), this._parents);
    },
    join: function join(t, n, e) {
      var r = this.enter(),
        i = this,
        o = this.exit();
      return r = "function" == typeof t ? t(r) : r.append(t + ""), null != n && (i = n(i)), null == e ? o.remove() : e(o), r && i ? r.merge(i).order() : i;
    },
    merge: function merge(t) {
      for (var n = this._groups, e = t._groups, r = n.length, i = e.length, o = Math.min(r, i), a = new Array(r), u = 0; u < o; ++u) for (var c, f = n[u], s = e[u], l = f.length, h = a[u] = new Array(l), d = 0; d < l; ++d) (c = f[d] || s[d]) && (h[d] = c);
      for (; u < r; ++u) a[u] = n[u];
      return new Ct(a, this._parents);
    },
    order: function order() {
      for (var t = this._groups, n = -1, e = t.length; ++n < e;) for (var r, i = t[n], o = i.length - 1, a = i[o]; --o >= 0;) (r = i[o]) && (a && 4 ^ r.compareDocumentPosition(a) && a.parentNode.insertBefore(r, a), a = r);
      return this;
    },
    sort: function sort(t) {
      function n(n, e) {
        return n && e ? t(n.__data__, e.__data__) : !n - !e;
      }
      t || (t = at);
      for (var e = this._groups, r = e.length, i = new Array(r), o = 0; o < r; ++o) {
        for (var a, u = e[o], c = u.length, f = i[o] = new Array(c), s = 0; s < c; ++s) (a = u[s]) && (f[s] = a);
        f.sort(n);
      }
      return new Ct(i, this._parents).order();
    },
    call: function call() {
      var t = arguments[0];
      return arguments[0] = this, t.apply(null, arguments), this;
    },
    nodes: function nodes() {
      var t = new Array(this.size()),
        n = -1;
      return this.each(function () {
        t[++n] = this;
      }), t;
    },
    node: function node() {
      for (var t = this._groups, n = 0, e = t.length; n < e; ++n) for (var r = t[n], i = 0, o = r.length; i < o; ++i) {
        var a = r[i];
        if (a) return a;
      }
      return null;
    },
    size: function size() {
      var t = 0;
      return this.each(function () {
        ++t;
      }), t;
    },
    empty: function empty() {
      return !this.node();
    },
    each: function each(t) {
      for (var n = this._groups, e = 0, r = n.length; e < r; ++e) for (var i, o = n[e], a = 0, u = o.length; a < u; ++a) (i = o[a]) && t.call(i, i.__data__, a, o);
      return this;
    },
    attr: function attr(t, n) {
      var e = $(t);
      if (arguments.length < 2) {
        var r = this.node();
        return e.local ? r.getAttributeNS(e.space, e.local) : r.getAttribute(e);
      }
      return this.each((null == n ? e.local ? function (t) {
        return function () {
          this.removeAttributeNS(t.space, t.local);
        };
      } : function (t) {
        return function () {
          this.removeAttribute(t);
        };
      } : "function" == typeof n ? e.local ? function (t, n) {
        return function () {
          var e = n.apply(this, arguments);
          null == e ? this.removeAttributeNS(t.space, t.local) : this.setAttributeNS(t.space, t.local, e);
        };
      } : function (t, n) {
        return function () {
          var e = n.apply(this, arguments);
          null == e ? this.removeAttribute(t) : this.setAttribute(t, e);
        };
      } : e.local ? function (t, n) {
        return function () {
          this.setAttributeNS(t.space, t.local, n);
        };
      } : function (t, n) {
        return function () {
          this.setAttribute(t, n);
        };
      })(e, n));
    },
    style: function style(t, n, e) {
      return arguments.length > 1 ? this.each((null == n ? function (t) {
        return function () {
          this.style.removeProperty(t);
        };
      } : "function" == typeof n ? function (t, n, e) {
        return function () {
          var r = n.apply(this, arguments);
          null == r ? this.style.removeProperty(t) : this.style.setProperty(t, r, e);
        };
      } : function (t, n, e) {
        return function () {
          this.style.setProperty(t, n, e);
        };
      })(t, n, null == e ? "" : e)) : ct(this.node(), t);
    },
    property: function property(t, n) {
      return arguments.length > 1 ? this.each((null == n ? function (t) {
        return function () {
          delete this[t];
        };
      } : "function" == typeof n ? function (t, n) {
        return function () {
          var e = n.apply(this, arguments);
          null == e ? delete this[t] : this[t] = e;
        };
      } : function (t, n) {
        return function () {
          this[t] = n;
        };
      })(t, n)) : this.node()[t];
    },
    classed: function classed(t, n) {
      var e = ft(t + "");
      if (arguments.length < 2) {
        for (var r = st(this.node()), i = -1, o = e.length; ++i < o;) if (!r.contains(e[i])) return !1;
        return !0;
      }
      return this.each(("function" == typeof n ? function (t, n) {
        return function () {
          (n.apply(this, arguments) ? ht : dt)(this, t);
        };
      } : n ? function (t) {
        return function () {
          ht(this, t);
        };
      } : function (t) {
        return function () {
          dt(this, t);
        };
      })(e, n));
    },
    text: function text(t) {
      return arguments.length ? this.each(null == t ? pt : ("function" == typeof t ? function (t) {
        return function () {
          var n = t.apply(this, arguments);
          this.textContent = null == n ? "" : n;
        };
      } : function (t) {
        return function () {
          this.textContent = t;
        };
      })(t)) : this.node().textContent;
    },
    html: function html(t) {
      return arguments.length ? this.each(null == t ? vt : ("function" == typeof t ? function (t) {
        return function () {
          var n = t.apply(this, arguments);
          this.innerHTML = null == n ? "" : n;
        };
      } : function (t) {
        return function () {
          this.innerHTML = t;
        };
      })(t)) : this.node().innerHTML;
    },
    raise: function raise() {
      return this.each(gt);
    },
    lower: function lower() {
      return this.each(yt);
    },
    append: function append(t) {
      var n = "function" == typeof t ? t : W(t);
      return this.select(function () {
        return this.appendChild(n.apply(this, arguments));
      });
    },
    insert: function insert(t, n) {
      var e = "function" == typeof t ? t : W(t),
        r = null == n ? _t : "function" == typeof n ? n : Q(n);
      return this.select(function () {
        return this.insertBefore(e.apply(this, arguments), r.apply(this, arguments) || null);
      });
    },
    remove: function remove() {
      return this.each(bt);
    },
    clone: function clone(t) {
      return this.select(t ? xt : mt);
    },
    datum: function datum(t) {
      return arguments.length ? this.property("__data__", t) : this.node().__data__;
    },
    on: function on(t, n, e) {
      var r,
        i,
        o = function (t) {
          return t.trim().split(/^|\s+/).map(function (t) {
            var n = "",
              e = t.indexOf(".");
            return e >= 0 && (n = t.slice(e + 1), t = t.slice(0, e)), {
              type: t,
              name: n
            };
          });
        }(t + ""),
        a = o.length;
      if (!(arguments.length < 2)) {
        for (u = n ? Tt : At, null == e && (e = !1), r = 0; r < a; ++r) this.each(u(o[r], n, e));
        return this;
      }
      var u = this.node().__on;
      if (u) for (var c, f = 0, s = u.length; f < s; ++f) for (r = 0, c = u[f]; r < a; ++r) if ((i = o[r]).type === c.type && i.name === c.name) return c.value;
    },
    dispatch: function dispatch(t, n) {
      return this.each(("function" == typeof n ? function (t, n) {
        return function () {
          return kt(this, t, n.apply(this, arguments));
        };
      } : function (t, n) {
        return function () {
          return kt(this, t, n);
        };
      })(t, n));
    }
  };
  var Rt = 0;
  function Dt() {
    return new qt();
  }
  function qt() {
    this._ = "@" + (++Rt).toString(36);
  }
  function Lt() {
    for (var n, e = t.event; n = e.sourceEvent;) e = n;
    return e;
  }
  function Ut(t, n) {
    var e = t.ownerSVGElement || t;
    if (e.createSVGPoint) {
      var r = e.createSVGPoint();
      return r.x = n.clientX, r.y = n.clientY, [(r = r.matrixTransform(t.getScreenCTM().inverse())).x, r.y];
    }
    var i = t.getBoundingClientRect();
    return [n.clientX - i.left - t.clientLeft, n.clientY - i.top - t.clientTop];
  }
  function Ot(t) {
    var n = Lt();
    return n.changedTouches && (n = n.changedTouches[0]), Ut(t, n);
  }
  function Bt(t, n, e) {
    arguments.length < 3 && (e = n, n = Lt().changedTouches);
    for (var r, i = 0, o = n ? n.length : 0; i < o; ++i) if ((r = n[i]).identifier === e) return Ut(t, r);
    return null;
  }
  function Yt() {
    t.event.stopImmediatePropagation();
  }
  function Ft() {
    t.event.preventDefault(), t.event.stopImmediatePropagation();
  }
  function It(t) {
    var n = t.document.documentElement,
      e = zt(t).on("dragstart.drag", Ft, !0);
    "onselectstart" in n ? e.on("selectstart.drag", Ft, !0) : (n.__noselect = n.style.MozUserSelect, n.style.MozUserSelect = "none");
  }
  function jt(t, n) {
    var e = t.document.documentElement,
      r = zt(t).on("dragstart.drag", null);
    n && (r.on("click.drag", Ft, !0), setTimeout(function () {
      r.on("click.drag", null);
    }, 0)), "onselectstart" in e ? r.on("selectstart.drag", null) : (e.style.MozUserSelect = e.__noselect, delete e.__noselect);
  }
  function Ht(t) {
    return function () {
      return t;
    };
  }
  function Xt(t, n, e, r, i, o, a, u, c, f) {
    this.target = t, this.type = n, this.subject = e, this.identifier = r, this.active = i, this.x = o, this.y = a, this.dx = u, this.dy = c, this._ = f;
  }
  function Gt() {
    return !t.event.button;
  }
  function Vt() {
    return this.parentNode;
  }
  function $t(n) {
    return null == n ? {
      x: t.event.x,
      y: t.event.y
    } : n;
  }
  function Wt() {
    return "ontouchstart" in this;
  }
  function Zt(t, n, e) {
    t.prototype = n.prototype = e, e.constructor = t;
  }
  function Qt(t, n) {
    var e = Object.create(t.prototype);
    for (var r in n) e[r] = n[r];
    return e;
  }
  function Jt() {}
  qt.prototype = Dt.prototype = {
    constructor: qt,
    get: function get(t) {
      for (var n = this._; !(n in t);) if (!(t = t.parentNode)) return;
      return t[n];
    },
    set: function set(t, n) {
      return t[this._] = n;
    },
    remove: function remove(t) {
      return this._ in t && delete t[this._];
    },
    toString: function toString() {
      return this._;
    }
  }, Xt.prototype.on = function () {
    var t = this._.on.apply(this._, arguments);
    return t === this._ ? this : t;
  };
  var Kt = "\\s*([+-]?\\d+)\\s*",
    tn = "\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",
    nn = "\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",
    en = /^#([0-9a-f]{3})$/,
    rn = /^#([0-9a-f]{6})$/,
    on = new RegExp("^rgb\\(" + [Kt, Kt, Kt] + "\\)$"),
    an = new RegExp("^rgb\\(" + [nn, nn, nn] + "\\)$"),
    un = new RegExp("^rgba\\(" + [Kt, Kt, Kt, tn] + "\\)$"),
    cn = new RegExp("^rgba\\(" + [nn, nn, nn, tn] + "\\)$"),
    fn = new RegExp("^hsl\\(" + [tn, nn, nn] + "\\)$"),
    sn = new RegExp("^hsla\\(" + [tn, nn, nn, tn] + "\\)$"),
    ln = {
      aliceblue: 15792383,
      antiquewhite: 16444375,
      aqua: 65535,
      aquamarine: 8388564,
      azure: 15794175,
      beige: 16119260,
      bisque: 16770244,
      black: 0,
      blanchedalmond: 16772045,
      blue: 255,
      blueviolet: 9055202,
      brown: 10824234,
      burlywood: 14596231,
      cadetblue: 6266528,
      chartreuse: 8388352,
      chocolate: 13789470,
      coral: 16744272,
      cornflowerblue: 6591981,
      cornsilk: 16775388,
      crimson: 14423100,
      cyan: 65535,
      darkblue: 139,
      darkcyan: 35723,
      darkgoldenrod: 12092939,
      darkgray: 11119017,
      darkgreen: 25600,
      darkgrey: 11119017,
      darkkhaki: 12433259,
      darkmagenta: 9109643,
      darkolivegreen: 5597999,
      darkorange: 16747520,
      darkorchid: 10040012,
      darkred: 9109504,
      darksalmon: 15308410,
      darkseagreen: 9419919,
      darkslateblue: 4734347,
      darkslategray: 3100495,
      darkslategrey: 3100495,
      darkturquoise: 52945,
      darkviolet: 9699539,
      deeppink: 16716947,
      deepskyblue: 49151,
      dimgray: 6908265,
      dimgrey: 6908265,
      dodgerblue: 2003199,
      firebrick: 11674146,
      floralwhite: 16775920,
      forestgreen: 2263842,
      fuchsia: 16711935,
      gainsboro: 14474460,
      ghostwhite: 16316671,
      gold: 16766720,
      goldenrod: 14329120,
      gray: 8421504,
      green: 32768,
      greenyellow: 11403055,
      grey: 8421504,
      honeydew: 15794160,
      hotpink: 16738740,
      indianred: 13458524,
      indigo: 4915330,
      ivory: 16777200,
      khaki: 15787660,
      lavender: 15132410,
      lavenderblush: 16773365,
      lawngreen: 8190976,
      lemonchiffon: 16775885,
      lightblue: 11393254,
      lightcoral: 15761536,
      lightcyan: 14745599,
      lightgoldenrodyellow: 16448210,
      lightgray: 13882323,
      lightgreen: 9498256,
      lightgrey: 13882323,
      lightpink: 16758465,
      lightsalmon: 16752762,
      lightseagreen: 2142890,
      lightskyblue: 8900346,
      lightslategray: 7833753,
      lightslategrey: 7833753,
      lightsteelblue: 11584734,
      lightyellow: 16777184,
      lime: 65280,
      limegreen: 3329330,
      linen: 16445670,
      magenta: 16711935,
      maroon: 8388608,
      mediumaquamarine: 6737322,
      mediumblue: 205,
      mediumorchid: 12211667,
      mediumpurple: 9662683,
      mediumseagreen: 3978097,
      mediumslateblue: 8087790,
      mediumspringgreen: 64154,
      mediumturquoise: 4772300,
      mediumvioletred: 13047173,
      midnightblue: 1644912,
      mintcream: 16121850,
      mistyrose: 16770273,
      moccasin: 16770229,
      navajowhite: 16768685,
      navy: 128,
      oldlace: 16643558,
      olive: 8421376,
      olivedrab: 7048739,
      orange: 16753920,
      orangered: 16729344,
      orchid: 14315734,
      palegoldenrod: 15657130,
      palegreen: 10025880,
      paleturquoise: 11529966,
      palevioletred: 14381203,
      papayawhip: 16773077,
      peachpuff: 16767673,
      peru: 13468991,
      pink: 16761035,
      plum: 14524637,
      powderblue: 11591910,
      purple: 8388736,
      rebeccapurple: 6697881,
      red: 16711680,
      rosybrown: 12357519,
      royalblue: 4286945,
      saddlebrown: 9127187,
      salmon: 16416882,
      sandybrown: 16032864,
      seagreen: 3050327,
      seashell: 16774638,
      sienna: 10506797,
      silver: 12632256,
      skyblue: 8900331,
      slateblue: 6970061,
      slategray: 7372944,
      slategrey: 7372944,
      snow: 16775930,
      springgreen: 65407,
      steelblue: 4620980,
      tan: 13808780,
      teal: 32896,
      thistle: 14204888,
      tomato: 16737095,
      turquoise: 4251856,
      violet: 15631086,
      wheat: 16113331,
      white: 16777215,
      whitesmoke: 16119285,
      yellow: 16776960,
      yellowgreen: 10145074
    };
  function hn(t) {
    var n;
    return t = (t + "").trim().toLowerCase(), (n = en.exec(t)) ? new yn((n = parseInt(n[1], 16)) >> 8 & 15 | n >> 4 & 240, n >> 4 & 15 | 240 & n, (15 & n) << 4 | 15 & n, 1) : (n = rn.exec(t)) ? dn(parseInt(n[1], 16)) : (n = on.exec(t)) ? new yn(n[1], n[2], n[3], 1) : (n = an.exec(t)) ? new yn(255 * n[1] / 100, 255 * n[2] / 100, 255 * n[3] / 100, 1) : (n = un.exec(t)) ? pn(n[1], n[2], n[3], n[4]) : (n = cn.exec(t)) ? pn(255 * n[1] / 100, 255 * n[2] / 100, 255 * n[3] / 100, n[4]) : (n = fn.exec(t)) ? bn(n[1], n[2] / 100, n[3] / 100, 1) : (n = sn.exec(t)) ? bn(n[1], n[2] / 100, n[3] / 100, n[4]) : ln.hasOwnProperty(t) ? dn(ln[t]) : "transparent" === t ? new yn(NaN, NaN, NaN, 0) : null;
  }
  function dn(t) {
    return new yn(t >> 16 & 255, t >> 8 & 255, 255 & t, 1);
  }
  function pn(t, n, e, r) {
    return r <= 0 && (t = n = e = NaN), new yn(t, n, e, r);
  }
  function vn(t) {
    return t instanceof Jt || (t = hn(t)), t ? new yn((t = t.rgb()).r, t.g, t.b, t.opacity) : new yn();
  }
  function gn(t, n, e, r) {
    return 1 === arguments.length ? vn(t) : new yn(t, n, e, null == r ? 1 : r);
  }
  function yn(t, n, e, r) {
    this.r = +t, this.g = +n, this.b = +e, this.opacity = +r;
  }
  function _n(t) {
    return ((t = Math.max(0, Math.min(255, Math.round(t) || 0))) < 16 ? "0" : "") + t.toString(16);
  }
  function bn(t, n, e, r) {
    return r <= 0 ? t = n = e = NaN : e <= 0 || e >= 1 ? t = n = NaN : n <= 0 && (t = NaN), new xn(t, n, e, r);
  }
  function mn(t, n, e, r) {
    return 1 === arguments.length ? function (t) {
      if (t instanceof xn) return new xn(t.h, t.s, t.l, t.opacity);
      if (t instanceof Jt || (t = hn(t)), !t) return new xn();
      if (t instanceof xn) return t;
      var n = (t = t.rgb()).r / 255,
        e = t.g / 255,
        r = t.b / 255,
        i = Math.min(n, e, r),
        o = Math.max(n, e, r),
        a = NaN,
        u = o - i,
        c = (o + i) / 2;
      return u ? (a = n === o ? (e - r) / u + 6 * (e < r) : e === o ? (r - n) / u + 2 : (n - e) / u + 4, u /= c < .5 ? o + i : 2 - o - i, a *= 60) : u = c > 0 && c < 1 ? 0 : a, new xn(a, u, c, t.opacity);
    }(t) : new xn(t, n, e, null == r ? 1 : r);
  }
  function xn(t, n, e, r) {
    this.h = +t, this.s = +n, this.l = +e, this.opacity = +r;
  }
  function wn(t, n, e) {
    return 255 * (t < 60 ? n + (e - n) * t / 60 : t < 180 ? e : t < 240 ? n + (e - n) * (240 - t) / 60 : n);
  }
  Zt(Jt, hn, {
    displayable: function displayable() {
      return this.rgb().displayable();
    },
    hex: function hex() {
      return this.rgb().hex();
    },
    toString: function toString() {
      return this.rgb() + "";
    }
  }), Zt(yn, gn, Qt(Jt, {
    brighter: function brighter(t) {
      return t = null == t ? 1 / .7 : Math.pow(1 / .7, t), new yn(this.r * t, this.g * t, this.b * t, this.opacity);
    },
    darker: function darker(t) {
      return t = null == t ? .7 : Math.pow(.7, t), new yn(this.r * t, this.g * t, this.b * t, this.opacity);
    },
    rgb: function rgb() {
      return this;
    },
    displayable: function displayable() {
      return -.5 <= this.r && this.r < 255.5 && -.5 <= this.g && this.g < 255.5 && -.5 <= this.b && this.b < 255.5 && 0 <= this.opacity && this.opacity <= 1;
    },
    hex: function hex() {
      return "#" + _n(this.r) + _n(this.g) + _n(this.b);
    },
    toString: function toString() {
      var t = this.opacity;
      return (1 === (t = isNaN(t) ? 1 : Math.max(0, Math.min(1, t))) ? "rgb(" : "rgba(") + Math.max(0, Math.min(255, Math.round(this.r) || 0)) + ", " + Math.max(0, Math.min(255, Math.round(this.g) || 0)) + ", " + Math.max(0, Math.min(255, Math.round(this.b) || 0)) + (1 === t ? ")" : ", " + t + ")");
    }
  })), Zt(xn, mn, Qt(Jt, {
    brighter: function brighter(t) {
      return t = null == t ? 1 / .7 : Math.pow(1 / .7, t), new xn(this.h, this.s, this.l * t, this.opacity);
    },
    darker: function darker(t) {
      return t = null == t ? .7 : Math.pow(.7, t), new xn(this.h, this.s, this.l * t, this.opacity);
    },
    rgb: function rgb() {
      var t = this.h % 360 + 360 * (this.h < 0),
        n = isNaN(t) || isNaN(this.s) ? 0 : this.s,
        e = this.l,
        r = e + (e < .5 ? e : 1 - e) * n,
        i = 2 * e - r;
      return new yn(wn(t >= 240 ? t - 240 : t + 120, i, r), wn(t, i, r), wn(t < 120 ? t + 240 : t - 120, i, r), this.opacity);
    },
    displayable: function displayable() {
      return (0 <= this.s && this.s <= 1 || isNaN(this.s)) && 0 <= this.l && this.l <= 1 && 0 <= this.opacity && this.opacity <= 1;
    }
  }));
  var Mn = Math.PI / 180,
    Nn = 180 / Math.PI,
    An = .96422,
    Tn = 1,
    Sn = .82521,
    kn = 4 / 29,
    En = 6 / 29,
    Cn = 3 * En * En,
    Pn = En * En * En;
  function zn(t) {
    if (t instanceof Dn) return new Dn(t.l, t.a, t.b, t.opacity);
    if (t instanceof Fn) return In(t);
    t instanceof yn || (t = vn(t));
    var n,
      e,
      r = On(t.r),
      i = On(t.g),
      o = On(t.b),
      a = qn((.2225045 * r + .7168786 * i + .0606169 * o) / Tn);
    return r === i && i === o ? n = e = a : (n = qn((.4360747 * r + .3850649 * i + .1430804 * o) / An), e = qn((.0139322 * r + .0971045 * i + .7141733 * o) / Sn)), new Dn(116 * a - 16, 500 * (n - a), 200 * (a - e), t.opacity);
  }
  function Rn(t, n, e, r) {
    return 1 === arguments.length ? zn(t) : new Dn(t, n, e, null == r ? 1 : r);
  }
  function Dn(t, n, e, r) {
    this.l = +t, this.a = +n, this.b = +e, this.opacity = +r;
  }
  function qn(t) {
    return t > Pn ? Math.pow(t, 1 / 3) : t / Cn + kn;
  }
  function Ln(t) {
    return t > En ? t * t * t : Cn * (t - kn);
  }
  function Un(t) {
    return 255 * (t <= .0031308 ? 12.92 * t : 1.055 * Math.pow(t, 1 / 2.4) - .055);
  }
  function On(t) {
    return (t /= 255) <= .04045 ? t / 12.92 : Math.pow((t + .055) / 1.055, 2.4);
  }
  function Bn(t) {
    if (t instanceof Fn) return new Fn(t.h, t.c, t.l, t.opacity);
    if (t instanceof Dn || (t = zn(t)), 0 === t.a && 0 === t.b) return new Fn(NaN, 0 < t.l && t.l < 100 ? 0 : NaN, t.l, t.opacity);
    var n = Math.atan2(t.b, t.a) * Nn;
    return new Fn(n < 0 ? n + 360 : n, Math.sqrt(t.a * t.a + t.b * t.b), t.l, t.opacity);
  }
  function Yn(t, n, e, r) {
    return 1 === arguments.length ? Bn(t) : new Fn(t, n, e, null == r ? 1 : r);
  }
  function Fn(t, n, e, r) {
    this.h = +t, this.c = +n, this.l = +e, this.opacity = +r;
  }
  function In(t) {
    if (isNaN(t.h)) return new Dn(t.l, 0, 0, t.opacity);
    var n = t.h * Mn;
    return new Dn(t.l, Math.cos(n) * t.c, Math.sin(n) * t.c, t.opacity);
  }
  Zt(Dn, Rn, Qt(Jt, {
    brighter: function brighter(t) {
      return new Dn(this.l + 18 * (null == t ? 1 : t), this.a, this.b, this.opacity);
    },
    darker: function darker(t) {
      return new Dn(this.l - 18 * (null == t ? 1 : t), this.a, this.b, this.opacity);
    },
    rgb: function rgb() {
      var t = (this.l + 16) / 116,
        n = isNaN(this.a) ? t : t + this.a / 500,
        e = isNaN(this.b) ? t : t - this.b / 200;
      return new yn(Un(3.1338561 * (n = An * Ln(n)) - 1.6168667 * (t = Tn * Ln(t)) - .4906146 * (e = Sn * Ln(e))), Un(-.9787684 * n + 1.9161415 * t + .033454 * e), Un(.0719453 * n - .2289914 * t + 1.4052427 * e), this.opacity);
    }
  })), Zt(Fn, Yn, Qt(Jt, {
    brighter: function brighter(t) {
      return new Fn(this.h, this.c, this.l + 18 * (null == t ? 1 : t), this.opacity);
    },
    darker: function darker(t) {
      return new Fn(this.h, this.c, this.l - 18 * (null == t ? 1 : t), this.opacity);
    },
    rgb: function rgb() {
      return In(this).rgb();
    }
  }));
  var jn = -.14861,
    Hn = 1.78277,
    Xn = -.29227,
    Gn = -.90649,
    Vn = 1.97294,
    $n = Vn * Gn,
    Wn = Vn * Hn,
    Zn = Hn * Xn - Gn * jn;
  function Qn(t, n, e, r) {
    return 1 === arguments.length ? function (t) {
      if (t instanceof Jn) return new Jn(t.h, t.s, t.l, t.opacity);
      t instanceof yn || (t = vn(t));
      var n = t.r / 255,
        e = t.g / 255,
        r = t.b / 255,
        i = (Zn * r + $n * n - Wn * e) / (Zn + $n - Wn),
        o = r - i,
        a = (Vn * (e - i) - Xn * o) / Gn,
        u = Math.sqrt(a * a + o * o) / (Vn * i * (1 - i)),
        c = u ? Math.atan2(a, o) * Nn - 120 : NaN;
      return new Jn(c < 0 ? c + 360 : c, u, i, t.opacity);
    }(t) : new Jn(t, n, e, null == r ? 1 : r);
  }
  function Jn(t, n, e, r) {
    this.h = +t, this.s = +n, this.l = +e, this.opacity = +r;
  }
  function Kn(t, n, e, r, i) {
    var o = t * t,
      a = o * t;
    return ((1 - 3 * t + 3 * o - a) * n + (4 - 6 * o + 3 * a) * e + (1 + 3 * t + 3 * o - 3 * a) * r + a * i) / 6;
  }
  function te(t) {
    var n = t.length - 1;
    return function (e) {
      var r = e <= 0 ? e = 0 : e >= 1 ? (e = 1, n - 1) : Math.floor(e * n),
        i = t[r],
        o = t[r + 1],
        a = r > 0 ? t[r - 1] : 2 * i - o,
        u = r < n - 1 ? t[r + 2] : 2 * o - i;
      return Kn((e - r / n) * n, a, i, o, u);
    };
  }
  function ne(t) {
    var n = t.length;
    return function (e) {
      var r = Math.floor(((e %= 1) < 0 ? ++e : e) * n),
        i = t[(r + n - 1) % n],
        o = t[r % n],
        a = t[(r + 1) % n],
        u = t[(r + 2) % n];
      return Kn((e - r / n) * n, i, o, a, u);
    };
  }
  function ee(t) {
    return function () {
      return t;
    };
  }
  function re(t, n) {
    return function (e) {
      return t + e * n;
    };
  }
  function ie(t, n) {
    var e = n - t;
    return e ? re(t, e > 180 || e < -180 ? e - 360 * Math.round(e / 360) : e) : ee(isNaN(t) ? n : t);
  }
  function oe(t) {
    return 1 == (t = +t) ? ae : function (n, e) {
      return e - n ? function (t, n, e) {
        return t = Math.pow(t, e), n = Math.pow(n, e) - t, e = 1 / e, function (r) {
          return Math.pow(t + r * n, e);
        };
      }(n, e, t) : ee(isNaN(n) ? e : n);
    };
  }
  function ae(t, n) {
    var e = n - t;
    return e ? re(t, e) : ee(isNaN(t) ? n : t);
  }
  Zt(Jn, Qn, Qt(Jt, {
    brighter: function brighter(t) {
      return t = null == t ? 1 / .7 : Math.pow(1 / .7, t), new Jn(this.h, this.s, this.l * t, this.opacity);
    },
    darker: function darker(t) {
      return t = null == t ? .7 : Math.pow(.7, t), new Jn(this.h, this.s, this.l * t, this.opacity);
    },
    rgb: function rgb() {
      var t = isNaN(this.h) ? 0 : (this.h + 120) * Mn,
        n = +this.l,
        e = isNaN(this.s) ? 0 : this.s * n * (1 - n),
        r = Math.cos(t),
        i = Math.sin(t);
      return new yn(255 * (n + e * (jn * r + Hn * i)), 255 * (n + e * (Xn * r + Gn * i)), 255 * (n + e * (Vn * r)), this.opacity);
    }
  }));
  var ue = function t(n) {
    var e = oe(n);
    function r(t, n) {
      var r = e((t = gn(t)).r, (n = gn(n)).r),
        i = e(t.g, n.g),
        o = e(t.b, n.b),
        a = ae(t.opacity, n.opacity);
      return function (n) {
        return t.r = r(n), t.g = i(n), t.b = o(n), t.opacity = a(n), t + "";
      };
    }
    return r.gamma = t, r;
  }(1);
  function ce(t) {
    return function (n) {
      var e,
        r,
        i = n.length,
        o = new Array(i),
        a = new Array(i),
        u = new Array(i);
      for (e = 0; e < i; ++e) r = gn(n[e]), o[e] = r.r || 0, a[e] = r.g || 0, u[e] = r.b || 0;
      return o = t(o), a = t(a), u = t(u), r.opacity = 1, function (t) {
        return r.r = o(t), r.g = a(t), r.b = u(t), r + "";
      };
    };
  }
  var fe = ce(te),
    se = ce(ne);
  function le(t, n) {
    var e,
      r = n ? n.length : 0,
      i = t ? Math.min(r, t.length) : 0,
      o = new Array(i),
      a = new Array(r);
    for (e = 0; e < i; ++e) o[e] = _e(t[e], n[e]);
    for (; e < r; ++e) a[e] = n[e];
    return function (t) {
      for (e = 0; e < i; ++e) a[e] = o[e](t);
      return a;
    };
  }
  function he(t, n) {
    var e = new Date();
    return n -= t = +t, function (r) {
      return e.setTime(t + n * r), e;
    };
  }
  function de(t, n) {
    return n -= t = +t, function (e) {
      return t + n * e;
    };
  }
  function pe(t, n) {
    var e,
      r = {},
      i = {};
    for (e in null !== t && "object" == _typeof(t) || (t = {}), null !== n && "object" == _typeof(n) || (n = {}), n) e in t ? r[e] = _e(t[e], n[e]) : i[e] = n[e];
    return function (t) {
      for (e in r) i[e] = r[e](t);
      return i;
    };
  }
  var ve = /[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,
    ge = new RegExp(ve.source, "g");
  function ye(t, n) {
    var e,
      r,
      i,
      o = ve.lastIndex = ge.lastIndex = 0,
      a = -1,
      u = [],
      c = [];
    for (t += "", n += ""; (e = ve.exec(t)) && (r = ge.exec(n));) (i = r.index) > o && (i = n.slice(o, i), u[a] ? u[a] += i : u[++a] = i), (e = e[0]) === (r = r[0]) ? u[a] ? u[a] += r : u[++a] = r : (u[++a] = null, c.push({
      i: a,
      x: de(e, r)
    })), o = ge.lastIndex;
    return o < n.length && (i = n.slice(o), u[a] ? u[a] += i : u[++a] = i), u.length < 2 ? c[0] ? function (t) {
      return function (n) {
        return t(n) + "";
      };
    }(c[0].x) : function (t) {
      return function () {
        return t;
      };
    }(n) : (n = c.length, function (t) {
      for (var e, r = 0; r < n; ++r) u[(e = c[r]).i] = e.x(t);
      return u.join("");
    });
  }
  function _e(t, n) {
    var e,
      r = _typeof(n);
    return null == n || "boolean" === r ? ee(n) : ("number" === r ? de : "string" === r ? (e = hn(n)) ? (n = e, ue) : ye : n instanceof hn ? ue : n instanceof Date ? he : Array.isArray(n) ? le : "function" != typeof n.valueOf && "function" != typeof n.toString || isNaN(n) ? pe : de)(t, n);
  }
  function be(t, n) {
    return n -= t = +t, function (e) {
      return Math.round(t + n * e);
    };
  }
  var me,
    xe,
    we,
    Me,
    Ne = 180 / Math.PI,
    Ae = {
      translateX: 0,
      translateY: 0,
      rotate: 0,
      skewX: 0,
      scaleX: 1,
      scaleY: 1
    };
  function Te(t, n, e, r, i, o) {
    var a, u, c;
    return (a = Math.sqrt(t * t + n * n)) && (t /= a, n /= a), (c = t * e + n * r) && (e -= t * c, r -= n * c), (u = Math.sqrt(e * e + r * r)) && (e /= u, r /= u, c /= u), t * r < n * e && (t = -t, n = -n, c = -c, a = -a), {
      translateX: i,
      translateY: o,
      rotate: Math.atan2(n, t) * Ne,
      skewX: Math.atan(c) * Ne,
      scaleX: a,
      scaleY: u
    };
  }
  function Se(t, n, e, r) {
    function i(t) {
      return t.length ? t.pop() + " " : "";
    }
    return function (o, a) {
      var u = [],
        c = [];
      return o = t(o), a = t(a), function (t, r, i, o, a, u) {
        if (t !== i || r !== o) {
          var c = a.push("translate(", null, n, null, e);
          u.push({
            i: c - 4,
            x: de(t, i)
          }, {
            i: c - 2,
            x: de(r, o)
          });
        } else (i || o) && a.push("translate(" + i + n + o + e);
      }(o.translateX, o.translateY, a.translateX, a.translateY, u, c), function (t, n, e, o) {
        t !== n ? (t - n > 180 ? n += 360 : n - t > 180 && (t += 360), o.push({
          i: e.push(i(e) + "rotate(", null, r) - 2,
          x: de(t, n)
        })) : n && e.push(i(e) + "rotate(" + n + r);
      }(o.rotate, a.rotate, u, c), function (t, n, e, o) {
        t !== n ? o.push({
          i: e.push(i(e) + "skewX(", null, r) - 2,
          x: de(t, n)
        }) : n && e.push(i(e) + "skewX(" + n + r);
      }(o.skewX, a.skewX, u, c), function (t, n, e, r, o, a) {
        if (t !== e || n !== r) {
          var u = o.push(i(o) + "scale(", null, ",", null, ")");
          a.push({
            i: u - 4,
            x: de(t, e)
          }, {
            i: u - 2,
            x: de(n, r)
          });
        } else 1 === e && 1 === r || o.push(i(o) + "scale(" + e + "," + r + ")");
      }(o.scaleX, o.scaleY, a.scaleX, a.scaleY, u, c), o = a = null, function (t) {
        for (var n, e = -1, r = c.length; ++e < r;) u[(n = c[e]).i] = n.x(t);
        return u.join("");
      };
    };
  }
  var ke = Se(function (t) {
      return "none" === t ? Ae : (me || (me = document.createElement("DIV"), xe = document.documentElement, we = document.defaultView), me.style.transform = t, t = we.getComputedStyle(xe.appendChild(me), null).getPropertyValue("transform"), xe.removeChild(me), Te(+(t = t.slice(7, -1).split(","))[0], +t[1], +t[2], +t[3], +t[4], +t[5]));
    }, "px, ", "px)", "deg)"),
    Ee = Se(function (t) {
      return null == t ? Ae : (Me || (Me = document.createElementNS("http://www.w3.org/2000/svg", "g")), Me.setAttribute("transform", t), (t = Me.transform.baseVal.consolidate()) ? Te((t = t.matrix).a, t.b, t.c, t.d, t.e, t.f) : Ae);
    }, ", ", ")", ")"),
    Ce = Math.SQRT2,
    Pe = 2,
    ze = 4,
    Re = 1e-12;
  function De(t) {
    return ((t = Math.exp(t)) + 1 / t) / 2;
  }
  function qe(t, n) {
    var e,
      r,
      i = t[0],
      o = t[1],
      a = t[2],
      u = n[0],
      c = n[1],
      f = n[2],
      s = u - i,
      l = c - o,
      h = s * s + l * l;
    if (h < Re) r = Math.log(f / a) / Ce, e = function e(t) {
      return [i + t * s, o + t * l, a * Math.exp(Ce * t * r)];
    };else {
      var d = Math.sqrt(h),
        p = (f * f - a * a + ze * h) / (2 * a * Pe * d),
        v = (f * f - a * a - ze * h) / (2 * f * Pe * d),
        g = Math.log(Math.sqrt(p * p + 1) - p),
        y = Math.log(Math.sqrt(v * v + 1) - v);
      r = (y - g) / Ce, e = function e(t) {
        var n,
          e = t * r,
          u = De(g),
          c = a / (Pe * d) * (u * (n = Ce * e + g, ((n = Math.exp(2 * n)) - 1) / (n + 1)) - function (t) {
            return ((t = Math.exp(t)) - 1 / t) / 2;
          }(g));
        return [i + c * s, o + c * l, a * u / De(Ce * e + g)];
      };
    }
    return e.duration = 1e3 * r, e;
  }
  function Le(t) {
    return function (n, e) {
      var r = t((n = mn(n)).h, (e = mn(e)).h),
        i = ae(n.s, e.s),
        o = ae(n.l, e.l),
        a = ae(n.opacity, e.opacity);
      return function (t) {
        return n.h = r(t), n.s = i(t), n.l = o(t), n.opacity = a(t), n + "";
      };
    };
  }
  var Ue = Le(ie),
    Oe = Le(ae);
  function Be(t) {
    return function (n, e) {
      var r = t((n = Yn(n)).h, (e = Yn(e)).h),
        i = ae(n.c, e.c),
        o = ae(n.l, e.l),
        a = ae(n.opacity, e.opacity);
      return function (t) {
        return n.h = r(t), n.c = i(t), n.l = o(t), n.opacity = a(t), n + "";
      };
    };
  }
  var Ye = Be(ie),
    Fe = Be(ae);
  function Ie(t) {
    return function n(e) {
      function r(n, r) {
        var i = t((n = Qn(n)).h, (r = Qn(r)).h),
          o = ae(n.s, r.s),
          a = ae(n.l, r.l),
          u = ae(n.opacity, r.opacity);
        return function (t) {
          return n.h = i(t), n.s = o(t), n.l = a(Math.pow(t, e)), n.opacity = u(t), n + "";
        };
      }
      return e = +e, r.gamma = n, r;
    }(1);
  }
  var je = Ie(ie),
    He = Ie(ae);
  var Xe,
    Ge,
    Ve = 0,
    $e = 0,
    We = 0,
    Ze = 1e3,
    Qe = 0,
    Je = 0,
    Ke = 0,
    tr = "object" == (typeof performance === "undefined" ? "undefined" : _typeof(performance)) && performance.now ? performance : Date,
    nr = "object" == (typeof window === "undefined" ? "undefined" : _typeof(window)) && window.requestAnimationFrame ? window.requestAnimationFrame.bind(window) : function (t) {
      setTimeout(t, 17);
    };
  function er() {
    return Je || (nr(rr), Je = tr.now() + Ke);
  }
  function rr() {
    Je = 0;
  }
  function ir() {
    this._call = this._time = this._next = null;
  }
  function or(t, n, e) {
    var r = new ir();
    return r.restart(t, n, e), r;
  }
  function ar() {
    er(), ++Ve;
    for (var t, n = Xe; n;) (t = Je - n._time) >= 0 && n._call.call(null, t), n = n._next;
    --Ve;
  }
  function ur() {
    Je = (Qe = tr.now()) + Ke, Ve = $e = 0;
    try {
      ar();
    } finally {
      Ve = 0, function () {
        var t,
          n,
          e = Xe,
          r = 1 / 0;
        for (; e;) e._call ? (r > e._time && (r = e._time), t = e, e = e._next) : (n = e._next, e._next = null, e = t ? t._next = n : Xe = n);
        Ge = t, fr(r);
      }(), Je = 0;
    }
  }
  function cr() {
    var t = tr.now(),
      n = t - Qe;
    n > Ze && (Ke -= n, Qe = t);
  }
  function fr(t) {
    Ve || ($e && ($e = clearTimeout($e)), t - Je > 24 ? (t < 1 / 0 && ($e = setTimeout(ur, t - tr.now() - Ke)), We && (We = clearInterval(We))) : (We || (Qe = tr.now(), We = setInterval(cr, Ze)), Ve = 1, nr(ur)));
  }
  function sr(t, n, e) {
    var r = new ir();
    return n = null == n ? 0 : +n, r.restart(function (e) {
      r.stop(), t(e + n);
    }, n, e), r;
  }
  ir.prototype = or.prototype = {
    constructor: ir,
    restart: function restart(t, n, e) {
      if ("function" != typeof t) throw new TypeError("callback is not a function");
      e = (null == e ? er() : +e) + (null == n ? 0 : +n), this._next || Ge === this || (Ge ? Ge._next = this : Xe = this, Ge = this), this._call = t, this._time = e, fr();
    },
    stop: function stop() {
      this._call && (this._call = null, this._time = 1 / 0, fr());
    }
  };
  var lr = I("start", "end", "cancel", "interrupt"),
    hr = [],
    dr = 0,
    pr = 1,
    vr = 2,
    gr = 3,
    yr = 4,
    _r = 5,
    br = 6;
  function mr(t, n, e, r, i, o) {
    var a = t.__transition;
    if (a) {
      if (e in a) return;
    } else t.__transition = {};
    !function (t, n, e) {
      var r,
        i = t.__transition;
      function o(c) {
        var f, s, l, h;
        if (e.state !== pr) return u();
        for (f in i) if ((h = i[f]).name === e.name) {
          if (h.state === gr) return sr(o);
          h.state === yr ? (h.state = br, h.timer.stop(), h.on.call("interrupt", t, t.__data__, h.index, h.group), delete i[f]) : +f < n && (h.state = br, h.timer.stop(), h.on.call("cancel", t, t.__data__, h.index, h.group), delete i[f]);
        }
        if (sr(function () {
          e.state === gr && (e.state = yr, e.timer.restart(a, e.delay, e.time), a(c));
        }), e.state = vr, e.on.call("start", t, t.__data__, e.index, e.group), e.state === vr) {
          for (e.state = gr, r = new Array(l = e.tween.length), f = 0, s = -1; f < l; ++f) (h = e.tween[f].value.call(t, t.__data__, e.index, e.group)) && (r[++s] = h);
          r.length = s + 1;
        }
      }
      function a(n) {
        for (var i = n < e.duration ? e.ease.call(null, n / e.duration) : (e.timer.restart(u), e.state = _r, 1), o = -1, a = r.length; ++o < a;) r[o].call(t, i);
        e.state === _r && (e.on.call("end", t, t.__data__, e.index, e.group), u());
      }
      function u() {
        for (var r in e.state = br, e.timer.stop(), delete i[n], i) return;
        delete t.__transition;
      }
      i[n] = e, e.timer = or(function (t) {
        e.state = pr, e.timer.restart(o, e.delay, e.time), e.delay <= t && o(t - e.delay);
      }, 0, e.time);
    }(t, e, {
      name: n,
      index: r,
      group: i,
      on: lr,
      tween: hr,
      time: o.time,
      delay: o.delay,
      duration: o.duration,
      ease: o.ease,
      timer: null,
      state: dr
    });
  }
  function xr(t, n) {
    var e = Mr(t, n);
    if (e.state > dr) throw new Error("too late; already scheduled");
    return e;
  }
  function wr(t, n) {
    var e = Mr(t, n);
    if (e.state > gr) throw new Error("too late; already running");
    return e;
  }
  function Mr(t, n) {
    var e = t.__transition;
    if (!e || !(e = e[n])) throw new Error("transition not found");
    return e;
  }
  function Nr(t, n) {
    var e,
      r,
      i,
      o = t.__transition,
      a = !0;
    if (o) {
      for (i in n = null == n ? null : n + "", o) (e = o[i]).name === n ? (r = e.state > vr && e.state < _r, e.state = br, e.timer.stop(), e.on.call(r ? "interrupt" : "cancel", t, t.__data__, e.index, e.group), delete o[i]) : a = !1;
      a && delete t.__transition;
    }
  }
  function Ar(t, n, e) {
    var r = t._id;
    return t.each(function () {
      var t = wr(this, r);
      (t.value || (t.value = {}))[n] = e.apply(this, arguments);
    }), function (t) {
      return Mr(t, r).value[n];
    };
  }
  function Tr(t, n) {
    var e;
    return ("number" == typeof n ? de : n instanceof hn ? ue : (e = hn(n)) ? (n = e, ue) : ye)(t, n);
  }
  var Sr = Pt.prototype.constructor;
  function kr(t) {
    return function () {
      this.style.removeProperty(t);
    };
  }
  var Er = 0;
  function Cr(t, n, e, r) {
    this._groups = t, this._parents = n, this._name = e, this._id = r;
  }
  function Pr(t) {
    return Pt().transition(t);
  }
  function zr() {
    return ++Er;
  }
  var Rr = Pt.prototype;
  function Dr(t) {
    return ((t *= 2) <= 1 ? t * t : --t * (2 - t) + 1) / 2;
  }
  function qr(t) {
    return ((t *= 2) <= 1 ? t * t * t : (t -= 2) * t * t + 2) / 2;
  }
  Cr.prototype = Pr.prototype = {
    constructor: Cr,
    select: function select(t) {
      var n = this._name,
        e = this._id;
      "function" != typeof t && (t = Q(t));
      for (var r = this._groups, i = r.length, o = new Array(i), a = 0; a < i; ++a) for (var u, c, f = r[a], s = f.length, l = o[a] = new Array(s), h = 0; h < s; ++h) (u = f[h]) && (c = t.call(u, u.__data__, h, f)) && ("__data__" in u && (c.__data__ = u.__data__), l[h] = c, mr(l[h], n, e, h, l, Mr(u, e)));
      return new Cr(o, this._parents, n, e);
    },
    selectAll: function selectAll(t) {
      var n = this._name,
        e = this._id;
      "function" != typeof t && (t = K(t));
      for (var r = this._groups, i = r.length, o = [], a = [], u = 0; u < i; ++u) for (var c, f = r[u], s = f.length, l = 0; l < s; ++l) if (c = f[l]) {
        for (var h, d = t.call(c, c.__data__, l, f), p = Mr(c, e), v = 0, g = d.length; v < g; ++v) (h = d[v]) && mr(h, n, e, v, d, p);
        o.push(d), a.push(c);
      }
      return new Cr(o, a, n, e);
    },
    filter: function filter(t) {
      "function" != typeof t && (t = tt(t));
      for (var n = this._groups, e = n.length, r = new Array(e), i = 0; i < e; ++i) for (var o, a = n[i], u = a.length, c = r[i] = [], f = 0; f < u; ++f) (o = a[f]) && t.call(o, o.__data__, f, a) && c.push(o);
      return new Cr(r, this._parents, this._name, this._id);
    },
    merge: function merge(t) {
      if (t._id !== this._id) throw new Error();
      for (var n = this._groups, e = t._groups, r = n.length, i = e.length, o = Math.min(r, i), a = new Array(r), u = 0; u < o; ++u) for (var c, f = n[u], s = e[u], l = f.length, h = a[u] = new Array(l), d = 0; d < l; ++d) (c = f[d] || s[d]) && (h[d] = c);
      for (; u < r; ++u) a[u] = n[u];
      return new Cr(a, this._parents, this._name, this._id);
    },
    selection: function selection() {
      return new Sr(this._groups, this._parents);
    },
    transition: function transition() {
      for (var t = this._name, n = this._id, e = zr(), r = this._groups, i = r.length, o = 0; o < i; ++o) for (var a, u = r[o], c = u.length, f = 0; f < c; ++f) if (a = u[f]) {
        var s = Mr(a, n);
        mr(a, t, e, f, u, {
          time: s.time + s.delay + s.duration,
          delay: 0,
          duration: s.duration,
          ease: s.ease
        });
      }
      return new Cr(r, this._parents, t, e);
    },
    call: Rr.call,
    nodes: Rr.nodes,
    node: Rr.node,
    size: Rr.size,
    empty: Rr.empty,
    each: Rr.each,
    on: function on(t, n) {
      var e = this._id;
      return arguments.length < 2 ? Mr(this.node(), e).on.on(t) : this.each(function (t, n, e) {
        var r,
          i,
          o = function (t) {
            return (t + "").trim().split(/^|\s+/).every(function (t) {
              var n = t.indexOf(".");
              return n >= 0 && (t = t.slice(0, n)), !t || "start" === t;
            });
          }(n) ? xr : wr;
        return function () {
          var a = o(this, t),
            u = a.on;
          u !== r && (i = (r = u).copy()).on(n, e), a.on = i;
        };
      }(e, t, n));
    },
    attr: function attr(t, n) {
      var e = $(t),
        r = "transform" === e ? Ee : Tr;
      return this.attrTween(t, "function" == typeof n ? (e.local ? function (t, n, e) {
        var r, i, o;
        return function () {
          var a,
            u,
            c = e(this);
          if (null != c) return (a = this.getAttributeNS(t.space, t.local)) === (u = c + "") ? null : a === r && u === i ? o : (i = u, o = n(r = a, c));
          this.removeAttributeNS(t.space, t.local);
        };
      } : function (t, n, e) {
        var r, i, o;
        return function () {
          var a,
            u,
            c = e(this);
          if (null != c) return (a = this.getAttribute(t)) === (u = c + "") ? null : a === r && u === i ? o : (i = u, o = n(r = a, c));
          this.removeAttribute(t);
        };
      })(e, r, Ar(this, "attr." + t, n)) : null == n ? (e.local ? function (t) {
        return function () {
          this.removeAttributeNS(t.space, t.local);
        };
      } : function (t) {
        return function () {
          this.removeAttribute(t);
        };
      })(e) : (e.local ? function (t, n, e) {
        var r,
          i,
          o = e + "";
        return function () {
          var a = this.getAttributeNS(t.space, t.local);
          return a === o ? null : a === r ? i : i = n(r = a, e);
        };
      } : function (t, n, e) {
        var r,
          i,
          o = e + "";
        return function () {
          var a = this.getAttribute(t);
          return a === o ? null : a === r ? i : i = n(r = a, e);
        };
      })(e, r, n));
    },
    attrTween: function attrTween(t, n) {
      var e = "attr." + t;
      if (arguments.length < 2) return (e = this.tween(e)) && e._value;
      if (null == n) return this.tween(e, null);
      if ("function" != typeof n) throw new Error();
      var r = $(t);
      return this.tween(e, (r.local ? function (t, n) {
        var e, r;
        function i() {
          var i = n.apply(this, arguments);
          return i !== r && (e = (r = i) && function (t, n) {
            return function (e) {
              this.setAttributeNS(t.space, t.local, n(e));
            };
          }(t, i)), e;
        }
        return i._value = n, i;
      } : function (t, n) {
        var e, r;
        function i() {
          var i = n.apply(this, arguments);
          return i !== r && (e = (r = i) && function (t, n) {
            return function (e) {
              this.setAttribute(t, n(e));
            };
          }(t, i)), e;
        }
        return i._value = n, i;
      })(r, n));
    },
    style: function style(t, n, e) {
      var r = "transform" == (t += "") ? ke : Tr;
      return null == n ? this.styleTween(t, function (t, n) {
        var e, r, i;
        return function () {
          var o = ct(this, t),
            a = (this.style.removeProperty(t), ct(this, t));
          return o === a ? null : o === e && a === r ? i : i = n(e = o, r = a);
        };
      }(t, r)).on("end.style." + t, kr(t)) : "function" == typeof n ? this.styleTween(t, function (t, n, e) {
        var r, i, o;
        return function () {
          var a = ct(this, t),
            u = e(this),
            c = u + "";
          return null == u && (this.style.removeProperty(t), c = u = ct(this, t)), a === c ? null : a === r && c === i ? o : (i = c, o = n(r = a, u));
        };
      }(t, r, Ar(this, "style." + t, n))).each(function (t, n) {
        var e,
          r,
          i,
          o,
          a = "style." + n,
          u = "end." + a;
        return function () {
          var c = wr(this, t),
            f = c.on,
            s = null == c.value[a] ? o || (o = kr(n)) : void 0;
          f === e && i === s || (r = (e = f).copy()).on(u, i = s), c.on = r;
        };
      }(this._id, t)) : this.styleTween(t, function (t, n, e) {
        var r,
          i,
          o = e + "";
        return function () {
          var a = ct(this, t);
          return a === o ? null : a === r ? i : i = n(r = a, e);
        };
      }(t, r, n), e).on("end.style." + t, null);
    },
    styleTween: function styleTween(t, n, e) {
      var r = "style." + (t += "");
      if (arguments.length < 2) return (r = this.tween(r)) && r._value;
      if (null == n) return this.tween(r, null);
      if ("function" != typeof n) throw new Error();
      return this.tween(r, function (t, n, e) {
        var r, i;
        function o() {
          var o = n.apply(this, arguments);
          return o !== i && (r = (i = o) && function (t, n, e) {
            return function (r) {
              this.style.setProperty(t, n(r), e);
            };
          }(t, o, e)), r;
        }
        return o._value = n, o;
      }(t, n, null == e ? "" : e));
    },
    text: function text(t) {
      return this.tween("text", "function" == typeof t ? function (t) {
        return function () {
          var n = t(this);
          this.textContent = null == n ? "" : n;
        };
      }(Ar(this, "text", t)) : function (t) {
        return function () {
          this.textContent = t;
        };
      }(null == t ? "" : t + ""));
    },
    remove: function remove() {
      return this.on("end.remove", (t = this._id, function () {
        var n = this.parentNode;
        for (var e in this.__transition) if (+e !== t) return;
        n && n.removeChild(this);
      }));
      var t;
    },
    tween: function tween(t, n) {
      var e = this._id;
      if (t += "", arguments.length < 2) {
        for (var r, i = Mr(this.node(), e).tween, o = 0, a = i.length; o < a; ++o) if ((r = i[o]).name === t) return r.value;
        return null;
      }
      return this.each((null == n ? function (t, n) {
        var e, r;
        return function () {
          var i = wr(this, t),
            o = i.tween;
          if (o !== e) for (var a = 0, u = (r = e = o).length; a < u; ++a) if (r[a].name === n) {
            (r = r.slice()).splice(a, 1);
            break;
          }
          i.tween = r;
        };
      } : function (t, n, e) {
        var r, i;
        if ("function" != typeof e) throw new Error();
        return function () {
          var o = wr(this, t),
            a = o.tween;
          if (a !== r) {
            i = (r = a).slice();
            for (var u = {
                name: n,
                value: e
              }, c = 0, f = i.length; c < f; ++c) if (i[c].name === n) {
              i[c] = u;
              break;
            }
            c === f && i.push(u);
          }
          o.tween = i;
        };
      })(e, t, n));
    },
    delay: function delay(t) {
      var n = this._id;
      return arguments.length ? this.each(("function" == typeof t ? function (t, n) {
        return function () {
          xr(this, t).delay = +n.apply(this, arguments);
        };
      } : function (t, n) {
        return n = +n, function () {
          xr(this, t).delay = n;
        };
      })(n, t)) : Mr(this.node(), n).delay;
    },
    duration: function duration(t) {
      var n = this._id;
      return arguments.length ? this.each(("function" == typeof t ? function (t, n) {
        return function () {
          wr(this, t).duration = +n.apply(this, arguments);
        };
      } : function (t, n) {
        return n = +n, function () {
          wr(this, t).duration = n;
        };
      })(n, t)) : Mr(this.node(), n).duration;
    },
    ease: function ease(t) {
      var n = this._id;
      return arguments.length ? this.each(function (t, n) {
        if ("function" != typeof n) throw new Error();
        return function () {
          wr(this, t).ease = n;
        };
      }(n, t)) : Mr(this.node(), n).ease;
    },
    end: function end() {
      var t,
        n,
        e = this,
        r = e._id,
        i = e.size();
      return new Promise(function (o, a) {
        var u = {
            value: a
          },
          c = {
            value: function value() {
              0 == --i && o();
            }
          };
        e.each(function () {
          var e = wr(this, r),
            i = e.on;
          i !== t && ((n = (t = i).copy())._.cancel.push(u), n._.interrupt.push(u), n._.end.push(c)), e.on = n;
        });
      });
    }
  };
  var Lr = function t(n) {
      function e(t) {
        return Math.pow(t, n);
      }
      return n = +n, e.exponent = t, e;
    }(3),
    Ur = function t(n) {
      function e(t) {
        return 1 - Math.pow(1 - t, n);
      }
      return n = +n, e.exponent = t, e;
    }(3),
    Or = function t(n) {
      function e(t) {
        return ((t *= 2) <= 1 ? Math.pow(t, n) : 2 - Math.pow(2 - t, n)) / 2;
      }
      return n = +n, e.exponent = t, e;
    }(3),
    Br = Math.PI,
    Yr = Br / 2;
  function Fr(t) {
    return (1 - Math.cos(Br * t)) / 2;
  }
  function Ir(t) {
    return ((t *= 2) <= 1 ? Math.pow(2, 10 * t - 10) : 2 - Math.pow(2, 10 - 10 * t)) / 2;
  }
  function jr(t) {
    return ((t *= 2) <= 1 ? 1 - Math.sqrt(1 - t * t) : Math.sqrt(1 - (t -= 2) * t) + 1) / 2;
  }
  var Hr = 4 / 11,
    Xr = 6 / 11,
    Gr = 8 / 11,
    Vr = .75,
    $r = 9 / 11,
    Wr = 10 / 11,
    Zr = .9375,
    Qr = 21 / 22,
    Jr = 63 / 64,
    Kr = 1 / Hr / Hr;
  function ti(t) {
    return (t = +t) < Hr ? Kr * t * t : t < Gr ? Kr * (t -= Xr) * t + Vr : t < Wr ? Kr * (t -= $r) * t + Zr : Kr * (t -= Qr) * t + Jr;
  }
  var ni = function t(n) {
      function e(t) {
        return t * t * ((n + 1) * t - n);
      }
      return n = +n, e.overshoot = t, e;
    }(1.70158),
    ei = function t(n) {
      function e(t) {
        return --t * t * ((n + 1) * t + n) + 1;
      }
      return n = +n, e.overshoot = t, e;
    }(1.70158),
    ri = function t(n) {
      function e(t) {
        return ((t *= 2) < 1 ? t * t * ((n + 1) * t - n) : (t -= 2) * t * ((n + 1) * t + n) + 2) / 2;
      }
      return n = +n, e.overshoot = t, e;
    }(1.70158),
    ii = 2 * Math.PI,
    oi = function t(n, e) {
      var r = Math.asin(1 / (n = Math.max(1, n))) * (e /= ii);
      function i(t) {
        return n * Math.pow(2, 10 * --t) * Math.sin((r - t) / e);
      }
      return i.amplitude = function (n) {
        return t(n, e * ii);
      }, i.period = function (e) {
        return t(n, e);
      }, i;
    }(1, .3),
    ai = function t(n, e) {
      var r = Math.asin(1 / (n = Math.max(1, n))) * (e /= ii);
      function i(t) {
        return 1 - n * Math.pow(2, -10 * (t = +t)) * Math.sin((t + r) / e);
      }
      return i.amplitude = function (n) {
        return t(n, e * ii);
      }, i.period = function (e) {
        return t(n, e);
      }, i;
    }(1, .3),
    ui = function t(n, e) {
      var r = Math.asin(1 / (n = Math.max(1, n))) * (e /= ii);
      function i(t) {
        return ((t = 2 * t - 1) < 0 ? n * Math.pow(2, 10 * t) * Math.sin((r - t) / e) : 2 - n * Math.pow(2, -10 * t) * Math.sin((r + t) / e)) / 2;
      }
      return i.amplitude = function (n) {
        return t(n, e * ii);
      }, i.period = function (e) {
        return t(n, e);
      }, i;
    }(1, .3),
    ci = {
      time: null,
      delay: 0,
      duration: 250,
      ease: qr
    };
  function fi(t, n) {
    for (var e; !(e = t.__transition) || !(e = e[n]);) if (!(t = t.parentNode)) return ci.time = er(), ci;
    return e;
  }
  Pt.prototype.interrupt = function (t) {
    return this.each(function () {
      Nr(this, t);
    });
  }, Pt.prototype.transition = function (t) {
    var n, e;
    t instanceof Cr ? (n = t._id, t = t._name) : (n = zr(), (e = ci).time = er(), t = null == t ? null : t + "");
    for (var r = this._groups, i = r.length, o = 0; o < i; ++o) for (var a, u = r[o], c = u.length, f = 0; f < c; ++f) (a = u[f]) && mr(a, t, n, f, u, e || fi(a, n));
    return new Cr(r, this._parents, t, n);
  };
  var si = [null];
  function li(t) {
    return function () {
      return t;
    };
  }
  function hi(t, n, e) {
    this.target = t, this.type = n, this.selection = e;
  }
  function di() {
    t.event.stopImmediatePropagation();
  }
  function pi() {
    t.event.preventDefault(), t.event.stopImmediatePropagation();
  }
  var vi = {
      name: "drag"
    },
    gi = {
      name: "space"
    },
    yi = {
      name: "handle"
    },
    _i = {
      name: "center"
    },
    bi = {
      name: "x",
      handles: ["e", "w"].map(Si),
      input: function input(t, n) {
        return t && [[t[0], n[0][1]], [t[1], n[1][1]]];
      },
      output: function output(t) {
        return t && [t[0][0], t[1][0]];
      }
    },
    mi = {
      name: "y",
      handles: ["n", "s"].map(Si),
      input: function input(t, n) {
        return t && [[n[0][0], t[0]], [n[1][0], t[1]]];
      },
      output: function output(t) {
        return t && [t[0][1], t[1][1]];
      }
    },
    xi = {
      name: "xy",
      handles: ["n", "e", "s", "w", "nw", "ne", "se", "sw"].map(Si),
      input: function input(t) {
        return t;
      },
      output: function output(t) {
        return t;
      }
    },
    wi = {
      overlay: "crosshair",
      selection: "move",
      n: "ns-resize",
      e: "ew-resize",
      s: "ns-resize",
      w: "ew-resize",
      nw: "nwse-resize",
      ne: "nesw-resize",
      se: "nwse-resize",
      sw: "nesw-resize"
    },
    Mi = {
      e: "w",
      w: "e",
      nw: "ne",
      ne: "nw",
      se: "sw",
      sw: "se"
    },
    Ni = {
      n: "s",
      s: "n",
      nw: "sw",
      ne: "se",
      se: "ne",
      sw: "nw"
    },
    Ai = {
      overlay: 1,
      selection: 1,
      n: null,
      e: 1,
      s: null,
      w: -1,
      nw: -1,
      ne: 1,
      se: 1,
      sw: -1
    },
    Ti = {
      overlay: 1,
      selection: 1,
      n: -1,
      e: null,
      s: 1,
      w: null,
      nw: -1,
      ne: -1,
      se: 1,
      sw: 1
    };
  function Si(t) {
    return {
      type: t
    };
  }
  function ki() {
    return !t.event.button;
  }
  function Ei() {
    var t = this.ownerSVGElement || this;
    return [[0, 0], [t.width.baseVal.value, t.height.baseVal.value]];
  }
  function Ci(t) {
    for (; !t.__brush;) if (!(t = t.parentNode)) return;
    return t.__brush;
  }
  function Pi(t) {
    return t[0][0] === t[1][0] || t[0][1] === t[1][1];
  }
  function zi(n) {
    var e,
      r = Ei,
      i = ki,
      o = I(u, "start", "brush", "end"),
      a = 6;
    function u(t) {
      var e = t.property("__brush", h).selectAll(".overlay").data([Si("overlay")]);
      e.enter().append("rect").attr("class", "overlay").attr("pointer-events", "all").attr("cursor", wi.overlay).merge(e).each(function () {
        var t = Ci(this).extent;
        zt(this).attr("x", t[0][0]).attr("y", t[0][1]).attr("width", t[1][0] - t[0][0]).attr("height", t[1][1] - t[0][1]);
      }), t.selectAll(".selection").data([Si("selection")]).enter().append("rect").attr("class", "selection").attr("cursor", wi.selection).attr("fill", "#777").attr("fill-opacity", .3).attr("stroke", "#fff").attr("shape-rendering", "crispEdges");
      var r = t.selectAll(".handle").data(n.handles, function (t) {
        return t.type;
      });
      r.exit().remove(), r.enter().append("rect").attr("class", function (t) {
        return "handle handle--" + t.type;
      }).attr("cursor", function (t) {
        return wi[t.type];
      }), t.each(c).attr("fill", "none").attr("pointer-events", "all").style("-webkit-tap-highlight-color", "rgba(0,0,0,0)").on("mousedown.brush touchstart.brush", l);
    }
    function c() {
      var t = zt(this),
        n = Ci(this).selection;
      n ? (t.selectAll(".selection").style("display", null).attr("x", n[0][0]).attr("y", n[0][1]).attr("width", n[1][0] - n[0][0]).attr("height", n[1][1] - n[0][1]), t.selectAll(".handle").style("display", null).attr("x", function (t) {
        return "e" === t.type[t.type.length - 1] ? n[1][0] - a / 2 : n[0][0] - a / 2;
      }).attr("y", function (t) {
        return "s" === t.type[0] ? n[1][1] - a / 2 : n[0][1] - a / 2;
      }).attr("width", function (t) {
        return "n" === t.type || "s" === t.type ? n[1][0] - n[0][0] + a : a;
      }).attr("height", function (t) {
        return "e" === t.type || "w" === t.type ? n[1][1] - n[0][1] + a : a;
      })) : t.selectAll(".selection,.handle").style("display", "none").attr("x", null).attr("y", null).attr("width", null).attr("height", null);
    }
    function f(t, n) {
      return t.__brush.emitter || new s(t, n);
    }
    function s(t, n) {
      this.that = t, this.args = n, this.state = t.__brush, this.active = 0;
    }
    function l() {
      if (t.event.touches) {
        if (t.event.changedTouches.length < t.event.touches.length) return pi();
      } else if (e) return;
      if (i.apply(this, arguments)) {
        var r,
          o,
          a,
          u,
          s,
          l,
          h,
          d,
          p,
          v,
          g,
          y,
          _,
          b = this,
          m = t.event.target.__data__.type,
          x = "selection" === (t.event.metaKey ? m = "overlay" : m) ? vi : t.event.altKey ? _i : yi,
          w = n === mi ? null : Ai[m],
          M = n === bi ? null : Ti[m],
          N = Ci(b),
          A = N.extent,
          T = N.selection,
          S = A[0][0],
          k = A[0][1],
          E = A[1][0],
          C = A[1][1],
          P = w && M && t.event.shiftKey,
          z = Ot(b),
          R = z,
          D = f(b, arguments).beforestart();
        "overlay" === m ? N.selection = T = [[r = n === mi ? S : z[0], a = n === bi ? k : z[1]], [s = n === mi ? E : r, h = n === bi ? C : a]] : (r = T[0][0], a = T[0][1], s = T[1][0], h = T[1][1]), o = r, u = a, l = s, d = h;
        var q = zt(b).attr("pointer-events", "none"),
          L = q.selectAll(".overlay").attr("cursor", wi[m]);
        if (t.event.touches) q.on("touchmove.brush", O, !0).on("touchend.brush touchcancel.brush", Y, !0);else {
          var U = zt(t.event.view).on("keydown.brush", function () {
            switch (t.event.keyCode) {
              case 16:
                P = w && M;
                break;
              case 18:
                x === yi && (w && (s = l - p * w, r = o + p * w), M && (h = d - v * M, a = u + v * M), x = _i, B());
                break;
              case 32:
                x !== yi && x !== _i || (w < 0 ? s = l - p : w > 0 && (r = o - p), M < 0 ? h = d - v : M > 0 && (a = u - v), x = gi, L.attr("cursor", wi.selection), B());
                break;
              default:
                return;
            }
            pi();
          }, !0).on("keyup.brush", function () {
            switch (t.event.keyCode) {
              case 16:
                P && (y = _ = P = !1, B());
                break;
              case 18:
                x === _i && (w < 0 ? s = l : w > 0 && (r = o), M < 0 ? h = d : M > 0 && (a = u), x = yi, B());
                break;
              case 32:
                x === gi && (t.event.altKey ? (w && (s = l - p * w, r = o + p * w), M && (h = d - v * M, a = u + v * M), x = _i) : (w < 0 ? s = l : w > 0 && (r = o), M < 0 ? h = d : M > 0 && (a = u), x = yi), L.attr("cursor", wi[m]), B());
                break;
              default:
                return;
            }
            pi();
          }, !0).on("mousemove.brush", O, !0).on("mouseup.brush", Y, !0);
          It(t.event.view);
        }
        di(), Nr(b), c.call(b), D.start();
      }
      function O() {
        var t = Ot(b);
        !P || y || _ || (Math.abs(t[0] - R[0]) > Math.abs(t[1] - R[1]) ? _ = !0 : y = !0), R = t, g = !0, pi(), B();
      }
      function B() {
        var t;
        switch (p = R[0] - z[0], v = R[1] - z[1], x) {
          case gi:
          case vi:
            w && (p = Math.max(S - r, Math.min(E - s, p)), o = r + p, l = s + p), M && (v = Math.max(k - a, Math.min(C - h, v)), u = a + v, d = h + v);
            break;
          case yi:
            w < 0 ? (p = Math.max(S - r, Math.min(E - r, p)), o = r + p, l = s) : w > 0 && (p = Math.max(S - s, Math.min(E - s, p)), o = r, l = s + p), M < 0 ? (v = Math.max(k - a, Math.min(C - a, v)), u = a + v, d = h) : M > 0 && (v = Math.max(k - h, Math.min(C - h, v)), u = a, d = h + v);
            break;
          case _i:
            w && (o = Math.max(S, Math.min(E, r - p * w)), l = Math.max(S, Math.min(E, s + p * w))), M && (u = Math.max(k, Math.min(C, a - v * M)), d = Math.max(k, Math.min(C, h + v * M)));
        }
        l < o && (w *= -1, t = r, r = s, s = t, t = o, o = l, l = t, m in Mi && L.attr("cursor", wi[m = Mi[m]])), d < u && (M *= -1, t = a, a = h, h = t, t = u, u = d, d = t, m in Ni && L.attr("cursor", wi[m = Ni[m]])), N.selection && (T = N.selection), y && (o = T[0][0], l = T[1][0]), _ && (u = T[0][1], d = T[1][1]), T[0][0] === o && T[0][1] === u && T[1][0] === l && T[1][1] === d || (N.selection = [[o, u], [l, d]], c.call(b), D.brush());
      }
      function Y() {
        if (di(), t.event.touches) {
          if (t.event.touches.length) return;
          e && clearTimeout(e), e = setTimeout(function () {
            e = null;
          }, 500), q.on("touchmove.brush touchend.brush touchcancel.brush", null);
        } else jt(t.event.view, g), U.on("keydown.brush keyup.brush mousemove.brush mouseup.brush", null);
        q.attr("pointer-events", "all"), L.attr("cursor", wi.overlay), N.selection && (T = N.selection), Pi(T) && (N.selection = null, c.call(b)), D.end();
      }
    }
    function h() {
      var t = this.__brush || {
        selection: null
      };
      return t.extent = r.apply(this, arguments), t.dim = n, t;
    }
    return u.move = function (t, e) {
      t.selection ? t.on("start.brush", function () {
        f(this, arguments).beforestart().start();
      }).on("interrupt.brush end.brush", function () {
        f(this, arguments).end();
      }).tween("brush", function () {
        var t = this,
          r = t.__brush,
          i = f(t, arguments),
          o = r.selection,
          a = n.input("function" == typeof e ? e.apply(this, arguments) : e, r.extent),
          u = _e(o, a);
        function s(n) {
          r.selection = 1 === n && Pi(a) ? null : u(n), c.call(t), i.brush();
        }
        return o && a ? s : s(1);
      }) : t.each(function () {
        var t = arguments,
          r = this.__brush,
          i = n.input("function" == typeof e ? e.apply(this, t) : e, r.extent),
          o = f(this, t).beforestart();
        Nr(this), r.selection = null == i || Pi(i) ? null : i, c.call(this), o.start().brush().end();
      });
    }, s.prototype = {
      beforestart: function beforestart() {
        return 1 == ++this.active && (this.state.emitter = this, this.starting = !0), this;
      },
      start: function start() {
        return this.starting && (this.starting = !1, this.emit("start")), this;
      },
      brush: function brush() {
        return this.emit("brush"), this;
      },
      end: function end() {
        return 0 == --this.active && (delete this.state.emitter, this.emit("end")), this;
      },
      emit: function emit(t) {
        St(new hi(u, t, n.output(this.state.selection)), o.apply, o, [t, this.that, this.args]);
      }
    }, u.extent = function (t) {
      return arguments.length ? (r = "function" == typeof t ? t : li([[+t[0][0], +t[0][1]], [+t[1][0], +t[1][1]]]), u) : r;
    }, u.filter = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : li(!!t), u) : i;
    }, u.handleSize = function (t) {
      return arguments.length ? (a = +t, u) : a;
    }, u.on = function () {
      var t = o.on.apply(o, arguments);
      return t === o ? u : t;
    }, u;
  }
  var Ri = Math.cos,
    Di = Math.sin,
    qi = Math.PI,
    Li = qi / 2,
    Ui = 2 * qi,
    Oi = Math.max;
  var Bi = Array.prototype.slice;
  function Yi(t) {
    return function () {
      return t;
    };
  }
  var Fi = Math.PI,
    Ii = 2 * Fi,
    ji = Ii - 1e-6;
  function Hi() {
    this._x0 = this._y0 = this._x1 = this._y1 = null, this._ = "";
  }
  function Xi() {
    return new Hi();
  }
  function Gi(t) {
    return t.source;
  }
  function Vi(t) {
    return t.target;
  }
  function $i(t) {
    return t.radius;
  }
  function Wi(t) {
    return t.startAngle;
  }
  function Zi(t) {
    return t.endAngle;
  }
  Hi.prototype = Xi.prototype = {
    constructor: Hi,
    moveTo: function moveTo(t, n) {
      this._ += "M" + (this._x0 = this._x1 = +t) + "," + (this._y0 = this._y1 = +n);
    },
    closePath: function closePath() {
      null !== this._x1 && (this._x1 = this._x0, this._y1 = this._y0, this._ += "Z");
    },
    lineTo: function lineTo(t, n) {
      this._ += "L" + (this._x1 = +t) + "," + (this._y1 = +n);
    },
    quadraticCurveTo: function quadraticCurveTo(t, n, e, r) {
      this._ += "Q" + +t + "," + +n + "," + (this._x1 = +e) + "," + (this._y1 = +r);
    },
    bezierCurveTo: function bezierCurveTo(t, n, e, r, i, o) {
      this._ += "C" + +t + "," + +n + "," + +e + "," + +r + "," + (this._x1 = +i) + "," + (this._y1 = +o);
    },
    arcTo: function arcTo(t, n, e, r, i) {
      t = +t, n = +n, e = +e, r = +r, i = +i;
      var o = this._x1,
        a = this._y1,
        u = e - t,
        c = r - n,
        f = o - t,
        s = a - n,
        l = f * f + s * s;
      if (i < 0) throw new Error("negative radius: " + i);
      if (null === this._x1) this._ += "M" + (this._x1 = t) + "," + (this._y1 = n);else if (l > 1e-6) {
        if (Math.abs(s * u - c * f) > 1e-6 && i) {
          var h = e - o,
            d = r - a,
            p = u * u + c * c,
            v = h * h + d * d,
            g = Math.sqrt(p),
            y = Math.sqrt(l),
            _ = i * Math.tan((Fi - Math.acos((p + l - v) / (2 * g * y))) / 2),
            b = _ / y,
            m = _ / g;
          Math.abs(b - 1) > 1e-6 && (this._ += "L" + (t + b * f) + "," + (n + b * s)), this._ += "A" + i + "," + i + ",0,0," + +(s * h > f * d) + "," + (this._x1 = t + m * u) + "," + (this._y1 = n + m * c);
        } else this._ += "L" + (this._x1 = t) + "," + (this._y1 = n);
      } else ;
    },
    arc: function arc(t, n, e, r, i, o) {
      t = +t, n = +n;
      var a = (e = +e) * Math.cos(r),
        u = e * Math.sin(r),
        c = t + a,
        f = n + u,
        s = 1 ^ o,
        l = o ? r - i : i - r;
      if (e < 0) throw new Error("negative radius: " + e);
      null === this._x1 ? this._ += "M" + c + "," + f : (Math.abs(this._x1 - c) > 1e-6 || Math.abs(this._y1 - f) > 1e-6) && (this._ += "L" + c + "," + f), e && (l < 0 && (l = l % Ii + Ii), l > ji ? this._ += "A" + e + "," + e + ",0,1," + s + "," + (t - a) + "," + (n - u) + "A" + e + "," + e + ",0,1," + s + "," + (this._x1 = c) + "," + (this._y1 = f) : l > 1e-6 && (this._ += "A" + e + "," + e + ",0," + +(l >= Fi) + "," + s + "," + (this._x1 = t + e * Math.cos(i)) + "," + (this._y1 = n + e * Math.sin(i))));
    },
    rect: function rect(t, n, e, r) {
      this._ += "M" + (this._x0 = this._x1 = +t) + "," + (this._y0 = this._y1 = +n) + "h" + +e + "v" + +r + "h" + -e + "Z";
    },
    toString: function toString() {
      return this._;
    }
  };
  function Qi() {}
  function Ji(t, n) {
    var e = new Qi();
    if (t instanceof Qi) t.each(function (t, n) {
      e.set(n, t);
    });else if (Array.isArray(t)) {
      var r,
        i = -1,
        o = t.length;
      if (null == n) for (; ++i < o;) e.set(i, t[i]);else for (; ++i < o;) e.set(n(r = t[i], i, t), r);
    } else if (t) for (var a in t) e.set(a, t[a]);
    return e;
  }
  function Ki() {
    return {};
  }
  function to(t, n, e) {
    t[n] = e;
  }
  function no() {
    return Ji();
  }
  function eo(t, n, e) {
    t.set(n, e);
  }
  function ro() {}
  Qi.prototype = Ji.prototype = {
    constructor: Qi,
    has: function has(t) {
      return "$" + t in this;
    },
    get: function get(t) {
      return this["$" + t];
    },
    set: function set(t, n) {
      return this["$" + t] = n, this;
    },
    remove: function remove(t) {
      var n = "$" + t;
      return n in this && delete this[n];
    },
    clear: function clear() {
      for (var t in this) "$" === t[0] && delete this[t];
    },
    keys: function keys() {
      var t = [];
      for (var n in this) "$" === n[0] && t.push(n.slice(1));
      return t;
    },
    values: function values() {
      var t = [];
      for (var n in this) "$" === n[0] && t.push(this[n]);
      return t;
    },
    entries: function entries() {
      var t = [];
      for (var n in this) "$" === n[0] && t.push({
        key: n.slice(1),
        value: this[n]
      });
      return t;
    },
    size: function size() {
      var t = 0;
      for (var n in this) "$" === n[0] && ++t;
      return t;
    },
    empty: function empty() {
      for (var t in this) if ("$" === t[0]) return !1;
      return !0;
    },
    each: function each(t) {
      for (var n in this) "$" === n[0] && t(this[n], n.slice(1), this);
    }
  };
  var io = Ji.prototype;
  function oo(t, n) {
    var e = new ro();
    if (t instanceof ro) t.each(function (t) {
      e.add(t);
    });else if (t) {
      var r = -1,
        i = t.length;
      if (null == n) for (; ++r < i;) e.add(t[r]);else for (; ++r < i;) e.add(n(t[r], r, t));
    }
    return e;
  }
  ro.prototype = oo.prototype = {
    constructor: ro,
    has: io.has,
    add: function add(t) {
      return this["$" + (t += "")] = t, this;
    },
    remove: io.remove,
    clear: io.clear,
    values: io.keys,
    size: io.size,
    empty: io.empty,
    each: io.each
  };
  var ao = Array.prototype.slice;
  function uo(t, n) {
    return t - n;
  }
  function co(t) {
    return function () {
      return t;
    };
  }
  function fo(t, n) {
    for (var e, r = -1, i = n.length; ++r < i;) if (e = so(t, n[r])) return e;
    return 0;
  }
  function so(t, n) {
    for (var e = n[0], r = n[1], i = -1, o = 0, a = t.length, u = a - 1; o < a; u = o++) {
      var c = t[o],
        f = c[0],
        s = c[1],
        l = t[u],
        h = l[0],
        d = l[1];
      if (lo(c, l, n)) return 0;
      s > r != d > r && e < (h - f) * (r - s) / (d - s) + f && (i = -i);
    }
    return i;
  }
  function lo(t, n, e) {
    var r, i, o, a;
    return function (t, n, e) {
      return (n[0] - t[0]) * (e[1] - t[1]) == (e[0] - t[0]) * (n[1] - t[1]);
    }(t, n, e) && (i = t[r = +(t[0] === n[0])], o = e[r], a = n[r], i <= o && o <= a || a <= o && o <= i);
  }
  function ho() {}
  var po = [[], [[[1, 1.5], [.5, 1]]], [[[1.5, 1], [1, 1.5]]], [[[1.5, 1], [.5, 1]]], [[[1, .5], [1.5, 1]]], [[[1, 1.5], [.5, 1]], [[1, .5], [1.5, 1]]], [[[1, .5], [1, 1.5]]], [[[1, .5], [.5, 1]]], [[[.5, 1], [1, .5]]], [[[1, 1.5], [1, .5]]], [[[.5, 1], [1, .5]], [[1.5, 1], [1, 1.5]]], [[[1.5, 1], [1, .5]]], [[[.5, 1], [1.5, 1]]], [[[1, 1.5], [1.5, 1]]], [[[.5, 1], [1, 1.5]]], []];
  function vo() {
    var t = 1,
      n = 1,
      e = M,
      r = u;
    function i(t) {
      var n = e(t);
      if (Array.isArray(n)) n = n.slice().sort(uo);else {
        var r = s(t),
          i = r[0],
          a = r[1];
        n = w(i, a, n), n = g(Math.floor(i / n) * n, Math.floor(a / n) * n, n);
      }
      return n.map(function (n) {
        return o(t, n);
      });
    }
    function o(e, i) {
      var o = [],
        u = [];
      return function (e, r, i) {
        var o,
          u,
          c,
          f,
          s,
          l,
          h = new Array(),
          d = new Array();
        o = u = -1, f = e[0] >= r, po[f << 1].forEach(p);
        for (; ++o < t - 1;) c = f, f = e[o + 1] >= r, po[c | f << 1].forEach(p);
        po[f << 0].forEach(p);
        for (; ++u < n - 1;) {
          for (o = -1, f = e[u * t + t] >= r, s = e[u * t] >= r, po[f << 1 | s << 2].forEach(p); ++o < t - 1;) c = f, f = e[u * t + t + o + 1] >= r, l = s, s = e[u * t + o + 1] >= r, po[c | f << 1 | s << 2 | l << 3].forEach(p);
          po[f | s << 3].forEach(p);
        }
        o = -1, s = e[u * t] >= r, po[s << 2].forEach(p);
        for (; ++o < t - 1;) l = s, s = e[u * t + o + 1] >= r, po[s << 2 | l << 3].forEach(p);
        function p(t) {
          var n,
            e,
            r = [t[0][0] + o, t[0][1] + u],
            c = [t[1][0] + o, t[1][1] + u],
            f = a(r),
            s = a(c);
          (n = d[f]) ? (e = h[s]) ? (delete d[n.end], delete h[e.start], n === e ? (n.ring.push(c), i(n.ring)) : h[n.start] = d[e.end] = {
            start: n.start,
            end: e.end,
            ring: n.ring.concat(e.ring)
          }) : (delete d[n.end], n.ring.push(c), d[n.end = s] = n) : (n = h[s]) ? (e = d[f]) ? (delete h[n.start], delete d[e.end], n === e ? (n.ring.push(c), i(n.ring)) : h[e.start] = d[n.end] = {
            start: e.start,
            end: n.end,
            ring: e.ring.concat(n.ring)
          }) : (delete h[n.start], n.ring.unshift(r), h[n.start = f] = n) : h[f] = d[s] = {
            start: f,
            end: s,
            ring: [r, c]
          };
        }
        po[s << 3].forEach(p);
      }(e, i, function (t) {
        r(t, e, i), function (t) {
          for (var n = 0, e = t.length, r = t[e - 1][1] * t[0][0] - t[e - 1][0] * t[0][1]; ++n < e;) r += t[n - 1][1] * t[n][0] - t[n - 1][0] * t[n][1];
          return r;
        }(t) > 0 ? o.push([t]) : u.push(t);
      }), u.forEach(function (t) {
        for (var n, e = 0, r = o.length; e < r; ++e) if (-1 !== fo((n = o[e])[0], t)) return void n.push(t);
      }), {
        type: "MultiPolygon",
        value: i,
        coordinates: o
      };
    }
    function a(n) {
      return 2 * n[0] + n[1] * (t + 1) * 4;
    }
    function u(e, r, i) {
      e.forEach(function (e) {
        var o,
          a = e[0],
          u = e[1],
          c = 0 | a,
          f = 0 | u,
          s = r[f * t + c];
        a > 0 && a < t && c === a && (o = r[f * t + c - 1], e[0] = a + (i - o) / (s - o) - .5), u > 0 && u < n && f === u && (o = r[(f - 1) * t + c], e[1] = u + (i - o) / (s - o) - .5);
      });
    }
    return i.contour = o, i.size = function (e) {
      if (!arguments.length) return [t, n];
      var r = Math.ceil(e[0]),
        o = Math.ceil(e[1]);
      if (!(r > 0 && o > 0)) throw new Error("invalid size");
      return t = r, n = o, i;
    }, i.thresholds = function (t) {
      return arguments.length ? (e = "function" == typeof t ? t : Array.isArray(t) ? co(ao.call(t)) : co(t), i) : e;
    }, i.smooth = function (t) {
      return arguments.length ? (r = t ? u : ho, i) : r === u;
    }, i;
  }
  function go(t, n, e) {
    for (var r = t.width, i = t.height, o = 1 + (e << 1), a = 0; a < i; ++a) for (var u = 0, c = 0; u < r + e; ++u) u < r && (c += t.data[u + a * r]), u >= e && (u >= o && (c -= t.data[u - o + a * r]), n.data[u - e + a * r] = c / Math.min(u + 1, r - 1 + o - u, o));
  }
  function yo(t, n, e) {
    for (var r = t.width, i = t.height, o = 1 + (e << 1), a = 0; a < r; ++a) for (var u = 0, c = 0; u < i + e; ++u) u < i && (c += t.data[a + u * r]), u >= e && (u >= o && (c -= t.data[a + (u - o) * r]), n.data[a + (u - e) * r] = c / Math.min(u + 1, i - 1 + o - u, o));
  }
  function _o(t) {
    return t[0];
  }
  function bo(t) {
    return t[1];
  }
  function mo() {
    return 1;
  }
  var xo = {},
    wo = {},
    Mo = 34,
    No = 10,
    Ao = 13;
  function To(t) {
    return new Function("d", "return {" + t.map(function (t, n) {
      return JSON.stringify(t) + ": d[" + n + "]";
    }).join(",") + "}");
  }
  function So(t) {
    var n = Object.create(null),
      e = [];
    return t.forEach(function (t) {
      for (var r in t) r in n || e.push(n[r] = r);
    }), e;
  }
  function ko(t, n) {
    var e = t + "",
      r = e.length;
    return r < n ? new Array(n - r + 1).join(0) + e : e;
  }
  function Eo(t) {
    var n,
      e = t.getUTCHours(),
      r = t.getUTCMinutes(),
      i = t.getUTCSeconds(),
      o = t.getUTCMilliseconds();
    return isNaN(t) ? "Invalid Date" : ((n = t.getUTCFullYear()) < 0 ? "-" + ko(-n, 6) : n > 9999 ? "+" + ko(n, 6) : ko(n, 4)) + "-" + ko(t.getUTCMonth() + 1, 2) + "-" + ko(t.getUTCDate(), 2) + (o ? "T" + ko(e, 2) + ":" + ko(r, 2) + ":" + ko(i, 2) + "." + ko(o, 3) + "Z" : i ? "T" + ko(e, 2) + ":" + ko(r, 2) + ":" + ko(i, 2) + "Z" : r || e ? "T" + ko(e, 2) + ":" + ko(r, 2) + "Z" : "");
  }
  function Co(t) {
    var n = new RegExp('["' + t + "\n\r]"),
      e = t.charCodeAt(0);
    function r(t, n) {
      var r,
        i = [],
        o = t.length,
        a = 0,
        u = 0,
        c = o <= 0,
        f = !1;
      function s() {
        if (c) return wo;
        if (f) return f = !1, xo;
        var n,
          r,
          i = a;
        if (t.charCodeAt(i) === Mo) {
          for (; a++ < o && t.charCodeAt(a) !== Mo || t.charCodeAt(++a) === Mo;);
          return (n = a) >= o ? c = !0 : (r = t.charCodeAt(a++)) === No ? f = !0 : r === Ao && (f = !0, t.charCodeAt(a) === No && ++a), t.slice(i + 1, n - 1).replace(/""/g, '"');
        }
        for (; a < o;) {
          if ((r = t.charCodeAt(n = a++)) === No) f = !0;else if (r === Ao) f = !0, t.charCodeAt(a) === No && ++a;else if (r !== e) continue;
          return t.slice(i, n);
        }
        return c = !0, t.slice(i, o);
      }
      for (t.charCodeAt(o - 1) === No && --o, t.charCodeAt(o - 1) === Ao && --o; (r = s()) !== wo;) {
        for (var l = []; r !== xo && r !== wo;) l.push(r), r = s();
        n && null == (l = n(l, u++)) || i.push(l);
      }
      return i;
    }
    function i(n, e) {
      return n.map(function (n) {
        return e.map(function (t) {
          return a(n[t]);
        }).join(t);
      });
    }
    function o(n) {
      return n.map(a).join(t);
    }
    function a(t) {
      return null == t ? "" : t instanceof Date ? Eo(t) : n.test(t += "") ? '"' + t.replace(/"/g, '""') + '"' : t;
    }
    return {
      parse: function parse(t, n) {
        var e,
          i,
          o = r(t, function (t, r) {
            if (e) return e(t, r - 1);
            i = t, e = n ? function (t, n) {
              var e = To(t);
              return function (r, i) {
                return n(e(r), i, t);
              };
            }(t, n) : To(t);
          });
        return o.columns = i || [], o;
      },
      parseRows: r,
      format: function format(n, e) {
        return null == e && (e = So(n)), [e.map(a).join(t)].concat(i(n, e)).join("\n");
      },
      formatBody: function formatBody(t, n) {
        return null == n && (n = So(t)), i(t, n).join("\n");
      },
      formatRows: function formatRows(t) {
        return t.map(o).join("\n");
      }
    };
  }
  var Po = Co(","),
    zo = Po.parse,
    Ro = Po.parseRows,
    Do = Po.format,
    qo = Po.formatBody,
    Lo = Po.formatRows,
    Uo = Co("\t"),
    Oo = Uo.parse,
    Bo = Uo.parseRows,
    Yo = Uo.format,
    Fo = Uo.formatBody,
    Io = Uo.formatRows;
  function jo(t) {
    if (!t.ok) throw new Error(t.status + " " + t.statusText);
    return t.blob();
  }
  function Ho(t) {
    if (!t.ok) throw new Error(t.status + " " + t.statusText);
    return t.arrayBuffer();
  }
  function Xo(t) {
    if (!t.ok) throw new Error(t.status + " " + t.statusText);
    return t.text();
  }
  function Go(t, n) {
    return fetch(t, n).then(Xo);
  }
  function Vo(t) {
    return function (n, e, r) {
      return 2 === arguments.length && "function" == typeof e && (r = e, e = void 0), Go(n, e).then(function (n) {
        return t(n, r);
      });
    };
  }
  var $o = Vo(zo),
    Wo = Vo(Oo);
  function Zo(t) {
    if (!t.ok) throw new Error(t.status + " " + t.statusText);
    return t.json();
  }
  function Qo(t) {
    return function (n, e) {
      return Go(n, e).then(function (n) {
        return new DOMParser().parseFromString(n, t);
      });
    };
  }
  var Jo = Qo("application/xml"),
    Ko = Qo("text/html"),
    ta = Qo("image/svg+xml");
  function na(t) {
    return function () {
      return t;
    };
  }
  function ea() {
    return 1e-6 * (Math.random() - .5);
  }
  function ra(t, n, e, r) {
    if (isNaN(n) || isNaN(e)) return t;
    var i,
      o,
      a,
      u,
      c,
      f,
      s,
      l,
      h,
      d = t._root,
      p = {
        data: r
      },
      v = t._x0,
      g = t._y0,
      y = t._x1,
      _ = t._y1;
    if (!d) return t._root = p, t;
    for (; d.length;) if ((f = n >= (o = (v + y) / 2)) ? v = o : y = o, (s = e >= (a = (g + _) / 2)) ? g = a : _ = a, i = d, !(d = d[l = s << 1 | f])) return i[l] = p, t;
    if (u = +t._x.call(null, d.data), c = +t._y.call(null, d.data), n === u && e === c) return p.next = d, i ? i[l] = p : t._root = p, t;
    do {
      i = i ? i[l] = new Array(4) : t._root = new Array(4), (f = n >= (o = (v + y) / 2)) ? v = o : y = o, (s = e >= (a = (g + _) / 2)) ? g = a : _ = a;
    } while ((l = s << 1 | f) == (h = (c >= a) << 1 | u >= o));
    return i[h] = d, i[l] = p, t;
  }
  function ia(t, n, e, r, i) {
    this.node = t, this.x0 = n, this.y0 = e, this.x1 = r, this.y1 = i;
  }
  function oa(t) {
    return t[0];
  }
  function aa(t) {
    return t[1];
  }
  function ua(t, n, e) {
    var r = new ca(null == n ? oa : n, null == e ? aa : e, NaN, NaN, NaN, NaN);
    return null == t ? r : r.addAll(t);
  }
  function ca(t, n, e, r, i, o) {
    this._x = t, this._y = n, this._x0 = e, this._y0 = r, this._x1 = i, this._y1 = o, this._root = void 0;
  }
  function fa(t) {
    for (var n = {
        data: t.data
      }, e = n; t = t.next;) e = e.next = {
      data: t.data
    };
    return n;
  }
  var sa = ua.prototype = ca.prototype;
  function la(t) {
    return t.x + t.vx;
  }
  function ha(t) {
    return t.y + t.vy;
  }
  function da(t) {
    return t.index;
  }
  function pa(t, n) {
    var e = t.get(n);
    if (!e) throw new Error("missing: " + n);
    return e;
  }
  function va(t) {
    return t.x;
  }
  function ga(t) {
    return t.y;
  }
  sa.copy = function () {
    var t,
      n,
      e = new ca(this._x, this._y, this._x0, this._y0, this._x1, this._y1),
      r = this._root;
    if (!r) return e;
    if (!r.length) return e._root = fa(r), e;
    for (t = [{
      source: r,
      target: e._root = new Array(4)
    }]; r = t.pop();) for (var i = 0; i < 4; ++i) (n = r.source[i]) && (n.length ? t.push({
      source: n,
      target: r.target[i] = new Array(4)
    }) : r.target[i] = fa(n));
    return e;
  }, sa.add = function (t) {
    var n = +this._x.call(null, t),
      e = +this._y.call(null, t);
    return ra(this.cover(n, e), n, e, t);
  }, sa.addAll = function (t) {
    var n,
      e,
      r,
      i,
      o = t.length,
      a = new Array(o),
      u = new Array(o),
      c = 1 / 0,
      f = 1 / 0,
      s = -1 / 0,
      l = -1 / 0;
    for (e = 0; e < o; ++e) isNaN(r = +this._x.call(null, n = t[e])) || isNaN(i = +this._y.call(null, n)) || (a[e] = r, u[e] = i, r < c && (c = r), r > s && (s = r), i < f && (f = i), i > l && (l = i));
    if (c > s || f > l) return this;
    for (this.cover(c, f).cover(s, l), e = 0; e < o; ++e) ra(this, a[e], u[e], t[e]);
    return this;
  }, sa.cover = function (t, n) {
    if (isNaN(t = +t) || isNaN(n = +n)) return this;
    var e = this._x0,
      r = this._y0,
      i = this._x1,
      o = this._y1;
    if (isNaN(e)) i = (e = Math.floor(t)) + 1, o = (r = Math.floor(n)) + 1;else {
      for (var a, u, c = i - e, f = this._root; e > t || t >= i || r > n || n >= o;) switch (u = (n < r) << 1 | t < e, (a = new Array(4))[u] = f, f = a, c *= 2, u) {
        case 0:
          i = e + c, o = r + c;
          break;
        case 1:
          e = i - c, o = r + c;
          break;
        case 2:
          i = e + c, r = o - c;
          break;
        case 3:
          e = i - c, r = o - c;
      }
      this._root && this._root.length && (this._root = f);
    }
    return this._x0 = e, this._y0 = r, this._x1 = i, this._y1 = o, this;
  }, sa.data = function () {
    var t = [];
    return this.visit(function (n) {
      if (!n.length) do {
        t.push(n.data);
      } while (n = n.next);
    }), t;
  }, sa.extent = function (t) {
    return arguments.length ? this.cover(+t[0][0], +t[0][1]).cover(+t[1][0], +t[1][1]) : isNaN(this._x0) ? void 0 : [[this._x0, this._y0], [this._x1, this._y1]];
  }, sa.find = function (t, n, e) {
    var r,
      i,
      o,
      a,
      u,
      c,
      f,
      s = this._x0,
      l = this._y0,
      h = this._x1,
      d = this._y1,
      p = [],
      v = this._root;
    for (v && p.push(new ia(v, s, l, h, d)), null == e ? e = 1 / 0 : (s = t - e, l = n - e, h = t + e, d = n + e, e *= e); c = p.pop();) if (!(!(v = c.node) || (i = c.x0) > h || (o = c.y0) > d || (a = c.x1) < s || (u = c.y1) < l)) if (v.length) {
      var g = (i + a) / 2,
        y = (o + u) / 2;
      p.push(new ia(v[3], g, y, a, u), new ia(v[2], i, y, g, u), new ia(v[1], g, o, a, y), new ia(v[0], i, o, g, y)), (f = (n >= y) << 1 | t >= g) && (c = p[p.length - 1], p[p.length - 1] = p[p.length - 1 - f], p[p.length - 1 - f] = c);
    } else {
      var _ = t - +this._x.call(null, v.data),
        b = n - +this._y.call(null, v.data),
        m = _ * _ + b * b;
      if (m < e) {
        var x = Math.sqrt(e = m);
        s = t - x, l = n - x, h = t + x, d = n + x, r = v.data;
      }
    }
    return r;
  }, sa.remove = function (t) {
    if (isNaN(o = +this._x.call(null, t)) || isNaN(a = +this._y.call(null, t))) return this;
    var n,
      e,
      r,
      i,
      o,
      a,
      u,
      c,
      f,
      s,
      l,
      h,
      d = this._root,
      p = this._x0,
      v = this._y0,
      g = this._x1,
      y = this._y1;
    if (!d) return this;
    if (d.length) for (;;) {
      if ((f = o >= (u = (p + g) / 2)) ? p = u : g = u, (s = a >= (c = (v + y) / 2)) ? v = c : y = c, n = d, !(d = d[l = s << 1 | f])) return this;
      if (!d.length) break;
      (n[l + 1 & 3] || n[l + 2 & 3] || n[l + 3 & 3]) && (e = n, h = l);
    }
    for (; d.data !== t;) if (r = d, !(d = d.next)) return this;
    return (i = d.next) && delete d.next, r ? (i ? r.next = i : delete r.next, this) : n ? (i ? n[l] = i : delete n[l], (d = n[0] || n[1] || n[2] || n[3]) && d === (n[3] || n[2] || n[1] || n[0]) && !d.length && (e ? e[h] = d : this._root = d), this) : (this._root = i, this);
  }, sa.removeAll = function (t) {
    for (var n = 0, e = t.length; n < e; ++n) this.remove(t[n]);
    return this;
  }, sa.root = function () {
    return this._root;
  }, sa.size = function () {
    var t = 0;
    return this.visit(function (n) {
      if (!n.length) do {
        ++t;
      } while (n = n.next);
    }), t;
  }, sa.visit = function (t) {
    var n,
      e,
      r,
      i,
      o,
      a,
      u = [],
      c = this._root;
    for (c && u.push(new ia(c, this._x0, this._y0, this._x1, this._y1)); n = u.pop();) if (!t(c = n.node, r = n.x0, i = n.y0, o = n.x1, a = n.y1) && c.length) {
      var f = (r + o) / 2,
        s = (i + a) / 2;
      (e = c[3]) && u.push(new ia(e, f, s, o, a)), (e = c[2]) && u.push(new ia(e, r, s, f, a)), (e = c[1]) && u.push(new ia(e, f, i, o, s)), (e = c[0]) && u.push(new ia(e, r, i, f, s));
    }
    return this;
  }, sa.visitAfter = function (t) {
    var n,
      e = [],
      r = [];
    for (this._root && e.push(new ia(this._root, this._x0, this._y0, this._x1, this._y1)); n = e.pop();) {
      var i = n.node;
      if (i.length) {
        var o,
          a = n.x0,
          u = n.y0,
          c = n.x1,
          f = n.y1,
          s = (a + c) / 2,
          l = (u + f) / 2;
        (o = i[0]) && e.push(new ia(o, a, u, s, l)), (o = i[1]) && e.push(new ia(o, s, u, c, l)), (o = i[2]) && e.push(new ia(o, a, l, s, f)), (o = i[3]) && e.push(new ia(o, s, l, c, f));
      }
      r.push(n);
    }
    for (; n = r.pop();) t(n.node, n.x0, n.y0, n.x1, n.y1);
    return this;
  }, sa.x = function (t) {
    return arguments.length ? (this._x = t, this) : this._x;
  }, sa.y = function (t) {
    return arguments.length ? (this._y = t, this) : this._y;
  };
  var ya = 10,
    _a = Math.PI * (3 - Math.sqrt(5));
  function ba(t, n) {
    if ((e = (t = n ? t.toExponential(n - 1) : t.toExponential()).indexOf("e")) < 0) return null;
    var e,
      r = t.slice(0, e);
    return [r.length > 1 ? r[0] + r.slice(2) : r, +t.slice(e + 1)];
  }
  function ma(t) {
    return (t = ba(Math.abs(t))) ? t[1] : NaN;
  }
  var xa,
    wa = /^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;
  function Ma(t) {
    return new Na(t);
  }
  function Na(t) {
    if (!(n = wa.exec(t))) throw new Error("invalid format: " + t);
    var n;
    this.fill = n[1] || " ", this.align = n[2] || ">", this.sign = n[3] || "-", this.symbol = n[4] || "", this.zero = !!n[5], this.width = n[6] && +n[6], this.comma = !!n[7], this.precision = n[8] && +n[8].slice(1), this.trim = !!n[9], this.type = n[10] || "";
  }
  function Aa(t, n) {
    var e = ba(t, n);
    if (!e) return t + "";
    var r = e[0],
      i = e[1];
    return i < 0 ? "0." + new Array(-i).join("0") + r : r.length > i + 1 ? r.slice(0, i + 1) + "." + r.slice(i + 1) : r + new Array(i - r.length + 2).join("0");
  }
  Ma.prototype = Na.prototype, Na.prototype.toString = function () {
    return this.fill + this.align + this.sign + this.symbol + (this.zero ? "0" : "") + (null == this.width ? "" : Math.max(1, 0 | this.width)) + (this.comma ? "," : "") + (null == this.precision ? "" : "." + Math.max(0, 0 | this.precision)) + (this.trim ? "~" : "") + this.type;
  };
  var Ta = {
    "%": function _(t, n) {
      return (100 * t).toFixed(n);
    },
    b: function b(t) {
      return Math.round(t).toString(2);
    },
    c: function c(t) {
      return t + "";
    },
    d: function d(t) {
      return Math.round(t).toString(10);
    },
    e: function e(t, n) {
      return t.toExponential(n);
    },
    f: function f(t, n) {
      return t.toFixed(n);
    },
    g: function g(t, n) {
      return t.toPrecision(n);
    },
    o: function o(t) {
      return Math.round(t).toString(8);
    },
    p: function p(t, n) {
      return Aa(100 * t, n);
    },
    r: Aa,
    s: function s(t, n) {
      var e = ba(t, n);
      if (!e) return t + "";
      var r = e[0],
        i = e[1],
        o = i - (xa = 3 * Math.max(-8, Math.min(8, Math.floor(i / 3)))) + 1,
        a = r.length;
      return o === a ? r : o > a ? r + new Array(o - a + 1).join("0") : o > 0 ? r.slice(0, o) + "." + r.slice(o) : "0." + new Array(1 - o).join("0") + ba(t, Math.max(0, n + o - 1))[0];
    },
    X: function X(t) {
      return Math.round(t).toString(16).toUpperCase();
    },
    x: function x(t) {
      return Math.round(t).toString(16);
    }
  };
  function Sa(t) {
    return t;
  }
  var ka,
    Ea = ["y", "z", "a", "f", "p", "n", "µ", "m", "", "k", "M", "G", "T", "P", "E", "Z", "Y"];
  function Ca(t) {
    var n,
      e,
      r = t.grouping && t.thousands ? (n = t.grouping, e = t.thousands, function (t, r) {
        for (var i = t.length, o = [], a = 0, u = n[0], c = 0; i > 0 && u > 0 && (c + u + 1 > r && (u = Math.max(1, r - c)), o.push(t.substring(i -= u, i + u)), !((c += u + 1) > r));) u = n[a = (a + 1) % n.length];
        return o.reverse().join(e);
      }) : Sa,
      i = t.currency,
      o = t.decimal,
      a = t.numerals ? function (t) {
        return function (n) {
          return n.replace(/[0-9]/g, function (n) {
            return t[+n];
          });
        };
      }(t.numerals) : Sa,
      u = t.percent || "%";
    function c(t) {
      var n = (t = Ma(t)).fill,
        e = t.align,
        c = t.sign,
        f = t.symbol,
        s = t.zero,
        l = t.width,
        h = t.comma,
        d = t.precision,
        p = t.trim,
        v = t.type;
      "n" === v ? (h = !0, v = "g") : Ta[v] || (null == d && (d = 12), p = !0, v = "g"), (s || "0" === n && "=" === e) && (s = !0, n = "0", e = "=");
      var g = "$" === f ? i[0] : "#" === f && /[boxX]/.test(v) ? "0" + v.toLowerCase() : "",
        y = "$" === f ? i[1] : /[%p]/.test(v) ? u : "",
        _ = Ta[v],
        b = /[defgprs%]/.test(v);
      function m(t) {
        var i,
          u,
          f,
          m = g,
          x = y;
        if ("c" === v) x = _(t) + x, t = "";else {
          var w = (t = +t) < 0;
          if (t = _(Math.abs(t), d), p && (t = function (t) {
            t: for (var n, e = t.length, r = 1, i = -1; r < e; ++r) switch (t[r]) {
              case ".":
                i = n = r;
                break;
              case "0":
                0 === i && (i = r), n = r;
                break;
              default:
                if (i > 0) {
                  if (!+t[r]) break t;
                  i = 0;
                }
            }
            return i > 0 ? t.slice(0, i) + t.slice(n + 1) : t;
          }(t)), w && 0 == +t && (w = !1), m = (w ? "(" === c ? c : "-" : "-" === c || "(" === c ? "" : c) + m, x = ("s" === v ? Ea[8 + xa / 3] : "") + x + (w && "(" === c ? ")" : ""), b) for (i = -1, u = t.length; ++i < u;) if (48 > (f = t.charCodeAt(i)) || f > 57) {
            x = (46 === f ? o + t.slice(i + 1) : t.slice(i)) + x, t = t.slice(0, i);
            break;
          }
        }
        h && !s && (t = r(t, 1 / 0));
        var M = m.length + t.length + x.length,
          N = M < l ? new Array(l - M + 1).join(n) : "";
        switch (h && s && (t = r(N + t, N.length ? l - x.length : 1 / 0), N = ""), e) {
          case "<":
            t = m + t + x + N;
            break;
          case "=":
            t = m + N + t + x;
            break;
          case "^":
            t = N.slice(0, M = N.length >> 1) + m + t + x + N.slice(M);
            break;
          default:
            t = N + m + t + x;
        }
        return a(t);
      }
      return d = null == d ? 6 : /[gprs]/.test(v) ? Math.max(1, Math.min(21, d)) : Math.max(0, Math.min(20, d)), m.toString = function () {
        return t + "";
      }, m;
    }
    return {
      format: c,
      formatPrefix: function formatPrefix(t, n) {
        var e = c(((t = Ma(t)).type = "f", t)),
          r = 3 * Math.max(-8, Math.min(8, Math.floor(ma(n) / 3))),
          i = Math.pow(10, -r),
          o = Ea[8 + r / 3];
        return function (t) {
          return e(i * t) + o;
        };
      }
    };
  }
  function Pa(n) {
    return ka = Ca(n), t.format = ka.format, t.formatPrefix = ka.formatPrefix, ka;
  }
  function za(t) {
    return Math.max(0, -ma(Math.abs(t)));
  }
  function Ra(t, n) {
    return Math.max(0, 3 * Math.max(-8, Math.min(8, Math.floor(ma(n) / 3))) - ma(Math.abs(t)));
  }
  function Da(t, n) {
    return t = Math.abs(t), n = Math.abs(n) - t, Math.max(0, ma(n) - ma(t)) + 1;
  }
  function qa() {
    return new La();
  }
  function La() {
    this.reset();
  }
  Pa({
    decimal: ".",
    thousands: ",",
    grouping: [3],
    currency: ["$", ""]
  }), La.prototype = {
    constructor: La,
    reset: function reset() {
      this.s = this.t = 0;
    },
    add: function add(t) {
      Oa(Ua, t, this.t), Oa(this, Ua.s, this.s), this.s ? this.t += Ua.t : this.s = Ua.t;
    },
    valueOf: function valueOf() {
      return this.s;
    }
  };
  var Ua = new La();
  function Oa(t, n, e) {
    var r = t.s = n + e,
      i = r - n,
      o = r - i;
    t.t = n - o + (e - i);
  }
  var Ba = 1e-6,
    Ya = 1e-12,
    Fa = Math.PI,
    Ia = Fa / 2,
    ja = Fa / 4,
    Ha = 2 * Fa,
    Xa = 180 / Fa,
    Ga = Fa / 180,
    Va = Math.abs,
    $a = Math.atan,
    Wa = Math.atan2,
    Za = Math.cos,
    Qa = Math.ceil,
    Ja = Math.exp,
    Ka = Math.log,
    tu = Math.pow,
    nu = Math.sin,
    eu = Math.sign || function (t) {
      return t > 0 ? 1 : t < 0 ? -1 : 0;
    },
    ru = Math.sqrt,
    iu = Math.tan;
  function ou(t) {
    return t > 1 ? 0 : t < -1 ? Fa : Math.acos(t);
  }
  function au(t) {
    return t > 1 ? Ia : t < -1 ? -Ia : Math.asin(t);
  }
  function uu(t) {
    return (t = nu(t / 2)) * t;
  }
  function cu() {}
  function fu(t, n) {
    t && lu.hasOwnProperty(t.type) && lu[t.type](t, n);
  }
  var su = {
      Feature: function Feature(t, n) {
        fu(t.geometry, n);
      },
      FeatureCollection: function FeatureCollection(t, n) {
        for (var e = t.features, r = -1, i = e.length; ++r < i;) fu(e[r].geometry, n);
      }
    },
    lu = {
      Sphere: function Sphere(t, n) {
        n.sphere();
      },
      Point: function Point(t, n) {
        t = t.coordinates, n.point(t[0], t[1], t[2]);
      },
      MultiPoint: function MultiPoint(t, n) {
        for (var e = t.coordinates, r = -1, i = e.length; ++r < i;) t = e[r], n.point(t[0], t[1], t[2]);
      },
      LineString: function LineString(t, n) {
        hu(t.coordinates, n, 0);
      },
      MultiLineString: function MultiLineString(t, n) {
        for (var e = t.coordinates, r = -1, i = e.length; ++r < i;) hu(e[r], n, 0);
      },
      Polygon: function Polygon(t, n) {
        du(t.coordinates, n);
      },
      MultiPolygon: function MultiPolygon(t, n) {
        for (var e = t.coordinates, r = -1, i = e.length; ++r < i;) du(e[r], n);
      },
      GeometryCollection: function GeometryCollection(t, n) {
        for (var e = t.geometries, r = -1, i = e.length; ++r < i;) fu(e[r], n);
      }
    };
  function hu(t, n, e) {
    var r,
      i = -1,
      o = t.length - e;
    for (n.lineStart(); ++i < o;) r = t[i], n.point(r[0], r[1], r[2]);
    n.lineEnd();
  }
  function du(t, n) {
    var e = -1,
      r = t.length;
    for (n.polygonStart(); ++e < r;) hu(t[e], n, 1);
    n.polygonEnd();
  }
  function pu(t, n) {
    t && su.hasOwnProperty(t.type) ? su[t.type](t, n) : fu(t, n);
  }
  var vu,
    gu,
    yu,
    _u,
    bu,
    mu = qa(),
    xu = qa(),
    wu = {
      point: cu,
      lineStart: cu,
      lineEnd: cu,
      polygonStart: function polygonStart() {
        mu.reset(), wu.lineStart = Mu, wu.lineEnd = Nu;
      },
      polygonEnd: function polygonEnd() {
        var t = +mu;
        xu.add(t < 0 ? Ha + t : t), this.lineStart = this.lineEnd = this.point = cu;
      },
      sphere: function sphere() {
        xu.add(Ha);
      }
    };
  function Mu() {
    wu.point = Au;
  }
  function Nu() {
    Tu(vu, gu);
  }
  function Au(t, n) {
    wu.point = Tu, vu = t, gu = n, yu = t *= Ga, _u = Za(n = (n *= Ga) / 2 + ja), bu = nu(n);
  }
  function Tu(t, n) {
    var e = (t *= Ga) - yu,
      r = e >= 0 ? 1 : -1,
      i = r * e,
      o = Za(n = (n *= Ga) / 2 + ja),
      a = nu(n),
      u = bu * a,
      c = _u * o + u * Za(i),
      f = u * r * nu(i);
    mu.add(Wa(f, c)), yu = t, _u = o, bu = a;
  }
  function Su(t) {
    return [Wa(t[1], t[0]), au(t[2])];
  }
  function ku(t) {
    var n = t[0],
      e = t[1],
      r = Za(e);
    return [r * Za(n), r * nu(n), nu(e)];
  }
  function Eu(t, n) {
    return t[0] * n[0] + t[1] * n[1] + t[2] * n[2];
  }
  function Cu(t, n) {
    return [t[1] * n[2] - t[2] * n[1], t[2] * n[0] - t[0] * n[2], t[0] * n[1] - t[1] * n[0]];
  }
  function Pu(t, n) {
    t[0] += n[0], t[1] += n[1], t[2] += n[2];
  }
  function zu(t, n) {
    return [t[0] * n, t[1] * n, t[2] * n];
  }
  function Ru(t) {
    var n = ru(t[0] * t[0] + t[1] * t[1] + t[2] * t[2]);
    t[0] /= n, t[1] /= n, t[2] /= n;
  }
  var Du,
    qu,
    Lu,
    Uu,
    Ou,
    Bu,
    Yu,
    Fu,
    Iu,
    ju,
    Hu,
    Xu,
    Gu,
    Vu,
    $u,
    Wu,
    Zu,
    Qu,
    Ju,
    Ku,
    tc,
    nc,
    ec,
    rc,
    ic,
    oc,
    ac = qa(),
    uc = {
      point: cc,
      lineStart: sc,
      lineEnd: lc,
      polygonStart: function polygonStart() {
        uc.point = hc, uc.lineStart = dc, uc.lineEnd = pc, ac.reset(), wu.polygonStart();
      },
      polygonEnd: function polygonEnd() {
        wu.polygonEnd(), uc.point = cc, uc.lineStart = sc, uc.lineEnd = lc, mu < 0 ? (Du = -(Lu = 180), qu = -(Uu = 90)) : ac > Ba ? Uu = 90 : ac < -Ba && (qu = -90), ju[0] = Du, ju[1] = Lu;
      },
      sphere: function sphere() {
        Du = -(Lu = 180), qu = -(Uu = 90);
      }
    };
  function cc(t, n) {
    Iu.push(ju = [Du = t, Lu = t]), n < qu && (qu = n), n > Uu && (Uu = n);
  }
  function fc(t, n) {
    var e = ku([t * Ga, n * Ga]);
    if (Fu) {
      var r = Cu(Fu, e),
        i = Cu([r[1], -r[0], 0], r);
      Ru(i), i = Su(i);
      var o,
        a = t - Ou,
        u = a > 0 ? 1 : -1,
        c = i[0] * Xa * u,
        f = Va(a) > 180;
      f ^ (u * Ou < c && c < u * t) ? (o = i[1] * Xa) > Uu && (Uu = o) : f ^ (u * Ou < (c = (c + 360) % 360 - 180) && c < u * t) ? (o = -i[1] * Xa) < qu && (qu = o) : (n < qu && (qu = n), n > Uu && (Uu = n)), f ? t < Ou ? vc(Du, t) > vc(Du, Lu) && (Lu = t) : vc(t, Lu) > vc(Du, Lu) && (Du = t) : Lu >= Du ? (t < Du && (Du = t), t > Lu && (Lu = t)) : t > Ou ? vc(Du, t) > vc(Du, Lu) && (Lu = t) : vc(t, Lu) > vc(Du, Lu) && (Du = t);
    } else Iu.push(ju = [Du = t, Lu = t]);
    n < qu && (qu = n), n > Uu && (Uu = n), Fu = e, Ou = t;
  }
  function sc() {
    uc.point = fc;
  }
  function lc() {
    ju[0] = Du, ju[1] = Lu, uc.point = cc, Fu = null;
  }
  function hc(t, n) {
    if (Fu) {
      var e = t - Ou;
      ac.add(Va(e) > 180 ? e + (e > 0 ? 360 : -360) : e);
    } else Bu = t, Yu = n;
    wu.point(t, n), fc(t, n);
  }
  function dc() {
    wu.lineStart();
  }
  function pc() {
    hc(Bu, Yu), wu.lineEnd(), Va(ac) > Ba && (Du = -(Lu = 180)), ju[0] = Du, ju[1] = Lu, Fu = null;
  }
  function vc(t, n) {
    return (n -= t) < 0 ? n + 360 : n;
  }
  function gc(t, n) {
    return t[0] - n[0];
  }
  function yc(t, n) {
    return t[0] <= t[1] ? t[0] <= n && n <= t[1] : n < t[0] || t[1] < n;
  }
  var _c = {
    sphere: cu,
    point: bc,
    lineStart: xc,
    lineEnd: Nc,
    polygonStart: function polygonStart() {
      _c.lineStart = Ac, _c.lineEnd = Tc;
    },
    polygonEnd: function polygonEnd() {
      _c.lineStart = xc, _c.lineEnd = Nc;
    }
  };
  function bc(t, n) {
    t *= Ga;
    var e = Za(n *= Ga);
    mc(e * Za(t), e * nu(t), nu(n));
  }
  function mc(t, n, e) {
    Gu += (t - Gu) / ++Hu, Vu += (n - Vu) / Hu, $u += (e - $u) / Hu;
  }
  function xc() {
    _c.point = wc;
  }
  function wc(t, n) {
    t *= Ga;
    var e = Za(n *= Ga);
    rc = e * Za(t), ic = e * nu(t), oc = nu(n), _c.point = Mc, mc(rc, ic, oc);
  }
  function Mc(t, n) {
    t *= Ga;
    var e = Za(n *= Ga),
      r = e * Za(t),
      i = e * nu(t),
      o = nu(n),
      a = Wa(ru((a = ic * o - oc * i) * a + (a = oc * r - rc * o) * a + (a = rc * i - ic * r) * a), rc * r + ic * i + oc * o);
    Xu += a, Wu += a * (rc + (rc = r)), Zu += a * (ic + (ic = i)), Qu += a * (oc + (oc = o)), mc(rc, ic, oc);
  }
  function Nc() {
    _c.point = bc;
  }
  function Ac() {
    _c.point = Sc;
  }
  function Tc() {
    kc(nc, ec), _c.point = bc;
  }
  function Sc(t, n) {
    nc = t, ec = n, t *= Ga, n *= Ga, _c.point = kc;
    var e = Za(n);
    rc = e * Za(t), ic = e * nu(t), oc = nu(n), mc(rc, ic, oc);
  }
  function kc(t, n) {
    t *= Ga;
    var e = Za(n *= Ga),
      r = e * Za(t),
      i = e * nu(t),
      o = nu(n),
      a = ic * o - oc * i,
      u = oc * r - rc * o,
      c = rc * i - ic * r,
      f = ru(a * a + u * u + c * c),
      s = au(f),
      l = f && -s / f;
    Ju += l * a, Ku += l * u, tc += l * c, Xu += s, Wu += s * (rc + (rc = r)), Zu += s * (ic + (ic = i)), Qu += s * (oc + (oc = o)), mc(rc, ic, oc);
  }
  function Ec(t) {
    return function () {
      return t;
    };
  }
  function Cc(t, n) {
    function e(e, r) {
      return e = t(e, r), n(e[0], e[1]);
    }
    return t.invert && n.invert && (e.invert = function (e, r) {
      return (e = n.invert(e, r)) && t.invert(e[0], e[1]);
    }), e;
  }
  function Pc(t, n) {
    return [Va(t) > Fa ? t + Math.round(-t / Ha) * Ha : t, n];
  }
  function zc(t, n, e) {
    return (t %= Ha) ? n || e ? Cc(Dc(t), qc(n, e)) : Dc(t) : n || e ? qc(n, e) : Pc;
  }
  function Rc(t) {
    return function (n, e) {
      return [(n += t) > Fa ? n - Ha : n < -Fa ? n + Ha : n, e];
    };
  }
  function Dc(t) {
    var n = Rc(t);
    return n.invert = Rc(-t), n;
  }
  function qc(t, n) {
    var e = Za(t),
      r = nu(t),
      i = Za(n),
      o = nu(n);
    function a(t, n) {
      var a = Za(n),
        u = Za(t) * a,
        c = nu(t) * a,
        f = nu(n),
        s = f * e + u * r;
      return [Wa(c * i - s * o, u * e - f * r), au(s * i + c * o)];
    }
    return a.invert = function (t, n) {
      var a = Za(n),
        u = Za(t) * a,
        c = nu(t) * a,
        f = nu(n),
        s = f * i - c * o;
      return [Wa(c * i + f * o, u * e + s * r), au(s * e - u * r)];
    }, a;
  }
  function Lc(t) {
    function n(n) {
      return (n = t(n[0] * Ga, n[1] * Ga))[0] *= Xa, n[1] *= Xa, n;
    }
    return t = zc(t[0] * Ga, t[1] * Ga, t.length > 2 ? t[2] * Ga : 0), n.invert = function (n) {
      return (n = t.invert(n[0] * Ga, n[1] * Ga))[0] *= Xa, n[1] *= Xa, n;
    }, n;
  }
  function Uc(t, n, e, r, i, o) {
    if (e) {
      var a = Za(n),
        u = nu(n),
        c = r * e;
      null == i ? (i = n + r * Ha, o = n - c / 2) : (i = Oc(a, i), o = Oc(a, o), (r > 0 ? i < o : i > o) && (i += r * Ha));
      for (var f, s = i; r > 0 ? s > o : s < o; s -= c) f = Su([a, -u * Za(s), -u * nu(s)]), t.point(f[0], f[1]);
    }
  }
  function Oc(t, n) {
    (n = ku(n))[0] -= t, Ru(n);
    var e = ou(-n[1]);
    return ((-n[2] < 0 ? -e : e) + Ha - Ba) % Ha;
  }
  function Bc() {
    var t,
      n = [];
    return {
      point: function point(n, e) {
        t.push([n, e]);
      },
      lineStart: function lineStart() {
        n.push(t = []);
      },
      lineEnd: cu,
      rejoin: function rejoin() {
        n.length > 1 && n.push(n.pop().concat(n.shift()));
      },
      result: function result() {
        var e = n;
        return n = [], t = null, e;
      }
    };
  }
  function Yc(t, n) {
    return Va(t[0] - n[0]) < Ba && Va(t[1] - n[1]) < Ba;
  }
  function Fc(t, n, e, r) {
    this.x = t, this.z = n, this.o = e, this.e = r, this.v = !1, this.n = this.p = null;
  }
  function Ic(t, n, e, r, i) {
    var o,
      a,
      u = [],
      c = [];
    if (t.forEach(function (t) {
      if (!((n = t.length - 1) <= 0)) {
        var n,
          e,
          r = t[0],
          a = t[n];
        if (Yc(r, a)) {
          for (i.lineStart(), o = 0; o < n; ++o) i.point((r = t[o])[0], r[1]);
          i.lineEnd();
        } else u.push(e = new Fc(r, t, null, !0)), c.push(e.o = new Fc(r, null, e, !1)), u.push(e = new Fc(a, t, null, !1)), c.push(e.o = new Fc(a, null, e, !0));
      }
    }), u.length) {
      for (c.sort(n), jc(u), jc(c), o = 0, a = c.length; o < a; ++o) c[o].e = e = !e;
      for (var f, s, l = u[0];;) {
        for (var h = l, d = !0; h.v;) if ((h = h.n) === l) return;
        f = h.z, i.lineStart();
        do {
          if (h.v = h.o.v = !0, h.e) {
            if (d) for (o = 0, a = f.length; o < a; ++o) i.point((s = f[o])[0], s[1]);else r(h.x, h.n.x, 1, i);
            h = h.n;
          } else {
            if (d) for (f = h.p.z, o = f.length - 1; o >= 0; --o) i.point((s = f[o])[0], s[1]);else r(h.x, h.p.x, -1, i);
            h = h.p;
          }
          f = (h = h.o).z, d = !d;
        } while (!h.v);
        i.lineEnd();
      }
    }
  }
  function jc(t) {
    if (n = t.length) {
      for (var n, e, r = 0, i = t[0]; ++r < n;) i.n = e = t[r], e.p = i, i = e;
      i.n = e = t[0], e.p = i;
    }
  }
  Pc.invert = Pc;
  var Hc = qa();
  function Xc(t) {
    return Va(t[0]) <= Fa ? t[0] : eu(t[0]) * ((Va(t[0]) + Fa) % Ha - Fa);
  }
  function Gc(t, n) {
    var e = Xc(n),
      r = n[1],
      i = nu(r),
      o = [nu(e), -Za(e), 0],
      a = 0,
      u = 0;
    Hc.reset(), 1 === i ? r = Ia + Ba : -1 === i && (r = -Ia - Ba);
    for (var c = 0, f = t.length; c < f; ++c) if (l = (s = t[c]).length) for (var s, l, h = s[l - 1], d = Xc(h), p = h[1] / 2 + ja, v = nu(p), g = Za(p), y = 0; y < l; ++y, d = b, v = x, g = w, h = _) {
      var _ = s[y],
        b = Xc(_),
        m = _[1] / 2 + ja,
        x = nu(m),
        w = Za(m),
        M = b - d,
        N = M >= 0 ? 1 : -1,
        A = N * M,
        T = A > Fa,
        S = v * x;
      if (Hc.add(Wa(S * N * nu(A), g * w + S * Za(A))), a += T ? M + N * Ha : M, T ^ d >= e ^ b >= e) {
        var k = Cu(ku(h), ku(_));
        Ru(k);
        var E = Cu(o, k);
        Ru(E);
        var C = (T ^ M >= 0 ? -1 : 1) * au(E[2]);
        (r > C || r === C && (k[0] || k[1])) && (u += T ^ M >= 0 ? 1 : -1);
      }
    }
    return (a < -Ba || a < Ba && Hc < -Ba) ^ 1 & u;
  }
  function Vc(t, n, e, r) {
    return function (i) {
      var o,
        a,
        u,
        c = n(i),
        f = Bc(),
        s = n(f),
        l = !1,
        h = {
          point: d,
          lineStart: v,
          lineEnd: g,
          polygonStart: function polygonStart() {
            h.point = y, h.lineStart = _, h.lineEnd = b, a = [], o = [];
          },
          polygonEnd: function polygonEnd() {
            h.point = d, h.lineStart = v, h.lineEnd = g, a = T(a);
            var t = Gc(o, r);
            a.length ? (l || (i.polygonStart(), l = !0), Ic(a, Wc, t, e, i)) : t && (l || (i.polygonStart(), l = !0), i.lineStart(), e(null, null, 1, i), i.lineEnd()), l && (i.polygonEnd(), l = !1), a = o = null;
          },
          sphere: function sphere() {
            i.polygonStart(), i.lineStart(), e(null, null, 1, i), i.lineEnd(), i.polygonEnd();
          }
        };
      function d(n, e) {
        t(n, e) && i.point(n, e);
      }
      function p(t, n) {
        c.point(t, n);
      }
      function v() {
        h.point = p, c.lineStart();
      }
      function g() {
        h.point = d, c.lineEnd();
      }
      function y(t, n) {
        u.push([t, n]), s.point(t, n);
      }
      function _() {
        s.lineStart(), u = [];
      }
      function b() {
        y(u[0][0], u[0][1]), s.lineEnd();
        var t,
          n,
          e,
          r,
          c = s.clean(),
          h = f.result(),
          d = h.length;
        if (u.pop(), o.push(u), u = null, d) if (1 & c) {
          if ((n = (e = h[0]).length - 1) > 0) {
            for (l || (i.polygonStart(), l = !0), i.lineStart(), t = 0; t < n; ++t) i.point((r = e[t])[0], r[1]);
            i.lineEnd();
          }
        } else d > 1 && 2 & c && h.push(h.pop().concat(h.shift())), a.push(h.filter($c));
      }
      return h;
    };
  }
  function $c(t) {
    return t.length > 1;
  }
  function Wc(t, n) {
    return ((t = t.x)[0] < 0 ? t[1] - Ia - Ba : Ia - t[1]) - ((n = n.x)[0] < 0 ? n[1] - Ia - Ba : Ia - n[1]);
  }
  var Zc = Vc(function () {
    return !0;
  }, function (t) {
    var n,
      e = NaN,
      r = NaN,
      i = NaN;
    return {
      lineStart: function lineStart() {
        t.lineStart(), n = 1;
      },
      point: function point(o, a) {
        var u = o > 0 ? Fa : -Fa,
          c = Va(o - e);
        Va(c - Fa) < Ba ? (t.point(e, r = (r + a) / 2 > 0 ? Ia : -Ia), t.point(i, r), t.lineEnd(), t.lineStart(), t.point(u, r), t.point(o, r), n = 0) : i !== u && c >= Fa && (Va(e - i) < Ba && (e -= i * Ba), Va(o - u) < Ba && (o -= u * Ba), r = function (t, n, e, r) {
          var i,
            o,
            a = nu(t - e);
          return Va(a) > Ba ? $a((nu(n) * (o = Za(r)) * nu(e) - nu(r) * (i = Za(n)) * nu(t)) / (i * o * a)) : (n + r) / 2;
        }(e, r, o, a), t.point(i, r), t.lineEnd(), t.lineStart(), t.point(u, r), n = 0), t.point(e = o, r = a), i = u;
      },
      lineEnd: function lineEnd() {
        t.lineEnd(), e = r = NaN;
      },
      clean: function clean() {
        return 2 - n;
      }
    };
  }, function (t, n, e, r) {
    var i;
    if (null == t) i = e * Ia, r.point(-Fa, i), r.point(0, i), r.point(Fa, i), r.point(Fa, 0), r.point(Fa, -i), r.point(0, -i), r.point(-Fa, -i), r.point(-Fa, 0), r.point(-Fa, i);else if (Va(t[0] - n[0]) > Ba) {
      var o = t[0] < n[0] ? Fa : -Fa;
      i = e * o / 2, r.point(-o, i), r.point(0, i), r.point(o, i);
    } else r.point(n[0], n[1]);
  }, [-Fa, -Ia]);
  function Qc(t) {
    var n = Za(t),
      e = 6 * Ga,
      r = n > 0,
      i = Va(n) > Ba;
    function o(t, e) {
      return Za(t) * Za(e) > n;
    }
    function a(t, e, r) {
      var i = [1, 0, 0],
        o = Cu(ku(t), ku(e)),
        a = Eu(o, o),
        u = o[0],
        c = a - u * u;
      if (!c) return !r && t;
      var f = n * a / c,
        s = -n * u / c,
        l = Cu(i, o),
        h = zu(i, f);
      Pu(h, zu(o, s));
      var d = l,
        p = Eu(h, d),
        v = Eu(d, d),
        g = p * p - v * (Eu(h, h) - 1);
      if (!(g < 0)) {
        var y = ru(g),
          _ = zu(d, (-p - y) / v);
        if (Pu(_, h), _ = Su(_), !r) return _;
        var b,
          m = t[0],
          x = e[0],
          w = t[1],
          M = e[1];
        x < m && (b = m, m = x, x = b);
        var N = x - m,
          A = Va(N - Fa) < Ba;
        if (!A && M < w && (b = w, w = M, M = b), A || N < Ba ? A ? w + M > 0 ^ _[1] < (Va(_[0] - m) < Ba ? w : M) : w <= _[1] && _[1] <= M : N > Fa ^ (m <= _[0] && _[0] <= x)) {
          var T = zu(d, (-p + y) / v);
          return Pu(T, h), [_, Su(T)];
        }
      }
    }
    function u(n, e) {
      var i = r ? t : Fa - t,
        o = 0;
      return n < -i ? o |= 1 : n > i && (o |= 2), e < -i ? o |= 4 : e > i && (o |= 8), o;
    }
    return Vc(o, function (t) {
      var n, e, c, f, s;
      return {
        lineStart: function lineStart() {
          f = c = !1, s = 1;
        },
        point: function point(l, h) {
          var d,
            p = [l, h],
            v = o(l, h),
            g = r ? v ? 0 : u(l, h) : v ? u(l + (l < 0 ? Fa : -Fa), h) : 0;
          if (!n && (f = c = v) && t.lineStart(), v !== c && (!(d = a(n, p)) || Yc(n, d) || Yc(p, d)) && (p[0] += Ba, p[1] += Ba, v = o(p[0], p[1])), v !== c) s = 0, v ? (t.lineStart(), d = a(p, n), t.point(d[0], d[1])) : (d = a(n, p), t.point(d[0], d[1]), t.lineEnd()), n = d;else if (i && n && r ^ v) {
            var y;
            g & e || !(y = a(p, n, !0)) || (s = 0, r ? (t.lineStart(), t.point(y[0][0], y[0][1]), t.point(y[1][0], y[1][1]), t.lineEnd()) : (t.point(y[1][0], y[1][1]), t.lineEnd(), t.lineStart(), t.point(y[0][0], y[0][1])));
          }
          !v || n && Yc(n, p) || t.point(p[0], p[1]), n = p, c = v, e = g;
        },
        lineEnd: function lineEnd() {
          c && t.lineEnd(), n = null;
        },
        clean: function clean() {
          return s | (f && c) << 1;
        }
      };
    }, function (n, r, i, o) {
      Uc(o, t, e, i, n, r);
    }, r ? [0, -t] : [-Fa, t - Fa]);
  }
  var Jc = 1e9,
    Kc = -Jc;
  function tf(t, n, e, r) {
    function i(i, o) {
      return t <= i && i <= e && n <= o && o <= r;
    }
    function o(i, o, u, f) {
      var s = 0,
        l = 0;
      if (null == i || (s = a(i, u)) !== (l = a(o, u)) || c(i, o) < 0 ^ u > 0) do {
        f.point(0 === s || 3 === s ? t : e, s > 1 ? r : n);
      } while ((s = (s + u + 4) % 4) !== l);else f.point(o[0], o[1]);
    }
    function a(r, i) {
      return Va(r[0] - t) < Ba ? i > 0 ? 0 : 3 : Va(r[0] - e) < Ba ? i > 0 ? 2 : 1 : Va(r[1] - n) < Ba ? i > 0 ? 1 : 0 : i > 0 ? 3 : 2;
    }
    function u(t, n) {
      return c(t.x, n.x);
    }
    function c(t, n) {
      var e = a(t, 1),
        r = a(n, 1);
      return e !== r ? e - r : 0 === e ? n[1] - t[1] : 1 === e ? t[0] - n[0] : 2 === e ? t[1] - n[1] : n[0] - t[0];
    }
    return function (a) {
      var c,
        f,
        s,
        l,
        h,
        d,
        p,
        v,
        g,
        y,
        _,
        b = a,
        m = Bc(),
        x = {
          point: w,
          lineStart: function lineStart() {
            x.point = M, f && f.push(s = []);
            y = !0, g = !1, p = v = NaN;
          },
          lineEnd: function lineEnd() {
            c && (M(l, h), d && g && m.rejoin(), c.push(m.result()));
            x.point = w, g && b.lineEnd();
          },
          polygonStart: function polygonStart() {
            b = m, c = [], f = [], _ = !0;
          },
          polygonEnd: function polygonEnd() {
            var n = function () {
                for (var n = 0, e = 0, i = f.length; e < i; ++e) for (var o, a, u = f[e], c = 1, s = u.length, l = u[0], h = l[0], d = l[1]; c < s; ++c) o = h, a = d, l = u[c], h = l[0], d = l[1], a <= r ? d > r && (h - o) * (r - a) > (d - a) * (t - o) && ++n : d <= r && (h - o) * (r - a) < (d - a) * (t - o) && --n;
                return n;
              }(),
              e = _ && n,
              i = (c = T(c)).length;
            (e || i) && (a.polygonStart(), e && (a.lineStart(), o(null, null, 1, a), a.lineEnd()), i && Ic(c, u, n, o, a), a.polygonEnd());
            b = a, c = f = s = null;
          }
        };
      function w(t, n) {
        i(t, n) && b.point(t, n);
      }
      function M(o, a) {
        var u = i(o, a);
        if (f && s.push([o, a]), y) l = o, h = a, d = u, y = !1, u && (b.lineStart(), b.point(o, a));else if (u && g) b.point(o, a);else {
          var c = [p = Math.max(Kc, Math.min(Jc, p)), v = Math.max(Kc, Math.min(Jc, v))],
            m = [o = Math.max(Kc, Math.min(Jc, o)), a = Math.max(Kc, Math.min(Jc, a))];
          !function (t, n, e, r, i, o) {
            var a,
              u = t[0],
              c = t[1],
              f = 0,
              s = 1,
              l = n[0] - u,
              h = n[1] - c;
            if (a = e - u, l || !(a > 0)) {
              if (a /= l, l < 0) {
                if (a < f) return;
                a < s && (s = a);
              } else if (l > 0) {
                if (a > s) return;
                a > f && (f = a);
              }
              if (a = i - u, l || !(a < 0)) {
                if (a /= l, l < 0) {
                  if (a > s) return;
                  a > f && (f = a);
                } else if (l > 0) {
                  if (a < f) return;
                  a < s && (s = a);
                }
                if (a = r - c, h || !(a > 0)) {
                  if (a /= h, h < 0) {
                    if (a < f) return;
                    a < s && (s = a);
                  } else if (h > 0) {
                    if (a > s) return;
                    a > f && (f = a);
                  }
                  if (a = o - c, h || !(a < 0)) {
                    if (a /= h, h < 0) {
                      if (a > s) return;
                      a > f && (f = a);
                    } else if (h > 0) {
                      if (a < f) return;
                      a < s && (s = a);
                    }
                    return f > 0 && (t[0] = u + f * l, t[1] = c + f * h), s < 1 && (n[0] = u + s * l, n[1] = c + s * h), !0;
                  }
                }
              }
            }
          }(c, m, t, n, e, r) ? u && (b.lineStart(), b.point(o, a), _ = !1) : (g || (b.lineStart(), b.point(c[0], c[1])), b.point(m[0], m[1]), u || b.lineEnd(), _ = !1);
        }
        p = o, v = a, g = u;
      }
      return x;
    };
  }
  var nf,
    ef,
    rf,
    of = qa(),
    af = {
      sphere: cu,
      point: cu,
      lineStart: function lineStart() {
        af.point = cf, af.lineEnd = uf;
      },
      lineEnd: cu,
      polygonStart: cu,
      polygonEnd: cu
    };
  function uf() {
    af.point = af.lineEnd = cu;
  }
  function cf(t, n) {
    nf = t *= Ga, ef = nu(n *= Ga), rf = Za(n), af.point = ff;
  }
  function ff(t, n) {
    t *= Ga;
    var e = nu(n *= Ga),
      r = Za(n),
      i = Va(t - nf),
      o = Za(i),
      a = r * nu(i),
      u = rf * e - ef * r * o,
      c = ef * e + rf * r * o;
    of.add(Wa(ru(a * a + u * u), c)), nf = t, ef = e, rf = r;
  }
  function sf(t) {
    return of.reset(), pu(t, af), +of;
  }
  var lf = [null, null],
    hf = {
      type: "LineString",
      coordinates: lf
    };
  function df(t, n) {
    return lf[0] = t, lf[1] = n, sf(hf);
  }
  var pf = {
      Feature: function Feature(t, n) {
        return gf(t.geometry, n);
      },
      FeatureCollection: function FeatureCollection(t, n) {
        for (var e = t.features, r = -1, i = e.length; ++r < i;) if (gf(e[r].geometry, n)) return !0;
        return !1;
      }
    },
    vf = {
      Sphere: function Sphere() {
        return !0;
      },
      Point: function Point(t, n) {
        return yf(t.coordinates, n);
      },
      MultiPoint: function MultiPoint(t, n) {
        for (var e = t.coordinates, r = -1, i = e.length; ++r < i;) if (yf(e[r], n)) return !0;
        return !1;
      },
      LineString: function LineString(t, n) {
        return _f(t.coordinates, n);
      },
      MultiLineString: function MultiLineString(t, n) {
        for (var e = t.coordinates, r = -1, i = e.length; ++r < i;) if (_f(e[r], n)) return !0;
        return !1;
      },
      Polygon: function Polygon(t, n) {
        return bf(t.coordinates, n);
      },
      MultiPolygon: function MultiPolygon(t, n) {
        for (var e = t.coordinates, r = -1, i = e.length; ++r < i;) if (bf(e[r], n)) return !0;
        return !1;
      },
      GeometryCollection: function GeometryCollection(t, n) {
        for (var e = t.geometries, r = -1, i = e.length; ++r < i;) if (gf(e[r], n)) return !0;
        return !1;
      }
    };
  function gf(t, n) {
    return !(!t || !vf.hasOwnProperty(t.type)) && vf[t.type](t, n);
  }
  function yf(t, n) {
    return 0 === df(t, n);
  }
  function _f(t, n) {
    for (var e, r, i, o = 0, a = t.length; o < a; o++) {
      if (0 === (r = df(t[o], n))) return !0;
      if (o > 0 && (i = df(t[o], t[o - 1])) > 0 && e <= i && r <= i && (e + r - i) * (1 - Math.pow((e - r) / i, 2)) < Ya * i) return !0;
      e = r;
    }
    return !1;
  }
  function bf(t, n) {
    return !!Gc(t.map(mf), xf(n));
  }
  function mf(t) {
    return (t = t.map(xf)).pop(), t;
  }
  function xf(t) {
    return [t[0] * Ga, t[1] * Ga];
  }
  function wf(t, n, e) {
    var r = g(t, n - Ba, e).concat(n);
    return function (t) {
      return r.map(function (n) {
        return [t, n];
      });
    };
  }
  function Mf(t, n, e) {
    var r = g(t, n - Ba, e).concat(n);
    return function (t) {
      return r.map(function (n) {
        return [n, t];
      });
    };
  }
  function Nf() {
    var t,
      n,
      e,
      r,
      i,
      o,
      a,
      u,
      c,
      f,
      s,
      l,
      h = 10,
      d = h,
      p = 90,
      v = 360,
      y = 2.5;
    function _() {
      return {
        type: "MultiLineString",
        coordinates: b()
      };
    }
    function b() {
      return g(Qa(r / p) * p, e, p).map(s).concat(g(Qa(u / v) * v, a, v).map(l)).concat(g(Qa(n / h) * h, t, h).filter(function (t) {
        return Va(t % p) > Ba;
      }).map(c)).concat(g(Qa(o / d) * d, i, d).filter(function (t) {
        return Va(t % v) > Ba;
      }).map(f));
    }
    return _.lines = function () {
      return b().map(function (t) {
        return {
          type: "LineString",
          coordinates: t
        };
      });
    }, _.outline = function () {
      return {
        type: "Polygon",
        coordinates: [s(r).concat(l(a).slice(1), s(e).reverse().slice(1), l(u).reverse().slice(1))]
      };
    }, _.extent = function (t) {
      return arguments.length ? _.extentMajor(t).extentMinor(t) : _.extentMinor();
    }, _.extentMajor = function (t) {
      return arguments.length ? (r = +t[0][0], e = +t[1][0], u = +t[0][1], a = +t[1][1], r > e && (t = r, r = e, e = t), u > a && (t = u, u = a, a = t), _.precision(y)) : [[r, u], [e, a]];
    }, _.extentMinor = function (e) {
      return arguments.length ? (n = +e[0][0], t = +e[1][0], o = +e[0][1], i = +e[1][1], n > t && (e = n, n = t, t = e), o > i && (e = o, o = i, i = e), _.precision(y)) : [[n, o], [t, i]];
    }, _.step = function (t) {
      return arguments.length ? _.stepMajor(t).stepMinor(t) : _.stepMinor();
    }, _.stepMajor = function (t) {
      return arguments.length ? (p = +t[0], v = +t[1], _) : [p, v];
    }, _.stepMinor = function (t) {
      return arguments.length ? (h = +t[0], d = +t[1], _) : [h, d];
    }, _.precision = function (h) {
      return arguments.length ? (y = +h, c = wf(o, i, 90), f = Mf(n, t, y), s = wf(u, a, 90), l = Mf(r, e, y), _) : y;
    }, _.extentMajor([[-180, -90 + Ba], [180, 90 - Ba]]).extentMinor([[-180, -80 - Ba], [180, 80 + Ba]]);
  }
  function Af(t) {
    return t;
  }
  var Tf,
    Sf,
    kf,
    Ef,
    Cf = qa(),
    Pf = qa(),
    zf = {
      point: cu,
      lineStart: cu,
      lineEnd: cu,
      polygonStart: function polygonStart() {
        zf.lineStart = Rf, zf.lineEnd = Lf;
      },
      polygonEnd: function polygonEnd() {
        zf.lineStart = zf.lineEnd = zf.point = cu, Cf.add(Va(Pf)), Pf.reset();
      },
      result: function result() {
        var t = Cf / 2;
        return Cf.reset(), t;
      }
    };
  function Rf() {
    zf.point = Df;
  }
  function Df(t, n) {
    zf.point = qf, Tf = kf = t, Sf = Ef = n;
  }
  function qf(t, n) {
    Pf.add(Ef * t - kf * n), kf = t, Ef = n;
  }
  function Lf() {
    qf(Tf, Sf);
  }
  var Uf = 1 / 0,
    Of = Uf,
    Bf = -Uf,
    Yf = Bf,
    Ff = {
      point: function point(t, n) {
        t < Uf && (Uf = t);
        t > Bf && (Bf = t);
        n < Of && (Of = n);
        n > Yf && (Yf = n);
      },
      lineStart: cu,
      lineEnd: cu,
      polygonStart: cu,
      polygonEnd: cu,
      result: function result() {
        var t = [[Uf, Of], [Bf, Yf]];
        return Bf = Yf = -(Of = Uf = 1 / 0), t;
      }
    };
  var If,
    jf,
    Hf,
    Xf,
    Gf = 0,
    Vf = 0,
    $f = 0,
    Wf = 0,
    Zf = 0,
    Qf = 0,
    Jf = 0,
    Kf = 0,
    ts = 0,
    ns = {
      point: es,
      lineStart: rs,
      lineEnd: as,
      polygonStart: function polygonStart() {
        ns.lineStart = us, ns.lineEnd = cs;
      },
      polygonEnd: function polygonEnd() {
        ns.point = es, ns.lineStart = rs, ns.lineEnd = as;
      },
      result: function result() {
        var t = ts ? [Jf / ts, Kf / ts] : Qf ? [Wf / Qf, Zf / Qf] : $f ? [Gf / $f, Vf / $f] : [NaN, NaN];
        return Gf = Vf = $f = Wf = Zf = Qf = Jf = Kf = ts = 0, t;
      }
    };
  function es(t, n) {
    Gf += t, Vf += n, ++$f;
  }
  function rs() {
    ns.point = is;
  }
  function is(t, n) {
    ns.point = os, es(Hf = t, Xf = n);
  }
  function os(t, n) {
    var e = t - Hf,
      r = n - Xf,
      i = ru(e * e + r * r);
    Wf += i * (Hf + t) / 2, Zf += i * (Xf + n) / 2, Qf += i, es(Hf = t, Xf = n);
  }
  function as() {
    ns.point = es;
  }
  function us() {
    ns.point = fs;
  }
  function cs() {
    ss(If, jf);
  }
  function fs(t, n) {
    ns.point = ss, es(If = Hf = t, jf = Xf = n);
  }
  function ss(t, n) {
    var e = t - Hf,
      r = n - Xf,
      i = ru(e * e + r * r);
    Wf += i * (Hf + t) / 2, Zf += i * (Xf + n) / 2, Qf += i, Jf += (i = Xf * t - Hf * n) * (Hf + t), Kf += i * (Xf + n), ts += 3 * i, es(Hf = t, Xf = n);
  }
  function ls(t) {
    this._context = t;
  }
  ls.prototype = {
    _radius: 4.5,
    pointRadius: function pointRadius(t) {
      return this._radius = t, this;
    },
    polygonStart: function polygonStart() {
      this._line = 0;
    },
    polygonEnd: function polygonEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._point = 0;
    },
    lineEnd: function lineEnd() {
      0 === this._line && this._context.closePath(), this._point = NaN;
    },
    point: function point(t, n) {
      switch (this._point) {
        case 0:
          this._context.moveTo(t, n), this._point = 1;
          break;
        case 1:
          this._context.lineTo(t, n);
          break;
        default:
          this._context.moveTo(t + this._radius, n), this._context.arc(t, n, this._radius, 0, Ha);
      }
    },
    result: cu
  };
  var hs,
    ds,
    ps,
    vs,
    gs,
    ys = qa(),
    _s = {
      point: cu,
      lineStart: function lineStart() {
        _s.point = bs;
      },
      lineEnd: function lineEnd() {
        hs && ms(ds, ps), _s.point = cu;
      },
      polygonStart: function polygonStart() {
        hs = !0;
      },
      polygonEnd: function polygonEnd() {
        hs = null;
      },
      result: function result() {
        var t = +ys;
        return ys.reset(), t;
      }
    };
  function bs(t, n) {
    _s.point = ms, ds = vs = t, ps = gs = n;
  }
  function ms(t, n) {
    vs -= t, gs -= n, ys.add(ru(vs * vs + gs * gs)), vs = t, gs = n;
  }
  function xs() {
    this._string = [];
  }
  function ws(t) {
    return "m0," + t + "a" + t + "," + t + " 0 1,1 0," + -2 * t + "a" + t + "," + t + " 0 1,1 0," + 2 * t + "z";
  }
  function Ms(t) {
    return function (n) {
      var e = new Ns();
      for (var r in t) e[r] = t[r];
      return e.stream = n, e;
    };
  }
  function Ns() {}
  function As(t, n, e) {
    var r = t.clipExtent && t.clipExtent();
    return t.scale(150).translate([0, 0]), null != r && t.clipExtent(null), pu(e, t.stream(Ff)), n(Ff.result()), null != r && t.clipExtent(r), t;
  }
  function Ts(t, n, e) {
    return As(t, function (e) {
      var r = n[1][0] - n[0][0],
        i = n[1][1] - n[0][1],
        o = Math.min(r / (e[1][0] - e[0][0]), i / (e[1][1] - e[0][1])),
        a = +n[0][0] + (r - o * (e[1][0] + e[0][0])) / 2,
        u = +n[0][1] + (i - o * (e[1][1] + e[0][1])) / 2;
      t.scale(150 * o).translate([a, u]);
    }, e);
  }
  function Ss(t, n, e) {
    return Ts(t, [[0, 0], n], e);
  }
  function ks(t, n, e) {
    return As(t, function (e) {
      var r = +n,
        i = r / (e[1][0] - e[0][0]),
        o = (r - i * (e[1][0] + e[0][0])) / 2,
        a = -i * e[0][1];
      t.scale(150 * i).translate([o, a]);
    }, e);
  }
  function Es(t, n, e) {
    return As(t, function (e) {
      var r = +n,
        i = r / (e[1][1] - e[0][1]),
        o = -i * e[0][0],
        a = (r - i * (e[1][1] + e[0][1])) / 2;
      t.scale(150 * i).translate([o, a]);
    }, e);
  }
  xs.prototype = {
    _radius: 4.5,
    _circle: ws(4.5),
    pointRadius: function pointRadius(t) {
      return (t = +t) !== this._radius && (this._radius = t, this._circle = null), this;
    },
    polygonStart: function polygonStart() {
      this._line = 0;
    },
    polygonEnd: function polygonEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._point = 0;
    },
    lineEnd: function lineEnd() {
      0 === this._line && this._string.push("Z"), this._point = NaN;
    },
    point: function point(t, n) {
      switch (this._point) {
        case 0:
          this._string.push("M", t, ",", n), this._point = 1;
          break;
        case 1:
          this._string.push("L", t, ",", n);
          break;
        default:
          null == this._circle && (this._circle = ws(this._radius)), this._string.push("M", t, ",", n, this._circle);
      }
    },
    result: function result() {
      if (this._string.length) {
        var t = this._string.join("");
        return this._string = [], t;
      }
      return null;
    }
  }, Ns.prototype = {
    constructor: Ns,
    point: function point(t, n) {
      this.stream.point(t, n);
    },
    sphere: function sphere() {
      this.stream.sphere();
    },
    lineStart: function lineStart() {
      this.stream.lineStart();
    },
    lineEnd: function lineEnd() {
      this.stream.lineEnd();
    },
    polygonStart: function polygonStart() {
      this.stream.polygonStart();
    },
    polygonEnd: function polygonEnd() {
      this.stream.polygonEnd();
    }
  };
  var Cs = 16,
    Ps = Za(30 * Ga);
  function zs(t, n) {
    return +n ? function (t, n) {
      function e(r, i, o, a, u, c, f, s, l, h, d, p, v, g) {
        var y = f - r,
          _ = s - i,
          b = y * y + _ * _;
        if (b > 4 * n && v--) {
          var m = a + h,
            x = u + d,
            w = c + p,
            M = ru(m * m + x * x + w * w),
            N = au(w /= M),
            A = Va(Va(w) - 1) < Ba || Va(o - l) < Ba ? (o + l) / 2 : Wa(x, m),
            T = t(A, N),
            S = T[0],
            k = T[1],
            E = S - r,
            C = k - i,
            P = _ * E - y * C;
          (P * P / b > n || Va((y * E + _ * C) / b - .5) > .3 || a * h + u * d + c * p < Ps) && (e(r, i, o, a, u, c, S, k, A, m /= M, x /= M, w, v, g), g.point(S, k), e(S, k, A, m, x, w, f, s, l, h, d, p, v, g));
        }
      }
      return function (n) {
        var r,
          i,
          o,
          a,
          u,
          c,
          f,
          s,
          l,
          h,
          d,
          p,
          v = {
            point: g,
            lineStart: y,
            lineEnd: b,
            polygonStart: function polygonStart() {
              n.polygonStart(), v.lineStart = m;
            },
            polygonEnd: function polygonEnd() {
              n.polygonEnd(), v.lineStart = y;
            }
          };
        function g(e, r) {
          e = t(e, r), n.point(e[0], e[1]);
        }
        function y() {
          s = NaN, v.point = _, n.lineStart();
        }
        function _(r, i) {
          var o = ku([r, i]),
            a = t(r, i);
          e(s, l, f, h, d, p, s = a[0], l = a[1], f = r, h = o[0], d = o[1], p = o[2], Cs, n), n.point(s, l);
        }
        function b() {
          v.point = g, n.lineEnd();
        }
        function m() {
          y(), v.point = x, v.lineEnd = w;
        }
        function x(t, n) {
          _(r = t, n), i = s, o = l, a = h, u = d, c = p, v.point = _;
        }
        function w() {
          e(s, l, f, h, d, p, i, o, r, a, u, c, Cs, n), v.lineEnd = b, b();
        }
        return v;
      };
    }(t, n) : function (t) {
      return Ms({
        point: function point(n, e) {
          n = t(n, e), this.stream.point(n[0], n[1]);
        }
      });
    }(t);
  }
  var Rs = Ms({
    point: function point(t, n) {
      this.stream.point(t * Ga, n * Ga);
    }
  });
  function Ds(t, n, e, r) {
    var i = Za(r),
      o = nu(r),
      a = i * t,
      u = o * t,
      c = i / t,
      f = o / t,
      s = (o * e - i * n) / t,
      l = (o * n + i * e) / t;
    function h(t, r) {
      return [a * t - u * r + n, e - u * t - a * r];
    }
    return h.invert = function (t, n) {
      return [c * t - f * n + s, l - f * t - c * n];
    }, h;
  }
  function qs(t) {
    return Ls(function () {
      return t;
    })();
  }
  function Ls(t) {
    var n,
      e,
      r,
      i,
      o,
      a,
      u,
      c,
      f,
      s,
      l = 150,
      h = 480,
      d = 250,
      p = 0,
      v = 0,
      g = 0,
      y = 0,
      _ = 0,
      b = 0,
      m = null,
      x = Zc,
      w = null,
      M = Af,
      N = .5;
    function A(t) {
      return c(t[0] * Ga, t[1] * Ga);
    }
    function T(t) {
      return (t = c.invert(t[0], t[1])) && [t[0] * Xa, t[1] * Xa];
    }
    function S() {
      var t = Ds(l, 0, 0, b).apply(null, n(p, v)),
        r = (b ? Ds : function (t, n, e) {
          function r(r, i) {
            return [n + t * r, e - t * i];
          }
          return r.invert = function (r, i) {
            return [(r - n) / t, (e - i) / t];
          }, r;
        })(l, h - t[0], d - t[1], b);
      return e = zc(g, y, _), u = Cc(n, r), c = Cc(e, u), a = zs(u, N), k();
    }
    function k() {
      return f = s = null, A;
    }
    return A.stream = function (t) {
      return f && s === t ? f : f = Rs(function (t) {
        return Ms({
          point: function point(n, e) {
            var r = t(n, e);
            return this.stream.point(r[0], r[1]);
          }
        });
      }(e)(x(a(M(s = t)))));
    }, A.preclip = function (t) {
      return arguments.length ? (x = t, m = void 0, k()) : x;
    }, A.postclip = function (t) {
      return arguments.length ? (M = t, w = r = i = o = null, k()) : M;
    }, A.clipAngle = function (t) {
      return arguments.length ? (x = +t ? Qc(m = t * Ga) : (m = null, Zc), k()) : m * Xa;
    }, A.clipExtent = function (t) {
      return arguments.length ? (M = null == t ? (w = r = i = o = null, Af) : tf(w = +t[0][0], r = +t[0][1], i = +t[1][0], o = +t[1][1]), k()) : null == w ? null : [[w, r], [i, o]];
    }, A.scale = function (t) {
      return arguments.length ? (l = +t, S()) : l;
    }, A.translate = function (t) {
      return arguments.length ? (h = +t[0], d = +t[1], S()) : [h, d];
    }, A.center = function (t) {
      return arguments.length ? (p = t[0] % 360 * Ga, v = t[1] % 360 * Ga, S()) : [p * Xa, v * Xa];
    }, A.rotate = function (t) {
      return arguments.length ? (g = t[0] % 360 * Ga, y = t[1] % 360 * Ga, _ = t.length > 2 ? t[2] % 360 * Ga : 0, S()) : [g * Xa, y * Xa, _ * Xa];
    }, A.angle = function (t) {
      return arguments.length ? (b = t % 360 * Ga, S()) : b * Xa;
    }, A.precision = function (t) {
      return arguments.length ? (a = zs(u, N = t * t), k()) : ru(N);
    }, A.fitExtent = function (t, n) {
      return Ts(A, t, n);
    }, A.fitSize = function (t, n) {
      return Ss(A, t, n);
    }, A.fitWidth = function (t, n) {
      return ks(A, t, n);
    }, A.fitHeight = function (t, n) {
      return Es(A, t, n);
    }, function () {
      return n = t.apply(this, arguments), A.invert = n.invert && T, S();
    };
  }
  function Us(t) {
    var n = 0,
      e = Fa / 3,
      r = Ls(t),
      i = r(n, e);
    return i.parallels = function (t) {
      return arguments.length ? r(n = t[0] * Ga, e = t[1] * Ga) : [n * Xa, e * Xa];
    }, i;
  }
  function Os(t, n) {
    var e = nu(t),
      r = (e + nu(n)) / 2;
    if (Va(r) < Ba) return function (t) {
      var n = Za(t);
      function e(t, e) {
        return [t * n, nu(e) / n];
      }
      return e.invert = function (t, e) {
        return [t / n, au(e * n)];
      }, e;
    }(t);
    var i = 1 + e * (2 * r - e),
      o = ru(i) / r;
    function a(t, n) {
      var e = ru(i - 2 * r * nu(n)) / r;
      return [e * nu(t *= r), o - e * Za(t)];
    }
    return a.invert = function (t, n) {
      var e = o - n;
      return [Wa(t, Va(e)) / r * eu(e), au((i - (t * t + e * e) * r * r) / (2 * r))];
    }, a;
  }
  function Bs() {
    return Us(Os).scale(155.424).center([0, 33.6442]);
  }
  function Ys() {
    return Bs().parallels([29.5, 45.5]).scale(1070).translate([480, 250]).rotate([96, 0]).center([-.6, 38.7]);
  }
  function Fs(t) {
    return function (n, e) {
      var r = Za(n),
        i = Za(e),
        o = t(r * i);
      return [o * i * nu(n), o * nu(e)];
    };
  }
  function Is(t) {
    return function (n, e) {
      var r = ru(n * n + e * e),
        i = t(r),
        o = nu(i),
        a = Za(i);
      return [Wa(n * o, r * a), au(r && e * o / r)];
    };
  }
  var js = Fs(function (t) {
    return ru(2 / (1 + t));
  });
  js.invert = Is(function (t) {
    return 2 * au(t / 2);
  });
  var Hs = Fs(function (t) {
    return (t = ou(t)) && t / nu(t);
  });
  function Xs(t, n) {
    return [t, Ka(iu((Ia + n) / 2))];
  }
  function Gs(t) {
    var n,
      e,
      r,
      i = qs(t),
      o = i.center,
      a = i.scale,
      u = i.translate,
      c = i.clipExtent,
      f = null;
    function s() {
      var o = Fa * a(),
        u = i(Lc(i.rotate()).invert([0, 0]));
      return c(null == f ? [[u[0] - o, u[1] - o], [u[0] + o, u[1] + o]] : t === Xs ? [[Math.max(u[0] - o, f), n], [Math.min(u[0] + o, e), r]] : [[f, Math.max(u[1] - o, n)], [e, Math.min(u[1] + o, r)]]);
    }
    return i.scale = function (t) {
      return arguments.length ? (a(t), s()) : a();
    }, i.translate = function (t) {
      return arguments.length ? (u(t), s()) : u();
    }, i.center = function (t) {
      return arguments.length ? (o(t), s()) : o();
    }, i.clipExtent = function (t) {
      return arguments.length ? (null == t ? f = n = e = r = null : (f = +t[0][0], n = +t[0][1], e = +t[1][0], r = +t[1][1]), s()) : null == f ? null : [[f, n], [e, r]];
    }, s();
  }
  function Vs(t) {
    return iu((Ia + t) / 2);
  }
  function $s(t, n) {
    var e = Za(t),
      r = t === n ? nu(t) : Ka(e / Za(n)) / Ka(Vs(n) / Vs(t)),
      i = e * tu(Vs(t), r) / r;
    if (!r) return Xs;
    function o(t, n) {
      i > 0 ? n < -Ia + Ba && (n = -Ia + Ba) : n > Ia - Ba && (n = Ia - Ba);
      var e = i / tu(Vs(n), r);
      return [e * nu(r * t), i - e * Za(r * t)];
    }
    return o.invert = function (t, n) {
      var e = i - n,
        o = eu(r) * ru(t * t + e * e);
      return [Wa(t, Va(e)) / r * eu(e), 2 * $a(tu(i / o, 1 / r)) - Ia];
    }, o;
  }
  function Ws(t, n) {
    return [t, n];
  }
  function Zs(t, n) {
    var e = Za(t),
      r = t === n ? nu(t) : (e - Za(n)) / (n - t),
      i = e / r + t;
    if (Va(r) < Ba) return Ws;
    function o(t, n) {
      var e = i - n,
        o = r * t;
      return [e * nu(o), i - e * Za(o)];
    }
    return o.invert = function (t, n) {
      var e = i - n;
      return [Wa(t, Va(e)) / r * eu(e), i - eu(r) * ru(t * t + e * e)];
    }, o;
  }
  Hs.invert = Is(function (t) {
    return t;
  }), Xs.invert = function (t, n) {
    return [t, 2 * $a(Ja(n)) - Ia];
  }, Ws.invert = Ws;
  var Qs = 1.340264,
    Js = -.081106,
    Ks = 893e-6,
    tl = .003796,
    nl = ru(3) / 2;
  function el(t, n) {
    var e = au(nl * nu(n)),
      r = e * e,
      i = r * r * r;
    return [t * Za(e) / (nl * (Qs + 3 * Js * r + i * (7 * Ks + 9 * tl * r))), e * (Qs + Js * r + i * (Ks + tl * r))];
  }
  function rl(t, n) {
    var e = Za(n),
      r = Za(t) * e;
    return [e * nu(t) / r, nu(n) / r];
  }
  function il(t, n, e, r) {
    return 1 === t && 1 === n && 0 === e && 0 === r ? Af : Ms({
      point: function point(i, o) {
        this.stream.point(i * t + e, o * n + r);
      }
    });
  }
  function ol(t, n) {
    var e = n * n,
      r = e * e;
    return [t * (.8707 - .131979 * e + r * (r * (.003971 * e - .001529 * r) - .013791)), n * (1.007226 + e * (.015085 + r * (.028874 * e - .044475 - .005916 * r)))];
  }
  function al(t, n) {
    return [Za(n) * nu(t), nu(n)];
  }
  function ul(t, n) {
    var e = Za(n),
      r = 1 + Za(t) * e;
    return [e * nu(t) / r, nu(n) / r];
  }
  function cl(t, n) {
    return [Ka(iu((Ia + n) / 2)), -t];
  }
  function fl(t, n) {
    return t.parent === n.parent ? 1 : 2;
  }
  function sl(t, n) {
    return t + n.x;
  }
  function ll(t, n) {
    return Math.max(t, n.y);
  }
  function hl(t) {
    var n = 0,
      e = t.children,
      r = e && e.length;
    if (r) for (; --r >= 0;) n += e[r].value;else n = 1;
    t.value = n;
  }
  function dl(t, n) {
    var e,
      r,
      i,
      o,
      a,
      u = new yl(t),
      c = +t.value && (u.value = t.value),
      f = [u];
    for (null == n && (n = pl); e = f.pop();) if (c && (e.value = +e.data.value), (i = n(e.data)) && (a = i.length)) for (e.children = new Array(a), o = a - 1; o >= 0; --o) f.push(r = e.children[o] = new yl(i[o])), r.parent = e, r.depth = e.depth + 1;
    return u.eachBefore(gl);
  }
  function pl(t) {
    return t.children;
  }
  function vl(t) {
    t.data = t.data.data;
  }
  function gl(t) {
    var n = 0;
    do {
      t.height = n;
    } while ((t = t.parent) && t.height < ++n);
  }
  function yl(t) {
    this.data = t, this.depth = this.height = 0, this.parent = null;
  }
  el.invert = function (t, n) {
    for (var e, r = n, i = r * r, o = i * i * i, a = 0; a < 12 && (o = (i = (r -= e = (r * (Qs + Js * i + o * (Ks + tl * i)) - n) / (Qs + 3 * Js * i + o * (7 * Ks + 9 * tl * i))) * r) * i * i, !(Va(e) < Ya)); ++a);
    return [nl * t * (Qs + 3 * Js * i + o * (7 * Ks + 9 * tl * i)) / Za(r), au(nu(r) / nl)];
  }, rl.invert = Is($a), ol.invert = function (t, n) {
    var e,
      r = n,
      i = 25;
    do {
      var o = r * r,
        a = o * o;
      r -= e = (r * (1.007226 + o * (.015085 + a * (.028874 * o - .044475 - .005916 * a))) - n) / (1.007226 + o * (.045255 + a * (.259866 * o - .311325 - .005916 * 11 * a)));
    } while (Va(e) > Ba && --i > 0);
    return [t / (.8707 + (o = r * r) * (o * (o * o * o * (.003971 - .001529 * o) - .013791) - .131979)), r];
  }, al.invert = Is(au), ul.invert = Is(function (t) {
    return 2 * $a(t);
  }), cl.invert = function (t, n) {
    return [-n, 2 * $a(Ja(t)) - Ia];
  }, yl.prototype = dl.prototype = {
    constructor: yl,
    count: function count() {
      return this.eachAfter(hl);
    },
    each: function each(t) {
      var n,
        e,
        r,
        i,
        o = this,
        a = [o];
      do {
        for (n = a.reverse(), a = []; o = n.pop();) if (t(o), e = o.children) for (r = 0, i = e.length; r < i; ++r) a.push(e[r]);
      } while (a.length);
      return this;
    },
    eachAfter: function eachAfter(t) {
      for (var n, e, r, i = this, o = [i], a = []; i = o.pop();) if (a.push(i), n = i.children) for (e = 0, r = n.length; e < r; ++e) o.push(n[e]);
      for (; i = a.pop();) t(i);
      return this;
    },
    eachBefore: function eachBefore(t) {
      for (var n, e, r = this, i = [r]; r = i.pop();) if (t(r), n = r.children) for (e = n.length - 1; e >= 0; --e) i.push(n[e]);
      return this;
    },
    sum: function sum(t) {
      return this.eachAfter(function (n) {
        for (var e = +t(n.data) || 0, r = n.children, i = r && r.length; --i >= 0;) e += r[i].value;
        n.value = e;
      });
    },
    sort: function sort(t) {
      return this.eachBefore(function (n) {
        n.children && n.children.sort(t);
      });
    },
    path: function path(t) {
      for (var n = this, e = function (t, n) {
          if (t === n) return t;
          var e = t.ancestors(),
            r = n.ancestors(),
            i = null;
          for (t = e.pop(), n = r.pop(); t === n;) i = t, t = e.pop(), n = r.pop();
          return i;
        }(n, t), r = [n]; n !== e;) n = n.parent, r.push(n);
      for (var i = r.length; t !== e;) r.splice(i, 0, t), t = t.parent;
      return r;
    },
    ancestors: function ancestors() {
      for (var t = this, n = [t]; t = t.parent;) n.push(t);
      return n;
    },
    descendants: function descendants() {
      var t = [];
      return this.each(function (n) {
        t.push(n);
      }), t;
    },
    leaves: function leaves() {
      var t = [];
      return this.eachBefore(function (n) {
        n.children || t.push(n);
      }), t;
    },
    links: function links() {
      var t = this,
        n = [];
      return t.each(function (e) {
        e !== t && n.push({
          source: e.parent,
          target: e
        });
      }), n;
    },
    copy: function copy() {
      return dl(this).eachBefore(vl);
    }
  };
  var _l = Array.prototype.slice;
  function bl(t) {
    for (var n, e, r = 0, i = (t = function (t) {
        for (var n, e, r = t.length; r;) e = Math.random() * r-- | 0, n = t[r], t[r] = t[e], t[e] = n;
        return t;
      }(_l.call(t))).length, o = []; r < i;) n = t[r], e && wl(e, n) ? ++r : (e = Nl(o = ml(o, n)), r = 0);
    return e;
  }
  function ml(t, n) {
    var e, r;
    if (Ml(n, t)) return [n];
    for (e = 0; e < t.length; ++e) if (xl(n, t[e]) && Ml(Al(t[e], n), t)) return [t[e], n];
    for (e = 0; e < t.length - 1; ++e) for (r = e + 1; r < t.length; ++r) if (xl(Al(t[e], t[r]), n) && xl(Al(t[e], n), t[r]) && xl(Al(t[r], n), t[e]) && Ml(Tl(t[e], t[r], n), t)) return [t[e], t[r], n];
    throw new Error();
  }
  function xl(t, n) {
    var e = t.r - n.r,
      r = n.x - t.x,
      i = n.y - t.y;
    return e < 0 || e * e < r * r + i * i;
  }
  function wl(t, n) {
    var e = t.r - n.r + 1e-6,
      r = n.x - t.x,
      i = n.y - t.y;
    return e > 0 && e * e > r * r + i * i;
  }
  function Ml(t, n) {
    for (var e = 0; e < n.length; ++e) if (!wl(t, n[e])) return !1;
    return !0;
  }
  function Nl(t) {
    switch (t.length) {
      case 1:
        return {
          x: (n = t[0]).x,
          y: n.y,
          r: n.r
        };
      case 2:
        return Al(t[0], t[1]);
      case 3:
        return Tl(t[0], t[1], t[2]);
    }
    var n;
  }
  function Al(t, n) {
    var e = t.x,
      r = t.y,
      i = t.r,
      o = n.x,
      a = n.y,
      u = n.r,
      c = o - e,
      f = a - r,
      s = u - i,
      l = Math.sqrt(c * c + f * f);
    return {
      x: (e + o + c / l * s) / 2,
      y: (r + a + f / l * s) / 2,
      r: (l + i + u) / 2
    };
  }
  function Tl(t, n, e) {
    var r = t.x,
      i = t.y,
      o = t.r,
      a = n.x,
      u = n.y,
      c = n.r,
      f = e.x,
      s = e.y,
      l = e.r,
      h = r - a,
      d = r - f,
      p = i - u,
      v = i - s,
      g = c - o,
      y = l - o,
      _ = r * r + i * i - o * o,
      b = _ - a * a - u * u + c * c,
      m = _ - f * f - s * s + l * l,
      x = d * p - h * v,
      w = (p * m - v * b) / (2 * x) - r,
      M = (v * g - p * y) / x,
      N = (d * b - h * m) / (2 * x) - i,
      A = (h * y - d * g) / x,
      T = M * M + A * A - 1,
      S = 2 * (o + w * M + N * A),
      k = w * w + N * N - o * o,
      E = -(T ? (S + Math.sqrt(S * S - 4 * T * k)) / (2 * T) : k / S);
    return {
      x: r + w + M * E,
      y: i + N + A * E,
      r: E
    };
  }
  function Sl(t, n, e) {
    var r,
      i,
      o,
      a,
      u = t.x - n.x,
      c = t.y - n.y,
      f = u * u + c * c;
    f ? (i = n.r + e.r, i *= i, a = t.r + e.r, i > (a *= a) ? (r = (f + a - i) / (2 * f), o = Math.sqrt(Math.max(0, a / f - r * r)), e.x = t.x - r * u - o * c, e.y = t.y - r * c + o * u) : (r = (f + i - a) / (2 * f), o = Math.sqrt(Math.max(0, i / f - r * r)), e.x = n.x + r * u - o * c, e.y = n.y + r * c + o * u)) : (e.x = n.x + e.r, e.y = n.y);
  }
  function kl(t, n) {
    var e = t.r + n.r - 1e-6,
      r = n.x - t.x,
      i = n.y - t.y;
    return e > 0 && e * e > r * r + i * i;
  }
  function El(t) {
    var n = t._,
      e = t.next._,
      r = n.r + e.r,
      i = (n.x * e.r + e.x * n.r) / r,
      o = (n.y * e.r + e.y * n.r) / r;
    return i * i + o * o;
  }
  function Cl(t) {
    this._ = t, this.next = null, this.previous = null;
  }
  function Pl(t) {
    if (!(i = t.length)) return 0;
    var n, e, r, i, o, a, u, c, f, s, l;
    if ((n = t[0]).x = 0, n.y = 0, !(i > 1)) return n.r;
    if (e = t[1], n.x = -e.r, e.x = n.r, e.y = 0, !(i > 2)) return n.r + e.r;
    Sl(e, n, r = t[2]), n = new Cl(n), e = new Cl(e), r = new Cl(r), n.next = r.previous = e, e.next = n.previous = r, r.next = e.previous = n;
    t: for (u = 3; u < i; ++u) {
      Sl(n._, e._, r = t[u]), r = new Cl(r), c = e.next, f = n.previous, s = e._.r, l = n._.r;
      do {
        if (s <= l) {
          if (kl(c._, r._)) {
            e = c, n.next = e, e.previous = n, --u;
            continue t;
          }
          s += c._.r, c = c.next;
        } else {
          if (kl(f._, r._)) {
            (n = f).next = e, e.previous = n, --u;
            continue t;
          }
          l += f._.r, f = f.previous;
        }
      } while (c !== f.next);
      for (r.previous = n, r.next = e, n.next = e.previous = e = r, o = El(n); (r = r.next) !== e;) (a = El(r)) < o && (n = r, o = a);
      e = n.next;
    }
    for (n = [e._], r = e; (r = r.next) !== e;) n.push(r._);
    for (r = bl(n), u = 0; u < i; ++u) (n = t[u]).x -= r.x, n.y -= r.y;
    return r.r;
  }
  function zl(t) {
    if ("function" != typeof t) throw new Error();
    return t;
  }
  function Rl() {
    return 0;
  }
  function Dl(t) {
    return function () {
      return t;
    };
  }
  function ql(t) {
    return Math.sqrt(t.value);
  }
  function Ll(t) {
    return function (n) {
      n.children || (n.r = Math.max(0, +t(n) || 0));
    };
  }
  function Ul(t, n) {
    return function (e) {
      if (r = e.children) {
        var r,
          i,
          o,
          a = r.length,
          u = t(e) * n || 0;
        if (u) for (i = 0; i < a; ++i) r[i].r += u;
        if (o = Pl(r), u) for (i = 0; i < a; ++i) r[i].r -= u;
        e.r = o + u;
      }
    };
  }
  function Ol(t) {
    return function (n) {
      var e = n.parent;
      n.r *= t, e && (n.x = e.x + t * n.x, n.y = e.y + t * n.y);
    };
  }
  function Bl(t) {
    t.x0 = Math.round(t.x0), t.y0 = Math.round(t.y0), t.x1 = Math.round(t.x1), t.y1 = Math.round(t.y1);
  }
  function Yl(t, n, e, r, i) {
    for (var o, a = t.children, u = -1, c = a.length, f = t.value && (r - n) / t.value; ++u < c;) (o = a[u]).y0 = e, o.y1 = i, o.x0 = n, o.x1 = n += o.value * f;
  }
  var Fl = "$",
    Il = {
      depth: -1
    },
    jl = {};
  function Hl(t) {
    return t.id;
  }
  function Xl(t) {
    return t.parentId;
  }
  function Gl(t, n) {
    return t.parent === n.parent ? 1 : 2;
  }
  function Vl(t) {
    var n = t.children;
    return n ? n[0] : t.t;
  }
  function $l(t) {
    var n = t.children;
    return n ? n[n.length - 1] : t.t;
  }
  function Wl(t, n, e) {
    var r = e / (n.i - t.i);
    n.c -= r, n.s += e, t.c += r, n.z += e, n.m += e;
  }
  function Zl(t, n, e) {
    return t.a.parent === n.parent ? t.a : e;
  }
  function Ql(t, n) {
    this._ = t, this.parent = null, this.children = null, this.A = null, this.a = this, this.z = 0, this.m = 0, this.c = 0, this.s = 0, this.t = null, this.i = n;
  }
  function Jl(t, n, e, r, i) {
    for (var o, a = t.children, u = -1, c = a.length, f = t.value && (i - e) / t.value; ++u < c;) (o = a[u]).x0 = n, o.x1 = r, o.y0 = e, o.y1 = e += o.value * f;
  }
  Ql.prototype = Object.create(yl.prototype);
  var Kl = (1 + Math.sqrt(5)) / 2;
  function th(t, n, e, r, i, o) {
    for (var a, u, c, f, s, l, h, d, p, v, g, y = [], _ = n.children, b = 0, m = 0, x = _.length, w = n.value; b < x;) {
      c = i - e, f = o - r;
      do {
        s = _[m++].value;
      } while (!s && m < x);
      for (l = h = s, g = s * s * (v = Math.max(f / c, c / f) / (w * t)), p = Math.max(h / g, g / l); m < x; ++m) {
        if (s += u = _[m].value, u < l && (l = u), u > h && (h = u), g = s * s * v, (d = Math.max(h / g, g / l)) > p) {
          s -= u;
          break;
        }
        p = d;
      }
      y.push(a = {
        value: s,
        dice: c < f,
        children: _.slice(b, m)
      }), a.dice ? Yl(a, e, r, i, w ? r += f * s / w : o) : Jl(a, e, r, w ? e += c * s / w : i, o), w -= s, b = m;
    }
    return y;
  }
  var nh = function t(n) {
    function e(t, e, r, i, o) {
      th(n, t, e, r, i, o);
    }
    return e.ratio = function (n) {
      return t((n = +n) > 1 ? n : 1);
    }, e;
  }(Kl);
  var eh = function t(n) {
    function e(t, e, r, i, o) {
      if ((a = t._squarify) && a.ratio === n) for (var a, u, c, f, s, l = -1, h = a.length, d = t.value; ++l < h;) {
        for (c = (u = a[l]).children, f = u.value = 0, s = c.length; f < s; ++f) u.value += c[f].value;
        u.dice ? Yl(u, e, r, i, r += (o - r) * u.value / d) : Jl(u, e, r, e += (i - e) * u.value / d, o), d -= u.value;
      } else t._squarify = a = th(n, t, e, r, i, o), a.ratio = n;
    }
    return e.ratio = function (n) {
      return t((n = +n) > 1 ? n : 1);
    }, e;
  }(Kl);
  function rh(t, n) {
    return t[0] - n[0] || t[1] - n[1];
  }
  function ih(t) {
    for (var n, e, r, i = t.length, o = [0, 1], a = 2, u = 2; u < i; ++u) {
      for (; a > 1 && (n = t[o[a - 2]], e = t[o[a - 1]], r = t[u], (e[0] - n[0]) * (r[1] - n[1]) - (e[1] - n[1]) * (r[0] - n[0]) <= 0);) --a;
      o[a++] = u;
    }
    return o.slice(0, a);
  }
  function oh() {
    return Math.random();
  }
  var ah = function t(n) {
      function e(t, e) {
        return t = null == t ? 0 : +t, e = null == e ? 1 : +e, 1 === arguments.length ? (e = t, t = 0) : e -= t, function () {
          return n() * e + t;
        };
      }
      return e.source = t, e;
    }(oh),
    uh = function t(n) {
      function e(t, e) {
        var r, i;
        return t = null == t ? 0 : +t, e = null == e ? 1 : +e, function () {
          var o;
          if (null != r) o = r, r = null;else do {
            r = 2 * n() - 1, o = 2 * n() - 1, i = r * r + o * o;
          } while (!i || i > 1);
          return t + e * o * Math.sqrt(-2 * Math.log(i) / i);
        };
      }
      return e.source = t, e;
    }(oh),
    ch = function t(n) {
      function e() {
        var t = uh.source(n).apply(this, arguments);
        return function () {
          return Math.exp(t());
        };
      }
      return e.source = t, e;
    }(oh),
    fh = function t(n) {
      function e(t) {
        return function () {
          for (var e = 0, r = 0; r < t; ++r) e += n();
          return e;
        };
      }
      return e.source = t, e;
    }(oh),
    sh = function t(n) {
      function e(t) {
        var e = fh.source(n)(t);
        return function () {
          return e() / t;
        };
      }
      return e.source = t, e;
    }(oh),
    lh = function t(n) {
      function e(t) {
        return function () {
          return -Math.log(1 - n()) / t;
        };
      }
      return e.source = t, e;
    }(oh);
  function hh(t, n) {
    switch (arguments.length) {
      case 0:
        break;
      case 1:
        this.range(t);
        break;
      default:
        this.range(n).domain(t);
    }
    return this;
  }
  function dh(t, n) {
    switch (arguments.length) {
      case 0:
        break;
      case 1:
        this.interpolator(t);
        break;
      default:
        this.interpolator(n).domain(t);
    }
    return this;
  }
  var ph = Array.prototype,
    vh = ph.map,
    gh = ph.slice,
    yh = {
      name: "implicit"
    };
  function _h() {
    var t = Ji(),
      n = [],
      e = [],
      r = yh;
    function i(i) {
      var o = i + "",
        a = t.get(o);
      if (!a) {
        if (r !== yh) return r;
        t.set(o, a = n.push(i));
      }
      return e[(a - 1) % e.length];
    }
    return i.domain = function (e) {
      if (!arguments.length) return n.slice();
      n = [], t = Ji();
      for (var r, o, a = -1, u = e.length; ++a < u;) t.has(o = (r = e[a]) + "") || t.set(o, n.push(r));
      return i;
    }, i.range = function (t) {
      return arguments.length ? (e = gh.call(t), i) : e.slice();
    }, i.unknown = function (t) {
      return arguments.length ? (r = t, i) : r;
    }, i.copy = function () {
      return _h(n, e).unknown(r);
    }, hh.apply(i, arguments), i;
  }
  function bh() {
    var t,
      n,
      e = _h().unknown(void 0),
      r = e.domain,
      i = e.range,
      o = [0, 1],
      a = !1,
      u = 0,
      c = 0,
      f = .5;
    function s() {
      var e = r().length,
        s = o[1] < o[0],
        l = o[s - 0],
        h = o[1 - s];
      t = (h - l) / Math.max(1, e - u + 2 * c), a && (t = Math.floor(t)), l += (h - l - t * (e - u)) * f, n = t * (1 - u), a && (l = Math.round(l), n = Math.round(n));
      var d = g(e).map(function (n) {
        return l + t * n;
      });
      return i(s ? d.reverse() : d);
    }
    return delete e.unknown, e.domain = function (t) {
      return arguments.length ? (r(t), s()) : r();
    }, e.range = function (t) {
      return arguments.length ? (o = [+t[0], +t[1]], s()) : o.slice();
    }, e.rangeRound = function (t) {
      return o = [+t[0], +t[1]], a = !0, s();
    }, e.bandwidth = function () {
      return n;
    }, e.step = function () {
      return t;
    }, e.round = function (t) {
      return arguments.length ? (a = !!t, s()) : a;
    }, e.padding = function (t) {
      return arguments.length ? (u = Math.min(1, c = +t), s()) : u;
    }, e.paddingInner = function (t) {
      return arguments.length ? (u = Math.min(1, t), s()) : u;
    }, e.paddingOuter = function (t) {
      return arguments.length ? (c = +t, s()) : c;
    }, e.align = function (t) {
      return arguments.length ? (f = Math.max(0, Math.min(1, t)), s()) : f;
    }, e.copy = function () {
      return bh(r(), o).round(a).paddingInner(u).paddingOuter(c).align(f);
    }, hh.apply(s(), arguments);
  }
  function mh(t) {
    return +t;
  }
  var xh = [0, 1];
  function wh(t) {
    return t;
  }
  function Mh(t, n) {
    return (n -= t = +t) ? function (e) {
      return (e - t) / n;
    } : (e = isNaN(n) ? NaN : .5, function () {
      return e;
    });
    var e;
  }
  function Nh(t) {
    var n,
      e = t[0],
      r = t[t.length - 1];
    return e > r && (n = e, e = r, r = n), function (t) {
      return Math.max(e, Math.min(r, t));
    };
  }
  function Ah(t, n, e) {
    var r = t[0],
      i = t[1],
      o = n[0],
      a = n[1];
    return i < r ? (r = Mh(i, r), o = e(a, o)) : (r = Mh(r, i), o = e(o, a)), function (t) {
      return o(r(t));
    };
  }
  function Th(t, n, e) {
    var r = Math.min(t.length, n.length) - 1,
      o = new Array(r),
      a = new Array(r),
      u = -1;
    for (t[r] < t[0] && (t = t.slice().reverse(), n = n.slice().reverse()); ++u < r;) o[u] = Mh(t[u], t[u + 1]), a[u] = e(n[u], n[u + 1]);
    return function (n) {
      var e = i(t, n, 1, r) - 1;
      return a[e](o[e](n));
    };
  }
  function Sh(t, n) {
    return n.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown());
  }
  function kh() {
    var t,
      n,
      e,
      r,
      i,
      o,
      a = xh,
      u = xh,
      c = _e,
      f = wh;
    function s() {
      return r = Math.min(a.length, u.length) > 2 ? Th : Ah, i = o = null, l;
    }
    function l(n) {
      return isNaN(n = +n) ? e : (i || (i = r(a.map(t), u, c)))(t(f(n)));
    }
    return l.invert = function (e) {
      return f(n((o || (o = r(u, a.map(t), de)))(e)));
    }, l.domain = function (t) {
      return arguments.length ? (a = vh.call(t, mh), f === wh || (f = Nh(a)), s()) : a.slice();
    }, l.range = function (t) {
      return arguments.length ? (u = gh.call(t), s()) : u.slice();
    }, l.rangeRound = function (t) {
      return u = gh.call(t), c = be, s();
    }, l.clamp = function (t) {
      return arguments.length ? (f = t ? Nh(a) : wh, l) : f !== wh;
    }, l.interpolate = function (t) {
      return arguments.length ? (c = t, s()) : c;
    }, l.unknown = function (t) {
      return arguments.length ? (e = t, l) : e;
    }, function (e, r) {
      return t = e, n = r, s();
    };
  }
  function Eh(t, n) {
    return kh()(t, n);
  }
  function Ch(n, e, r, i) {
    var o,
      a = w(n, e, r);
    switch ((i = Ma(null == i ? ",f" : i)).type) {
      case "s":
        var u = Math.max(Math.abs(n), Math.abs(e));
        return null != i.precision || isNaN(o = Ra(a, u)) || (i.precision = o), t.formatPrefix(i, u);
      case "":
      case "e":
      case "g":
      case "p":
      case "r":
        null != i.precision || isNaN(o = Da(a, Math.max(Math.abs(n), Math.abs(e)))) || (i.precision = o - ("e" === i.type));
        break;
      case "f":
      case "%":
        null != i.precision || isNaN(o = za(a)) || (i.precision = o - 2 * ("%" === i.type));
    }
    return t.format(i);
  }
  function Ph(t) {
    var n = t.domain;
    return t.ticks = function (t) {
      var e = n();
      return m(e[0], e[e.length - 1], null == t ? 10 : t);
    }, t.tickFormat = function (t, e) {
      var r = n();
      return Ch(r[0], r[r.length - 1], null == t ? 10 : t, e);
    }, t.nice = function (e) {
      null == e && (e = 10);
      var r,
        i = n(),
        o = 0,
        a = i.length - 1,
        u = i[o],
        c = i[a];
      return c < u && (r = u, u = c, c = r, r = o, o = a, a = r), (r = x(u, c, e)) > 0 ? r = x(u = Math.floor(u / r) * r, c = Math.ceil(c / r) * r, e) : r < 0 && (r = x(u = Math.ceil(u * r) / r, c = Math.floor(c * r) / r, e)), r > 0 ? (i[o] = Math.floor(u / r) * r, i[a] = Math.ceil(c / r) * r, n(i)) : r < 0 && (i[o] = Math.ceil(u * r) / r, i[a] = Math.floor(c * r) / r, n(i)), t;
    }, t;
  }
  function zh(t, n) {
    var e,
      r = 0,
      i = (t = t.slice()).length - 1,
      o = t[r],
      a = t[i];
    return a < o && (e = r, r = i, i = e, e = o, o = a, a = e), t[r] = n.floor(o), t[i] = n.ceil(a), t;
  }
  function Rh(t) {
    return Math.log(t);
  }
  function Dh(t) {
    return Math.exp(t);
  }
  function qh(t) {
    return -Math.log(-t);
  }
  function Lh(t) {
    return -Math.exp(-t);
  }
  function Uh(t) {
    return isFinite(t) ? +("1e" + t) : t < 0 ? 0 : t;
  }
  function Oh(t) {
    return function (n) {
      return -t(-n);
    };
  }
  function Bh(n) {
    var e,
      r,
      i = n(Rh, Dh),
      o = i.domain,
      a = 10;
    function u() {
      return e = function (t) {
        return t === Math.E ? Math.log : 10 === t && Math.log10 || 2 === t && Math.log2 || (t = Math.log(t), function (n) {
          return Math.log(n) / t;
        });
      }(a), r = function (t) {
        return 10 === t ? Uh : t === Math.E ? Math.exp : function (n) {
          return Math.pow(t, n);
        };
      }(a), o()[0] < 0 ? (e = Oh(e), r = Oh(r), n(qh, Lh)) : n(Rh, Dh), i;
    }
    return i.base = function (t) {
      return arguments.length ? (a = +t, u()) : a;
    }, i.domain = function (t) {
      return arguments.length ? (o(t), u()) : o();
    }, i.ticks = function (t) {
      var n,
        i = o(),
        u = i[0],
        c = i[i.length - 1];
      (n = c < u) && (h = u, u = c, c = h);
      var f,
        s,
        l,
        h = e(u),
        d = e(c),
        p = null == t ? 10 : +t,
        v = [];
      if (!(a % 1) && d - h < p) {
        if (h = Math.round(h) - 1, d = Math.round(d) + 1, u > 0) {
          for (; h < d; ++h) for (s = 1, f = r(h); s < a; ++s) if (!((l = f * s) < u)) {
            if (l > c) break;
            v.push(l);
          }
        } else for (; h < d; ++h) for (s = a - 1, f = r(h); s >= 1; --s) if (!((l = f * s) < u)) {
          if (l > c) break;
          v.push(l);
        }
      } else v = m(h, d, Math.min(d - h, p)).map(r);
      return n ? v.reverse() : v;
    }, i.tickFormat = function (n, o) {
      if (null == o && (o = 10 === a ? ".0e" : ","), "function" != typeof o && (o = t.format(o)), n === 1 / 0) return o;
      null == n && (n = 10);
      var u = Math.max(1, a * n / i.ticks().length);
      return function (t) {
        var n = t / r(Math.round(e(t)));
        return n * a < a - .5 && (n *= a), n <= u ? o(t) : "";
      };
    }, i.nice = function () {
      return o(zh(o(), {
        floor: function floor(t) {
          return r(Math.floor(e(t)));
        },
        ceil: function ceil(t) {
          return r(Math.ceil(e(t)));
        }
      }));
    }, i;
  }
  function Yh(t) {
    return function (n) {
      return Math.sign(n) * Math.log1p(Math.abs(n / t));
    };
  }
  function Fh(t) {
    return function (n) {
      return Math.sign(n) * Math.expm1(Math.abs(n)) * t;
    };
  }
  function Ih(t) {
    var n = 1,
      e = t(Yh(n), Fh(n));
    return e.constant = function (e) {
      return arguments.length ? t(Yh(n = +e), Fh(n)) : n;
    }, Ph(e);
  }
  function jh(t) {
    return function (n) {
      return n < 0 ? -Math.pow(-n, t) : Math.pow(n, t);
    };
  }
  function Hh(t) {
    return t < 0 ? -Math.sqrt(-t) : Math.sqrt(t);
  }
  function Xh(t) {
    return t < 0 ? -t * t : t * t;
  }
  function Gh(t) {
    var n = t(wh, wh),
      e = 1;
    return n.exponent = function (n) {
      return arguments.length ? 1 === (e = +n) ? t(wh, wh) : .5 === e ? t(Hh, Xh) : t(jh(e), jh(1 / e)) : e;
    }, Ph(n);
  }
  function Vh() {
    var t = Gh(kh());
    return t.copy = function () {
      return Sh(t, Vh()).exponent(t.exponent());
    }, hh.apply(t, arguments), t;
  }
  var $h = new Date(),
    Wh = new Date();
  function Zh(t, n, e, r) {
    function i(n) {
      return t(n = new Date(+n)), n;
    }
    return i.floor = i, i.ceil = function (e) {
      return t(e = new Date(e - 1)), n(e, 1), t(e), e;
    }, i.round = function (t) {
      var n = i(t),
        e = i.ceil(t);
      return t - n < e - t ? n : e;
    }, i.offset = function (t, e) {
      return n(t = new Date(+t), null == e ? 1 : Math.floor(e)), t;
    }, i.range = function (e, r, o) {
      var a,
        u = [];
      if (e = i.ceil(e), o = null == o ? 1 : Math.floor(o), !(e < r && o > 0)) return u;
      do {
        u.push(a = new Date(+e)), n(e, o), t(e);
      } while (a < e && e < r);
      return u;
    }, i.filter = function (e) {
      return Zh(function (n) {
        if (n >= n) for (; t(n), !e(n);) n.setTime(n - 1);
      }, function (t, r) {
        if (t >= t) if (r < 0) for (; ++r <= 0;) for (; n(t, -1), !e(t););else for (; --r >= 0;) for (; n(t, 1), !e(t););
      });
    }, e && (i.count = function (n, r) {
      return $h.setTime(+n), Wh.setTime(+r), t($h), t(Wh), Math.floor(e($h, Wh));
    }, i.every = function (t) {
      return t = Math.floor(t), isFinite(t) && t > 0 ? t > 1 ? i.filter(r ? function (n) {
        return r(n) % t == 0;
      } : function (n) {
        return i.count(0, n) % t == 0;
      }) : i : null;
    }), i;
  }
  var Qh = Zh(function () {}, function (t, n) {
    t.setTime(+t + n);
  }, function (t, n) {
    return n - t;
  });
  Qh.every = function (t) {
    return t = Math.floor(t), isFinite(t) && t > 0 ? t > 1 ? Zh(function (n) {
      n.setTime(Math.floor(n / t) * t);
    }, function (n, e) {
      n.setTime(+n + e * t);
    }, function (n, e) {
      return (e - n) / t;
    }) : Qh : null;
  };
  var Jh = Qh.range,
    Kh = 6e4,
    td = 6048e5,
    nd = Zh(function (t) {
      t.setTime(t - t.getMilliseconds());
    }, function (t, n) {
      t.setTime(+t + 1e3 * n);
    }, function (t, n) {
      return (n - t) / 1e3;
    }, function (t) {
      return t.getUTCSeconds();
    }),
    ed = nd.range,
    rd = Zh(function (t) {
      t.setTime(t - t.getMilliseconds() - 1e3 * t.getSeconds());
    }, function (t, n) {
      t.setTime(+t + n * Kh);
    }, function (t, n) {
      return (n - t) / Kh;
    }, function (t) {
      return t.getMinutes();
    }),
    id = rd.range,
    od = Zh(function (t) {
      t.setTime(t - t.getMilliseconds() - 1e3 * t.getSeconds() - t.getMinutes() * Kh);
    }, function (t, n) {
      t.setTime(+t + 36e5 * n);
    }, function (t, n) {
      return (n - t) / 36e5;
    }, function (t) {
      return t.getHours();
    }),
    ad = od.range,
    ud = Zh(function (t) {
      t.setHours(0, 0, 0, 0);
    }, function (t, n) {
      t.setDate(t.getDate() + n);
    }, function (t, n) {
      return (n - t - (n.getTimezoneOffset() - t.getTimezoneOffset()) * Kh) / 864e5;
    }, function (t) {
      return t.getDate() - 1;
    }),
    cd = ud.range;
  function fd(t) {
    return Zh(function (n) {
      n.setDate(n.getDate() - (n.getDay() + 7 - t) % 7), n.setHours(0, 0, 0, 0);
    }, function (t, n) {
      t.setDate(t.getDate() + 7 * n);
    }, function (t, n) {
      return (n - t - (n.getTimezoneOffset() - t.getTimezoneOffset()) * Kh) / td;
    });
  }
  var sd = fd(0),
    ld = fd(1),
    hd = fd(2),
    dd = fd(3),
    pd = fd(4),
    vd = fd(5),
    gd = fd(6),
    yd = sd.range,
    _d = ld.range,
    bd = hd.range,
    md = dd.range,
    xd = pd.range,
    wd = vd.range,
    Md = gd.range,
    Nd = Zh(function (t) {
      t.setDate(1), t.setHours(0, 0, 0, 0);
    }, function (t, n) {
      t.setMonth(t.getMonth() + n);
    }, function (t, n) {
      return n.getMonth() - t.getMonth() + 12 * (n.getFullYear() - t.getFullYear());
    }, function (t) {
      return t.getMonth();
    }),
    Ad = Nd.range,
    Td = Zh(function (t) {
      t.setMonth(0, 1), t.setHours(0, 0, 0, 0);
    }, function (t, n) {
      t.setFullYear(t.getFullYear() + n);
    }, function (t, n) {
      return n.getFullYear() - t.getFullYear();
    }, function (t) {
      return t.getFullYear();
    });
  Td.every = function (t) {
    return isFinite(t = Math.floor(t)) && t > 0 ? Zh(function (n) {
      n.setFullYear(Math.floor(n.getFullYear() / t) * t), n.setMonth(0, 1), n.setHours(0, 0, 0, 0);
    }, function (n, e) {
      n.setFullYear(n.getFullYear() + e * t);
    }) : null;
  };
  var Sd = Td.range,
    kd = Zh(function (t) {
      t.setUTCSeconds(0, 0);
    }, function (t, n) {
      t.setTime(+t + n * Kh);
    }, function (t, n) {
      return (n - t) / Kh;
    }, function (t) {
      return t.getUTCMinutes();
    }),
    Ed = kd.range,
    Cd = Zh(function (t) {
      t.setUTCMinutes(0, 0, 0);
    }, function (t, n) {
      t.setTime(+t + 36e5 * n);
    }, function (t, n) {
      return (n - t) / 36e5;
    }, function (t) {
      return t.getUTCHours();
    }),
    Pd = Cd.range,
    zd = Zh(function (t) {
      t.setUTCHours(0, 0, 0, 0);
    }, function (t, n) {
      t.setUTCDate(t.getUTCDate() + n);
    }, function (t, n) {
      return (n - t) / 864e5;
    }, function (t) {
      return t.getUTCDate() - 1;
    }),
    Rd = zd.range;
  function Dd(t) {
    return Zh(function (n) {
      n.setUTCDate(n.getUTCDate() - (n.getUTCDay() + 7 - t) % 7), n.setUTCHours(0, 0, 0, 0);
    }, function (t, n) {
      t.setUTCDate(t.getUTCDate() + 7 * n);
    }, function (t, n) {
      return (n - t) / td;
    });
  }
  var qd = Dd(0),
    Ld = Dd(1),
    Ud = Dd(2),
    Od = Dd(3),
    Bd = Dd(4),
    Yd = Dd(5),
    Fd = Dd(6),
    Id = qd.range,
    jd = Ld.range,
    Hd = Ud.range,
    Xd = Od.range,
    Gd = Bd.range,
    Vd = Yd.range,
    $d = Fd.range,
    Wd = Zh(function (t) {
      t.setUTCDate(1), t.setUTCHours(0, 0, 0, 0);
    }, function (t, n) {
      t.setUTCMonth(t.getUTCMonth() + n);
    }, function (t, n) {
      return n.getUTCMonth() - t.getUTCMonth() + 12 * (n.getUTCFullYear() - t.getUTCFullYear());
    }, function (t) {
      return t.getUTCMonth();
    }),
    Zd = Wd.range,
    Qd = Zh(function (t) {
      t.setUTCMonth(0, 1), t.setUTCHours(0, 0, 0, 0);
    }, function (t, n) {
      t.setUTCFullYear(t.getUTCFullYear() + n);
    }, function (t, n) {
      return n.getUTCFullYear() - t.getUTCFullYear();
    }, function (t) {
      return t.getUTCFullYear();
    });
  Qd.every = function (t) {
    return isFinite(t = Math.floor(t)) && t > 0 ? Zh(function (n) {
      n.setUTCFullYear(Math.floor(n.getUTCFullYear() / t) * t), n.setUTCMonth(0, 1), n.setUTCHours(0, 0, 0, 0);
    }, function (n, e) {
      n.setUTCFullYear(n.getUTCFullYear() + e * t);
    }) : null;
  };
  var Jd = Qd.range;
  function Kd(t) {
    if (0 <= t.y && t.y < 100) {
      var n = new Date(-1, t.m, t.d, t.H, t.M, t.S, t.L);
      return n.setFullYear(t.y), n;
    }
    return new Date(t.y, t.m, t.d, t.H, t.M, t.S, t.L);
  }
  function tp(t) {
    if (0 <= t.y && t.y < 100) {
      var n = new Date(Date.UTC(-1, t.m, t.d, t.H, t.M, t.S, t.L));
      return n.setUTCFullYear(t.y), n;
    }
    return new Date(Date.UTC(t.y, t.m, t.d, t.H, t.M, t.S, t.L));
  }
  function np(t) {
    return {
      y: t,
      m: 0,
      d: 1,
      H: 0,
      M: 0,
      S: 0,
      L: 0
    };
  }
  function ep(t) {
    var n = t.dateTime,
      e = t.date,
      r = t.time,
      i = t.periods,
      o = t.days,
      _a2 = t.shortDays,
      u = t.months,
      c = t.shortMonths,
      f = sp(i),
      s = lp(i),
      l = sp(o),
      h = lp(o),
      d = sp(_a2),
      p = lp(_a2),
      v = sp(u),
      g = lp(u),
      y = sp(c),
      _ = lp(c),
      b = {
        a: function a(t) {
          return _a2[t.getDay()];
        },
        A: function A(t) {
          return o[t.getDay()];
        },
        b: function b(t) {
          return c[t.getMonth()];
        },
        B: function B(t) {
          return u[t.getMonth()];
        },
        c: null,
        d: Pp,
        e: Pp,
        f: Lp,
        H: zp,
        I: Rp,
        j: Dp,
        L: qp,
        m: Up,
        M: Op,
        p: function p(t) {
          return i[+(t.getHours() >= 12)];
        },
        Q: hv,
        s: dv,
        S: Bp,
        u: Yp,
        U: Fp,
        V: Ip,
        w: jp,
        W: Hp,
        x: null,
        X: null,
        y: Xp,
        Y: Gp,
        Z: Vp,
        "%": lv
      },
      m = {
        a: function a(t) {
          return _a2[t.getUTCDay()];
        },
        A: function A(t) {
          return o[t.getUTCDay()];
        },
        b: function b(t) {
          return c[t.getUTCMonth()];
        },
        B: function B(t) {
          return u[t.getUTCMonth()];
        },
        c: null,
        d: $p,
        e: $p,
        f: Kp,
        H: Wp,
        I: Zp,
        j: Qp,
        L: Jp,
        m: tv,
        M: nv,
        p: function p(t) {
          return i[+(t.getUTCHours() >= 12)];
        },
        Q: hv,
        s: dv,
        S: ev,
        u: rv,
        U: iv,
        V: ov,
        w: av,
        W: uv,
        x: null,
        X: null,
        y: cv,
        Y: fv,
        Z: sv,
        "%": lv
      },
      x = {
        a: function a(t, n, e) {
          var r = d.exec(n.slice(e));
          return r ? (t.w = p[r[0].toLowerCase()], e + r[0].length) : -1;
        },
        A: function A(t, n, e) {
          var r = l.exec(n.slice(e));
          return r ? (t.w = h[r[0].toLowerCase()], e + r[0].length) : -1;
        },
        b: function b(t, n, e) {
          var r = y.exec(n.slice(e));
          return r ? (t.m = _[r[0].toLowerCase()], e + r[0].length) : -1;
        },
        B: function B(t, n, e) {
          var r = v.exec(n.slice(e));
          return r ? (t.m = g[r[0].toLowerCase()], e + r[0].length) : -1;
        },
        c: function c(t, e, r) {
          return N(t, n, e, r);
        },
        d: xp,
        e: xp,
        f: Sp,
        H: Mp,
        I: Mp,
        j: wp,
        L: Tp,
        m: mp,
        M: Np,
        p: function p(t, n, e) {
          var r = f.exec(n.slice(e));
          return r ? (t.p = s[r[0].toLowerCase()], e + r[0].length) : -1;
        },
        Q: Ep,
        s: Cp,
        S: Ap,
        u: dp,
        U: pp,
        V: vp,
        w: hp,
        W: gp,
        x: function x(t, n, r) {
          return N(t, e, n, r);
        },
        X: function X(t, n, e) {
          return N(t, r, n, e);
        },
        y: _p,
        Y: yp,
        Z: bp,
        "%": kp
      };
    function w(t, n) {
      return function (e) {
        var r,
          i,
          o,
          a = [],
          u = -1,
          c = 0,
          f = t.length;
        for (e instanceof Date || (e = new Date(+e)); ++u < f;) 37 === t.charCodeAt(u) && (a.push(t.slice(c, u)), null != (i = ip[r = t.charAt(++u)]) ? r = t.charAt(++u) : i = "e" === r ? " " : "0", (o = n[r]) && (r = o(e, i)), a.push(r), c = u + 1);
        return a.push(t.slice(c, u)), a.join("");
      };
    }
    function M(t, n) {
      return function (e) {
        var r,
          i,
          o = np(1900);
        if (N(o, t, e += "", 0) != e.length) return null;
        if ("Q" in o) return new Date(o.Q);
        if ("p" in o && (o.H = o.H % 12 + 12 * o.p), "V" in o) {
          if (o.V < 1 || o.V > 53) return null;
          "w" in o || (o.w = 1), "Z" in o ? (i = (r = tp(np(o.y))).getUTCDay(), r = i > 4 || 0 === i ? Ld.ceil(r) : Ld(r), r = zd.offset(r, 7 * (o.V - 1)), o.y = r.getUTCFullYear(), o.m = r.getUTCMonth(), o.d = r.getUTCDate() + (o.w + 6) % 7) : (i = (r = n(np(o.y))).getDay(), r = i > 4 || 0 === i ? ld.ceil(r) : ld(r), r = ud.offset(r, 7 * (o.V - 1)), o.y = r.getFullYear(), o.m = r.getMonth(), o.d = r.getDate() + (o.w + 6) % 7);
        } else ("W" in o || "U" in o) && ("w" in o || (o.w = "u" in o ? o.u % 7 : "W" in o ? 1 : 0), i = "Z" in o ? tp(np(o.y)).getUTCDay() : n(np(o.y)).getDay(), o.m = 0, o.d = "W" in o ? (o.w + 6) % 7 + 7 * o.W - (i + 5) % 7 : o.w + 7 * o.U - (i + 6) % 7);
        return "Z" in o ? (o.H += o.Z / 100 | 0, o.M += o.Z % 100, tp(o)) : n(o);
      };
    }
    function N(t, n, e, r) {
      for (var i, o, a = 0, u = n.length, c = e.length; a < u;) {
        if (r >= c) return -1;
        if (37 === (i = n.charCodeAt(a++))) {
          if (i = n.charAt(a++), !(o = x[i in ip ? n.charAt(a++) : i]) || (r = o(t, e, r)) < 0) return -1;
        } else if (i != e.charCodeAt(r++)) return -1;
      }
      return r;
    }
    return b.x = w(e, b), b.X = w(r, b), b.c = w(n, b), m.x = w(e, m), m.X = w(r, m), m.c = w(n, m), {
      format: function format(t) {
        var n = w(t += "", b);
        return n.toString = function () {
          return t;
        }, n;
      },
      parse: function parse(t) {
        var n = M(t += "", Kd);
        return n.toString = function () {
          return t;
        }, n;
      },
      utcFormat: function utcFormat(t) {
        var n = w(t += "", m);
        return n.toString = function () {
          return t;
        }, n;
      },
      utcParse: function utcParse(t) {
        var n = M(t, tp);
        return n.toString = function () {
          return t;
        }, n;
      }
    };
  }
  var rp,
    ip = {
      "-": "",
      _: " ",
      0: "0"
    },
    op = /^\s*\d+/,
    ap = /^%/,
    up = /[\\^$*+?|[\]().{}]/g;
  function cp(t, n, e) {
    var r = t < 0 ? "-" : "",
      i = (r ? -t : t) + "",
      o = i.length;
    return r + (o < e ? new Array(e - o + 1).join(n) + i : i);
  }
  function fp(t) {
    return t.replace(up, "\\$&");
  }
  function sp(t) {
    return new RegExp("^(?:" + t.map(fp).join("|") + ")", "i");
  }
  function lp(t) {
    for (var n = {}, e = -1, r = t.length; ++e < r;) n[t[e].toLowerCase()] = e;
    return n;
  }
  function hp(t, n, e) {
    var r = op.exec(n.slice(e, e + 1));
    return r ? (t.w = +r[0], e + r[0].length) : -1;
  }
  function dp(t, n, e) {
    var r = op.exec(n.slice(e, e + 1));
    return r ? (t.u = +r[0], e + r[0].length) : -1;
  }
  function pp(t, n, e) {
    var r = op.exec(n.slice(e, e + 2));
    return r ? (t.U = +r[0], e + r[0].length) : -1;
  }
  function vp(t, n, e) {
    var r = op.exec(n.slice(e, e + 2));
    return r ? (t.V = +r[0], e + r[0].length) : -1;
  }
  function gp(t, n, e) {
    var r = op.exec(n.slice(e, e + 2));
    return r ? (t.W = +r[0], e + r[0].length) : -1;
  }
  function yp(t, n, e) {
    var r = op.exec(n.slice(e, e + 4));
    return r ? (t.y = +r[0], e + r[0].length) : -1;
  }
  function _p(t, n, e) {
    var r = op.exec(n.slice(e, e + 2));
    return r ? (t.y = +r[0] + (+r[0] > 68 ? 1900 : 2e3), e + r[0].length) : -1;
  }
  function bp(t, n, e) {
    var r = /^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(e, e + 6));
    return r ? (t.Z = r[1] ? 0 : -(r[2] + (r[3] || "00")), e + r[0].length) : -1;
  }
  function mp(t, n, e) {
    var r = op.exec(n.slice(e, e + 2));
    return r ? (t.m = r[0] - 1, e + r[0].length) : -1;
  }
  function xp(t, n, e) {
    var r = op.exec(n.slice(e, e + 2));
    return r ? (t.d = +r[0], e + r[0].length) : -1;
  }
  function wp(t, n, e) {
    var r = op.exec(n.slice(e, e + 3));
    return r ? (t.m = 0, t.d = +r[0], e + r[0].length) : -1;
  }
  function Mp(t, n, e) {
    var r = op.exec(n.slice(e, e + 2));
    return r ? (t.H = +r[0], e + r[0].length) : -1;
  }
  function Np(t, n, e) {
    var r = op.exec(n.slice(e, e + 2));
    return r ? (t.M = +r[0], e + r[0].length) : -1;
  }
  function Ap(t, n, e) {
    var r = op.exec(n.slice(e, e + 2));
    return r ? (t.S = +r[0], e + r[0].length) : -1;
  }
  function Tp(t, n, e) {
    var r = op.exec(n.slice(e, e + 3));
    return r ? (t.L = +r[0], e + r[0].length) : -1;
  }
  function Sp(t, n, e) {
    var r = op.exec(n.slice(e, e + 6));
    return r ? (t.L = Math.floor(r[0] / 1e3), e + r[0].length) : -1;
  }
  function kp(t, n, e) {
    var r = ap.exec(n.slice(e, e + 1));
    return r ? e + r[0].length : -1;
  }
  function Ep(t, n, e) {
    var r = op.exec(n.slice(e));
    return r ? (t.Q = +r[0], e + r[0].length) : -1;
  }
  function Cp(t, n, e) {
    var r = op.exec(n.slice(e));
    return r ? (t.Q = 1e3 * +r[0], e + r[0].length) : -1;
  }
  function Pp(t, n) {
    return cp(t.getDate(), n, 2);
  }
  function zp(t, n) {
    return cp(t.getHours(), n, 2);
  }
  function Rp(t, n) {
    return cp(t.getHours() % 12 || 12, n, 2);
  }
  function Dp(t, n) {
    return cp(1 + ud.count(Td(t), t), n, 3);
  }
  function qp(t, n) {
    return cp(t.getMilliseconds(), n, 3);
  }
  function Lp(t, n) {
    return qp(t, n) + "000";
  }
  function Up(t, n) {
    return cp(t.getMonth() + 1, n, 2);
  }
  function Op(t, n) {
    return cp(t.getMinutes(), n, 2);
  }
  function Bp(t, n) {
    return cp(t.getSeconds(), n, 2);
  }
  function Yp(t) {
    var n = t.getDay();
    return 0 === n ? 7 : n;
  }
  function Fp(t, n) {
    return cp(sd.count(Td(t), t), n, 2);
  }
  function Ip(t, n) {
    var e = t.getDay();
    return t = e >= 4 || 0 === e ? pd(t) : pd.ceil(t), cp(pd.count(Td(t), t) + (4 === Td(t).getDay()), n, 2);
  }
  function jp(t) {
    return t.getDay();
  }
  function Hp(t, n) {
    return cp(ld.count(Td(t), t), n, 2);
  }
  function Xp(t, n) {
    return cp(t.getFullYear() % 100, n, 2);
  }
  function Gp(t, n) {
    return cp(t.getFullYear() % 1e4, n, 4);
  }
  function Vp(t) {
    var n = t.getTimezoneOffset();
    return (n > 0 ? "-" : (n *= -1, "+")) + cp(n / 60 | 0, "0", 2) + cp(n % 60, "0", 2);
  }
  function $p(t, n) {
    return cp(t.getUTCDate(), n, 2);
  }
  function Wp(t, n) {
    return cp(t.getUTCHours(), n, 2);
  }
  function Zp(t, n) {
    return cp(t.getUTCHours() % 12 || 12, n, 2);
  }
  function Qp(t, n) {
    return cp(1 + zd.count(Qd(t), t), n, 3);
  }
  function Jp(t, n) {
    return cp(t.getUTCMilliseconds(), n, 3);
  }
  function Kp(t, n) {
    return Jp(t, n) + "000";
  }
  function tv(t, n) {
    return cp(t.getUTCMonth() + 1, n, 2);
  }
  function nv(t, n) {
    return cp(t.getUTCMinutes(), n, 2);
  }
  function ev(t, n) {
    return cp(t.getUTCSeconds(), n, 2);
  }
  function rv(t) {
    var n = t.getUTCDay();
    return 0 === n ? 7 : n;
  }
  function iv(t, n) {
    return cp(qd.count(Qd(t), t), n, 2);
  }
  function ov(t, n) {
    var e = t.getUTCDay();
    return t = e >= 4 || 0 === e ? Bd(t) : Bd.ceil(t), cp(Bd.count(Qd(t), t) + (4 === Qd(t).getUTCDay()), n, 2);
  }
  function av(t) {
    return t.getUTCDay();
  }
  function uv(t, n) {
    return cp(Ld.count(Qd(t), t), n, 2);
  }
  function cv(t, n) {
    return cp(t.getUTCFullYear() % 100, n, 2);
  }
  function fv(t, n) {
    return cp(t.getUTCFullYear() % 1e4, n, 4);
  }
  function sv() {
    return "+0000";
  }
  function lv() {
    return "%";
  }
  function hv(t) {
    return +t;
  }
  function dv(t) {
    return Math.floor(+t / 1e3);
  }
  function pv(n) {
    return rp = ep(n), t.timeFormat = rp.format, t.timeParse = rp.parse, t.utcFormat = rp.utcFormat, t.utcParse = rp.utcParse, rp;
  }
  pv({
    dateTime: "%x, %X",
    date: "%-m/%-d/%Y",
    time: "%-I:%M:%S %p",
    periods: ["AM", "PM"],
    days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
    shortDays: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
    months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
    shortMonths: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
  });
  var vv = Date.prototype.toISOString ? function (t) {
    return t.toISOString();
  } : t.utcFormat("%Y-%m-%dT%H:%M:%S.%LZ");
  var gv = +new Date("2000-01-01T00:00:00.000Z") ? function (t) {
      var n = new Date(t);
      return isNaN(n) ? null : n;
    } : t.utcParse("%Y-%m-%dT%H:%M:%S.%LZ"),
    yv = 1e3,
    _v = 60 * yv,
    bv = 60 * _v,
    mv = 24 * bv,
    xv = 7 * mv,
    wv = 30 * mv,
    Mv = 365 * mv;
  function Nv(t) {
    return new Date(t);
  }
  function Av(t) {
    return t instanceof Date ? +t : +new Date(+t);
  }
  function Tv(t, n, r, i, o, a, u, c, f) {
    var s = Eh(wh, wh),
      l = s.invert,
      h = s.domain,
      d = f(".%L"),
      p = f(":%S"),
      v = f("%I:%M"),
      g = f("%I %p"),
      y = f("%a %d"),
      _ = f("%b %d"),
      b = f("%B"),
      m = f("%Y"),
      x = [[u, 1, yv], [u, 5, 5 * yv], [u, 15, 15 * yv], [u, 30, 30 * yv], [a, 1, _v], [a, 5, 5 * _v], [a, 15, 15 * _v], [a, 30, 30 * _v], [o, 1, bv], [o, 3, 3 * bv], [o, 6, 6 * bv], [o, 12, 12 * bv], [i, 1, mv], [i, 2, 2 * mv], [r, 1, xv], [n, 1, wv], [n, 3, 3 * wv], [t, 1, Mv]];
    function M(e) {
      return (u(e) < e ? d : a(e) < e ? p : o(e) < e ? v : i(e) < e ? g : n(e) < e ? r(e) < e ? y : _ : t(e) < e ? b : m)(e);
    }
    function N(n, r, i, o) {
      if (null == n && (n = 10), "number" == typeof n) {
        var a = Math.abs(i - r) / n,
          u = e(function (t) {
            return t[2];
          }).right(x, a);
        u === x.length ? (o = w(r / Mv, i / Mv, n), n = t) : u ? (o = (u = x[a / x[u - 1][2] < x[u][2] / a ? u - 1 : u])[1], n = u[0]) : (o = Math.max(w(r, i, n), 1), n = c);
      }
      return null == o ? n : n.every(o);
    }
    return s.invert = function (t) {
      return new Date(l(t));
    }, s.domain = function (t) {
      return arguments.length ? h(vh.call(t, Av)) : h().map(Nv);
    }, s.ticks = function (t, n) {
      var e,
        r = h(),
        i = r[0],
        o = r[r.length - 1],
        a = o < i;
      return a && (e = i, i = o, o = e), e = (e = N(t, i, o, n)) ? e.range(i, o + 1) : [], a ? e.reverse() : e;
    }, s.tickFormat = function (t, n) {
      return null == n ? M : f(n);
    }, s.nice = function (t, n) {
      var e = h();
      return (t = N(t, e[0], e[e.length - 1], n)) ? h(zh(e, t)) : s;
    }, s.copy = function () {
      return Sh(s, Tv(t, n, r, i, o, a, u, c, f));
    }, s;
  }
  function Sv() {
    var t,
      n,
      e,
      r,
      i,
      o = 0,
      a = 1,
      u = wh,
      c = !1;
    function f(n) {
      return isNaN(n = +n) ? i : u(0 === e ? .5 : (n = (r(n) - t) * e, c ? Math.max(0, Math.min(1, n)) : n));
    }
    return f.domain = function (i) {
      return arguments.length ? (t = r(o = +i[0]), n = r(a = +i[1]), e = t === n ? 0 : 1 / (n - t), f) : [o, a];
    }, f.clamp = function (t) {
      return arguments.length ? (c = !!t, f) : c;
    }, f.interpolator = function (t) {
      return arguments.length ? (u = t, f) : u;
    }, f.unknown = function (t) {
      return arguments.length ? (i = t, f) : i;
    }, function (i) {
      return r = i, t = i(o), n = i(a), e = t === n ? 0 : 1 / (n - t), f;
    };
  }
  function kv(t, n) {
    return n.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown());
  }
  function Ev() {
    var t = Gh(Sv());
    return t.copy = function () {
      return kv(t, Ev()).exponent(t.exponent());
    }, dh.apply(t, arguments);
  }
  function Cv() {
    var t,
      n,
      e,
      r,
      i,
      o,
      a,
      u = 0,
      c = .5,
      f = 1,
      s = wh,
      l = !1;
    function h(t) {
      return isNaN(t = +t) ? a : (t = .5 + ((t = +o(t)) - n) * (t < n ? r : i), s(l ? Math.max(0, Math.min(1, t)) : t));
    }
    return h.domain = function (a) {
      return arguments.length ? (t = o(u = +a[0]), n = o(c = +a[1]), e = o(f = +a[2]), r = t === n ? 0 : .5 / (n - t), i = n === e ? 0 : .5 / (e - n), h) : [u, c, f];
    }, h.clamp = function (t) {
      return arguments.length ? (l = !!t, h) : l;
    }, h.interpolator = function (t) {
      return arguments.length ? (s = t, h) : s;
    }, h.unknown = function (t) {
      return arguments.length ? (a = t, h) : a;
    }, function (a) {
      return o = a, t = a(u), n = a(c), e = a(f), r = t === n ? 0 : .5 / (n - t), i = n === e ? 0 : .5 / (e - n), h;
    };
  }
  function Pv() {
    var t = Gh(Cv());
    return t.copy = function () {
      return kv(t, Pv()).exponent(t.exponent());
    }, dh.apply(t, arguments);
  }
  function zv(t) {
    for (var n = t.length / 6 | 0, e = new Array(n), r = 0; r < n;) e[r] = "#" + t.slice(6 * r, 6 * ++r);
    return e;
  }
  var Rv = zv("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),
    Dv = zv("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),
    qv = zv("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),
    Lv = zv("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),
    Uv = zv("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),
    Ov = zv("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),
    Bv = zv("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),
    Yv = zv("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),
    Fv = zv("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f");
  function Iv(t) {
    return fe(t[t.length - 1]);
  }
  var jv = new Array(3).concat("d8b365f5f5f55ab4ac", "a6611adfc27d80cdc1018571", "a6611adfc27df5f5f580cdc1018571", "8c510ad8b365f6e8c3c7eae55ab4ac01665e", "8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e", "8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e", "8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e", "5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30", "5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(zv),
    Hv = Iv(jv),
    Xv = new Array(3).concat("af8dc3f7f7f77fbf7b", "7b3294c2a5cfa6dba0008837", "7b3294c2a5cff7f7f7a6dba0008837", "762a83af8dc3e7d4e8d9f0d37fbf7b1b7837", "762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837", "762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837", "762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837", "40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b", "40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(zv),
    Gv = Iv(Xv),
    Vv = new Array(3).concat("e9a3c9f7f7f7a1d76a", "d01c8bf1b6dab8e1864dac26", "d01c8bf1b6daf7f7f7b8e1864dac26", "c51b7de9a3c9fde0efe6f5d0a1d76a4d9221", "c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221", "c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221", "c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221", "8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419", "8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(zv),
    $v = Iv(Vv),
    Wv = new Array(3).concat("998ec3f7f7f7f1a340", "5e3c99b2abd2fdb863e66101", "5e3c99b2abd2f7f7f7fdb863e66101", "542788998ec3d8daebfee0b6f1a340b35806", "542788998ec3d8daebf7f7f7fee0b6f1a340b35806", "5427888073acb2abd2d8daebfee0b6fdb863e08214b35806", "5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806", "2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08", "2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(zv),
    Zv = Iv(Wv),
    Qv = new Array(3).concat("ef8a62f7f7f767a9cf", "ca0020f4a58292c5de0571b0", "ca0020f4a582f7f7f792c5de0571b0", "b2182bef8a62fddbc7d1e5f067a9cf2166ac", "b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac", "b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac", "b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac", "67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061", "67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(zv),
    Jv = Iv(Qv),
    Kv = new Array(3).concat("ef8a62ffffff999999", "ca0020f4a582bababa404040", "ca0020f4a582ffffffbababa404040", "b2182bef8a62fddbc7e0e0e09999994d4d4d", "b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d", "b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d", "b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d", "67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a", "67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(zv),
    tg = Iv(Kv),
    ng = new Array(3).concat("fc8d59ffffbf91bfdb", "d7191cfdae61abd9e92c7bb6", "d7191cfdae61ffffbfabd9e92c7bb6", "d73027fc8d59fee090e0f3f891bfdb4575b4", "d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4", "d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4", "d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4", "a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695", "a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(zv),
    eg = Iv(ng),
    rg = new Array(3).concat("fc8d59ffffbf91cf60", "d7191cfdae61a6d96a1a9641", "d7191cfdae61ffffbfa6d96a1a9641", "d73027fc8d59fee08bd9ef8b91cf601a9850", "d73027fc8d59fee08bffffbfd9ef8b91cf601a9850", "d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850", "d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850", "a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837", "a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(zv),
    ig = Iv(rg),
    og = new Array(3).concat("fc8d59ffffbf99d594", "d7191cfdae61abdda42b83ba", "d7191cfdae61ffffbfabdda42b83ba", "d53e4ffc8d59fee08be6f59899d5943288bd", "d53e4ffc8d59fee08bffffbfe6f59899d5943288bd", "d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd", "d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd", "9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2", "9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(zv),
    ag = Iv(og),
    ug = new Array(3).concat("e5f5f999d8c92ca25f", "edf8fbb2e2e266c2a4238b45", "edf8fbb2e2e266c2a42ca25f006d2c", "edf8fbccece699d8c966c2a42ca25f006d2c", "edf8fbccece699d8c966c2a441ae76238b45005824", "f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824", "f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(zv),
    cg = Iv(ug),
    fg = new Array(3).concat("e0ecf49ebcda8856a7", "edf8fbb3cde38c96c688419d", "edf8fbb3cde38c96c68856a7810f7c", "edf8fbbfd3e69ebcda8c96c68856a7810f7c", "edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b", "f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b", "f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(zv),
    sg = Iv(fg),
    lg = new Array(3).concat("e0f3dba8ddb543a2ca", "f0f9e8bae4bc7bccc42b8cbe", "f0f9e8bae4bc7bccc443a2ca0868ac", "f0f9e8ccebc5a8ddb57bccc443a2ca0868ac", "f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e", "f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e", "f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(zv),
    hg = Iv(lg),
    dg = new Array(3).concat("fee8c8fdbb84e34a33", "fef0d9fdcc8afc8d59d7301f", "fef0d9fdcc8afc8d59e34a33b30000", "fef0d9fdd49efdbb84fc8d59e34a33b30000", "fef0d9fdd49efdbb84fc8d59ef6548d7301f990000", "fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000", "fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(zv),
    pg = Iv(dg),
    vg = new Array(3).concat("ece2f0a6bddb1c9099", "f6eff7bdc9e167a9cf02818a", "f6eff7bdc9e167a9cf1c9099016c59", "f6eff7d0d1e6a6bddb67a9cf1c9099016c59", "f6eff7d0d1e6a6bddb67a9cf3690c002818a016450", "fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450", "fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(zv),
    gg = Iv(vg),
    yg = new Array(3).concat("ece7f2a6bddb2b8cbe", "f1eef6bdc9e174a9cf0570b0", "f1eef6bdc9e174a9cf2b8cbe045a8d", "f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d", "f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b", "fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b", "fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(zv),
    _g = Iv(yg),
    bg = new Array(3).concat("e7e1efc994c7dd1c77", "f1eef6d7b5d8df65b0ce1256", "f1eef6d7b5d8df65b0dd1c77980043", "f1eef6d4b9dac994c7df65b0dd1c77980043", "f1eef6d4b9dac994c7df65b0e7298ace125691003f", "f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f", "f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(zv),
    mg = Iv(bg),
    xg = new Array(3).concat("fde0ddfa9fb5c51b8a", "feebe2fbb4b9f768a1ae017e", "feebe2fbb4b9f768a1c51b8a7a0177", "feebe2fcc5c0fa9fb5f768a1c51b8a7a0177", "feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177", "fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177", "fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(zv),
    wg = Iv(xg),
    Mg = new Array(3).concat("edf8b17fcdbb2c7fb8", "ffffcca1dab441b6c4225ea8", "ffffcca1dab441b6c42c7fb8253494", "ffffccc7e9b47fcdbb41b6c42c7fb8253494", "ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84", "ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84", "ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(zv),
    Ng = Iv(Mg),
    Ag = new Array(3).concat("f7fcb9addd8e31a354", "ffffccc2e69978c679238443", "ffffccc2e69978c67931a354006837", "ffffccd9f0a3addd8e78c67931a354006837", "ffffccd9f0a3addd8e78c67941ab5d238443005a32", "ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32", "ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(zv),
    Tg = Iv(Ag),
    Sg = new Array(3).concat("fff7bcfec44fd95f0e", "ffffd4fed98efe9929cc4c02", "ffffd4fed98efe9929d95f0e993404", "ffffd4fee391fec44ffe9929d95f0e993404", "ffffd4fee391fec44ffe9929ec7014cc4c028c2d04", "ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04", "ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(zv),
    kg = Iv(Sg),
    Eg = new Array(3).concat("ffeda0feb24cf03b20", "ffffb2fecc5cfd8d3ce31a1c", "ffffb2fecc5cfd8d3cf03b20bd0026", "ffffb2fed976feb24cfd8d3cf03b20bd0026", "ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026", "ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026", "ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(zv),
    Cg = Iv(Eg),
    Pg = new Array(3).concat("deebf79ecae13182bd", "eff3ffbdd7e76baed62171b5", "eff3ffbdd7e76baed63182bd08519c", "eff3ffc6dbef9ecae16baed63182bd08519c", "eff3ffc6dbef9ecae16baed64292c62171b5084594", "f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594", "f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(zv),
    zg = Iv(Pg),
    Rg = new Array(3).concat("e5f5e0a1d99b31a354", "edf8e9bae4b374c476238b45", "edf8e9bae4b374c47631a354006d2c", "edf8e9c7e9c0a1d99b74c47631a354006d2c", "edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32", "f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32", "f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(zv),
    Dg = Iv(Rg),
    qg = new Array(3).concat("f0f0f0bdbdbd636363", "f7f7f7cccccc969696525252", "f7f7f7cccccc969696636363252525", "f7f7f7d9d9d9bdbdbd969696636363252525", "f7f7f7d9d9d9bdbdbd969696737373525252252525", "fffffff0f0f0d9d9d9bdbdbd969696737373525252252525", "fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(zv),
    Lg = Iv(qg),
    Ug = new Array(3).concat("efedf5bcbddc756bb1", "f2f0f7cbc9e29e9ac86a51a3", "f2f0f7cbc9e29e9ac8756bb154278f", "f2f0f7dadaebbcbddc9e9ac8756bb154278f", "f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486", "fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486", "fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(zv),
    Og = Iv(Ug),
    Bg = new Array(3).concat("fee0d2fc9272de2d26", "fee5d9fcae91fb6a4acb181d", "fee5d9fcae91fb6a4ade2d26a50f15", "fee5d9fcbba1fc9272fb6a4ade2d26a50f15", "fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d", "fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d", "fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(zv),
    Yg = Iv(Bg),
    Fg = new Array(3).concat("fee6cefdae6be6550d", "feeddefdbe85fd8d3cd94701", "feeddefdbe85fd8d3ce6550da63603", "feeddefdd0a2fdae6bfd8d3ce6550da63603", "feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04", "fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04", "fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(zv),
    Ig = Iv(Fg),
    jg = He(Qn(300, .5, 0), Qn(-240, .5, 1)),
    Hg = He(Qn(-100, .75, .35), Qn(80, 1.5, .8)),
    Xg = He(Qn(260, .75, .35), Qn(80, 1.5, .8)),
    Gg = Qn();
  var Vg = gn(),
    $g = Math.PI / 3,
    Wg = 2 * Math.PI / 3;
  function Zg(t) {
    var n = t.length;
    return function (e) {
      return t[Math.max(0, Math.min(n - 1, Math.floor(e * n)))];
    };
  }
  var Qg = Zg(zv("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),
    Jg = Zg(zv("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),
    Kg = Zg(zv("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),
    ty = Zg(zv("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));
  function ny(t) {
    return function () {
      return t;
    };
  }
  var ey = Math.abs,
    ry = Math.atan2,
    iy = Math.cos,
    oy = Math.max,
    ay = Math.min,
    uy = Math.sin,
    cy = Math.sqrt,
    fy = 1e-12,
    sy = Math.PI,
    ly = sy / 2,
    hy = 2 * sy;
  function dy(t) {
    return t >= 1 ? ly : t <= -1 ? -ly : Math.asin(t);
  }
  function py(t) {
    return t.innerRadius;
  }
  function vy(t) {
    return t.outerRadius;
  }
  function gy(t) {
    return t.startAngle;
  }
  function yy(t) {
    return t.endAngle;
  }
  function _y(t) {
    return t && t.padAngle;
  }
  function by(t, n, e, r, i, o, a) {
    var u = t - e,
      c = n - r,
      f = (a ? o : -o) / cy(u * u + c * c),
      s = f * c,
      l = -f * u,
      h = t + s,
      d = n + l,
      p = e + s,
      v = r + l,
      g = (h + p) / 2,
      y = (d + v) / 2,
      _ = p - h,
      b = v - d,
      m = _ * _ + b * b,
      x = i - o,
      w = h * v - p * d,
      M = (b < 0 ? -1 : 1) * cy(oy(0, x * x * m - w * w)),
      N = (w * b - _ * M) / m,
      A = (-w * _ - b * M) / m,
      T = (w * b + _ * M) / m,
      S = (-w * _ + b * M) / m,
      k = N - g,
      E = A - y,
      C = T - g,
      P = S - y;
    return k * k + E * E > C * C + P * P && (N = T, A = S), {
      cx: N,
      cy: A,
      x01: -s,
      y01: -l,
      x11: N * (i / x - 1),
      y11: A * (i / x - 1)
    };
  }
  function my(t) {
    this._context = t;
  }
  function xy(t) {
    return new my(t);
  }
  function wy(t) {
    return t[0];
  }
  function My(t) {
    return t[1];
  }
  function Ny() {
    var t = wy,
      n = My,
      e = ny(!0),
      r = null,
      i = xy,
      o = null;
    function a(a) {
      var u,
        c,
        f,
        s = a.length,
        l = !1;
      for (null == r && (o = i(f = Xi())), u = 0; u <= s; ++u) !(u < s && e(c = a[u], u, a)) === l && ((l = !l) ? o.lineStart() : o.lineEnd()), l && o.point(+t(c, u, a), +n(c, u, a));
      if (f) return o = null, f + "" || null;
    }
    return a.x = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : ny(+n), a) : t;
    }, a.y = function (t) {
      return arguments.length ? (n = "function" == typeof t ? t : ny(+t), a) : n;
    }, a.defined = function (t) {
      return arguments.length ? (e = "function" == typeof t ? t : ny(!!t), a) : e;
    }, a.curve = function (t) {
      return arguments.length ? (i = t, null != r && (o = i(r)), a) : i;
    }, a.context = function (t) {
      return arguments.length ? (null == t ? r = o = null : o = i(r = t), a) : r;
    }, a;
  }
  function Ay() {
    var t = wy,
      n = null,
      e = ny(0),
      r = My,
      i = ny(!0),
      o = null,
      a = xy,
      u = null;
    function c(c) {
      var f,
        s,
        l,
        h,
        d,
        p = c.length,
        v = !1,
        g = new Array(p),
        y = new Array(p);
      for (null == o && (u = a(d = Xi())), f = 0; f <= p; ++f) {
        if (!(f < p && i(h = c[f], f, c)) === v) if (v = !v) s = f, u.areaStart(), u.lineStart();else {
          for (u.lineEnd(), u.lineStart(), l = f - 1; l >= s; --l) u.point(g[l], y[l]);
          u.lineEnd(), u.areaEnd();
        }
        v && (g[f] = +t(h, f, c), y[f] = +e(h, f, c), u.point(n ? +n(h, f, c) : g[f], r ? +r(h, f, c) : y[f]));
      }
      if (d) return u = null, d + "" || null;
    }
    function f() {
      return Ny().defined(i).curve(a).context(o);
    }
    return c.x = function (e) {
      return arguments.length ? (t = "function" == typeof e ? e : ny(+e), n = null, c) : t;
    }, c.x0 = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : ny(+n), c) : t;
    }, c.x1 = function (t) {
      return arguments.length ? (n = null == t ? null : "function" == typeof t ? t : ny(+t), c) : n;
    }, c.y = function (t) {
      return arguments.length ? (e = "function" == typeof t ? t : ny(+t), r = null, c) : e;
    }, c.y0 = function (t) {
      return arguments.length ? (e = "function" == typeof t ? t : ny(+t), c) : e;
    }, c.y1 = function (t) {
      return arguments.length ? (r = null == t ? null : "function" == typeof t ? t : ny(+t), c) : r;
    }, c.lineX0 = c.lineY0 = function () {
      return f().x(t).y(e);
    }, c.lineY1 = function () {
      return f().x(t).y(r);
    }, c.lineX1 = function () {
      return f().x(n).y(e);
    }, c.defined = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : ny(!!t), c) : i;
    }, c.curve = function (t) {
      return arguments.length ? (a = t, null != o && (u = a(o)), c) : a;
    }, c.context = function (t) {
      return arguments.length ? (null == t ? o = u = null : u = a(o = t), c) : o;
    }, c;
  }
  function Ty(t, n) {
    return n < t ? -1 : n > t ? 1 : n >= t ? 0 : NaN;
  }
  function Sy(t) {
    return t;
  }
  my.prototype = {
    areaStart: function areaStart() {
      this._line = 0;
    },
    areaEnd: function areaEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._point = 0;
    },
    lineEnd: function lineEnd() {
      (this._line || 0 !== this._line && 1 === this._point) && this._context.closePath(), this._line = 1 - this._line;
    },
    point: function point(t, n) {
      switch (t = +t, n = +n, this._point) {
        case 0:
          this._point = 1, this._line ? this._context.lineTo(t, n) : this._context.moveTo(t, n);
          break;
        case 1:
          this._point = 2;
        default:
          this._context.lineTo(t, n);
      }
    }
  };
  var ky = Cy(xy);
  function Ey(t) {
    this._curve = t;
  }
  function Cy(t) {
    function n(n) {
      return new Ey(t(n));
    }
    return n._curve = t, n;
  }
  function Py(t) {
    var n = t.curve;
    return t.angle = t.x, delete t.x, t.radius = t.y, delete t.y, t.curve = function (t) {
      return arguments.length ? n(Cy(t)) : n()._curve;
    }, t;
  }
  function zy() {
    return Py(Ny().curve(ky));
  }
  function Ry() {
    var t = Ay().curve(ky),
      n = t.curve,
      e = t.lineX0,
      r = t.lineX1,
      i = t.lineY0,
      o = t.lineY1;
    return t.angle = t.x, delete t.x, t.startAngle = t.x0, delete t.x0, t.endAngle = t.x1, delete t.x1, t.radius = t.y, delete t.y, t.innerRadius = t.y0, delete t.y0, t.outerRadius = t.y1, delete t.y1, t.lineStartAngle = function () {
      return Py(e());
    }, delete t.lineX0, t.lineEndAngle = function () {
      return Py(r());
    }, delete t.lineX1, t.lineInnerRadius = function () {
      return Py(i());
    }, delete t.lineY0, t.lineOuterRadius = function () {
      return Py(o());
    }, delete t.lineY1, t.curve = function (t) {
      return arguments.length ? n(Cy(t)) : n()._curve;
    }, t;
  }
  function Dy(t, n) {
    return [(n = +n) * Math.cos(t -= Math.PI / 2), n * Math.sin(t)];
  }
  Ey.prototype = {
    areaStart: function areaStart() {
      this._curve.areaStart();
    },
    areaEnd: function areaEnd() {
      this._curve.areaEnd();
    },
    lineStart: function lineStart() {
      this._curve.lineStart();
    },
    lineEnd: function lineEnd() {
      this._curve.lineEnd();
    },
    point: function point(t, n) {
      this._curve.point(n * Math.sin(t), n * -Math.cos(t));
    }
  };
  var qy = Array.prototype.slice;
  function Ly(t) {
    return t.source;
  }
  function Uy(t) {
    return t.target;
  }
  function Oy(t) {
    var n = Ly,
      e = Uy,
      r = wy,
      i = My,
      o = null;
    function a() {
      var a,
        u = qy.call(arguments),
        c = n.apply(this, u),
        f = e.apply(this, u);
      if (o || (o = a = Xi()), t(o, +r.apply(this, (u[0] = c, u)), +i.apply(this, u), +r.apply(this, (u[0] = f, u)), +i.apply(this, u)), a) return o = null, a + "" || null;
    }
    return a.source = function (t) {
      return arguments.length ? (n = t, a) : n;
    }, a.target = function (t) {
      return arguments.length ? (e = t, a) : e;
    }, a.x = function (t) {
      return arguments.length ? (r = "function" == typeof t ? t : ny(+t), a) : r;
    }, a.y = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : ny(+t), a) : i;
    }, a.context = function (t) {
      return arguments.length ? (o = null == t ? null : t, a) : o;
    }, a;
  }
  function By(t, n, e, r, i) {
    t.moveTo(n, e), t.bezierCurveTo(n = (n + r) / 2, e, n, i, r, i);
  }
  function Yy(t, n, e, r, i) {
    t.moveTo(n, e), t.bezierCurveTo(n, e = (e + i) / 2, r, e, r, i);
  }
  function Fy(t, n, e, r, i) {
    var o = Dy(n, e),
      a = Dy(n, e = (e + i) / 2),
      u = Dy(r, e),
      c = Dy(r, i);
    t.moveTo(o[0], o[1]), t.bezierCurveTo(a[0], a[1], u[0], u[1], c[0], c[1]);
  }
  var Iy = {
      draw: function draw(t, n) {
        var e = Math.sqrt(n / sy);
        t.moveTo(e, 0), t.arc(0, 0, e, 0, hy);
      }
    },
    jy = {
      draw: function draw(t, n) {
        var e = Math.sqrt(n / 5) / 2;
        t.moveTo(-3 * e, -e), t.lineTo(-e, -e), t.lineTo(-e, -3 * e), t.lineTo(e, -3 * e), t.lineTo(e, -e), t.lineTo(3 * e, -e), t.lineTo(3 * e, e), t.lineTo(e, e), t.lineTo(e, 3 * e), t.lineTo(-e, 3 * e), t.lineTo(-e, e), t.lineTo(-3 * e, e), t.closePath();
      }
    },
    Hy = Math.sqrt(1 / 3),
    Xy = 2 * Hy,
    Gy = {
      draw: function draw(t, n) {
        var e = Math.sqrt(n / Xy),
          r = e * Hy;
        t.moveTo(0, -e), t.lineTo(r, 0), t.lineTo(0, e), t.lineTo(-r, 0), t.closePath();
      }
    },
    Vy = Math.sin(sy / 10) / Math.sin(7 * sy / 10),
    $y = Math.sin(hy / 10) * Vy,
    Wy = -Math.cos(hy / 10) * Vy,
    Zy = {
      draw: function draw(t, n) {
        var e = Math.sqrt(.8908130915292852 * n),
          r = $y * e,
          i = Wy * e;
        t.moveTo(0, -e), t.lineTo(r, i);
        for (var o = 1; o < 5; ++o) {
          var a = hy * o / 5,
            u = Math.cos(a),
            c = Math.sin(a);
          t.lineTo(c * e, -u * e), t.lineTo(u * r - c * i, c * r + u * i);
        }
        t.closePath();
      }
    },
    Qy = {
      draw: function draw(t, n) {
        var e = Math.sqrt(n),
          r = -e / 2;
        t.rect(r, r, e, e);
      }
    },
    Jy = Math.sqrt(3),
    Ky = {
      draw: function draw(t, n) {
        var e = -Math.sqrt(n / (3 * Jy));
        t.moveTo(0, 2 * e), t.lineTo(-Jy * e, -e), t.lineTo(Jy * e, -e), t.closePath();
      }
    },
    t_ = Math.sqrt(3) / 2,
    n_ = 1 / Math.sqrt(12),
    e_ = 3 * (n_ / 2 + 1),
    r_ = {
      draw: function draw(t, n) {
        var e = Math.sqrt(n / e_),
          r = e / 2,
          i = e * n_,
          o = r,
          a = e * n_ + e,
          u = -o,
          c = a;
        t.moveTo(r, i), t.lineTo(o, a), t.lineTo(u, c), t.lineTo(-.5 * r - t_ * i, t_ * r + -.5 * i), t.lineTo(-.5 * o - t_ * a, t_ * o + -.5 * a), t.lineTo(-.5 * u - t_ * c, t_ * u + -.5 * c), t.lineTo(-.5 * r + t_ * i, -.5 * i - t_ * r), t.lineTo(-.5 * o + t_ * a, -.5 * a - t_ * o), t.lineTo(-.5 * u + t_ * c, -.5 * c - t_ * u), t.closePath();
      }
    },
    i_ = [Iy, jy, Gy, Qy, Zy, Ky, r_];
  function o_() {}
  function a_(t, n, e) {
    t._context.bezierCurveTo((2 * t._x0 + t._x1) / 3, (2 * t._y0 + t._y1) / 3, (t._x0 + 2 * t._x1) / 3, (t._y0 + 2 * t._y1) / 3, (t._x0 + 4 * t._x1 + n) / 6, (t._y0 + 4 * t._y1 + e) / 6);
  }
  function u_(t) {
    this._context = t;
  }
  function c_(t) {
    this._context = t;
  }
  function f_(t) {
    this._context = t;
  }
  function s_(t, n) {
    this._basis = new u_(t), this._beta = n;
  }
  u_.prototype = {
    areaStart: function areaStart() {
      this._line = 0;
    },
    areaEnd: function areaEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._x0 = this._x1 = this._y0 = this._y1 = NaN, this._point = 0;
    },
    lineEnd: function lineEnd() {
      switch (this._point) {
        case 3:
          a_(this, this._x1, this._y1);
        case 2:
          this._context.lineTo(this._x1, this._y1);
      }
      (this._line || 0 !== this._line && 1 === this._point) && this._context.closePath(), this._line = 1 - this._line;
    },
    point: function point(t, n) {
      switch (t = +t, n = +n, this._point) {
        case 0:
          this._point = 1, this._line ? this._context.lineTo(t, n) : this._context.moveTo(t, n);
          break;
        case 1:
          this._point = 2;
          break;
        case 2:
          this._point = 3, this._context.lineTo((5 * this._x0 + this._x1) / 6, (5 * this._y0 + this._y1) / 6);
        default:
          a_(this, t, n);
      }
      this._x0 = this._x1, this._x1 = t, this._y0 = this._y1, this._y1 = n;
    }
  }, c_.prototype = {
    areaStart: o_,
    areaEnd: o_,
    lineStart: function lineStart() {
      this._x0 = this._x1 = this._x2 = this._x3 = this._x4 = this._y0 = this._y1 = this._y2 = this._y3 = this._y4 = NaN, this._point = 0;
    },
    lineEnd: function lineEnd() {
      switch (this._point) {
        case 1:
          this._context.moveTo(this._x2, this._y2), this._context.closePath();
          break;
        case 2:
          this._context.moveTo((this._x2 + 2 * this._x3) / 3, (this._y2 + 2 * this._y3) / 3), this._context.lineTo((this._x3 + 2 * this._x2) / 3, (this._y3 + 2 * this._y2) / 3), this._context.closePath();
          break;
        case 3:
          this.point(this._x2, this._y2), this.point(this._x3, this._y3), this.point(this._x4, this._y4);
      }
    },
    point: function point(t, n) {
      switch (t = +t, n = +n, this._point) {
        case 0:
          this._point = 1, this._x2 = t, this._y2 = n;
          break;
        case 1:
          this._point = 2, this._x3 = t, this._y3 = n;
          break;
        case 2:
          this._point = 3, this._x4 = t, this._y4 = n, this._context.moveTo((this._x0 + 4 * this._x1 + t) / 6, (this._y0 + 4 * this._y1 + n) / 6);
          break;
        default:
          a_(this, t, n);
      }
      this._x0 = this._x1, this._x1 = t, this._y0 = this._y1, this._y1 = n;
    }
  }, f_.prototype = {
    areaStart: function areaStart() {
      this._line = 0;
    },
    areaEnd: function areaEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._x0 = this._x1 = this._y0 = this._y1 = NaN, this._point = 0;
    },
    lineEnd: function lineEnd() {
      (this._line || 0 !== this._line && 3 === this._point) && this._context.closePath(), this._line = 1 - this._line;
    },
    point: function point(t, n) {
      switch (t = +t, n = +n, this._point) {
        case 0:
          this._point = 1;
          break;
        case 1:
          this._point = 2;
          break;
        case 2:
          this._point = 3;
          var e = (this._x0 + 4 * this._x1 + t) / 6,
            r = (this._y0 + 4 * this._y1 + n) / 6;
          this._line ? this._context.lineTo(e, r) : this._context.moveTo(e, r);
          break;
        case 3:
          this._point = 4;
        default:
          a_(this, t, n);
      }
      this._x0 = this._x1, this._x1 = t, this._y0 = this._y1, this._y1 = n;
    }
  }, s_.prototype = {
    lineStart: function lineStart() {
      this._x = [], this._y = [], this._basis.lineStart();
    },
    lineEnd: function lineEnd() {
      var t = this._x,
        n = this._y,
        e = t.length - 1;
      if (e > 0) for (var r, i = t[0], o = n[0], a = t[e] - i, u = n[e] - o, c = -1; ++c <= e;) r = c / e, this._basis.point(this._beta * t[c] + (1 - this._beta) * (i + r * a), this._beta * n[c] + (1 - this._beta) * (o + r * u));
      this._x = this._y = null, this._basis.lineEnd();
    },
    point: function point(t, n) {
      this._x.push(+t), this._y.push(+n);
    }
  };
  var l_ = function t(n) {
    function e(t) {
      return 1 === n ? new u_(t) : new s_(t, n);
    }
    return e.beta = function (n) {
      return t(+n);
    }, e;
  }(.85);
  function h_(t, n, e) {
    t._context.bezierCurveTo(t._x1 + t._k * (t._x2 - t._x0), t._y1 + t._k * (t._y2 - t._y0), t._x2 + t._k * (t._x1 - n), t._y2 + t._k * (t._y1 - e), t._x2, t._y2);
  }
  function d_(t, n) {
    this._context = t, this._k = (1 - n) / 6;
  }
  d_.prototype = {
    areaStart: function areaStart() {
      this._line = 0;
    },
    areaEnd: function areaEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._x0 = this._x1 = this._x2 = this._y0 = this._y1 = this._y2 = NaN, this._point = 0;
    },
    lineEnd: function lineEnd() {
      switch (this._point) {
        case 2:
          this._context.lineTo(this._x2, this._y2);
          break;
        case 3:
          h_(this, this._x1, this._y1);
      }
      (this._line || 0 !== this._line && 1 === this._point) && this._context.closePath(), this._line = 1 - this._line;
    },
    point: function point(t, n) {
      switch (t = +t, n = +n, this._point) {
        case 0:
          this._point = 1, this._line ? this._context.lineTo(t, n) : this._context.moveTo(t, n);
          break;
        case 1:
          this._point = 2, this._x1 = t, this._y1 = n;
          break;
        case 2:
          this._point = 3;
        default:
          h_(this, t, n);
      }
      this._x0 = this._x1, this._x1 = this._x2, this._x2 = t, this._y0 = this._y1, this._y1 = this._y2, this._y2 = n;
    }
  };
  var p_ = function t(n) {
    function e(t) {
      return new d_(t, n);
    }
    return e.tension = function (n) {
      return t(+n);
    }, e;
  }(0);
  function v_(t, n) {
    this._context = t, this._k = (1 - n) / 6;
  }
  v_.prototype = {
    areaStart: o_,
    areaEnd: o_,
    lineStart: function lineStart() {
      this._x0 = this._x1 = this._x2 = this._x3 = this._x4 = this._x5 = this._y0 = this._y1 = this._y2 = this._y3 = this._y4 = this._y5 = NaN, this._point = 0;
    },
    lineEnd: function lineEnd() {
      switch (this._point) {
        case 1:
          this._context.moveTo(this._x3, this._y3), this._context.closePath();
          break;
        case 2:
          this._context.lineTo(this._x3, this._y3), this._context.closePath();
          break;
        case 3:
          this.point(this._x3, this._y3), this.point(this._x4, this._y4), this.point(this._x5, this._y5);
      }
    },
    point: function point(t, n) {
      switch (t = +t, n = +n, this._point) {
        case 0:
          this._point = 1, this._x3 = t, this._y3 = n;
          break;
        case 1:
          this._point = 2, this._context.moveTo(this._x4 = t, this._y4 = n);
          break;
        case 2:
          this._point = 3, this._x5 = t, this._y5 = n;
          break;
        default:
          h_(this, t, n);
      }
      this._x0 = this._x1, this._x1 = this._x2, this._x2 = t, this._y0 = this._y1, this._y1 = this._y2, this._y2 = n;
    }
  };
  var g_ = function t(n) {
    function e(t) {
      return new v_(t, n);
    }
    return e.tension = function (n) {
      return t(+n);
    }, e;
  }(0);
  function y_(t, n) {
    this._context = t, this._k = (1 - n) / 6;
  }
  y_.prototype = {
    areaStart: function areaStart() {
      this._line = 0;
    },
    areaEnd: function areaEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._x0 = this._x1 = this._x2 = this._y0 = this._y1 = this._y2 = NaN, this._point = 0;
    },
    lineEnd: function lineEnd() {
      (this._line || 0 !== this._line && 3 === this._point) && this._context.closePath(), this._line = 1 - this._line;
    },
    point: function point(t, n) {
      switch (t = +t, n = +n, this._point) {
        case 0:
          this._point = 1;
          break;
        case 1:
          this._point = 2;
          break;
        case 2:
          this._point = 3, this._line ? this._context.lineTo(this._x2, this._y2) : this._context.moveTo(this._x2, this._y2);
          break;
        case 3:
          this._point = 4;
        default:
          h_(this, t, n);
      }
      this._x0 = this._x1, this._x1 = this._x2, this._x2 = t, this._y0 = this._y1, this._y1 = this._y2, this._y2 = n;
    }
  };
  var __ = function t(n) {
    function e(t) {
      return new y_(t, n);
    }
    return e.tension = function (n) {
      return t(+n);
    }, e;
  }(0);
  function b_(t, n, e) {
    var r = t._x1,
      i = t._y1,
      o = t._x2,
      a = t._y2;
    if (t._l01_a > fy) {
      var u = 2 * t._l01_2a + 3 * t._l01_a * t._l12_a + t._l12_2a,
        c = 3 * t._l01_a * (t._l01_a + t._l12_a);
      r = (r * u - t._x0 * t._l12_2a + t._x2 * t._l01_2a) / c, i = (i * u - t._y0 * t._l12_2a + t._y2 * t._l01_2a) / c;
    }
    if (t._l23_a > fy) {
      var f = 2 * t._l23_2a + 3 * t._l23_a * t._l12_a + t._l12_2a,
        s = 3 * t._l23_a * (t._l23_a + t._l12_a);
      o = (o * f + t._x1 * t._l23_2a - n * t._l12_2a) / s, a = (a * f + t._y1 * t._l23_2a - e * t._l12_2a) / s;
    }
    t._context.bezierCurveTo(r, i, o, a, t._x2, t._y2);
  }
  function m_(t, n) {
    this._context = t, this._alpha = n;
  }
  m_.prototype = {
    areaStart: function areaStart() {
      this._line = 0;
    },
    areaEnd: function areaEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._x0 = this._x1 = this._x2 = this._y0 = this._y1 = this._y2 = NaN, this._l01_a = this._l12_a = this._l23_a = this._l01_2a = this._l12_2a = this._l23_2a = this._point = 0;
    },
    lineEnd: function lineEnd() {
      switch (this._point) {
        case 2:
          this._context.lineTo(this._x2, this._y2);
          break;
        case 3:
          this.point(this._x2, this._y2);
      }
      (this._line || 0 !== this._line && 1 === this._point) && this._context.closePath(), this._line = 1 - this._line;
    },
    point: function point(t, n) {
      if (t = +t, n = +n, this._point) {
        var e = this._x2 - t,
          r = this._y2 - n;
        this._l23_a = Math.sqrt(this._l23_2a = Math.pow(e * e + r * r, this._alpha));
      }
      switch (this._point) {
        case 0:
          this._point = 1, this._line ? this._context.lineTo(t, n) : this._context.moveTo(t, n);
          break;
        case 1:
          this._point = 2;
          break;
        case 2:
          this._point = 3;
        default:
          b_(this, t, n);
      }
      this._l01_a = this._l12_a, this._l12_a = this._l23_a, this._l01_2a = this._l12_2a, this._l12_2a = this._l23_2a, this._x0 = this._x1, this._x1 = this._x2, this._x2 = t, this._y0 = this._y1, this._y1 = this._y2, this._y2 = n;
    }
  };
  var x_ = function t(n) {
    function e(t) {
      return n ? new m_(t, n) : new d_(t, 0);
    }
    return e.alpha = function (n) {
      return t(+n);
    }, e;
  }(.5);
  function w_(t, n) {
    this._context = t, this._alpha = n;
  }
  w_.prototype = {
    areaStart: o_,
    areaEnd: o_,
    lineStart: function lineStart() {
      this._x0 = this._x1 = this._x2 = this._x3 = this._x4 = this._x5 = this._y0 = this._y1 = this._y2 = this._y3 = this._y4 = this._y5 = NaN, this._l01_a = this._l12_a = this._l23_a = this._l01_2a = this._l12_2a = this._l23_2a = this._point = 0;
    },
    lineEnd: function lineEnd() {
      switch (this._point) {
        case 1:
          this._context.moveTo(this._x3, this._y3), this._context.closePath();
          break;
        case 2:
          this._context.lineTo(this._x3, this._y3), this._context.closePath();
          break;
        case 3:
          this.point(this._x3, this._y3), this.point(this._x4, this._y4), this.point(this._x5, this._y5);
      }
    },
    point: function point(t, n) {
      if (t = +t, n = +n, this._point) {
        var e = this._x2 - t,
          r = this._y2 - n;
        this._l23_a = Math.sqrt(this._l23_2a = Math.pow(e * e + r * r, this._alpha));
      }
      switch (this._point) {
        case 0:
          this._point = 1, this._x3 = t, this._y3 = n;
          break;
        case 1:
          this._point = 2, this._context.moveTo(this._x4 = t, this._y4 = n);
          break;
        case 2:
          this._point = 3, this._x5 = t, this._y5 = n;
          break;
        default:
          b_(this, t, n);
      }
      this._l01_a = this._l12_a, this._l12_a = this._l23_a, this._l01_2a = this._l12_2a, this._l12_2a = this._l23_2a, this._x0 = this._x1, this._x1 = this._x2, this._x2 = t, this._y0 = this._y1, this._y1 = this._y2, this._y2 = n;
    }
  };
  var M_ = function t(n) {
    function e(t) {
      return n ? new w_(t, n) : new v_(t, 0);
    }
    return e.alpha = function (n) {
      return t(+n);
    }, e;
  }(.5);
  function N_(t, n) {
    this._context = t, this._alpha = n;
  }
  N_.prototype = {
    areaStart: function areaStart() {
      this._line = 0;
    },
    areaEnd: function areaEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._x0 = this._x1 = this._x2 = this._y0 = this._y1 = this._y2 = NaN, this._l01_a = this._l12_a = this._l23_a = this._l01_2a = this._l12_2a = this._l23_2a = this._point = 0;
    },
    lineEnd: function lineEnd() {
      (this._line || 0 !== this._line && 3 === this._point) && this._context.closePath(), this._line = 1 - this._line;
    },
    point: function point(t, n) {
      if (t = +t, n = +n, this._point) {
        var e = this._x2 - t,
          r = this._y2 - n;
        this._l23_a = Math.sqrt(this._l23_2a = Math.pow(e * e + r * r, this._alpha));
      }
      switch (this._point) {
        case 0:
          this._point = 1;
          break;
        case 1:
          this._point = 2;
          break;
        case 2:
          this._point = 3, this._line ? this._context.lineTo(this._x2, this._y2) : this._context.moveTo(this._x2, this._y2);
          break;
        case 3:
          this._point = 4;
        default:
          b_(this, t, n);
      }
      this._l01_a = this._l12_a, this._l12_a = this._l23_a, this._l01_2a = this._l12_2a, this._l12_2a = this._l23_2a, this._x0 = this._x1, this._x1 = this._x2, this._x2 = t, this._y0 = this._y1, this._y1 = this._y2, this._y2 = n;
    }
  };
  var A_ = function t(n) {
    function e(t) {
      return n ? new N_(t, n) : new y_(t, 0);
    }
    return e.alpha = function (n) {
      return t(+n);
    }, e;
  }(.5);
  function T_(t) {
    this._context = t;
  }
  function S_(t) {
    return t < 0 ? -1 : 1;
  }
  function k_(t, n, e) {
    var r = t._x1 - t._x0,
      i = n - t._x1,
      o = (t._y1 - t._y0) / (r || i < 0 && -0),
      a = (e - t._y1) / (i || r < 0 && -0),
      u = (o * i + a * r) / (r + i);
    return (S_(o) + S_(a)) * Math.min(Math.abs(o), Math.abs(a), .5 * Math.abs(u)) || 0;
  }
  function E_(t, n) {
    var e = t._x1 - t._x0;
    return e ? (3 * (t._y1 - t._y0) / e - n) / 2 : n;
  }
  function C_(t, n, e) {
    var r = t._x0,
      i = t._y0,
      o = t._x1,
      a = t._y1,
      u = (o - r) / 3;
    t._context.bezierCurveTo(r + u, i + u * n, o - u, a - u * e, o, a);
  }
  function P_(t) {
    this._context = t;
  }
  function z_(t) {
    this._context = new R_(t);
  }
  function R_(t) {
    this._context = t;
  }
  function D_(t) {
    this._context = t;
  }
  function q_(t) {
    var n,
      e,
      r = t.length - 1,
      i = new Array(r),
      o = new Array(r),
      a = new Array(r);
    for (i[0] = 0, o[0] = 2, a[0] = t[0] + 2 * t[1], n = 1; n < r - 1; ++n) i[n] = 1, o[n] = 4, a[n] = 4 * t[n] + 2 * t[n + 1];
    for (i[r - 1] = 2, o[r - 1] = 7, a[r - 1] = 8 * t[r - 1] + t[r], n = 1; n < r; ++n) e = i[n] / o[n - 1], o[n] -= e, a[n] -= e * a[n - 1];
    for (i[r - 1] = a[r - 1] / o[r - 1], n = r - 2; n >= 0; --n) i[n] = (a[n] - i[n + 1]) / o[n];
    for (o[r - 1] = (t[r] + i[r - 1]) / 2, n = 0; n < r - 1; ++n) o[n] = 2 * t[n + 1] - i[n + 1];
    return [i, o];
  }
  function L_(t, n) {
    this._context = t, this._t = n;
  }
  function U_(t, n) {
    if ((i = t.length) > 1) for (var e, r, i, o = 1, a = t[n[0]], u = a.length; o < i; ++o) for (r = a, a = t[n[o]], e = 0; e < u; ++e) a[e][1] += a[e][0] = isNaN(r[e][1]) ? r[e][0] : r[e][1];
  }
  function O_(t) {
    for (var n = t.length, e = new Array(n); --n >= 0;) e[n] = n;
    return e;
  }
  function B_(t, n) {
    return t[n];
  }
  function Y_(t) {
    var n = t.map(F_);
    return O_(t).sort(function (t, e) {
      return n[t] - n[e];
    });
  }
  function F_(t) {
    for (var n, e = -1, r = 0, i = t.length, o = -1 / 0; ++e < i;) (n = +t[e][1]) > o && (o = n, r = e);
    return r;
  }
  function I_(t) {
    var n = t.map(j_);
    return O_(t).sort(function (t, e) {
      return n[t] - n[e];
    });
  }
  function j_(t) {
    for (var n, e = 0, r = -1, i = t.length; ++r < i;) (n = +t[r][1]) && (e += n);
    return e;
  }
  function H_(t) {
    return function () {
      return t;
    };
  }
  function X_(t) {
    return t[0];
  }
  function G_(t) {
    return t[1];
  }
  function V_() {
    this._ = null;
  }
  function $_(t) {
    t.U = t.C = t.L = t.R = t.P = t.N = null;
  }
  function W_(t, n) {
    var e = n,
      r = n.R,
      i = e.U;
    i ? i.L === e ? i.L = r : i.R = r : t._ = r, r.U = i, e.U = r, e.R = r.L, e.R && (e.R.U = e), r.L = e;
  }
  function Z_(t, n) {
    var e = n,
      r = n.L,
      i = e.U;
    i ? i.L === e ? i.L = r : i.R = r : t._ = r, r.U = i, e.U = r, e.L = r.R, e.L && (e.L.U = e), r.R = e;
  }
  function Q_(t) {
    for (; t.L;) t = t.L;
    return t;
  }
  function J_(t, n, e, r) {
    var i = [null, null],
      o = wb.push(i) - 1;
    return i.left = t, i.right = n, e && tb(i, t, n, e), r && tb(i, n, t, r), mb[t.index].halfedges.push(o), mb[n.index].halfedges.push(o), i;
  }
  function K_(t, n, e) {
    var r = [n, e];
    return r.left = t, r;
  }
  function tb(t, n, e, r) {
    t[0] || t[1] ? t.left === e ? t[1] = r : t[0] = r : (t[0] = r, t.left = n, t.right = e);
  }
  function nb(t, n, e, r, i) {
    var o,
      a = t[0],
      u = t[1],
      c = a[0],
      f = a[1],
      s = 0,
      l = 1,
      h = u[0] - c,
      d = u[1] - f;
    if (o = n - c, h || !(o > 0)) {
      if (o /= h, h < 0) {
        if (o < s) return;
        o < l && (l = o);
      } else if (h > 0) {
        if (o > l) return;
        o > s && (s = o);
      }
      if (o = r - c, h || !(o < 0)) {
        if (o /= h, h < 0) {
          if (o > l) return;
          o > s && (s = o);
        } else if (h > 0) {
          if (o < s) return;
          o < l && (l = o);
        }
        if (o = e - f, d || !(o > 0)) {
          if (o /= d, d < 0) {
            if (o < s) return;
            o < l && (l = o);
          } else if (d > 0) {
            if (o > l) return;
            o > s && (s = o);
          }
          if (o = i - f, d || !(o < 0)) {
            if (o /= d, d < 0) {
              if (o > l) return;
              o > s && (s = o);
            } else if (d > 0) {
              if (o < s) return;
              o < l && (l = o);
            }
            return !(s > 0 || l < 1) || (s > 0 && (t[0] = [c + s * h, f + s * d]), l < 1 && (t[1] = [c + l * h, f + l * d]), !0);
          }
        }
      }
    }
  }
  function eb(t, n, e, r, i) {
    var o = t[1];
    if (o) return !0;
    var a,
      u,
      c = t[0],
      f = t.left,
      s = t.right,
      l = f[0],
      h = f[1],
      d = s[0],
      p = s[1],
      v = (l + d) / 2,
      g = (h + p) / 2;
    if (p === h) {
      if (v < n || v >= r) return;
      if (l > d) {
        if (c) {
          if (c[1] >= i) return;
        } else c = [v, e];
        o = [v, i];
      } else {
        if (c) {
          if (c[1] < e) return;
        } else c = [v, i];
        o = [v, e];
      }
    } else if (u = g - (a = (l - d) / (p - h)) * v, a < -1 || a > 1) {
      if (l > d) {
        if (c) {
          if (c[1] >= i) return;
        } else c = [(e - u) / a, e];
        o = [(i - u) / a, i];
      } else {
        if (c) {
          if (c[1] < e) return;
        } else c = [(i - u) / a, i];
        o = [(e - u) / a, e];
      }
    } else if (h < p) {
      if (c) {
        if (c[0] >= r) return;
      } else c = [n, a * n + u];
      o = [r, a * r + u];
    } else {
      if (c) {
        if (c[0] < n) return;
      } else c = [r, a * r + u];
      o = [n, a * n + u];
    }
    return t[0] = c, t[1] = o, !0;
  }
  function rb(t, n) {
    var e = t.site,
      r = n.left,
      i = n.right;
    return e === i && (i = r, r = e), i ? Math.atan2(i[1] - r[1], i[0] - r[0]) : (e === r ? (r = n[1], i = n[0]) : (r = n[0], i = n[1]), Math.atan2(r[0] - i[0], i[1] - r[1]));
  }
  function ib(t, n) {
    return n[+(n.left !== t.site)];
  }
  function ob(t, n) {
    return n[+(n.left === t.site)];
  }
  T_.prototype = {
    areaStart: o_,
    areaEnd: o_,
    lineStart: function lineStart() {
      this._point = 0;
    },
    lineEnd: function lineEnd() {
      this._point && this._context.closePath();
    },
    point: function point(t, n) {
      t = +t, n = +n, this._point ? this._context.lineTo(t, n) : (this._point = 1, this._context.moveTo(t, n));
    }
  }, P_.prototype = {
    areaStart: function areaStart() {
      this._line = 0;
    },
    areaEnd: function areaEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._x0 = this._x1 = this._y0 = this._y1 = this._t0 = NaN, this._point = 0;
    },
    lineEnd: function lineEnd() {
      switch (this._point) {
        case 2:
          this._context.lineTo(this._x1, this._y1);
          break;
        case 3:
          C_(this, this._t0, E_(this, this._t0));
      }
      (this._line || 0 !== this._line && 1 === this._point) && this._context.closePath(), this._line = 1 - this._line;
    },
    point: function point(t, n) {
      var e = NaN;
      if (n = +n, (t = +t) !== this._x1 || n !== this._y1) {
        switch (this._point) {
          case 0:
            this._point = 1, this._line ? this._context.lineTo(t, n) : this._context.moveTo(t, n);
            break;
          case 1:
            this._point = 2;
            break;
          case 2:
            this._point = 3, C_(this, E_(this, e = k_(this, t, n)), e);
            break;
          default:
            C_(this, this._t0, e = k_(this, t, n));
        }
        this._x0 = this._x1, this._x1 = t, this._y0 = this._y1, this._y1 = n, this._t0 = e;
      }
    }
  }, (z_.prototype = Object.create(P_.prototype)).point = function (t, n) {
    P_.prototype.point.call(this, n, t);
  }, R_.prototype = {
    moveTo: function moveTo(t, n) {
      this._context.moveTo(n, t);
    },
    closePath: function closePath() {
      this._context.closePath();
    },
    lineTo: function lineTo(t, n) {
      this._context.lineTo(n, t);
    },
    bezierCurveTo: function bezierCurveTo(t, n, e, r, i, o) {
      this._context.bezierCurveTo(n, t, r, e, o, i);
    }
  }, D_.prototype = {
    areaStart: function areaStart() {
      this._line = 0;
    },
    areaEnd: function areaEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._x = [], this._y = [];
    },
    lineEnd: function lineEnd() {
      var t = this._x,
        n = this._y,
        e = t.length;
      if (e) if (this._line ? this._context.lineTo(t[0], n[0]) : this._context.moveTo(t[0], n[0]), 2 === e) this._context.lineTo(t[1], n[1]);else for (var r = q_(t), i = q_(n), o = 0, a = 1; a < e; ++o, ++a) this._context.bezierCurveTo(r[0][o], i[0][o], r[1][o], i[1][o], t[a], n[a]);
      (this._line || 0 !== this._line && 1 === e) && this._context.closePath(), this._line = 1 - this._line, this._x = this._y = null;
    },
    point: function point(t, n) {
      this._x.push(+t), this._y.push(+n);
    }
  }, L_.prototype = {
    areaStart: function areaStart() {
      this._line = 0;
    },
    areaEnd: function areaEnd() {
      this._line = NaN;
    },
    lineStart: function lineStart() {
      this._x = this._y = NaN, this._point = 0;
    },
    lineEnd: function lineEnd() {
      0 < this._t && this._t < 1 && 2 === this._point && this._context.lineTo(this._x, this._y), (this._line || 0 !== this._line && 1 === this._point) && this._context.closePath(), this._line >= 0 && (this._t = 1 - this._t, this._line = 1 - this._line);
    },
    point: function point(t, n) {
      switch (t = +t, n = +n, this._point) {
        case 0:
          this._point = 1, this._line ? this._context.lineTo(t, n) : this._context.moveTo(t, n);
          break;
        case 1:
          this._point = 2;
        default:
          if (this._t <= 0) this._context.lineTo(this._x, n), this._context.lineTo(t, n);else {
            var e = this._x * (1 - this._t) + t * this._t;
            this._context.lineTo(e, this._y), this._context.lineTo(e, n);
          }
      }
      this._x = t, this._y = n;
    }
  }, V_.prototype = {
    constructor: V_,
    insert: function insert(t, n) {
      var e, r, i;
      if (t) {
        if (n.P = t, n.N = t.N, t.N && (t.N.P = n), t.N = n, t.R) {
          for (t = t.R; t.L;) t = t.L;
          t.L = n;
        } else t.R = n;
        e = t;
      } else this._ ? (t = Q_(this._), n.P = null, n.N = t, t.P = t.L = n, e = t) : (n.P = n.N = null, this._ = n, e = null);
      for (n.L = n.R = null, n.U = e, n.C = !0, t = n; e && e.C;) e === (r = e.U).L ? (i = r.R) && i.C ? (e.C = i.C = !1, r.C = !0, t = r) : (t === e.R && (W_(this, e), e = (t = e).U), e.C = !1, r.C = !0, Z_(this, r)) : (i = r.L) && i.C ? (e.C = i.C = !1, r.C = !0, t = r) : (t === e.L && (Z_(this, e), e = (t = e).U), e.C = !1, r.C = !0, W_(this, r)), e = t.U;
      this._.C = !1;
    },
    remove: function remove(t) {
      t.N && (t.N.P = t.P), t.P && (t.P.N = t.N), t.N = t.P = null;
      var n,
        e,
        r,
        i = t.U,
        o = t.L,
        a = t.R;
      if (e = o ? a ? Q_(a) : o : a, i ? i.L === t ? i.L = e : i.R = e : this._ = e, o && a ? (r = e.C, e.C = t.C, e.L = o, o.U = e, e !== a ? (i = e.U, e.U = t.U, t = e.R, i.L = t, e.R = a, a.U = e) : (e.U = i, i = e, t = e.R)) : (r = t.C, t = e), t && (t.U = i), !r) if (t && t.C) t.C = !1;else {
        do {
          if (t === this._) break;
          if (t === i.L) {
            if ((n = i.R).C && (n.C = !1, i.C = !0, W_(this, i), n = i.R), n.L && n.L.C || n.R && n.R.C) {
              n.R && n.R.C || (n.L.C = !1, n.C = !0, Z_(this, n), n = i.R), n.C = i.C, i.C = n.R.C = !1, W_(this, i), t = this._;
              break;
            }
          } else if ((n = i.L).C && (n.C = !1, i.C = !0, Z_(this, i), n = i.L), n.L && n.L.C || n.R && n.R.C) {
            n.L && n.L.C || (n.R.C = !1, n.C = !0, W_(this, n), n = i.L), n.C = i.C, i.C = n.L.C = !1, Z_(this, i), t = this._;
            break;
          }
          n.C = !0, t = i, i = i.U;
        } while (!t.C);
        t && (t.C = !1);
      }
    }
  };
  var ab,
    ub = [];
  function cb() {
    $_(this), this.x = this.y = this.arc = this.site = this.cy = null;
  }
  function fb(t) {
    var n = t.P,
      e = t.N;
    if (n && e) {
      var r = n.site,
        i = t.site,
        o = e.site;
      if (r !== o) {
        var a = i[0],
          u = i[1],
          c = r[0] - a,
          f = r[1] - u,
          s = o[0] - a,
          l = o[1] - u,
          h = 2 * (c * l - f * s);
        if (!(h >= -Nb)) {
          var d = c * c + f * f,
            p = s * s + l * l,
            v = (l * d - f * p) / h,
            g = (c * p - s * d) / h,
            y = ub.pop() || new cb();
          y.arc = t, y.site = i, y.x = v + a, y.y = (y.cy = g + u) + Math.sqrt(v * v + g * g), t.circle = y;
          for (var _ = null, b = xb._; b;) if (y.y < b.y || y.y === b.y && y.x <= b.x) {
            if (!b.L) {
              _ = b.P;
              break;
            }
            b = b.L;
          } else {
            if (!b.R) {
              _ = b;
              break;
            }
            b = b.R;
          }
          xb.insert(_, y), _ || (ab = y);
        }
      }
    }
  }
  function sb(t) {
    var n = t.circle;
    n && (n.P || (ab = n.N), xb.remove(n), ub.push(n), $_(n), t.circle = null);
  }
  var lb = [];
  function hb() {
    $_(this), this.edge = this.site = this.circle = null;
  }
  function db(t) {
    var n = lb.pop() || new hb();
    return n.site = t, n;
  }
  function pb(t) {
    sb(t), bb.remove(t), lb.push(t), $_(t);
  }
  function vb(t) {
    var n = t.circle,
      e = n.x,
      r = n.cy,
      i = [e, r],
      o = t.P,
      a = t.N,
      u = [t];
    pb(t);
    for (var c = o; c.circle && Math.abs(e - c.circle.x) < Mb && Math.abs(r - c.circle.cy) < Mb;) o = c.P, u.unshift(c), pb(c), c = o;
    u.unshift(c), sb(c);
    for (var f = a; f.circle && Math.abs(e - f.circle.x) < Mb && Math.abs(r - f.circle.cy) < Mb;) a = f.N, u.push(f), pb(f), f = a;
    u.push(f), sb(f);
    var s,
      l = u.length;
    for (s = 1; s < l; ++s) f = u[s], c = u[s - 1], tb(f.edge, c.site, f.site, i);
    c = u[0], (f = u[l - 1]).edge = J_(c.site, f.site, null, i), fb(c), fb(f);
  }
  function gb(t) {
    for (var n, e, r, i, o = t[0], a = t[1], u = bb._; u;) if ((r = yb(u, a) - o) > Mb) u = u.L;else {
      if (!((i = o - _b(u, a)) > Mb)) {
        r > -Mb ? (n = u.P, e = u) : i > -Mb ? (n = u, e = u.N) : n = e = u;
        break;
      }
      if (!u.R) {
        n = u;
        break;
      }
      u = u.R;
    }
    !function (t) {
      mb[t.index] = {
        site: t,
        halfedges: []
      };
    }(t);
    var c = db(t);
    if (bb.insert(n, c), n || e) {
      if (n === e) return sb(n), e = db(n.site), bb.insert(c, e), c.edge = e.edge = J_(n.site, c.site), fb(n), void fb(e);
      if (e) {
        sb(n), sb(e);
        var f = n.site,
          s = f[0],
          l = f[1],
          h = t[0] - s,
          d = t[1] - l,
          p = e.site,
          v = p[0] - s,
          g = p[1] - l,
          y = 2 * (h * g - d * v),
          _ = h * h + d * d,
          b = v * v + g * g,
          m = [(g * _ - d * b) / y + s, (h * b - v * _) / y + l];
        tb(e.edge, f, p, m), c.edge = J_(f, t, null, m), e.edge = J_(t, p, null, m), fb(n), fb(e);
      } else c.edge = J_(n.site, c.site);
    }
  }
  function yb(t, n) {
    var e = t.site,
      r = e[0],
      i = e[1],
      o = i - n;
    if (!o) return r;
    var a = t.P;
    if (!a) return -1 / 0;
    var u = (e = a.site)[0],
      c = e[1],
      f = c - n;
    if (!f) return u;
    var s = u - r,
      l = 1 / o - 1 / f,
      h = s / f;
    return l ? (-h + Math.sqrt(h * h - 2 * l * (s * s / (-2 * f) - c + f / 2 + i - o / 2))) / l + r : (r + u) / 2;
  }
  function _b(t, n) {
    var e = t.N;
    if (e) return yb(e, n);
    var r = t.site;
    return r[1] === n ? r[0] : 1 / 0;
  }
  var bb,
    mb,
    xb,
    wb,
    Mb = 1e-6,
    Nb = 1e-12;
  function Ab(t, n) {
    return n[1] - t[1] || n[0] - t[0];
  }
  function Tb(t, n) {
    var e,
      r,
      i,
      o = t.sort(Ab).pop();
    for (wb = [], mb = new Array(t.length), bb = new V_(), xb = new V_();;) if (i = ab, o && (!i || o[1] < i.y || o[1] === i.y && o[0] < i.x)) o[0] === e && o[1] === r || (gb(o), e = o[0], r = o[1]), o = t.pop();else {
      if (!i) break;
      vb(i.arc);
    }
    if (function () {
      for (var t, n, e, r, i = 0, o = mb.length; i < o; ++i) if ((t = mb[i]) && (r = (n = t.halfedges).length)) {
        var a = new Array(r),
          u = new Array(r);
        for (e = 0; e < r; ++e) a[e] = e, u[e] = rb(t, wb[n[e]]);
        for (a.sort(function (t, n) {
          return u[n] - u[t];
        }), e = 0; e < r; ++e) u[e] = n[a[e]];
        for (e = 0; e < r; ++e) n[e] = u[e];
      }
    }(), n) {
      var a = +n[0][0],
        u = +n[0][1],
        c = +n[1][0],
        f = +n[1][1];
      !function (t, n, e, r) {
        for (var i, o = wb.length; o--;) eb(i = wb[o], t, n, e, r) && nb(i, t, n, e, r) && (Math.abs(i[0][0] - i[1][0]) > Mb || Math.abs(i[0][1] - i[1][1]) > Mb) || delete wb[o];
      }(a, u, c, f), function (t, n, e, r) {
        var i,
          o,
          a,
          u,
          c,
          f,
          s,
          l,
          h,
          d,
          p,
          v,
          g = mb.length,
          y = !0;
        for (i = 0; i < g; ++i) if (o = mb[i]) {
          for (a = o.site, u = (c = o.halfedges).length; u--;) wb[c[u]] || c.splice(u, 1);
          for (u = 0, f = c.length; u < f;) p = (d = ob(o, wb[c[u]]))[0], v = d[1], l = (s = ib(o, wb[c[++u % f]]))[0], h = s[1], (Math.abs(p - l) > Mb || Math.abs(v - h) > Mb) && (c.splice(u, 0, wb.push(K_(a, d, Math.abs(p - t) < Mb && r - v > Mb ? [t, Math.abs(l - t) < Mb ? h : r] : Math.abs(v - r) < Mb && e - p > Mb ? [Math.abs(h - r) < Mb ? l : e, r] : Math.abs(p - e) < Mb && v - n > Mb ? [e, Math.abs(l - e) < Mb ? h : n] : Math.abs(v - n) < Mb && p - t > Mb ? [Math.abs(h - n) < Mb ? l : t, n] : null)) - 1), ++f);
          f && (y = !1);
        }
        if (y) {
          var _,
            b,
            m,
            x = 1 / 0;
          for (i = 0, y = null; i < g; ++i) (o = mb[i]) && (m = (_ = (a = o.site)[0] - t) * _ + (b = a[1] - n) * b) < x && (x = m, y = o);
          if (y) {
            var w = [t, n],
              M = [t, r],
              N = [e, r],
              A = [e, n];
            y.halfedges.push(wb.push(K_(a = y.site, w, M)) - 1, wb.push(K_(a, M, N)) - 1, wb.push(K_(a, N, A)) - 1, wb.push(K_(a, A, w)) - 1);
          }
        }
        for (i = 0; i < g; ++i) (o = mb[i]) && (o.halfedges.length || delete mb[i]);
      }(a, u, c, f);
    }
    this.edges = wb, this.cells = mb, bb = xb = wb = mb = null;
  }
  function Sb(t) {
    return function () {
      return t;
    };
  }
  function kb(t, n, e) {
    this.target = t, this.type = n, this.transform = e;
  }
  function Eb(t, n, e) {
    this.k = t, this.x = n, this.y = e;
  }
  Tb.prototype = {
    constructor: Tb,
    polygons: function polygons() {
      var t = this.edges;
      return this.cells.map(function (n) {
        var e = n.halfedges.map(function (e) {
          return ib(n, t[e]);
        });
        return e.data = n.site.data, e;
      });
    },
    triangles: function triangles() {
      var t = [],
        n = this.edges;
      return this.cells.forEach(function (e, r) {
        if (o = (i = e.halfedges).length) for (var i, o, a, u, c, f, s = e.site, l = -1, h = n[i[o - 1]], d = h.left === s ? h.right : h.left; ++l < o;) a = d, d = (h = n[i[l]]).left === s ? h.right : h.left, a && d && r < a.index && r < d.index && (c = a, f = d, ((u = s)[0] - f[0]) * (c[1] - u[1]) - (u[0] - c[0]) * (f[1] - u[1]) < 0) && t.push([s.data, a.data, d.data]);
      }), t;
    },
    links: function links() {
      return this.edges.filter(function (t) {
        return t.right;
      }).map(function (t) {
        return {
          source: t.left.data,
          target: t.right.data
        };
      });
    },
    find: function find(t, n, e) {
      for (var r, i, o = this, a = o._found || 0, u = o.cells.length; !(i = o.cells[a]);) if (++a >= u) return null;
      var c = t - i.site[0],
        f = n - i.site[1],
        s = c * c + f * f;
      do {
        i = o.cells[r = a], a = null, i.halfedges.forEach(function (e) {
          var r = o.edges[e],
            u = r.left;
          if (u !== i.site && u || (u = r.right)) {
            var c = t - u[0],
              f = n - u[1],
              l = c * c + f * f;
            l < s && (s = l, a = u.index);
          }
        });
      } while (null !== a);
      return o._found = r, null == e || s <= e * e ? i.site : null;
    }
  }, Eb.prototype = {
    constructor: Eb,
    scale: function scale(t) {
      return 1 === t ? this : new Eb(this.k * t, this.x, this.y);
    },
    translate: function translate(t, n) {
      return 0 === t & 0 === n ? this : new Eb(this.k, this.x + this.k * t, this.y + this.k * n);
    },
    apply: function apply(t) {
      return [t[0] * this.k + this.x, t[1] * this.k + this.y];
    },
    applyX: function applyX(t) {
      return t * this.k + this.x;
    },
    applyY: function applyY(t) {
      return t * this.k + this.y;
    },
    invert: function invert(t) {
      return [(t[0] - this.x) / this.k, (t[1] - this.y) / this.k];
    },
    invertX: function invertX(t) {
      return (t - this.x) / this.k;
    },
    invertY: function invertY(t) {
      return (t - this.y) / this.k;
    },
    rescaleX: function rescaleX(t) {
      return t.copy().domain(t.range().map(this.invertX, this).map(t.invert, t));
    },
    rescaleY: function rescaleY(t) {
      return t.copy().domain(t.range().map(this.invertY, this).map(t.invert, t));
    },
    toString: function toString() {
      return "translate(" + this.x + "," + this.y + ") scale(" + this.k + ")";
    }
  };
  var Cb = new Eb(1, 0, 0);
  function Pb(t) {
    return t.__zoom || Cb;
  }
  function zb() {
    t.event.stopImmediatePropagation();
  }
  function Rb() {
    t.event.preventDefault(), t.event.stopImmediatePropagation();
  }
  function Db() {
    return !t.event.button;
  }
  function qb() {
    var t,
      n,
      e = this;
    return e instanceof SVGElement ? (t = (e = e.ownerSVGElement || e).width.baseVal.value, n = e.height.baseVal.value) : (t = e.clientWidth, n = e.clientHeight), [[0, 0], [t, n]];
  }
  function Lb() {
    return this.__zoom || Cb;
  }
  function Ub() {
    return -t.event.deltaY * (t.event.deltaMode ? 120 : 1) / 500;
  }
  function Ob() {
    return "ontouchstart" in this;
  }
  function Bb(t, n, e) {
    var r = t.invertX(n[0][0]) - e[0][0],
      i = t.invertX(n[1][0]) - e[1][0],
      o = t.invertY(n[0][1]) - e[0][1],
      a = t.invertY(n[1][1]) - e[1][1];
    return t.translate(i > r ? (r + i) / 2 : Math.min(0, r) || Math.max(0, i), a > o ? (o + a) / 2 : Math.min(0, o) || Math.max(0, a));
  }
  Pb.prototype = Eb.prototype, t.version = "5.9.7", t.bisect = i, t.bisectRight = i, t.bisectLeft = o, t.ascending = n, t.bisector = e, t.cross = function (t, n, e) {
    var r,
      i,
      o,
      u,
      c = t.length,
      f = n.length,
      s = new Array(c * f);
    for (null == e && (e = a), r = o = 0; r < c; ++r) for (u = t[r], i = 0; i < f; ++i, ++o) s[o] = e(u, n[i]);
    return s;
  }, t.descending = function (t, n) {
    return n < t ? -1 : n > t ? 1 : n >= t ? 0 : NaN;
  }, t.deviation = f, t.extent = s, t.histogram = function () {
    var t = v,
      n = s,
      e = M;
    function r(r) {
      var o,
        a,
        u = r.length,
        c = new Array(u);
      for (o = 0; o < u; ++o) c[o] = t(r[o], o, r);
      var f = n(c),
        s = f[0],
        l = f[1],
        h = e(c, s, l);
      Array.isArray(h) || (h = w(s, l, h), h = g(Math.ceil(s / h) * h, l, h));
      for (var d = h.length; h[0] <= s;) h.shift(), --d;
      for (; h[d - 1] > l;) h.pop(), --d;
      var p,
        v = new Array(d + 1);
      for (o = 0; o <= d; ++o) (p = v[o] = []).x0 = o > 0 ? h[o - 1] : s, p.x1 = o < d ? h[o] : l;
      for (o = 0; o < u; ++o) s <= (a = c[o]) && a <= l && v[i(h, a, 0, d)].push(r[o]);
      return v;
    }
    return r.value = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : p(n), r) : t;
    }, r.domain = function (t) {
      return arguments.length ? (n = "function" == typeof t ? t : p([t[0], t[1]]), r) : n;
    }, r.thresholds = function (t) {
      return arguments.length ? (e = "function" == typeof t ? t : Array.isArray(t) ? p(h.call(t)) : p(t), r) : e;
    }, r;
  }, t.thresholdFreedmanDiaconis = function (t, e, r) {
    return t = d.call(t, u).sort(n), Math.ceil((r - e) / (2 * (N(t, .75) - N(t, .25)) * Math.pow(t.length, -1 / 3)));
  }, t.thresholdScott = function (t, n, e) {
    return Math.ceil((e - n) / (3.5 * f(t) * Math.pow(t.length, -1 / 3)));
  }, t.thresholdSturges = M, t.max = A, t.mean = function (t, n) {
    var e,
      r = t.length,
      i = r,
      o = -1,
      a = 0;
    if (null == n) for (; ++o < r;) isNaN(e = u(t[o])) ? --i : a += e;else for (; ++o < r;) isNaN(e = u(n(t[o], o, t))) ? --i : a += e;
    if (i) return a / i;
  }, t.median = function (t, e) {
    var r,
      i = t.length,
      o = -1,
      a = [];
    if (null == e) for (; ++o < i;) isNaN(r = u(t[o])) || a.push(r);else for (; ++o < i;) isNaN(r = u(e(t[o], o, t))) || a.push(r);
    return N(a.sort(n), .5);
  }, t.merge = T, t.min = S, t.pairs = function (t, n) {
    null == n && (n = a);
    for (var e = 0, r = t.length - 1, i = t[0], o = new Array(r < 0 ? 0 : r); e < r;) o[e] = n(i, i = t[++e]);
    return o;
  }, t.permute = function (t, n) {
    for (var e = n.length, r = new Array(e); e--;) r[e] = t[n[e]];
    return r;
  }, t.quantile = N, t.range = g, t.scan = function (t, e) {
    if (r = t.length) {
      var r,
        i,
        o = 0,
        a = 0,
        u = t[a];
      for (null == e && (e = n); ++o < r;) (e(i = t[o], u) < 0 || 0 !== e(u, u)) && (u = i, a = o);
      return 0 === e(u, u) ? a : void 0;
    }
  }, t.shuffle = function (t, n, e) {
    for (var r, i, o = (null == e ? t.length : e) - (n = null == n ? 0 : +n); o;) i = Math.random() * o-- | 0, r = t[o + n], t[o + n] = t[i + n], t[i + n] = r;
    return t;
  }, t.sum = function (t, n) {
    var e,
      r = t.length,
      i = -1,
      o = 0;
    if (null == n) for (; ++i < r;) (e = +t[i]) && (o += e);else for (; ++i < r;) (e = +n(t[i], i, t)) && (o += e);
    return o;
  }, t.ticks = m, t.tickIncrement = x, t.tickStep = w, t.transpose = k, t.variance = c, t.zip = function () {
    return k(arguments);
  }, t.axisTop = function (t) {
    return Y(z, t);
  }, t.axisRight = function (t) {
    return Y(R, t);
  }, t.axisBottom = function (t) {
    return Y(D, t);
  }, t.axisLeft = function (t) {
    return Y(q, t);
  }, t.brush = function () {
    return zi(xi);
  }, t.brushX = function () {
    return zi(bi);
  }, t.brushY = function () {
    return zi(mi);
  }, t.brushSelection = function (t) {
    var n = t.__brush;
    return n ? n.dim.output(n.selection) : null;
  }, t.chord = function () {
    var t = 0,
      n = null,
      e = null,
      r = null;
    function i(i) {
      var o,
        a,
        u,
        c,
        f,
        s,
        l = i.length,
        h = [],
        d = g(l),
        p = [],
        v = [],
        y = v.groups = new Array(l),
        _ = new Array(l * l);
      for (o = 0, f = -1; ++f < l;) {
        for (a = 0, s = -1; ++s < l;) a += i[f][s];
        h.push(a), p.push(g(l)), o += a;
      }
      for (n && d.sort(function (t, e) {
        return n(h[t], h[e]);
      }), e && p.forEach(function (t, n) {
        t.sort(function (t, r) {
          return e(i[n][t], i[n][r]);
        });
      }), c = (o = Oi(0, Ui - t * l) / o) ? t : Ui / l, a = 0, f = -1; ++f < l;) {
        for (u = a, s = -1; ++s < l;) {
          var b = d[f],
            m = p[b][s],
            x = i[b][m],
            w = a,
            M = a += x * o;
          _[m * l + b] = {
            index: b,
            subindex: m,
            startAngle: w,
            endAngle: M,
            value: x
          };
        }
        y[b] = {
          index: b,
          startAngle: u,
          endAngle: a,
          value: h[b]
        }, a += c;
      }
      for (f = -1; ++f < l;) for (s = f - 1; ++s < l;) {
        var N = _[s * l + f],
          A = _[f * l + s];
        (N.value || A.value) && v.push(N.value < A.value ? {
          source: A,
          target: N
        } : {
          source: N,
          target: A
        });
      }
      return r ? v.sort(r) : v;
    }
    return i.padAngle = function (n) {
      return arguments.length ? (t = Oi(0, n), i) : t;
    }, i.sortGroups = function (t) {
      return arguments.length ? (n = t, i) : n;
    }, i.sortSubgroups = function (t) {
      return arguments.length ? (e = t, i) : e;
    }, i.sortChords = function (t) {
      return arguments.length ? (null == t ? r = null : (n = t, r = function r(t, e) {
        return n(t.source.value + t.target.value, e.source.value + e.target.value);
      })._ = t, i) : r && r._;
      var n;
    }, i;
  }, t.ribbon = function () {
    var t = Gi,
      n = Vi,
      e = $i,
      r = Wi,
      i = Zi,
      o = null;
    function a() {
      var a,
        u = Bi.call(arguments),
        c = t.apply(this, u),
        f = n.apply(this, u),
        s = +e.apply(this, (u[0] = c, u)),
        l = r.apply(this, u) - Li,
        h = i.apply(this, u) - Li,
        d = s * Ri(l),
        p = s * Di(l),
        v = +e.apply(this, (u[0] = f, u)),
        g = r.apply(this, u) - Li,
        y = i.apply(this, u) - Li;
      if (o || (o = a = Xi()), o.moveTo(d, p), o.arc(0, 0, s, l, h), l === g && h === y || (o.quadraticCurveTo(0, 0, v * Ri(g), v * Di(g)), o.arc(0, 0, v, g, y)), o.quadraticCurveTo(0, 0, d, p), o.closePath(), a) return o = null, a + "" || null;
    }
    return a.radius = function (t) {
      return arguments.length ? (e = "function" == typeof t ? t : Yi(+t), a) : e;
    }, a.startAngle = function (t) {
      return arguments.length ? (r = "function" == typeof t ? t : Yi(+t), a) : r;
    }, a.endAngle = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : Yi(+t), a) : i;
    }, a.source = function (n) {
      return arguments.length ? (t = n, a) : t;
    }, a.target = function (t) {
      return arguments.length ? (n = t, a) : n;
    }, a.context = function (t) {
      return arguments.length ? (o = null == t ? null : t, a) : o;
    }, a;
  }, t.nest = function () {
    var t,
      n,
      e,
      r = [],
      i = [];
    function o(e, i, a, u) {
      if (i >= r.length) return null != t && e.sort(t), null != n ? n(e) : e;
      for (var c, f, s, l = -1, h = e.length, d = r[i++], p = Ji(), v = a(); ++l < h;) (s = p.get(c = d(f = e[l]) + "")) ? s.push(f) : p.set(c, [f]);
      return p.each(function (t, n) {
        u(v, n, o(t, i, a, u));
      }), v;
    }
    return e = {
      object: function object(t) {
        return o(t, 0, Ki, to);
      },
      map: function map(t) {
        return o(t, 0, no, eo);
      },
      entries: function entries(t) {
        return function t(e, o) {
          if (++o > r.length) return e;
          var a,
            u = i[o - 1];
          return null != n && o >= r.length ? a = e.entries() : (a = [], e.each(function (n, e) {
            a.push({
              key: e,
              values: t(n, o)
            });
          })), null != u ? a.sort(function (t, n) {
            return u(t.key, n.key);
          }) : a;
        }(o(t, 0, no, eo), 0);
      },
      key: function key(t) {
        return r.push(t), e;
      },
      sortKeys: function sortKeys(t) {
        return i[r.length - 1] = t, e;
      },
      sortValues: function sortValues(n) {
        return t = n, e;
      },
      rollup: function rollup(t) {
        return n = t, e;
      }
    };
  }, t.set = oo, t.map = Ji, t.keys = function (t) {
    var n = [];
    for (var e in t) n.push(e);
    return n;
  }, t.values = function (t) {
    var n = [];
    for (var e in t) n.push(t[e]);
    return n;
  }, t.entries = function (t) {
    var n = [];
    for (var e in t) n.push({
      key: e,
      value: t[e]
    });
    return n;
  }, t.color = hn, t.rgb = gn, t.hsl = mn, t.lab = Rn, t.hcl = Yn, t.lch = function (t, n, e, r) {
    return 1 === arguments.length ? Bn(t) : new Fn(e, n, t, null == r ? 1 : r);
  }, t.gray = function (t, n) {
    return new Dn(t, 0, 0, null == n ? 1 : n);
  }, t.cubehelix = Qn, t.contours = vo, t.contourDensity = function () {
    var t = _o,
      n = bo,
      e = mo,
      r = 960,
      i = 500,
      o = 20,
      a = 2,
      u = 3 * o,
      c = r + 2 * u >> a,
      f = i + 2 * u >> a,
      s = co(20);
    function l(r) {
      var i = new Float32Array(c * f),
        l = new Float32Array(c * f);
      r.forEach(function (r, o, s) {
        var l = +t(r, o, s) + u >> a,
          h = +n(r, o, s) + u >> a,
          d = +e(r, o, s);
        l >= 0 && l < c && h >= 0 && h < f && (i[l + h * c] += d);
      }), go({
        width: c,
        height: f,
        data: i
      }, {
        width: c,
        height: f,
        data: l
      }, o >> a), yo({
        width: c,
        height: f,
        data: l
      }, {
        width: c,
        height: f,
        data: i
      }, o >> a), go({
        width: c,
        height: f,
        data: i
      }, {
        width: c,
        height: f,
        data: l
      }, o >> a), yo({
        width: c,
        height: f,
        data: l
      }, {
        width: c,
        height: f,
        data: i
      }, o >> a), go({
        width: c,
        height: f,
        data: i
      }, {
        width: c,
        height: f,
        data: l
      }, o >> a), yo({
        width: c,
        height: f,
        data: l
      }, {
        width: c,
        height: f,
        data: i
      }, o >> a);
      var d = s(i);
      if (!Array.isArray(d)) {
        var p = A(i);
        d = w(0, p, d), (d = g(0, Math.floor(p / d) * d, d)).shift();
      }
      return vo().thresholds(d).size([c, f])(i).map(h);
    }
    function h(t) {
      return t.value *= Math.pow(2, -2 * a), t.coordinates.forEach(d), t;
    }
    function d(t) {
      t.forEach(p);
    }
    function p(t) {
      t.forEach(v);
    }
    function v(t) {
      t[0] = t[0] * Math.pow(2, a) - u, t[1] = t[1] * Math.pow(2, a) - u;
    }
    function y() {
      return c = r + 2 * (u = 3 * o) >> a, f = i + 2 * u >> a, l;
    }
    return l.x = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : co(+n), l) : t;
    }, l.y = function (t) {
      return arguments.length ? (n = "function" == typeof t ? t : co(+t), l) : n;
    }, l.weight = function (t) {
      return arguments.length ? (e = "function" == typeof t ? t : co(+t), l) : e;
    }, l.size = function (t) {
      if (!arguments.length) return [r, i];
      var n = Math.ceil(t[0]),
        e = Math.ceil(t[1]);
      if (!(n >= 0 || n >= 0)) throw new Error("invalid size");
      return r = n, i = e, y();
    }, l.cellSize = function (t) {
      if (!arguments.length) return 1 << a;
      if (!((t = +t) >= 1)) throw new Error("invalid cell size");
      return a = Math.floor(Math.log(t) / Math.LN2), y();
    }, l.thresholds = function (t) {
      return arguments.length ? (s = "function" == typeof t ? t : Array.isArray(t) ? co(ao.call(t)) : co(t), l) : s;
    }, l.bandwidth = function (t) {
      if (!arguments.length) return Math.sqrt(o * (o + 1));
      if (!((t = +t) >= 0)) throw new Error("invalid bandwidth");
      return o = Math.round((Math.sqrt(4 * t * t + 1) - 1) / 2), y();
    }, l;
  }, t.dispatch = I, t.drag = function () {
    var n,
      e,
      r,
      i,
      o = Gt,
      a = Vt,
      u = $t,
      c = Wt,
      f = {},
      s = I("start", "drag", "end"),
      l = 0,
      h = 0;
    function d(t) {
      t.on("mousedown.drag", p).filter(c).on("touchstart.drag", y).on("touchmove.drag", _).on("touchend.drag touchcancel.drag", b).style("touch-action", "none").style("-webkit-tap-highlight-color", "rgba(0,0,0,0)");
    }
    function p() {
      if (!i && o.apply(this, arguments)) {
        var u = m("mouse", a.apply(this, arguments), Ot, this, arguments);
        u && (zt(t.event.view).on("mousemove.drag", v, !0).on("mouseup.drag", g, !0), It(t.event.view), Yt(), r = !1, n = t.event.clientX, e = t.event.clientY, u("start"));
      }
    }
    function v() {
      if (Ft(), !r) {
        var i = t.event.clientX - n,
          o = t.event.clientY - e;
        r = i * i + o * o > h;
      }
      f.mouse("drag");
    }
    function g() {
      zt(t.event.view).on("mousemove.drag mouseup.drag", null), jt(t.event.view, r), Ft(), f.mouse("end");
    }
    function y() {
      if (o.apply(this, arguments)) {
        var n,
          e,
          r = t.event.changedTouches,
          i = a.apply(this, arguments),
          u = r.length;
        for (n = 0; n < u; ++n) (e = m(r[n].identifier, i, Bt, this, arguments)) && (Yt(), e("start"));
      }
    }
    function _() {
      var n,
        e,
        r = t.event.changedTouches,
        i = r.length;
      for (n = 0; n < i; ++n) (e = f[r[n].identifier]) && (Ft(), e("drag"));
    }
    function b() {
      var n,
        e,
        r = t.event.changedTouches,
        o = r.length;
      for (i && clearTimeout(i), i = setTimeout(function () {
        i = null;
      }, 500), n = 0; n < o; ++n) (e = f[r[n].identifier]) && (Yt(), e("end"));
    }
    function m(n, e, r, i, o) {
      var a,
        c,
        h,
        p = r(e, n),
        v = s.copy();
      if (St(new Xt(d, "beforestart", a, n, l, p[0], p[1], 0, 0, v), function () {
        return null != (t.event.subject = a = u.apply(i, o)) && (c = a.x - p[0] || 0, h = a.y - p[1] || 0, !0);
      })) return function t(u) {
        var s,
          g = p;
        switch (u) {
          case "start":
            f[n] = t, s = l++;
            break;
          case "end":
            delete f[n], --l;
          case "drag":
            p = r(e, n), s = l;
        }
        St(new Xt(d, u, a, n, s, p[0] + c, p[1] + h, p[0] - g[0], p[1] - g[1], v), v.apply, v, [u, i, o]);
      };
    }
    return d.filter = function (t) {
      return arguments.length ? (o = "function" == typeof t ? t : Ht(!!t), d) : o;
    }, d.container = function (t) {
      return arguments.length ? (a = "function" == typeof t ? t : Ht(t), d) : a;
    }, d.subject = function (t) {
      return arguments.length ? (u = "function" == typeof t ? t : Ht(t), d) : u;
    }, d.touchable = function (t) {
      return arguments.length ? (c = "function" == typeof t ? t : Ht(!!t), d) : c;
    }, d.on = function () {
      var t = s.on.apply(s, arguments);
      return t === s ? d : t;
    }, d.clickDistance = function (t) {
      return arguments.length ? (h = (t = +t) * t, d) : Math.sqrt(h);
    }, d;
  }, t.dragDisable = It, t.dragEnable = jt, t.dsvFormat = Co, t.csvParse = zo, t.csvParseRows = Ro, t.csvFormat = Do, t.csvFormatBody = qo, t.csvFormatRows = Lo, t.tsvParse = Oo, t.tsvParseRows = Bo, t.tsvFormat = Yo, t.tsvFormatBody = Fo, t.tsvFormatRows = Io, t.autoType = function (t) {
    for (var n in t) {
      var e,
        r = t[n].trim();
      if (r) {
        if ("true" === r) r = !0;else if ("false" === r) r = !1;else if ("NaN" === r) r = NaN;else if (isNaN(e = +r)) {
          if (!/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/.test(r)) continue;
          r = new Date(r);
        } else r = e;
      } else r = null;
      t[n] = r;
    }
    return t;
  }, t.easeLinear = function (t) {
    return +t;
  }, t.easeQuad = Dr, t.easeQuadIn = function (t) {
    return t * t;
  }, t.easeQuadOut = function (t) {
    return t * (2 - t);
  }, t.easeQuadInOut = Dr, t.easeCubic = qr, t.easeCubicIn = function (t) {
    return t * t * t;
  }, t.easeCubicOut = function (t) {
    return --t * t * t + 1;
  }, t.easeCubicInOut = qr, t.easePoly = Or, t.easePolyIn = Lr, t.easePolyOut = Ur, t.easePolyInOut = Or, t.easeSin = Fr, t.easeSinIn = function (t) {
    return 1 - Math.cos(t * Yr);
  }, t.easeSinOut = function (t) {
    return Math.sin(t * Yr);
  }, t.easeSinInOut = Fr, t.easeExp = Ir, t.easeExpIn = function (t) {
    return Math.pow(2, 10 * t - 10);
  }, t.easeExpOut = function (t) {
    return 1 - Math.pow(2, -10 * t);
  }, t.easeExpInOut = Ir, t.easeCircle = jr, t.easeCircleIn = function (t) {
    return 1 - Math.sqrt(1 - t * t);
  }, t.easeCircleOut = function (t) {
    return Math.sqrt(1 - --t * t);
  }, t.easeCircleInOut = jr, t.easeBounce = ti, t.easeBounceIn = function (t) {
    return 1 - ti(1 - t);
  }, t.easeBounceOut = ti, t.easeBounceInOut = function (t) {
    return ((t *= 2) <= 1 ? 1 - ti(1 - t) : ti(t - 1) + 1) / 2;
  }, t.easeBack = ri, t.easeBackIn = ni, t.easeBackOut = ei, t.easeBackInOut = ri, t.easeElastic = ai, t.easeElasticIn = oi, t.easeElasticOut = ai, t.easeElasticInOut = ui, t.blob = function (t, n) {
    return fetch(t, n).then(jo);
  }, t.buffer = function (t, n) {
    return fetch(t, n).then(Ho);
  }, t.dsv = function (t, n, e, r) {
    3 === arguments.length && "function" == typeof e && (r = e, e = void 0);
    var i = Co(t);
    return Go(n, e).then(function (t) {
      return i.parse(t, r);
    });
  }, t.csv = $o, t.tsv = Wo, t.image = function (t, n) {
    return new Promise(function (e, r) {
      var i = new Image();
      for (var o in n) i[o] = n[o];
      i.onerror = r, i.onload = function () {
        e(i);
      }, i.src = t;
    });
  }, t.json = function (t, n) {
    return fetch(t, n).then(Zo);
  }, t.text = Go, t.xml = Jo, t.html = Ko, t.svg = ta, t.forceCenter = function (t, n) {
    var e;
    function r() {
      var r,
        i,
        o = e.length,
        a = 0,
        u = 0;
      for (r = 0; r < o; ++r) a += (i = e[r]).x, u += i.y;
      for (a = a / o - t, u = u / o - n, r = 0; r < o; ++r) (i = e[r]).x -= a, i.y -= u;
    }
    return null == t && (t = 0), null == n && (n = 0), r.initialize = function (t) {
      e = t;
    }, r.x = function (n) {
      return arguments.length ? (t = +n, r) : t;
    }, r.y = function (t) {
      return arguments.length ? (n = +t, r) : n;
    }, r;
  }, t.forceCollide = function (t) {
    var n,
      e,
      r = 1,
      i = 1;
    function o() {
      for (var t, o, u, c, f, s, l, h = n.length, d = 0; d < i; ++d) for (o = ua(n, la, ha).visitAfter(a), t = 0; t < h; ++t) u = n[t], s = e[u.index], l = s * s, c = u.x + u.vx, f = u.y + u.vy, o.visit(p);
      function p(t, n, e, i, o) {
        var a = t.data,
          h = t.r,
          d = s + h;
        if (!a) return n > c + d || i < c - d || e > f + d || o < f - d;
        if (a.index > u.index) {
          var p = c - a.x - a.vx,
            v = f - a.y - a.vy,
            g = p * p + v * v;
          g < d * d && (0 === p && (g += (p = ea()) * p), 0 === v && (g += (v = ea()) * v), g = (d - (g = Math.sqrt(g))) / g * r, u.vx += (p *= g) * (d = (h *= h) / (l + h)), u.vy += (v *= g) * d, a.vx -= p * (d = 1 - d), a.vy -= v * d);
        }
      }
    }
    function a(t) {
      if (t.data) return t.r = e[t.data.index];
      for (var n = t.r = 0; n < 4; ++n) t[n] && t[n].r > t.r && (t.r = t[n].r);
    }
    function u() {
      if (n) {
        var r,
          i,
          o = n.length;
        for (e = new Array(o), r = 0; r < o; ++r) i = n[r], e[i.index] = +t(i, r, n);
      }
    }
    return "function" != typeof t && (t = na(null == t ? 1 : +t)), o.initialize = function (t) {
      n = t, u();
    }, o.iterations = function (t) {
      return arguments.length ? (i = +t, o) : i;
    }, o.strength = function (t) {
      return arguments.length ? (r = +t, o) : r;
    }, o.radius = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : na(+n), u(), o) : t;
    }, o;
  }, t.forceLink = function (t) {
    var n,
      e,
      r,
      i,
      o,
      a = da,
      u = function u(t) {
        return 1 / Math.min(i[t.source.index], i[t.target.index]);
      },
      c = na(30),
      f = 1;
    function s(r) {
      for (var i = 0, a = t.length; i < f; ++i) for (var u, c, s, l, h, d, p, v = 0; v < a; ++v) c = (u = t[v]).source, l = (s = u.target).x + s.vx - c.x - c.vx || ea(), h = s.y + s.vy - c.y - c.vy || ea(), l *= d = ((d = Math.sqrt(l * l + h * h)) - e[v]) / d * r * n[v], h *= d, s.vx -= l * (p = o[v]), s.vy -= h * p, c.vx += l * (p = 1 - p), c.vy += h * p;
    }
    function l() {
      if (r) {
        var u,
          c,
          f = r.length,
          s = t.length,
          l = Ji(r, a);
        for (u = 0, i = new Array(f); u < s; ++u) (c = t[u]).index = u, "object" != _typeof(c.source) && (c.source = pa(l, c.source)), "object" != _typeof(c.target) && (c.target = pa(l, c.target)), i[c.source.index] = (i[c.source.index] || 0) + 1, i[c.target.index] = (i[c.target.index] || 0) + 1;
        for (u = 0, o = new Array(s); u < s; ++u) c = t[u], o[u] = i[c.source.index] / (i[c.source.index] + i[c.target.index]);
        n = new Array(s), h(), e = new Array(s), d();
      }
    }
    function h() {
      if (r) for (var e = 0, i = t.length; e < i; ++e) n[e] = +u(t[e], e, t);
    }
    function d() {
      if (r) for (var n = 0, i = t.length; n < i; ++n) e[n] = +c(t[n], n, t);
    }
    return null == t && (t = []), s.initialize = function (t) {
      r = t, l();
    }, s.links = function (n) {
      return arguments.length ? (t = n, l(), s) : t;
    }, s.id = function (t) {
      return arguments.length ? (a = t, s) : a;
    }, s.iterations = function (t) {
      return arguments.length ? (f = +t, s) : f;
    }, s.strength = function (t) {
      return arguments.length ? (u = "function" == typeof t ? t : na(+t), h(), s) : u;
    }, s.distance = function (t) {
      return arguments.length ? (c = "function" == typeof t ? t : na(+t), d(), s) : c;
    }, s;
  }, t.forceManyBody = function () {
    var t,
      n,
      e,
      r,
      i = na(-30),
      o = 1,
      a = 1 / 0,
      u = .81;
    function c(r) {
      var i,
        o = t.length,
        a = ua(t, va, ga).visitAfter(s);
      for (e = r, i = 0; i < o; ++i) n = t[i], a.visit(l);
    }
    function f() {
      if (t) {
        var n,
          e,
          o = t.length;
        for (r = new Array(o), n = 0; n < o; ++n) e = t[n], r[e.index] = +i(e, n, t);
      }
    }
    function s(t) {
      var n,
        e,
        i,
        o,
        a,
        u = 0,
        c = 0;
      if (t.length) {
        for (i = o = a = 0; a < 4; ++a) (n = t[a]) && (e = Math.abs(n.value)) && (u += n.value, c += e, i += e * n.x, o += e * n.y);
        t.x = i / c, t.y = o / c;
      } else {
        (n = t).x = n.data.x, n.y = n.data.y;
        do {
          u += r[n.data.index];
        } while (n = n.next);
      }
      t.value = u;
    }
    function l(t, i, c, f) {
      if (!t.value) return !0;
      var s = t.x - n.x,
        l = t.y - n.y,
        h = f - i,
        d = s * s + l * l;
      if (h * h / u < d) return d < a && (0 === s && (d += (s = ea()) * s), 0 === l && (d += (l = ea()) * l), d < o && (d = Math.sqrt(o * d)), n.vx += s * t.value * e / d, n.vy += l * t.value * e / d), !0;
      if (!(t.length || d >= a)) {
        (t.data !== n || t.next) && (0 === s && (d += (s = ea()) * s), 0 === l && (d += (l = ea()) * l), d < o && (d = Math.sqrt(o * d)));
        do {
          t.data !== n && (h = r[t.data.index] * e / d, n.vx += s * h, n.vy += l * h);
        } while (t = t.next);
      }
    }
    return c.initialize = function (n) {
      t = n, f();
    }, c.strength = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : na(+t), f(), c) : i;
    }, c.distanceMin = function (t) {
      return arguments.length ? (o = t * t, c) : Math.sqrt(o);
    }, c.distanceMax = function (t) {
      return arguments.length ? (a = t * t, c) : Math.sqrt(a);
    }, c.theta = function (t) {
      return arguments.length ? (u = t * t, c) : Math.sqrt(u);
    }, c;
  }, t.forceRadial = function (t, n, e) {
    var r,
      i,
      o,
      a = na(.1);
    function u(t) {
      for (var a = 0, u = r.length; a < u; ++a) {
        var c = r[a],
          f = c.x - n || 1e-6,
          s = c.y - e || 1e-6,
          l = Math.sqrt(f * f + s * s),
          h = (o[a] - l) * i[a] * t / l;
        c.vx += f * h, c.vy += s * h;
      }
    }
    function c() {
      if (r) {
        var n,
          e = r.length;
        for (i = new Array(e), o = new Array(e), n = 0; n < e; ++n) o[n] = +t(r[n], n, r), i[n] = isNaN(o[n]) ? 0 : +a(r[n], n, r);
      }
    }
    return "function" != typeof t && (t = na(+t)), null == n && (n = 0), null == e && (e = 0), u.initialize = function (t) {
      r = t, c();
    }, u.strength = function (t) {
      return arguments.length ? (a = "function" == typeof t ? t : na(+t), c(), u) : a;
    }, u.radius = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : na(+n), c(), u) : t;
    }, u.x = function (t) {
      return arguments.length ? (n = +t, u) : n;
    }, u.y = function (t) {
      return arguments.length ? (e = +t, u) : e;
    }, u;
  }, t.forceSimulation = function (t) {
    var n,
      e = 1,
      r = .001,
      i = 1 - Math.pow(r, 1 / 300),
      o = 0,
      a = .6,
      u = Ji(),
      c = or(s),
      f = I("tick", "end");
    function s() {
      l(), f.call("tick", n), e < r && (c.stop(), f.call("end", n));
    }
    function l(r) {
      var c,
        f,
        s = t.length;
      void 0 === r && (r = 1);
      for (var l = 0; l < r; ++l) for (e += (o - e) * i, u.each(function (t) {
        t(e);
      }), c = 0; c < s; ++c) null == (f = t[c]).fx ? f.x += f.vx *= a : (f.x = f.fx, f.vx = 0), null == f.fy ? f.y += f.vy *= a : (f.y = f.fy, f.vy = 0);
      return n;
    }
    function h() {
      for (var n, e = 0, r = t.length; e < r; ++e) {
        if ((n = t[e]).index = e, null != n.fx && (n.x = n.fx), null != n.fy && (n.y = n.fy), isNaN(n.x) || isNaN(n.y)) {
          var i = ya * Math.sqrt(e),
            o = e * _a;
          n.x = i * Math.cos(o), n.y = i * Math.sin(o);
        }
        (isNaN(n.vx) || isNaN(n.vy)) && (n.vx = n.vy = 0);
      }
    }
    function d(n) {
      return n.initialize && n.initialize(t), n;
    }
    return null == t && (t = []), h(), n = {
      tick: l,
      restart: function restart() {
        return c.restart(s), n;
      },
      stop: function stop() {
        return c.stop(), n;
      },
      nodes: function nodes(e) {
        return arguments.length ? (t = e, h(), u.each(d), n) : t;
      },
      alpha: function alpha(t) {
        return arguments.length ? (e = +t, n) : e;
      },
      alphaMin: function alphaMin(t) {
        return arguments.length ? (r = +t, n) : r;
      },
      alphaDecay: function alphaDecay(t) {
        return arguments.length ? (i = +t, n) : +i;
      },
      alphaTarget: function alphaTarget(t) {
        return arguments.length ? (o = +t, n) : o;
      },
      velocityDecay: function velocityDecay(t) {
        return arguments.length ? (a = 1 - t, n) : 1 - a;
      },
      force: function force(t, e) {
        return arguments.length > 1 ? (null == e ? u.remove(t) : u.set(t, d(e)), n) : u.get(t);
      },
      find: function find(n, e, r) {
        var i,
          o,
          a,
          u,
          c,
          f = 0,
          s = t.length;
        for (null == r ? r = 1 / 0 : r *= r, f = 0; f < s; ++f) (a = (i = n - (u = t[f]).x) * i + (o = e - u.y) * o) < r && (c = u, r = a);
        return c;
      },
      on: function on(t, e) {
        return arguments.length > 1 ? (f.on(t, e), n) : f.on(t);
      }
    };
  }, t.forceX = function (t) {
    var n,
      e,
      r,
      i = na(.1);
    function o(t) {
      for (var i, o = 0, a = n.length; o < a; ++o) (i = n[o]).vx += (r[o] - i.x) * e[o] * t;
    }
    function a() {
      if (n) {
        var o,
          a = n.length;
        for (e = new Array(a), r = new Array(a), o = 0; o < a; ++o) e[o] = isNaN(r[o] = +t(n[o], o, n)) ? 0 : +i(n[o], o, n);
      }
    }
    return "function" != typeof t && (t = na(null == t ? 0 : +t)), o.initialize = function (t) {
      n = t, a();
    }, o.strength = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : na(+t), a(), o) : i;
    }, o.x = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : na(+n), a(), o) : t;
    }, o;
  }, t.forceY = function (t) {
    var n,
      e,
      r,
      i = na(.1);
    function o(t) {
      for (var i, o = 0, a = n.length; o < a; ++o) (i = n[o]).vy += (r[o] - i.y) * e[o] * t;
    }
    function a() {
      if (n) {
        var o,
          a = n.length;
        for (e = new Array(a), r = new Array(a), o = 0; o < a; ++o) e[o] = isNaN(r[o] = +t(n[o], o, n)) ? 0 : +i(n[o], o, n);
      }
    }
    return "function" != typeof t && (t = na(null == t ? 0 : +t)), o.initialize = function (t) {
      n = t, a();
    }, o.strength = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : na(+t), a(), o) : i;
    }, o.y = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : na(+n), a(), o) : t;
    }, o;
  }, t.formatDefaultLocale = Pa, t.formatLocale = Ca, t.formatSpecifier = Ma, t.precisionFixed = za, t.precisionPrefix = Ra, t.precisionRound = Da, t.geoArea = function (t) {
    return xu.reset(), pu(t, wu), 2 * xu;
  }, t.geoBounds = function (t) {
    var n, e, r, i, o, a, u;
    if (Uu = Lu = -(Du = qu = 1 / 0), Iu = [], pu(t, uc), e = Iu.length) {
      for (Iu.sort(gc), n = 1, o = [r = Iu[0]]; n < e; ++n) yc(r, (i = Iu[n])[0]) || yc(r, i[1]) ? (vc(r[0], i[1]) > vc(r[0], r[1]) && (r[1] = i[1]), vc(i[0], r[1]) > vc(r[0], r[1]) && (r[0] = i[0])) : o.push(r = i);
      for (a = -1 / 0, n = 0, r = o[e = o.length - 1]; n <= e; r = i, ++n) i = o[n], (u = vc(r[1], i[0])) > a && (a = u, Du = i[0], Lu = r[1]);
    }
    return Iu = ju = null, Du === 1 / 0 || qu === 1 / 0 ? [[NaN, NaN], [NaN, NaN]] : [[Du, qu], [Lu, Uu]];
  }, t.geoCentroid = function (t) {
    Hu = Xu = Gu = Vu = $u = Wu = Zu = Qu = Ju = Ku = tc = 0, pu(t, _c);
    var n = Ju,
      e = Ku,
      r = tc,
      i = n * n + e * e + r * r;
    return i < Ya && (n = Wu, e = Zu, r = Qu, Xu < Ba && (n = Gu, e = Vu, r = $u), (i = n * n + e * e + r * r) < Ya) ? [NaN, NaN] : [Wa(e, n) * Xa, au(r / ru(i)) * Xa];
  }, t.geoCircle = function () {
    var t,
      n,
      e = Ec([0, 0]),
      r = Ec(90),
      i = Ec(6),
      o = {
        point: function point(e, r) {
          t.push(e = n(e, r)), e[0] *= Xa, e[1] *= Xa;
        }
      };
    function a() {
      var a = e.apply(this, arguments),
        u = r.apply(this, arguments) * Ga,
        c = i.apply(this, arguments) * Ga;
      return t = [], n = zc(-a[0] * Ga, -a[1] * Ga, 0).invert, Uc(o, u, c, 1), a = {
        type: "Polygon",
        coordinates: [t]
      }, t = n = null, a;
    }
    return a.center = function (t) {
      return arguments.length ? (e = "function" == typeof t ? t : Ec([+t[0], +t[1]]), a) : e;
    }, a.radius = function (t) {
      return arguments.length ? (r = "function" == typeof t ? t : Ec(+t), a) : r;
    }, a.precision = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : Ec(+t), a) : i;
    }, a;
  }, t.geoClipAntimeridian = Zc, t.geoClipCircle = Qc, t.geoClipExtent = function () {
    var t,
      n,
      e,
      r = 0,
      i = 0,
      o = 960,
      a = 500;
    return e = {
      stream: function stream(e) {
        return t && n === e ? t : t = tf(r, i, o, a)(n = e);
      },
      extent: function extent(u) {
        return arguments.length ? (r = +u[0][0], i = +u[0][1], o = +u[1][0], a = +u[1][1], t = n = null, e) : [[r, i], [o, a]];
      }
    };
  }, t.geoClipRectangle = tf, t.geoContains = function (t, n) {
    return (t && pf.hasOwnProperty(t.type) ? pf[t.type] : gf)(t, n);
  }, t.geoDistance = df, t.geoGraticule = Nf, t.geoGraticule10 = function () {
    return Nf()();
  }, t.geoInterpolate = function (t, n) {
    var e = t[0] * Ga,
      r = t[1] * Ga,
      i = n[0] * Ga,
      o = n[1] * Ga,
      a = Za(r),
      u = nu(r),
      c = Za(o),
      f = nu(o),
      s = a * Za(e),
      l = a * nu(e),
      h = c * Za(i),
      d = c * nu(i),
      p = 2 * au(ru(uu(o - r) + a * c * uu(i - e))),
      v = nu(p),
      g = p ? function (t) {
        var n = nu(t *= p) / v,
          e = nu(p - t) / v,
          r = e * s + n * h,
          i = e * l + n * d,
          o = e * u + n * f;
        return [Wa(i, r) * Xa, Wa(o, ru(r * r + i * i)) * Xa];
      } : function () {
        return [e * Xa, r * Xa];
      };
    return g.distance = p, g;
  }, t.geoLength = sf, t.geoPath = function (t, n) {
    var e,
      r,
      i = 4.5;
    function o(t) {
      return t && ("function" == typeof i && r.pointRadius(+i.apply(this, arguments)), pu(t, e(r))), r.result();
    }
    return o.area = function (t) {
      return pu(t, e(zf)), zf.result();
    }, o.measure = function (t) {
      return pu(t, e(_s)), _s.result();
    }, o.bounds = function (t) {
      return pu(t, e(Ff)), Ff.result();
    }, o.centroid = function (t) {
      return pu(t, e(ns)), ns.result();
    }, o.projection = function (n) {
      return arguments.length ? (e = null == n ? (t = null, Af) : (t = n).stream, o) : t;
    }, o.context = function (t) {
      return arguments.length ? (r = null == t ? (n = null, new xs()) : new ls(n = t), "function" != typeof i && r.pointRadius(i), o) : n;
    }, o.pointRadius = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : (r.pointRadius(+t), +t), o) : i;
    }, o.projection(t).context(n);
  }, t.geoAlbers = Ys, t.geoAlbersUsa = function () {
    var t,
      n,
      e,
      r,
      i,
      o,
      a = Ys(),
      u = Bs().rotate([154, 0]).center([-2, 58.5]).parallels([55, 65]),
      c = Bs().rotate([157, 0]).center([-3, 19.9]).parallels([8, 18]),
      f = {
        point: function point(t, n) {
          o = [t, n];
        }
      };
    function s(t) {
      var n = t[0],
        a = t[1];
      return o = null, e.point(n, a), o || (r.point(n, a), o) || (i.point(n, a), o);
    }
    function l() {
      return t = n = null, s;
    }
    return s.invert = function (t) {
      var n = a.scale(),
        e = a.translate(),
        r = (t[0] - e[0]) / n,
        i = (t[1] - e[1]) / n;
      return (i >= .12 && i < .234 && r >= -.425 && r < -.214 ? u : i >= .166 && i < .234 && r >= -.214 && r < -.115 ? c : a).invert(t);
    }, s.stream = function (e) {
      return t && n === e ? t : (r = [a.stream(n = e), u.stream(e), c.stream(e)], i = r.length, t = {
        point: function point(t, n) {
          for (var e = -1; ++e < i;) r[e].point(t, n);
        },
        sphere: function sphere() {
          for (var t = -1; ++t < i;) r[t].sphere();
        },
        lineStart: function lineStart() {
          for (var t = -1; ++t < i;) r[t].lineStart();
        },
        lineEnd: function lineEnd() {
          for (var t = -1; ++t < i;) r[t].lineEnd();
        },
        polygonStart: function polygonStart() {
          for (var t = -1; ++t < i;) r[t].polygonStart();
        },
        polygonEnd: function polygonEnd() {
          for (var t = -1; ++t < i;) r[t].polygonEnd();
        }
      });
      var r, i;
    }, s.precision = function (t) {
      return arguments.length ? (a.precision(t), u.precision(t), c.precision(t), l()) : a.precision();
    }, s.scale = function (t) {
      return arguments.length ? (a.scale(t), u.scale(.35 * t), c.scale(t), s.translate(a.translate())) : a.scale();
    }, s.translate = function (t) {
      if (!arguments.length) return a.translate();
      var n = a.scale(),
        o = +t[0],
        s = +t[1];
      return e = a.translate(t).clipExtent([[o - .455 * n, s - .238 * n], [o + .455 * n, s + .238 * n]]).stream(f), r = u.translate([o - .307 * n, s + .201 * n]).clipExtent([[o - .425 * n + Ba, s + .12 * n + Ba], [o - .214 * n - Ba, s + .234 * n - Ba]]).stream(f), i = c.translate([o - .205 * n, s + .212 * n]).clipExtent([[o - .214 * n + Ba, s + .166 * n + Ba], [o - .115 * n - Ba, s + .234 * n - Ba]]).stream(f), l();
    }, s.fitExtent = function (t, n) {
      return Ts(s, t, n);
    }, s.fitSize = function (t, n) {
      return Ss(s, t, n);
    }, s.fitWidth = function (t, n) {
      return ks(s, t, n);
    }, s.fitHeight = function (t, n) {
      return Es(s, t, n);
    }, s.scale(1070);
  }, t.geoAzimuthalEqualArea = function () {
    return qs(js).scale(124.75).clipAngle(179.999);
  }, t.geoAzimuthalEqualAreaRaw = js, t.geoAzimuthalEquidistant = function () {
    return qs(Hs).scale(79.4188).clipAngle(179.999);
  }, t.geoAzimuthalEquidistantRaw = Hs, t.geoConicConformal = function () {
    return Us($s).scale(109.5).parallels([30, 30]);
  }, t.geoConicConformalRaw = $s, t.geoConicEqualArea = Bs, t.geoConicEqualAreaRaw = Os, t.geoConicEquidistant = function () {
    return Us(Zs).scale(131.154).center([0, 13.9389]);
  }, t.geoConicEquidistantRaw = Zs, t.geoEqualEarth = function () {
    return qs(el).scale(177.158);
  }, t.geoEqualEarthRaw = el, t.geoEquirectangular = function () {
    return qs(Ws).scale(152.63);
  }, t.geoEquirectangularRaw = Ws, t.geoGnomonic = function () {
    return qs(rl).scale(144.049).clipAngle(60);
  }, t.geoGnomonicRaw = rl, t.geoIdentity = function () {
    var t,
      n,
      e,
      r,
      i,
      o,
      a = 1,
      u = 0,
      c = 0,
      f = 1,
      s = 1,
      l = Af,
      h = null,
      d = Af;
    function p() {
      return r = i = null, o;
    }
    return o = {
      stream: function stream(t) {
        return r && i === t ? r : r = l(d(i = t));
      },
      postclip: function postclip(r) {
        return arguments.length ? (d = r, h = t = n = e = null, p()) : d;
      },
      clipExtent: function clipExtent(r) {
        return arguments.length ? (d = null == r ? (h = t = n = e = null, Af) : tf(h = +r[0][0], t = +r[0][1], n = +r[1][0], e = +r[1][1]), p()) : null == h ? null : [[h, t], [n, e]];
      },
      scale: function scale(t) {
        return arguments.length ? (l = il((a = +t) * f, a * s, u, c), p()) : a;
      },
      translate: function translate(t) {
        return arguments.length ? (l = il(a * f, a * s, u = +t[0], c = +t[1]), p()) : [u, c];
      },
      reflectX: function reflectX(t) {
        return arguments.length ? (l = il(a * (f = t ? -1 : 1), a * s, u, c), p()) : f < 0;
      },
      reflectY: function reflectY(t) {
        return arguments.length ? (l = il(a * f, a * (s = t ? -1 : 1), u, c), p()) : s < 0;
      },
      fitExtent: function fitExtent(t, n) {
        return Ts(o, t, n);
      },
      fitSize: function fitSize(t, n) {
        return Ss(o, t, n);
      },
      fitWidth: function fitWidth(t, n) {
        return ks(o, t, n);
      },
      fitHeight: function fitHeight(t, n) {
        return Es(o, t, n);
      }
    };
  }, t.geoProjection = qs, t.geoProjectionMutator = Ls, t.geoMercator = function () {
    return Gs(Xs).scale(961 / Ha);
  }, t.geoMercatorRaw = Xs, t.geoNaturalEarth1 = function () {
    return qs(ol).scale(175.295);
  }, t.geoNaturalEarth1Raw = ol, t.geoOrthographic = function () {
    return qs(al).scale(249.5).clipAngle(90 + Ba);
  }, t.geoOrthographicRaw = al, t.geoStereographic = function () {
    return qs(ul).scale(250).clipAngle(142);
  }, t.geoStereographicRaw = ul, t.geoTransverseMercator = function () {
    var t = Gs(cl),
      n = t.center,
      e = t.rotate;
    return t.center = function (t) {
      return arguments.length ? n([-t[1], t[0]]) : [(t = n())[1], -t[0]];
    }, t.rotate = function (t) {
      return arguments.length ? e([t[0], t[1], t.length > 2 ? t[2] + 90 : 90]) : [(t = e())[0], t[1], t[2] - 90];
    }, e([0, 0, 90]).scale(159.155);
  }, t.geoTransverseMercatorRaw = cl, t.geoRotation = Lc, t.geoStream = pu, t.geoTransform = function (t) {
    return {
      stream: Ms(t)
    };
  }, t.cluster = function () {
    var t = fl,
      n = 1,
      e = 1,
      r = !1;
    function i(i) {
      var o,
        a = 0;
      i.eachAfter(function (n) {
        var e = n.children;
        e ? (n.x = function (t) {
          return t.reduce(sl, 0) / t.length;
        }(e), n.y = function (t) {
          return 1 + t.reduce(ll, 0);
        }(e)) : (n.x = o ? a += t(n, o) : 0, n.y = 0, o = n);
      });
      var u = function (t) {
          for (var n; n = t.children;) t = n[0];
          return t;
        }(i),
        c = function (t) {
          for (var n; n = t.children;) t = n[n.length - 1];
          return t;
        }(i),
        f = u.x - t(u, c) / 2,
        s = c.x + t(c, u) / 2;
      return i.eachAfter(r ? function (t) {
        t.x = (t.x - i.x) * n, t.y = (i.y - t.y) * e;
      } : function (t) {
        t.x = (t.x - f) / (s - f) * n, t.y = (1 - (i.y ? t.y / i.y : 1)) * e;
      });
    }
    return i.separation = function (n) {
      return arguments.length ? (t = n, i) : t;
    }, i.size = function (t) {
      return arguments.length ? (r = !1, n = +t[0], e = +t[1], i) : r ? null : [n, e];
    }, i.nodeSize = function (t) {
      return arguments.length ? (r = !0, n = +t[0], e = +t[1], i) : r ? [n, e] : null;
    }, i;
  }, t.hierarchy = dl, t.pack = function () {
    var t = null,
      n = 1,
      e = 1,
      r = Rl;
    function i(i) {
      return i.x = n / 2, i.y = e / 2, t ? i.eachBefore(Ll(t)).eachAfter(Ul(r, .5)).eachBefore(Ol(1)) : i.eachBefore(Ll(ql)).eachAfter(Ul(Rl, 1)).eachAfter(Ul(r, i.r / Math.min(n, e))).eachBefore(Ol(Math.min(n, e) / (2 * i.r))), i;
    }
    return i.radius = function (n) {
      return arguments.length ? (t = null == (e = n) ? null : zl(e), i) : t;
      var e;
    }, i.size = function (t) {
      return arguments.length ? (n = +t[0], e = +t[1], i) : [n, e];
    }, i.padding = function (t) {
      return arguments.length ? (r = "function" == typeof t ? t : Dl(+t), i) : r;
    }, i;
  }, t.packSiblings = function (t) {
    return Pl(t), t;
  }, t.packEnclose = bl, t.partition = function () {
    var t = 1,
      n = 1,
      e = 0,
      r = !1;
    function i(i) {
      var o = i.height + 1;
      return i.x0 = i.y0 = e, i.x1 = t, i.y1 = n / o, i.eachBefore(function (t, n) {
        return function (r) {
          r.children && Yl(r, r.x0, t * (r.depth + 1) / n, r.x1, t * (r.depth + 2) / n);
          var i = r.x0,
            o = r.y0,
            a = r.x1 - e,
            u = r.y1 - e;
          a < i && (i = a = (i + a) / 2), u < o && (o = u = (o + u) / 2), r.x0 = i, r.y0 = o, r.x1 = a, r.y1 = u;
        };
      }(n, o)), r && i.eachBefore(Bl), i;
    }
    return i.round = function (t) {
      return arguments.length ? (r = !!t, i) : r;
    }, i.size = function (e) {
      return arguments.length ? (t = +e[0], n = +e[1], i) : [t, n];
    }, i.padding = function (t) {
      return arguments.length ? (e = +t, i) : e;
    }, i;
  }, t.stratify = function () {
    var t = Hl,
      n = Xl;
    function e(e) {
      var r,
        i,
        o,
        a,
        u,
        c,
        f,
        s = e.length,
        l = new Array(s),
        h = {};
      for (i = 0; i < s; ++i) r = e[i], u = l[i] = new yl(r), null != (c = t(r, i, e)) && (c += "") && (h[f = Fl + (u.id = c)] = f in h ? jl : u);
      for (i = 0; i < s; ++i) if (u = l[i], null != (c = n(e[i], i, e)) && (c += "")) {
        if (!(a = h[Fl + c])) throw new Error("missing: " + c);
        if (a === jl) throw new Error("ambiguous: " + c);
        a.children ? a.children.push(u) : a.children = [u], u.parent = a;
      } else {
        if (o) throw new Error("multiple roots");
        o = u;
      }
      if (!o) throw new Error("no root");
      if (o.parent = Il, o.eachBefore(function (t) {
        t.depth = t.parent.depth + 1, --s;
      }).eachBefore(gl), o.parent = null, s > 0) throw new Error("cycle");
      return o;
    }
    return e.id = function (n) {
      return arguments.length ? (t = zl(n), e) : t;
    }, e.parentId = function (t) {
      return arguments.length ? (n = zl(t), e) : n;
    }, e;
  }, t.tree = function () {
    var t = Gl,
      n = 1,
      e = 1,
      r = null;
    function i(i) {
      var c = function (t) {
        for (var n, e, r, i, o, a = new Ql(t, 0), u = [a]; n = u.pop();) if (r = n._.children) for (n.children = new Array(o = r.length), i = o - 1; i >= 0; --i) u.push(e = n.children[i] = new Ql(r[i], i)), e.parent = n;
        return (a.parent = new Ql(null, 0)).children = [a], a;
      }(i);
      if (c.eachAfter(o), c.parent.m = -c.z, c.eachBefore(a), r) i.eachBefore(u);else {
        var f = i,
          s = i,
          l = i;
        i.eachBefore(function (t) {
          t.x < f.x && (f = t), t.x > s.x && (s = t), t.depth > l.depth && (l = t);
        });
        var h = f === s ? 1 : t(f, s) / 2,
          d = h - f.x,
          p = n / (s.x + h + d),
          v = e / (l.depth || 1);
        i.eachBefore(function (t) {
          t.x = (t.x + d) * p, t.y = t.depth * v;
        });
      }
      return i;
    }
    function o(n) {
      var e = n.children,
        r = n.parent.children,
        i = n.i ? r[n.i - 1] : null;
      if (e) {
        !function (t) {
          for (var n, e = 0, r = 0, i = t.children, o = i.length; --o >= 0;) (n = i[o]).z += e, n.m += e, e += n.s + (r += n.c);
        }(n);
        var o = (e[0].z + e[e.length - 1].z) / 2;
        i ? (n.z = i.z + t(n._, i._), n.m = n.z - o) : n.z = o;
      } else i && (n.z = i.z + t(n._, i._));
      n.parent.A = function (n, e, r) {
        if (e) {
          for (var i, o = n, a = n, u = e, c = o.parent.children[0], f = o.m, s = a.m, l = u.m, h = c.m; u = $l(u), o = Vl(o), u && o;) c = Vl(c), (a = $l(a)).a = n, (i = u.z + l - o.z - f + t(u._, o._)) > 0 && (Wl(Zl(u, n, r), n, i), f += i, s += i), l += u.m, f += o.m, h += c.m, s += a.m;
          u && !$l(a) && (a.t = u, a.m += l - s), o && !Vl(c) && (c.t = o, c.m += f - h, r = n);
        }
        return r;
      }(n, i, n.parent.A || r[0]);
    }
    function a(t) {
      t._.x = t.z + t.parent.m, t.m += t.parent.m;
    }
    function u(t) {
      t.x *= n, t.y = t.depth * e;
    }
    return i.separation = function (n) {
      return arguments.length ? (t = n, i) : t;
    }, i.size = function (t) {
      return arguments.length ? (r = !1, n = +t[0], e = +t[1], i) : r ? null : [n, e];
    }, i.nodeSize = function (t) {
      return arguments.length ? (r = !0, n = +t[0], e = +t[1], i) : r ? [n, e] : null;
    }, i;
  }, t.treemap = function () {
    var t = nh,
      n = !1,
      e = 1,
      r = 1,
      i = [0],
      o = Rl,
      a = Rl,
      u = Rl,
      c = Rl,
      f = Rl;
    function s(t) {
      return t.x0 = t.y0 = 0, t.x1 = e, t.y1 = r, t.eachBefore(l), i = [0], n && t.eachBefore(Bl), t;
    }
    function l(n) {
      var e = i[n.depth],
        r = n.x0 + e,
        s = n.y0 + e,
        l = n.x1 - e,
        h = n.y1 - e;
      l < r && (r = l = (r + l) / 2), h < s && (s = h = (s + h) / 2), n.x0 = r, n.y0 = s, n.x1 = l, n.y1 = h, n.children && (e = i[n.depth + 1] = o(n) / 2, r += f(n) - e, s += a(n) - e, (l -= u(n) - e) < r && (r = l = (r + l) / 2), (h -= c(n) - e) < s && (s = h = (s + h) / 2), t(n, r, s, l, h));
    }
    return s.round = function (t) {
      return arguments.length ? (n = !!t, s) : n;
    }, s.size = function (t) {
      return arguments.length ? (e = +t[0], r = +t[1], s) : [e, r];
    }, s.tile = function (n) {
      return arguments.length ? (t = zl(n), s) : t;
    }, s.padding = function (t) {
      return arguments.length ? s.paddingInner(t).paddingOuter(t) : s.paddingInner();
    }, s.paddingInner = function (t) {
      return arguments.length ? (o = "function" == typeof t ? t : Dl(+t), s) : o;
    }, s.paddingOuter = function (t) {
      return arguments.length ? s.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t) : s.paddingTop();
    }, s.paddingTop = function (t) {
      return arguments.length ? (a = "function" == typeof t ? t : Dl(+t), s) : a;
    }, s.paddingRight = function (t) {
      return arguments.length ? (u = "function" == typeof t ? t : Dl(+t), s) : u;
    }, s.paddingBottom = function (t) {
      return arguments.length ? (c = "function" == typeof t ? t : Dl(+t), s) : c;
    }, s.paddingLeft = function (t) {
      return arguments.length ? (f = "function" == typeof t ? t : Dl(+t), s) : f;
    }, s;
  }, t.treemapBinary = function (t, n, e, r, i) {
    var o,
      a,
      u = t.children,
      c = u.length,
      f = new Array(c + 1);
    for (f[0] = a = o = 0; o < c; ++o) f[o + 1] = a += u[o].value;
    !function t(n, e, r, i, o, a, c) {
      if (n >= e - 1) {
        var s = u[n];
        return s.x0 = i, s.y0 = o, s.x1 = a, void (s.y1 = c);
      }
      for (var l = f[n], h = r / 2 + l, d = n + 1, p = e - 1; d < p;) {
        var v = d + p >>> 1;
        f[v] < h ? d = v + 1 : p = v;
      }
      h - f[d - 1] < f[d] - h && n + 1 < d && --d;
      var g = f[d] - l,
        y = r - g;
      if (a - i > c - o) {
        var _ = (i * y + a * g) / r;
        t(n, d, g, i, o, _, c), t(d, e, y, _, o, a, c);
      } else {
        var b = (o * y + c * g) / r;
        t(n, d, g, i, o, a, b), t(d, e, y, i, b, a, c);
      }
    }(0, c, t.value, n, e, r, i);
  }, t.treemapDice = Yl, t.treemapSlice = Jl, t.treemapSliceDice = function (t, n, e, r, i) {
    (1 & t.depth ? Jl : Yl)(t, n, e, r, i);
  }, t.treemapSquarify = nh, t.treemapResquarify = eh, t.interpolate = _e, t.interpolateArray = le, t.interpolateBasis = te, t.interpolateBasisClosed = ne, t.interpolateDate = he, t.interpolateDiscrete = function (t) {
    var n = t.length;
    return function (e) {
      return t[Math.max(0, Math.min(n - 1, Math.floor(e * n)))];
    };
  }, t.interpolateHue = function (t, n) {
    var e = ie(+t, +n);
    return function (t) {
      var n = e(t);
      return n - 360 * Math.floor(n / 360);
    };
  }, t.interpolateNumber = de, t.interpolateObject = pe, t.interpolateRound = be, t.interpolateString = ye, t.interpolateTransformCss = ke, t.interpolateTransformSvg = Ee, t.interpolateZoom = qe, t.interpolateRgb = ue, t.interpolateRgbBasis = fe, t.interpolateRgbBasisClosed = se, t.interpolateHsl = Ue, t.interpolateHslLong = Oe, t.interpolateLab = function (t, n) {
    var e = ae((t = Rn(t)).l, (n = Rn(n)).l),
      r = ae(t.a, n.a),
      i = ae(t.b, n.b),
      o = ae(t.opacity, n.opacity);
    return function (n) {
      return t.l = e(n), t.a = r(n), t.b = i(n), t.opacity = o(n), t + "";
    };
  }, t.interpolateHcl = Ye, t.interpolateHclLong = Fe, t.interpolateCubehelix = je, t.interpolateCubehelixLong = He, t.piecewise = function (t, n) {
    for (var e = 0, r = n.length - 1, i = n[0], o = new Array(r < 0 ? 0 : r); e < r;) o[e] = t(i, i = n[++e]);
    return function (t) {
      var n = Math.max(0, Math.min(r - 1, Math.floor(t *= r)));
      return o[n](t - n);
    };
  }, t.quantize = function (t, n) {
    for (var e = new Array(n), r = 0; r < n; ++r) e[r] = t(r / (n - 1));
    return e;
  }, t.path = Xi, t.polygonArea = function (t) {
    for (var n, e = -1, r = t.length, i = t[r - 1], o = 0; ++e < r;) n = i, i = t[e], o += n[1] * i[0] - n[0] * i[1];
    return o / 2;
  }, t.polygonCentroid = function (t) {
    for (var n, e, r = -1, i = t.length, o = 0, a = 0, u = t[i - 1], c = 0; ++r < i;) n = u, u = t[r], c += e = n[0] * u[1] - u[0] * n[1], o += (n[0] + u[0]) * e, a += (n[1] + u[1]) * e;
    return [o / (c *= 3), a / c];
  }, t.polygonHull = function (t) {
    if ((e = t.length) < 3) return null;
    var n,
      e,
      r = new Array(e),
      i = new Array(e);
    for (n = 0; n < e; ++n) r[n] = [+t[n][0], +t[n][1], n];
    for (r.sort(rh), n = 0; n < e; ++n) i[n] = [r[n][0], -r[n][1]];
    var o = ih(r),
      a = ih(i),
      u = a[0] === o[0],
      c = a[a.length - 1] === o[o.length - 1],
      f = [];
    for (n = o.length - 1; n >= 0; --n) f.push(t[r[o[n]][2]]);
    for (n = +u; n < a.length - c; ++n) f.push(t[r[a[n]][2]]);
    return f;
  }, t.polygonContains = function (t, n) {
    for (var e, r, i = t.length, o = t[i - 1], a = n[0], u = n[1], c = o[0], f = o[1], s = !1, l = 0; l < i; ++l) e = (o = t[l])[0], (r = o[1]) > u != f > u && a < (c - e) * (u - r) / (f - r) + e && (s = !s), c = e, f = r;
    return s;
  }, t.polygonLength = function (t) {
    for (var n, e, r = -1, i = t.length, o = t[i - 1], a = o[0], u = o[1], c = 0; ++r < i;) n = a, e = u, n -= a = (o = t[r])[0], e -= u = o[1], c += Math.sqrt(n * n + e * e);
    return c;
  }, t.quadtree = ua, t.randomUniform = ah, t.randomNormal = uh, t.randomLogNormal = ch, t.randomBates = sh, t.randomIrwinHall = fh, t.randomExponential = lh, t.scaleBand = bh, t.scalePoint = function () {
    return function t(n) {
      var e = n.copy;
      return n.padding = n.paddingOuter, delete n.paddingInner, delete n.paddingOuter, n.copy = function () {
        return t(e());
      }, n;
    }(bh.apply(null, arguments).paddingInner(1));
  }, t.scaleIdentity = function t(n) {
    var e;
    function r(t) {
      return isNaN(t = +t) ? e : t;
    }
    return r.invert = r, r.domain = r.range = function (t) {
      return arguments.length ? (n = vh.call(t, mh), r) : n.slice();
    }, r.unknown = function (t) {
      return arguments.length ? (e = t, r) : e;
    }, r.copy = function () {
      return t(n).unknown(e);
    }, n = arguments.length ? vh.call(n, mh) : [0, 1], Ph(r);
  }, t.scaleLinear = function t() {
    var n = Eh(wh, wh);
    return n.copy = function () {
      return Sh(n, t());
    }, hh.apply(n, arguments), Ph(n);
  }, t.scaleLog = function t() {
    var n = Bh(kh()).domain([1, 10]);
    return n.copy = function () {
      return Sh(n, t()).base(n.base());
    }, hh.apply(n, arguments), n;
  }, t.scaleSymlog = function t() {
    var n = Ih(kh());
    return n.copy = function () {
      return Sh(n, t()).constant(n.constant());
    }, hh.apply(n, arguments);
  }, t.scaleOrdinal = _h, t.scaleImplicit = yh, t.scalePow = Vh, t.scaleSqrt = function () {
    return Vh.apply(null, arguments).exponent(.5);
  }, t.scaleQuantile = function t() {
    var e,
      r = [],
      o = [],
      a = [];
    function u() {
      var t = 0,
        n = Math.max(1, o.length);
      for (a = new Array(n - 1); ++t < n;) a[t - 1] = N(r, t / n);
      return c;
    }
    function c(t) {
      return isNaN(t = +t) ? e : o[i(a, t)];
    }
    return c.invertExtent = function (t) {
      var n = o.indexOf(t);
      return n < 0 ? [NaN, NaN] : [n > 0 ? a[n - 1] : r[0], n < a.length ? a[n] : r[r.length - 1]];
    }, c.domain = function (t) {
      if (!arguments.length) return r.slice();
      r = [];
      for (var e, i = 0, o = t.length; i < o; ++i) null == (e = t[i]) || isNaN(e = +e) || r.push(e);
      return r.sort(n), u();
    }, c.range = function (t) {
      return arguments.length ? (o = gh.call(t), u()) : o.slice();
    }, c.unknown = function (t) {
      return arguments.length ? (e = t, c) : e;
    }, c.quantiles = function () {
      return a.slice();
    }, c.copy = function () {
      return t().domain(r).range(o).unknown(e);
    }, hh.apply(c, arguments);
  }, t.scaleQuantize = function t() {
    var n,
      e = 0,
      r = 1,
      o = 1,
      a = [.5],
      u = [0, 1];
    function c(t) {
      return t <= t ? u[i(a, t, 0, o)] : n;
    }
    function f() {
      var t = -1;
      for (a = new Array(o); ++t < o;) a[t] = ((t + 1) * r - (t - o) * e) / (o + 1);
      return c;
    }
    return c.domain = function (t) {
      return arguments.length ? (e = +t[0], r = +t[1], f()) : [e, r];
    }, c.range = function (t) {
      return arguments.length ? (o = (u = gh.call(t)).length - 1, f()) : u.slice();
    }, c.invertExtent = function (t) {
      var n = u.indexOf(t);
      return n < 0 ? [NaN, NaN] : n < 1 ? [e, a[0]] : n >= o ? [a[o - 1], r] : [a[n - 1], a[n]];
    }, c.unknown = function (t) {
      return arguments.length ? (n = t, c) : c;
    }, c.thresholds = function () {
      return a.slice();
    }, c.copy = function () {
      return t().domain([e, r]).range(u).unknown(n);
    }, hh.apply(Ph(c), arguments);
  }, t.scaleThreshold = function t() {
    var n,
      e = [.5],
      r = [0, 1],
      o = 1;
    function a(t) {
      return t <= t ? r[i(e, t, 0, o)] : n;
    }
    return a.domain = function (t) {
      return arguments.length ? (e = gh.call(t), o = Math.min(e.length, r.length - 1), a) : e.slice();
    }, a.range = function (t) {
      return arguments.length ? (r = gh.call(t), o = Math.min(e.length, r.length - 1), a) : r.slice();
    }, a.invertExtent = function (t) {
      var n = r.indexOf(t);
      return [e[n - 1], e[n]];
    }, a.unknown = function (t) {
      return arguments.length ? (n = t, a) : n;
    }, a.copy = function () {
      return t().domain(e).range(r).unknown(n);
    }, hh.apply(a, arguments);
  }, t.scaleTime = function () {
    return hh.apply(Tv(Td, Nd, sd, ud, od, rd, nd, Qh, t.timeFormat).domain([new Date(2e3, 0, 1), new Date(2e3, 0, 2)]), arguments);
  }, t.scaleUtc = function () {
    return hh.apply(Tv(Qd, Wd, qd, zd, Cd, kd, nd, Qh, t.utcFormat).domain([Date.UTC(2e3, 0, 1), Date.UTC(2e3, 0, 2)]), arguments);
  }, t.scaleSequential = function t() {
    var n = Ph(Sv()(wh));
    return n.copy = function () {
      return kv(n, t());
    }, dh.apply(n, arguments);
  }, t.scaleSequentialLog = function t() {
    var n = Bh(Sv()).domain([1, 10]);
    return n.copy = function () {
      return kv(n, t()).base(n.base());
    }, dh.apply(n, arguments);
  }, t.scaleSequentialPow = Ev, t.scaleSequentialSqrt = function () {
    return Ev.apply(null, arguments).exponent(.5);
  }, t.scaleSequentialSymlog = function t() {
    var n = Ih(Sv());
    return n.copy = function () {
      return kv(n, t()).constant(n.constant());
    }, dh.apply(n, arguments);
  }, t.scaleSequentialQuantile = function t() {
    var e = [],
      r = wh;
    function o(t) {
      if (!isNaN(t = +t)) return r((i(e, t) - 1) / (e.length - 1));
    }
    return o.domain = function (t) {
      if (!arguments.length) return e.slice();
      e = [];
      for (var r, i = 0, a = t.length; i < a; ++i) null == (r = t[i]) || isNaN(r = +r) || e.push(r);
      return e.sort(n), o;
    }, o.interpolator = function (t) {
      return arguments.length ? (r = t, o) : r;
    }, o.copy = function () {
      return t(r).domain(e);
    }, dh.apply(o, arguments);
  }, t.scaleDiverging = function t() {
    var n = Ph(Cv()(wh));
    return n.copy = function () {
      return kv(n, t());
    }, dh.apply(n, arguments);
  }, t.scaleDivergingLog = function t() {
    var n = Bh(Cv()).domain([.1, 1, 10]);
    return n.copy = function () {
      return kv(n, t()).base(n.base());
    }, dh.apply(n, arguments);
  }, t.scaleDivergingPow = Pv, t.scaleDivergingSqrt = function () {
    return Pv.apply(null, arguments).exponent(.5);
  }, t.scaleDivergingSymlog = function t() {
    var n = Ih(Cv());
    return n.copy = function () {
      return kv(n, t()).constant(n.constant());
    }, dh.apply(n, arguments);
  }, t.tickFormat = Ch, t.schemeCategory10 = Rv, t.schemeAccent = Dv, t.schemeDark2 = qv, t.schemePaired = Lv, t.schemePastel1 = Uv, t.schemePastel2 = Ov, t.schemeSet1 = Bv, t.schemeSet2 = Yv, t.schemeSet3 = Fv, t.interpolateBrBG = Hv, t.schemeBrBG = jv, t.interpolatePRGn = Gv, t.schemePRGn = Xv, t.interpolatePiYG = $v, t.schemePiYG = Vv, t.interpolatePuOr = Zv, t.schemePuOr = Wv, t.interpolateRdBu = Jv, t.schemeRdBu = Qv, t.interpolateRdGy = tg, t.schemeRdGy = Kv, t.interpolateRdYlBu = eg, t.schemeRdYlBu = ng, t.interpolateRdYlGn = ig, t.schemeRdYlGn = rg, t.interpolateSpectral = ag, t.schemeSpectral = og, t.interpolateBuGn = cg, t.schemeBuGn = ug, t.interpolateBuPu = sg, t.schemeBuPu = fg, t.interpolateGnBu = hg, t.schemeGnBu = lg, t.interpolateOrRd = pg, t.schemeOrRd = dg, t.interpolatePuBuGn = gg, t.schemePuBuGn = vg, t.interpolatePuBu = _g, t.schemePuBu = yg, t.interpolatePuRd = mg, t.schemePuRd = bg, t.interpolateRdPu = wg, t.schemeRdPu = xg, t.interpolateYlGnBu = Ng, t.schemeYlGnBu = Mg, t.interpolateYlGn = Tg, t.schemeYlGn = Ag, t.interpolateYlOrBr = kg, t.schemeYlOrBr = Sg, t.interpolateYlOrRd = Cg, t.schemeYlOrRd = Eg, t.interpolateBlues = zg, t.schemeBlues = Pg, t.interpolateGreens = Dg, t.schemeGreens = Rg, t.interpolateGreys = Lg, t.schemeGreys = qg, t.interpolatePurples = Og, t.schemePurples = Ug, t.interpolateReds = Yg, t.schemeReds = Bg, t.interpolateOranges = Ig, t.schemeOranges = Fg, t.interpolateCubehelixDefault = jg, t.interpolateRainbow = function (t) {
    (t < 0 || t > 1) && (t -= Math.floor(t));
    var n = Math.abs(t - .5);
    return Gg.h = 360 * t - 100, Gg.s = 1.5 - 1.5 * n, Gg.l = .8 - .9 * n, Gg + "";
  }, t.interpolateWarm = Hg, t.interpolateCool = Xg, t.interpolateSinebow = function (t) {
    var n;
    return t = (.5 - t) * Math.PI, Vg.r = 255 * (n = Math.sin(t)) * n, Vg.g = 255 * (n = Math.sin(t + $g)) * n, Vg.b = 255 * (n = Math.sin(t + Wg)) * n, Vg + "";
  }, t.interpolateViridis = Qg, t.interpolateMagma = Jg, t.interpolateInferno = Kg, t.interpolatePlasma = ty, t.create = function (t) {
    return zt(W(t).call(document.documentElement));
  }, t.creator = W, t.local = Dt, t.matcher = tt, t.mouse = Ot, t.namespace = $, t.namespaces = V, t.clientPoint = Ut, t.select = zt, t.selectAll = function (t) {
    return "string" == typeof t ? new Ct([document.querySelectorAll(t)], [document.documentElement]) : new Ct([null == t ? [] : t], Et);
  }, t.selection = Pt, t.selector = Q, t.selectorAll = K, t.style = ct, t.touch = Bt, t.touches = function (t, n) {
    null == n && (n = Lt().touches);
    for (var e = 0, r = n ? n.length : 0, i = new Array(r); e < r; ++e) i[e] = Ut(t, n[e]);
    return i;
  }, t.window = ut, t.customEvent = St, t.arc = function () {
    var t = py,
      n = vy,
      e = ny(0),
      r = null,
      i = gy,
      o = yy,
      a = _y,
      u = null;
    function c() {
      var c,
        f,
        s,
        l = +t.apply(this, arguments),
        h = +n.apply(this, arguments),
        d = i.apply(this, arguments) - ly,
        p = o.apply(this, arguments) - ly,
        v = ey(p - d),
        g = p > d;
      if (u || (u = c = Xi()), h < l && (f = h, h = l, l = f), h > fy) {
        if (v > hy - fy) u.moveTo(h * iy(d), h * uy(d)), u.arc(0, 0, h, d, p, !g), l > fy && (u.moveTo(l * iy(p), l * uy(p)), u.arc(0, 0, l, p, d, g));else {
          var y,
            _,
            b = d,
            m = p,
            x = d,
            w = p,
            M = v,
            N = v,
            A = a.apply(this, arguments) / 2,
            T = A > fy && (r ? +r.apply(this, arguments) : cy(l * l + h * h)),
            S = ay(ey(h - l) / 2, +e.apply(this, arguments)),
            k = S,
            E = S;
          if (T > fy) {
            var C = dy(T / l * uy(A)),
              P = dy(T / h * uy(A));
            (M -= 2 * C) > fy ? (x += C *= g ? 1 : -1, w -= C) : (M = 0, x = w = (d + p) / 2), (N -= 2 * P) > fy ? (b += P *= g ? 1 : -1, m -= P) : (N = 0, b = m = (d + p) / 2);
          }
          var z = h * iy(b),
            R = h * uy(b),
            D = l * iy(w),
            q = l * uy(w);
          if (S > fy) {
            var L,
              U = h * iy(m),
              O = h * uy(m),
              B = l * iy(x),
              Y = l * uy(x);
            if (v < sy && (L = function (t, n, e, r, i, o, a, u) {
              var c = e - t,
                f = r - n,
                s = a - i,
                l = u - o,
                h = l * c - s * f;
              if (!(h * h < fy)) return [t + (h = (s * (n - o) - l * (t - i)) / h) * c, n + h * f];
            }(z, R, B, Y, U, O, D, q))) {
              var F = z - L[0],
                I = R - L[1],
                j = U - L[0],
                H = O - L[1],
                X = 1 / uy(((s = (F * j + I * H) / (cy(F * F + I * I) * cy(j * j + H * H))) > 1 ? 0 : s < -1 ? sy : Math.acos(s)) / 2),
                G = cy(L[0] * L[0] + L[1] * L[1]);
              k = ay(S, (l - G) / (X - 1)), E = ay(S, (h - G) / (X + 1));
            }
          }
          N > fy ? E > fy ? (y = by(B, Y, z, R, h, E, g), _ = by(U, O, D, q, h, E, g), u.moveTo(y.cx + y.x01, y.cy + y.y01), E < S ? u.arc(y.cx, y.cy, E, ry(y.y01, y.x01), ry(_.y01, _.x01), !g) : (u.arc(y.cx, y.cy, E, ry(y.y01, y.x01), ry(y.y11, y.x11), !g), u.arc(0, 0, h, ry(y.cy + y.y11, y.cx + y.x11), ry(_.cy + _.y11, _.cx + _.x11), !g), u.arc(_.cx, _.cy, E, ry(_.y11, _.x11), ry(_.y01, _.x01), !g))) : (u.moveTo(z, R), u.arc(0, 0, h, b, m, !g)) : u.moveTo(z, R), l > fy && M > fy ? k > fy ? (y = by(D, q, U, O, l, -k, g), _ = by(z, R, B, Y, l, -k, g), u.lineTo(y.cx + y.x01, y.cy + y.y01), k < S ? u.arc(y.cx, y.cy, k, ry(y.y01, y.x01), ry(_.y01, _.x01), !g) : (u.arc(y.cx, y.cy, k, ry(y.y01, y.x01), ry(y.y11, y.x11), !g), u.arc(0, 0, l, ry(y.cy + y.y11, y.cx + y.x11), ry(_.cy + _.y11, _.cx + _.x11), g), u.arc(_.cx, _.cy, k, ry(_.y11, _.x11), ry(_.y01, _.x01), !g))) : u.arc(0, 0, l, w, x, g) : u.lineTo(D, q);
        }
      } else u.moveTo(0, 0);
      if (u.closePath(), c) return u = null, c + "" || null;
    }
    return c.centroid = function () {
      var e = (+t.apply(this, arguments) + +n.apply(this, arguments)) / 2,
        r = (+i.apply(this, arguments) + +o.apply(this, arguments)) / 2 - sy / 2;
      return [iy(r) * e, uy(r) * e];
    }, c.innerRadius = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : ny(+n), c) : t;
    }, c.outerRadius = function (t) {
      return arguments.length ? (n = "function" == typeof t ? t : ny(+t), c) : n;
    }, c.cornerRadius = function (t) {
      return arguments.length ? (e = "function" == typeof t ? t : ny(+t), c) : e;
    }, c.padRadius = function (t) {
      return arguments.length ? (r = null == t ? null : "function" == typeof t ? t : ny(+t), c) : r;
    }, c.startAngle = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : ny(+t), c) : i;
    }, c.endAngle = function (t) {
      return arguments.length ? (o = "function" == typeof t ? t : ny(+t), c) : o;
    }, c.padAngle = function (t) {
      return arguments.length ? (a = "function" == typeof t ? t : ny(+t), c) : a;
    }, c.context = function (t) {
      return arguments.length ? (u = null == t ? null : t, c) : u;
    }, c;
  }, t.area = Ay, t.line = Ny, t.pie = function () {
    var t = Sy,
      n = Ty,
      e = null,
      r = ny(0),
      i = ny(hy),
      o = ny(0);
    function a(a) {
      var u,
        c,
        f,
        s,
        l,
        h = a.length,
        d = 0,
        p = new Array(h),
        v = new Array(h),
        g = +r.apply(this, arguments),
        y = Math.min(hy, Math.max(-hy, i.apply(this, arguments) - g)),
        _ = Math.min(Math.abs(y) / h, o.apply(this, arguments)),
        b = _ * (y < 0 ? -1 : 1);
      for (u = 0; u < h; ++u) (l = v[p[u] = u] = +t(a[u], u, a)) > 0 && (d += l);
      for (null != n ? p.sort(function (t, e) {
        return n(v[t], v[e]);
      }) : null != e && p.sort(function (t, n) {
        return e(a[t], a[n]);
      }), u = 0, f = d ? (y - h * b) / d : 0; u < h; ++u, g = s) c = p[u], s = g + ((l = v[c]) > 0 ? l * f : 0) + b, v[c] = {
        data: a[c],
        index: u,
        value: l,
        startAngle: g,
        endAngle: s,
        padAngle: _
      };
      return v;
    }
    return a.value = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : ny(+n), a) : t;
    }, a.sortValues = function (t) {
      return arguments.length ? (n = t, e = null, a) : n;
    }, a.sort = function (t) {
      return arguments.length ? (e = t, n = null, a) : e;
    }, a.startAngle = function (t) {
      return arguments.length ? (r = "function" == typeof t ? t : ny(+t), a) : r;
    }, a.endAngle = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : ny(+t), a) : i;
    }, a.padAngle = function (t) {
      return arguments.length ? (o = "function" == typeof t ? t : ny(+t), a) : o;
    }, a;
  }, t.areaRadial = Ry, t.radialArea = Ry, t.lineRadial = zy, t.radialLine = zy, t.pointRadial = Dy, t.linkHorizontal = function () {
    return Oy(By);
  }, t.linkVertical = function () {
    return Oy(Yy);
  }, t.linkRadial = function () {
    var t = Oy(Fy);
    return t.angle = t.x, delete t.x, t.radius = t.y, delete t.y, t;
  }, t.symbol = function () {
    var t = ny(Iy),
      n = ny(64),
      e = null;
    function r() {
      var r;
      if (e || (e = r = Xi()), t.apply(this, arguments).draw(e, +n.apply(this, arguments)), r) return e = null, r + "" || null;
    }
    return r.type = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : ny(n), r) : t;
    }, r.size = function (t) {
      return arguments.length ? (n = "function" == typeof t ? t : ny(+t), r) : n;
    }, r.context = function (t) {
      return arguments.length ? (e = null == t ? null : t, r) : e;
    }, r;
  }, t.symbols = i_, t.symbolCircle = Iy, t.symbolCross = jy, t.symbolDiamond = Gy, t.symbolSquare = Qy, t.symbolStar = Zy, t.symbolTriangle = Ky, t.symbolWye = r_, t.curveBasisClosed = function (t) {
    return new c_(t);
  }, t.curveBasisOpen = function (t) {
    return new f_(t);
  }, t.curveBasis = function (t) {
    return new u_(t);
  }, t.curveBundle = l_, t.curveCardinalClosed = g_, t.curveCardinalOpen = __, t.curveCardinal = p_, t.curveCatmullRomClosed = M_, t.curveCatmullRomOpen = A_, t.curveCatmullRom = x_, t.curveLinearClosed = function (t) {
    return new T_(t);
  }, t.curveLinear = xy, t.curveMonotoneX = function (t) {
    return new P_(t);
  }, t.curveMonotoneY = function (t) {
    return new z_(t);
  }, t.curveNatural = function (t) {
    return new D_(t);
  }, t.curveStep = function (t) {
    return new L_(t, .5);
  }, t.curveStepAfter = function (t) {
    return new L_(t, 1);
  }, t.curveStepBefore = function (t) {
    return new L_(t, 0);
  }, t.stack = function () {
    var t = ny([]),
      n = O_,
      e = U_,
      r = B_;
    function i(i) {
      var o,
        a,
        u = t.apply(this, arguments),
        c = i.length,
        f = u.length,
        s = new Array(f);
      for (o = 0; o < f; ++o) {
        for (var l, h = u[o], d = s[o] = new Array(c), p = 0; p < c; ++p) d[p] = l = [0, +r(i[p], h, p, i)], l.data = i[p];
        d.key = h;
      }
      for (o = 0, a = n(s); o < f; ++o) s[a[o]].index = o;
      return e(s, a), s;
    }
    return i.keys = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : ny(qy.call(n)), i) : t;
    }, i.value = function (t) {
      return arguments.length ? (r = "function" == typeof t ? t : ny(+t), i) : r;
    }, i.order = function (t) {
      return arguments.length ? (n = null == t ? O_ : "function" == typeof t ? t : ny(qy.call(t)), i) : n;
    }, i.offset = function (t) {
      return arguments.length ? (e = null == t ? U_ : t, i) : e;
    }, i;
  }, t.stackOffsetExpand = function (t, n) {
    if ((r = t.length) > 0) {
      for (var e, r, i, o = 0, a = t[0].length; o < a; ++o) {
        for (i = e = 0; e < r; ++e) i += t[e][o][1] || 0;
        if (i) for (e = 0; e < r; ++e) t[e][o][1] /= i;
      }
      U_(t, n);
    }
  }, t.stackOffsetDiverging = function (t, n) {
    if ((u = t.length) > 0) for (var e, r, i, o, a, u, c = 0, f = t[n[0]].length; c < f; ++c) for (o = a = 0, e = 0; e < u; ++e) (i = (r = t[n[e]][c])[1] - r[0]) >= 0 ? (r[0] = o, r[1] = o += i) : i < 0 ? (r[1] = a, r[0] = a += i) : r[0] = o;
  }, t.stackOffsetNone = U_, t.stackOffsetSilhouette = function (t, n) {
    if ((e = t.length) > 0) {
      for (var e, r = 0, i = t[n[0]], o = i.length; r < o; ++r) {
        for (var a = 0, u = 0; a < e; ++a) u += t[a][r][1] || 0;
        i[r][1] += i[r][0] = -u / 2;
      }
      U_(t, n);
    }
  }, t.stackOffsetWiggle = function (t, n) {
    if ((i = t.length) > 0 && (r = (e = t[n[0]]).length) > 0) {
      for (var e, r, i, o = 0, a = 1; a < r; ++a) {
        for (var u = 0, c = 0, f = 0; u < i; ++u) {
          for (var s = t[n[u]], l = s[a][1] || 0, h = (l - (s[a - 1][1] || 0)) / 2, d = 0; d < u; ++d) {
            var p = t[n[d]];
            h += (p[a][1] || 0) - (p[a - 1][1] || 0);
          }
          c += l, f += h * l;
        }
        e[a - 1][1] += e[a - 1][0] = o, c && (o -= f / c);
      }
      e[a - 1][1] += e[a - 1][0] = o, U_(t, n);
    }
  }, t.stackOrderAppearance = Y_, t.stackOrderAscending = I_, t.stackOrderDescending = function (t) {
    return I_(t).reverse();
  }, t.stackOrderInsideOut = function (t) {
    var n,
      e,
      r = t.length,
      i = t.map(j_),
      o = Y_(t),
      a = 0,
      u = 0,
      c = [],
      f = [];
    for (n = 0; n < r; ++n) e = o[n], a < u ? (a += i[e], c.push(e)) : (u += i[e], f.push(e));
    return f.reverse().concat(c);
  }, t.stackOrderNone = O_, t.stackOrderReverse = function (t) {
    return O_(t).reverse();
  }, t.timeInterval = Zh, t.timeMillisecond = Qh, t.timeMilliseconds = Jh, t.utcMillisecond = Qh, t.utcMilliseconds = Jh, t.timeSecond = nd, t.timeSeconds = ed, t.utcSecond = nd, t.utcSeconds = ed, t.timeMinute = rd, t.timeMinutes = id, t.timeHour = od, t.timeHours = ad, t.timeDay = ud, t.timeDays = cd, t.timeWeek = sd, t.timeWeeks = yd, t.timeSunday = sd, t.timeSundays = yd, t.timeMonday = ld, t.timeMondays = _d, t.timeTuesday = hd, t.timeTuesdays = bd, t.timeWednesday = dd, t.timeWednesdays = md, t.timeThursday = pd, t.timeThursdays = xd, t.timeFriday = vd, t.timeFridays = wd, t.timeSaturday = gd, t.timeSaturdays = Md, t.timeMonth = Nd, t.timeMonths = Ad, t.timeYear = Td, t.timeYears = Sd, t.utcMinute = kd, t.utcMinutes = Ed, t.utcHour = Cd, t.utcHours = Pd, t.utcDay = zd, t.utcDays = Rd, t.utcWeek = qd, t.utcWeeks = Id, t.utcSunday = qd, t.utcSundays = Id, t.utcMonday = Ld, t.utcMondays = jd, t.utcTuesday = Ud, t.utcTuesdays = Hd, t.utcWednesday = Od, t.utcWednesdays = Xd, t.utcThursday = Bd, t.utcThursdays = Gd, t.utcFriday = Yd, t.utcFridays = Vd, t.utcSaturday = Fd, t.utcSaturdays = $d, t.utcMonth = Wd, t.utcMonths = Zd, t.utcYear = Qd, t.utcYears = Jd, t.timeFormatDefaultLocale = pv, t.timeFormatLocale = ep, t.isoFormat = vv, t.isoParse = gv, t.now = er, t.timer = or, t.timerFlush = ar, t.timeout = sr, t.interval = function (t, n, e) {
    var r = new ir(),
      i = n;
    return null == n ? (r.restart(t, n, e), r) : (n = +n, e = null == e ? er() : +e, r.restart(function o(a) {
      a += i, r.restart(o, i += n, e), t(a);
    }, n, e), r);
  }, t.transition = Pr, t.active = function (t, n) {
    var e,
      r,
      i = t.__transition;
    if (i) for (r in n = null == n ? null : n + "", i) if ((e = i[r]).state > pr && e.name === n) return new Cr([[t]], si, n, +r);
    return null;
  }, t.interrupt = Nr, t.voronoi = function () {
    var t = X_,
      n = G_,
      e = null;
    function r(r) {
      return new Tb(r.map(function (e, i) {
        var o = [Math.round(t(e, i, r) / Mb) * Mb, Math.round(n(e, i, r) / Mb) * Mb];
        return o.index = i, o.data = e, o;
      }), e);
    }
    return r.polygons = function (t) {
      return r(t).polygons();
    }, r.links = function (t) {
      return r(t).links();
    }, r.triangles = function (t) {
      return r(t).triangles();
    }, r.x = function (n) {
      return arguments.length ? (t = "function" == typeof n ? n : H_(+n), r) : t;
    }, r.y = function (t) {
      return arguments.length ? (n = "function" == typeof t ? t : H_(+t), r) : n;
    }, r.extent = function (t) {
      return arguments.length ? (e = null == t ? null : [[+t[0][0], +t[0][1]], [+t[1][0], +t[1][1]]], r) : e && [[e[0][0], e[0][1]], [e[1][0], e[1][1]]];
    }, r.size = function (t) {
      return arguments.length ? (e = null == t ? null : [[0, 0], [+t[0], +t[1]]], r) : e && [e[1][0] - e[0][0], e[1][1] - e[0][1]];
    }, r;
  }, t.zoom = function () {
    var n,
      e,
      r = Db,
      i = qb,
      o = Bb,
      a = Ub,
      u = Ob,
      c = [0, 1 / 0],
      f = [[-1 / 0, -1 / 0], [1 / 0, 1 / 0]],
      s = 250,
      l = qe,
      h = [],
      d = I("start", "zoom", "end"),
      p = 500,
      v = 150,
      g = 0;
    function y(t) {
      t.property("__zoom", Lb).on("wheel.zoom", N).on("mousedown.zoom", A).on("dblclick.zoom", T).filter(u).on("touchstart.zoom", S).on("touchmove.zoom", k).on("touchend.zoom touchcancel.zoom", E).style("touch-action", "none").style("-webkit-tap-highlight-color", "rgba(0,0,0,0)");
    }
    function _(t, n) {
      return (n = Math.max(c[0], Math.min(c[1], n))) === t.k ? t : new Eb(n, t.x, t.y);
    }
    function b(t, n, e) {
      var r = n[0] - e[0] * t.k,
        i = n[1] - e[1] * t.k;
      return r === t.x && i === t.y ? t : new Eb(t.k, r, i);
    }
    function m(t) {
      return [(+t[0][0] + +t[1][0]) / 2, (+t[0][1] + +t[1][1]) / 2];
    }
    function x(t, n, e) {
      t.on("start.zoom", function () {
        w(this, arguments).start();
      }).on("interrupt.zoom end.zoom", function () {
        w(this, arguments).end();
      }).tween("zoom", function () {
        var t = arguments,
          r = w(this, t),
          o = i.apply(this, t),
          a = e || m(o),
          u = Math.max(o[1][0] - o[0][0], o[1][1] - o[0][1]),
          c = this.__zoom,
          f = "function" == typeof n ? n.apply(this, t) : n,
          s = l(c.invert(a).concat(u / c.k), f.invert(a).concat(u / f.k));
        return function (t) {
          if (1 === t) t = f;else {
            var n = s(t),
              e = u / n[2];
            t = new Eb(e, a[0] - n[0] * e, a[1] - n[1] * e);
          }
          r.zoom(null, t);
        };
      });
    }
    function w(t, n) {
      for (var e, r = 0, i = h.length; r < i; ++r) if ((e = h[r]).that === t) return e;
      return new M(t, n);
    }
    function M(t, n) {
      this.that = t, this.args = n, this.index = -1, this.active = 0, this.extent = i.apply(t, n);
    }
    function N() {
      if (r.apply(this, arguments)) {
        var t = w(this, arguments),
          n = this.__zoom,
          e = Math.max(c[0], Math.min(c[1], n.k * Math.pow(2, a.apply(this, arguments)))),
          i = Ot(this);
        if (t.wheel) t.mouse[0][0] === i[0] && t.mouse[0][1] === i[1] || (t.mouse[1] = n.invert(t.mouse[0] = i)), clearTimeout(t.wheel);else {
          if (n.k === e) return;
          t.mouse = [i, n.invert(i)], Nr(this), t.start();
        }
        Rb(), t.wheel = setTimeout(function () {
          t.wheel = null, t.end();
        }, v), t.zoom("mouse", o(b(_(n, e), t.mouse[0], t.mouse[1]), t.extent, f));
      }
    }
    function A() {
      if (!e && r.apply(this, arguments)) {
        var n = w(this, arguments),
          i = zt(t.event.view).on("mousemove.zoom", function () {
            if (Rb(), !n.moved) {
              var e = t.event.clientX - u,
                r = t.event.clientY - c;
              n.moved = e * e + r * r > g;
            }
            n.zoom("mouse", o(b(n.that.__zoom, n.mouse[0] = Ot(n.that), n.mouse[1]), n.extent, f));
          }, !0).on("mouseup.zoom", function () {
            i.on("mousemove.zoom mouseup.zoom", null), jt(t.event.view, n.moved), Rb(), n.end();
          }, !0),
          a = Ot(this),
          u = t.event.clientX,
          c = t.event.clientY;
        It(t.event.view), zb(), n.mouse = [a, this.__zoom.invert(a)], Nr(this), n.start();
      }
    }
    function T() {
      if (r.apply(this, arguments)) {
        var n = this.__zoom,
          e = Ot(this),
          a = n.invert(e),
          u = n.k * (t.event.shiftKey ? .5 : 2),
          c = o(b(_(n, u), e, a), i.apply(this, arguments), f);
        Rb(), s > 0 ? zt(this).transition().duration(s).call(x, c, e) : zt(this).call(y.transform, c);
      }
    }
    function S() {
      if (r.apply(this, arguments)) {
        var e,
          i,
          o,
          a,
          u = w(this, arguments),
          c = t.event.changedTouches,
          f = c.length;
        for (zb(), i = 0; i < f; ++i) a = [a = Bt(this, c, (o = c[i]).identifier), this.__zoom.invert(a), o.identifier], u.touch0 ? u.touch1 || (u.touch1 = a) : (u.touch0 = a, e = !0);
        if (n && (n = clearTimeout(n), !u.touch1)) return u.end(), void ((a = zt(this).on("dblclick.zoom")) && a.apply(this, arguments));
        e && (n = setTimeout(function () {
          n = null;
        }, p), Nr(this), u.start());
      }
    }
    function k() {
      var e,
        r,
        i,
        a,
        u = w(this, arguments),
        c = t.event.changedTouches,
        s = c.length;
      for (Rb(), n && (n = clearTimeout(n)), e = 0; e < s; ++e) i = Bt(this, c, (r = c[e]).identifier), u.touch0 && u.touch0[2] === r.identifier ? u.touch0[0] = i : u.touch1 && u.touch1[2] === r.identifier && (u.touch1[0] = i);
      if (r = u.that.__zoom, u.touch1) {
        var l = u.touch0[0],
          h = u.touch0[1],
          d = u.touch1[0],
          p = u.touch1[1],
          v = (v = d[0] - l[0]) * v + (v = d[1] - l[1]) * v,
          g = (g = p[0] - h[0]) * g + (g = p[1] - h[1]) * g;
        r = _(r, Math.sqrt(v / g)), i = [(l[0] + d[0]) / 2, (l[1] + d[1]) / 2], a = [(h[0] + p[0]) / 2, (h[1] + p[1]) / 2];
      } else {
        if (!u.touch0) return;
        i = u.touch0[0], a = u.touch0[1];
      }
      u.zoom("touch", o(b(r, i, a), u.extent, f));
    }
    function E() {
      var n,
        r,
        i = w(this, arguments),
        o = t.event.changedTouches,
        a = o.length;
      for (zb(), e && clearTimeout(e), e = setTimeout(function () {
        e = null;
      }, p), n = 0; n < a; ++n) r = o[n], i.touch0 && i.touch0[2] === r.identifier ? delete i.touch0 : i.touch1 && i.touch1[2] === r.identifier && delete i.touch1;
      i.touch1 && !i.touch0 && (i.touch0 = i.touch1, delete i.touch1), i.touch0 ? i.touch0[1] = this.__zoom.invert(i.touch0[0]) : i.end();
    }
    return y.transform = function (t, n) {
      var e = t.selection ? t.selection() : t;
      e.property("__zoom", Lb), t !== e ? x(t, n) : e.interrupt().each(function () {
        w(this, arguments).start().zoom(null, "function" == typeof n ? n.apply(this, arguments) : n).end();
      });
    }, y.scaleBy = function (t, n) {
      y.scaleTo(t, function () {
        return this.__zoom.k * ("function" == typeof n ? n.apply(this, arguments) : n);
      });
    }, y.scaleTo = function (t, n) {
      y.transform(t, function () {
        var t = i.apply(this, arguments),
          e = this.__zoom,
          r = m(t),
          a = e.invert(r),
          u = "function" == typeof n ? n.apply(this, arguments) : n;
        return o(b(_(e, u), r, a), t, f);
      });
    }, y.translateBy = function (t, n, e) {
      y.transform(t, function () {
        return o(this.__zoom.translate("function" == typeof n ? n.apply(this, arguments) : n, "function" == typeof e ? e.apply(this, arguments) : e), i.apply(this, arguments), f);
      });
    }, y.translateTo = function (t, n, e) {
      y.transform(t, function () {
        var t = i.apply(this, arguments),
          r = this.__zoom,
          a = m(t);
        return o(Cb.translate(a[0], a[1]).scale(r.k).translate("function" == typeof n ? -n.apply(this, arguments) : -n, "function" == typeof e ? -e.apply(this, arguments) : -e), t, f);
      });
    }, M.prototype = {
      start: function start() {
        return 1 == ++this.active && (this.index = h.push(this) - 1, this.emit("start")), this;
      },
      zoom: function zoom(t, n) {
        return this.mouse && "mouse" !== t && (this.mouse[1] = n.invert(this.mouse[0])), this.touch0 && "touch" !== t && (this.touch0[1] = n.invert(this.touch0[0])), this.touch1 && "touch" !== t && (this.touch1[1] = n.invert(this.touch1[0])), this.that.__zoom = n, this.emit("zoom"), this;
      },
      end: function end() {
        return 0 == --this.active && (h.splice(this.index, 1), this.index = -1, this.emit("end")), this;
      },
      emit: function emit(t) {
        St(new kb(y, t, this.that.__zoom), d.apply, d, [t, this.that, this.args]);
      }
    }, y.wheelDelta = function (t) {
      return arguments.length ? (a = "function" == typeof t ? t : Sb(+t), y) : a;
    }, y.filter = function (t) {
      return arguments.length ? (r = "function" == typeof t ? t : Sb(!!t), y) : r;
    }, y.touchable = function (t) {
      return arguments.length ? (u = "function" == typeof t ? t : Sb(!!t), y) : u;
    }, y.extent = function (t) {
      return arguments.length ? (i = "function" == typeof t ? t : Sb([[+t[0][0], +t[0][1]], [+t[1][0], +t[1][1]]]), y) : i;
    }, y.scaleExtent = function (t) {
      return arguments.length ? (c[0] = +t[0], c[1] = +t[1], y) : [c[0], c[1]];
    }, y.translateExtent = function (t) {
      return arguments.length ? (f[0][0] = +t[0][0], f[1][0] = +t[1][0], f[0][1] = +t[0][1], f[1][1] = +t[1][1], y) : [[f[0][0], f[0][1]], [f[1][0], f[1][1]]];
    }, y.constrain = function (t) {
      return arguments.length ? (o = t, y) : o;
    }, y.duration = function (t) {
      return arguments.length ? (s = +t, y) : s;
    }, y.interpolate = function (t) {
      return arguments.length ? (l = t, y) : l;
    }, y.on = function () {
      var t = d.on.apply(d, arguments);
      return t === d ? y : t;
    }, y.clickDistance = function (t) {
      return arguments.length ? (g = (t = +t) * t, y) : Math.sqrt(g);
    }, y;
  }, t.zoomTransform = Pb, t.zoomIdentity = Cb, Object.defineProperty(t, "__esModule", {
    value: !0
  });
});

/***/ }),

/***/ "body-parser":
/*!******************************!*\
  !*** external "body-parser" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("body-parser");

/***/ }),

/***/ "cheerio":
/*!**************************!*\
  !*** external "cheerio" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("cheerio");

/***/ }),

/***/ "cookie-parser":
/*!********************************!*\
  !*** external "cookie-parser" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("cookie-parser");

/***/ }),

/***/ "css-modules-require-hook":
/*!*******************************************!*\
  !*** external "css-modules-require-hook" ***!
  \*******************************************/
/***/ ((module) => {

"use strict";
module.exports = require("css-modules-require-hook");

/***/ }),

/***/ "express":
/*!**************************!*\
  !*** external "express" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("express");

/***/ }),

/***/ "express-winston":
/*!**********************************!*\
  !*** external "express-winston" ***!
  \**********************************/
/***/ ((module) => {

"use strict";
module.exports = require("express-winston");

/***/ }),

/***/ "extend":
/*!*************************!*\
  !*** external "extend" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("extend");

/***/ }),

/***/ "jquery":
/*!*************************!*\
  !*** external "jquery" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("jquery");

/***/ }),

/***/ "jquery-ui":
/*!****************************!*\
  !*** external "jquery-ui" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("jquery-ui");

/***/ }),

/***/ "jquery.cookie":
/*!********************************!*\
  !*** external "jquery.cookie" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("jquery.cookie");

/***/ }),

/***/ "jquery.scrollto":
/*!**********************************!*\
  !*** external "jquery.scrollto" ***!
  \**********************************/
/***/ ((module) => {

"use strict";
module.exports = require("jquery.scrollto");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("querystring");

/***/ }),

/***/ "react":
/*!************************!*\
  !*** external "react" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("react");

/***/ }),

/***/ "react-dom/server":
/*!***********************************!*\
  !*** external "react-dom/server" ***!
  \***********************************/
/***/ ((module) => {

"use strict";
module.exports = require("react-dom/server");

/***/ }),

/***/ "redis":
/*!************************!*\
  !*** external "redis" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("redis");

/***/ }),

/***/ "request":
/*!**************************!*\
  !*** external "request" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("request");

/***/ }),

/***/ "source-map-support":
/*!*************************************!*\
  !*** external "source-map-support" ***!
  \*************************************/
/***/ ((module) => {

"use strict";
module.exports = require("source-map-support");

/***/ }),

/***/ "winston":
/*!**************************!*\
  !*** external "winston" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("winston");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be in strict mode.
(() => {
"use strict";
/*!*******************************!*\
  !*** ./server.js + 2 modules ***!
  \*******************************/
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

;// CONCATENATED MODULE: external "core-js/stable"
const stable_namespaceObject = require("core-js/stable");
;// CONCATENATED MODULE: external "regenerator-runtime/runtime"
const runtime_namespaceObject = require("regenerator-runtime/runtime");
;// CONCATENATED MODULE: ./server.js
function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }
function _regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = "function" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || "@@iterator", asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator", toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, ""); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, "_invoke", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: "normal", arg: fn.call(obj, arg) }; } catch (err) { return { type: "throw", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { ["next", "throw", "return"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if ("throw" !== record.type) { var result = record.arg, value = result.value; return value && "object" == _typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke("next", value, resolve, reject); }, function (err) { invoke("throw", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke("throw", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, "_invoke", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = "suspendedStart"; return function (method, arg) { if ("executing" === state) throw new Error("Generator is already running"); if ("completed" === state) { if ("throw" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if ("next" === context.method) context.sent = context._sent = context.arg;else if ("throw" === context.method) { if ("suspendedStart" === state) throw state = "completed", context.arg; context.dispatchException(context.arg); } else "return" === context.method && context.abrupt("return", context.arg); state = "executing"; var record = tryCatch(innerFn, self, context); if ("normal" === record.type) { if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = "normal", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: "root" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if ("function" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) { var ctor = "function" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, "toString", function () { return "[object Generator]"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if ("throw" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if ("root" === entry.tryLoc) return handle("end"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, "catchLoc"), hasFinally = hasOwn.call(entry, "finallyLoc"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error("try statement without catch or finally"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if ("throw" === record.type) throw record.arg; return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, "catch": function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if ("throw" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, "next" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
// Initially copypasta'd from https://github.com/mhart/react-server-example
// https://github.com/mhart/react-server-example/blob/master/server.js


(__webpack_require__(/*! source-map-support */ "source-map-support").install)();
__webpack_require__(/*! css-modules-require-hook */ "css-modules-require-hook")({
  // so that node can handle require statements for css files
  generateScopedName: '[name]'
});
var redis = __webpack_require__(/*! redis */ "redis");
var _require = __webpack_require__(/*! util */ "util"),
  promisify = _require.promisify;
var http = __webpack_require__(/*! http */ "http"),
  express = __webpack_require__(/*! express */ "express"),
  bodyParser = __webpack_require__(/*! body-parser */ "body-parser"),
  cookieParser = __webpack_require__(/*! cookie-parser */ "cookie-parser"),
  request = __webpack_require__(/*! request */ "request"),
  settings = __webpack_require__(/*! ./local_settings.js */ "./local_settings.js"),
  React = __webpack_require__(/*! react */ "react"),
  ReactDOMServer = __webpack_require__(/*! react-dom/server */ "react-dom/server"),
  SefariaReact = __webpack_require__(/*! ../static/js/ReaderApp.jsx */ "../static/js/ReaderApp.jsx"),
  ReaderApp = React.createFactory(SefariaReact.ReaderApp);
var _require2 = __webpack_require__(/*! ./sefaria-logging */ "./sefaria-logging.js"),
  logger = _require2.logger,
  expressLogger = _require2.expressLogger,
  errorLogger = _require2.errorLogger;
var server = express();
server.use(bodyParser.urlencoded({
  extended: false,
  limit: '50mb'
}));
server.use(bodyParser.json({
  limit: '50mb'
}));
var cacheKeyMapping = {
  "toc": "toc",
  "topic_toc": "topic_toc",
  "terms": "term_mapping",
  "books": "books_en",
  "virtualBooks": "virtualBooks"
};
var sharedCacheData = {
  /*
  Not data, but a unix timestamp (originally) passed from django indicating when data was last updated on this node process. i
  if a later date comes in on a request, it will trigger an update
   */
  "last_cached": null,
  /* data */
  "toc": null,
  "topic_toc": null,
  "terms": null,
  "books": null,
  "virtualBooks": null
};
var cache = redis.createClient("redis://".concat(settings.REDIS_HOST, ":").concat(settings.REDIS_PORT), {
  prefix: ':1:'
});
var getAsync = promisify(cache.get).bind(cache);
var loadSharedData = /*#__PURE__*/function () {
  var _ref = _asyncToGenerator(function () {
    var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      _ref2$last_cached_to_ = _ref2.last_cached_to_compare,
      last_cached_to_compare = _ref2$last_cached_to_ === void 0 ? null : _ref2$last_cached_to_,
      _ref2$startup = _ref2.startup,
      startup = _ref2$startup === void 0 ? false : _ref2$startup;
    return /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {
      var redisCalls, _loop, _i2, _Object$entries, _ref4;
      return _regeneratorRuntime().wrap(function _callee$(_context2) {
        while (1) switch (_context2.prev = _context2.next) {
          case 0:
            logger.debug("Load Shared Data - Input last cached timestamp to compare: " + last_cached_to_compare);
            //TODO: If the data wasnt placed in Redis by django to begin with, well, we're screwed.
            // Or you know, fix it so Node does send a signal to Django to populate cache.
            redisCalls = [];
            _loop = /*#__PURE__*/_regeneratorRuntime().mark(function _loop() {
              var _ref3, key, value;
              return _regeneratorRuntime().wrap(function _loop$(_context) {
                while (1) switch (_context.prev = _context.next) {
                  case 0:
                    _ref3 = _Object$entries[_i2];
                    _ref4 = _slicedToArray(_ref3, 2);
                    key = _ref4[0];
                    value = _ref4[1];
                    _context.t0 = startup || last_cached_to_compare == null;
                    if (_context.t0) {
                      _context.next = 9;
                      break;
                    }
                    _context.next = 8;
                    return needsUpdating(key, last_cached_to_compare);
                  case 8:
                    _context.t0 = _context.sent;
                  case 9:
                    if (!_context.t0) {
                      _context.next = 11;
                      break;
                    }
                    //console.log("Fetching: " + key + "|" + value )
                    redisCalls.push(getAsync(value).then(function (resp) {
                      if (!resp) {
                        throw new Error("Error with ".concat(key, ": ").concat(value, " not found in cache"));
                      } else {
                        sharedCacheData[key] = JSON.parse(resp);
                      }
                    })["catch"](function (error) {
                      logger.error("".concat(value, ": ").concat(error.message));
                    }));
                  case 11:
                  case "end":
                    return _context.stop();
                }
              }, _loop);
            });
            _i2 = 0, _Object$entries = Object.entries(cacheKeyMapping);
          case 4:
            if (!(_i2 < _Object$entries.length)) {
              _context2.next = 9;
              break;
            }
            return _context2.delegateYield(_loop(), "t0", 6);
          case 6:
            _i2++;
            _context2.next = 4;
            break;
          case 9:
            _context2.prev = 9;
            _context2.next = 12;
            return Promise.all(redisCalls);
          case 12:
            if (cacheTimestampNeedsUpdating("last_cached", last_cached_to_compare)) {
              sharedCacheData["last_cached"] = last_cached_to_compare;
            }
            return _context2.abrupt("return", Promise.resolve());
          case 16:
            _context2.prev = 16;
            _context2.t1 = _context2["catch"](9);
            console.error(_context2.t1.message);
            return _context2.abrupt("return", Promise.reject(_context2.t1));
          case 20:
          case "end":
            return _context2.stop();
        }
      }, _callee, null, [[9, 16]]);
    })();
  });
  return function loadSharedData() {
    return _ref.apply(this, arguments);
  };
}();
var cacheTimestampNeedsUpdating = function cacheTimestampNeedsUpdating() {
  var cache_timestamp = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "last_cached";
  var timestamp_to_compare = arguments.length > 1 ? arguments[1] : undefined;
  return sharedCacheData[cache_timestamp] < timestamp_to_compare;
};
var needsUpdating = function needsUpdating(cachekey, last_cached_to_compare) {
  return !sharedCacheData[cachekey] || cacheTimestampNeedsUpdating("last_cached", last_cached_to_compare);
};
var renderReaderApp = function renderReaderApp(props, data, timer) {
  // Returns HTML of ReaderApp component given `props` and `data`
  SefariaReact.sefariaSetup(data, props); //Do we really need to do Sefaria.setup every request?
  SefariaReact.unpackDataFromProps(props);
  timer.ms_to_set_data = timer.elapsed();
  var html = ReactDOMServer.renderToString(ReaderApp(props));
  timer.ms_to_render = timer.elapsed();
  return html;
};
var router = express.Router();
router.get('/error', function (req, res, next) {
  // here we cause an error in the pipeline so we see express-winston in action.
  return next(new Error("This is an error and it should be logged to the console"));
});
router.post('/ReaderApp/:cachekey', function (req, res) {
  // timing stored on locals so that it gets returned with the result to be logged
  var timer = res.locals.timing = {
    start: new Date(),
    elapsed: function elapsed() {
      return new Date() - this.start;
    }
  };
  var props = JSON.parse(req.body.propsJSON);
  req.input_props = {
    // For logging
    initialRefs: props.panels ? props.panels[0].refs : null,
    initialMenu: props.initialMenu,
    initialPath: props.initialPath
  };
  var request_last_cached = props["last_cached"];
  logger.debug("Begin processing request: ", props);
  logger.debug("Last cached time from server: " + request_last_cached + " " + new Date(request_last_cached * 1000).toUTCString());
  logger.debug("last cached time stored: " + sharedCacheData["last_cached"] + " " + new Date(sharedCacheData["last_cached"] * 1000).toUTCString());
  // var cacheKey = req.params.cachekey
  timer.ms_to_props = timer.elapsed();
  loadSharedData({
    last_cached_to_compare: request_last_cached
  }).then(function (response) {
    try {
      timer.ms_to_validate_cache = timer.elapsed();
      var resphtml = renderReaderApp(props, sharedCacheData, timer);
      timer.ms_to_complete = timer.elapsed();
      delete res.locals.timing.elapsed; // no need to pass this around

      res.end(resphtml);
    } catch (render_e) {
      logger.error(render_e);
    }
  })["catch"](function (error) {
    res.status(500).end('Data required for render is missing:  ' + error.message);
  });
});
router.post('/Footer/:cachekey', function (req, res) {
  var props = JSON.parse(req.body.propsJSON);
  SefariaReact.unpackDataFromProps(props);
  var html = ReactDOMServer.renderToString(React.createElement(SefariaReact.Footer));
  res.send(html);
});
router.get('/healthz', function (req, res) {
  res.send('Healthy');
});
server.use(expressLogger); // express-winston logger makes sense BEFORE the router
server.use(router);
server.use(errorLogger); // express-winston errorLogger makes sense AFTER the router.

var main = /*#__PURE__*/function () {
  var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {
    return _regeneratorRuntime().wrap(function _callee2$(_context3) {
      while (1) switch (_context3.prev = _context3.next) {
        case 0:
          logger.info("Startup. Prefetching cached data:");
          _context3.prev = 1;
          _context3.next = 4;
          return loadSharedData({
            startup: true
          });
        case 4:
          _context3.next = 9;
          break;
        case 6:
          _context3.prev = 6;
          _context3.t0 = _context3["catch"](1);
          logger.info("Redis data not ready yet");
        case 9:
          server.listen(settings.NODEJS_PORT, function () {
            logger.info('Redis Host: ' + settings.REDIS_HOST);
            logger.info('Redis Port: ' + settings.REDIS_PORT);
            logger.info('Debug: ' + settings.DEBUG);
            logger.info('Listening on ' + settings.NODEJS_PORT);
          });
        case 10:
        case "end":
          return _context3.stop();
      }
    }, _callee2, null, [[1, 6]]);
  }));
  return function main() {
    return _ref5.apply(this, arguments);
  };
}();
cache.on('error', function (err) {
  logger.error('Redis Connection Error ' + err);
});
cache.on('connect', function () {
  logger.info('Connected to Redis');
  cache.select(1, function () {
    logger.info("REDIS DB: " + cache.selected_db);
    main();
  });
});
})();

/******/ })()
;
//# sourceMappingURL=server-bundle.js.map